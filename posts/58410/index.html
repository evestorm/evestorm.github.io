<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-loading-bar.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







  

<link href="https://cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/favicon.ico?v=5.1.4" color="#222">





  <meta name="keywords" content="笔记,ECS,阿里云,">










<meta name="description" content="购买进入阿里云下拉菜单选择 ecs ：  我购买的配置如下：  购买后实例就运行了，远程连接后安装一系列包和软件： 如何安装阿里云服务器ECS LAMP环境安装（Ubuntu）阿里云ECS云服务器外网IP无法访问 域名解析阿里云如何解析域名 Github Page 自定义域名 创建 Github Page 并设置自定义域名 添加 CNAME 文件到你的存储库中  Ubuntu 安装 nodejs">
<meta name="keywords" content="笔记,ECS,阿里云">
<meta property="og:type" content="article">
<meta property="og:title" content="阿里云云服务器ECS购买与使用（笔记）">
<meta property="og:url" content="https://evestorm.github.io/posts/58410/index.html">
<meta property="og:site_name" content="EVE">
<meta property="og:description" content="购买进入阿里云下拉菜单选择 ecs ：  我购买的配置如下：  购买后实例就运行了，远程连接后安装一系列包和软件： 如何安装阿里云服务器ECS LAMP环境安装（Ubuntu）阿里云ECS云服务器外网IP无法访问 域名解析阿里云如何解析域名 Github Page 自定义域名 创建 Github Page 并设置自定义域名 添加 CNAME 文件到你的存储库中  Ubuntu 安装 nodejs">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://gitee.com/evestorm/various_resources/raw/master/server/ecs_config.png">
<meta property="og:image" content="https://gitee.com/evestorm/various_resources/raw/master/server/ecs_config.png">
<meta property="og:image" content="https://www.howtoing.com/wp-content/uploads/articles/vsftpd_18_04/vsftpd_images/filezilla_site_manager_vsftpd_18_04.png">
<meta property="og:image" content="https://www.howtoing.com/wp-content/uploads/articles/vsftp-user/new-site.png">
<meta property="og:image" content="https://www.howtoing.com/wp-content/uploads/articles/vsftp-user/site-config2.png">
<meta property="og:image" content="https://www.howtoing.com/wp-content/uploads/articles/vsftp-user/user-pass.png">
<meta property="og:image" content="https://www.howtoing.com/wp-content/uploads/articles/vsftpd_18_04/vsftpd_images/filezilla_certificate_vsftpd_three.png">
<meta property="og:image" content="https://www.howtoing.com/wp-content/uploads/articles/vsftpd_18_04/vsftpd_images/filezilla_file_test_vsftpd_18_04.png">
<meta property="og:image" content="https://www.howtoing.com/wp-content/uploads/articles/vsftpd_18_04/vsftpd_images/filezilla_file_upload_vsftpd_18_04.png">
<meta property="og:image" content="https://s1.51cto.com/wyfs02/M00/7E/3C/wKioL1b6SymwbfP7AAA1YkH4slo366.png">
<meta property="og:image" content="https://s5.51cto.com/wyfs02/M00/7E/40/wKiom1b6SWvwBjm7AAA9pZvVBTE386.png">
<meta property="og:updated_time" content="2019-06-21T14:56:44.510Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="阿里云云服务器ECS购买与使用（笔记）">
<meta name="twitter:description" content="购买进入阿里云下拉菜单选择 ecs ：  我购买的配置如下：  购买后实例就运行了，远程连接后安装一系列包和软件： 如何安装阿里云服务器ECS LAMP环境安装（Ubuntu）阿里云ECS云服务器外网IP无法访问 域名解析阿里云如何解析域名 Github Page 自定义域名 创建 Github Page 并设置自定义域名 添加 CNAME 文件到你的存储库中  Ubuntu 安装 nodejs">
<meta name="twitter:image" content="https://gitee.com/evestorm/various_resources/raw/master/server/ecs_config.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://evestorm.github.io/posts/58410/">





  <title>阿里云云服务器ECS购买与使用（笔记） | EVE</title>
  








  <meta name="baidu-site-verification" content="BIAVoToLLq">
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband">
    </div>
    <a target="_blank" href="https://github.com/evestorm" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">EVE</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">EVE的个人博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://evestorm.github.io/posts/58410/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lance">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/kitten.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EVE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">阿里云云服务器ECS购买与使用（笔记）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-12T21:36:48+08:00">
                2019-06-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/" itemprop="url" rel="index">
                    <span itemprop="name">后端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/服务器/" itemprop="url" rel="index">
                    <span itemprop="name">服务器</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  21
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="购买"><a href="#购买" class="headerlink" title="购买"></a>购买</h2><p>进入阿里云下拉菜单选择 ecs ：</p>
<p><img src="https://gitee.com/evestorm/various_resources/raw/master/server/ecs_config.png" alt="menu"></p>
<p>我购买的配置如下：</p>
<p><img src="https://gitee.com/evestorm/various_resources/raw/master/server/ecs_config.png" alt="config"></p>
<p>购买后实例就运行了，远程连接后安装一系列包和软件：</p>
<h2 id="如何安装"><a href="#如何安装" class="headerlink" title="如何安装"></a>如何安装</h2><p><a href="https://www.cnblogs.com/87hbteo/p/7802104.html" target="_blank" rel="noopener">阿里云服务器ECS LAMP环境安装（Ubuntu）</a><br><a href="https://blog.csdn.net/KascLiyuan/article/details/73438093" target="_blank" rel="noopener">阿里云ECS云服务器外网IP无法访问</a></p>
<h2 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h2><p><a href="https://jingyan.baidu.com/article/48b558e3f25e6d7f38c09aec.html" target="_blank" rel="noopener">阿里云如何解析域名</a></p>
<h2 id="Github-Page-自定义域名"><a href="#Github-Page-自定义域名" class="headerlink" title="Github Page 自定义域名"></a>Github Page 自定义域名</h2><ul>
<li><a href="https://www.jianshu.com/p/8ac6c7c037c5" target="_blank" rel="noopener">创建 Github Page 并设置自定义域名</a></li>
<li><a href="http://wiki.jikexueyuan.com/project/github-pages-basics/cname-file.html" target="_blank" rel="noopener">添加 CNAME 文件到你的存储库中</a></li>
</ul>
<h2 id="Ubuntu-安装-nodejs"><a href="#Ubuntu-安装-nodejs" class="headerlink" title="Ubuntu 安装 nodejs"></a>Ubuntu 安装 nodejs</h2><ul>
<li><a href="阿里云Ubuntu搭建NodeJs环境">https://blog.5udou.cn/blog/A-Li-Yun-UbuntuDa-Jian-NodeJsHuan-Jing-75</a></li>
</ul>
<h2 id="ubuntu-图形界面下无法用root登录解决办法"><a href="#ubuntu-图形界面下无法用root登录解决办法" class="headerlink" title="ubuntu 图形界面下无法用root登录解决办法"></a>ubuntu 图形界面下无法用root登录解决办法</h2><p>先按照 <a href="https://www.linuxidc.com/Linux/2017-01/139094.htm" target="_blank" rel="noopener">这个教程</a> 走，但最后不重启。然后转到 <a href="https://blog.csdn.net/qq_39591507/article/details/81288644" target="_blank" rel="noopener">这个教程</a>，执行第三步，也就是下面这段：</p>
<blockquote>
<p>进入/etc/pam.d文件夹下，修改gdm-autologin和gdm-passwd文件内容(首先修改文件权限，参考步骤2的操作)</p>
<p>gdm-autologin文件注释掉auth required pam_success_if.so user!=root quiet_success这一行</p>
<p>gdm-passwd文件注释掉auth required pam_success_if.so user!=root quiet_success这一行</p>
</blockquote>
<p>做完后重启然后点击登录其他用户，输入root和密码root（这个密码在上面第一个教程中已经自己设置了）就好。</p>
<h2 id="安装-LAMP-环境"><a href="#安装-LAMP-环境" class="headerlink" title="安装 LAMP 环境"></a>安装 LAMP 环境</h2><p><a href="https://blog.csdn.net/qq_27366789/article/details/81990291" target="_blank" rel="noopener">在ubuntu16.04中一键创建LAMP环境</a></p>
<h3 id="编辑文件"><a href="#编辑文件" class="headerlink" title="编辑文件"></a>编辑文件</h3><ul>
<li>退出 mysql 命令行：<code>exit</code></li>
<li>vi 编辑文件 按下 i 表示编辑 按下 esc 退出编辑模式 按下 <code>:wq</code> 保存退出</li>
</ul>
<h3 id="mysql-操作"><a href="#mysql-操作" class="headerlink" title="mysql 操作"></a>mysql 操作</h3><p>登录 mysql -u root -p</p>
<p>-u 表示选择登陆的用户名， -p 表示登陆的用户密码，现在是mysql数据库是没有密码的，Enter password:处直接回车，就能够进入mysql数据库。</p>
<h4 id="导入导出"><a href="#导入导出" class="headerlink" title="导入导出"></a>导入导出</h4><p><a href="https://blog.csdn.net/hewenjing8168/article/details/80821447" target="_blank" rel="noopener">ubuntu下mysql数据库的导入导出</a></p>
<h2 id="安装-图形化-mysql-workbench"><a href="#安装-图形化-mysql-workbench" class="headerlink" title="安装 图形化 mysql-workbench"></a>安装 图形化 mysql-workbench</h2><p><a href="https://blog.csdn.net/qq_37638061/article/details/80246799" target="_blank" rel="noopener">安装mysql服务，及安装图形化管理界面</a></p>
<h2 id="打开mysql图形化后无法连接数据库"><a href="#打开mysql图形化后无法连接数据库" class="headerlink" title="打开mysql图形化后无法连接数据库"></a>打开mysql图形化后无法连接数据库</h2><p><a href="https://blog.csdn.net/chexiansheng/article/details/89193955" target="_blank" rel="noopener">Unbuntu 下 Mysql 连接 MysqlWorkBench 出现错误</a></p>
<h2 id="在-ubuntu-下搭建-ftp-服务器"><a href="#在-ubuntu-下搭建-ftp-服务器" class="headerlink" title="在 ubuntu 下搭建 ftp 服务器"></a>在 ubuntu 下搭建 ftp 服务器</h2><ul>
<li><a href="https://www.howtoing.com/how-to-set-up-vsftpd-for-a-user-s-directory-on-ubuntu-18-04" target="_blank" rel="noopener">如何在Ubuntu 18.04上为用户目录设置vsftpd</a><br>执行完上面操作后，会发现下面两个问题，按方法调整就好：</li>
<li><a href="https://blog.51cto.com/zhkao/1758125" target="_blank" rel="noopener">使用FileZilla FTP下载时提示“不安全的服务器，不支持FTPover TLS”,和“服务器不支持非ASCII字符”</a></li>
<li><a href="https://blog.csdn.net/wbryfl/article/details/82729189" target="_blank" rel="noopener">ftp连接错误——服务器发回了不可路由的地址。使用服务器地址代替。</a></li>
</ul>
<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>FTP是文件传输协议的缩写，是一种曾经广泛用于在客户端和服务器之间移动文件的网络协议。 它已被更快，更安全，更方便的文件传输方式所取代。 许多休闲互联网用户希望通过<code>https</code>直接从他们的网络浏览器下载，命令行用户更有可能使用安全协议，如<code>scp</code>或<a href="https://www.howtoing.com/how-to-use-sftp-to-securely-transfer-files-with-a-remote-server/" target="_blank" rel="noopener">SFTP</a> 。</p>
<p>FTP仍然用于支持具有特定需求的遗留应用程序和工作流。 如果您可以选择使用哪种协议，请考虑探索更现代的选项。 但是，当您确实需要FTP时，vsftpd是一个很好的选择。 vsftpd针对安全性，性能和稳定性进行了优化，可以很好地防范其他FTP服务器中存在的许多安全问题，并且是许多Linux发行版的默认设置。</p>
<p>在本教程中，您将配置vsftpd以允许用户使用具有SSL / TLS保护的登录凭据的FTP将文件上载到其主目录。</p>
<h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><p>要学习本教程，您需要：</p>
<ul>
<li><strong>Ubuntu 18.04服务器和具有sudo权限的非root用户</strong> ：您可以在<a href="https://www.howtoing.com/initial-server-setup-with-ubuntu-18-04/" target="_blank" rel="noopener">使用Ubuntu 18.04</a>指南的<a href="https://www.howtoing.com/initial-server-setup-with-ubuntu-18-04/" target="_blank" rel="noopener">初始服务器设置中</a>了解有关如何使用这些权限设置用户的更多信息。</li>
</ul>
<h3 id="第1步-安装vsftpd"><a href="#第1步-安装vsftpd" class="headerlink" title="第1步 - 安装vsftpd"></a>第1步 - 安装vsftpd</h3><p>让我们首先更新我们的包列表并安装<code>vsftpd</code>守护进程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install vsftpd</span><br></pre></td></tr></table></figure>
<p>安装完成后，让我们复制配置文件，这样我们就可以从空白配置开始，将原件保存为备份：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/vsftpd.conf /etc/vsftpd.conf.orig</span><br></pre></td></tr></table></figure>
<p>通过备份配置，我们已准备好配置防火墙。</p>
<h3 id="第2步-打开防火墙"><a href="#第2步-打开防火墙" class="headerlink" title="第2步 - 打开防火墙"></a>第2步 - 打开防火墙</h3><p><strong>注意：</strong> 最后我们还得打开 80 和 8080 端口！！！</p>
<p>让我们检查防火墙状态以查看它是否已启用。 如果是，我们将确保允许FTP流量，因此防火墙规则不会阻止我们的测试。</p>
<p>检查防火墙状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw status</span><br></pre></td></tr></table></figure>
<p>在这种情况下，只允许SSH通过：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">OutputStatus: active</span><br><span class="line"></span><br><span class="line">To                         Action      From</span><br><span class="line">--                         ------      ----</span><br><span class="line">OpenSSH                    ALLOW       Anywhere</span><br><span class="line">OpenSSH (v6)               ALLOW       Anywhere (v6)</span><br></pre></td></tr></table></figure>
<p>您可能有其他规则或根本没有防火墙规则。 由于在这种情况下只允许SSH流量，因此我们需要为FTP流量添加规则。</p>
<p>让我们打开端口<code>20</code>和<code>21</code>用于FTP，端口<code>990</code>用于启用TLS，端口<code>40000-50000</code>用于我们计划在配置文件中设置的被动端口范围：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 20/tcp</span><br><span class="line">sudo ufw allow 21/tcp</span><br><span class="line">sudo ufw allow 990/tcp</span><br><span class="line">sudo ufw allow 40000:50000/tcp</span><br><span class="line">sudo ufw status</span><br></pre></td></tr></table></figure>
<p>我们的防火墙规则现在应如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">OutputStatus: active</span><br><span class="line"></span><br><span class="line">To                         Action      From</span><br><span class="line">--                         ------      ----</span><br><span class="line">OpenSSH                    ALLOW       Anywhere</span><br><span class="line">990/tcp                    ALLOW       Anywhere</span><br><span class="line">20/tcp                     ALLOW       Anywhere</span><br><span class="line">21/tcp                     ALLOW       Anywhere</span><br><span class="line">40000:50000/tcp            ALLOW       Anywhere</span><br><span class="line">OpenSSH (v6)               ALLOW       Anywhere (v6)</span><br><span class="line">20/tcp (v6)                ALLOW       Anywhere (v6)</span><br><span class="line">21/tcp (v6)                ALLOW       Anywhere (v6)</span><br><span class="line">990/tcp (v6)               ALLOW       Anywhere (v6)</span><br><span class="line">40000:50000/tcp (v6)       ALLOW       Anywhere (v6)</span><br></pre></td></tr></table></figure>
<p>p.s. 如何删除一个rule：<code>sudo ufw delete allow 80/tcp</code></p>
<p>安装了<code>vsftpd</code>并打开了必要的端口后，我们继续创建一个专用的FTP用户。</p>
<h3 id="第3步-准备用户目录"><a href="#第3步-准备用户目录" class="headerlink" title="第3步 - 准备用户目录"></a>第3步 - 准备用户目录</h3><p>我们将创建一个专用的FTP用户，但您可能已经有一个需要FTP访问的用户。 我们将注意保留现有用户对以下说明中的数据的访问权限。 即便如此，我们建议您在配置和测试设置之前先与新用户联系。</p>
<p>首先，添加一个测试用户：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser sammy</span><br></pre></td></tr></table></figure>
<p>出现提示时分配密码。 随意通过其他提示按<code>ENTER</code> 。</p>
<p>当用户被限制在特定目录时，FTP通常更安全。 <code>vsftpd</code>用<a href="https://www.howtoing.com/how-to-configure-chroot-environments-for-testing-on-an-ubuntu-12-04-vps/#what-is-a-chroot-environment" target="_blank" rel="noopener"><code>chroot</code></a> jails完成了这个。 为本地用户启用<code>chroot</code> ，默认情况下它们仅限于其主目录。 但是，由于<code>vsftpd</code>保护目录的方式，用户不能写入。 这对于只应通过FTP连接的新用户来说很好，但如果现有用户也具有shell访问权限，则可能需要写入其主文件夹。</p>
<p>在这个例子中，不是从主目录中删除写权限，而是创建一个<code>ftp</code>目录作为<code>chroot</code>和一个可写<code>files</code>目录来保存实际文件。</p>
<p>创建<code>ftp</code>文件夹：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /home/sammy/ftp</span><br></pre></td></tr></table></figure>
<p>设置所有权：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown nobody:nogroup /home/sammy/ftp</span><br></pre></td></tr></table></figure>
<p>删除写权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod a-w /home/sammy/ftp</span><br></pre></td></tr></table></figure>
<p>验证权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo ls -la /home/sammy/ftp</span><br><span class="line">Outputtotal 8</span><br><span class="line">4 dr-xr-xr-x  2 nobody nogroup 4096 Aug 24 21:29 .</span><br><span class="line">4 drwxr-xr-x  3 sammy  sammy   4096 Aug 24 21:29 ..</span><br></pre></td></tr></table></figure>
<p>接下来，让我们创建文件上传目录并为用户分配所有权：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /home/sammy/ftp/files</span><br><span class="line">sudo chown sammy:sammy /home/sammy/ftp/files</span><br></pre></td></tr></table></figure>
<p>对<code>ftp</code>目录的权限检查应返回以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo ls -la /home/sammy/ftp</span><br><span class="line">Outputtotal 12</span><br><span class="line">dr-xr-xr-x 3 nobody nogroup 4096 Aug 26 14:01 .</span><br><span class="line">drwxr-xr-x 3 sammy  sammy   4096 Aug 26 13:59 ..</span><br><span class="line">drwxr-xr-x 2 sammy  sammy   4096 Aug 26 14:01 files</span><br></pre></td></tr></table></figure>
<p>最后，让我们添加一个<code>test.txt</code>文件，以便在测试时使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;vsftpd test file&quot; | sudo tee /home/sammy/ftp/files/test.txt</span><br></pre></td></tr></table></figure>
<p>现在我们已经保护了<code>ftp</code>目录并允许用户访问<code>files</code>目录，让我们修改我们的配置。</p>
<h3 id="第4步-配置FTP访问"><a href="#第4步-配置FTP访问" class="headerlink" title="第4步 - 配置FTP访问"></a>第4步 - 配置FTP访问</h3><p>我们计划允许具有本地shell帐户的单个用户与FTP连接。 这两个关键设置已在<code>vsftpd.conf</code>设置。 首先打开配置文件，验证配置中的设置是否与以下设置相匹配：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/vsftpd.conf</span><br></pre></td></tr></table></figure>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line"># Allow anonymous FTP? (Disabled by default).</span><br><span class="line">anonymous_enable=NO</span><br><span class="line">#</span><br><span class="line"># Uncomment this to allow local users to log in.</span><br><span class="line">local_enable=YES</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>
<p>接下来，让我们通过取消注释<code>write_enable</code>设置来允许用户上传文件：</p>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">write_enable=YES</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>
<p>我们还将取消注释<code>chroot</code>以防止FTP连接的用户访问目录树之外的任何文件或命令：</p>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>
<p>我们还添加一个<code>user_sub_token</code>以在<code>local_root directory</code>路径中插入用户名，这样我们的配置将适用于此用户和任何其他未来用户。 在文件中的任何位置添加这些设置：</p>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">user_sub_token=$USER</span><br><span class="line">local_root=/home/$USER/ftp</span><br></pre></td></tr></table></figure>
<p>我们还限制了可用于被动FTP的端口范围，以确保有足够的连接可用：</p>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">pasv_min_port=40000</span><br><span class="line">pasv_max_port=50000</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>在第2步中，我们打开了我们在此处为被动端口范围设置的端口。 如果更改值，请务必更新防火墙设置。</p>
<p>要根据具体情况允许FTP访问，让我们设置配置，以便用户只有在明确添加到列表时才能访问，而不是默认情况下：</p>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">userlist_enable=YES</span><br><span class="line">userlist_file=/etc/vsftpd.userlist</span><br><span class="line">userlist_deny=NO</span><br></pre></td></tr></table></figure>
<p><code>userlist_deny</code>切换逻辑：当它设置为<code>YES</code> ，列表中的用户被拒绝FTP访问。 当它设置为<code>NO</code> ，只允许列表中的用户访问。</p>
<p>完成更改后，保存文件并退出编辑器。</p>
<p>最后，让我们将用户添加到<code>/etc/vsftpd.userlist</code> 。 使用<code>-a</code>标志追加到文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;sammy&quot; | sudo tee -a /etc/vsftpd.userlist</span><br></pre></td></tr></table></figure>
<p>检查它是否按预期添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/vsftpd.userlist</span><br><span class="line">Outputsammy</span><br></pre></td></tr></table></figure>
<p>重新启动守护程序以加载配置更改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart vsftpd</span><br></pre></td></tr></table></figure>
<p>配置到位后，我们继续测试FTP访问。</p>
<h3 id="第5步-测试FTP访问"><a href="#第5步-测试FTP访问" class="headerlink" title="第5步 - 测试FTP访问"></a>第5步 - 测试FTP访问</h3><p>我们已将服务器配置为仅允许用户<code>sammy</code>通过FTP连接。 让我们确保它按预期工作。</p>
<p><strong>匿名用户应该无法连接</strong> ：我们已禁用匿名访问。 让我们通过尝试匿名连接来测试它。 如果我们的配置设置正确，则应拒绝匿名用户的权限。 请务必将<code>203.0.113.0</code>替换为服务器的公共IP地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ftp -p 203.0.113.0</span><br><span class="line">OutputConnected to 203.0.113.0.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (203.0.113.0:default): anonymous</span><br><span class="line">530 Permission denied.</span><br><span class="line">ftp: Login failed.</span><br><span class="line">ftp&gt;</span><br></pre></td></tr></table></figure>
<p>关闭连接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bye</span><br></pre></td></tr></table></figure>
<p><strong>除了sammy之外的用户应该无法连接</strong> ：接下来，让我们尝试连接我们的sudo用户。 他们也应该被拒绝访问，并且应该在他们被允许输入密码之前发生：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ftp -p 203.0.113.0</span><br><span class="line">OutputConnected to 203.0.113.0.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (203.0.113.0:default): sudo_user</span><br><span class="line">530 Permission denied.</span><br><span class="line">ftp: Login failed.</span><br><span class="line">ftp&gt;</span><br></pre></td></tr></table></figure>
<p>关闭连接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bye</span><br></pre></td></tr></table></figure>
<p><strong>用户sammy应该能够连接，读取和写入文件</strong> ：让我们确保我们的指定用户可以连接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ftp -p 203.0.113.0</span><br><span class="line">OutputConnected to 203.0.113.0.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (203.0.113.0:default): sammy</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password: your_user&apos;s_password</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt;</span><br></pre></td></tr></table></figure>
<p>让我们切换到<code>files</code>目录并使用<code>get</code>命令将我们之前创建的测试文件传输到本地机器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd files</span><br><span class="line">get test.txt</span><br><span class="line">Output227 Entering Passive Mode (203,0,113,0,169,12).</span><br><span class="line">150 Opening BINARY mode data connection for test.txt (16 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">16 bytes received in 0.0101 seconds (1588 bytes/s)</span><br><span class="line">ftp&gt;</span><br></pre></td></tr></table></figure>
<p>接下来，让我们使用新名称上传文件以测试写入权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">put test.txt upload.txt</span><br><span class="line">Output227 Entering Passive Mode (203,0,113,0,164,71).</span><br><span class="line">150 Ok to send data.</span><br><span class="line">226 Transfer complete.</span><br><span class="line">16 bytes sent in 0.000894 seconds (17897 bytes/s)</span><br></pre></td></tr></table></figure>
<p>关闭连接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bye</span><br></pre></td></tr></table></figure>
<p>现在我们已经测试了我们的配置，让我们采取措施进一步保护我们的服务器。</p>
<h3 id="第6步-保护交易"><a href="#第6步-保护交易" class="headerlink" title="第6步 - 保护交易"></a>第6步 - 保护交易</h3><p>由于FTP不会加密传输中的任何数据，包括用户凭据，因此我们将启用TLS / SSL来提供加密。 第一步是创建用于<code>vsftpd</code>的SSL证书。</p>
<p>让我们使用<code>openssl</code>创建一个新证书，并使用<code>-days</code>标志使其有效一年。 在同一个命令中，我们将添加一个私有的2048位RSA密钥。 通过将<code>-keyout</code>和<code>-out</code>标志都设置为相同的值，私钥和证书将位于同一文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/vsftpd.pem -out /etc/ssl/private/vsftpd.pem</span><br></pre></td></tr></table></figure>
<p>系统将提示您提供证书的地址信息。 将您自己的信息替换为以下突出显示的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">OutputGenerating a 2048 bit RSA private key</span><br><span class="line">............................................................................+++</span><br><span class="line">...........+++</span><br><span class="line">writing new private key to &apos;/etc/ssl/private/vsftpd.pem&apos;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:US</span><br><span class="line">State or Province Name (full name) [Some-State]:NY</span><br><span class="line">Locality Name (eg, city) []:New York City</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:DigitalOcean</span><br><span class="line">Organizational Unit Name (eg, section) []:</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []: your_server_ip</span><br><span class="line">Email Address []:</span><br></pre></td></tr></table></figure>
<p>有关证书标志的更多详细信息，请参阅<a href="https://www.howtoing.com/openssl-essentials-working-with-ssl-certificates-private-keys-and-csrs/" target="_blank" rel="noopener">OpenSSL Essentials：使用SSL证书，私钥和CSR</a></p>
<p>创建证书后，再次打开<code>vsftpd</code>配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/vsftpd.conf</span><br></pre></td></tr></table></figure>
<p>在文件的底部，您将看到以<code>rsa_</code>开头的两行。 评论它们，看起来像这样：</p>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line"># rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem</span><br><span class="line"># rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>
<p>在它们下面，添加以下指向我们刚刚创建的证书和私钥的行：</p>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">rsa_cert_file=/etc/ssl/private/vsftpd.pem</span><br><span class="line">rsa_private_key_file=/etc/ssl/private/vsftpd.pem</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>
<p>之后，我们将强制使用SSL，这将阻止无法处理TLS的客户端连接。 这对于确保所有流量都已加密是必要的，但它可能会强制您的FTP用户更改客户端。 将<code>ssl_enable</code>更改为<code>YES</code> ：</p>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">ssl_enable=YES</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>
<p>之后，添加以下行以显式拒绝SSL上的匿名连接，并要求SSL进行数据传输和登录：</p>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">allow_anon_ssl=NO</span><br><span class="line">force_local_data_ssl=YES</span><br><span class="line">force_local_logins_ssl=YES</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>
<p>在此之后，通过添加以下行将服务器配置为使用TLS（SSL的首选后继者）：</p>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">ssl_tlsv1=YES</span><br><span class="line">ssl_sslv2=NO</span><br><span class="line">ssl_sslv3=NO</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>
<p>最后，我们将添加两个选项。 首先，我们不会要求重用SSL，因为它可能会破坏许多FTP客户端。 我们将需要“高”加密密码套件，目前这意味着密钥长度等于或大于128位：</p>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">require_ssl_reuse=NO</span><br><span class="line">ssl_ciphers=HIGH</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>
<p>完成的文件部分应如下所示：</p>
<p>/etc/vsftpd.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># This option specifies the location of the RSA certificate to use for SSL</span><br><span class="line"># encrypted connections.</span><br><span class="line">#rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem</span><br><span class="line">#rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</span><br><span class="line">rsa_cert_file=/etc/ssl/private/vsftpd.pem</span><br><span class="line">rsa_private_key_file=/etc/ssl/private/vsftpd.pem</span><br><span class="line">ssl_enable=YES</span><br><span class="line">allow_anon_ssl=NO</span><br><span class="line">force_local_data_ssl=YES</span><br><span class="line">force_local_logins_ssl=YES</span><br><span class="line">ssl_tlsv1=YES</span><br><span class="line">ssl_sslv2=NO</span><br><span class="line">ssl_sslv3=NO</span><br></pre></td></tr></table></figure>
<p>完成后，保存并关闭文件。</p>
<p>重新启动服务器以使更改生效：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart vsftpd</span><br></pre></td></tr></table></figure>
<p>此时，我们将无法再使用不安全的命令行客户端进行连接。 如果我们尝试过，我们会看到类似的东西：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ftp -p 203.0.113.0</span><br><span class="line">Connected to 203.0.113.0.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (203.0.113.0:default): sammy</span><br><span class="line">530 Non-anonymous sessions must use encryption.</span><br><span class="line">ftp: Login failed.</span><br><span class="line">421 Service not available, remote server has closed connection</span><br><span class="line">ftp&gt;</span><br></pre></td></tr></table></figure>
<p>接下来，让我们验证我们是否可以使用支持TLS的客户端进行连接。</p>
<h3 id="第7步-使用FileZilla测试TLS"><a href="#第7步-使用FileZilla测试TLS" class="headerlink" title="第7步 - 使用FileZilla测试TLS"></a>第7步 - 使用FileZilla测试TLS</h3><p>大多数现代FTP客户端都可以配置为使用TLS加密。 我们将演示如何与<a href="https://filezilla-project.org/" target="_blank" rel="noopener">FileZilla</a>连接，因为它支持跨平台。 请参阅其他客户的文档。</p>
<p>首次打开FileZilla时，在主页上方找到站点管理器图标，这是最上一行最左侧的图标。 点击它：</p>
<p><img src="https://www.howtoing.com/wp-content/uploads/articles/vsftpd_18_04/vsftpd_images/filezilla_site_manager_vsftpd_18_04.png" alt="现场经理Screent Shot"></p>
<p>将打开一个新窗口。 单击右下角的“ <strong>新建站点”</strong>按钮：</p>
<p><img src="https://www.howtoing.com/wp-content/uploads/articles/vsftp-user/new-site.png" alt="新站点按钮"><br>在“ <strong>我的网站”</strong>下，将出现一个带有“ <strong>新网站</strong> ”字样的新图标。 您可以立即命名或稍后返回并使用“ <strong>重命名”</strong>按钮。</p>
<p>使用名称或IP地址填写<strong>主机</strong>字段。 在“ <strong>加密”</strong>下拉菜单下，选择“ <strong>要求显式FTP over TLS”</strong> 。</p>
<p>对于<strong>登录类型</strong> ，选择<strong>询问密码</strong> 。 在“ <strong>用户”</strong>字段中填写您的FTP用户：</p>
<p><img src="https://www.howtoing.com/wp-content/uploads/articles/vsftp-user/site-config2.png" alt="常规设置选项卡"></p>
<p>单击界面底部的“连接”。 系统将要求您输入用户密码：</p>
<p><img src="https://www.howtoing.com/wp-content/uploads/articles/vsftp-user/user-pass.png" alt="密码对话"></p>
<p>单击<strong>确定</strong>以进行连接。 您现在应该使用TLS / SSL加密与您的服务器连接。</p>
<p>成功后，您将看到一个如下所示的服务器证书：</p>
<p><img src="https://www.howtoing.com/wp-content/uploads/articles/vsftpd_18_04/vsftpd_images/filezilla_certificate_vsftpd_three.png" alt="现场证书对话"></p>
<p>当您接受证书后，双击<code>files</code>夹并将<code>upload.txt</code>拖到左侧以确认您能够下载文件：</p>
<p><img src="https://www.howtoing.com/wp-content/uploads/articles/vsftpd_18_04/vsftpd_images/filezilla_file_test_vsftpd_18_04.png" alt="下载test.txt"></p>
<p>完成后，右键单击本地副本，将其重命名为<code>upload-tls.txt</code>并将其拖回服务器以确认您可以上传文件：</p>
<p><img src="https://www.howtoing.com/wp-content/uploads/articles/vsftpd_18_04/vsftpd_images/filezilla_file_upload_vsftpd_18_04.png" alt="重命名和上传"></p>
<p>您现在已确认可以安全地成功传输启用了SSL / TLS的文件。</p>
<h3 id="第8步-禁用Shell访问（可选）"><a href="#第8步-禁用Shell访问（可选）" class="headerlink" title="第8步 - 禁用Shell访问（可选）"></a>第8步 - 禁用Shell访问（可选）</h3><p>如果由于客户端要求而无法使用TLS，则可以通过禁用FTP用户以任何其他方式登录的方式来获得一些安全性。 防止它的一种相对简单的方法是创建一个自定义shell。 这不会提供任何加密，但会限制受感染帐户对FTP可访问的文件的访问。</p>
<p>首先，在<code>bin</code>目录中打开一个名为<code>ftponly</code>的文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /bin/ftponly</span><br></pre></td></tr></table></figure>
<p>添加一条消息，告诉用户他们无法登录的原因：</p>
<p>/斌/ ftponly</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">echo &quot;This account is limited to FTP access only.&quot;</span><br></pre></td></tr></table></figure>
<p>保存文件并退出编辑器。</p>
<p>更改权限以使文件可执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod a+x /bin/ftponly</span><br></pre></td></tr></table></figure>
<p>打开有效shell列表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/shells</span><br></pre></td></tr></table></figure>
<p>在底部添加：</p>
<p>/ etc / shells中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">/bin/ftponly</span><br></pre></td></tr></table></figure>
<p>使用以下命令更新用户的shell：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod sammy -s /bin/ftponly</span><br></pre></td></tr></table></figure>
<p>现在尝试以<code>sammy</code>身份登录您的服务器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh sammy@your_server_ip</span><br></pre></td></tr></table></figure>
<p>你应该看到类似的东西：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OutputThis account is limited to FTP access only.</span><br><span class="line">Connection to 203.0.113.0 closed.</span><br></pre></td></tr></table></figure>
<p>这确认用户不能再<code>ssh</code>到服务器并且仅限于FTP访问。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>在本教程中，我们介绍了为具有本地帐户的用户设置FTP。 如果您需要使用外部身份验证源，您可能需要了解<code>vsftpd</code>对虚拟用户的支持。 这通过使用PAM（可插入身份验证模块）提供了丰富的选项，如果您管理其他系统（如LDAP或Kerberos）中的用户，这是一个不错的选择。</p>
<h3 id="执行完上面操作后的问题解决"><a href="#执行完上面操作后的问题解决" class="headerlink" title="执行完上面操作后的问题解决"></a>执行完上面操作后的问题解决</h3><h4 id="使用FileZilla-FTP下载时提示“不安全的服务器，不支持FTPover-TLS”-和“服务器不支持非ASCII字符”"><a href="#使用FileZilla-FTP下载时提示“不安全的服务器，不支持FTPover-TLS”-和“服务器不支持非ASCII字符”" class="headerlink" title="使用FileZilla FTP下载时提示“不安全的服务器，不支持FTPover TLS”,和“服务器不支持非ASCII字符”"></a>使用FileZilla FTP下载时提示“不安全的服务器，不支持FTPover TLS”,和“服务器不支持非ASCII字符”</h4><p>1、提示“不安全的服务器，不支持FTPover TLS</p>
<p>解决方法：在站点管理器中，加密方式选择：</p>
<p><a href="https://s1.51cto.com/wyfs02/M00/7E/3C/wKioL1b6SymwbfP7AAA1YkH4slo366.png" target="_blank" rel="noopener"><img src="https://s1.51cto.com/wyfs02/M00/7E/3C/wKioL1b6SymwbfP7AAA1YkH4slo366.png" alt="wKioL1b6SymwbfP7AAA1YkH4slo366.png"></a></p>
<p>2、提示“服务器不支持非ASCII字符”</p>
<p>解决方法：在站点管理器中字符集选择：自定义字符集：GBK</p>
<p><a href="https://s5.51cto.com/wyfs02/M00/7E/40/wKiom1b6SWvwBjm7AAA9pZvVBTE386.png" target="_blank" rel="noopener"><img src="https://s5.51cto.com/wyfs02/M00/7E/40/wKiom1b6SWvwBjm7AAA9pZvVBTE386.png" alt="wKiom1b6SWvwBjm7AAA9pZvVBTE386.png"></a></p>
<p>OK,正常了</p>
<h4 id="ftp连接错误——服务器发回了不可路由的地址。使用服务器地址代替。"><a href="#ftp连接错误——服务器发回了不可路由的地址。使用服务器地址代替。" class="headerlink" title="ftp连接错误——服务器发回了不可路由的地址。使用服务器地址代替。"></a>ftp连接错误——服务器发回了不可路由的地址。使用服务器地址代替。</h4><p>设置filezilla客户端的连接参数</p>
<ol>
<li>选中某一连接项</li>
<li>高级——加密——只使用普通ftp</li>
<li>传输设置——传输模式——主动</li>
<li>重新连接</li>
</ol>
<h2 id="ubuntu下Apache虚拟站点配置"><a href="#ubuntu下Apache虚拟站点配置" class="headerlink" title="ubuntu下Apache虚拟站点配置"></a>ubuntu下Apache虚拟站点配置</h2><p><a href="https://www.linuxidc.com/Linux/2017-05/143590.htm" target="_blank" rel="noopener">https://www.linuxidc.com/Linux/2017-05/143590.htm</a></p>
<h2 id="apache配置二级域名"><a href="#apache配置二级域名" class="headerlink" title="apache配置二级域名"></a>apache配置二级域名</h2><p><a href="https://www.cnblogs.com/wwufengg/articles/apache2-mod_rewrite.html" target="_blank" rel="noopener">apache2服务器mod_rewrite模块 开启方法[linux, ubuntu]</a></p>
<p>开启重写，p.s. 上面教程中说要把 <code>/etc/apache2/sites-enabled/000-default</code> 中的 <code>AllowOverride None 修改为： AllowOverride All</code> ，然而我的 Apache2 是新版（2.4），所以得转到 <code>/etc/apache2/</code> 。将名为 <code>apache2.conf</code> 的文件中的 <a href="http://www.kbase101.com/question/9571.html" target="_blank" rel="noopener">下面代码从 NONE 改为 ALL</a> ：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Directory</span> /<span class="attr">var</span>/<span class="attr">www</span>/&gt;</span></span><br><span class="line">    Options Indexes FollowSymLinks</span><br><span class="line">    AllowOverride All</span><br><span class="line">    Require all granted</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>目标二级域名：mall.evelance.cn</p>
<p>阿里云控制台配置：在阿里云的控制台中找到域名管理，然后选择顶级域名 evelance.cn 后面的“解析”字样。在新打开的页面中我们可以看到一个提供域名解析的界面，选择解析类型为A类解析，然后输入 mall（我们想要的二级域名的头），然后在地址里面输入我们刚才查看到的ECS的公网ip，然后点击确认，之后我们的解析就会生效了。</p>
<p>ubuntu服务器配置：</p>
<p>进入 /etc/apache2/site-available/ ，复制默认的虚拟主机配置文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp 000-default.conf mall.evelance.cn.conf</span><br></pre></td></tr></table></figure>
<p>修改配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerAdmin xxx@qq.com</span><br><span class="line">    ServerName mall.evelance.com</span><br><span class="line">    DocumentRoot /home/www/mall</span><br><span class="line"></span><br><span class="line">    &lt;Directory "/home/www/mall"&gt;</span><br><span class="line">        Options FollowSymLinks</span><br><span class="line">        AllowOverride All</span><br><span class="line">        #Require all denied</span><br><span class="line">        Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">    ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span><br><span class="line">    CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span><br><span class="line"></span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>
<p>在sites-enabled目录下建立符号链接：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/apache2/sites-enabled</span><br><span class="line"><span class="meta">#</span><span class="bash">建立对应的软链接</span></span><br><span class="line">sudo ln -s /etc/apache2/sites-available/mall.evelance.cn.conf /etc/apache2/sites-enabled/mall.evelance.cn.conf</span><br></pre></td></tr></table></figure>
<p>在对应目录放入项目代码：</p>
<p>把项目文件放进 /home/www/mall 中，并赋予文件夹权限：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod -R 777 /home/www/mall</span><br></pre></td></tr></table></figure>
<p>激活配置，重启 apache：</p>
<p>返回上级目录 <code>cd ../site-enable/</code>，输入 <code>cd sites-available/</code></p>
<p>输入 <code>a2ensite mall.evelance.cn.conf</code> ，如果提示已经激活过了，输入下面代码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a2dissite mall.evelance.cn.conf</span><br><span class="line">service apache2 reload</span><br><span class="line">a2ensite mall.evelance.cn.conf</span><br><span class="line">service apache2 reload</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<ul>
<li><a href="https://blog.csdn.net/carolcoral/article/details/77857264" target="_blank" rel="noopener">ECS简单配置多个二级域名</a></li>
</ul>
<h3 id="域名解析-1"><a href="#域名解析-1" class="headerlink" title="域名解析"></a>域名解析</h3><p>登录阿里云，进入控制台，选择云解析DNS。选择右侧的解析管理，进行二级域名的添加：</p>
<ul>
<li>记录类型：A</li>
<li>主机记录：[mall].evelance.cn</li>
<li>解析线路：默认</li>
<li>记录值：你的公共IP</li>
<li>TTL：10分钟</li>
</ul>
<p>参考：<a href="https://blog.csdn.net/wangjia55/article/details/81127647" target="_blank" rel="noopener">阿里云添加二级域名的操作</a></p>
<h3 id="支持https"><a href="#支持https" class="headerlink" title="支持https"></a>支持https</h3><ol>
<li><a href="https://www.cnblogs.com/lxf1117/p/6650647.html" target="_blank" rel="noopener">在阿里云里申请免费Https证书SSL
</a></li>
<li><a href="https://yq.aliyun.com/articles/697838" target="_blank" rel="noopener">ubuntu apache2 配置安装ssl证书</a></li>
<li><a href="https://www.cnblogs.com/wpl-php/p/10287125.html" target="_blank" rel="noopener">阿里云 Ubuntu16.04 apache2 ssl证书下载与安装（必须有域名）</a></li>
<li>完成上述配置后，别忘了让防火墙允许 443 端口。<code>sudo ufw allow 443/tcp</code></li>
</ol>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="Lance 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="Lance 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/笔记/" rel="tag"><i class="fa fa-tag"></i> 笔记</a>
          
            <a href="/tags/ECS/" rel="tag"><i class="fa fa-tag"></i> ECS</a>
          
            <a href="/tags/阿里云/" rel="tag"><i class="fa fa-tag"></i> 阿里云</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/46036/" rel="next" title="前端面试系列大纲">
                <i class="fa fa-chevron-left"></i> 前端面试系列大纲
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/60660/" rel="prev" title="ubuntu下开启/关闭防火墙及端口的命令(笔记)">
                ubuntu下开启/关闭防火墙及端口的命令(笔记) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/kitten.jpeg" alt="Lance">
            
              <p class="site-author-name" itemprop="name">Lance</p>
              <p class="site-description motion-element" itemprop="description">Front-end developer and iOS developer</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">146</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">59</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#购买"><span class="nav-number">1.</span> <span class="nav-text">购买</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何安装"><span class="nav-number">2.</span> <span class="nav-text">如何安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#域名解析"><span class="nav-number">3.</span> <span class="nav-text">域名解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Github-Page-自定义域名"><span class="nav-number">4.</span> <span class="nav-text">Github Page 自定义域名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ubuntu-安装-nodejs"><span class="nav-number">5.</span> <span class="nav-text">Ubuntu 安装 nodejs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ubuntu-图形界面下无法用root登录解决办法"><span class="nav-number">6.</span> <span class="nav-text">ubuntu 图形界面下无法用root登录解决办法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装-LAMP-环境"><span class="nav-number">7.</span> <span class="nav-text">安装 LAMP 环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编辑文件"><span class="nav-number">7.1.</span> <span class="nav-text">编辑文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysql-操作"><span class="nav-number">7.2.</span> <span class="nav-text">mysql 操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#导入导出"><span class="nav-number">7.2.1.</span> <span class="nav-text">导入导出</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装-图形化-mysql-workbench"><span class="nav-number">8.</span> <span class="nav-text">安装 图形化 mysql-workbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打开mysql图形化后无法连接数据库"><span class="nav-number">9.</span> <span class="nav-text">打开mysql图形化后无法连接数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在-ubuntu-下搭建-ftp-服务器"><span class="nav-number">10.</span> <span class="nav-text">在 ubuntu 下搭建 ftp 服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#介绍"><span class="nav-number">10.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#先决条件"><span class="nav-number">10.2.</span> <span class="nav-text">先决条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第1步-安装vsftpd"><span class="nav-number">10.3.</span> <span class="nav-text">第1步 - 安装vsftpd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第2步-打开防火墙"><span class="nav-number">10.4.</span> <span class="nav-text">第2步 - 打开防火墙</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第3步-准备用户目录"><span class="nav-number">10.5.</span> <span class="nav-text">第3步 - 准备用户目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第4步-配置FTP访问"><span class="nav-number">10.6.</span> <span class="nav-text">第4步 - 配置FTP访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第5步-测试FTP访问"><span class="nav-number">10.7.</span> <span class="nav-text">第5步 - 测试FTP访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第6步-保护交易"><span class="nav-number">10.8.</span> <span class="nav-text">第6步 - 保护交易</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第7步-使用FileZilla测试TLS"><span class="nav-number">10.9.</span> <span class="nav-text">第7步 - 使用FileZilla测试TLS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第8步-禁用Shell访问（可选）"><span class="nav-number">10.10.</span> <span class="nav-text">第8步 - 禁用Shell访问（可选）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#结论"><span class="nav-number">10.11.</span> <span class="nav-text">结论</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行完上面操作后的问题解决"><span class="nav-number">10.12.</span> <span class="nav-text">执行完上面操作后的问题解决</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用FileZilla-FTP下载时提示“不安全的服务器，不支持FTPover-TLS”-和“服务器不支持非ASCII字符”"><span class="nav-number">10.12.1.</span> <span class="nav-text">使用FileZilla FTP下载时提示“不安全的服务器，不支持FTPover TLS”,和“服务器不支持非ASCII字符”</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ftp连接错误——服务器发回了不可路由的地址。使用服务器地址代替。"><span class="nav-number">10.12.2.</span> <span class="nav-text">ftp连接错误——服务器发回了不可路由的地址。使用服务器地址代替。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ubuntu下Apache虚拟站点配置"><span class="nav-number">11.</span> <span class="nav-text">ubuntu下Apache虚拟站点配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apache配置二级域名"><span class="nav-number">12.</span> <span class="nav-text">apache配置二级域名</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#域名解析-1"><span class="nav-number">12.1.</span> <span class="nav-text">域名解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#支持https"><span class="nav-number">12.2.</span> <span class="nav-text">支持https</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lance</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">222.3k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      人阅读
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@3.12.0/dist/av-min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/valine@1.3.6/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: true,
        notify: true,
        appId: 'eMlA1yfOVSu3St1f6l2XzQqC-gzGzoHsz',
        appKey: 'TOv5VcioO0ijgjrHfGILweOR',
        placeholder: '欢迎交流讨论...',
        avatar:'mm',
        guest_info:guest,
        pageSize:'15' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  <!-- 代码块复制功能 -->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
</body>
</html>

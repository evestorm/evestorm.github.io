---
title: é¢„ç¼–è¯‘
tags:
  - ç¬”è®°
categories:
  - å‰ç«¯
  - JS
  - ECMAScript
abbrlink: 53691
date: 2021-08-08 10:20:53
top: True
---

## é¢„ç¼–è¯‘

### è¿è¡Œè¿‡ç¨‹

1. é€šç¯‡çš„æ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼Œæœ‰åˆ™ç›´æ¥æŠ›é”™ï¼Œä¸æ‰§è¡Œä»»ä½•è¯­å¥
2. é¢„ç¼–è¯‘
3. è§£é‡Šä¸€è¡Œï¼Œæ‰§è¡Œä¸€è¡Œ


### å˜é‡æå‡

- å˜é‡åªæŠŠå£°æ˜æå‡ï¼Œèµ‹å€¼ä¸æå‡
- å‡½æ•°
   - å‡½æ•°å£°æ˜ï¼šæ•´ä½“æå‡
   - å‡½æ•°è¡¨è¾¾å¼ï¼šåªæå‡å˜é‡ï¼Œå­—é¢é‡ä¸æå‡


```javascript
test(); // 1
function test() {
	console.log(1);
}

console.log(a); // undefined
var a;
```

<!-- more -->

### æš—ç¤ºå…¨å±€å˜é‡ imply global variable

- æ²¡æœ‰å£°æ˜ï¼ˆæ²¡å†™varï¼‰å°±èµ‹å€¼çš„å˜é‡
- å…¨å±€å£°æ˜æˆ–è€…ä¸å£°æ˜ï¼ˆæ²¡å†™varï¼‰å¾—å˜é‡éƒ½ä¼šæŒ‚åœ¨ window ä¸Š


```javascript
function test() {
	var a = b = 1;
}

test();
console.log(b); // 1 (bæŒ‚åœ¨äº†windowï¼Œå› ä¸ºæ²¡æœ‰varå£°æ˜)
console.log(window.b); // 1
console.log(a); // ReferenceError: a is not defined
console.log(window.a); // undefined
```

### ğŸŒˆAOï¼ˆactivation objectï¼‰æ´»è·ƒå¯¹è±¡ï¼Œå‡½æ•°ä¸Šä¸‹æ–‡

1. å¯»æ‰¾**å½¢å‚å’Œå˜é‡å£°æ˜**ï¼ˆ**æ²¡ç”¨varå£°æ˜çš„å˜é‡ä¸æå‡å˜é‡åï¼Œä¸å£°æ˜varçš„å˜é‡è¢«ä¿®æ”¹ï¼Œå½“å‰ä½œç”¨åŸŸæœ‰æ­¤å˜é‡çš„ï¼Œä¼˜å…ˆä¿®æ”¹æ­¤ä½œç”¨åŸŸå†…çš„å˜é‡**ï¼‰
2. **å®å‚å€¼èµ‹å€¼ç»™å½¢å‚**
3. å¯»æ‰¾**å‡½æ•°å£°æ˜å¹¶èµ‹å€¼**
4. æ‰§è¡Œ


```javascript
function test(a) {
  console.log(a); 
  var a = 1;
  console.log(a); 
  function a() {}
  console.log(a); 
  var b = function() {}
  console.log(b);
  function d() {}
}
test(2);
// function a() {}
// 1
// 1
// function() {}
AO = {
	a: undefined -> 
  	 2 ->,
  	 function a(){} ->
     1,
       
  b: undefined ->
     function() {},
    
  d: function d() {}
}
```

```javascript
function test(a, b) {
	console.log(a);
  c = 0;
  var c;
  a = 5;
  b = 6;
  console.log(b);
  function b() {}
  function d() {}
  console.log(b);
}
test(1, 2);
 // 1
 // 6
 // 6
AO = {
	a: undefined ->
  		1 ->
  		5,
  
  b: undefined ->
  		2 ->
  		function b() {} ->
  		6,
  c: undefined -> 
    	0,
  d: function d() {}
}
```

- æ²¡ç”¨varå£°æ˜çš„å˜é‡ä¸ä¼šæœ‰å˜é‡æå‡


```javascript
console.log(a);
a = 2;

// ReferenceError: a is not defined

// vs

console.log(a);
var a = 2;

// undefined
```

```javascript
function test() {
	console.log(a);
  a = 2;
}
test();

// ReferenceError: a is not defined


// vs

function test() {
	console.log(a);
  var a = 2;
}
test();

// undefined
```

- if ã€ä»£ç å—ä¸­ var å˜é‡ï¼Œä¼šæå‡åˆ°å¤–å±‚ä½œç”¨åŸŸ


```javascript
console.log(a);
if (true) {
  a = 2;
}

// ReferenceError: a is not defined

// vs

console.log(a);
if (true) {
  var a = 2;
}
// undefined



// ----------

var a = 1;

{
  a = 3;
  console.log(a); // 3
  var a;
}

console.log(a); // 3
```

```javascript
function test() {
  console.log(a);
  if (true) {
    a = 2;
  }
}
test();
// ReferenceError: a is not defined


// vs

function test() {
  console.log(a);
  if (true) {
    var a = 2;
  }
}
test();
// undefined
```

### GOï¼ˆglobal objectï¼‰å…¨å±€ä¸Šä¸‹æ–‡

1. å¯»æ‰¾å˜é‡
2. å¯»æ‰¾å‡½æ•°å£°æ˜
3. æ‰§è¡Œ


> GO === window

```javascript
var a = 1;
function a() {
	console.log(2);
}
console.log(a);

// 1

GO = {
	a: undefiend ->
  	 function a(){} -> 
     1
}
```

```javascript
console.log(a, b);
function a() {}
var b = function() {};

 // function a() {} undefined
GO = {
	b: undefined,
  a: function a() {}
}
```

```javascript
function test() {
	var a = b = 1;
  console.log(a);
}

test();

GO = {
	b: 1
}

AO = {
	a: undefined ->
  	1
}
```

```javascript
var b = 3;
console.log(a);
function a(a) {
	console.log(a);
  var a = 2;
  console.log(a);
  function a() {}
  var b = 5;
  console.log(b);
}

a(1);

 // function a(a) {}
 // function a() {}
 // 2
 // 5

GO = {
	b: 3
  a: function a() {}
}

AO = {
	a: undefined ->
  	 1 ->
  	 function a() {} ->
		 2,
  b: undefined ->
     5
}

AO = {
	b: undefined ->
  	 5
}
```

```javascript
a = 1;
function test() {
	console.log(a);
  a = 2;
  console.log(a);
  var a = 3;
  console.log(a);
}
test();

 //undefined
 // 2
 // 3

GO = {
	a: undefined ->
  	 1,
  test: function test() {}
}
AO = {
	a: undefined ->
  	 2 ->
  	 3
}
```

```javascript
function test() {
	console.log(b);
  if (a) {
  	var b = 2;
  }
  c = 3;
  console.log(c);
}
var a;
test();
a = 1;
console.log(a);

// undefined
// 3
// 1

GO = {
	test: function test() {},
  a: undefined ->
      1,
  c: 3
}

AO = {
	b: undefined
}
```

### ğŸŒˆ ifä»£ç å—é™·è¿›

å‡å®š if ä¸­æœ‰ä¸€ä¸ªå‡½æ•°å£°æ˜ `function a() {}`

1. if æœªæ‰§è¡Œæ—¶ï¼š
   1. if é‡Œçš„å‡½æ•°å£°æ˜é¦–å…ˆæŠŠ**å˜é‡å a **æå‡åˆ°**å½“å‰ä½œç”¨åŸŸ**ï¼ˆä¸æ˜¯å—ä½œç”¨åŸŸï¼‰çš„**æœ€é¡¶éƒ¨** `a = undefined`
2. if æ‰§è¡Œæ—¶ï¼š
   1. å‡½æ•°å£°æ˜**æ•´ä½“**ä¼šè¢«æå‡åˆ°**å—ä½œç”¨åŸŸé¡¶éƒ¨**
   1. æ‰§è¡Œåˆ°å‡½æ•°å£°æ˜è¯­å¥æ—¶ï¼Œä¼šæŠŠå—ä½œç”¨åŸŸé‡Œçš„ a èµ‹å€¼åˆ°**å½“å‰ä½œç”¨åŸŸ**åŒåå˜é‡ a


```javascript
console.log(b);
if (true) {
  console.log(b);
  function b() {}
}

// å› ä¸ºifä¸­ï¼Œfunction b() {} ä¼šè¢«çœ‹åšå‡½æ•°è¡¨è¾¾å¼
// æ‰€ä»¥ä¼šæŠŠå‡½æ•°å b å˜é‡æå‡åˆ°å½“å‰ä½œç”¨åŸŸçš„æœ€é¡¶éƒ¨ï¼ˆä¹Ÿå°±æ˜¯å…¨å±€æ‰§è¡Œå™¨ä¸Šä¸‹æ–‡ï¼‰ï¼Œb å®šä¹‰æ²¡å€¼ undefined

// if åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šé¦–å…ˆæŠŠå‡½æ•°å£°æ˜æå‡åˆ° if ä»£ç å—å†…éƒ¨çš„é¡¶ç«¯
// æ‰€ä»¥å†…éƒ¨æ‰“å° function b
```

```javascript
var f = function() {return true;};
var g = function() {return false;};
(function() {
	console.log(g);
  if (g() && [] == ![]) {
  	f = function f() {return false;};
    function g() {return true;};
  }
})();
```

{% asset_img g.png g %}

åˆ†æï¼š

- ifä»£ç å—ä¸­çš„ var å˜é‡ä¼šæå‡ï¼Œä½†å‡½æ•°å£°æ˜å¹¶ä¸ä¼šæ•´ä½“æå‡ï¼Œè€Œåªä¼šæå‡å‡½æ•°ååˆ°å½“å‰ä½œç”¨äºé¡¶ç«¯ã€‚
- èµ‹å€¼çš„æ‰§è¡Œä¸€å®šä¼šåœ¨ifæ‰§è¡Œçš„è¿‡ç¨‹ä¸­åšã€‚

{% asset_img g1.png g1 %}
{% asset_img g2.png g2 %}

ä¸Šé¢æ‰“æ–­ç‚¹ä¼šå‘ç°ï¼Œfunction gçš„gå˜é‡æ˜¯æå‡åˆ°ifå¤–è¾¹äº†ï¼Œä½†æ­¤åˆ»è¿˜æ˜¯undefinedã€‚è€Œiifeå¤–è¾¹çš„fï¼Œgæ­¤åˆ»åœ¨iifeä¸­æ˜¯å¯ä»¥è®¿é—®çš„ã€‚ä½†ç”±äºiifeä¸­æœ‰äº†åŒågï¼Œæ‰€ä»¥è¿˜æ˜¯undefinedï¼Œç„¶åifåˆ¤æ–­æ˜¯g()ç”±äºgæ˜¯undefinedä¸æ˜¯å‡½æ•°æ‰€ä»¥æŠ¥é”™äº†ã€‚å¦å¤–ifä¸­çš„få‰é¢ç”±äºæ²¡æœ‰var ï¼Œæ‰€ä»¥æ”¹çš„æ˜¯iifeå¤–è¾¹çš„f

### ç»ƒä¹ 

```javascript
function test() {
	return a;
  a = 1;
  function a() {}
  var a = 2;
}
console.log(test());
```
```javascript
function test() {
	a = 1;
  function a() {}
  var a = 2;
  return a;
}
console.log(test());
```

```javascript
a = 1;
function test(e) {
	function e() {}
  arguments[0] = 2;
  console.log(e);
  if (a) {
  	var b = 3;
  }
  var c;
  a = 4;
  var a;
  console.log(b);
  f = 5;
  console.log(c);
  console.log(a);
}
var a;
test(1);

go = {
	a: undefined -> 1,
  test: function test() {},
  f: undefined -> 5
}

ao = {
	a: undefined ->
     4,
  b: undefined,
  c: undefined,
  e: undefined ->
     1 ->
     function e() {} ->
     2
}
```

### é¢è¯•é¢˜

```javascript
var a = false + 1;
console.log(a); // 1 éšå¼è½¬æ¢ï¼Œæ²¡æœ‰å­—ç¬¦ä¸²ï¼ŒæŠŠéå­—ç¬¦ä¸²è½¬åŸºæœ¬ç±»å‹ï¼Œå†to number

var b = false == 1;
console.log(b); // false

//   string        -1         NaN    
if (typeof(a) && (-true) + (+ undefined) + '') {
	console.log('é€šè¿‡'); // æ‰§è¡Œ
} else {
	console.log('æœªé€šè¿‡');
}
// hint: if ä¸­ => "undefined" && (-1 + NaN) + '' => 
// "undefined" && NaN + '' =>
// "undefined" && 'NaN' => true

// 1    15
if(1 + 5 * '3' === 16) {
	console.log('é€šè¿‡'); // æ‰§è¡Œ
} else {
  consoel.log('æœªé€šè¿‡'); 
}
// hint: ä¹˜æ³•ï¼Œä¼šæŠŠéæ•°å­—è½¬æ•°å­—



// 					true		false   false  
ğŸ’ console.log(!!' ' + !!'' - !!false || 'é€šè¿‡äº†'); // 1
// hint: ' ': ä¸æ˜¯éç©ºä¸²ï¼Œä¸ºçœŸï¼Œä¸¤æ¬¡å–åï¼Œç­‰äºæ²¡åï¼Œæœ€åä¸ºçœŸ

window.a || (window.a = '1');
console.log(window.a); // '1'
// ()è¿ç®—ä¼˜å…ˆçº§é«˜ï¼Œæ‰€ä»¥å…ˆè¿è¡Œ window.a = '1' ï¼Œ ç„¶å window.a å°±æ˜¯çœŸ
```

```javascript
function test() {
  console.log(a); // undefined
  if (false) {
    function a () {}
  }
}
test();
console.log(a); // æŠ¥é”™
```

```javascript
var a = 0;

console.log('No.1', a);

{
  console.log('No.2', a);
  a = 1;
  console.log('No.3', a);
  function a () {}
  console.log('No.4', a);
  a = 2;
  console.log('No.5', a);
}

console.log('No.6', a);

// 1. {} å—ä½œç”¨åŸŸä¸­ function a çš„ a å˜é‡æå‰åˆ°å½“å‰ä½œç”¨åŸŸï¼ˆä¹Ÿå°±æ˜¯å…¨å±€ä½œç”¨åŸŸï¼‰
// 2. å¼€å§‹æ‰§è¡Œ a = 0, æ‰€ä»¥ No.1 çš„ a æ˜¯ 0
// 3. å¼€å§‹æ‰§è¡Œ {} ä»£ç å—ä¸­çš„å†…å®¹ï¼Œé¦–å…ˆæŠŠ function a() {} æ•´ä½“æå‡åˆ°å—ä½œç”¨åŸŸé¡¶éƒ¨
// ï¼Œæ­¤åˆ»å—ä½œç”¨åŸŸä¸­æœ‰äº†å˜é‡ aï¼Œæ‰€ä»¥ No.2 çš„ a æ˜¯ function a() {}
// 4. æ¥ç€ a = 1, å°±æŠŠå—ä½œç”¨åŸŸä¸­çš„ function a æ”¹æˆäº† 1ï¼Œæ‰€ä»¥ No.3 çš„ a æ˜¯ 1
// 5. æ‰§è¡Œåˆ° function a() {} è¿™ä¸€æ­¥æ—¶ï¼Œ
// ä¼šæŠŠå—ä½œç”¨åŸŸé‡Œçš„ a èµ‹å€¼åˆ°å…¨å±€åŒåå˜é‡ aï¼Œæ­¤åˆ»å…¨å±€ a å˜æˆäº† 1
// 6. æ¥ç€ a = 2 ï¼ŒæŠŠå—ä½œç”¨åŸŸçš„ a å˜æˆäº† 2ï¼Œæ‰€ä»¥ No.5 çš„ a æ˜¯ 2
// 7. No.6 æ‰“å°å…¨å±€ a ï¼Œæ˜¯ 1

/**
 * go: {
 *  a: undefined -> 0 -> 1
 * }
 * 
 * ao: {
 *  a: function a -> 1
 * }
 */
```

```javascript
let a = 0;

console.log(a);

if (true) {
  a = 1;

  console.log(a);

  function a() {}

  a = 2;

  console.log(a);
}

console.log(a);

// è¿™ä¸€é¢˜æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå¤–éƒ¨ a æ˜¯ç”¨ let å£°æ˜çš„ ï¼Œæ— æ³•è¢« function a è¦†ç›–
```

```javascript
{
  let a = 1;
  function a() {}
}

// æŠ¥é”™ï¼Œæš‚æ—¶æ€§æ­»åŒº
```

---
title: æ€»ç»“äº‹ä»¶ä»£ç†
tags:
  - ç¬”è®°
categories:
  - å‰ç«¯
  - JS
  - DOM
abbrlink: 30660
date: 2021-06-11 15:20:44
---

# äº‹ä»¶å¤„ç†å‡½æ•°

- ç»‘å®šäº‹ä»¶ï¼šç»‘å®šäº‹ä»¶çš„**å¤„ç†å‡½æ•°**
  - äº‹ä»¶æ˜¯åŸæœ¬å°±å­˜åœ¨çš„ï¼Œä¸éœ€è¦ç»‘å®šï¼Œå…¶å®æ˜¯åœ¨ç»‘å®šã€Œäº‹ä»¶è§¦å‘åã€è¦å¤„ç†çš„å‡½æ•°
- äº‹ä»¶ + äº‹ä»¶çš„åé¦ˆ = å‰ç«¯äº¤äº’

<!-- more -->

## äº‹ä»¶å¥æŸ„

æ‰€è°“çš„äº‹ä»¶å¥æŸ„å°±æ˜¯ä¸€ä¸ªå°†å…ƒç´ çš„ç‰¹å®šäº‹ä»¶ä¸æŸä¸ªå‡½æ•°å…³è”èµ·æ¥ï¼Œæ¯”å¦‚ `onclick`ã€`onmouseover` ç­‰éƒ½æ˜¯å¥æŸ„ï¼Œå®ƒä»¬ä¼šæŒ‡å‘ä¸€ä¸ªç»™å®šçš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯äº‹ä»¶å‘ç”Ÿæ—¶è¦æ‰§è¡Œçš„æ“ä½œã€‚ä¾‹å¦‚ï¼š

```javascript
div.onclick = function() {
	// todo...
}

// ğŸ‘†ğŸ» æ•´ä½“å«åš äº‹ä»¶å¥æŸ„ï¼Œå…¶ä¸­ onclick å•ç‹¬æ‹†å‡ºæ¥å« å¥æŸ„
// é€šå¸¸è¯´çš„ äº‹ä»¶å¥æŸ„çš„ç»‘å®šå½¢å¼ å°±æ˜¯ä¸Šé¢è¿™ç§å½¢å¼
```

## å¥æŸ„

ä¸Šé¢çš„ `onclick` å°±æ˜¯å¥æŸ„

## äº‹ä»¶æº

äº‹ä»¶ä½œç”¨åœ¨è°èº«ä¸Šï¼Œè°å°±æ˜¯äº‹ä»¶æºã€‚

æ¯”å¦‚ç½‘é¡µå…ƒç´ ä¸­ a æ ‡ç­¾æœ‰ `onclick` äº‹ä»¶ï¼Œå½“ç‚¹å‡» a å‘ç”Ÿ `onclick` äº‹ä»¶æ—¶ï¼Œäº‹ä»¶æºå°±æ˜¯ a æ ‡ç­¾ã€‚

## ğŸŒˆå¦‚ä½•ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°

### 1. HTMLä¸­ç›´æ¥ç»‘å®š - å†…è”/è¡Œå†…äº‹ä»¶ç›‘å¬å™¨

```html
<div onclick="test()" onmouseover="test2()"></div>
```

### 2. JS ä¸­è·å– DOM å…ƒç´ åç»‘å®š

```javascript
div.onclick = function() {};
```

#### åŒæ—¶ç»‘å®šå¤šä¸ªå¤„ç†å‡½æ•°ï¼Œåè¾¹çš„ä¼šè¦†ç›–å‰é¢çš„

```javascript
div.onclick = function() { console.log(1); };
div.onclick = function() { console.log(2); };

// åªä¼šæ‰“å° 2
<div onclick="console.log(1)">ç‚¹å‡»æˆ‘</div>
<script>
  div.onclick = function() { console.log(2); };
  
  // åªä¼šæ‰“å° 2
</script>
```

### 3. äº‹ä»¶ç›‘å¬å™¨ addEventListener(äº‹ä»¶ç±»å‹ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°, æ˜¯å¦æ•è·)

- IE9ä»¥ä¸‹ä¸å…¼å®¹ï¼ŒW3Cè§„èŒƒ
- åŒä¸€å…ƒç´ å¯ä»¥ç»‘å®šå¤šä¸ªäº‹ä»¶ï¼Œå½¼æ­¤ä¸ä¼šè¦†ç›–

```javascript
oBtn.addEventListener('click', function() {
    this.innerHTML = 'åŠ è½½ä¸­..';
}, false)
oBtn.addEventListener('click', function() {
    console.log('åŠ è½½æ›´å¤šäº‹ä»¶');
}, false)
// 2ä¸ªç»‘å®šéƒ½ä¼šæ‰§è¡Œ
oBtn.addEventListener('click', test, false);
oBtn.addEventListener('click', test, false);
function test() {
    console.log(1);
}
// åªä¼šæ‰§è¡Œä¸€æ¬¡æ‰“å°ï¼Œå› ä¸ºç»‘å®šçš„æ˜¯åŒä¸€ä¸ªå‡½æ•°å¼•ç”¨
```

### 4. attachEvent(äº‹ä»¶ç±»å‹ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°)

- IE8åŠä»¥ä¸‹
- **this æŒ‡å‘ window**
- ä¸ addEventListener ä¸åŒï¼Œç»‘å®šåŒä¸€å¼•ç”¨å€¼çš„å‡½æ•°ï¼Œç»‘å®šå‡ æ¬¡æ‰§è¡Œå‡ æ¬¡

```javascript
oBtn.attachEvent('onclick', function() {
    test.call(oBtn);
})
function test() {} // è§£å†³attachEvent ä¸­thisæŒ‡å‘é—®é¢˜
oBtn.attachEvent('onclick', test, false);
oBtn.attachEvent('onclick', test, false);
function test() {
    console.log(1);
}
// æ‰§è¡Œä¸¤æ¬¡æ‰“å°
```

## ğŸŒˆå°è£…äº‹ä»¶å¤„ç†å‡½æ•°

```javascript
function addEvent(el, type, fn) {
	if (el.addEventListener) {
  	el.addEventListener(type, fn, false);
  } else if (el.attachEvent) {
  	el.attachEvent('on' + type, function() {
    	fn.call(el);
    });
  } else {
  	el['on' + type] = fn;
  }
}
```

## ğŸŒˆè§£é™¤äº‹ä»¶ç»‘å®š

- elem.onclick = null; / elem.onclick = false;
- elem.removeEventListener(å‚æ•°éœ€è¦å’Œç»‘å®šæ—¶å€™çš„å‚æ•°å®Œå…¨ç›¸åŒ)

```javascript
oBtn.addEventListener('click', test, false);
oBtn.removeEventListener('click', test, false);

// å‡½æ•°æå‡ºæ¥
function test() {
	this.className = '';
  this.innerHTML = '';
  this.removeEventListenner('click', test, false);
}
 // ç»™åŒ¿åå‡½æ•°èµ·åå­—
oBtn.addEventListener('click', function test() {
	this.className = '';
  this.innerHTML = '';
  this.removeEventListenner('click', test, false);
})
 // éä¸¥æ ¼æ¨¡å¼ä¸‹
oBtn.addEventListener('click', function() {
	this.className = '';
  this.innerHTML = '';
  this.removeEventListenner('click', arguments.callee, false);
})
```

- elem.detachEvent(type, fn)

```javascript
oBtn.detachEvent('onclick', fn);
```

# äº‹ä»¶çš„å†’æ³¡å’Œæ•è·

## ğŸŒˆå†’æ³¡å’Œæ•è·

å­çº§ä¼šå‘çˆ¶çº§ä¼ é€’è‡ªå·±çš„äº‹ä»¶ï¼Œå¦‚æœçˆ¶çº§ä¹Ÿæœ‰ç›¸åŒäº‹ä»¶åˆ™å“åº”

- å†’æ³¡ï¼šäº‹ä»¶ä» DOM å­å…ƒç´ å‘çˆ¶çº§ä¼ é€’ï¼Œè§¦å‘çˆ¶çº§çš„ç›¸åŒç±»å‹çš„äº‹ä»¶
  - å³ä½¿å­å…ƒç´ åœ¨è§†è§‰ä¸Šä¸åœ¨çˆ¶å…ƒç´ å®¹å™¨å†…ï¼Œä¹Ÿä¼šå‘ä¸Šä¼ é€’
  - çˆ¶å…ƒç´ ä¸ç»‘å®šåŒç±»å‹äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç¥–çˆ¶ç»‘å®šï¼Œç¥–çˆ¶çš„äº‹ä»¶å¤„ç†å‡½æ•°ä»ç„¶ä¼šè§¦å‘
- æ•è·ï¼šè‡ªåµŒå¥—å…³ç³»çš„æœ€é¡¶å±‚ï¼Œå‘å­å…ƒç´ ä¼ é€’ï¼Œåˆ°äº‹ä»¶æº
- elem.addEventListener(äº‹ä»¶ç±»å‹ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œfalse) `falseäº‹ä»¶å†’æ³¡ï¼Œtrueäº‹ä»¶æ•è·`
- å…ˆæ•è·ï¼Œåå†’æ³¡ã€‚åˆ°äº‹ä»¶æºçš„æ—¶å€™ï¼ŒæŒ‰ç…§ç»‘å®šé¡ºåºæ‰§è¡Œ
  - æ–°ç‰ˆchromeäº‹ä»¶æºä¸å†æ ¹æ®ç»‘å®šé¡ºåºæ‰§è¡Œï¼Œè€Œæ˜¯ç»Ÿä¸€å˜æˆå…ˆæ•è·åå†’æ³¡ï¼Œå‚è€ƒhttps://juejin.cn/post/6965682915141386254
  - åˆ°äº‹ä»¶æºçš„æ—¶å€™ï¼Œå¤„äºtargeté˜¶æ®µï¼Œæ²¡æœ‰æ•è·orå†’æ³¡çš„è¯´æ³•ã€‚æ‰€ä»¥ä¸ç”¨careæ‰§è¡Œé¡ºåºã€‚ä»£ç å±‚é¢ä¸Šæ³¨æ„ä¸‹å°±è¡Œï¼Œæœ€å¥½å…ˆå†™æ•è·å†å†™å†’æ³¡

```html
<style>
  .wrapper {
    width: 150px;
    height: 150px;
    background-color: aqua;
  }
  .outer {
    width: 100px;
    height: 100px;
    margin-left: 150px;
    background-color: bisque;
  }
  .inner {
    width: 75px;
    height: 75px;
    margin-left: 100px;
    background-color: blueviolet;
  }
</style>

<div class="wrapper">
  <div class="outer">
    <div class="inner"></div>
	</div>
</div>

<script>
var wrapper = document.getElementsByClassName('wrapper')[0];
var outer = document.getElementsByClassName('outer')[0];
var inner = document.getElementsByClassName('inner')[0];
  
wrapper.addEventListener('click', function() {
	console.log('wrapper-å†’æ³¡');
}, false);
outer.addEventListener('click', function() {
	console.log('outer-å†’æ³¡');
}, false);
inner.addEventListener('click', function() {
	console.log('inner-å†’æ³¡');
}, false);

wrapper.addEventListener('click', function() {
	console.log('wrapper-æ•è·');
}, true);
outer.addEventListener('click', function() {
	console.log('outer-æ•è·');
}, true);
inner.addEventListener('click', function() {
	console.log('inner-æ•è·');
}, true);
</script>
```

æ–°ç‰ˆchromeï¼š

{% asset_img 1632639222884-fee3051f-4200-43fa-8d9d-c362590e14f8.png 100% %}

æ—§ç‰ˆchromeå’Œæ–°æ—§ç‰ˆFirefoxã€Safariéƒ½è¿˜æ˜¯é¡ºåºæ‰§è¡Œï¼š

{% asset_img 1632639286601-dd886cf5-ef43-46b0-84f4-93ea044fc4a2.png 100% %}

- focus blur change submit reset select æ²¡æœ‰å†’æ³¡
- è€ç‰ˆæœ¬IEæ²¡æœ‰æ•è·

## ğŸŒˆé˜»æ­¢äº‹ä»¶å†’æ³¡

### w3c: e.stopPropagation(); -> Event.prototype

```javascript
oDiv.addEventListener('click', function(e) {
	var e = e || window.event;
  e.stopPropagation(); 
}, false);
```

### IE: e.cancelBubble = true;

```javascript
oDiv.addEventListener('click', function(e) {
	var e = e || window.event;
  e.cancelBubble = true;
}, false)
```

### å°è£…

```javascript
function cancelBubble(e) {
  var e = e || window.event;
  if (e.stopPropagation) {
    e.stopPropagation();
  } else {
    e.cancelBubble = true;
  }
}
```

### æ¡ˆä¾‹

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <style>
    .wrapper {
      position: relative;
      width: 300px;
      height: 300px;
      background-color: green;
    }

    .apply {
      position: absolute;
      bottom: 15px;
      right: 15px;  
      width: 80px;
      height: 30px;
      background-color: red;
      color: #fff;
      line-height: 30px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="apply">ç«‹å³ç”³è¯·</div>
  </div>

  <script type="text/javascript">
  // w3c: e.stopPropagation(); -> Event.prototype
  // IE: e.cancelBubble = true;
  var wrapper = document.getElementsByClassName("wrapper")[0],
      apply = document.getElementsByClassName("apply")[0];

  wrapper.addEventListener("click", function() {
    console.log("è¿›å…¥è¯¦æƒ…");
  }, false);
  apply.addEventListener("click", function(e) {
    console.log("ç«‹å³ç”³è¯·");
    cancelBubble(e);
  }, false);

  // å–æ¶ˆå†’æ³¡
  function cancelBubble(e) {
    var e = e || window.event;
    if (e.stopPropagation) {
      e.stopPropagation();
    } else {
      e.cancelBubble = true;
    }
  }
  </script>
</body>
</html>
```

## ğŸŒˆå–æ¶ˆé»˜è®¤äº‹ä»¶

### å–æ¶ˆå³é”®èœå•

#### return false ï¼ˆä¸æ”¯æŒ addEventListener ä¸­ä½¿ç”¨ï¼‰

```javascript
document.oncontextmenu = function(e) {
	var e = e || window.event;
  return false;
}
```

#### e.preventDefault() ï¼ˆIE9ä¸å…¼å®¹ï¼‰ï¼š

```javascript
document.oncontextmenu = function(e) {
	var e = e || window.event;
  e.preventDefault();
}
```

#### e.returnValue = false; ï¼ˆIE9ä»¥ä¸‹ï¼‰ï¼š

```javascript
document.oncontextmenu = function(e) {
	var e = e || window.event;
  e.returnValue = false
}
```

### é˜»æ­¢ a æ ‡ç­¾è·³è½¬

- `href="javascript:;"`
- `href="javascript: void(0)"` ==> `void(0) ç­‰äº return 0`
- `e.preventDefault()`

```javascript
<a href="">hh</a>
a.onclick = function(e) {
	e.preventDefault();
}
```

# äº‹ä»¶æµ

- æè¿°ä»é¡µé¢ä¸­æ¥æ”¶äº‹ä»¶çš„é¡ºåºï¼Œ å†’æ³¡ï¼Œ æ•è·
- IE æå‡ºçš„ äº‹ä»¶å†’æ³¡æµ ï¼ˆEvent Bubblingï¼‰
- Netscape æå‡ºçš„ äº‹ä»¶æ•è·æµ ï¼ˆEvent Capturingï¼‰

## äº‹ä»¶æµæœ‰ä¸‰ä¸ªé˜¶æ®µ

- äº‹ä»¶æ•è·é˜¶æ®µ
- å¤„äºç›®æ ‡é˜¶æ®µ - ä»£ç æŒ‰å…ˆåé¡ºåºæ‰§è¡Œï¼ˆ**æ–°ç‰ˆchromeå…ˆæ•è·åå†’æ³¡**ï¼‰
- äº‹ä»¶å†’æ³¡é˜¶æ®µ

## ğŸŒˆDOMåˆ†çº§

- DOM 0

- - `onclick = ""`
  - `ele.onclick = function() {}`
  - `onmouseover`
  - `onXXX`
- DOM 1
  - æ²¡æœ‰å®šä¹‰äº‹ä»¶æ¨¡å‹
- DOM 2
  - addEventListener(3ä¸ªå‚æ•°) -> W3Cè§„èŒƒ
  - removeEventListener

ä¸‰ä¸ªçº§åˆ«æ²¡æœ‰é‡è¦ä¹‹åˆ†ï¼Œå¯ä»¥çœ‹æˆä¸åŒæ—¶æœŸå®šä¹‰çš„æ–°çš„ä½¿ç”¨æ–¹æ¡ˆ

## ğŸŒˆäº‹ä»¶å¯¹è±¡

### ä¸åŒæµè§ˆå™¨åŒºåˆ«

**targetã€srcElement** äº‹ä»¶æºå¯¹è±¡

- FFç«ç‹åªæœ‰ target
- IE åªæœ‰ srcElement
- Chrome ä¸¤è€…å…¼æœ‰

### å…¼å®¹æ€§

```javascript
wrapper.onclick = function(e) {
  var target = e.target || e.srcElement;
	console.log(e);
}
```

# ğŸŒˆäº‹ä»¶ä»£ç†/å§”æ‰˜

## æ¡ˆä¾‹ - åŠ¨æ€æ·»åŠ liå…ƒç´ æ·»åŠ äº‹ä»¶

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº‹ä»¶å§”æ‰˜/ä»£ç†</title>
  <style>
    ul {
      margin: 0;
      padding: 20px;
      list-style: none;
      background-color: pink;
    }
  </style>
</head>
<body>
  <ul>
    <li>1</li>
    <li>2</li>
    <li>3</li>
    <li>4</li>
    <li>5</li>
  </ul>
  <button onclick="addLiEle()">æ·»åŠ  li å…ƒç´ </button>
  <script>
    var oUl = document.getElementsByTagName('ul')[0],
        oLis = document.getElementsByTagName('li');
    oUl.addEventListener('click', function(e) {
      var event = e || window.event,
          target = event.target || event.srcElement;
      if (target.tagName.toLowerCase() === 'li') {
        var index = Array.prototype.indexOf.call(oLis, target);
        console.log(oLis[index]);
      }
    }, false);

    function addLiEle() {
      var oLi = document.createElement('li');
      var oUl = document.getElementsByTagName('ul')[0];
      oLi.innerText = ++oUl.childElementCount;
      oUl.appendChild(oLi);
    }
  </script>
</body>
</html>
```

{% asset_img 1641182400299-a229fd28-1150-4886-a0e8-f906bf932438.png 100% %}


# äº‹ä»¶

- äº‹ä»¶è§¦å‘æ—¶é‚£ä¸€åˆ»ï¼Œæ‰€æœ‰ç›¸å…³ä¿¡æ¯å’Œæ–¹æ³•çš„é›†åˆ
  - chromeï¼šæœ€å¤–å±‚å¤šäº†ä¸ª pointerEvent
  - å…¶ä»–æµè§ˆå™¨ï¼šæœ€å¤–å±‚æ˜¯ mouseEvent

```javascript
var container = document.querySelector('.container');
container.addEventListener('click', function(e) {
  console.log(e);
});

// [pointerEvent]PointerEvent ->
// MouseEvent.prototype ->
// UIEvent.prototype ->
// Event.prototype ->
// Object.prototype
```

{% asset_img 1641183643594-8c3d1c4f-06bc-41c4-b3d2-362445f2dc0b.png 100% %}

## ğŸŒˆevent.target å’Œ event.currentTarget çš„åŒºåˆ«

- target 		å½“å‰è§¦å‘äº‹ä»¶çš„å…ƒç´ 
- currentTarget 	ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°çš„å…ƒç´ 

{% asset_img 1641183948897-88cffca4-b291-4cd7-a3a9-1e7126323a7f.png 100% %}

{% asset_img 1641183953892-8e1394da-b7ca-434c-95a8-60d32528fd5b.png 100% %}

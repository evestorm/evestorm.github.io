<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>APFS、Mac OS 扩展、ExFAT格式有何区别</title>
    <url>/posts/33677/</url>
    <content><![CDATA[<h2 id="APFS"><a href="#APFS" class="headerlink" title="APFS"></a><strong>APFS</strong></h2><p>是<strong>Apple 苹果系统特有的一种文件格式</strong>，是 Mac OS High Sierra 操作系统版本时发布的；这种文件格式只能苹果 Mac OS 操作系统使用。（必须至少是 Mac OS High Sierra 版本以及更新的 Mac OS 才行，老版本的苹果系统不支持）这种系统非常牛逼，主要是<strong>针对 PCIe 闪存和 SSD 固态硬盘进行了优化</strong>；如果你是使用固态硬盘，且<strong>不考虑硬盘上的东西在 Windows 操作系统中使用，那推荐使用 APFS 硬盘格式</strong>。</p>
<h2 id="Mac-OS-扩展格式"><a href="#Mac-OS-扩展格式" class="headerlink" title="Mac OS 扩展格式"></a><strong>Mac OS 扩展格式</strong></h2><p>Mac OS Extended 是以前苹果 Mac OS 使用的文件系统，现在基本上已经淘汰了。能用 APFS 就尽量使用 APFS，与其考虑<strong>兼容旧版的 Mac OS</strong>，不如让更新旧版的 Mac OS 系统。</p>
<h2 id="Mac-OS-日志格式"><a href="#Mac-OS-日志格式" class="headerlink" title="Mac OS 日志格式"></a><strong>Mac OS 日志格式</strong></h2><p>Mac OS 操作系统有一个自带的硬盘备份工具，叫 Time Machine（时间机器）；这种硬盘格式就是<strong>专门用于 Time Machine</strong>。如果是要<strong>把这个硬盘作为备份盘</strong>，那就格式化成这种硬盘格式。</p>
<h2 id="ExFAT"><a href="#ExFAT" class="headerlink" title="ExFAT"></a><strong>ExFAT</strong></h2><p>上面说的三种硬盘格式都是专门用于苹果的 Mac OS 操作系统的，而 ExFAT 则是不仅可用于 Mac OS 苹果操作系统，还可以用于 Windows 操作系统。<strong>如果你想该硬盘的东西在 Windows 系统可以被读取，那就选择 ExFAT 操作系统</strong>。</p>
]]></content>
      <categories>
        <category>操作系统</category>
        <category>macOS</category>
      </categories>
      <tags>
        <tag>macOS</tag>
      </tags>
  </entry>
  <entry>
    <title>Axios异步请求跨域解决方案</title>
    <url>/posts/29963/</url>
    <content><![CDATA[<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p>后端 127.0.0.1（默认 80）；前端 127.0.0.1:8081</p>
</blockquote>
<p>在 vue 开发过程中使用 axios 发起 POST 请求：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">  method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;http://127.0.0.1&#x27;</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>会报跨域错误：</p>
<p><a href="https://gitee.com/evestorm/various_resources/raw/master/ajax/%E8%B7%A8%E5%9F%9F.png"><img src="Axios%E5%BC%82%E6%AD%A5%E8%AF%B7%E6%B1%82%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/%E8%B7%A8%E5%9F%9F.png" alt="跨域"></a></p>
<p>原因是浏览器同源策略，只有 <strong>同协议、同域名、同端口</strong> 三同的地址才能互相通过 AJAX 的方式请求。而上面情形虽然协议（http）和域名（127.0.0.1）都相同，但端口不同（80 和 8081），所以无法正常请求。</p>
<a id="more"></a>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>服务端添加响应头，以 Koa 为例，在 <code>app.js</code> 中添加响应头：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.set(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样设置会允许任何来源（*）的跨域。</p>
<p>但往往后端的某些接口是需要身份验证的，比如用户对文章、商品之类的进行评论或点赞，就需要用户登录才能操作。这种情况下就需要使用到 cookie 或者 session ，所以还得设置 <code>Access-Control-Allow-Credentials</code> 为 true ，表示在 CORS 请求中允许客户端发送 cookie 。然而一旦这样设置，<code>Access-Control-Allow-Origin</code> 就不能再是通配符 <code>*</code> ，必须指定具体的域，所以服务端最终的 header 设置为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.set(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:8081&#x27;</span>);</span><br><span class="line">  ctx.set(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>后端这样设置后，前端就能够实现跨域请求了。</p>
<h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p>如果服务端不加 <code>ctx.set(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</code> 这一段。可以在 <code>@vue-cli</code> 中 <a href="https://cli.vuejs.org/zh/config/#devserver-proxy">配置代理</a> 。也就是 <strong>前端设置代理</strong> 的解决方案。</p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>利用后端不存在跨域问题，而让 vue 服务器代为获取数据。因为启动 vue 项目本质上也是用 node 启了个服务器（127.0.0.1:8080），配置了代理后，就不再是浏览器直接请求我们在 axios 中配置的 <a href="http://127.0.0.1/%EF%BC%88%E9%BB%98%E8%AE%A480%E7%AB%AF%E5%8F%A3%EF%BC%89">http://127.0.0.1/（默认80端口）</a> ，而是用 vue 启动的这个服务器去请求 <a href="http://127.0.0.1/">http://127.0.0.1/</a> 这个接口，由于后端相互之前请求不存在跨域问题，所以能获取数据，获取后给到前端。</p>
<p>在前端项目根目录下新建 <code>vue.config.js</code> 文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="comment">// 前端 axios 发这样的请求：http://127.0.0.1:8081/api/ (8081是启动vue项目时的端口)，会被此处捕获，然后代为请求真正的服务器API地址 `http://127.0.0.1`</span></span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        target: <span class="string">&#x27;http://127.0.0.1&#x27;</span>, <span class="comment">// 此处是服务端API接口，不写端口默认80</span></span><br><span class="line">        changeOrigin: <span class="literal">true</span>,</span><br><span class="line">        pathRewrite: &#123;</span><br><span class="line">          <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="前端发送-POST-跨域请求"><a href="#前端发送-POST-跨域请求" class="headerlink" title="前端发送 POST 跨域请求"></a>前端发送 POST 跨域请求</h3><p>上面也提到了，前端有时候往往不止需要发送 GET 请求，POST 请求也是常有的事儿。所以还需要对 Axios 进行如下配置：</p>
<blockquote>
<p>vue 项目下的 main.js 中全局配置 axios</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line">axios.defaults.baseURL = <span class="string">&#x27;http://127.0.0.1&#x27;</span>;</span><br><span class="line">axios.defaults.withCredentials = <span class="literal">true</span>; <span class="comment">// 让 ajax 携带 cookie</span></span><br><span class="line">axios.defaults.headers.post[<span class="string">&#x27;Content-Type&#x27;</span>] =</span><br><span class="line">  <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>; <span class="comment">// 设置post请求的头部格式</span></span><br><span class="line"></span><br><span class="line">Vue.prototype.$ajax = axios;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于需要把请求时的数据序列化为 url 的形式，所以要下载 qs 包</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i qs</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在具体页面中发送 POST 请求</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">&#x27;qs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> loginInfo = &#123;</span><br><span class="line">    username: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    password: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="built_in">this</span>.$ajax(&#123;(&#123;</span><br><span class="line">    method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;http://127.0.0.1/login&#x27;</span>,</span><br><span class="line">    data: qs.stringify(login_info),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>axios</tag>
        <tag>跨域</tag>
      </tags>
  </entry>
  <entry>
    <title>BFC的理解与应用</title>
    <url>/posts/9722/</url>
    <content><![CDATA[<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>先上MDN上对 BFC 的定义：</p>
<blockquote>
<p>块格式化上下文（Block Formatting Context，BFC） 是Web页面的可视化CSS渲染的一部分，是块盒子的布局过程发生的区域，也是浮动元素与其他元素交互的区域。</p>
</blockquote>
<p>———— <a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context">BFC | MDN</a></p>
<p>不知道别人看完这段定义有何感受，反正我是懵逼的。不过我在这儿还是建议各位认真阅读上面给出的MDN链接至少两遍，这能让你对一个陌生的概念有一个基本的认知。</p>
<a id="more"></a>

<h2 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h2><p>这里谈下我对BFC的理解：BFC其实是一个独立的，与外界隔离了的容器，容器里面的子元素不会影响到外面的元素，外面的也同样不会影响到容器内部的元素。我们可以利用这个特性，来解决一些布局上的问题。</p>
<h2 id="BFC触发条件"><a href="#BFC触发条件" class="headerlink" title="BFC触发条件"></a>BFC触发条件</h2><p>BFC的触发条件有很多，想要知道所有细节可以移步上面给出的 MDN 链接。这里我只列出一些常见触发条件：</p>
<ul>
<li>根元素（HTML元素）</li>
<li>浮动元素（float不为none）</li>
<li>绝对定位元素（position 为 absolute 或 fixed）</li>
<li>display 为 block, inline-block, flex, inline-flex, list-item, table</li>
<li>overflow 值不为 visible 的块元素</li>
</ul>
<h2 id="BFC布局特性"><a href="#BFC布局特性" class="headerlink" title="BFC布局特性"></a>BFC布局特性</h2><p>对于一个BFC容器来说：</p>
<ul>
<li>内部相邻的两个元素垂直方向上的 margin 会发生重叠</li>
<li>不会与外界的浮动元素产生交集，而是紧贴浮动元素的边缘</li>
<li>元素从容器的顶端开始垂直地一个接一个地排列</li>
<li>每一个元素的左外边缘（margin-left）会触碰到容器的左边缘（border-left）（如果设置了容器内部的元素从右到左的格式排布，则触碰的是右边缘）</li>
<li>在计算它的高度时，还会检测内部浮动或者定位元素的高度</li>
</ul>
<h2 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h2><h3 id="清除浮动"><a href="#清除浮动" class="headerlink" title="清除浮动"></a>清除浮动</h3><p>利用BFC “在计算它的高度时，还会检测内部浮动或者定位元素的高度” 这条特性，我们可以触发父元素的BFC来清除子元素浮动带来的影响。常见的用法是给父元素设置 <code>overflow: hidden</code> 样式（如果考虑IE6版本，还需设置 <code>zoom: 1</code>，因为IE6不支持 <code>overflow: hidden</code> 来清除浮动）：</p>
<iframe height="265" scrolling="no" title="利用BFC清除浮动" src="https://codepen.io/JingW/embed/BbxEGP/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="解决外边距合并问题"><a href="#解决外边距合并问题" class="headerlink" title="解决外边距合并问题"></a>解决外边距合并问题</h3><p>如果看上面标题不知道在说什么，请很戳<a href="http://www.w3school.com.cn/css/css_margin_collapsing.asp">这里</a>了解详情。由于属于同一个BFC的两个相邻盒子的垂直margin会发生重叠，那么我们可以隔离开这两个元素，让它们不属于同一个BFC，这样就不会发生margin重叠了。</p>
<iframe height="265" scrolling="no" title="解决外边距合并问题" src="https://codepen.io/JingW/embed/YgLbzY/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="两栏布局，右边宽度自适应"><a href="#两栏布局，右边宽度自适应" class="headerlink" title="两栏布局，右边宽度自适应"></a>两栏布局，右边宽度自适应</h3><p>我们常常在开发中有这样类似的需求：两栏布局，左边定宽，右边自适应。<br>这时我们就可以利用BFC特性来实现需求：左边设置定宽+左浮动；右边给自己加上 <code>overflow: hidden</code> 。<br>原理就是：给元素设置BFC后，为了和浮动元素不产生任何交集，它会顺着浮动元素的边缘形成自己的封闭上下文。直接上代码看效果：</p>
<iframe height="265" scrolling="no" title="利用BFC实现两栏布局" src="https://codepen.io/JingW/embed/MxGdEe/?height=265&amp;theme-id=0&amp;default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<p>以上是我对BFC的一些理解以及实际应用，希望能够帮助大家了解BFC这个听起来摸不着头脑的东西。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>布局</tag>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-CORS详解</title>
    <url>/posts/28096/</url>
    <content><![CDATA[<h2 id="转载文章"><a href="#转载文章" class="headerlink" title="转载文章"></a>转载文章</h2><p>博客源：<a href="https://github.com/hstarorg/HstarDoc/blob/master/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/CORS%E8%AF%A6%E8%A7%A3.md">CORS 详解</a></p>
<h2 id="关于-CORS"><a href="#关于-CORS" class="headerlink" title="关于 CORS"></a>关于 CORS</h2><p>说到 CORS，就不得不先了解跨站 HTTP 请求（Cross-site HTTP request）。</p>
<p>跨域 HTTP 请求是指发起请求的资源所在域不同于该请求所指向资源所在的域的 HTTP 请求。</p>
<p>正如大家所知，出于安全考虑，浏览器会限制脚本中发起的跨站请求。使用 XMLHttpRequest 发起 HTTP 请求必须遵守同源策略。 具体而言，Web 应用程序能且只能使用 XMLHttpRequest 对象向其加载的源域名发起 HTTP 请求，而不能向任何其它域名发起请求。</p>
<p>由于 Web 应用技术越来越丰富，我们非常渴望在不丢失安全的前提下，能够实现跨站请求。特别是现在的 Web 程序结构，一般是 HTML+REST API。在之前的实现中，我们一般采用 jsonp 来发起跨站请求，这其实是利用了 html 标签的特点。</p>
<p>W3C 的 Web 应用工作组推荐了一种新的机制，即跨域资源共享（Cross-Origin Resource Sharing），也就是当前我们提到的 CORS。</p>
<p>CORS 的核心，就是让服务器来确定是否允许跨域访问。</p>
<a id="more"></a>

<h2 id="1、典型场景"><a href="#1、典型场景" class="headerlink" title="1、典型场景"></a>1、典型场景</h2><h3 id="1-1、简单请求"><a href="#1-1、简单请求" class="headerlink" title="1.1、简单请求"></a>1.1、简单请求</h3><p>什么是简单请求？全部满足以下条件的请求可以称之为简单请求：</p>
<ol>
<li>只使用 GET、HEAD 或者 POST 请求方法。如果是 POST，则数据类型（Content-Type）只能是<code>application/x-www-form-urlencodeed</code>、<code>multipart/form-data</code>、<code>text/plain</code>中的一种。</li>
<li>没有使用自定义的请求头（如 x-token）</li>
</ol>
<p>按照这个规则，那我们的能实现跨域请求的情况如下：</p>
<p>Server 代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//之后设置了Access-Control-Allow-Origin，才会允许跨域</span></span><br><span class="line">  res.setHeader(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">  res.write(<span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line">  res.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">10000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;started.&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Client 代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (xhr.readyState === XMLHttpRequest.DONE) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Result：&#x27;</span>, xhr.responseText);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//场景一：GET请求，不需要Header，允许跨域</span></span><br><span class="line">xhr.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://localhost:10000/&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.send();</span><br><span class="line"></span><br><span class="line"><span class="comment">//场景二： POST请求，需要设置为指定Header（不设置content-type也可），允许跨域</span></span><br><span class="line">xhr.open(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:10000/&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">//此处value必须是text/plain或者application/x-www-form-urlencoded或者multipart/form-data。</span></span><br><span class="line"><span class="comment">//此处也可以不设置</span></span><br><span class="line">xhr.setRequestHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>);</span><br><span class="line">xhr.send();</span><br><span class="line"></span><br><span class="line"><span class="comment">//场景三：DELETE请求（不允许跨域）</span></span><br><span class="line">xhr.open(<span class="string">&#x27;DELETE&#x27;</span>, <span class="string">&#x27;http://localhost:10000/&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.send();</span><br><span class="line"></span><br><span class="line"><span class="comment">//场景四：POST请求，有自定义Header（不允许跨域）</span></span><br><span class="line">xhr.open(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:10000/&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.setRequestHeader(<span class="string">&#x27;x-token&#x27;</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>

<h3 id="1-2、预请求"><a href="#1-2、预请求" class="headerlink" title="1.2、预请求"></a>1.2、预请求</h3><p>不同于简单请求，预请求要求必须先发送一个 OPTIONS 请求给站点，来查明该站点是否允许跨域请求，这样做的原因是为了避免跨站请求可能对目的站点的数据造成的损坏。</p>
<p>如果请求满足以下任一条件，则会产生预请求：</p>
<ol>
<li>请求以 GET、HEAD、POST 之外的方法发起。或者，使用 POST，但数据类型为<code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code> 或者 <code>text/plain</code> 以外的数据类型。（注：之前的版本只有 text/plain 可以不用发起预请求）。</li>
<li>使用了自定义请求头。</li>
</ol>
<p>按照如上规则，我们来列举几个应用场景：</p>
<p>Server 端代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//之后设置了Access-Control-Allow-Origin，才会允许跨域</span></span><br><span class="line">  res.setHeader(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">  res.setHeader(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;POST, DELETE, GET&#x27;</span>);</span><br><span class="line">  res.setHeader(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;x-token&#x27;</span>);</span><br><span class="line">  <span class="comment">//设置预请求缓存1天，1天内再次请求，可以跳过预请求</span></span><br><span class="line">  <span class="comment">//此功能需要客户端缓存支持，如果客户端禁用缓存，那么每次都会预请求</span></span><br><span class="line">  res.setHeader(<span class="string">&#x27;Access-Control-Max-Age&#x27;</span>, <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>);</span><br><span class="line">  res.write(<span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line">  res.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">10000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;started.&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Client 端代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (xhr.readyState === XMLHttpRequest.DONE) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Result：&#x27;</span>, xhr.responseText);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//场景一：DELETE请求，发送OPTIONS，匹配，允许跨域</span></span><br><span class="line">xhr.open(<span class="string">&#x27;DELETE&#x27;</span>, <span class="string">&#x27;http://localhost:10000/&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.send();</span><br><span class="line"></span><br><span class="line"><span class="comment">//场景二：PUT请求，发送OPTIONS，不匹配，不允许跨域</span></span><br><span class="line">xhr.open(<span class="string">&#x27;PUT&#x27;</span>, <span class="string">&#x27;http://localhost:10000/&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.send();</span><br><span class="line"></span><br><span class="line"><span class="comment">//场景三：DELETE请求匹配，使用自定义Header不匹配，不允许跨域</span></span><br><span class="line">xhr.open(<span class="string">&#x27;DELETE&#x27;</span>, <span class="string">&#x27;http://localhost:10000/&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.setRequestHeader(<span class="string">&#x27;x-token1&#x27;</span>, <span class="string">&#x27;aa&#x27;</span>);</span><br><span class="line">xhr.send();</span><br><span class="line"></span><br><span class="line"><span class="comment">//场景四：POST请求，匹配的自定义Header，允许跨域</span></span><br><span class="line">xhr.open(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:10000/&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.setRequestHeader(<span class="string">&#x27;x-token&#x27;</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>

<h3 id="1-3、带凭证的请求"><a href="#1-3、带凭证的请求" class="headerlink" title="1.3、带凭证的请求"></a>1.3、带凭证的请求</h3><p>一般来说，对于跨站请求，浏览器是不会发送凭证（HTTP Cookies 和验证信息）的。如果要发送带凭证的信息，只需要给 XMLHttpRequest 设置一个特殊的属性<code>withCredentials = true</code>，通过这种方式，浏览器就允许发送凭证信息。</p>
<p>带凭证的请求可能是简单请求，也可以是会有预请求。是否允许跨域，会先判断简单请求和预请求的规则，然后还会带上带凭证的请求自己的规则。</p>
<p>在带凭证的请求中，后端的响应必须包含 Header<code>Access-Control-Allow-Credentials=true</code>，同时 Header <code>Access-Control-Allow-Origin</code>，不能再使用*号这种匹配符。</p>
<p>具体示例如下：</p>
<p>服务端代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//要处理带凭证的请求，此Header不能使用*。</span></span><br><span class="line">  res.setHeader(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;http://10.16.85.170:8000&#x27;</span>);</span><br><span class="line">  res.setHeader(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;POST, DELETE, GET&#x27;</span>);</span><br><span class="line">  res.setHeader(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;x-token&#x27;</span>);</span><br><span class="line">  res.setHeader(<span class="string">&#x27;Access-Control-Max-Age&#x27;</span>, <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>);</span><br><span class="line">  <span class="comment">//只有设置了该Header，才允许带凭证的请求。</span></span><br><span class="line">  res.setHeader(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">  res.write(<span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line">  res.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">10000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;started.&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>客户端代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (xhr.readyState === XMLHttpRequest.DONE) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Result：&#x27;</span>, xhr.responseText);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//优先满足预请求，然后满足凭证请求，允许跨域。</span></span><br><span class="line">xhr.open(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:10000/&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.withCredentials = <span class="literal">true</span>;</span><br><span class="line">xhr.setRequestHeader(<span class="string">&#x27;x-token&#x27;</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>

<h2 id="2、HTTP-响应头"><a href="#2、HTTP-响应头" class="headerlink" title="2、HTTP 响应头"></a>2、HTTP 响应头</h2><h3 id="2-1、-后端-HTTP-响应头"><a href="#2-1、-后端-HTTP-响应头" class="headerlink" title="2.1、 后端 HTTP 响应头"></a>2.1、 后端 HTTP 响应头</h3><p>此处列举后端有关 CORS 的响应头：</p>
<ol>
<li>Access-Control-Allow-Origin： | _允许的域名，只能有一个值。比如“_”或“abc.com”，”a.com,b.com”这种不允许</li>
<li>Access-Control-Expose-Headers: 允许的白名单 Header，多个用逗号隔开</li>
<li>Access-Control-Max-Age: 预请求缓存时间，单位秒，<strong>禁用缓存</strong>时无效哦！</li>
<li>Access-Control-Allow-Credentials: true | false 是否允许带凭证的请求，如果为 true，则 Origin 只能是具体的值</li>
<li>Access-Control-Allow-Methods: 允许的请求类型，多个用逗号隔开</li>
<li>Access-Control-Allow-Headers: 在实际请求中，允许的自定义 header，多个用逗号隔开</li>
</ol>
<h3 id="2-2、-浏览器发出跨域请求的响应头"><a href="#2-2、-浏览器发出跨域请求的响应头" class="headerlink" title="2.2、 浏览器发出跨域请求的响应头"></a>2.2、 浏览器发出跨域请求的响应头</h3><p>此处列举出浏览器在发送跨域请求时，会带上的响应头：</p>
<ol>
<li>Origin: 告诉服务器，请求来自哪里，仅仅是服务器名，不包含路径。</li>
<li>Access-Control-Request-Method: 预请求时，告诉服务器实际的请求方式</li>
<li>Access-Control-Request-Headers: 预请求时，告诉服务器，实际请求所携带的自定义 Header</li>
</ol>
<h2 id="3、参考资料"><a href="#3、参考资料" class="headerlink" title="3、参考资料"></a>3、参考资料</h2><ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#Preflighted_requests">MDN HTTP access control (CORS)</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">MDN HTTP 访问控制(CORS)</a></li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
        <category>浏览器</category>
        <category>跨域</category>
      </categories>
      <tags>
        <tag>跨域</tag>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-CSS3伪元素实现自定义复选框</title>
    <url>/posts/3583/</url>
    <content><![CDATA[<p>我们都知道原生的复选框控件样式极难自定义，这对于工程师实现设计稿的难度加大了一大截。css3 的出现，增加了:checked 选择器，因此我们可以利用:checked 和 label 来实现各式各样的表单选择控件，接下来让我们来看看如何实现吧！</p>
<a id="more"></a>

<p>我们来看看如何实现上述自定义的复选框：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.check-wrap</span> &#123;</span></span><br><span class="line">    text-align: center;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.checkbox</span> &#123;</span></span><br><span class="line">    position: absolute;</span><br><span class="line">    clip: rect(0, 0, 0, 0);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.checkbox</span><span class="selector-attr">[type=<span class="string">&#x27;checkbox&#x27;</span>]</span><span class="selector-pseudo">:focus</span> + <span class="selector-tag">label</span><span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">box-shadow</span>: 0 0 0.6<span class="selector-tag">em</span> <span class="selector-id">#06c</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.checkbox</span><span class="selector-attr">[type=<span class="string">&#x27;checkbox&#x27;</span>]</span> + <span class="selector-tag">label</span><span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line">    content: &#x27;\a0&#x27;; /* 不换行空格 */</span><br><span class="line">    display: inline-block;</span><br><span class="line">    margin-right: 0.3em;</span><br><span class="line">    width: 2em;</span><br><span class="line">    height: 2em;</span><br><span class="line">    border-radius: 0.3em;</span><br><span class="line">    vertical-align: middle;</span><br><span class="line"><span class="css">    <span class="selector-tag">line-height</span>: 2<span class="selector-tag">em</span>; <span class="comment">/* 关键 */</span></span></span><br><span class="line">    font-size: 20px;</span><br><span class="line">    text-align: center;</span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">    background: gray;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.checkbox</span><span class="selector-attr">[type=<span class="string">&#x27;checkbox&#x27;</span>]</span><span class="selector-pseudo">:checked</span> + <span class="selector-tag">label</span><span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line">    content: &#x27;\2713&#x27;; /* 对勾 */</span><br><span class="line">    background: black;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  label &#123;</span><br><span class="line">    margin-right: 40px;</span><br><span class="line">    font-size: 20px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;check-wrap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;check-1&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;check-1&quot;</span>&gt;</span>生男孩<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;check-2&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;check-2&quot;</span>&gt;</span>生女孩<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>这里为了隐藏原生的 checkbox 控件，我们用了 clip: rect(0,0,0,0)进行截取，然后使用 checkbox 的伪类:checked 来实现交互。</p>
<p>接下来扩展一下，我们来实现自定义开关：</p>


<p>这里原理是一样的，只不过样式做了改动，直接上代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.check-wrap</span> &#123;</span></span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">    text-align: center;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.switch</span> &#123;</span></span><br><span class="line">    position: absolute;</span><br><span class="line">    clip: rect(0, 0, 0, 0);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.switch</span><span class="selector-attr">[type=<span class="string">&#x27;checkbox&#x27;</span>]</span> + <span class="selector-tag">label</span> &#123;</span></span><br><span class="line">    width: 6em;</span><br><span class="line">    height: 3em;</span><br><span class="line">    padding: 0.3em;</span><br><span class="line">    border-radius: 0.3em;</span><br><span class="line">    border: 1px solid rgba(0, 0, 0, 0.2);</span><br><span class="line">    vertical-align: middle;</span><br><span class="line"><span class="css">    <span class="selector-tag">line-height</span>: 2<span class="selector-tag">em</span>; <span class="comment">/* 关键 */</span></span></span><br><span class="line">    font-size: 20px;</span><br><span class="line">    text-align: center;</span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">    box-shadow: 0 1px white inset;</span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#ccc</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background-image</span>: <span class="selector-tag">linear-gradient</span>(<span class="selector-id">#ddd</span>, <span class="selector-id">#bbb</span>);</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.switch</span><span class="selector-attr">[type=<span class="string">&#x27;checkbox&#x27;</span>]</span><span class="selector-pseudo">:checked</span> + <span class="selector-tag">label</span> &#123;</span></span><br><span class="line">    box-shadow: 0.05em 0.1em 0.2em rgba(0, 0, 0, 0.6) inset;</span><br><span class="line">    border-color: rgba(0, 0, 0, 0.3);</span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#bbb</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  label &#123;</span><br><span class="line">    margin-right: 40px;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.switch-an</span> &#123;</span></span><br><span class="line">    position: absolute;</span><br><span class="line">    clip: rect(0, 0, 0, 0);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.switch-an</span><span class="selector-attr">[type=<span class="string">&#x27;checkbox&#x27;</span>]</span> + <span class="selector-tag">label</span> &#123;</span></span><br><span class="line">    position: relative;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    width: 5em;</span><br><span class="line">    height: 2em;</span><br><span class="line">    border-radius: 1em;</span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#06c</span>;</span></span><br><span class="line">    text-align: left;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.switch-an</span><span class="selector-attr">[type=<span class="string">&#x27;checkbox&#x27;</span>]</span> + <span class="selector-tag">label</span><span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line">    content: &#x27;&#x27;;</span><br><span class="line">    width: 2em;</span><br><span class="line">    height: 2em;</span><br><span class="line">    position: absolute;</span><br><span class="line">    left: 0;</span><br><span class="line">    border-radius: 100%;</span><br><span class="line">    vertical-align: middle;</span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">    transition: left 0.3s;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.switch-an</span><span class="selector-attr">[type=<span class="string">&#x27;checkbox&#x27;</span>]</span> + <span class="selector-tag">label</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line">    content: &#x27;OFF&#x27;;</span><br><span class="line">    margin-left: 2.6em;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.switch-an</span><span class="selector-attr">[type=<span class="string">&#x27;checkbox&#x27;</span>]</span><span class="selector-pseudo">:checked</span> + <span class="selector-tag">label</span><span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line">    transition: left 0.3s;</span><br><span class="line">    left: 3em;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.switch-an</span><span class="selector-attr">[type=<span class="string">&#x27;checkbox&#x27;</span>]</span><span class="selector-pseudo">:checked</span> + <span class="selector-tag">label</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line">    content: &#x27;NO&#x27;;</span><br><span class="line">    margin-left: 0.6em;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;check-wrap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">class</span>=<span class="string">&quot;switch&quot;</span> <span class="attr">id</span>=<span class="string">&quot;switch-1&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;switch-1&quot;</span>&gt;</span>生男孩<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">class</span>=<span class="string">&quot;switch&quot;</span> <span class="attr">id</span>=<span class="string">&quot;switch-2&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;switch-2&quot;</span>&gt;</span>生女孩<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;check-wrap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">class</span>=<span class="string">&quot;switch-an&quot;</span> <span class="attr">id</span>=<span class="string">&quot;switch-an-1&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;switch-an-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>CSS3</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS使用技巧汇总</title>
    <url>/posts/61575/</url>
    <content><![CDATA[<h2 id="CSS-样式"><a href="#CSS-样式" class="headerlink" title="CSS 样式"></a>CSS 样式</h2><h3 id="css-设置文字无法选中"><a href="#css-设置文字无法选中" class="headerlink" title="css 设置文字无法选中"></a>css 设置文字无法选中</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">-webkit-user-select</span>: <span class="selector-tag">none</span>;</span><br><span class="line"><span class="selector-tag">-moz-user-select</span>: <span class="selector-tag">none</span>;</span><br><span class="line"><span class="selector-tag">-ms-user-select</span>: <span class="selector-tag">none</span>;</span><br><span class="line"><span class="selector-tag">user-select</span>: <span class="selector-tag">none</span>;</span><br></pre></td></tr></table></figure>

<h2 id="CSS-函数"><a href="#CSS-函数" class="headerlink" title="CSS 函数"></a>CSS 函数</h2><p>转载自：<a href="https://blog.csdn.net/qq449245884/article/details/108467025">https://blog.csdn.net/qq449245884/article/details/108467025</a></p>
<p>DEMO 地址：<a href="https://codepen.io/protic_milos/pen/GRpYJKd">https://codepen.io/protic_milos/pen/GRpYJKd</a></p>
<a id="more"></a>

<h3 id="attr"><a href="#attr" class="headerlink" title="attr()"></a>attr()</h3><p><code>attr</code> 函数用于获取所选元素的属性值。 它接受三个参数，<code>属性名称</code> ，<code>属性值的单位</code> 和 <code>默认值</code> 。</p>
<p>语法: <code>attr( attribute-name ? [, ]? )</code></p>
<p><strong>DEMO</strong></p>
<blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">data-text</span>=<span class="string">&quot;the attr function&quot;</span> <span class="attr">data-tooltip</span>=<span class="string">&quot;Hi from attr!&quot;</span> <span class="attr">class</span>=<span class="string">&quot;attr&quot;</span>&gt;</span></span><br><span class="line">  This text is combined with</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27; &#x27;</span> <span class="built_in">attr</span>(data-text);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.attr</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27; &#x27;</span> <span class="built_in">attr</span>(data-tooltip);</span><br><span class="line">  <span class="attribute">background-color</span>: orange;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="calc"><a href="#calc" class="headerlink" title="calc()"></a>calc()</h3><p>这个函数使我们能够计算 CSS 值，而不是指定确切的值。通常用于计算元素的大小或位置。它支持加法、减法、乘法和除法。</p>
<p>需要特别注意重要一点是+和-运算符必须用空格隔开，不然无法正常工作。*和/运算符不有这限制，但出于一致性的考虑，建议添加空格。</p>
<p>另外，很棒的是，我们可以混合 CSS 单位，例如，我们可以减去百分比和像素。</p>
<p>我们可以用 calc 构建一个带有居中元素的示例:</p>
<blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;calc&quot;</span>&gt;</span>Centered with calc<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-class">.calc</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: orange;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="built_in">calc</span>(<span class="number">50%</span> - <span class="number">100px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="var"><a href="#var" class="headerlink" title="var()"></a>var()</h3><p>通过这个函数，我们可以使用一个自定义属性的值作为另一个 CSS 属性的值。简单地说，我们可以定义一个颜色，例如，将它放在自定义属性(CSS 变量)中，然后通过调用 var 函数重用该属性值。</p>
<p>与 CSS 变量一起，该函数提高了可维护性并减少了重复。一个用例是为网站创建主题。</p>
<p>此函数接受两个参数，即自定义属性和一个默认值，如果出现问题，将使用它们。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="attribute">--bg-color</span>: green;</span><br><span class="line">  <span class="attribute">--color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.var</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="counter"><a href="#counter" class="headerlink" title="counter()"></a>counter()</h3><p>就我个人而言，我从未使用过这种方法，但它看起来是很有趣。这个函数返回指定计数器的当前值，需要与 <code>counter-reset</code>和<code>counter-increment</code> 配合使用。</p>
<p>我们可以用它来计算其他元素，比如有序列表。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;counter&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>Mars<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>Bounty<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>Snickers<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="circle"><a href="#circle" class="headerlink" title="circle()"></a>circle()</h3><p>这个函数创建一个圆形区域来屏蔽它所应用的元素。你可以指定它的半径和位置。通常与图像一起使用来创建圆角形状。此函数是<code>clip-path</code>属性值。</p>
<p>另外，值得一提的是，除了圆之外，您还可以创建椭圆和多边形形状。</p>
<blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;img</span><br><span class="line">  class=&quot;circle&quot;</span><br><span class="line">  src=&quot;https://devinduct.com/Uploads/PostImages/1122dcb9-954a-4641-9ca6-c38e9472698f.png&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">img</span><span class="selector-class">.circle</span> &#123;</span><br><span class="line">  <span class="attribute">clip-path</span>: <span class="built_in">circle</span>(<span class="number">30%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>AppStore审核被拒原因</title>
    <url>/posts/36545/</url>
    <content><![CDATA[<h2 id="Guideline-5-1-1-Legal-Privacy-Data-Collection-and-Storage"><a href="#Guideline-5-1-1-Legal-Privacy-Data-Collection-and-Storage" class="headerlink" title="Guideline 5.1.1 - Legal - Privacy - Data Collection and Storage"></a>Guideline 5.1.1 - Legal - Privacy - Data Collection and Storage</h2><p>今天 App 审核被拒了，理由如下：</p>
<blockquote>
<p>We noticed that your app requests the user’s consent to access their contacts, camera, and photos but does not clarify the use of the contacts, camera, and photos in the applicable purpose string.</p>
</blockquote>
<p>意思就是没有对请求的相关权限进行描述，或者描述的不够准确，比如使用到了定位，相册相机，通讯录等权限，要把为什么使用这些权限做下详细描述!</p>
<p>例如一个外卖应用，获取定位后需要展示附近的美食信息。那么，相应的定位权限描述，应当是类似“获取定位信息用于为用户提供附近的美食信息”这样的描述。</p>
<a id="more"></a>

<h2 id="Guideline-5-1-2-Legal-Privacy-Data-Use-and-Sharing"><a href="#Guideline-5-1-2-Legal-Privacy-Data-Use-and-Sharing" class="headerlink" title="Guideline 5.1.2 Legal: Privacy - Data Use and Sharing"></a>Guideline 5.1.2 Legal: Privacy - Data Use and Sharing</h2><p>7 月 23 日审核又被拒了，理由如下：</p>
<blockquote>
<p>Your app accesses user data from the device but does not have the required precautions in place.</p>
<p>Next Steps</p>
<p>To collect personal data with your app, you must make it clear to the user that their personal data will be uploaded to your server and you must obtain the user’s consent before the data is uploaded. You must also have a Privacy Policy URL and ensure that the URL you provide directs users to your privacy policy.</p>
</blockquote>
<p>搜了下被拒原因：</p>
<p>App 申请了通讯录访问权限，所以必须向用户明确其个人数据将上传至应用的服务器，并且必须获得用户的同意才能上传数据。还必须拥有隐私政策 URL，并确保提供的 URL 将用户引导至提供的隐私政策上。</p>
<p>修改方案：</p>
<img src="/posts/36545/agree.jpeg" class="" title="agree">

<p>P.S. 上方点击「隐私授权协议」后，用户会跳转到我准备好的一个协议说明链接。</p>
<h3 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h3><ul>
<li><a href="http://www.jeepxie.net/article/147613.html">获取用户隐私信息，苹果审核 app 被拒（2.5.13 5.1.1 5.1.2）</a></li>
</ul>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-CSS粘住固定底部的5种方法</title>
    <url>/posts/52603/</url>
    <content><![CDATA[<p>译文地址：<a href="http://caibaojian.com/css-5-ways-sticky-footer.html">http://caibaojian.com/css-5-ways-sticky-footer.html</a><br>原文地址：<a href="https://css-tricks.com/couple-takes-sticky-footer/">https://css-tricks.com/couple-takes-sticky-footer/</a><br>译者：前端开发博客-Jack</p>
<h3 id="方法一：全局增加一个负值下边距等于底部高度"><a href="#方法一：全局增加一个负值下边距等于底部高度" class="headerlink" title="方法一：全局增加一个负值下边距等于底部高度"></a>方法一：全局增加一个负值下边距等于底部高度</h3><p>有一个全局的元素包含除了底部之外的所有内容。它有一个负值下边距等于底部的高度，就像<a href="http://ryanfait.com/html5-sticky-footer/">这个演示链接</a>。</p>
<a id="more"></a>

<p><a href="http://caibaojian.com/t/html">HTML</a>代码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">    content</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;push&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="http://caibaojian.com/css3/">CSS</a>代码：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">100%</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Equal to height of footer */</span></span><br><span class="line">  <span class="comment">/* But also accounting for potential margin-bottom of last child */</span></span><br><span class="line">  <span class="attribute">margin-bottom</span>: -<span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer</span>,</span><br><span class="line"><span class="selector-class">.push</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>演示：</p>
<iframe name="cp_embed_1" src="https://codepen.io/chriscoyier/embed/VjZmGj?height=392&amp;theme-id=1&amp;slug-hash=VjZmGj&amp;default-tab=result&amp;user=chriscoyier&amp;embed-version=2&amp;name=cp_embed_1" scrolling="no" frameborder="0" height="392" allowtransparency="true" allowfullscreen="true" allowpaymentrequest="true" title="CodePen Embed" class="cp_embed_iframe " loading="lazy" id="cp_embed_VjZmGj" style="margin: 0px; padding: 0px; border: 0px; font: inherit; vertical-align: baseline; width: 688px; overflow: hidden; display: block;"></iframe>

<p>这个代码需要一个额外的元素.push 等于底部的高度，来防止内容覆盖到底部的元素。这个 push 元素是智能的，它并没有占用到底部的利用，而是通过全局加了一个负边距来填充。</p>
<h3 id="方法二：底部元素增加负值上边距"><a href="#方法二：底部元素增加负值上边距" class="headerlink" title="方法二：底部元素增加负值上边距"></a>方法二：底部元素增加负值上边距</h3><p>虽然这个代码减少了一个.push 的元素，但还是需要增加多一层的元素包裹内容，并给他一个内边距使其等于底部的高度，防止内容覆盖到底部的内容。</p>
<p>HTML 代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content-inside&quot;</span>&gt;</span>content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="http://caibaojian.com/t/css">CSS</a>：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content-inside</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>演示：</p>
<iframe name="cp_embed_2" src="https://codepen.io/chriscoyier/embed/aZoBMb?height=300&amp;theme-id=1&amp;slug-hash=aZoBMb&amp;default-tab=result&amp;user=chriscoyier&amp;embed-version=2&amp;name=cp_embed_2" scrolling="no" frameborder="0" height="300" allowtransparency="true" allowfullscreen="true" allowpaymentrequest="true" title="CodePen Embed" class="cp_embed_iframe " loading="lazy" id="cp_embed_aZoBMb" style="margin: 0px; padding: 0px; border: 0px; font: inherit; vertical-align: baseline; width: 688px; overflow: hidden; display: block;"></iframe>

<h2 id="方法三：使用-calc-计算内容的高度"><a href="#方法三：使用-calc-计算内容的高度" class="headerlink" title="方法三：使用 calc()计算内容的高度"></a>方法三：使用 calc()计算内容的高度</h2><p>HTML</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="http://caibaojian.com/t/css">CSS</a>:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="built_in">calc</span>(<span class="number">100vh</span> - <span class="number">70px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>演示：</p>
<iframe name="cp_embed_3" src="https://codepen.io/chriscoyier/embed/jqRXBz?height=414&amp;theme-id=1&amp;slug-hash=jqRXBz&amp;default-tab=result&amp;user=chriscoyier&amp;embed-version=2&amp;name=cp_embed_3" scrolling="no" frameborder="0" height="414" allowtransparency="true" allowfullscreen="true" allowpaymentrequest="true" title="CodePen Embed" class="cp_embed_iframe " loading="lazy" id="cp_embed_jqRXBz" style="margin: 0px; padding: 0px; border: 0px; font: inherit; vertical-align: baseline; width: 688px; overflow: hidden; display: block;"></iframe>

<p>给 70px 而不是 50px 是为了为了跟底部隔开 20px，防止紧靠在一起。</p>
<h3 id="方法四：使用flexbox"><a href="#方法四：使用flexbox" class="headerlink" title="方法四：使用flexbox"></a>方法四：使用<a href="http://caibaojian.com/t/flexbox">flexbox</a></h3><p>关于 flexbox 的教程，还请查看之前的一篇<a href="http://caibaojian.com/flexbox-guide.html">详细的教程</a></p>
<p>HTML:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>CSS:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>演示：</p>
<iframe name="cp_embed_4" src="https://codepen.io/chriscoyier/embed/RRbKrL?height=488&amp;theme-id=1&amp;slug-hash=RRbKrL&amp;default-tab=result&amp;user=chriscoyier&amp;embed-version=2&amp;name=cp_embed_4" scrolling="no" frameborder="0" height="488" allowtransparency="true" allowfullscreen="true" allowpaymentrequest="true" title="CodePen Embed" class="cp_embed_iframe " loading="lazy" id="cp_embed_RRbKrL" style="margin: 0px; padding: 0px; border: 0px; font: inherit; vertical-align: baseline; width: 688px; overflow: hidden; display: block;"></iframe>

<h3 id="方法五：使用-grid-布局"><a href="#方法五：使用-grid-布局" class="headerlink" title="方法五：使用 grid 布局"></a>方法五：使用 grid 布局</h3><p>HTML：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>CSS：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-rows</span>: <span class="number">1</span>fr auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">  <span class="attribute">grid-row-start</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">grid-row-end</span>: <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>演示：</p>
<iframe name="cp_embed_5" src="https://codepen.io/chriscoyier/embed/YWKNrE?height=477&amp;theme-id=1&amp;slug-hash=YWKNrE&amp;default-tab=result&amp;user=chriscoyier&amp;embed-version=2&amp;name=cp_embed_5" scrolling="no" frameborder="0" height="477" allowtransparency="true" allowfullscreen="true" allowpaymentrequest="true" title="CodePen Embed" class="cp_embed_iframe " loading="lazy" id="cp_embed_YWKNrE" style="margin: 0px; padding: 0px; border: 0px; font: inherit; vertical-align: baseline; width: 688px; overflow: hidden; display: block;"></iframe>

<p>grid 早于 flexbox 出现，但并没有 flexbox 被广泛支持，你可能在 chrome Canary 或者 Firefox 开发版上才可以看见效果</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>布局</tag>
        <tag>技巧</tag>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS超出部分省略号</title>
    <url>/posts/26295/</url>
    <content><![CDATA[<h2 id="CSS-实现单行省略号"><a href="#CSS-实现单行省略号" class="headerlink" title="CSS 实现单行省略号"></a>CSS 实现单行省略号</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CSS-实现多行省略号"><a href="#CSS-实现多行省略号" class="headerlink" title="CSS 实现多行省略号"></a>CSS 实现多行省略号</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">  <span class="attribute">-webkit-box-orient</span>: vertical;</span><br><span class="line">  -webkit-line-clamp: 3; //行数</span><br><span class="line">  <span class="selector-tag">overflow</span>: <span class="selector-tag">hidden</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>-webkit-line-clamp 用来限制在一个块元素显示的文本的行数。 为了实现该效果，它需要组合其他的 WebKit 属性。常见结合属性：</p>
<p>display: -webkit-box; 必须结合的属性 ，将对象作为弹性伸缩盒子模型显示 。</p>
<p>-webkit-box-orient 必须结合的属性 ，设置或检索伸缩盒对象的子元素的排列方式 。</p>
<p><a href="http://www.daqianduan.com/6179.html">http://www.daqianduan.com/6179.html</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS百分比实现高度自适应</title>
    <url>/posts/40550/</url>
    <content><![CDATA[<h2 id="基本知识点"><a href="#基本知识点" class="headerlink" title="基本知识点"></a>基本知识点</h2><p>当 <code>padding/margin</code> 取形式为百分比的值时，无论是 <code>left/right</code>，还是 <code>top/bottom</code> ，都是以父元素的 <code>width</code> 为参照物。</p>
<img src="/posts/40550/margin-top.png" class="" title="margin-top">

<a id="more"></a>

<h2 id="1-给容器设置-padding-top-bottom"><a href="#1-给容器设置-padding-top-bottom" class="headerlink" title="1. 给容器设置 padding-top/bottom"></a>1. 给容器设置 padding-top/bottom</h2><p><code>padding-top/bottom</code> 的百分比值，是依赖父容器宽度的，所以给子元素设置一个与父元素高度相同百分值的 <code>padding-top</code> 即可实现。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">  <span class="attribute">background</span>: green;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50%</span>; <span class="comment">/*父元素宽度一半*/</span></span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">50%</span>; <span class="comment">/*与width一样，为父元素宽度一半*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此方案浏览器兼容性很不错，唯一的缺陷是无法给容器设置 <code>max-height</code> 属性了，因为 <code>max-height</code> 只能限制内容高度，而不能限制 <code>padding</code> ，为了解决这个问题我们可以选择下面这个办法。</p>
<h2 id="2-给子元素-伪元素设置-margin-padding-撑开容器"><a href="#2-给子元素-伪元素设置-margin-padding-撑开容器" class="headerlink" title="2. 给子元素/伪元素设置 margin/padding 撑开容器"></a>2. 给子元素/伪元素设置 margin/padding 撑开容器</h2><p>从上面的方案的盒模型看出 max-height 失效的原因是容器的高度本来就是 padding 撑的，而内容高度为 0，max-height 无法起作用。那想要优化这一点，唯一的方法就是利用内容高度来撑开而非 padding，这个方案跟消除浮动所用的方案非常相似：给容器添加一个子元素/伪元素，并把子元素/伪元素的 pading/margin 设为 100%，使其实际高度相当于容器的宽度，如此一来，便能把容器的高度撑至与宽度达成我们预想的宽高比(1:1)了。由于添加子元素与 HTML 语义化相悖，因此更推荐使用伪元素:after 来实现此方案。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">  <span class="attribute">background</span>: green;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50%</span>; <span class="comment">/*父元素宽度一半*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用该方法可能需考虑 <code>margin</code> 折叠的问题，可在父元素上加 <code>overflow:hidden</code> 触发 BFC 解决。</p>
<p>转载自：<a href="https://www.jianshu.com/p/25e7d0793bf0">https://www.jianshu.com/p/25e7d0793bf0</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>布局</tag>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>DOM操作-insertAdjacentHTML</title>
    <url>/posts/39637/</url>
    <content><![CDATA[<h2 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h2><iframe height="377" scrolling="no" title="添加DOM - insertAdjacentHTML" src="https://codepen.io/JingW/embed/VweRydj?height=377&amp;theme-id=light&amp;default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<a id="more"></a>

<h2 id="移动"><a href="#移动" class="headerlink" title="移动"></a>移动</h2><iframe height="265" scrolling="no" title="移动DOM元素" src="https://codepen.io/JingW/embed/PoZLExJ?height=265&amp;theme-id=light&amp;default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">targetElement.remove();</span><br></pre></td></tr></table></figure>

<h2 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">insertAdjacentElement: IE8+</span><br><span class="line">insertAdjacentText: IE11+</span><br><span class="line">insertAdjacentHTML: IE11+ Chrome80+</span><br><span class="line">remove Edge Chrome80+</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/insertAdjacentHTML">MDN - insertAdjacentHTML</a></li>
<li><a href="https://www.caniuse.com/">Can i use</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>HTML</category>
      </categories>
      <tags>
        <tag>DOM</tag>
      </tags>
  </entry>
  <entry>
    <title>Eruda-移动端项目调试工具</title>
    <url>/posts/41294/</url>
    <content><![CDATA[<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>之前移动端页面调试我都是手机插线连电脑用 Chrome 或者 Safari 搞定的，然而这种方式挺麻烦的，起码我这么觉得。（p.s. 如果不熟悉连线操作方式，可以查看掘金的<a href="https://juejin.im/post/5b15022ff265da6e163720c6">这篇文章</a>）后来就考虑搜索替代方案了，于是发现了 <a href="https://github.com/liriliri/eruda">Eruda</a> 这款调试工具。</p>
<a id="more"></a>

<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>直接引用作者对这款插件的介绍：Eruda 是一个专为手机网页前端设计的调试面板，类似 DevTools 的迷你版，其主要功能包括：捕获 console 日志、检查元素状态、捕获 XHR 请求、显示本地存储和 Cookie 信息等等。</p>
<p>总结来讲，使用它的好处就是，手机在不连线的情况下访问页面，会在右下角生成一个按钮，点击会弹出一个调试窗口，能够在上面查看 log 日志等信息，方便调试。</p>
<h3 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h3><img src="/posts/41294/screenshot.jpg" class="" title="screenshot">

<h2 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h2><h3 id="通过-cdn"><a href="#通过-cdn" class="headerlink" title="通过 cdn"></a>通过 cdn</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.bootcss.com/eruda/1.5.2/eruda.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  eruda.init();</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="通过-npm"><a href="#通过-npm" class="headerlink" title="通过 npm"></a>通过 npm</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i eruda -D</span><br></pre></td></tr></table></figure>

<p>入口文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/mdebug=true/</span>.test(<span class="built_in">window</span>.location.href)) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">  script.src = <span class="string">&#x27;https://cdn.bootcss.com/eruda/1.5.2/eruda.min.js&#x27;</span>;</span><br><span class="line">  script.async = <span class="literal">true</span>;</span><br><span class="line">  <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;head&#x27;</span>)[<span class="number">0</span>].appendChild(script);</span><br><span class="line">  script.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    eruda.init();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>在需要调试时，给地址栏末尾正价 mdebug=true 就 OK 了。</p>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><ul>
<li><a href="https://github.com/liriliri/eruda">github - eruda</a></li>
<li><a href="https://github.com/Tencent/vConsole">另一款调试工具 - vconsole</a></li>
</ul>
]]></content>
      <categories>
        <category>工具</category>
        <category>测试</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>调试</tag>
      </tags>
  </entry>
  <entry>
    <title>Event Loop 学习笔记</title>
    <url>/posts/10505/</url>
    <content><![CDATA[<p>我们只关心打钩的的阶段：</p>
<ol>
<li>timers</li>
<li>poll（此阶段会停留一段时间）</li>
<li>check（执行一些立即执行的函数【主要就是：setImmediate(fn) 函数】）</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">   ┌───────────────────────┐</span><br><span class="line">┌─&gt;│        timers   ✅    │</span><br><span class="line">│  └──────────┬────────────┘</span><br><span class="line">│  ┌──────────┴────────────┐</span><br><span class="line">│  │     I&#x2F;O callbacks     │</span><br><span class="line">│  └──────────┬────────────┘</span><br><span class="line">│  ┌──────────┴────────────┐</span><br><span class="line">│  │     idle, prepare     │</span><br><span class="line">│  └──────────┬────────────┘      ┌───────────────┐</span><br><span class="line">│  ┌──────────┴────────────┐      │   incoming:   │</span><br><span class="line">│  │         poll    ✅    │&lt;─────┤  connections, │</span><br><span class="line">│  └──────────┬────────────┘      │   data, etc.  │</span><br><span class="line">│  ┌──────────┴────────────┐      └───────────────┘</span><br><span class="line">│  │        check    ✅    │</span><br><span class="line">│  └──────────┬────────────┘</span><br><span class="line">│  ┌──────────┴────────────┐</span><br><span class="line">└──┤    close callbacks    │</span><br><span class="line">   └───────────────────────┘</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="timers-和-poll"><a href="#timers-和-poll" class="headerlink" title="timers 和 poll"></a>timers 和 poll</h2><img src="/posts/10505/event-loop.png" class="" title="event-loop">

<p>根据 <a href="https://juejin.im/post/5ab7677f6fb9a028d56711d0">官方文档</a> 的描述，事件循环应该是从 timers 开始的，但不一定。</p>
<p>NodeJS 的内部代码大概是这样写的：</p>
<ul>
<li>开启 eventLoop()</li>
<li>执行 JS()</li>
</ul>
<p>但由于启动 event loop 是开个进程，需要时间的，而执行 JS 也得启动 V8 引擎，也是需要时间的，所以不确定这两个谁快谁慢。所以：</p>
<ul>
<li>有可能 setTimeout 先执行，后才进入 timers 阶段</li>
<li>也有可能先进入 timers 阶段，后执行 setTimeout</li>
</ul>
<p>假设一段代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(fn, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<img src="/posts/10505/poll.png" class="" title="poll">p

<p>当我们在执行这段代码时，会把 fn 放进 timers 中的一个队列中去（也可以认为是一个数组）。然后 JS 就做自己的事情去了。此时 timers 可能开启了，也可能没有开启。但最大的可能是，在执行 <code>setTimeout(fn, 1000);</code> 的时候，我们进入了 poll 阶段，poll 阶段就是等待（e.g. 等待 ajax 请求成功，或者读文件成功），大概几十毫秒。在等待期间，它会看时间，比如刚才 JS 让我 1000 毫秒后执行一个 fn，现在刚过去 500 毫秒，那我继续等，直到等到 1000 毫秒时，赶紧经过 check 阶段，进入 timers 阶段去执行 fn：</p>
<img src="/posts/10505/el2.png" class="">

<p>执行完毕后，又进入 poll 阶段，什么都不做，继续等。这个等有个时间限制的，假设是 3s，那么 3s 后如果什么都没等到，就进入 check 阶段，然后再回到 timers 阶段，如此循环。</p>
<h2 id="check"><a href="#check" class="headerlink" title="check"></a>check</h2><p>check 阶段会执行一些立即执行的函数，主要就是 setImmediate(fn) 函数。该函数类似 setTimeout，但没有第二个参数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;fn&#x27;</span>), <span class="number">1000</span>);</span><br><span class="line">setImmediate(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;fn2&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>所以在执行例如 setImmediate(fn2) 时，fn2 不会进入 timers，而会进入 check 阶段的一个队列中：</p>
<img src="/posts/10505/poll2.png" class="" title="poll2">

<p>由于我们不确定 timers 这个一阶段结束了还是未结束，所以我们以二阶段 poll 来研究。</p>
<p>当执行 setTimeout 后，我们把 fn 扔进了 timers ，然后进入 poll 阶段开始等，现在又执行到了 setImmediate ，这是个立即执行函数，有事情开始做了，所以 poll 不等了，直接进入 check 阶段去执行 fn2。</p>
<p>然后又回到 timers 阶段，不执行 fn（因为没到 1000 毫秒），又进入 poll 阶段，等到 1000 毫秒后，进入 check 阶段，然后返回 timers 阶段，开始执行 fn （fn 只能在进入 timers 阶段才能执行）。</p>
<h2 id="经典考题"><a href="#经典考题" class="headerlink" title="经典考题"></a>经典考题</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;fn&#x27;</span>), <span class="number">0</span>);</span><br><span class="line">setImmediate(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;fn2&#x27;</span>));</span><br></pre></td></tr></table></figure>

<img src="/posts/10505/poll3.png" class="" width="22">

<p>按照理论（NodeJS 内部代码先调用的 event loop，再调用的执行 JS），应该 fn2 先执行，但实际结果是不一定的，有可能先打印 fn，再打印 fn2；也有可能先打印 fn2，再打印 fn。原因就在于 <strong>开启 event loop</strong> 和 <strong>执行 JS</strong> 的顺序是随机的。</p>
<p>如果先开启了 event loop ，那么就先从 poll 阶段开始，因为 timers 阶段没发现有任何函数，所以进入 poll 开始等。接着等到了 <strong>执行 JS</strong> ，执行第一段代码，就把 0s 延迟的 fn 放进了 timers 的队列，接着执行第二段代码，把 fn2 放进了 check 队列，此刻 <strong>执行 JS</strong> 完毕，event loop 说：你执行完了是吧？我可以开始做事了，然后 poll 发现有任务要执行了，就进入 check 阶段执行 fn2，再返回到 timers 阶段，发现有个 fn 已经过时间了（因为延迟 0s），马上执行 fn。所以这种情况下，先打印 fn2，再打印 fn。</p>
<p>但如果 event loop 开启的比较慢，执行 JS 这一步先开始了。那么就会先把 fn 扔进队列，再才开始进入 timers 的第一阶段，此刻 timers 发现已经有了个 fn，还是 0s 延迟执行，所以就执行了 fn，再进入 poll ，poll 发现还有个 fn2 在等我立即执行，就接着进入 check 然后执行 fn2。所以这种情况下，先打印 fn，再打印 fn2。</p>
<p>说到底，就是看 fn 是在第一次进入 timers 阶段前就存在，还是第一次进入 timers 阶段后才存在。</p>
<p>那怎样才能保证 fn2 先执行呢？解决方案把这两段代码放进一个 setTimeout 中去，然后延迟 1s 执行，为的就是等 event loop 开启后，进入 poll 阶段，再开始执行这两段代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;fn&#x27;</span>), <span class="number">0</span>);</span><br><span class="line">  setImmediate(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;fn2&#x27;</span>));</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="process-nextTick"><a href="#process-nextTick" class="headerlink" title="process.nextTick()"></a>process.nextTick()</h2><p>这个重要的异步 API 不属于 event loop 的任何一个阶段。nextTick 队列会在当前阶段后就被执行。</p>
<p>以下面代码为例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;fn&#x27;</span>), <span class="number">0</span>);</span><br><span class="line">  setImmediate(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;fn2&#x27;</span>));</span><br><span class="line">  process.nextTick(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;fn3&#x27;</span>));</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>由于三段代码被放进了一个 setTimeout 中，且在 1s 后再被执行。所以 1s 后 event loop 肯定已经存在，此时就从 poll 阶段开始，然后执行三段代码，第一段把 fn 放进 timers 的队列，第二段把 fn2 放进 check 队列，然后 poll 阶段执行完了，根据 nextTick 队列会在<strong>当前阶段</strong>后就被执行，所以此刻在马上要进入 check 阶段之前，就把 nextTick 中的代码执行掉了，所以先打印 fn3，然后进入 check 阶段后打印 fn2，最后重新进入 timers 打印 fn。</p>
<p>再来看下面这段代码：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    <span class="selector-tag">console</span><span class="selector-class">.log</span>(&quot;<span class="selector-tag">fn</span>&quot;);</span><br><span class="line">    process.nextTick(() =&gt; console.log(&quot;fn4&quot;));</span><br><span class="line">  &#125;, 0);</span><br><span class="line">  setImmediate(() =&gt; console.log(&quot;fn2&quot;));</span><br><span class="line">  process.nextTick(() =&gt; console.log(&quot;fn3&quot;));</span><br><span class="line">&#125;, 1000);</span><br></pre></td></tr></table></figure>

<p>由于 fn4 紧跟着 fn，所以在 timers 阶段完成后，就执行了 fn4（注意 fn4 不会放进 timers 的队列，而是在队列里函数执行完后，紧跟着执行 fn4），所以最终顺序为：</p>
<p>fn3, fn2, fn, fn4</p>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  setImmediate(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;setImmediate1&#x27;</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout1&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout2&#x27;</span>);</span><br><span class="line">    setImmediate(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;setImmediate2&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<img src="/posts/10505/el-test.png" class="" title="el-test">

<p>执行第 2 行 setImmediate 后，把 setImmediate 中的函数 f1 放进 check 中（此刻不执行 f1），然后执行第 9 行的 setTimeout ，把 setTimeout 中的函数 f2 放进 timers 中（此刻也不执行 f2），然后进入 poll 阶段等待，发现有 f1 待执行，所以执行 f1，打印 setImmediate1 ，接着把 f3 放进 timers 的队列。此刻 check 阶段完成，重回 timers 阶段，发现队列中的 f2，执行 f2，打印 setTimeout2 ，接着把 f4 扔进 check 队列，然后执行 f3， 打印 setTimeout1 ，执行完后，进入 poll 阶段，发现有 f4 没执行，进入 check 阶段，执行 f4，所以最后打印 setImmediate2 。</p>
<h2 id="宏任务-amp-微任务"><a href="#宏任务-amp-微任务" class="headerlink" title="宏任务&amp;微任务"></a>宏任务&amp;微任务</h2><h3 id="Event-Loop"><a href="#Event-Loop" class="headerlink" title="Event Loop"></a>Event Loop</h3><h4 id="NodeJS："><a href="#NodeJS：" class="headerlink" title="NodeJS："></a>NodeJS：</h4><ul>
<li>timers（setTimeout）</li>
<li>poll</li>
<li>check（setImmediate）</li>
</ul>
<p><strong>注意：</strong>nextTick 不属于任何阶段，但会在当前阶段后执行</p>
<p>如果强行问 NodeJS 中的宏任务微任务，那就是：</p>
<p>setTimeout 和 setImmediate 是宏任务，nextTick 是微任务。因为 nextTick 不用等到下个阶段，会在当前阶段完成后立即执行。</p>
<p>还有个 promise.then(fn)【注意是小写的 p，大写的 P 不能直接 then】，一般不考。Node 中的 promise.then 一般是用 nextTick 实现的，所以也按照当前阶段的后面来推。这里 then 里面的 fn 不是马上放队列（setTImeout，setImmediate 和 nextTick 都是里面的 fn 马上放队列），而是当你 resolve 以后，才放进当前阶段的后面执行。</p>
<h4 id="chrome："><a href="#chrome：" class="headerlink" title="chrome："></a>chrome：</h4><ul>
<li>宏任务（一会儿）setTimeout</li>
<li>微任务（马上）.then(fn) <strong>fn 放马上</strong></li>
<li>一会儿就是等会做，马上就是立即做；如果一会儿里面有个马上做的，还是马上做。</li>
</ul>
<p><strong>注意：</strong></p>
<ol>
<li>遇到 await 把它转为 promise 再看，因为 await 本来就是 promise 的语法糖。</li>
<li>new Promise 是立即执行的，.then 才是微任务。</li>
</ol>
<h3 id="面试题-1"><a href="#面试题-1" class="headerlink" title="面试题"></a>面试题</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">await</span> async2();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async1();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line">  resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">5</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>画图！！！不画图做不出来！！！</strong></p>
<p>代码从上到下，先执行 11 行 async1，进入 async1，<strong>先打印 1</strong>。遇到 await 转为 promise =&gt;</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">async2(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="number">3</span>)).then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<p>（<strong>await 后面所有代码都属于 then 当中的，</strong>比如第 4 行后面加个 console.log(“233”)，那么此行代码也属于 then）而 async2 本身的代码会被立即执行，<strong>所以打印第 8 行中的 3</strong>。打印完后<strong>执行 then （</strong>执行 then 其实是需要 resolve 的，但 async 会去看你函数中有没有 resolve，如果没有会自动加上 resolve，相当于 async 帮你干了这样一件事：<strong>Promise.resolve(**async2()</strong>)<strong>.then(f1)**）</strong>，<strong>then 就是放队列</strong>，我们把 <code>console.log(2)</code> 记做任务 f1 放进「马上」中去，但此刻不执行。此刻 async1 彻底执行完了。</p>
<p>接着执行 13 行的 new Promise，14 到 15 行代码会被立即执行（new Promise 中的函数会被立即执行，没有什么宏任务微任务，就相当于裸写 14 到 15 行代码），<strong>所以打印 4</strong>。在执行完 14 行 resolve 的时候，<strong>会指明执行 then 后面的第一个函数，而不是第二个函数（reject 时所执行的）</strong>，也就是 17 行代码的任务也放进「马上」中去，该任务记做 f2 ，至此当前代码全部执行完毕，然后看「马上」中的任务，执行 f1，<strong>打印 2</strong>。接着执行 f2， <strong>打印 5</strong>。</p>
<img src="/posts/10505/answer.png" class="" title="answer">

<p><strong>注意点</strong>：上面的 resolve 只是决定执行 then 里面的成功回调函数，并不决定加入队列。<strong>决定加入队列的是 then。</strong></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>宏任务（一会儿）：setTimeout，setInterval，setImmediate（优先级比前两个高，因为是在 check 阶段）</p>
<p>微任务（马上）：promise.then，process.nextTick</p>
<p>宏任务微任务执行顺序：有微任务先执行微任务，微任务都执行完了，再执行宏任务</p>
<p><a href="https://cdn.nlark.com/yuque/0/2019/png/260235/1557198825204-924929ec-1115-4e21-a771-cf18796f8f15.png?x-oss-process=image/resize,w_984">![image.png](Event Loop 学习笔记/resize,w_984.png)</a></p>
<p><a href="https://evestorm.github.io/tags/Node/"> Node</a> <a href="https://evestorm.github.io/tags/EventLoop/"> EventLoop</a></p>
]]></content>
      <categories>
        <category>后端</category>
        <category>Node</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>EventLoop</tag>
      </tags>
  </entry>
  <entry>
    <title>Github添加个人Profile</title>
    <url>/posts/22751/</url>
    <content><![CDATA[<p>用户现在可直接在 GitHub 个人页中添加 README 介绍，用于展示更加详细的个人信息。</p>
<p>效果：<a href="https://github.com/evestorm">https://github.com/evestorm</a></p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>摘自：<a href="https://zhuanlan.zhihu.com/p/161029860">https://zhuanlan.zhihu.com/p/161029860</a></p>
<p>第一步，创建与 GitHub 用户名同名的代码仓库。</p>
<a id="more"></a>

<img src="/posts/22751/step1.jpg" class="" title="step1">

<p>第二步，返回个人页，即可看到成功生成 README 展示区块。</p>
<p>接着点击编辑按钮，用 Markdown 语法编写 README 文件，即可快速更新：</p>
<img src="/posts/22751/step2.jpg" class="" title="step2">

<h2 id="Github-Profile-模板"><a href="#Github-Profile-模板" class="headerlink" title="Github Profile 模板"></a>Github Profile 模板</h2><p>在 github 上找到了个 repo ，摘录了大量 Profile 模板，可以去上面找找自己心仪的应用到自己的 github 上：</p>
<p><a href="https://github.com/kautukkundan/Awesome-Profile-README-templates">https://github.com/kautukkundan/Awesome-Profile-README-templates</a></p>
<h2 id="Github-readme-统计数据"><a href="#Github-readme-统计数据" class="headerlink" title="Github readme 统计数据"></a>Github readme 统计数据</h2><p><a href="https://github.com/anuraghazra/github-readme-stats">https://github.com/anuraghazra/github-readme-stats</a></p>
<p>这个 repo 可以让我们统计 Github 上的一些数据信息。例如最近一年的提交次数，star 个数等。可以放进 Github Profile 中展示。</p>
<h2 id="徽章生成"><a href="#徽章生成" class="headerlink" title="徽章生成"></a>徽章生成</h2><p>经常看到不少 github 项目中有类似下图所示的徽章：</p>
<img src="/posts/22751/badge.jpg" class="" title="badge">

<p>这样的徽章可以在 <a href="https://shields.io/">https://shields.io/</a> 上生成。网上有不少教程，我就不自己写了，贴个链接：</p>
<p><a href="https://blog.csdn.net/woshiwangdaye/article/details/105182357">https://blog.csdn.net/woshiwangdaye/article/details/105182357</a></p>
]]></content>
      <tags>
        <tag>其他</tag>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-Git回滚到历史节点=&gt;SourceTree篇</title>
    <url>/posts/19083/</url>
    <content><![CDATA[<p>转载自：<a href="https://blog.csdn.net/u010416101/article/details/78142697">https://blog.csdn.net/u010416101/article/details/78142697</a></p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>原理，我们都知道 Git 是基于 Git 树进行管理的，要想要回滚必须做到如下 2 点:</p>
<ol>
<li>本地头节点与远端头节点一样(Git 提交代码的前提条件)；</li>
<li>于本地头节点获取某次历史节点的更改。</li>
</ol>
<a id="more"></a>

<p>说的有点抽象，以图来进行形容：</p>


<h2 id="详细步骤"><a href="#详细步骤" class="headerlink" title="详细步骤"></a>详细步骤</h2><p>步骤简记如下:<br>两个节点 当前节点(最新节点) 与 历史节点</p>
<ol>
<li>点击历史节点，重置到历史节点，选择硬合并；</li>
<li>点击当前节点，重置到当前节点，选择软合并；</li>
<li>提交；</li>
</ol>
<p>PS: 注意检出 Head 不是重置步骤！Head 节点是不属于任何一个节点的。</p>
<h2 id="详细步骤-图示"><a href="#详细步骤-图示" class="headerlink" title="详细步骤(图示)"></a>详细步骤(图示)</h2><p>1 点击历史节点，重置到历史节点</p>


<p>2 选择硬合并</p>


<p>3 点击当前节点，重置到当前节点</p>


<p>4 选择软合并</p>


<p>5 提交</p>


<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://www.zhihu.com/question/48178380">(知乎)Source tree 如何回滚到以前版本？</a></li>
<li><a href="https://blog.csdn.net/zhangbinsijifeng/article/details/47005613">(新拉分支做法)使用 SourceTree 将 bitbucket 的远程仓库回滚到某一次提交</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/23970048">(知乎)Git 自动回滚 和 应用发布的二三事</a></li>
<li><a href="https://www.cnblogs.com/hopeway-shaon/p/5740280.html">(博客园 操作图示)sourceTree 回滚操作</a></li>
</ol>
]]></content>
      <categories>
        <category>工具</category>
        <category>版本控制</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Git学习笔记</title>
    <url>/posts/8520/</url>
    <content><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装链接：<a href="https://git-scm.com/book/zh/v2/%E8%B5%B7%E6%AD%A5-%E5%AE%89%E8%A3%85-Git">起步 - 安装 Git</a></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="配置-user-name-和-user-email"><a href="#配置-user-name-和-user-email" class="headerlink" title="配置 user.name 和 user.email"></a>配置 user.name 和 user.email</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global user.name &#x27;your name&#x27;</span><br><span class="line">git config --global user.email &#x27;your_email@domain.com&#x27;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="相关配置说明"><a href="#相关配置说明" class="headerlink" title="相关配置说明"></a>相关配置说明</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --local 只针对某个仓库有效</span><br><span class="line">git config --global 对当前用户的所有仓库有效</span><br><span class="line">git config --system 对系统所有登录用户有效</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示 config 的配置</span></span><br><span class="line">git config --list --local</span><br><span class="line">git config --list --global</span><br><span class="line">git config --list --system</span><br></pre></td></tr></table></figure>

<h2 id="创建-Git-仓库"><a href="#创建-Git-仓库" class="headerlink" title="创建 Git 仓库"></a>创建 Git 仓库</h2><h3 id="1-把已有的项目代码纳入-Git-管理"><a href="#1-把已有的项目代码纳入-Git-管理" class="headerlink" title="1. 把已有的项目代码纳入 Git 管理"></a>1. 把已有的项目代码纳入 Git 管理</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd 项目代码所在文件夹</span><br><span class="line">git init</span><br></pre></td></tr></table></figure>

<h3 id="2-新建的项目直接用-Git-管理"><a href="#2-新建的项目直接用-Git-管理" class="headerlink" title="2. 新建的项目直接用 Git 管理"></a>2. 新建的项目直接用 Git 管理</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd 某个文件夹</span><br><span class="line">git init your_project # 会在当前路径下创建和项目名称同名的文件夹</span><br><span class="line">cd your_project</span><br></pre></td></tr></table></figure>

<h2 id="常见-Git-命令"><a href="#常见-Git-命令" class="headerlink" title="常见 Git 命令"></a>常见 Git 命令</h2><ul>
<li><p><code>git init</code> 创建 git 仓库</p>
</li>
<li><pre><code class="shell">git clone
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  拷贝现有仓库（本地 or 远程）</span><br><span class="line"></span><br><span class="line">  - &#96;git clone LINK custom_name&#96; 拷贝现有仓库并重命名</span><br><span class="line"></span><br><span class="line">- &#96;&#96;&#96;shell</span><br><span class="line">  git log</span><br></pre></td></tr></table></figure>

查看 commit 日志

- `git log --oneline` 一行显示 commit 的提交信息

- ```shell
  git log --stat
  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">    用来显示 commit 中更改的文件以及添加或删除的行数</span><br><span class="line"></span><br><span class="line">    - 显示被修改的文件</span><br><span class="line">    - 显示添加&#x2F;删除的行数</span><br><span class="line">    - 显示一个摘要，其中包含修改&#x2F;删除的总文件数和总行数</span><br><span class="line"></span><br><span class="line">- &#96;&#96;&#96;shell</span><br><span class="line">  git add index.html</span><br></pre></td></tr></table></figure>

暂存文件

- `git add .` 暂存所有</code></pre>
</li>
<li><p><code>git status</code> 了解仓库状况</p>
</li>
<li><p><code>git commit -m &#39;初次提交&#39;</code> 提交 commit</p>
</li>
<li><p><code>git diff</code> 命令用来查看已经执行但是尚未 commit 的更改</p>
</li>
<li><pre><code class="shell">git branch
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  列出所有分支</span><br><span class="line"></span><br><span class="line">  - &#96;git branch sidebar&#96; 创建分支</span><br><span class="line">  - &#96;git checkout sidebar&#96; 切换分支</span><br><span class="line">  - &#96;git checkout -b sidebar&#96; 新建分支并切换到新建的分支</span><br><span class="line">  - &#96;git branch -d sidebar&#96; 删除分支</span><br><span class="line"></span><br><span class="line">- &#96;git merge &lt;name-of-branch-to-merge-in&gt;&#96; 合并分支</span><br><span class="line"></span><br><span class="line">- &#96;git reset --hard HEAD^&#96; 如果在错误的分支上进行了合并，可以使用此命令撤消</span><br><span class="line"></span><br><span class="line">## 合并分支</span><br><span class="line"></span><br><span class="line">要合并 &#96;sidebar&#96; 分支，确保你位于 &#96;master&#96; 分支上，并运行：</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;shell</span><br><span class="line">git merge sidebar</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>合并有以下两种类型：</p>
<ul>
<li>快进合并 – 要合并的分支必须位于检出分支前面。检出分支的指针将向前移动，指向另一分支所指向的同一 commit。</li>
<li>普通类型的合并<ul>
<li>两个完全不同的分支被合并</li>
<li>创建一个合并 commit</li>
</ul>
</li>
</ul>
<h3 id="合并冲突"><a href="#合并冲突" class="headerlink" title="合并冲突"></a>合并冲突</h3><h4 id="合并冲突指示符解释"><a href="#合并冲突指示符解释" class="headerlink" title="合并冲突指示符解释"></a>合并冲突指示符解释</h4><p>编辑器具有以下合并冲突指示符：</p>
<ul>
<li><code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</code> 此行下方的所有内容（直到下个指示符）显示了当前分支上的行</li>
<li><code>||||||| merged common ancestors</code> 此行下方的所有内容（直到下个指示符）显示了原始行的内容</li>
<li><code>=======</code> 表示原始行内容的结束位置，之后的所有行（直到下个指示符）是被合并的当前分支上的行的内容</li>
<li><code>&gt;&gt;&gt;&gt;&gt;&gt;&gt; heading-update</code> 是要被合并的分支（此例中是 <code>heading-update</code> 分支）上的行结束指示符</li>
</ul>
<p>当相同的行在要合并的不同分支上做出了更改时，就会出现合并冲突。git 将在合并途中暂停，并告诉你存在冲突，以及哪些文件存在冲突。要解决文件中的冲突：</p>
<ul>
<li>找到并删掉存在合并冲突指示符的所有行</li>
<li>决定保留哪些行</li>
<li>保存文件</li>
<li>暂存文件</li>
<li>提交 commit</li>
</ul>
<p>注意一个文件可能在多个部分存在合并冲突，因此检查整个文件中的合并冲突指示符，搜索 <code>&lt;&lt;&lt;</code> 能够帮助你找到所有这些指示符。</p>
<h2 id="撤销更改"><a href="#撤销更改" class="headerlink" title="撤销更改"></a>撤销更改</h2><h3 id="更改最后一个-commit"><a href="#更改最后一个-commit" class="headerlink" title="更改最后一个 commit"></a>更改最后一个 commit</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git commit --amend</span><br></pre></td></tr></table></figure>

<p>借助 <code>--amend</code> 选项，可以更改最近的 commit。</p>
<p>如果你的工作目录没有内容（也就是仓库中没有任何未 commit 的更改），那么运行 <code>git commit --amend</code> 将使你能够重新提供 commit 消息。代码编辑器将打开，并显示原始 commit 消息。只需纠正拼错的单词或重新表述即可！然后保存文件并关闭编辑器，以便采用新的 commit 消息。</p>
<h3 id="向-commit-中添加忘记的文件"><a href="#向-commit-中添加忘记的文件" class="headerlink" title="向 commit 中添加忘记的文件"></a>向 commit 中添加忘记的文件</h3><p>此外，<code>git commit --amend</code> 使你能够包含忘记包含的文件（或文件更改）。假设你更新了整个网站的导航链接颜色。commit 了该更改，并以为完事了。但是后来发现深藏在页面上的一个特殊导航链接没有新的颜色。你可以执行新的 commit 并更新该链接的颜色，但是这样就会出现两个 commit 执行完全相同的任务（更改链接颜色）。</p>
<p>相反，你可以修改最后一个 commit（更新所有其他链接颜色的 commit）以包含这个忘记的链接。要包含忘记的链接，只需：</p>
<ul>
<li>编辑文件</li>
<li>保存文件</li>
<li>暂存文件</li>
<li>运行 <code>git commit --amend</code></li>
</ul>
<p>你对必要的 CSS 和/或 HTML 文件作出了更改，以便修正被遗忘的链接样式，然后保存所有被修改的文件，并使用 <code>git add</code> 暂存所有被修改的文件（就像要提交新的 commit 那样！），但是你可以运行 <code>git commit --amend</code> 来更新最近的 commit，而不是创建新的 commit。</p>
<h3 id="还原-commit"><a href="#还原-commit" class="headerlink" title="还原 commit"></a>还原 commit</h3><p>创建了一个包含一些更改的 commit，然后使用 <code>git revert</code> 命令还原它</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git revert &lt;SHA-of-commit-to-revert&gt;</span><br></pre></td></tr></table></figure>

<p>因为最近的 commit 的 SHA 是 <code>db7e87a</code>，要还原该 commit： 需要运行 <code>git revert db7e87a</code>（随即弹出代码编辑器，以便编辑/确认提供的 commit 消息）</p>
<p><strong>注意此命令：</strong></p>
<ul>
<li>将撤消目标 commit 所做出的更改</li>
<li>创建一个新的 commit 来记录这一更改</li>
</ul>
<h3 id="重置-commit"><a href="#重置-commit" class="headerlink" title="重置 commit"></a>重置 commit</h3><p>初看，<strong>重置（reset）</strong> 似乎和 <strong>还原（revert）</strong> 相似，但它们实际上差别很大。还原会创建一个新的 commit，并还原或撤消之前的 commit。但是重置会清除 commit！</p>
<blockquote>
<p>⚠️ 重置很危险 ⚠️</p>
</blockquote>
<blockquote>
<p>一定要谨慎使用 git 的重置功能。这是少数几个可以从仓库中清除 commit 的命令。如果某个 commit 不再存在于仓库中，它所包含的内容也会消失。</p>
</blockquote>
<blockquote>
<p>P.S. git 会在完全清除任何内容之前，持续跟踪大约 30 天。要调用这些被重置的内容，需要使用 <code>git reflog</code> 命令。你可以参阅以下链接以了解详情：</p>
</blockquote>
<blockquote>
<ul>
<li><a href="https://git-scm.com/docs/git-reflog">git-reflog (英)</a></li>
<li><a href="https://www.atlassian.com/git/tutorials/rewriting-history">重写历史记录 (英)</a></li>
<li><a href="http://gitready.com/intermediate/2009/02/09/reflog-your-safety-net.html">reflog，你的安全屏障 (英)</a></li>
</ul>
</blockquote>
<h3 id="相关-commit-引用"><a href="#相关-commit-引用" class="headerlink" title="相关 commit 引用"></a>相关 commit 引用</h3><p>我们知道可以使用 SHA、标签、分支和特殊的 <code>HEAD</code> 指针引用 commit。但有时候这些并不足够，我们可能需要引用相对于另一个 commit 的 commit。例如，有时候我们需要告诉 git 调用当前 commit 的前一个 commit，或者是前两个 commit。我们可以使用特殊的“祖先引用”字符来告诉 git 这些相对引用。这些字符为：</p>
<ul>
<li><code>^</code> – 表示父 commit</li>
<li><code>~</code> – 表示第一个父 commit</li>
</ul>
<p>我们可以通过以下方式引用之前的 commit：</p>
<ul>
<li>父 commit – 以下内容表示当前 commit 的父 commit</li>
<li><code>HEAD^</code></li>
<li><code>HEAD~</code></li>
<li><code>HEAD~1</code></li>
<li>祖父 commit – 以下内容表示当前 commit 的祖父 commit</li>
<li>HEAD^^</li>
<li>HEAD~2</li>
<li>曾祖父 commit – 以下内容表示当前 commit 的曾祖父 commit</li>
<li>HEAD^^^</li>
<li>HEAD~3</li>
</ul>
<p><code>^</code> 和 <code>~</code> 的区别主要体现在通过合并而创建的 commit 中。合并 commit 具有两个父级。对于合并 commit，<code>^</code> 引用用来表示第一个父 commit，而 <code>^2</code> 表示第二个父 commit。第一个父 commit 是当你运行 <code>git merge</code> 时所处的分支，而第二个父 commit 是被合并的分支。</p>
<p>我们来看一个示例，这样更好理解。这是我的 <code>git log</code> 当前的显示结果：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">* 9ec05ca (HEAD -&gt; master) Revert &quot;Set page heading to &quot;Quests &amp; Crusades&quot;&quot;</span><br><span class="line">* db7e87a Set page heading to &quot;Quests &amp; Crusades&quot;</span><br><span class="line">*   796ddb0 Merge branch &#x27;heading-update&#x27;</span><br><span class="line">|\</span><br><span class="line">| * 4c9749e (heading-update) Set page heading to &quot;Crusade&quot;</span><br><span class="line">* | 0c5975a Set page heading to &quot;Quest&quot;</span><br><span class="line">|/</span><br><span class="line">*   1a56a81 Merge branch &#x27;sidebar&#x27;</span><br><span class="line">|\</span><br><span class="line">| * f69811c (sidebar) Update sidebar with favorite movie</span><br><span class="line">| * e6c65a6 Add new sidebar content</span><br><span class="line">* | e014d91 (footer) Add links to social media</span><br><span class="line">* | 209752a Improve site heading for SEO</span><br><span class="line">* | 3772ab1 Set background color for page</span><br><span class="line">|/</span><br><span class="line">* 5bfe5e7 Add starting HTML structure</span><br><span class="line">* 6fa5f34 Add .gitignore file</span><br><span class="line">* a879849 Add header to blog</span><br><span class="line">* 94de470 Initial commit</span><br></pre></td></tr></table></figure>

<p>我们来看看如何引用一些之前的 commit。因为 <code>HEAD</code> 指向 <code>9ec05ca</code> commit：</p>
<ul>
<li><code>HEAD^</code> 是 <code>db7e87a</code> commit</li>
<li><code>HEAD~1</code> 同样是 <code>db7e87a</code> commit</li>
<li><code>HEAD^^</code> 是 <code>796ddb0</code> commit</li>
<li><code>HEAD~2</code> 同样是 <code>796ddb0</code> commit</li>
<li><code>HEAD^^^</code> 是 <code>0c5975a</code> commit</li>
<li><code>HEAD~3</code> 同样是 <code>0c5975a</code> commit</li>
<li><code>HEAD^^^2</code> 是 <code>4c9749e</code> commit（这是曾祖父的 (<code>HEAD^^</code>) 第二个父 commit (<code>^2</code>))</li>
</ul>
<h3 id="git-reset-命令"><a href="#git-reset-命令" class="headerlink" title="git reset 命令"></a><code>git reset</code> 命令</h3><p><code>git reset</code> 命令用来重置（清除）commit：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git reset &lt;reference-to-commit&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以用来：</p>
<ul>
<li>将 HEAD 和当前分支指针移到目标 commit</li>
<li>清除 commit</li>
<li>将 commit 的更改移到暂存区</li>
<li>取消暂存 commit 的更改</li>
</ul>
<h4 id="git-reset-的选项"><a href="#git-reset-的选项" class="headerlink" title="git reset 的选项"></a>git reset 的选项</h4><p>git 根据所使用选项来判断是清除、暂存之前 commit 的更改，还是取消暂存之前 commit 的更改。这些选项包括：</p>
<blockquote>
<p>起始</p>
</blockquote>
<img src="/posts/8520/image-20200120161811703.png" class="" title="image-20200120161811703">

<h5 id="mixed-git-reset-默认执行的此操作"><a href="#mixed-git-reset-默认执行的此操作" class="headerlink" title="-mixed git reset 默认执行的此操作"></a><code>-mixed</code> git reset 默认执行的此操作</h5><img src="/posts/8520/image-20200120162215190.png" class="" title="image-20200120162215190">

<p>此刻执行 <code>git reset HEAD~1</code> 会把 <code>3</code> 中的提交存留于<strong>工作区</strong>的文件中，更改未暂存。</p>
<p>如果此刻我们暂存文件并再次提交，将会获得相同的提交内容。但我们会获得一个不同的提交 SHA，这是因为本次提交的时间戳和之前的 <code>3</code> 不同。但提交内容完全一样。</p>
<h5 id="soft"><a href="#soft" class="headerlink" title="--soft"></a><code>--soft</code></h5><img src="/posts/8520/image-20200120162410814.png" class="" title="image-20200120162410814">

<p>此刻执行 <code>git reset --soft HEAD~1</code> 会把 <code>3</code> 中的提交放进<strong>暂存区</strong>。这些更改仍然相同，而且已经暂存好了，如果你再 commit 会得到 reset 前一样的版本。同样 SHA 值不同。</p>
<h5 id="hard"><a href="#hard" class="headerlink" title="--hard"></a><code>--hard</code></h5><img src="/posts/8520/image-20200120162626566.png" class="" title="image-20200120162626566">

<p>此刻执行 <code>git reset --hard HEAD~1</code> 会把 <code>3</code> 中的提交全部删除。</p>
<h4 id="小节"><a href="#小节" class="headerlink" title="小节"></a>小节</h4><p>总结下，<code>git reset</code> 命令被用来清除 commit：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git reset &lt;reference-to-commit&gt;</span></span><br></pre></td></tr></table></figure>

<p>它可以用来：</p>
<ul>
<li>将 HEAD 和当前分支指针移到引用的 commit</li>
<li>使用 <code>--hard</code> 选项清除 commit</li>
<li>使用 <code>--soft</code> 选项将 commit 的更改移至暂存区</li>
<li>使用 <code>--mixed</code> 选项取消暂存已被 commit 的更改</li>
</ul>
<p>我们通常会用到祖先引用来指代之前的 commit。祖先引用包含：</p>
<ul>
<li><code>^</code> – 表示父 commit</li>
<li><code>~</code> – 表示第一个父 commit</li>
</ul>
<h2 id="使用远程仓库"><a href="#使用远程仓库" class="headerlink" title="使用远程仓库"></a>使用远程仓库</h2><h3 id="添加远程仓库"><a href="#添加远程仓库" class="headerlink" title="添加远程仓库"></a>添加远程仓库</h3><p>使用下面命令，在本地仓库与 GitHub 帐户上创建的远程仓库之间创建连接。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote add origin https://github.com/richardkalehoff/RichardsFantasticProject.git</span><br></pre></td></tr></table></figure>

<p>对于刚在命令行中运行的命令，有几点需要注意：</p>
<ol>
<li><p>首先，这条命令包含一个子命令 <code>add</code></p>
</li>
<li><p>这里使用了 <code>origin</code> 一词，设置了我们之前所说的简写名</p>
<ul>
<li><p>记住， <code>origin</code> 一词并没什么特殊性。</p>
</li>
<li><p>如果你想将它改为 <code>repo-on-GitHub</code>，那么只需（在运行命令之前）将 “origin” 改为 “repo-on-GitHub”：</p>
<p><code>$ git remote add repo-on-GitHub https://github.com/richardkalehoff/RichardsFantasticProject.git</code></p>
</li>
</ul>
</li>
<li><p>第三，添加了仓库的完整路径（即 Web 上的远程仓库 URL）</p>
</li>
</ol>
<p>然后使用 <code>git remote -v</code> 来验证我已经正确添加了远程仓库。</p>
<h3 id="将更改推送到远程仓库"><a href="#将更改推送到远程仓库" class="headerlink" title="将更改推送到远程仓库"></a>将更改推送到远程仓库</h3><p>要将本地 commits 推送到远程仓库，你需要使用 <code>git push</code> 命令。你要提供远程仓库简写名以及用于容纳你的 commit 的分支名：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push &lt;remote-shortname&gt; &lt;branch&gt;</span></span><br></pre></td></tr></table></figure>

<p>我的远程仓库的简写名为 <code>origin</code>，并且我想推送的 commit 位于<code>master</code>分支上。那么，我要使用以下命令将我的 commit 推送到 GitHub 上的远程仓库：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push origin master</span></span><br></pre></td></tr></table></figure>

<h3 id="从远程仓库拉取修改"><a href="#从远程仓库拉取修改" class="headerlink" title="从远程仓库拉取修改"></a>从远程仓库拉取修改</h3><p><code>git push</code> 会同步<strong>远程</strong>仓库与<strong>本地</strong>仓库。要执行相反操作（将<strong>本地仓库</strong>与<strong>远程仓库</strong>同步），我们需要使用 <code>git pull</code>。<code>git pull</code> 的格式与 <code>git push</code> 的非常相似 - 提供远程仓库的简写名，以及你要拉取 commit 的分支名称。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull origin master</span></span><br></pre></td></tr></table></figure>

<h4 id="Fetch-vs-Pull"><a href="#Fetch-vs-Pull" class="headerlink" title="Fetch vs Pull"></a>Fetch vs Pull</h4><p>git fetch 用于从远程仓库分支检索 commit ，但<strong>不会</strong>在收到这些 commit 之后，自动将本地分支与远程跟踪分支合并。</p>
<p>上面的段落有点密集，你可以多读几遍。</p>
<p>你需要向 <code>git fetch</code> 提供和 <code>git pull</code> 完全相同的信息，也就是说要提供你想获取的远程仓库的简写名及其分支：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git fetch origin master</span></span><br></pre></td></tr></table></figure>

<p>运行 <code>git fetch</code> 后，会发生以下活动：</p>
<ul>
<li>远程分支上的 commit 会复制到本地仓库</li>
<li>本地跟踪分支（例如，<code>origin/master</code>）移到指向最新的 commit</li>
</ul>
<p>需要注意的一点是，本地分支完全不会被改变。</p>
<p>你可以将 <code>git fetch</code> 想象成 <code>git pull</code> 它的一半操作，而 <code>git pull</code> 的另一半是合并。</p>
<p>使用 <code>git fetch</code> 而不是 <code>git pull</code> 的一个主要情形是当你的远程分支和本地分支都拥有对方所没有的更改时。在这种情况下，你要获取远程更改，将它们存储到本地分支中，然后手动执行合并。最后，你可以将新的合并 commit 推送会远程仓库。</p>
<h2 id="常见终端命令"><a href="#常见终端命令" class="headerlink" title="常见终端命令"></a>常见终端命令</h2><ul>
<li><pre><code>ls
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  \- 用来列出文件和目录</span><br><span class="line"></span><br><span class="line">  - &#96;ls -l&#96; 列出文件和目录（长列表形式，更详细）</span><br><span class="line">  - &#96;ls *.png&#96; 列出后缀为 png 的图像文件</span><br><span class="line"></span><br><span class="line">- &#96;mkdir&#96; - 用来新建目录</span><br><span class="line"></span><br><span class="line">- &#96;&#96;&#96;</span><br><span class="line">  mv</span><br></pre></td></tr></table></figure>

\- 移动文件

- `mv logo.png Project` 把 logo.png 文件移入 Project 文件夹
- `mv Document/*.png Project` 把 Document 文件夹下所有 .png 结尾文件扔进 Project 文件夹</code></pre>
</li>
<li><p><code>cd</code> - 用来更换当前目录</p>
</li>
<li><p><code>pwd</code> - 查看当前工作目录</p>
</li>
<li><p><code>rm</code> - 用来删除文件和目录</p>
</li>
<li><p><code>rmdir</code> - 用来删除目录</p>
</li>
<li><pre><code>cat</code></pre>
<p>- 查看文件内容（文件内容过多会直接定位到文件最底部）</p>
<ul>
<li><code>cat less</code> 只显示一屏高度的文件内容（按下 q 退出）</li>
</ul>
</li>
</ul>
<h3 id="less-分页器"><a href="#less-分页器" class="headerlink" title="less 分页器"></a>less 分页器</h3><ul>
<li>要<strong>向下</strong>滚动，按下</li>
<li><code>j</code> 或 <code>↓</code> 一次向下移动一行</li>
<li><code>d</code> 按照一半的屏幕幅面移动</li>
<li><code>f</code> 按照整个屏幕幅面移动</li>
<li>要 <strong>向上</strong>滚动，按上</li>
<li><code>k</code> 或 <code>↑</code> 一次向上移动一行</li>
<li><code>u</code> 按照一半的屏幕幅面移动</li>
<li><code>b</code> 按照整个屏幕幅面移动</li>
<li>按下 <code>q</code> 可以<strong>退出</strong>日志（返回普通的命令提示符）</li>
</ul>
]]></content>
      <categories>
        <category>工具</category>
        <category>版本控制</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>Grid布局入门</title>
    <url>/posts/42136/</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><h3 id="什么是-Grid-Layout"><a href="#什么是-Grid-Layout" class="headerlink" title="什么是 Grid Layout"></a>什么是 Grid Layout</h3><p>Grid Layout 翻译过来是[网格布局]的意思，它是一个二维系统，包含了行（row）与列（column）以及间距（gap）。下图能够很好的说明这一点（图片来自<a href="https://developer.mozilla.org/zh-CN/docs/Learn/CSS/CSS_layout/Grids">mdn</a>）：</p>
<img src="/posts/42136/grid.png" class="" title="grid_layout">

<a id="more"></a>

<h3 id="Grid-vs-Flex"><a href="#Grid-vs-Flex" class="headerlink" title="Grid vs Flex"></a>Grid vs Flex</h3><p>工作中写移动端页面的朋友对 Flex 布局肯定不陌生，有些人可能更极端一点，直接 Flex 一把梭。那 Grid 和 Flex 有什么区别呢？我们仍然可以用一张图片进行举例说明：</p>
<img src="/posts/42136/gridvflex.png" class="" title="grid-vs-flex">

<p>在上图中，我们可以使用 Grid 来搭建页面的整体结构；而使用 Flex 控制 Grid 中的单个区域，例如顶部导航栏中的具体内容。</p>
<p><strong>Grid vs Flex 总结</strong></p>
<ul>
<li>Grid 是一种二维布局方式，而 Flex 是一维的。</li>
<li>Grid 重点关注布局, 而 Flex 重点关注内容的流向。</li>
<li>Flex 适用于应用的组件，而 Grid 适用于应用本身的布局。</li>
</ul>
<p>总的来说，Grid 擅长搭建布局结构，而 Flex 则擅长处理元素的流向。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="行与列"><a href="#行与列" class="headerlink" title="行与列"></a>行与列</h3><p>首先我们需要将容器的 display 属性设置为 grid，然后使用下列 CSS 属性来控制其中的行与列：</p>
<ul>
<li>grid-template-columns 用来划分列数</li>
<li>grid-template-rows 用来划分行数</li>
</ul>
<h4 id="固定宽度-amp-百分比宽度"><a href="#固定宽度-amp-百分比宽度" class="headerlink" title="固定宽度 &amp; 百分比宽度"></a>固定宽度 &amp; 百分比宽度</h4><iframe height="826" scrolling="no" title="01-grid-行与列基本使用" src="https://codepen.io/JingW/embed/RwNjowB?height=826&amp;theme-id=default&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="重复设置"><a href="#重复设置" class="headerlink" title="重复设置"></a>重复设置</h4><p>通过上面 demo 你会发现一个问题，如果一行有 3 列，我们就需要定义 3 列各自的宽，那如果有 10 列，20 列呢？难道都需要一个个设置，岂不是太麻烦了？所以重复设置的需求应运而生。我们可以使用 <code>repeat</code> 统一设置值，第一个参数为重复数量，第二个参数是重复值。下面是两个示例：</p>
<iframe height="1030" scrolling="no" title="02-grid-repeat重复" src="https://codepen.io/JingW/embed/abzVQmR?height=1020&amp;theme-id=default&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="比例划分"><a href="#比例划分" class="headerlink" title="比例划分"></a>比例划分</h4><p>我们还可以像 Flex 布局的 <code>flex: 1</code> 那样，给布局中的元素设置比例。在 Grid 中，我们使用 <code>fr</code> 这个单位来设置元素在空间中所占的比例。</p>
<iframe height="700" scrolling="no" title="03-grid-比例划分" src="https://codepen.io/JingW/embed/oNgoQEK?height=700&amp;theme-id=default&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="组合定义"><a href="#组合定义" class="headerlink" title="组合定义"></a>组合定义</h4><p><code>grid-tempalte</code> 是 <code>grid-template-rows</code>、<code>grid-template-columns</code>、<code>grid-template-areas</code> 的三个属性的简写。</p>
<p>下面是使用 <code>grid-template</code> 同时声明 <code>grid-template-rows、grid-template-columns</code>。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">grid-template</span>: 100<span class="selector-tag">px</span> 1<span class="selector-tag">fr</span> / 50<span class="selector-tag">px</span> 1<span class="selector-tag">fr</span>;</span><br></pre></td></tr></table></figure>

<p>下面是使用 <code>grid-template</code> 定义 <code>grid-template-areas</code> ，有关 <code>grid-template-areas</code> 的使用方法会在下面介绍：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">grid-template</span>:</span><br><span class="line">  &#x27;header . .&#x27;</span><br><span class="line">  &#x27;. main .&#x27;</span><br><span class="line">  &#x27;footer footer .&#x27;;</span><br></pre></td></tr></table></figure>

<iframe height="1133" scrolling="no" title="yLyPQjj" src="https://codepen.io/JingW/embed/yLyPQjj?height=1133&amp;theme-id=default&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="minmax"><a href="#minmax" class="headerlink" title="minmax"></a>minmax</h4><p>使用 minmax 方法可以设置取值范围。下面行高在 <code>最小100px ~ 最大1fr</code> 间取值：</p>
<iframe height="531" scrolling="no" title="05-grid-minmax设置最大最小值" src="https://codepen.io/JingW/embed/dyPZQro?height=531&amp;theme-id=default&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="间距"><a href="#间距" class="headerlink" title="间距"></a>间距</h3><h4 id="行间距"><a href="#行间距" class="headerlink" title="行间距"></a>行间距</h4><iframe height="439" scrolling="no" title="06-grid-行间距row-gap" src="https://codepen.io/JingW/embed/ExabOqB?height=439&amp;theme-id=default&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="列间距"><a href="#列间距" class="headerlink" title="列间距"></a>列间距</h4><iframe height="443" scrolling="no" title="07-grid-列间距column-gap" src="https://codepen.io/JingW/embed/QWwOzLr?height=443&amp;theme-id=default&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="间距简写"><a href="#间距简写" class="headerlink" title="间距简写"></a>间距简写</h4><p>使用 gap 规则可以一次定义行、列间距，如果间距一样可以只设置一个值：</p>
<iframe height="437" scrolling="no" title="07-grid-间距简写gap" src="https://codepen.io/JingW/embed/zYxPyOQ?height=437&amp;theme-id=default&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="网格线命名"><a href="#网格线命名" class="headerlink" title="网格线命名"></a>网格线命名</h3><p>通过 grid-template-rows 和 grid-template-columns 定义网格时，网格线可以被命名。网格线名称也可以设置网格项目位置</p>
<p>分配网格线名称必须用方括号[网格线名称]，然后后面紧跟网格轨道的尺寸值。定义网格线名称时需要避免使用规范中出现的关键词，以免导致混乱。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">grid-template-rows</span>: <span class="selector-attr">[row-1-start]</span> 1<span class="selector-tag">fr</span> <span class="selector-attr">[row-2-start]</span> 1<span class="selector-tag">fr</span> <span class="selector-attr">[row-2-end]</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">grid-template-columns</span>: <span class="selector-attr">[col-1-start]</span> 1<span class="selector-tag">fr</span> <span class="selector-attr">[col-2-start]</span> 1<span class="selector-tag">fr</span> <span class="selector-attr">[col-3-start]</span> 1<span class="selector-tag">fr</span> <span class="selector-attr">[col-3-end]</span>;</span><br></pre></td></tr></table></figure>

<img src="/posts/42136/shangexian.png" class="" title="栅格线">

<p>可以在方括号中添加多个名称来命名网格线名称，使用多外名称命名网格线名称时，名称间要用空格隔开。每一个网格线的名称可以用来定位网格项目的位置</p>
<img src="/posts/42136/shangexianduomingming.png" class="" title="栅格线多命名">

<p>使用网格线名称设置网格项目位置和使用网格线号码设置网格项目位置类似，引用网格线名称的时候不应该带方括号</p>
<p>使用 repeat()函数可以给网格线分配相同的名称。这可以节省一定的时间。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">grid-template-rows</span>: <span class="selector-tag">repeat</span>(3, <span class="selector-attr">[row-start]</span> 1<span class="selector-tag">fr</span> <span class="selector-attr">[row-end]</span>);</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">grid-template-columns</span>: <span class="selector-tag">repeat</span>(3, <span class="selector-attr">[col-start]</span> 1<span class="selector-tag">fr</span> <span class="selector-attr">[col-end]</span>);</span><br></pre></td></tr></table></figure>

<p>使用 repeat()函数可以给网格线命名，这也导致多个网格线具有相同的网格线名称。相同网格线名称指定网格线的位置和名称，也且会自动在网格线名称后面添加对应的数字，使其网格线名称也是唯一的标识符</p>
<img src="/posts/42136/shangexianrepeat.png" class="" title="repeat命名栅格线">

<p>使用相同的网格线名称可以设置网格项目的位置。网格线的名称和数字之间需要用空格分开</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">grid-row</span>: <span class="selector-tag">row-start</span> 2 / <span class="selector-tag">row-end</span> 3;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">grid-column</span>: <span class="selector-tag">col-start</span> / <span class="selector-tag">col-start</span> 3;</span><br></pre></td></tr></table></figure>

<h3 id="网格区域命名"><a href="#网格区域命名" class="headerlink" title="网格区域命名"></a>网格区域命名</h3><p>像网格线名称一样，网格区域的名称可以使用 grid-template-areas 属性来命名。引用网格区域名称也可以设置网格项目位置。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">grid-template-areas: &#x27;header header&#x27; &#x27;content sidebar&#x27; &#x27;footer footer&#x27;;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">grid-template-rows</span>: 150<span class="selector-tag">px</span> 1<span class="selector-tag">fr</span> 100<span class="selector-tag">px</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">grid-template-columns</span>: 1<span class="selector-tag">fr</span> 200<span class="selector-tag">px</span>;</span><br></pre></td></tr></table></figure>

<p>设置网格区域的名称应该放置在单引号或双引号内，每个名称由一个空格符分开。网格区域的名称，每组（单引号或双引号内的网格区域名称）定义了网格的一行，每个网格区域名称定义网格的一列</p>
<p><strong>[注意]grid-template-areas: “header header” “content sidebar” “footer footer”;不可以简写为 grid-template-areas: “header” “content sidebar” “footer”;</strong></p>
<img src="/posts/42136/grid-template-areas.png" class="" title="grid-template-areas">

<p>grid-row-start、grid-row-end、grid-column-start 和 grid-column-end 以及简写的 grid-row、grid-column、grid-area 都可以引用网格区域名称，用来设置网格项目位置</p>
<h3 id="元素定位"><a href="#元素定位" class="headerlink" title="元素定位"></a>元素定位</h3><table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">grid-row-start</td>
<td align="left">行开始栅格线</td>
</tr>
<tr>
<td align="left">grid-row-end</td>
<td align="left">行结束栅格线</td>
</tr>
<tr>
<td align="left">grid-column-start</td>
<td align="left">列开始栅格线</td>
</tr>
<tr>
<td align="left">grid-column-end</td>
<td align="left">列结束栅格线</td>
</tr>
</tbody></table>
<h4 id="根据栅格线"><a href="#根据栅格线" class="headerlink" title="根据栅格线"></a>根据栅格线</h4><p>通过设置具体的第几条栅格线来设置区域位置，设置的数值可以是正数和负数：</p>
<iframe height="435" scrolling="no" title="09-grid-栅格线" src="https://codepen.io/JingW/embed/oNgomod?height=435&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="根据栅格命名"><a href="#根据栅格命名" class="headerlink" title="根据栅格命名"></a>根据栅格命名</h4><iframe height="436" scrolling="no" title="10-grid-栅格线命名" src="https://codepen.io/JingW/embed/mdyqvgZ?height=436&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="根据偏移量"><a href="#根据偏移量" class="headerlink" title="根据偏移量"></a>根据偏移量</h4><p>使用 <code>span</code> 可以设置移动单元格数量，数值只能为正数。</p>
<ul>
<li>设置在 <code>grid-*-end</code> 表示 <code>grid-*-end</code> 栅格线是从 <code>grid-*-start</code> 移动几个单元格</li>
<li>设置在 <code>grid-*-start</code> 表示 <code>grid-*-start</code> 栅格线是从 <code>grid-*-end</code> 移动几个单元格</li>
</ul>
<iframe height="445" scrolling="no" title="11-grid-偏移量" src="https://codepen.io/JingW/embed/dyPZrOE?height=445&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="推荐-简写模式-grid-row-grid-column"><a href="#推荐-简写模式-grid-row-grid-column" class="headerlink" title="[推荐]简写模式 grid-row/grid-column"></a>[推荐]简写模式 grid-row/grid-column</h4><p>可以使用 <code>grid-row</code> 设置行开始栅格线，使用 <code>grid-column</code> 设置结束栅格线。</p>
<p>上例中的居中对齐元素，可以使用以下简写的方式声明（推荐）。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">grid-row</span>: 2/3;</span><br><span class="line"><span class="selector-tag">grid-column</span>: 2/3;</span><br></pre></td></tr></table></figure>

<iframe height="438" scrolling="no" title="12-grid-grid-row/grid-column简写形式" src="https://codepen.io/JingW/embed/bGNabrX?height=438&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="简写形式-grid-area"><a href="#简写形式-grid-area" class="headerlink" title="简写形式 grid-area"></a>简写形式 grid-area</h4><p><code>grid-area</code> 更加简洁是同时对 <code>grid-row</code> 与 <code>grid-column</code> 属性的组合声明。</p>
<p>语法结构如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">grid-row-start</span>/<span class="selector-tag">grid-column-start</span>/<span class="selector-tag">grid-row-end</span>/<span class="selector-tag">grid-column-end</span></span><br></pre></td></tr></table></figure>

<p>下面是将元素定位在中间的示例：</p>
<iframe height="412" scrolling="no" title="13-grid-grid-area简写形式" src="https://codepen.io/JingW/embed/mdypbBQ?height=412&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="栅格流动"><a href="#栅格流动" class="headerlink" title="栅格流动"></a>栅格流动</h3><p>在容器中设置<code>grid-auto-flow</code> 属性可以改变单元流动方式。</p>
<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">column</td>
<td align="left">按列排序</td>
</tr>
<tr>
<td align="left">row</td>
<td align="left">按行排列</td>
</tr>
</tbody></table>
<h4 id="栅格流动的基本使用"><a href="#栅格流动的基本使用" class="headerlink" title="栅格流动的基本使用"></a>栅格流动的基本使用</h4><iframe height="557" scrolling="no" title="14-grid-grid-auto-flow栅格流动" src="https://codepen.io/JingW/embed/gObobYm?height=557&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="强制填充"><a href="#强制填充" class="headerlink" title="强制填充"></a>强制填充</h4><p>当元素在栅格中放不下时，将会发生换行产生留白，使用 grid-auto-flow: row dense; 可以执行填充空白区域操作。</p>
<iframe height="495" scrolling="no" title="15-grid-强制填充" src="https://codepen.io/JingW/embed/eYmymZX?height=495&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="栅格对齐"><a href="#栅格对齐" class="headerlink" title="栅格对齐"></a>栅格对齐</h3><p>可以通过属性方便的定义栅格的对齐方式，可用值包括 <code>start | end | center | stretch | space-between | space-evenly | space-around</code>。</p>
<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">说明</th>
<th align="left">对象</th>
</tr>
</thead>
<tbody><tr>
<td align="left">align-items</td>
<td align="left">栅格内所有元素的垂直排列方式</td>
<td align="left">栅格容器</td>
</tr>
<tr>
<td align="left">justify-items</td>
<td align="left">栅格内所有元素的横向排列方式</td>
<td align="left">栅格容器</td>
</tr>
<tr>
<td align="left">justify-content</td>
<td align="left">所有栅格在容器中的水平对齐方式，容器有额外空间时</td>
<td align="left">栅格容器</td>
</tr>
<tr>
<td align="left">align-content</td>
<td align="left">所有栅格在容器中的垂直对齐方式，容器有额外空间时</td>
<td align="left">栅格容器</td>
</tr>
<tr>
<td align="left">align-self</td>
<td align="left">元素在栅格中垂直对齐方式</td>
<td align="left">栅格元素</td>
</tr>
<tr>
<td align="left">justify-self</td>
<td align="left">元素在栅格中水平对齐方式</td>
<td align="left">栅格元素</td>
</tr>
</tbody></table>
<iframe height="559" scrolling="no" title="16-grid-元素对齐" src="https://codepen.io/JingW/embed/LYEeERG?height=559&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="组合简写-place-content"><a href="#组合简写-place-content" class="headerlink" title="组合简写 place-content"></a>组合简写 place-content</h4><p>用于控制栅格的对齐方式，语法如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">place-content</span>: &lt;<span class="selector-tag">align-content</span>&gt; &lt;<span class="selector-tag">justify-content</span>&gt;;</span><br></pre></td></tr></table></figure>

<h4 id="组合简写-place-items"><a href="#组合简写-place-items" class="headerlink" title="组合简写 place-items"></a>组合简写 place-items</h4><p>控制所有元素的对齐方式，语法结构如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">place-items</span>: &lt;<span class="selector-tag">align-items</span>&gt; &lt;<span class="selector-tag">justify-items</span>&gt;;</span><br></pre></td></tr></table></figure>

<h4 id="组合简写-place-self"><a href="#组合简写-place-self" class="headerlink" title="组合简写 place-self"></a>组合简写 place-self</h4><p>控制单个元素的对齐方式</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">place-self</span>: &lt;<span class="selector-tag">align-self</span>&gt; &lt;<span class="selector-tag">justify-self</span>&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul>
<li><a href="https://www.cnblogs.com/wangxiang9528/p/9867822.html">Grid 布局方式的实例详解</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS3</tag>
        <tag>Grid</tag>
      </tags>
  </entry>
  <entry>
    <title>H5在移动端上传头像图片旋转90度问题解决方案</title>
    <url>/posts/26493/</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>移动端上的 H5 页面，在拍照上传后会出现图片自动旋转 90° 的问题，这里记录下解决方案。</p>
<h2 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h2><p>从图片 Exif 信息中读取 Orientation，根据它来判断是否该修正图片的方向：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取照片方向角属性，用户旋转控制</span></span><br><span class="line"><span class="keyword">let</span> Orientation = <span class="literal">null</span>;</span><br><span class="line">EXIF.getData(image, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  Orientation = EXIF.getTag(<span class="built_in">this</span>, <span class="string">&#x27;Orientation&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">switch</span> (Orientation) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// 不需要选择，正常</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">6</span>: <span class="comment">// 需要顺时针（向左）90度旋转</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">8</span>: <span class="comment">// 需要逆时针（向右）90度旋转</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">3</span>: <span class="comment">// 需要180度旋转</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>然后用 canvas 的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage">ctx.drawImage</a> 对图片进行绘制，最后用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLCanvasElement/toDataURL">canvas.toDataURL</a> 将画布转为 base64 格式数据的 DataURL 传给后端。</p>
<p>P.S. 什么是 EXIF</p>
<p>Exif（Exchangeable image file format）是专门为数码相机拍摄的照片定义的，可以记录数码照片的属性信息和拍摄数据。<br>Exif 可以附加于 JPEG、TIFF、RIFF 等文件之中，为其增加有关数码相机拍摄信息的内容和索引图或图像处理软件的版本信息。<br>Exif 信息是可以被任意编辑的，因此只有参考的功能。Exif 可能会泄露隐私信息，请选择图片查看其 Exif 信息。</p>
<h2 id="具体代码"><a href="#具体代码" class="headerlink" title="具体代码"></a>具体代码</h2><p>引入 <code>exif.js</code> ：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/exif-js/2.3.0/exif.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>uni-app 下创建上传头像组件：</p>
<blockquote>
<p>yyt-upload-img.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;yyt-upload-img&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> &#123; <span class="keyword">default</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./yyt-upload-img.js&#x27;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="keyword">@import</span> url(<span class="string">&#x27;yyt-upload-img.less&#x27;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>yyt-upload-img.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;yyt-upload-img&#x27;</span>,</span><br><span class="line">  <span class="comment">// 注册属性</span></span><br><span class="line">  props: &#123;</span><br><span class="line">    <span class="comment">// 图片最大Size(兆M)</span></span><br><span class="line">    maxSize: &#123;</span><br><span class="line">      type: <span class="built_in">Number</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="number">9</span>,</span><br><span class="line">      required: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 图片最大宽度(px)</span></span><br><span class="line">    maxWidth: &#123;</span><br><span class="line">      type: <span class="built_in">Number</span>,</span><br><span class="line">      <span class="keyword">default</span>: uni.upx2px(<span class="number">500</span>),</span><br><span class="line">      required: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getImgUrl: &#123;</span><br><span class="line">      type: <span class="built_in">Function</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">      <span class="comment">// required: true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;&#125;,</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 图片信息</span></span><br><span class="line">      picInfo: &#123;</span><br><span class="line">        imgSize: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 图片大小M</span></span><br><span class="line">        picName: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 图片名称</span></span><br><span class="line">        url: <span class="string">&#x27;&#x27;</span> <span class="comment">// 图片地址</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 开始选择图片</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">_startChoose</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 选择图片</span></span><br><span class="line">      <span class="keyword">let</span> [error, imgRes] = <span class="keyword">await</span> uni.chooseImage(&#123;</span><br><span class="line">        count: <span class="number">1</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 验证大小</span></span><br><span class="line">      <span class="keyword">let</span> size = imgRes.tempFiles[<span class="number">0</span>].size;</span><br><span class="line">      <span class="keyword">if</span> (size / <span class="number">1024000</span> &gt; <span class="built_in">this</span>.maxSize) &#123;</span><br><span class="line">        <span class="built_in">this</span>.$cw.showError(<span class="string">`图片不能大于<span class="subst">$&#123;<span class="built_in">this</span>.maxSize&#125;</span>M`</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//文件路径</span></span><br><span class="line">      <span class="keyword">let</span> filePath = imgRes.tempFiles[<span class="number">0</span>].name;</span><br><span class="line">      <span class="comment">// 临时文件列表</span></span><br><span class="line">      <span class="keyword">const</span> tempFilePaths = imgRes.tempFiles;</span><br><span class="line">      <span class="comment">// 获取最后一个.的位置</span></span><br><span class="line">      <span class="keyword">let</span> index = filePath.lastIndexOf(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">      <span class="comment">// 文件大小</span></span><br><span class="line">      <span class="built_in">this</span>.picInfo.imgSize = (tempFilePaths[<span class="number">0</span>].size / <span class="number">1048576</span>).toFixed(<span class="number">2</span>);</span><br><span class="line">      <span class="built_in">this</span>.picInfo.picName = tempFilePaths[<span class="number">0</span>].name; <span class="comment">//上传人文件描述 名字</span></span><br><span class="line">      <span class="comment">//获取后缀</span></span><br><span class="line">      <span class="keyword">let</span> ext = filePath.substr(index + <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> ([<span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;bmp&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>].indexOf(ext) == -<span class="number">1</span>) &#123;</span><br><span class="line">        uni.showToast(&#123;</span><br><span class="line">          title: <span class="string">&#x27;图片格式不正确&#x27;</span>,</span><br><span class="line">          icon: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> baseStr = <span class="keyword">await</span> <span class="built_in">this</span>.uploadImg(&#123;</span><br><span class="line">        url: imgRes.tempFiles[<span class="number">0</span>].path</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="built_in">console</span>.log(&#123;</span><br><span class="line">        baseStr</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">if</span> (baseStr) &#123;</span><br><span class="line">        <span class="keyword">let</span> [error2, res] = <span class="keyword">await</span> uni.uploadFile(&#123;</span><br><span class="line">          url: getApp().globalData.PicDomain,</span><br><span class="line">          fileType: <span class="string">&#x27;image&#x27;</span>,</span><br><span class="line">          filePath: baseStr,</span><br><span class="line">          name: <span class="string">&#x27;file&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> fileData = <span class="built_in">JSON</span>.parse(res.data);</span><br><span class="line">        <span class="built_in">this</span>.picInfo.url = <span class="string">`<span class="subst">$&#123;getApp().globalData.PicDomain&#125;</span><span class="subst">$&#123;fileData.path&#125;</span>`</span>;</span><br><span class="line">        <span class="comment">// 通知已拿到数据</span></span><br><span class="line">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;getImgUrl&#x27;</span>, <span class="built_in">this</span>.picInfo);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.$cw.showError(<span class="string">&#x27;上传失败，请重试&#x27;</span>);</span><br><span class="line">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;getImgUrl&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 图片上传</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">uploadImg</span>(<span class="params">opt</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> maxWidth = uni.upx2px(<span class="built_in">this</span>.maxWidth);</span><br><span class="line">      opt = opt || &#123;&#125;;</span><br><span class="line">      opt.url = opt.url || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="keyword">let</span> Orientation = <span class="number">1</span>;</span><br><span class="line">      <span class="comment">//获取图片META信息</span></span><br><span class="line">      <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="built_in">this</span>.getImageTag(opt.url, <span class="string">&#x27;Orientation&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">undefined</span>) Orientation = e;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">var</span> img = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">var</span> canvas = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">let</span> obj = <span class="keyword">await</span> <span class="built_in">this</span>.loadingImage(opt.url);</span><br><span class="line">      <span class="keyword">if</span> (obj) &#123;</span><br><span class="line">        img = obj.img;</span><br><span class="line">        canvas = obj.canvas;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(Orientation);</span><br><span class="line">        <span class="keyword">let</span> baseStr = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="comment">//如果方向角不为1，都需要进行旋转</span></span><br><span class="line">        <span class="keyword">switch</span> (Orientation) &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">6</span>: <span class="comment">//需要顺时针（向右）90度旋转</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;（向右）90度旋转&#x27;</span>);</span><br><span class="line">            baseStr = <span class="built_in">this</span>.rotateImg(img, <span class="string">&#x27;right&#x27;</span>, canvas);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">8</span>: <span class="comment">//需要逆时针（向左）90度旋转</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;向左）90度旋转&#x27;</span>);</span><br><span class="line">            baseStr = <span class="built_in">this</span>.rotateImg(img, <span class="string">&#x27;left&#x27;</span>, canvas);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> <span class="number">3</span>: <span class="comment">//需要180度旋转 转两次</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;需要180度旋转&#x27;</span>);</span><br><span class="line">            baseStr = <span class="built_in">this</span>.rotateImg(img, <span class="string">&#x27;right&#x27;</span>, canvas, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            baseStr = <span class="built_in">this</span>.rotateImg(img, <span class="string">&#x27;&#x27;</span>, canvas);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> baseStr;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description </span>加载图片</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>imgSrc 图片地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">loadingImage</span>(<span class="params">imgSrc</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!imgSrc) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">let</span> [err, res] = <span class="keyword">await</span> uni.getImageInfo(&#123;</span><br><span class="line">        src: imgSrc</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res) &#123;</span><br><span class="line">          <span class="keyword">let</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">          img.style.opacity = <span class="number">1</span>;</span><br><span class="line">          img.style.backgroundColor = <span class="string">&#x27;#FFFFFF&#x27;</span>;</span><br><span class="line">          img.src = res.path;</span><br><span class="line">          img.width = res.width;</span><br><span class="line">          img.height = res.height;</span><br><span class="line"></span><br><span class="line">          img.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">            <span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">            obj.img = img;</span><br><span class="line">            obj.canvas = canvas;</span><br><span class="line">            resolve(obj);</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          that.$cw.showError(<span class="string">&#x27;加载图片失败，请重试！&#x27;</span>);</span><br><span class="line">          reject(<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@desc </span>获取图片信息，使用exif.js库，具体用法请在github中搜索</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>file 上传的图片文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>tag 需要获取的信息 例如：&#x27;Orientation&#x27;旋转信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;Promise&lt;Any&gt;&#125;</span> </span>读取是个异步操作，返回指定的图片信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getImageTag</span>(<span class="params">file, tag, cb</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!file) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">let</span> that = <span class="built_in">this</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> imgObj = <span class="keyword">new</span> Image();</span><br><span class="line">        imgObj.src = file;</span><br><span class="line"></span><br><span class="line">        uni.getImageInfo(&#123;</span><br><span class="line">          src: file,</span><br><span class="line">          <span class="function"><span class="title">success</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(&#123;</span><br><span class="line">              res</span><br><span class="line">            &#125;);</span><br><span class="line">            EXIF.getData(imgObj, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line">              EXIF.getAllTags(<span class="built_in">this</span>);</span><br><span class="line">              <span class="keyword">let</span> or = EXIF.getTag(<span class="built_in">this</span>, <span class="string">&#x27;Orientation&#x27;</span>); <span class="comment">//这个Orientation 就是我们判断需不需要旋转的值了，有1、3、6、8</span></span><br><span class="line">              resolve(cb(or));</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function"><span class="title">fail</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">            that.$cw.showError(<span class="string">&#x27;加载图片失败，请换张图片重试！&#x27;</span>);</span><br><span class="line">            reject(<span class="literal">null</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//网上提供的旋转function</span></span><br><span class="line">    <span class="function"><span class="title">rotateImg</span>(<span class="params">img, direction, canvas, times = <span class="number">1</span></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;开始旋转&#x27;</span>);</span><br><span class="line">      <span class="comment">//最小与最大旋转方向，图片旋转4次后回到原方向</span></span><br><span class="line">      <span class="keyword">var</span> min_step = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">var</span> max_step = <span class="number">3</span>;</span><br><span class="line">      <span class="keyword">if</span> (img == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="comment">//img的高度和宽度不能在img元素隐藏后获取，否则会出错</span></span><br><span class="line">      <span class="keyword">var</span> height = img.height;</span><br><span class="line">      <span class="keyword">var</span> width = img.width;</span><br><span class="line">      <span class="comment">// debugger</span></span><br><span class="line">      <span class="keyword">let</span> maxWidth = <span class="built_in">this</span>.maxWidth;</span><br><span class="line">      <span class="keyword">let</span> canvasWidth = width; <span class="comment">//图片原始长宽</span></span><br><span class="line">      <span class="keyword">let</span> canvasHeight = height;</span><br><span class="line">      <span class="keyword">let</span> base = canvasWidth / canvasHeight;</span><br><span class="line">      <span class="keyword">if</span> (canvasWidth &gt; maxWidth) &#123;</span><br><span class="line">        canvasWidth = maxWidth;</span><br><span class="line">        canvasHeight = <span class="built_in">Math</span>.floor(canvasWidth / base);</span><br><span class="line">      &#125;</span><br><span class="line">      width = canvasWidth;</span><br><span class="line">      height = canvasHeight;</span><br><span class="line">      <span class="keyword">var</span> step = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (step == <span class="literal">null</span>) &#123;</span><br><span class="line">        step = min_step;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (direction == <span class="string">&#x27;right&#x27;</span>) &#123;</span><br><span class="line">        step += times;</span><br><span class="line">        <span class="comment">//旋转到原位置，即超过最大值</span></span><br><span class="line">        step &gt; max_step &amp;&amp; (step = min_step);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == <span class="string">&#x27;left&#x27;</span>) &#123;</span><br><span class="line">        step -= times;</span><br><span class="line">        step &lt; min_step &amp;&amp; (step = max_step);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//不旋转</span></span><br><span class="line">        step = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//旋转角度以弧度值为参数</span></span><br><span class="line">      <span class="keyword">var</span> degree = (step * <span class="number">90</span> * <span class="built_in">Math</span>.PI) / <span class="number">180</span>;</span><br><span class="line">      <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">      <span class="comment">// 在canvas绘制前填充白色背景</span></span><br><span class="line">      ctx.fillStyle = <span class="string">&#x27;#fff&#x27;</span>;</span><br><span class="line">      ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="built_in">this</span>.maxWidth, <span class="built_in">this</span>.maxWidth);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">console</span>.log(degree);</span><br><span class="line">      <span class="built_in">console</span>.log(step);</span><br><span class="line">      <span class="keyword">switch</span> (step) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;右旋转 90度&#x27;</span>);</span><br><span class="line">          canvas.width = height;</span><br><span class="line">          canvas.height = width;</span><br><span class="line">          ctx.rotate(degree);</span><br><span class="line">          ctx.drawImage(img, <span class="number">0</span>, -height, width, height);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;旋转 180度&#x27;</span>);</span><br><span class="line">          canvas.width = width;</span><br><span class="line">          canvas.height = height;</span><br><span class="line">          ctx.rotate(degree);</span><br><span class="line">          ctx.drawImage(img, -width, -height, width, height);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;左旋转 90度&#x27;</span>);</span><br><span class="line">          canvas.width = height;</span><br><span class="line">          canvas.height = width;</span><br><span class="line">          ctx.rotate(degree);</span><br><span class="line">          ctx.drawImage(img, -width, <span class="number">0</span>, width, height);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="comment">//不旋转</span></span><br><span class="line">          canvas.width = width;</span><br><span class="line">          canvas.height = height;</span><br><span class="line">          <span class="built_in">console</span>.log(&#123;</span><br><span class="line">            ctx,</span><br><span class="line">            canvas</span><br><span class="line">          &#125;);</span><br><span class="line">          ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> imgData = ctx.getImageData(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">      <span class="keyword">var</span> data = imgData.data;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i += <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data[i + <span class="number">3</span>] &lt; <span class="number">255</span>) &#123;</span><br><span class="line">          data[i] = <span class="number">255</span> - data[i];</span><br><span class="line">          data[i + <span class="number">1</span>] = <span class="number">255</span> - data[i + <span class="number">1</span>];</span><br><span class="line">          data[i + <span class="number">2</span>] = <span class="number">255</span> - data[i + <span class="number">2</span>];</span><br><span class="line">          data[i + <span class="number">3</span>] = <span class="number">255</span> - data[i + <span class="number">3</span>];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      ctx.putImageData(imgData, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> baseStr = canvas.toDataURL(<span class="string">&#x27;image/png&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span> baseStr;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  filters: &#123;</span><br><span class="line">    <span class="comment">// parseScene(value) &#123;</span></span><br><span class="line">    <span class="comment">// return value+&#x27;123&#x27;;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    <span class="comment">// &quot;currentStore.storeId&quot;: &#123;</span></span><br><span class="line">    <span class="comment">//    handler(val, oldval) &#123;</span></span><br><span class="line">    <span class="comment">//        if (val) &#123;</span></span><br><span class="line">    <span class="comment">//        &#125;</span></span><br><span class="line">    <span class="comment">//    &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="使用组件"><a href="#使用组件" class="headerlink" title="使用组件"></a>使用组件</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">yyt-upload-img</span> <span class="attr">ref</span>=<span class="string">&quot;uploadImg&quot;</span> @<span class="attr">getImgUrl</span>=<span class="string">&quot;getImgUrl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">yyt-upload-img</span>&gt;</span></span><br><span class="line">// 点击上传头像按钮时调用 this.$refs.uploadImg._startChoose(); //</span><br><span class="line">获取上传后的http图片地址 getImgUrl(imgUrl) &#123; console.log(imgUrl); &#125;,</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>移动端</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>uniapp</tag>
        <tag>兼容性</tag>
        <tag>移动端</tag>
      </tags>
  </entry>
  <entry>
    <title>HTML5的自定义属性</title>
    <url>/posts/39974/</url>
    <content><![CDATA[<blockquote>
<p>在 HTML5 中我们可以自定义属性，其格式为 <code>data-*=&quot;&quot;</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;demo&quot;</span> <span class="attr">data-my-name</span>=<span class="string">&quot;sw&quot;</span> <span class="attr">data-age</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">/*</span><br><span class="line">  Node.dataset 是以对象形式存在的，当我们为同一个 DOM 节点指定了多个自定义属性时，</span><br><span class="line">  Node.dataset 则存储了所有的自定义属性的值。</span><br><span class="line">  */</span><br><span class="line"><span class="javascript"><span class="keyword">var</span> demo = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#demo&quot;</span>);</span></span><br><span class="line"><span class="javascript"><span class="comment">//获取</span></span></span><br><span class="line"><span class="javascript"><span class="comment">//注：当我们如下格式设置时，则需要以驼峰格式才能正确获取</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> name = demo.dataset[<span class="string">&#x27;myName&#x27;</span>];</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> age = demo.dataset[<span class="string">&#x27;age&#x27;</span>];</span></span><br><span class="line"><span class="javascript"><span class="comment">//设置</span></span></span><br><span class="line"><span class="javascript">demo.dataset[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;web developer&#x27;</span>;</span></span><br><span class="line"><span class="handlebars"><span class="xml"><span class="tag">&lt;<span class="name">script</span>/&gt;</span></span></span></span><br></pre></td></tr></table></figure>

<p><strong>资源</strong></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes/data-*">mdn - data-*</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>HTML</category>
      </categories>
  </entry>
  <entry>
    <title>HTML知识点（面试系列）</title>
    <url>/posts/55598/</url>
    <content><![CDATA[<h2 id="你对语义化的理解"><a href="#你对语义化的理解" class="headerlink" title="你对语义化的理解"></a>你对语义化的理解</h2><p>用正确的标签做正确的事情</p>
<ul>
<li>利于开发：使代码<strong>结构清晰</strong>，<strong>可读性高</strong>，<strong>方便维护</strong></li>
<li>利于 SEO：方便爬虫根据语义标签确定<strong>页面结构</strong>和<strong>关键字</strong>的权重</li>
</ul>
<a id="more"></a>

<h3 id="你在平常工作中使用过哪些语义标签？"><a href="#你在平常工作中使用过哪些语义标签？" class="headerlink" title="你在平常工作中使用过哪些语义标签？"></a>你在平常工作中使用过哪些语义标签？</h3><p>header, nav, aside, main, section, article, footer, canvas, video, audio</p>
<h3 id="你说你用过-canvas-video-audio，你是怎么用它们的？"><a href="#你说你用过-canvas-video-audio，你是怎么用它们的？" class="headerlink" title="你说你用过 canvas/video/audio，你是怎么用它们的？"></a>你说你用过 canvas/video/audio，你是怎么用它们的？</h3><ul>
<li><p>画布：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial">canvas</a></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">width</span>=<span class="string">&quot;500&quot;</span> <span class="attr">height</span>=<span class="string">&quot;500&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> canvas = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;canvas&#x27;</span>);</span></span><br><span class="line"><span class="handlebars"><span class="xml">    <span class="comment">&lt;!-- 获取上下文 --&gt;</span></span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span></span><br><span class="line">    ctx.beginPath();</span><br><span class="line"><span class="handlebars"><span class="xml">    <span class="comment">&lt;!-- 设置图形轮廓的颜色 --&gt;</span></span></span></span><br><span class="line"><span class="javascript">    ctx.strokeStyle = <span class="string">&#x27;red&#x27;</span>;</span></span><br><span class="line"><span class="handlebars"><span class="xml">    <span class="comment">&lt;!-- 绘制直线 --&gt;</span></span></span></span><br><span class="line">    ctx.moveTo(10, 20);</span><br><span class="line">    ctx.lineTo(100, 200);</span><br><span class="line">    ctx.stroke();</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>媒体元素：<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/video">video</a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/audio">audio</a></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">&quot;视频资源路径&quot;</span> <span class="attr">poster</span>=<span class="string">&quot;海报资源路径&quot;</span> <span class="attr">controls</span> <span class="attr">autoplay</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">&quot;音频资源路径&quot;</span> <span class="attr">controls</span> <span class="attr">autoplay</span> <span class="attr">loop</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="解释下移动端为什么要添加-meta-viewport-，怎么写？"><a href="#解释下移动端为什么要添加-meta-viewport-，怎么写？" class="headerlink" title="解释下移动端为什么要添加 meta viewport ，怎么写？"></a>解释下移动端为什么要添加 meta viewport ，怎么写？</h2><p>作用：</p>
<p>防止页面在移动端可以缩放。</p>
<p>写法：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;meta</span><br><span class="line">  name=&quot;viewport&quot;</span><br><span class="line">  content=&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>解释：</p>
<ul>
<li><p>使用 <code>viewport</code> 来控制浏览器视口的宽度和缩放比例</p>
</li>
<li><p>添加 <code>width=device-width</code> 以便让视口的宽度与设备一致</p>
</li>
<li><p>添加 <code>initial-scale=1.0</code> 设置初始缩放比例为 1.0</p>
</li>
<li><p>添加</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">user-scalable&#x3D;no</span><br></pre></td></tr></table></figure>

<p>使得用户不能放大或缩小网页</p>
<ul>
<li>添加 <code>minimum-scale=1.0, maximum-scale=1.0</code> 是为了兼容 iOS10 不支持 <code>user-scalable</code> 导致用户仍可缩放</li>
</ul>
</li>
</ul>
<p>参考阅读：</p>
<ul>
<li><strong><a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Mobile/Viewport_meta_tag">在移动浏览器中使用 viewport 元标签控制布局</a></strong></li>
<li><strong><a href="https://developers.google.cn/web/tools/lighthouse/audits/has-viewport-meta-tag?hl=zh-cn">HTML 具有视口元标记</a></strong></li>
<li><strong><a href="https://www.cnblogs.com/chunyangji/p/5795487.html">移动端 web 开发——视口</a></strong></li>
</ul>
<h2 id="关于图片，你了解哪些形式，你觉得哪种场合用哪种？它们优劣如何？然后这些图片的应用场景能说说不？"><a href="#关于图片，你了解哪些形式，你觉得哪种场合用哪种？它们优劣如何？然后这些图片的应用场景能说说不？" class="headerlink" title="关于图片，你了解哪些形式，你觉得哪种场合用哪种？它们优劣如何？然后这些图片的应用场景能说说不？"></a>关于图片，你了解哪些形式，你觉得哪种场合用哪种？它们优劣如何？然后这些图片的应用场景能说说不？</h2><table>
<thead>
<tr>
<th align="left">格式</th>
<th align="left">特点</th>
<th align="left">使用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">JPG/JPEG</td>
<td align="left">有损压缩 体积小 不支持透明</td>
<td align="left">1. 大的背景图； 2. 轮播图； 3. Banner 图</td>
</tr>
<tr>
<td align="left">PNG</td>
<td align="left">无损压缩 质量高 体积大 支持透明</td>
<td align="left">1. 小 Logo； 2. 透明背景</td>
</tr>
<tr>
<td align="left">GIF</td>
<td align="left">支持动画</td>
<td align="left">动态图片</td>
</tr>
<tr>
<td align="left">SVG</td>
<td align="left">文本文件 体积小 不失真 兼容性好</td>
<td align="left">能适应不同设备且画质不能损坏的图片</td>
</tr>
<tr>
<td align="left">Base64</td>
<td align="left">文本文件 依赖编码 小图标解决方案</td>
<td align="left">大小不超过 2KB，且更新率低的图片</td>
</tr>
<tr>
<td align="left">webp</td>
<td align="left">细节丰富 支持透明 支持动画 兼容性差</td>
<td align="left">Chrome UC 等浏览器支持，局限性大，一般不考虑</td>
</tr>
<tr>
<td align="left">雪碧图</td>
<td align="left">一次加载多处使用</td>
<td align="left">小图太多的时候，集中成一张图片减少 HTTP 请求</td>
</tr>
</tbody></table>
<p>更多阅读：<a href="https://github.com/LiangJunrong/document-library/blob/master/other-library/interview/personal-experience/other-%E5%9B%BE%E7%89%87.md">面试知识点 - 图片</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>JS严格模式vs非严格模式</title>
    <url>/posts/15966/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>以下为《JavaScript 高级程序设计（第 3 版）》中有关 <code>严格模式</code> 的笔记。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>“严格模式” 是 ECMAScript5 最早引入的概念。可以在函数内部选择进行较为严格的全局或局部的错误条件检测。使用严格模式的好处是可以提早知道代码中存在的错误，及时捕获一些可能导致编程错误的 ECMAScript 行为。</p>
<a id="more"></a>

<h2 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h2><p>在 JS 文件代码的顶部或者函数中输入下面字符串来开启严格模式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    &quot;use strict&quot;</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="严格模式-VS-非严格模式"><a href="#严格模式-VS-非严格模式" class="headerlink" title="严格模式 VS 非严格模式"></a>严格模式 VS 非严格模式</h2><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>在严格模式下，不允许意外的创建全局变量：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 未声明变量</span></span><br><span class="line">message = <span class="string">&#x27;Hello world&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非严格模式: 创建全局变量</span></span><br><span class="line"><span class="comment">// 严格模式: 抛出 ReferenceError</span></span><br></pre></td></tr></table></figure>

<hr>
<p>不能对变量调用 delete 操作符：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">copyvar color &#x3D; &quot;red&quot;;</span><br><span class="line">&#x2F;&#x2F; 删除变量</span><br><span class="line">delete color;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 非严格模式: 静默失败</span><br><span class="line">&#x2F;&#x2F; 严格模式: 抛出 ReferenceError</span><br></pre></td></tr></table></figure>

<hr>
<p>严格模式下对变量名也有限制。</p>
<p>不能使用 implements、interface、let、package、 private、protected、public、static 和 yield 作为变量名。这些都是保留字，将来的 ECMAScript 版本中可能会用到它们。在严格模式下，用以上标识符作为变量名会导致语法错误。</p>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p>在严格模式下操作对象比在非严格模式下更容易导致错误。一般来说，非严格模式下会静默失败的 情形，在严格模式下就会抛出错误。因此，在开发中使用严格模式会加大早发现错误的可能性。</p>
<p>在下列情形下操作对象的属性会导致错误:</p>
<ul>
<li>为只读属性赋值会抛出 TypeError;</li>
<li>对不可配置的(nonconfigurable)的属性使用 delete 操作符会抛出 TypeError;</li>
<li>为不可扩展的(nonextensible)的对象添加属性会抛出 TypeError。</li>
<li>使用对象的另一个限制与通过对象字面量声明对象有关。在使用对象字面量时，属性名必须唯一。</li>
</ul>
<p>例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 重名属性</span></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  name: <span class="string">&#x27;Nicholas&#x27;</span>,</span><br><span class="line">  name: <span class="string">&#x27;Greg&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非严格模式: 没有错误，以第二个属性为准</span></span><br><span class="line"><span class="comment">// 严格模式: 抛出语法错误</span></span><br></pre></td></tr></table></figure>

<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="函数的命名参数"><a href="#函数的命名参数" class="headerlink" title="函数的命名参数"></a>函数的命名参数</h4><p>严格模式要求命名函数的参数必须唯一。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 重名参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num, num</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非严格模式: 没有错误，只能访问第二个参数</span></span><br><span class="line"><span class="comment">//严格模式: 抛出语法错误</span></span><br></pre></td></tr></table></figure>

<p>在<strong>非严格模式</strong>下，这个函数声明不会抛出错误。通过参数名只能访问第二个参数，要访问第一个参数必须通过 <code>arguments</code> 对象。</p>
<h4 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h4><p>arguments 对象的行为所不同。</p>
<ul>
<li>在非严格模式下，修改命名参数的值也会反映到 arguments 对象中。</li>
<li>而严格模式下这两个值是完全独立的。</li>
</ul>
<p>例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 修改命名参数的值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showValue</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  value = <span class="string">&#x27;Foo&#x27;</span>;</span><br><span class="line">  alert(value); <span class="comment">//&quot;Foo&quot;</span></span><br><span class="line">  alert(<span class="built_in">arguments</span>[<span class="number">0</span>]); <span class="comment">// 非严格模式: &quot;Foo&quot; &lt;---&gt; 严格模式: &quot;Hi&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">showValue(<span class="string">&#x27;Hi&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>以上代码中，函数 showValue() 只有一个命名参数 value。调用这个函数时传入了一个参数”Hi”， 这个值赋给了 value。而在函数内部，value 被改为”Foo”。在非严格模式下，这个修改也会改变 arguments[0] 的值，但在严格模式下，arguments[0] 的值仍然是传入的值。</p>
<hr>
<p>另一个变化是淘汰了 arguments.callee 和 arguments.caller。在非严格模式下，这两个属性一个引用函数本身，一个引用调用函数。而在严格模式下，访问哪个属性都会抛出 TypeError。</p>
<p>例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 访问 arguments.callee</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (num &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> num * <span class="built_in">arguments</span>.callee(num - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result = factorial(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非严格模式: 没有问题</span></span><br><span class="line"><span class="comment">// 严格模式: 抛出 TypeError</span></span><br></pre></td></tr></table></figure>

<p>类似地，尝试读写函数的 caller 属性，也会导致抛出 TypeError。所以，对于上面的例子而言， 访问 factorial.caller 也会抛出错误。</p>
<h4 id="函数名"><a href="#函数名" class="headerlink" title="函数名"></a>函数名</h4><p>与变量类似，严格模式对函数名也做出了限制，不允许用 implements、interface、let、package、private、protected、public、static 和 yield 作为函数名。</p>
<h4 id="函数声明的位置"><a href="#函数声明的位置" class="headerlink" title="函数声明的位置"></a>函数声明的位置</h4><p>只能在脚本的顶级和在函数内部声明函数。也就是说，在 if 语句中声明函数会导致语法错误：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 if 语句中声明函数</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 非严格模式: 将函数提升到 if 语句外部</span></span><br><span class="line"><span class="comment">// 严格模式: 抛出语法错误</span></span><br></pre></td></tr></table></figure>

<h3 id="eval"><a href="#eval" class="headerlink" title="eval()"></a>eval()</h3><p>eval 在包含上下文中不再创建变量或函数。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用 eval() 创建变量</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">eval</span>(<span class="string">&#x27;var x=10&#x27;</span>);</span><br><span class="line">  alert(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 非严格模式: 弹出对话框显示 10</span></span><br><span class="line"><span class="comment">// 严格模式: 调用 alert(x) 时会抛出 ReferenceError</span></span><br></pre></td></tr></table></figure>

<p>如果是在非严格模式下，以上代码会在函数 doSomething() 中创建一个局部变量 x，然后 alert() 还会显示该变量的值。但在严格模式下，在 doSomething() 函数中调用 eval() 不会创建变量 x，因此 调用 alert() 会导致抛出 ReferenceError，因为 x 没有定义。</p>
<hr>
<p>可以在 eval() 中声明变量和函数，但这些变量或函数只能在被求值的特殊作用域中有效，随后就 将被销毁。因此，以下代码可以运行，没有问题：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> result = <span class="built_in">eval</span>(<span class="string">&#x27;var x=10, y=11; x+y&#x27;</span>);</span><br><span class="line">alert(result); <span class="comment">//21</span></span><br></pre></td></tr></table></figure>

<p>这里在 eval() 中声明了变量 x 和 y，然后将它们加在一起，返回了它们的和。于是，result 变 量的值是 21，即 x 和 y 相加的结果。而在调用 alert() 时，尽管 x 和 y 已经不存在了，result 变量的值仍然是有效的。</p>
<h3 id="eval-与-arguments"><a href="#eval-与-arguments" class="headerlink" title="eval 与 arguments"></a>eval 与 arguments</h3><p>严格模式已经明确禁止使用 eval 和 arguments 作为标识符，也不允许读写它们的值。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 把 eval 和 arguments 作为变量引用</span></span><br><span class="line"><span class="keyword">var</span> <span class="built_in">eval</span> = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">arguments</span> = <span class="string">&#x27;Hello world!&#x27;</span>;</span><br><span class="line"><span class="comment">// 非严格模式: 没问题，不出错</span></span><br><span class="line"><span class="comment">// 严格模式: 抛出语法错误</span></span><br></pre></td></tr></table></figure>

<p>在非严格模式下，可以重写 eval，也可以给 arguments 赋值。但在严格模式下，这样做会导致语 法错误。不能将它们用作标识符，意味着以下几种使用方式都会抛出语法错误：</p>
<ul>
<li>使用 var 声明</li>
<li>赋予另一个值</li>
<li>尝试修改包含的值，如使用++</li>
<li>用作函数名</li>
<li>用作命名的函数参数</li>
<li>在 try-catch 语句中用作例外名</li>
</ul>
<h3 id="抑制-this"><a href="#抑制-this" class="headerlink" title="抑制 this"></a>抑制 this</h3><p>在非严格模式下使用函数的 apply() 或 call() 方法时，null 或 undefined 值会被转换为全局对象。而在严格模式下，函数的 this 值始终是指定的值，无论指定的是什么值。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//访问属性</span></span><br><span class="line"><span class="keyword">var</span> color = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">displayColor</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(<span class="built_in">this</span>.color);</span><br><span class="line">&#125;</span><br><span class="line">displayColor.call(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">// 非严格模式: 访问全局属性</span></span><br><span class="line"><span class="comment">// 严格模式: 抛出错误，因为 this 的值为 null</span></span><br></pre></td></tr></table></figure>

<p>以上代码向 displayColor.call() 中传入了 null，如果在是非严格模式下，这意味着函数的 this 值是全局对象。结果就是弹出对话框显示”red”。而在严格模式下，这个函数的 this 的值是 null，因 此在访问 null 的属性时就会抛出错误。</p>
<h3 id="其他变化"><a href="#其他变化" class="headerlink" title="其他变化"></a>其他变化</h3><h4 id="with"><a href="#with" class="headerlink" title="with"></a>with</h4><p>抛弃了 with 语句。非严格模式下的 with 语句能够改变解析标识符的路径，但在严格模式下，with 被简化掉了。因此，在严格模式下使用 with 会导致语法错误。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//with 的语句用法</span></span><br><span class="line"><span class="keyword">with</span> (location) &#123;</span><br><span class="line">  alert(href);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 非严格模式: 允许</span></span><br><span class="line"><span class="comment">// 严格模式: 抛出语法错误</span></span><br></pre></td></tr></table></figure>

<h4 id="八进制字面量"><a href="#八进制字面量" class="headerlink" title="八进制字面量"></a>八进制字面量</h4><p>严格模式也去掉了 JavaScript 中的八进制字面量。以 0 开头的八进制字面量过去经常会导致很多错 误。在严格模式下，八进制字面量已经成为无效的语法了。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用八进制字面量</span></span><br><span class="line"><span class="keyword">var</span> value = <span class="number">010</span>;</span><br><span class="line"><span class="comment">// 非严格模式: 值为 8</span></span><br><span class="line"><span class="comment">// 严格模式: 抛出语法错误</span></span><br></pre></td></tr></table></figure>

<hr>
<p>ECMAScript5 也修改了严格模式下 parseInt() 的行为。如今，八进制字面量在严格模式下会被当作以 0 开头的十进制字面量。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用 parseInt() 解析八进制字面量</span></span><br><span class="line"><span class="keyword">var</span> value = <span class="built_in">parseInt</span>(<span class="string">&#x27;010&#x27;</span>);</span><br><span class="line"><span class="comment">// 非严格模式: 值为 8</span></span><br><span class="line"><span class="comment">// 严格模式: 值为 10</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
  </entry>
  <entry>
    <title>CSS骨架屏半自动化</title>
    <url>/posts/24488/</url>
    <content><![CDATA[<p>前几天写了个骨架屏组件，但是太定制化了，每次需要的时候都得重新手写骨架屏太麻烦。这次用 CSS 的伪类特性实现了骨架屏的半自动化，虽然还是有点繁琐，但相比以前的效率还是提升了一个档次。</p>
<a id="more"></a>

<h2 id="核心代码（less）"><a href="#核心代码（less）" class="headerlink" title="核心代码（less）"></a>核心代码（less）</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.skt-basic</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">border</span>: none <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">background-image</span>: none <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>, <span class="number">0.9</span>);</span><br><span class="line">  <span class="attribute">transform-origin</span>: left top;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.skt-main</span> &#123;</span><br><span class="line">  <span class="comment">/* 默认深色背景 */</span></span><br><span class="line">  &amp;::after &#123;</span><br><span class="line">    content: &#x27;&#x27;;</span><br><span class="line">    <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line">    <span class="selector-tag">left</span>: 0;</span><br><span class="line">    <span class="selector-tag">top</span>: 0;</span><br><span class="line">    <span class="selector-tag">z-index</span>: 9;</span><br><span class="line">    <span class="selector-tag">width</span>: 100%;</span><br><span class="line">    <span class="selector-tag">height</span>: 100%;</span><br><span class="line">    <span class="selector-tag">background-color</span>: <span class="selector-id">#e6e6e6</span>;</span><br><span class="line">    <span class="selector-tag">display</span>: <span class="selector-tag">block</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 想要圆角加 yyt-sk-round */</span></span><br><span class="line">  &amp;<span class="selector-class">.yyt-sk-round</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4</span>rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* 不想要动画加 yyt-sk-not-ani */</span></span><br><span class="line">  &amp;<span class="selector-pseudo">:not(.yyt-sk-not-ani)</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">30%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">      to right,</span><br><span class="line">      rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>) <span class="number">0</span>,</span><br><span class="line">      <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>) <span class="number">50%</span>,</span><br><span class="line">      <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>) <span class="number">100%</span></span><br><span class="line">    );</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">skewX</span>(-<span class="number">45deg</span>);</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">99</span>;</span><br><span class="line">    <span class="attribute">animation</span>: skeleton-ani <span class="number">1s</span> ease infinite;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* 浅色背景 */</span></span><br><span class="line">  &amp;<span class="selector-class">.yyt-light</span> &#123;</span><br><span class="line">    &amp;::after &#123;</span><br><span class="line">      <span class="selector-tag">background-color</span>: <span class="selector-id">#f8fafc</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 骨架屏</span><br><span class="line"><span class="selector-class">.skt-loading</span> &#123;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none; <span class="comment">/* 加载中阻止事件 */</span></span><br><span class="line">  .skeleton,</span><br><span class="line">  <span class="selector-class">.skeleton-25</span>,</span><br><span class="line">  <span class="selector-class">.skeleton-50</span>,</span><br><span class="line">  <span class="selector-class">.skeleton-75</span> &#123;</span><br><span class="line">    .skt-basic();</span><br><span class="line">    <span class="selector-class">.skt-main</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.skeleton-25</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">0.25</span>, <span class="number">0.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.skeleton-50</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">0.5</span>, <span class="number">0.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.skeleton-75</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">0.75</span>, <span class="number">0.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> skeleton-ani &#123;</span><br><span class="line">  <span class="comment">/* 骨架屏动画 */</span></span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    <span class="attribute">left</span>: -<span class="number">100%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">150%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><blockquote>
<p>HTML 部分</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 使用 skt-loading 包裹整个容器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;skt-loading&#x27;: loading &#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 给想要用骨架屏展示的容器添加 skeleton 类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;skeleton&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        loading: <span class="literal">true</span> <span class="comment">// 默认loading为true，加载骨架屏</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.loading = <span class="literal">false</span>;</span></span><br><span class="line">      &#125;, 3000);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="使用注意"><a href="#使用注意" class="headerlink" title="使用注意"></a>使用注意</h2><ul>
<li>after 伪元素无法插入到 <code>input</code>、<code>img</code> 等非容器元素中，所以如果需要添加 <code>.skleton</code>，则需要加一层元素将其包裹</li>
<li>Vue 中使用到 v-for 动态渲染的类似列表数据，则需要先有 mock 数据来生成 dom</li>
</ul>
<p><a href="https://evestorm.github.io/tags/Vue/"> Vue</a> <a href="https://evestorm.github.io/tags/%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C/"> 用户体验</a> [ 骨架屏](</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>用户体验</tag>
        <tag>骨架屏</tag>
      </tags>
  </entry>
  <entry>
    <title>JS中如何实现继承</title>
    <url>/posts/2751/</url>
    <content><![CDATA[<h2 id="组合继承（原型链-借用构造函数）"><a href="#组合继承（原型链-借用构造函数）" class="headerlink" title="组合继承（原型链 + 借用构造函数）"></a>组合继承（原型链 + 借用构造函数）</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 组合继承:原型继承+借用（调用）构造函数继承</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, sex</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">  <span class="built_in">this</span>.sex = sex;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayHi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;Hello world&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name, age, sex, score</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 借用构造函数</span></span><br><span class="line">  Person.call(<span class="built_in">this</span>,name,age,sex);</span><br><span class="line">  <span class="built_in">this</span>.score = score;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 改变原型指向----继承</span></span><br><span class="line"><span class="comment">// 我们让 Student.prototype 指向一个Person的实例对象</span></span><br><span class="line"><span class="comment">// 这个对象的__proto__指向的是Person.prototype</span></span><br><span class="line"><span class="comment">// 所以我们就可以借助这个实例对象拿到sayHi方法，实现继承</span></span><br><span class="line">Student.prototype=<span class="keyword">new</span> Person();</span><br><span class="line">Student.prototype.eat = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;吃东西&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> stu = <span class="keyword">new</span> Student(<span class="string">&quot;Lance&quot;</span>, <span class="number">20</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;100分&quot;</span>);</span><br><span class="line">stu.sayHi();</span><br><span class="line"><span class="keyword">var</span> stu2 = <span class="keyword">new</span> Student(<span class="string">&quot;Jerry&quot;</span>, <span class="number">19</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;101分&quot;</span>);</span><br><span class="line">stu2.eat();</span><br><span class="line"></span><br><span class="line"><span class="comment">//属性和方法都被继承了</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="寄生组合继承（组合继承升级版）"><a href="#寄生组合继承（组合继承升级版）" class="headerlink" title="寄生组合继承（组合继承升级版）"></a>寄生组合继承（组合继承升级版）</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">object</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">  F.prototype = o;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inheritPrototype</span>(<span class="params">subType, superType</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> prototype = object(superType.prototype); <span class="comment">// 创建了父类原型的浅复制</span></span><br><span class="line">    prototype.constructor = subType;             <span class="comment">// 修正原型的构造函数</span></span><br><span class="line">    subType.prototype = prototype;               <span class="comment">// 将子类的原型替换为这个原型</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.colors = [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;blue&quot;</span>, <span class="string">&quot;green&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">SuperType.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="built_in">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">    SuperType.call(<span class="built_in">this</span>, name);</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 核心：因为是对父类原型的复制，所以不包含父类的构造函数，也就不会调用两次父类的构造函数造成浪费</span></span><br><span class="line">inheritPrototype(SubType, SuperType);</span><br><span class="line">SubType.prototype.sayAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="built_in">this</span>.age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ES6继承写法"><a href="#ES6继承写法" class="headerlink" title="ES6继承写法"></a>ES6继承写法</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, age</span>)</span> &#123;<span class="built_in">this</span>.name=name;<span class="built_in">this</span>.age=age&#125;</span><br><span class="line">  <span class="function"><span class="title">sayHi</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, age, weight</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(name, age); <span class="built_in">this</span>.weight = weight;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">run</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="在原型链继承时，为什么不直接-Student-prototype-Person-prototype-？"><a href="#在原型链继承时，为什么不直接-Student-prototype-Person-prototype-？" class="headerlink" title="在原型链继承时，为什么不直接 Student.prototype = Person.prototype ？"></a>在原型链继承时，为什么不直接 <code>Student.prototype = Person.prototype</code> ？</h2><p>因为对象的赋值只是引用的赋值, 上面两者都指向同一个内存地址，只要随便通过1个途径就能修改该内存地址的对象，这样子类就无法单独扩展方法，而且会影响父类。</p>
<h2 id="组合继承的缺点"><a href="#组合继承的缺点" class="headerlink" title="组合继承的缺点"></a>组合继承的缺点</h2><p>缺点就是调用了两次父类的构造函数。<br>第一次给子类的原型添加了父类构造函数中的属性方法；第二次又给子类的构造函数添加了父类的构造函数的属性方法，从而覆盖了子类原型中的同名参数。这种被覆盖的情况造成了性能上的浪费：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.name = <span class="string">&#x27;parent&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">SuperType.prototype.say = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;this is parent&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    SuperType.call(<span class="built_in">this</span>) <span class="comment">// 第二次调用SuperType</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType() <span class="comment">// 第一次调用SuperType</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>继承</tag>
      </tags>
  </entry>
  <entry>
    <title>JS垃圾回收机制</title>
    <url>/posts/20229/</url>
    <content><![CDATA[<p>一直以来我对 JS 垃圾回收机制的了解仅仅停留在两个词儿上：标记清除和引用计数。除此之外我就啥不知道了。最近空下来阅读了不少相关文章，算是对 JS 的垃圾回收机制有了点粗浅的认识。这篇博客算是一个笔记，也是一个总结。而我阅读的文章也会在最后的“资源”一节列出，想更加深入了解 JS 垃圾回收机制的小伙伴可以点击查看。</p>
<h2 id="什么是垃圾"><a href="#什么是垃圾" class="headerlink" title="什么是垃圾"></a>什么是垃圾</h2><p>要想理解 JS 的垃圾回收机制，首先得确定什么才是所谓的要被回收的<strong>垃圾</strong>。一般情况下，没有被引用的对象就是垃圾，是需要被清除的。下面是我总结的几大类型。</p>
<a id="more"></a>

<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><p>所有全局的变量都<strong>不是垃圾</strong>，因为浏览器会认为你在任何情况下都有可能使用到全局变量。例如下面这种情况：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处省略若干代码</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br></pre></td></tr></table></figure>

<p>在顶部定义了一个全局变量 str，你是完全有可能在 n 行代码以后打印这个变量的。</p>
<h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><p>通常情况下，局部作用域变量在函数执行完毕后就是垃圾，再也用不到了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> str = <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn();</span><br><span class="line">fn();</span><br></pre></td></tr></table></figure>

<p>当开始执行 fn 时，才产生 str ，它的作用域就在 fn 中，fn 执行结束后，str 就是垃圾，会被销毁。你可能会说，我完全有可能调用两次 fn 啊，但这里要注意的一点是，当你再次执行 fn 时，产生的是一个全新的 str ，和刚才的 str 完全没关系。</p>
<h3 id="单引用"><a href="#单引用" class="headerlink" title="单引用"></a>单引用</h3><p>一个单引用对象，没有引用就是垃圾：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> user = &#123;</span><br><span class="line">  name: <span class="string">&#x27;John&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">user = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>

<p>我在全局作用域下定义了变量 user ，指向一个对象，然而却在最后把变量 user 设置为 null。此时就没有谁在引用 {name: “John”} 这个对象了，所以它是垃圾，会被销毁。</p>
<img src="/posts/20229/1557125754803-d30ae923-a32b-46b3-87e3-af75220e598a.png" class="" title="user">

<img src="/posts/20229/1557125763671-1b38c9b5-f918-4147-82dc-3f993147edd5.png" class="" title="user&#x3D;&gt;null">

<h3 id="多引用"><a href="#多引用" class="headerlink" title="多引用"></a>多引用</h3><p>如果一个对象有两个及以上的引用，它不一定会被回收：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> user = &#123;</span><br><span class="line">  name: <span class="string">&#x27;John&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> admin = user;</span><br><span class="line"></span><br><span class="line">user = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>

<p>即使我们删掉了其中一个引用，但 admin 仍然还引用着 object ，所以此 object 还不会被回收。</p>
<img src="/posts/20229/1557125810603-13d0fcdd-56cc-41be-984f-7f2c0df69359.png" class="" title="user&amp;admin">

<h3 id="环引用"><a href="#环引用" class="headerlink" title="环引用"></a>环引用</h3><p>还记得文章开头说的下面这段话吗？</p>
<blockquote>
<p>一般情况下，没有被引用的对象就是垃圾，是需要被清除的。</p>
</blockquote>
<p>环引用就是个例外，当几个对象相互引用，但没有被其它任何人引用时，它们仍然是垃圾，需要被回收，我们考虑下面代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">marry</span>(<span class="params">man, woman</span>) </span>&#123;</span><br><span class="line">  woman.husband = man;</span><br><span class="line">  man.wife = woman;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    father: man,</span><br><span class="line">    mother: woman</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> family = marry(</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&#x27;John&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&#x27;Ann&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>上述代码我们创建了一个家庭（family）对象，其中包含一个男人（man）对象和一个女人（woman）对象，并让女人的丈夫（husband）设为男人，男人的妻子（wife）设为女人。它们之间的关系可以用下图表示：</p>
<img src="/posts/20229/1557125998918-51ef0e3c-76ce-45c8-9ef7-7054a89e3525.png" class="" title="family">

<p>接着我们执行下面操作：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> family.father;</span><br><span class="line"><span class="keyword">delete</span> family.mother.husband;</span><br></pre></td></tr></table></figure>

<p>此刻删掉家庭对丈夫的引用，以及妻子对丈夫的引用，此时不再有任何人引用丈夫，所以此时丈夫是垃圾，需要被回收：</p>
<img src="/posts/20229/1557126018898-be628eeb-4894-48b0-9070-56c118ded162.png" class="" title="father_death">

<img src="/posts/20229/1557126115803-b0e225e0-880f-4e12-bf0c-a6caaaa0df4c.png" class="" title="father_death2">

<p>让我们回到丈夫还没有被家庭和妻子去除引用的时刻。然后执行下面代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">family = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>

<p>这个时候，我们直接删掉了全局（外界）对家庭这个对象的引用，则家庭和丈夫以及妻子就都“死掉”了，需要被回收。你可能会说，它们之间不是存在相互引用关系吗？但此刻它们已经不被外界所引用，所以它们会被回收。</p>
<img src="/posts/20229/1557126222885-361626fc-b4e4-43f5-84db-76461d05c381.png" class="" title="garbage">

<h2 id="如何实现垃圾回收"><a href="#如何实现垃圾回收" class="headerlink" title="如何实现垃圾回收"></a>如何实现垃圾回收</h2><p>分析完什么是所谓的垃圾之后，我们就可以开始讨论如何实现垃圾回收了。也就是文章开头提到的「标记清除」和「引用计数」。</p>
<h3 id="标记清除"><a href="#标记清除" class="headerlink" title="标记清除"></a>标记清除</h3><p>简单来理解，标记清除机制会从全局作用域开始，把所有它遇到的变量都标记一遍，如果这些被标记的变量还引用了其他变量，就再标记，一直标记到再也没有新的对象为止，这个标记过程就结束了。标记过程结束后就开始进行清除过程，把所有刚才没有被标记过的对象都删掉。这就是标记清除算法：</p>
<img src="/posts/20229/garbage-collection-5.png" class="" title="标记清除">

<p>听起来这种实现很美好不是吗？但是此方法有个缺点很伤，那就是在变量对象多了以后，造成遍历很慢的后果。而且我们会不定时对这些变量都要再标记一遍，然而我们知道 JS 是单线程的，标记期间 JS 代码的执行会被中断，而标记的时间又很久，就造成不好的影响，这就是它的缺点。</p>
<p>所以针对这个缺点，我们会对标记清除做一些改进：</p>
<h4 id="分代收集（Generational-collection）"><a href="#分代收集（Generational-collection）" class="headerlink" title="分代收集（Generational collection）"></a>分代收集（Generational collection）</h4><p>类比我们手机网络的 2G，3G 和 4G，这里的 G 就是 Generational 的意思，而我们的对象可以大致分为两种：</p>
<ul>
<li>新一代（e.g. 一个函数中的临时变量）</li>
<li>老一代（e.g. window 对象）</li>
</ul>
<p>不同代的回收策略是不一样的，一般老一代的对象停留时间会很久，而这种停留时间越久的对象，后面用到它的时间也可能越久（这只是一种推测，不一定对，仅仅是一种策略）。所以可能在第一轮标记后，会隔一段时间才会去再看它，比如 3s 后。</p>
<p>而新一代的对象，比如一个函数中的临时变量，函数执行完就可回收，不用从头开始遍历，这样的临时对象就会被马上标记然后立即马上删除，这样的对象就有可能隔 1 毫秒就看它一次，没被标记就删除了它。</p>
<h4 id="增量收集（Incremental-collection）"><a href="#增量收集（Incremental-collection）" class="headerlink" title="增量收集（Incremental collection）"></a>增量收集（Incremental collection）</h4><p>举个例子，假如此刻有 10000 个需要遍历的对象，我不一次性遍历完，而是先遍历 1000 个，然后执行 JS，再遍历 1000 个，再执行 JS… 这样遍历 10 次就能遍历完，而且 JS 也不会有明显卡顿。</p>
<h4 id="空闲收集（Idle-time-collection）"><a href="#空闲收集（Idle-time-collection）" class="headerlink" title="空闲收集（Idle-time collection）"></a>空闲收集（Idle-time collection）</h4><p>这个优化即字面意思，由于 JS 不是一直在执行的，所以我等到 JS 执行完后空闲下来再开始遍历。</p>
<h3 id="引用计数"><a href="#引用计数" class="headerlink" title="引用计数"></a>引用计数</h3><p>每次对象被引用的时候就+1，再被引用时就再+1，有人不引用它时就-1，再不引用就又-1，当这个对象被减到 0 时就该被垃圾回收了。</p>
<p>此算法的缺点也有不少，但被大家所熟知的一个缺点就是循环引用无法被回收。在早期的 IE 版本里（ie4-ie6），对宿主对象（也就是 Document 对象）采用是引用计数的垃圾回收机制，一旦你在 JS 中没有正确使用闭包，就会导致内存泄漏，这也就是此算法的一个缺陷。循环引用会导致没法回收，这个循环引用只限定于有宿主对象参与的循环引用，而 js 对象之间即使形成循环引用，也不会产生内存泄漏，因为对 js 对象的回收算法不是计数的方式。示例如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">closure</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;oDiv&#x27;</span>); <span class="comment">//oDiv用完之后一直驻留在内存中</span></span><br><span class="line">  oDiv.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(oDiv.innerHTML); <span class="comment">//这里用oDiv导致内存泄露</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上代码创建了一个作为 div 元素事件处理程序的闭包，而这个闭包则又创建了一个循环引用。</span></span><br><span class="line"><span class="comment">// 由于匿名函数保存了一个对closure()的活动对象的引用，因此就会导致无法减少div 的引用数。</span></span><br><span class="line"><span class="comment">// 只要匿名函数存在，element 的引用数至少也是1，因此它所占用的内存就永远不会被回收</span></span><br><span class="line"></span><br><span class="line">closure();</span><br><span class="line"><span class="comment">//最后应将oDiv解除引用来避免内存泄露</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">closure</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;oDiv&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> test = oDiv.innerHTML;</span><br><span class="line">  oDiv.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(test);</span><br><span class="line">  &#125;;</span><br><span class="line">  oDiv = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 解决办法: 把 oDiv.innerHTML 的一个副本保存在一个变量中，</span></span><br><span class="line"><span class="comment">// 从而消除闭包中该变量的循环引用,同时将 oDiv 变量设为null。</span></span><br></pre></td></tr></table></figure>

<p>好了，有关 JS 的垃圾回收机制就写到这里，想要了解更多可以点击下面的资源链接~ 完。</p>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><ul>
<li><a href="https://javascript.info/garbage-collection">Garbage collection</a></li>
<li><a href="https://www.jianshu.com/p/a8a04fd00c3c">几种垃圾回收算法</a></li>
<li><a href="http://newhtml.net/v8-garbage-collection/">V8 之旅： 垃圾回收器</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
  </entry>
  <entry>
    <title>JS数组有哪些常用方法</title>
    <url>/posts/21501/</url>
    <content><![CDATA[<h2 id="改变原数组的方法"><a href="#改变原数组的方法" class="headerlink" title="改变原数组的方法"></a>改变原数组的方法</h2><h3 id="splice-添加-删除数组元素"><a href="#splice-添加-删除数组元素" class="headerlink" title="splice() 添加/删除数组元素"></a>splice() 添加/删除数组元素</h3><blockquote>
<p>splice() 方法<strong>向/从数组中添加/删除</strong>项目，然后返回被删除的项目</p>
<p>array.splice(index,howmany,item1,…..,itemX)</p>
<ol>
<li>index：必需。整数，规定添加/删除项目的位置，使用负数可从数组结尾处规定位置。</li>
<li>howmany：可选。要删除的项目数量。如果设置为 0，则不会删除项目。</li>
<li>item1, …, itemX： 可选。向数组添加的新项目。</li>
</ol>
<p>返回值: 如果有元素被删除,返回包含被删除项目的新数组。</p>
</blockquote>
<a id="more"></a>

<h4 id="删除元素"><a href="#删除元素" class="headerlink" title="删除元素"></a>删除元素</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 从数组下标0开始，删除3个元素</span></span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.splice(<span class="number">0</span>, <span class="number">3</span>); <span class="comment">// [1,2,3]</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [4,5,6,7]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从最后一个元素开始删除3个元素，因为最后一个元素，所以只删除了7</span></span><br><span class="line"><span class="keyword">let</span> item = a.splice(-<span class="number">1</span>, <span class="number">3</span>); <span class="comment">// [7]</span></span><br></pre></td></tr></table></figure>

<h4 id="删除并添加"><a href="#删除并添加" class="headerlink" title="删除并添加"></a>删除并添加</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 从数组下标0开始，删除3个元素，并添加元素&#x27;添加&#x27;</span></span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.splice(<span class="number">0</span>,<span class="number">3</span>,<span class="string">&#x27;添加&#x27;</span>); <span class="comment">// [1,2,3]</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [&#x27;添加&#x27;,4,5,6,7]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从数组最后第二个元素开始，删除3个元素，并添加两个元素&#x27;添加1&#x27;、&#x27;添加2&#x27;</span></span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> item = b.splice(-<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;添加1&#x27;</span>,<span class="string">&#x27;添加2&#x27;</span>); <span class="comment">// [6,7]</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// [1,2,3,4,5,&#x27;添加1&#x27;,&#x27;添加2&#x27;]</span></span><br></pre></td></tr></table></figure>

<h4 id="不删除只添加"><a href="#不删除只添加" class="headerlink" title="不删除只添加"></a>不删除只添加</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.splice(<span class="number">0</span>,<span class="number">0</span>,<span class="string">&#x27;添加1&#x27;</span>,<span class="string">&#x27;添加2&#x27;</span>); <span class="comment">// [] 没有删除元素，返回空数组</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [&#x27;添加1&#x27;,&#x27;添加2&#x27;,1,2,3,4,5,6,7]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> item = b.splice(-<span class="number">1</span>,<span class="number">0</span>,<span class="string">&#x27;添加1&#x27;</span>,<span class="string">&#x27;添加2&#x27;</span>); <span class="comment">// [] 没有删除元素，返回空数组</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// [1,2,3,4,5,6,&#x27;添加1&#x27;,&#x27;添加2&#x27;,7] 在最后一个元素的前面添加两个元素</span></span><br></pre></td></tr></table></figure>

<h3 id="sort-数组排序"><a href="#sort-数组排序" class="headerlink" title="sort() 数组排序"></a>sort() 数组排序</h3><blockquote>
<p>定义: sort()方法对数组元素进行排序，并返回这个数组。</p>
<p>参数可选: 规定排序顺序的比较函数。</p>
<p>默认情况下sort()方法没有传比较函数的话，默认按字母升序，如果不是元素不是字符串的话，会调用<code>toString()</code>方法将元素转化为字符串的Unicode(万国码)位点，然后再比较字符。</p>
</blockquote>
<h4 id="不传参"><a href="#不传参" class="headerlink" title="不传参"></a>不传参</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 字符串排列 看起来很正常</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Mango&quot;</span>];</span><br><span class="line">a.sort(); <span class="comment">// [&quot;Apple&quot;,&quot;Banana&quot;,&quot;Mango&quot;,&quot;Orange&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数字排序的时候 因为转换成Unicode字符串之后，有些数字会比较大会排在后面 这显然不是我们想要的</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">20</span>,<span class="number">25</span>,<span class="number">8</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a.sort()) <span class="comment">// [1,10,20,25,3,8];</span></span><br></pre></td></tr></table></figure>

<p><strong>比较函数的两个参数：</strong></p>
<p>sort的比较函数有两个默认参数，要在函数中接收这两个参数，这两个参数是数组中两个要比较的元素，通常我们用 a 和 b 接收两个将要比较的元素：</p>
<ul>
<li>若比较函数返回值&lt;0，那么a将排到b的前面;</li>
<li>若比较函数返回值=0，那么a 和 b 相对位置不变；</li>
<li>若比较函数返回值&gt;0，那么b 排在a 将的前面；</li>
</ul>
<h4 id="数字升降序"><a href="#数字升降序" class="headerlink" title="数字升降序"></a>数字升降序</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> array =  [<span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">20</span>, <span class="number">4</span>, <span class="number">25</span>, <span class="number">8</span>];  </span><br><span class="line">array.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a-b;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(array); <span class="comment">// [1,3,4,4,8,10,20,25];</span></span><br><span class="line"></span><br><span class="line">array.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> b-a;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(array); <span class="comment">// [25,20,10,8,4,4,3,1];</span></span><br></pre></td></tr></table></figure>

<h3 id="pop-删除一个数组中的最后的一个元素"><a href="#pop-删除一个数组中的最后的一个元素" class="headerlink" title="pop() 删除一个数组中的最后的一个元素"></a>pop() 删除一个数组中的最后的一个元素</h3><blockquote>
<p>定义: pop() 方法删除一个数组中的最后的一个元素，并且返回这个元素。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span>  a =  [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.pop();  <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [1,2]</span></span><br></pre></td></tr></table></figure>

<h3 id="shift-删除数组的第一个元素"><a href="#shift-删除数组的第一个元素" class="headerlink" title="shift() 删除数组的第一个元素"></a>shift() 删除数组的第一个元素</h3><blockquote>
<p>定义: shift()方法删除数组的第一个元素，并返回这个元素。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span>  a =  [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.shift();  <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [2,3]</span></span><br></pre></td></tr></table></figure>

<h3 id="push-向数组的末尾添加元素"><a href="#push-向数组的末尾添加元素" class="headerlink" title="push() 向数组的末尾添加元素"></a>push() 向数组的末尾添加元素</h3><blockquote>
<p>定义：push() 方法可向数组的末尾添加一个或多个元素，并返回新的长度。</p>
<p>参数: item1, item2, …, itemX ,要添加到数组末尾的元素</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span>  a =  [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.push(<span class="string">&#x27;末尾&#x27;</span>, <span class="string">&#x27;233&#x27;</span>);  <span class="comment">// 5</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [1,2,3,&#x27;末尾&#x27;, &#x27;233&#x27;]</span></span><br></pre></td></tr></table></figure>

<h3 id="unshift"><a href="#unshift" class="headerlink" title="unshift()"></a>unshift()</h3><blockquote>
<p>定义：unshift() 方法可向数组的开头添加一个或更多元素，并返回新的长度。</p>
<p>参数: item1, item2, …, itemX ,要添加到数组开头的元素</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.unshift(<span class="string">&#x27;开头&#x27;</span>, <span class="string">&#x27;开头2&#x27;</span>);  <span class="comment">// 5</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [ &#x27;开头&#x27;, &#x27;开头2&#x27;, 1, 2, 3 ]</span></span><br></pre></td></tr></table></figure>

<h3 id="reverse-颠倒数组中元素的顺序"><a href="#reverse-颠倒数组中元素的顺序" class="headerlink" title="reverse() 颠倒数组中元素的顺序"></a>reverse() 颠倒数组中元素的顺序</h3><blockquote>
<p>定义: reverse() 方法用于颠倒数组中元素的顺序。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span>  a =  [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">a.reverse();  </span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [3,2,1]</span></span><br></pre></td></tr></table></figure>

<h2 id="不改变原数组的方法"><a href="#不改变原数组的方法" class="headerlink" title="不改变原数组的方法"></a>不改变原数组的方法</h2><h3 id="slice-浅拷贝数组的元素"><a href="#slice-浅拷贝数组的元素" class="headerlink" title="slice() 浅拷贝数组的元素"></a>slice() 浅拷贝数组的元素</h3><blockquote>
<p>定义： 方法返回一个从开始到结束（<strong>不包括结束</strong>）选择的数组的一部分浅拷贝到一个新数组对象，且原数组不会被修改。</p>
<p>语法：array.slice(begin, end);</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a= [<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;world&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> b=a.slice(<span class="number">0</span>,<span class="number">1</span>); <span class="comment">// [&#x27;hello&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新数组是浅拷贝的，元素是简单数据类型，改变之后不会互相干扰。</span></span><br><span class="line"><span class="comment">// 如果是复杂数据类型(对象,数组)的话，改变其中一个，另外一个也会改变。</span></span><br><span class="line">a[<span class="number">0</span>]=<span class="string">&#x27;改变原数组&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a,b); <span class="comment">// [&#x27;改变原数组&#x27;,&#x27;world&#x27;] [&#x27;hello&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a= [&#123;<span class="attr">name</span>:<span class="string">&#x27;OBKoro1&#x27;</span>&#125;];</span><br><span class="line"><span class="keyword">let</span> b=a.slice();</span><br><span class="line"><span class="built_in">console</span>.log(b,a); <span class="comment">// [&#123;&quot;name&quot;:&quot;OBKoro1&quot;&#125;]  [&#123;&quot;name&quot;:&quot;OBKoro1&quot;&#125;]</span></span><br><span class="line"><span class="comment">// a[0].name=&#x27;改变原数组&#x27;;</span></span><br><span class="line"><span class="comment">// console.log(b,a); // [&#123;&quot;name&quot;:&quot;改变原数组&quot;&#125;] [&#123;&quot;name&quot;:&quot;改变原数组&quot;&#125;]</span></span><br></pre></td></tr></table></figure>

<h3 id="join-数组转字符串"><a href="#join-数组转字符串" class="headerlink" title="join() 数组转字符串"></a>join() 数组转字符串</h3><blockquote>
<p>定义: join() 方法用于把数组中的所有元素通过指定的分隔符进行分隔放入一个字符串，返回生成的字符串。</p>
<p>语法: array.join(str)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a= [<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;world&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> str=a.join(); <span class="comment">// &#x27;hello,world&#x27;</span></span><br><span class="line"><span class="keyword">let</span> str2=a.join(<span class="string">&#x27;+&#x27;</span>); <span class="comment">// &#x27;hello+world&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a= [[<span class="string">&#x27;OBKoro1&#x27;</span>,<span class="string">&#x27;23&#x27;</span>],<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> str1=a.join(); <span class="comment">// OBKoro1,23,test</span></span><br><span class="line"><span class="keyword">let</span> b= [&#123;<span class="attr">name</span>:<span class="string">&#x27;OBKoro1&#x27;</span>,<span class="attr">age</span>:<span class="string">&#x27;23&#x27;</span>&#125;,<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> str2 = b.join(); <span class="comment">// [object Object],test</span></span><br><span class="line"><span class="comment">// 对象转字符串推荐JSON.stringify(obj);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结论：</span></span><br><span class="line"><span class="comment">// join()/toString()方法在数组元素是数组的时候，会将里面的数组也调用join()/toString(),</span></span><br><span class="line"><span class="comment">// 如果是对象的话，对象会被转为[object Object]字符串。</span></span><br></pre></td></tr></table></figure>

<h3 id="join-数组转字符串-1"><a href="#join-数组转字符串-1" class="headerlink" title="join() 数组转字符串"></a>join() 数组转字符串</h3><blockquote>
<p>定义: join() 方法用于把数组中的所有元素通过指定的分隔符进行分隔放入一个字符串，返回生成的字符串。</p>
<p>语法: array.join(str)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a= [<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;world&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> str=a.join(); <span class="comment">// &#x27;hello,world&#x27;</span></span><br><span class="line"><span class="keyword">let</span> str2=a.join(<span class="string">&#x27;+&#x27;</span>); <span class="comment">// &#x27;hello+world&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a= [[<span class="string">&#x27;OBKoro1&#x27;</span>,<span class="string">&#x27;23&#x27;</span>],<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> str1=a.join(); <span class="comment">// OBKoro1,23,test</span></span><br><span class="line"><span class="keyword">let</span> b= [&#123;<span class="attr">name</span>:<span class="string">&#x27;OBKoro1&#x27;</span>,<span class="attr">age</span>:<span class="string">&#x27;23&#x27;</span>&#125;,<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> str2 = b.join(); <span class="comment">// [object Object],test</span></span><br><span class="line"><span class="comment">// 对象转字符串推荐JSON.stringify(obj);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结论：</span></span><br><span class="line"><span class="comment">// join()/toString()方法在数组元素是数组的时候，会将里面的数组也调用join()/toString(),</span></span><br><span class="line"><span class="comment">// 如果是对象的话，对象会被转为[object Object]字符串。</span></span><br></pre></td></tr></table></figure>

<h3 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h3><blockquote>
<p>定义： 方法用于合并两个或多个数组，返回一个新数组。</p>
<p>语法：var newArr =oldArray.concat(arrayX,arrayX,……,arrayX)</p>
<p>参数：arrayX（必须）：该参数可以是具体的值，也可以是数组对象。可以是任意多个。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="comment">//连接两个数组</span></span><br><span class="line"><span class="keyword">let</span> newVal=a.concat(b); <span class="comment">// [1,2,3,4,5,6]</span></span><br><span class="line"><span class="comment">// 连接三个数组</span></span><br><span class="line"><span class="keyword">let</span> c = [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="keyword">let</span> newVal2 = a.concat(b, c); <span class="comment">// [1,2,3,4,5,6,7,8,9]</span></span><br><span class="line"><span class="comment">// 添加元素</span></span><br><span class="line"><span class="keyword">let</span> newVal3 = a.concat(<span class="string">&#x27;添加元素&#x27;</span>,b, c,<span class="string">&#x27;再加一个&#x27;</span>); </span><br><span class="line"><span class="comment">// [1,2,3,&quot;添加元素&quot;,4,5,6,7,8,9,&quot;再加一个&quot;]</span></span><br><span class="line"><span class="comment">// 合并嵌套数组  会浅拷贝嵌套数组</span></span><br><span class="line"><span class="keyword">let</span> d = [<span class="number">1</span>,<span class="number">2</span> ];</span><br><span class="line"><span class="keyword">let</span> f = [<span class="number">3</span>,[<span class="number">4</span>]];</span><br><span class="line"><span class="keyword">let</span> newVal4 = d.concat(f); <span class="comment">// [1,2,3,[4]]</span></span><br></pre></td></tr></table></figure>

<h3 id="ES6扩展运算符-合并数组"><a href="#ES6扩展运算符-合并数组" class="headerlink" title="ES6扩展运算符...合并数组"></a>ES6扩展运算符<code>...</code>合并数组</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> b = [ <span class="number">4</span>,...a, <span class="number">4</span>, <span class="number">4</span>]</span><br><span class="line"><span class="built_in">console</span>.log(a,b); <span class="comment">//  [2, 3, 4, 5] [4,2,3,4,5,4,4]</span></span><br></pre></td></tr></table></figure>

<h3 id="indexOf-查找数组是否存在某个元素，返回下标"><a href="#indexOf-查找数组是否存在某个元素，返回下标" class="headerlink" title="indexOf() 查找数组是否存在某个元素，返回下标"></a>indexOf() 查找数组是否存在某个元素，返回下标</h3><blockquote>
<p>定义: 返回在数组中可以找到一个给定元素的第一个索引，如果不存在，则返回-1。</p>
<p>p.s. 字符串也有此方法，要注意当 ‘lance’.indexOf(‘’) 一个空字符串时，返回0而不是-1</p>
<p>语法：array.indexOf(searchElement,fromIndex)</p>
<p>参数：</p>
<p>searchElement(必须):被查找的元素</p>
<p>fromIndex(可选):开始查找的位置(不能大于等于数组的长度，返回-1)，接受负值，默认值为0。</p>
<p>严格相等的搜索:</p>
<p>数组的indexOf搜索跟字符串的indexOf不一样,数组的indexOf使用严格相等<code>===</code>搜索元素，即<strong>数组元素要完全匹配</strong>才能搜索成功。</p>
<p><strong>注意</strong>：indexOf()不能识别<code>NaN</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a=[<span class="string">&#x27;啦啦&#x27;</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">24</span>,<span class="literal">NaN</span>]</span><br><span class="line"><span class="built_in">console</span>.log(a.indexOf(<span class="string">&#x27;啦&#x27;</span>));  <span class="comment">// -1 </span></span><br><span class="line"><span class="built_in">console</span>.log(a.indexOf(<span class="string">&#x27;NaN&#x27;</span>));  <span class="comment">// -1 </span></span><br><span class="line"><span class="built_in">console</span>.log(a.indexOf(<span class="string">&#x27;啦啦&#x27;</span>)); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<h3 id="lastIndexOf-查找指定元素在数组中的最后一个位置"><a href="#lastIndexOf-查找指定元素在数组中的最后一个位置" class="headerlink" title="lastIndexOf() 查找指定元素在数组中的最后一个位置"></a>lastIndexOf() 查找指定元素在数组中的最后一个位置</h3><blockquote>
<p>定义: 方法返回指定元素,在数组中的最后一个的索引，如果不存在则返回 -1。（从数组后面往前查找）</p>
<p>语法：arr.lastIndexOf(searchElement,fromIndex)</p>
<p>参数:</p>
<p>searchElement(必须): 被查找的元素</p>
<p>fromIndex(可选): 逆向查找开始位置，默认值数组的 <code>长度-1</code>，即查找整个数组。</p>
<p>关于fromIndex有三个规则:</p>
<ol>
<li>正值。如果该值大于或等于数组的长度，则整个数组会被查找。</li>
<li>负值。将其视为从数组末尾向前的偏移。(比如-2，从数组最后第二个元素开始往前查找)</li>
<li>负值。其绝对值大于数组长度，则方法返回 -1，即数组不会被查找。</li>
</ol>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a=[<span class="string">&#x27;OB&#x27;</span>,<span class="number">4</span>,<span class="string">&#x27;Koro1&#x27;</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="string">&#x27;Koro1&#x27;</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="string">&#x27;Koro1&#x27;</span>]; <span class="comment">// 数组长度为10</span></span><br><span class="line"><span class="comment">// let b=a.lastIndexOf(&#x27;Koro1&#x27;,4); // 从下标4开始往前找 返回下标2</span></span><br><span class="line"><span class="comment">// let b=a.lastIndexOf(&#x27;Koro1&#x27;,100); //  大于或数组的长度 查找整个数组 返回9</span></span><br><span class="line"><span class="comment">// let b=a.lastIndexOf(&#x27;Koro1&#x27;,-11); // -1 数组不会被查找</span></span><br><span class="line"><span class="keyword">let</span> b=a.lastIndexOf(<span class="string">&#x27;Koro1&#x27;</span>,-<span class="number">9</span>); <span class="comment">// 从第二个元素4往前查找，没有找到 返回-1</span></span><br></pre></td></tr></table></figure>

<h3 id="ES7-includes-查找数组是否包含某个元素-返回布尔"><a href="#ES7-includes-查找数组是否包含某个元素-返回布尔" class="headerlink" title="ES7 includes() 查找数组是否包含某个元素 返回布尔"></a>ES7 includes() 查找数组是否包含某个元素 返回布尔</h3><blockquote>
<p>定义： 返回一个布尔值，表示某个数组是否包含给定的值</p>
<p>语法：array.includes(searchElement,fromIndex=0)</p>
<p>参数：</p>
<p>searchElement(必须):被查找的元素</p>
<p>fromIndex(可选):默认值为0，参数表示搜索的起始位置，接受负值。正值超过数组长度，数组不会被搜索，返回false。负值绝对值超过长数组度，重置从0开始搜索。</p>
<p><strong>includes方法是为了弥补indexOf方法的缺陷而出现的:</strong></p>
<ol>
<li>indexOf方法不能识别<code>NaN</code></li>
<li>indexOf方法检查是否包含某个值不够语义化，需要判断是否不等于<code>-1</code>，表达不够直观</li>
</ol>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a=[<span class="string">&#x27;OB&#x27;</span>,<span class="string">&#x27;Koro1&#x27;</span>,<span class="number">1</span>,<span class="literal">NaN</span>];</span><br><span class="line"><span class="comment">// let b=a.includes(NaN); // true 识别NaN</span></span><br><span class="line"><span class="comment">// let b=a.includes(&#x27;Koro1&#x27;,100); // false 超过数组长度 不搜索</span></span><br><span class="line"><span class="comment">// let b=a.includes(&#x27;Koro1&#x27;,-3);  // true 从倒数第三个元素开始搜索 </span></span><br><span class="line"><span class="comment">// let b=a.includes(&#x27;Koro1&#x27;,-100);  // true 负值绝对值超过数组长度，搜索整个数组</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
  </entry>
  <entry>
    <title>JS中的连等赋值操作</title>
    <url>/posts/24177/</url>
    <content><![CDATA[<p>金三银四正是面试的好时候，有不少学员面试后在前端群里分享 JS 面试题，我正巧没事儿翻到一题做做看，发现答案与我自己的预期大相径庭，当时我就震惊了，在 chrome 控制台打印了下结果，还真是我错了。没错，就是下面这道连等赋值题：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  name: <span class="string">&#x27;a&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">a.x = a = &#123;&#125;;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>问：此刻的 <code>a.x</code> 是多少。</p>
<p>当时我简单的分析了下，由于 a 赋值给了一个新对象，接着又把 a 赋值给了 a.x ，那理所当然 a.x 不就是 {} 嘛。然而答案却是出乎意料的 undefined …</p>
<p>想了半天还是感觉理解不了，我就 google 了下，发现了这篇文章：<a href="https://www.cnblogs.com/xxcanghai/p/4998076.html">千万不要在 JS 中使用连等赋值操作</a> 。看完后理解了。</p>
<p>这道题的核心在于知道 JS 是如何执行 <code>a.x = a = &#123;&#125;</code> 这行代码的，分两步：一是确定 a 是什么，二是代码执行顺序是从右向左的。</p>
<p>我们一步步看，第一行代码 <code>var a = &#123;name: &#39;a&#39;&#125;</code> ，这句话应该都没什么疑问，我们把 a 的地址假设为 AAA 。</p>
<p>然后就是 <code>a.x = a = &#123;&#125;</code> ，按照步骤来，先<strong>确定 a 是什么</strong>，在还没有赋值操作前，<code>a.x</code> 的 a 指向 AAA，中间的 <code>a</code> 也是指向 AAA ，新创建的对象 <code>&#123;&#125;</code> 地址假设为 BBB 。然后代码从右向左执行，<code>a = &#123;&#125;</code> ，所以中间的 a 指向了新地址 BBB ；接着 <code>a.x = a</code> ，此刻的 <code>a.x</code> 的 a 仍然是 AAA（因为在赋值前就已经确定了 a 的地址），赋值后原地址 AAA 的对象就变成了 {name: ‘a’, x: {}} 这里的 x 指向的就是新对象地址 BBB 。</p>
<p>上述操作结束后再来问 a.x 的值是什么，此刻的 a 已经在 <code>a = &#123;&#125;</code> 这一步赋值操作后指向了新的地址 BBB ，所以此刻的 a 是空对象 {} ，而空对象是没有 x 属性的，所以输出 undefined 。</p>
<p>是不是有点绕？这种题出出来真是挺看 JS 功底的，它考察了你对 JS 编译原理的理解与掌握情况。借用上面博客里博主的一句话作为收尾：<strong>尽量不要使用 JS 的连续赋值操作，除非真的了解它的内部机制及可能会产生的后果。</strong></p>
<h2 id="阅读更多"><a href="#阅读更多" class="headerlink" title="阅读更多"></a>阅读更多</h2><p><a href="https://segmentfault.com/q/1010000002637728">https://segmentfault.com/q/1010000002637728</a></p>
<h2 id="可视化地址"><a href="#可视化地址" class="headerlink" title="可视化地址"></a>可视化地址</h2><p><a href="http://pythontutor.com/visualize.html#mode=display">http://pythontutor.com/visualize.html#mode=display</a></p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  n: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> b = a;</span><br><span class="line">a = a.x = &#123;</span><br><span class="line">  n: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a.x);</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
  </entry>
  <entry>
    <title>JavaScript使用技巧</title>
    <url>/posts/64741/</url>
    <content><![CDATA[<h3 id="转-Boolean-类型"><a href="#转-Boolean-类型" class="headerlink" title="转 Boolean 类型"></a>转 Boolean 类型</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">!!<span class="number">0</span>; <span class="comment">// false</span></span><br><span class="line">!!<span class="number">1</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>通过两个取反，可以强制转换为 Boolean 类型。</p>
<h3 id="转-Number-类型"><a href="#转-Number-类型" class="headerlink" title="转 Number 类型"></a>转 Number 类型</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">+<span class="string">&#x27;233&#x27;</span> + <span class="comment">// 233</span></span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">// 13位时间戳</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>会自动转化为 Number 类型的。日期取时间戳不用 new Date().getTime()。</p>
<h3 id="短路求值"><a href="#短路求值" class="headerlink" title="短路求值"></a>短路求值</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = b || <span class="number">1</span>; <span class="comment">// b为真，a=b; b为假，a=1;</span></span><br><span class="line"><span class="keyword">let</span> c = b &amp;&amp; <span class="number">1</span>; <span class="comment">// b为真，c=1; b为假，c=b;</span></span><br></pre></td></tr></table></figure>

<p>用来简化 <code>if-else</code></p>
<h3 id="变量声明简写"><a href="#变量声明简写" class="headerlink" title="变量声明简写"></a>变量声明简写</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> y;</span><br><span class="line"><span class="keyword">let</span> z = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x = <span class="number">1</span>,</span><br><span class="line">  y,</span><br><span class="line">  z = <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<h3 id="条件语句简写"><a href="#条件语句简写" class="headerlink" title="条件语句简写"></a>条件语句简写</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (result === <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">if</span> (result !== <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (result)</span><br><span class="line"><span class="keyword">if</span> (!result)</span><br></pre></td></tr></table></figure>

<h3 id="十进制乘方简写"><a href="#十进制乘方简写" class="headerlink" title="十进制乘方简写"></a>十进制乘方简写</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1e7</span>; i++) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// e.g.</span></span><br><span class="line"><span class="comment">// 1e0 === 1;</span></span><br><span class="line"><span class="comment">// 1e1 === 10;</span></span><br><span class="line"><span class="comment">// 1e2 === 100;</span></span><br><span class="line"><span class="comment">// 1e3 === 1000;</span></span><br><span class="line"><span class="comment">// 1e4 === 10000;</span></span><br><span class="line"><span class="comment">// 1e5 === 100000;</span></span><br></pre></td></tr></table></figure>

<p>这是一个省略大数字后面零的写法，例如 1e7 本质上就是 1 后面接着 7 个零，也就是十进制的 10000000。</p>
<h3 id="对象属性简写"><a href="#对象属性简写" class="headerlink" title="对象属性简写"></a>对象属性简写</h3><p>ES6 提供了一种及其简单的方式去分配一个属性给对象，如果属性名与键名（key）相同，则可以采用 ES6 的方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">x</span>: x, <span class="attr">y</span>: y &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123; x, y &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="箭头函数简写"><a href="#箭头函数简写" class="headerlink" title="箭头函数简写"></a>箭头函数简写</h3><p>这个没什么好说的，写出来是为了给后面的隐式返回值做铺垫：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Hello&#x27;</span>, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Loaded&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">list.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写:</span></span><br><span class="line"></span><br><span class="line">sayHello = <span class="function"><span class="params">name</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;Hello&#x27;</span>, name);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;Loaded&#x27;</span>), <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">list.forEach(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">console</span>.log(item));</span><br></pre></td></tr></table></figure>

<h3 id="隐式返回值简写"><a href="#隐式返回值简写" class="headerlink" title="隐式返回值简写"></a>隐式返回值简写</h3><p>箭头函数能隐式返回其值这大家都知道，下面要说的是再返回多行语句下，如何省略 return 关键字：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calcCircumference</span>(<span class="params">diameter</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.PI * diameter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">foo</span>: <span class="number">1</span> &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写:</span></span><br><span class="line">calcCircumference = <span class="function"><span class="params">diameter</span> =&gt;</span> <span class="built_in">Math</span>.PI * diameter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> func = <span class="function">() =&gt;</span> (&#123; <span class="attr">foo</span>: <span class="number">1</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>为返回多行语句（例如对象字面量），则需要使用()包围函数体，这也保证了这段代码是单独的声明。</p>
<h3 id="默认参数值简写"><a href="#默认参数值简写" class="headerlink" title="默认参数值简写"></a>默认参数值简写</h3><p>以前为了判断传递给方法参数的默认值，需要用到 if 语句，而在 ES6 中可以直接在参数声明直接定义函数默认值：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">volume</span>(<span class="params">l, w, h</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (w === <span class="literal">undefined</span>) w = <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">if</span> (h === <span class="literal">undefined</span>) h = <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">return</span> l * w * h;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写:</span></span><br><span class="line">volume = <span class="function">(<span class="params">l, w = <span class="number">3</span>, h = <span class="number">4</span></span>) =&gt;</span> l * w * h;</span><br><span class="line"></span><br><span class="line">volume(<span class="number">2</span>); <span class="comment">//output: 24</span></span><br></pre></td></tr></table></figure>

<h3 id="解构赋值简写"><a href="#解构赋值简写" class="headerlink" title="解构赋值简写"></a>解构赋值简写</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> observable = <span class="built_in">require</span>(<span class="string">&#x27;mobx/observable&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> action = <span class="built_in">require</span>(<span class="string">&#x27;mobx/action&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> runInAction = <span class="built_in">require</span>(<span class="string">&#x27;mobx/runInAction&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="built_in">this</span>.props.store;</span><br><span class="line"><span class="keyword">const</span> form = <span class="built_in">this</span>.props.form;</span><br><span class="line"><span class="keyword">const</span> loading = <span class="built_in">this</span>.props.loading;</span><br><span class="line"><span class="keyword">const</span> errors = <span class="built_in">this</span>.props.errors;</span><br><span class="line"><span class="keyword">const</span> entity = <span class="built_in">this</span>.props.entity;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; observable, action, runInAction &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; store, form, loading, errors, entity &#125; = <span class="built_in">this</span>.props;</span><br></pre></td></tr></table></figure>

<p>也可以分配变量名：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; store, form, loading, errors, <span class="attr">entity</span>: contact &#125; = <span class="built_in">this</span>.props;</span><br></pre></td></tr></table></figure>

<h3 id="冻结-const-声明的对象，避免更改其中的属性"><a href="#冻结-const-声明的对象，避免更改其中的属性" class="headerlink" title="冻结 const 声明的对象，避免更改其中的属性"></a>冻结 const 声明的对象，避免更改其中的属性</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> HOST = &#123;</span><br><span class="line">  url: <span class="string">&#x27;https://www.bilibili.com/api&#x27;</span>,</span><br><span class="line">  port: <span class="number">443</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Object</span>.freeze(HOST); <span class="comment">// 冻结/锁住对象</span></span><br><span class="line">HOST.port = <span class="number">80</span>; <span class="comment">// 控制台会报错，且无法更改port</span></span><br><span class="line"><span class="built_in">console</span>.log(HOST);</span><br></pre></td></tr></table></figure>

<h3 id="美化-JSON-stringify-的输出"><a href="#美化-JSON-stringify-的输出" class="headerlink" title="美化 JSON.stringify 的输出"></a>美化 JSON.stringify 的输出</h3><h4 id="第二个参数：函数或数组"><a href="#第二个参数：函数或数组" class="headerlink" title="第二个参数：函数或数组"></a>第二个参数：函数或数组</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Udacity = &#123;</span><br><span class="line">  title: <span class="string">&#x27;优达学城&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;https://www.udacity.com&#x27;</span>,</span><br><span class="line">  lessons: [&#123; <span class="attr">name</span>: <span class="string">&#x27;Front-End&#x27;</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">&#x27;Back-End&#x27;</span> &#125;]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 只取 Udacity 中的 title 和 url 字段</span></span><br><span class="line"><span class="keyword">let</span> json = <span class="built_in">JSON</span>.stringify(</span><br><span class="line">  Udacity,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&#x27;title&#x27;</span>) &#123;</span><br><span class="line">      value = <span class="string">&#x27;I love &#x27;</span> + value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">2</span></span><br><span class="line">); <span class="comment">// 对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> json = <span class="built_in">JSON</span>.stringify(Udacity, [<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;url&#x27;</span>], <span class="number">2</span>); <span class="comment">// 数组</span></span><br><span class="line"><span class="built_in">console</span>.log(json);</span><br></pre></td></tr></table></figure>

<h4 id="第三个参数：指定缩进用的空白字符串"><a href="#第三个参数：指定缩进用的空白字符串" class="headerlink" title="第三个参数：指定缩进用的空白字符串"></a>第三个参数：指定缩进用的空白字符串</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  name: <span class="string">&#x27;Lance&#x27;</span>,</span><br><span class="line">  age: <span class="number">26</span>,</span><br><span class="line">  weight: <span class="number">120</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(obj, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三个参数代表：指定缩进用的空白字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   &quot;name&quot;: &quot;Lance&quot;,</span></span><br><span class="line"><span class="comment">//   &quot;age&quot;: 26,</span></span><br><span class="line"><span class="comment">//   &quot;weight&quot;: 120</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-JavaScript坑之一map参数传递</title>
    <url>/posts/27648/</url>
    <content><![CDATA[<h2 id="转载文章"><a href="#转载文章" class="headerlink" title="转载文章"></a>转载文章</h2><p>博客源：<a href="https://blog.csdn.net/drafting_dreams/article/details/77684580">JavaScript 坑之一 map 参数传递</a></p>
<p>map()方法定义在 JavaScript 的 Array 中，他是一个高阶函数。我们向这个函数传入我们自己定义的回调函数（callback），然后 map 会对数组当中每一个元素去调用回调函数。</p>
<p>通常，我们只在回调函数里用一个参数，因为大多数回调函数只需要一个参数，或者一个必须参数和多个可选参数。这样的习惯会有时导致很诡异的行为。</p>
<a id="more"></a>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>].map(<span class="built_in">parseInt</span>); <span class="comment">//[1, NaN, NaN]</span></span><br></pre></td></tr></table></figure>

<p>我们所希望看到的结果其实是[1, 2, 3]，原因是 parseInt 一般我们用的时候都是习惯性用一个参数，但他可以接收两个参数，第二个参数用来做基数。而 map 向回调函数传参有三个，数组中的元素，元素的下标和这个数组。第三个参数被 parseInt 忽略掉，前两个参数被接收。<br>parseInt(‘0’, 0); //基数为 0，或者 undefined，用 10 进制</p>
<p>parseInt(‘1’, 1); //没有 1 进制，返回 NaN</p>
<p>parseInt(‘2’, 2); //二进制不能出现 2，返回 NaN</p>
<p>这里关键是要知道回调函数接收的参数有三个，那么如何解决上面的问题呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myParseInt</span>(<span class="params">intString</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseInt</span>(intString, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>].map(myParseInt);</span><br></pre></td></tr></table></figure>

<p>或者，用更简单的写法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>].map(<span class="function"><span class="params">str</span> =&gt;</span> <span class="built_in">parseInt</span>(str));</span><br></pre></td></tr></table></figure>

<p>或者，最简单的写法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>].map(<span class="built_in">Number</span>);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>Mac安装CocoaPods</title>
    <url>/posts/27721/</url>
    <content><![CDATA[<h2 id="安装-CocoaPods-命令"><a href="#安装-CocoaPods-命令" class="headerlink" title="安装 CocoaPods 命令"></a>安装 CocoaPods 命令</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo gem install cocoapods</span><br></pre></td></tr></table></figure>

<p>等待了几分钟后，显示下面的信息，便表示已经安装成功了:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Installing ri documentation for cocoapods-1.8.4</span><br><span class="line">Done installing documentation for thread_safe, tzinfo, concurrent-ruby, i18n, activesupport, nap, fuzzy_match, httpclient, algoliasearch, cocoapods-core, claide, cocoapods-deintegrate, cocoapods-downloader, cocoapods-plugins, cocoapods-search, cocoapods-stats, netrc, cocoapods-trunk, cocoapods-try, molinillo, atomos, colored2, nanaimo, xcodeproj, escape, fourflusher, gh_inspector, ruby-macho, cocoapods after 21 seconds</span><br><span class="line">29 gems installed</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>最后一步 ，下载文件:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pod setup</span><br></pre></td></tr></table></figure>

<h2 id="项目中使用-CocoaPods"><a href="#项目中使用-CocoaPods" class="headerlink" title="项目中使用 CocoaPods"></a>项目中使用 CocoaPods</h2><h3 id="添加-Podfile-文件"><a href="#添加-Podfile-文件" class="headerlink" title="添加 Podfile 文件"></a>添加 Podfile 文件</h3><p>终端中 cd 到项目根目录 输入 <code>touch Podfile</code></p>
<p>输入 <code>touch Podfile</code> 后，我们的工程目录中会出现 一个 <code>Podfile</code> 文件</p>
<h3 id="编辑-Podfile-文件"><a href="#编辑-Podfile-文件" class="headerlink" title="编辑 Podfile 文件"></a>编辑 Podfile 文件</h3><p>在文件中输入自己需要的第三方项目库，我们以 <code>AFNetworking</code> 为例</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">platform :ios, &#x27;10.0&#x27;</span><br><span class="line"></span><br><span class="line">target &#x27;CocoaPodsDemo&#x27; do</span><br><span class="line"></span><br><span class="line">pod &#x27;AFNetworking&#x27;</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="执行-pod"><a href="#执行-pod" class="headerlink" title="执行 pod"></a>执行 pod</h3><p>终端输入 <code>pod install</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pod install</span><br><span class="line">Analyzing dependencies</span><br><span class="line">Adding spec repo `trunk` with CDN `https://cdn.cocoapods.org/`</span><br><span class="line">Downloading dependencies</span><br><span class="line">Installing AFNetworking (3.2.1)</span><br><span class="line">Generating Pods project</span><br><span class="line">Integrating client project</span><br><span class="line"></span><br><span class="line">[!] Please close any current Xcode sessions and use `CocoaPodsDemo.xcworkspace` for this project from now on.</span><br><span class="line">Pod installation complete! There is 1 dependency from the Podfile and 1 total pod installed.</span><br></pre></td></tr></table></figure>

<p>输出上面的内容就表示，已经成功了，提示我们关掉当前的看到上面的项目，打开 <code>CocoaPodsDemo.xcworkspace</code> 这个项目。</p>
<h3 id="更新-Cocoapods"><a href="#更新-Cocoapods" class="headerlink" title="更新 Cocoapods"></a>更新 Cocoapods</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pod update --no-repo-update</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>macOS</tag>
        <tag>iOS</tag>
        <tag>CocoaPods</tag>
        <tag>Xcode</tag>
      </tags>
  </entry>
  <entry>
    <title>Photoshop如何生成多页PDF</title>
    <url>/posts/13252/</url>
    <content><![CDATA[<p>来源：<a href="http://blog.sina.com.cn/s/blog_146b3a65e0102yemg.html">http://blog.sina.com.cn/s/blog_146b3a65e0102yemg.html</a></p>
<ol>
<li>要把分页的内容分别在 ps 中建立不同的文档</li>
</ol>
<img src="/posts/13252/pdf1.png" class="" title="pdf1">

<img src="/posts/13252/pdf2.png" class="" title="pdf2">

<ol>
<li>然后点击文件——自动——pdf 演示文稿，选择添加打开的文件，选择多页面文档，点击存储即可</li>
</ol>
<img src="/posts/13252/pdf3.png" class="" title="pdf3">
]]></content>
      <categories>
        <category>教程</category>
        <category>PS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>【翻译】Minification 压缩与 Gzip 压缩的区别</title>
    <url>/posts/8214/</url>
    <content><![CDATA[<blockquote>
<p>原链接：<a href="https://css-tricks.com/the-difference-between-minification-and-gzipping/">https://css-tricks.com/the-difference-between-minification-and-gzipping/</a><br>作者：Chris Coyier</p>
</blockquote>
<p>这两种方法都针对你网站上的资源（比如 .css 文件和 .js 文件）所使用。它们都用来压缩文件大小，使服务器和浏览器之间的网络更加通畅，提高网页性能。网络是网页的速度瓶颈所在，而压缩文件大小能够改善这一点。</p>
<p>但这两者也截然不同。如果之前你并不知道这一点，那么你应当花时间来了解它。</p>
<a id="more"></a>

<h1 id="Minification-能够删除空格符（whitespace）、注释符（comments）、无用的分号（semicolons）或是减少-hex-代码的长度…"><a href="#Minification-能够删除空格符（whitespace）、注释符（comments）、无用的分号（semicolons）或是减少-hex-代码的长度…" class="headerlink" title="Minification 能够删除空格符（whitespace）、注释符（comments）、无用的分号（semicolons）或是减少 hex 代码的长度…"></a>Minification 能够删除空格符（whitespace）、注释符（comments）、无用的分号（semicolons）或是减少 hex 代码的长度…</h1><p>……诸如此类。剩下的文件依然是有效代码。你不必尝试读取它或是使用它，它并没有违反任何规则。就像对原始文件那样，浏览器可以读取它和使用它。</p>
<p>Minification 能够创建你最终使用的新文件。比如当你创建了一个名为 <code>style.css</code> 的文件之后，你可以把它压缩为 <code>style.min.css</code>。</p>
<h1 id="Gizpping-能识别所有重复的字符串，并使用指代该字符串第一个实例的指针来代替。"><a href="#Gizpping-能识别所有重复的字符串，并使用指代该字符串第一个实例的指针来代替。" class="headerlink" title="Gizpping 能识别所有重复的字符串，并使用指代该字符串第一个实例的指针来代替。"></a>Gizpping 能识别所有重复的字符串，并使用指代该字符串第一个实例的指针来代替。</h1><p>Julia Evans 曾想出一个绝佳的方法来解释这一点（点击<a href="https://jvns.ca/blog/2013/10/24/day-16-gzip-plus-poetry-equals-awesome/">这里</a>查阅她发布的内容和视频）。下面是一首诗的第一段：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Once upon a midnight dreary, <span class="keyword">while</span> I &#123;pon&#125;dered weak an&#123;d wea&#125;&#123;ry,&#125;</span><br><span class="line">Over many&#123; a &#125;quaint&#123; and &#125;curious volume <span class="keyword">of</span> forgotten lore,</span><br><span class="line">W&#123;hile I &#125;nodded, n&#123;ear&#125;ly napping, su&#123;dde&#125;n&#123;ly &#125;th&#123;ere&#125; ca&#123;me &#125;a t&#123;apping,&#125;</span><br><span class="line">As&#123; <span class="keyword">of</span> &#125;so&#123;me o&#125;ne gent&#123;ly &#125;r&#123;apping, &#125;&#123;rapping&#125; at my chamb&#123;er &#125;door.</span><br><span class="line"><span class="string">`&#x27;Tis&#123; some &#125;visitor,&#x27;&#123; I &#125;mu&#123;tte&#125;r&#123;ed, &#125;`</span>t&#123;apping at my chamber door&#125; -</span><br><span class="line">O&#123;nly th&#125;is,&#123; and &#125;no&#123;thi&#125;&#123;ng &#125;m&#123;ore&#125;.</span><br></pre></td></tr></table></figure>

<p>Gzip 识别出括弧里的文字都是重复的，因此将会使用指针来代替它们，这样这些文字占用的空间将会比原来更小。</p>
<p>对于减少文件大小、尤其是代码而言，这种方法十分高效，因为代码中有大量重复的内容。设想一下一个 HTML 文件里有多少个 <code>&lt;div</code>，一个 CSS 文件里又有多少 <code>&#123;</code>。</p>
<p>你也可以创建某个文件的 Gzip 压缩版本，比如 style.css.zip。但你一般不会这样做，浏览器也不知道应该如何使用这个文件。</p>
<p>在网页中，Gzip 压缩直接通过服务器完成。因此你要做的是配置服务器。一旦完成配置，Gzip 压缩将会自动进行，你无需再做任何工作。服务器会压缩文件，并通过网络传送文件。浏览器则接受文件，并在使用之前进行解压。我从未听谁提到过压缩和解压的成本，因此在这里我假设这些成本可以忽略不计，并且我们获得的受益远大于成本。</p>
<p>点击<a href="https://css-tricks.com/snippets/htaccess/active-gzip-compression/">这里</a>查看如何在 Apache 服务器中进行配置，这里使用了 <code>mod_deflate</code> 模块。H5BP 也为所有常见的服务器<a href="https://github.com/h5bp/server-configs">提供了服务器配置</a>，包括 Gzipping。</p>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><p>我们将用到 <a href="https://getbootstrap.com/">Bootstrap</a> 中常见的 CSS 文件。</p>
<img src="/posts/8214/3e99e9b284d401c365c5044bc715ba44c9246f83.jpg" class="" title="3e99e9b284d401c365c5044bc715ba44c9246f83">

<p>通过 Minification 来压缩这个 CSS 文件，你将节省 17% 的空间，而使用 Gzipping 能够节省 85%，将两种方法结合使用节省的空间是 86%。</p>
<p>下面是使用 DevTools 检查工作状况时的理想情况：</p>
<img src="/posts/8214/997aee7f7378ac61ca5b36877a65f44c3ed70bc5.jpg" class="" title="997aee7f7378ac61ca5b36877a65f44c3ed70bc5">

<h1 id="Gzip压缩-要高效得多，而将两种方法结合起来更为理想。"><a href="#Gzip压缩-要高效得多，而将两种方法结合起来更为理想。" class="headerlink" title="Gzip压缩 要高效得多，而将两种方法结合起来更为理想。"></a>Gzip压缩 要高效得多，而将两种方法结合起来更为理想。</h1><p>Gzip 压缩节省的空间大概是 Minification 压缩的五倍。然而，通过 Minification 压缩，你也可以获得一些帮助，不过在构建步骤时你需要耗费一些额外的力气。</p>
<p>同样<a href="http://carlos.bueno.org/2010/02/measuring-javascript-parse-and-load.html#minifi">有证据</a>证明浏览器在读取和解析 Minification 压缩的文件时速度更快：</p>
<blockquote>
<p>正如预期的那样，除了缩短网络传输时间以外，Minification 压缩还有助于解析和加载。这也许是因为缺少注释符和额外的空白符。</p>
</blockquote>
<p>微软也开始为此优化它们的语法分析器：</p>
<blockquote>
<p>因此，在 Window 10 和 Microsoft Edge 中，我们新添加了快速路径，改善了在 Chakra 的 JIT 编译器中嵌入和优化部分探视程序的体验，以保证压缩代码的运行速度不低于原始版本。通过这些改变，通过 UglifyJS 压缩过的个体代码模式的性能提高了 20% 到 50%。</p>
</blockquote>
<p>缓存资源同样与这段对话相关，没有什么比一个不需要请求任何资源的浏览器速度更快了！关于这一点，网上或者<a href="https://www.amazon.com/Designing-Performance-Weighing-Aesthetics-Speed/dp/1491902515/ref=as_li_ss_tl?ie=UTF8&linkCode=sl1&tag=css-tricks-20&linkId=d4d794b5604a084164c8ba33d2540283">书</a>中还有许多相关知识，不过很快我们也许会发布一些有关使用技巧的内容。</p>
]]></content>
      <categories>
        <category>后端</category>
        <category>构建工具</category>
      </categories>
      <tags>
        <tag>翻译</tag>
      </tags>
  </entry>
  <entry>
    <title>Promise用法</title>
    <url>/posts/7878/</url>
    <content><![CDATA[<h2 id="Promise是什么"><a href="#Promise是什么" class="headerlink" title="Promise是什么"></a>Promise是什么</h2><p>Promise 是一种异步编程的解决方案，比传统的异步解决方案【回调函数】和【事件】更合理、更强大。</p>
<h2 id="诞生的原因"><a href="#诞生的原因" class="headerlink" title="诞生的原因"></a>诞生的原因</h2><p>异步网络请求的<strong>回调地狱</strong>，而且我们还得对每次请求的结果进行一些处理，代码会更加臃肿。一张图完美诠释：</p>
<img src="/posts/7878/call-back-hello.jpg" class="" title="回调地狱">

<p>不够？再加一张：</p>
<img src="/posts/7878/8144ca8cgw1f2wc9ed35zj218g0p0tey.jpg" class="" title="行为艺术">

<a id="more"></a>

<h2 id="Promise的三种状态"><a href="#Promise的三种状态" class="headerlink" title="Promise的三种状态"></a>Promise的三种状态</h2><ul>
<li>pedding 等待（默认状态。异步代码执行完毕后会转换为以下两种状态）</li>
<li>resolve 成功</li>
<li>reject 失败</li>
</ul>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><ul>
<li>Promise:<ul>
<li>构造函数</li>
<li>接受一个参数：callback，我们把要执行的异步任务放置在这个callback中</li>
</ul>
</li>
<li>then:<ul>
<li>Promise对象下的一个方法：该方法在Promise对象的状态发生改变的时候触发then的回调</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//defined Promise async function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncFun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">            resolve(<span class="comment">/*resolve parameter*/</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="comment">/*Error*/</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//use Promise&amp;then</span></span><br><span class="line">asyncFun().then(<span class="comment">/*function*/</span>).then(<span class="comment">/*function*/</span>)...</span><br></pre></td></tr></table></figure>

<h2 id="Promise特性"><a href="#Promise特性" class="headerlink" title="Promise特性"></a>Promise特性</h2><h3 id="立即执行"><a href="#立即执行" class="headerlink" title="立即执行"></a>立即执行</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 当Promise被实例化的时候，callback的异步任务就会被执行</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;一个Promise对象被创建出来&quot;</span>);</span><br><span class="line">    resolve(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;flag&quot;</span>);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行结果：</span></span><br><span class="line"><span class="comment">// 一个Promise对象被创建出来</span></span><br><span class="line"><span class="comment">// flag</span></span><br><span class="line"><span class="comment">// success</span></span><br></pre></td></tr></table></figure>

<h3 id="状态不可逆"><a href="#状态不可逆" class="headerlink" title="状态不可逆"></a>状态不可逆</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    reject(<span class="string">&quot;reject&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行结果：</span></span><br><span class="line"><span class="comment">// success</span></span><br></pre></td></tr></table></figure>

<h3 id="链式调用"><a href="#链式调用" class="headerlink" title="链式调用"></a>链式调用</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 通过传入的resolve, reject，去改变当前Promise任务的状态</span></span><br><span class="line">    <span class="comment">// resolve, reject 是两个函数，调用 resolve ，会把状态改成 resolved ，调用 reject 函数会把状态改成 rejected</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">        reject();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// then接受两个参数：这两个参数都是回调，当对应的 promise 对象的状态变成了resolved，那么 then 的第一个 callback 就会被执行，如果状态变成了 rejected ，那么 then 的第二个 callback 就会被执行</span></span><br><span class="line">p.then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;成功&#x27;</span>);</span><br><span class="line">&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;失败&#x27;</span>);</span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行结果：</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 失败</span></span><br></pre></td></tr></table></figure>

<h3 id="then的回调异步性"><a href="#then的回调异步性" class="headerlink" title="then的回调异步性"></a>then的回调异步性</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;我是Promise的callback中的代码&quot;</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        resolve(<span class="string">&quot;我1s后才会被执行&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;我是主线程中的同步代码&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行结果：</span></span><br><span class="line"><span class="comment">// 我是Promise的callback中的代码</span></span><br><span class="line"><span class="comment">// 我是主线程中的同步代码</span></span><br><span class="line"><span class="comment">// 我1s后才会被执行</span></span><br></pre></td></tr></table></figure>

<p>解释：Promise 的 callback 回调函数中的代码是立即执行的（setTimeout 这个定时器也是立即执行的，只是函数内的 resolve 被延迟1s执行，跟 Promise 本身的立即执行没关系），但 then 方法中的回调函数执行则是异步的，因此，<code>&quot;我1s后才会被执行&quot;</code> 会在最后输出。</p>
<h3 id="异常的捕获"><a href="#异常的捕获" class="headerlink" title="异常的捕获"></a>异常的捕获</h3><p>Promise的异常有两种方法可以捕获，一种是 then 的第二个回调；一种 <code>.catch()</code> 来捕获前一个 Promise 抛出的错误。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    reject(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">&#125;, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行结果：</span></span><br><span class="line"><span class="comment">// error</span></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    reject(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;catch:&quot;</span> + error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行结果：</span></span><br><span class="line"><span class="comment">// catch:error</span></span><br></pre></td></tr></table></figure>

<h2 id="Promise-all-和-Promise-race"><a href="#Promise-all-和-Promise-race" class="headerlink" title="Promise.all 和 Promise.race"></a>Promise.all 和 Promise.race</h2><h3 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all"></a>Promise.all</h3><p>Promise.all 接收一个参数，它必须是可以迭代的，例如数组。<br>它通常用来处理一些并发的异步操作，即它们的结果互不干扰，但是又需要异步执行。当所有 Promise 都成功的时候，整个 Promise.all 才成功。成功调用后返回一个数组，数组的值是有序的，顺序就是传入参数的数组顺序：</p>
<blockquote>
<p>成功的情况</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> tasks = arr.map(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        resolve(num * <span class="number">5</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all(tasks).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 有序输出</span></span><br><span class="line">    <span class="built_in">console</span>.log(arr); <span class="comment">// [1, 2, 3]</span></span><br><span class="line">    <span class="built_in">console</span>.log(data); <span class="comment">// [5, 10, 15]</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>失败的情况</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> tasks = arr.map(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (num === <span class="number">3</span>) &#123;</span><br><span class="line">            reject(<span class="string">&#x27;rejected&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        resolve(num * <span class="number">5</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all(tasks).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 这里不会执行</span></span><br><span class="line">    <span class="built_in">console</span>.log(arr);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err); <span class="comment">// rejected</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race"></a>Promise.race</h3><p>Promise.race 和 Promise.all 类似，都接收一个可以迭代的参数，但是不同之处是 Promise.race 的状态变化不是全部受参数内的状态影响，一旦参数内有一个值的状态发生的改变，那么该 Promise 的状态就是改变的状态。就跟 race 单词的字面意思一样，谁跑的快谁赢。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">300</span>, <span class="string">&#x27;p1 doned&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">50</span>, <span class="string">&#x27;p2 doned&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p3 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(reject, <span class="number">100</span>, <span class="string">&#x27;p3 rejected&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.race([p1, p2, p3]).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 显然p2更快，所以状态变成了fulfilled</span></span><br><span class="line">    <span class="comment">// 如果p3更快，那么状态就会变成rejected</span></span><br><span class="line">    <span class="built_in">console</span>.log(data); <span class="comment">// p2 doned</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err); <span class="comment">// 不执行</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>Promise</tag>
      </tags>
  </entry>
  <entry>
    <title>Safari下margin-bottom(设置了此属性的元素在页面最底部)</title>
    <url>/posts/32093/</url>
    <content><![CDATA[<h2 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h2><p>Safari 下页面最底部元素的 margin-bottom 失效：</p>
<iframe height="265" scrolling="no" title="Margin not working only in Safari (element is at the bottom of the page)" src="https://codepen.io/JingW/embed/QWyZjgV?height=265&amp;theme-id=light&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<img src="/posts/32093/chrome_safari.png" class="" title="chrome_safari">

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>底部添加一个透明颜色的 div 撑起高度:</p>
<blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;tr-footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>css</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#tr-footer</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: ?px;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: transparent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>Safari</tag>
      </tags>
  </entry>
  <entry>
    <title>Sequelize框架进阶</title>
    <url>/posts/3278/</url>
    <content><![CDATA[<h2 id="传送门"><a href="#传送门" class="headerlink" title="传送门"></a>传送门</h2><ul>
<li><a href="https://evestorm.github.io/posts/1183/">Sequelize框架入门</a></li>
</ul>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>上一篇入门讲到了 <code>Sequelize框架</code> 的基本用法，比如实现简单的增删查改。原本打算一篇文章写到底的，但感觉内容太多，对读者不太友好，就另开了这篇文章。</p>
<p>虽然标题写着“进阶”，但其实有标题党的以为。这篇文章仍然着手于框架的使用，不涉及源码。大纲见侧边栏的目录，我们直接开始吧~</p>
<a id="more"></a>

<h2 id="连表查询"><a href="#连表查询" class="headerlink" title="连表查询"></a>连表查询</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>既然是连表查询，至少得有两个表吧。所以我们还需要另外新建一张表，这里起名为 <code>message</code> 表，表结构如下：</p>
<img src="/posts/3278/message-table.png" class="" title="message-table">

<p>其中 uid 对应用户的 id 。下面是两表的数据：</p>
<img src="/posts/3278/user-message-data.png" class="" title="user-message-data">

<p>接着我们新建一个 <code>app2.js</code> 文件，引入之前 <code>app.js</code> 中的部分代码（连接数据库+UserModel）以及创建一个 <code>MessageModel</code> 模型：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sequelize = <span class="keyword">new</span> Sequelize(<span class="string">&quot;miaov&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>, &#123;</span><br><span class="line">    host: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    port: <span class="number">8889</span>,</span><br><span class="line">    dialect: <span class="string">&quot;mysql&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    sequelize.authenticate();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接成功!&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;连接失败&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UserModel = sequelize.define(<span class="string">&#x27;User&#x27;</span>, &#123;</span><br><span class="line">    id: &#123;</span><br><span class="line">        type: Sequelize.INTEGER(<span class="number">11</span>),</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        autoIncrement: <span class="literal">true</span>,</span><br><span class="line">        primaryKey: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    username: &#123;</span><br><span class="line">        type: Sequelize.STRING(<span class="number">50</span>),</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        defaultValue: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    age: &#123;</span><br><span class="line">        type: Sequelize.TINYINT(<span class="number">3</span>),</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    gender: &#123;</span><br><span class="line">        type: Sequelize.ENUM([<span class="string">&#x27;men&#x27;</span>, <span class="string">&#x27;women&#x27;</span>, <span class="string">&#x27;other&#x27;</span>]),</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        defaultValue: <span class="string">&#x27;men&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    timestamps: <span class="literal">false</span>,</span><br><span class="line">    tableName: <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MessageModel = sequelize.define(<span class="string">&#x27;Message&#x27;</span>, &#123;</span><br><span class="line">    id: &#123;</span><br><span class="line">        type: Sequelize.INTEGER(<span class="number">11</span>),</span><br><span class="line">        primaryKey: <span class="literal">true</span>,</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        autoIncrement: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    uid: &#123;</span><br><span class="line">        type: Sequelize.INTEGER(<span class="number">11</span>),</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        defaultValue: <span class="number">0</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    content: &#123;</span><br><span class="line">        type: Sequelize.STRING(<span class="number">255</span>),</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        defaultValue: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    timestamps: <span class="literal">false</span>,</span><br><span class="line">    freezeTableName: <span class="literal">true</span>, <span class="comment">// 默认 false 将自动修改表名为复数，true 表示不修改表名，与数据库表名同步</span></span><br><span class="line">    tableName: <span class="string">&#x27;message&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="需求-普通做法"><a href="#需求-普通做法" class="headerlink" title="需求+普通做法"></a>需求+普通做法</h3><p>我们这次的需求是获取某条留言的所有数据，其中包含 <code>留言本身的数据</code> + <code>该留言的用户数据</code> ，先来看最“耿直”的做法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> data = &#123;&#125;;</span><br><span class="line">    <span class="comment">// 根据 id 查找 message</span></span><br><span class="line">    <span class="keyword">let</span> message = <span class="keyword">await</span> MessageModel.findByPk(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 根据 message 的 uid 反查出发布这条 message 的 user</span></span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> UserModel.findByPk(message.get(<span class="string">&#x27;uid&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.assign(data, &#123;</span><br><span class="line">        id: message.id,</span><br><span class="line">        uid: message.uid,</span><br><span class="line">        content: message.content,</span><br><span class="line">        username: user.username,</span><br><span class="line">        age: user.age,</span><br><span class="line">        gender: user.gender,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h3 id="BelongsTo"><a href="#BelongsTo" class="headerlink" title="BelongsTo"></a>BelongsTo</h3><p>除了上面这种做法外，我们还可以使用 <code>sequelize</code> 提供的 <code>BelongsTo</code> 来关联两个模型进行查询。</p>
<p>思考一下我们的 <code>users</code> 和 <code>message</code> 表，从 <code>message</code> 的角度来讲，一条留言属于一个用户发布的，是一对一的关系。而 <code>BelongsTo</code> 关联的含义就是 A 属于 B。那我们应该怎么写代码呢？步骤如下：</p>
<ol>
<li><p>首先在模型中给关联的字段定义外键关系</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">references: &#123;</span><br><span class="line">   model: 关联的外键表模型, e.g. UserModel</span><br><span class="line">   key: 关联的外键表的字段, e.g. id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在调用 <code>belongsTo</code> 或 <code>hasMany</code> 等方法的时候，通过第二个参数设置对象</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123; </span><br><span class="line">   foreignKey: 当前关联表的字段, e.g. uid</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>没有完全理解上面的步骤也没关系，直接上代码更加清晰：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MessageModel = sequelize.define(<span class="string">&#x27;Message&#x27;</span>, &#123;</span><br><span class="line">    ...,</span><br><span class="line">    uid: &#123; <span class="comment">// 第一步：在模型中给关联的字段定义外键关系</span></span><br><span class="line">        ...</span><br><span class="line">        references: &#123;</span><br><span class="line">            model: UserModel, <span class="comment">// 关联的外键表模型</span></span><br><span class="line">            key: <span class="string">&#x27;id&#x27;</span>,        <span class="comment">// 关联的外键表的字段</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">&#125;, ...);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 第二步：声明两表关系及外键</span></span><br><span class="line">    <span class="comment">// 下面方法翻译过来：留言属于用户</span></span><br><span class="line">    MessageModel.belongsTo(UserModel, &#123;</span><br><span class="line">        foreignKey: <span class="string">&#x27;uid&#x27;</span> <span class="comment">// 声明自己（message）的外键是 uid</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> MessageModel.findByPk(<span class="number">1</span>, &#123;</span><br><span class="line">        include: [UserModel] <span class="comment">// 表述查出的 message 记录中包含有对应的 user</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`</span></span><br><span class="line"><span class="string">        留言id：<span class="subst">$&#123;data.id&#125;</span></span></span><br><span class="line"><span class="string">        留言人名称：<span class="subst">$&#123;data.User.username&#125;</span></span></span><br><span class="line"><span class="string">        留言内容：<span class="subst">$&#123;data.content&#125;</span></span></span><br><span class="line"><span class="string">    `</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>



<h3 id="HasMany"><a href="#HasMany" class="headerlink" title="HasMany"></a>HasMany</h3><p>这次我们换个角度，来通过某个用户查找他/她所有的留言。稍微想一下，一个用户是可以发布多条留言的，所以从 <code>users</code> 角度来讲，跟 <code>message</code> 是一对多的关系。而 <code>sequelize</code> 也提供了处理这种关系的方法，那就是 <code>HasMany</code>。直接上代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// users 拥有</span></span><br><span class="line">    UserModel.hasMany(MessageModel, &#123;</span><br><span class="line">        foreignKey: <span class="string">&#x27;uid&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> UserModel.findByPk(<span class="number">3</span>, &#123;</span><br><span class="line">        include: [MessageModel]</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`</span></span><br><span class="line"><span class="string">        id为 <span class="subst">$&#123;data.id&#125;</span> 的留言人 <span class="subst">$&#123;data.username&#125;</span> 的留言内容：</span></span><br><span class="line"><span class="string">    `</span>);</span><br><span class="line">    data.Messages.forEach(<span class="function"><span class="params">m</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;m.content&#125;</span>`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>



<h2 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h2><p>安装的 sequelize 和 mysql2 的版本为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;mysql2&quot;</span>: <span class="string">&quot;^1.6.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sequelize&quot;</span>: <span class="string">&quot;^5.3.1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>后端</category>
        <category>SQL</category>
      </categories>
      <tags>
        <tag>Sequelize</tag>
      </tags>
  </entry>
  <entry>
    <title>SourceTree识别不了新文件夹</title>
    <url>/posts/45184/</url>
    <content><![CDATA[<p>环境：OS X 10.15.5 + Git + SourceTree</p>
<p>问题：我在某个 <code>SourceTree</code> 管理的项目目录下，添加了另一个项目文件夹进来，然后我想把这个文件夹也提交到 repo，但 <code>SourceTree</code> 的文件状态死活不更新。</p>
<p>后来发现新增文件夹中有个隐藏的 .git 文件夹，然后我把它删掉就能在文件状态看到刚新增的这个文件夹数据了，猜测是 SourceTree 认为那个文件夹是被别的 git 管理，所以加不进去。</p>
]]></content>
      <categories>
        <category>工具</category>
        <category>版本控制</category>
      </categories>
      <tags>
        <tag>SourceTree</tag>
      </tags>
  </entry>
  <entry>
    <title>Swift注入变量给前端导致的报错问题</title>
    <url>/posts/13655/</url>
    <content><![CDATA[<p>在 iOS 中加载 H5 时需要注入一些 JS 变量供前端使用，例如把 App 相关的信息存进 JS ，好让 JS 调用：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MARK: 获取App信息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">getAppInfo</span><span class="params">()</span></span> -&gt; [<span class="type">String</span>: <span class="type">String</span>] &#123;</span><br><span class="line">    <span class="keyword">let</span> infoDictionary = <span class="type">Bundle</span>.main.infoDictionary!</span><br><span class="line">    <span class="keyword">let</span> appVersion = infoDictionary[<span class="string">&quot;CFBundleShortVersionString&quot;</span>] <span class="keyword">as</span>! <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> appName = infoDictionary[<span class="string">&quot;CFBundleName&quot;</span>] <span class="keyword">as</span>! <span class="type">String</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&quot;version&quot;</span>: appVersion, <span class="string">&quot;name&quot;</span>: appName]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//        获取app信息</span></span><br><span class="line"><span class="keyword">let</span> appInfo = getAppInfo()</span><br><span class="line"><span class="keyword">let</span> scriptStr = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">   window.iOS = &#123;</span></span><br><span class="line"><span class="string">         &#x27;getAppInfo&#x27;: &#123;</span></span><br><span class="line"><span class="string">            &#x27;version&#x27;: \(appInfo[&quot;version&quot;]!),</span></span><br><span class="line"><span class="string">            &#x27;name&#x27;: \(appInfo[&quot;name&quot;]!),</span></span><br><span class="line"><span class="string">         &#125;</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>上面的代码注入到 JS 中会导致前端无法通过 <code>iOS.getAppInfo.name</code> 获取到 App 的名称，明明我的 <code>appInfo[&quot;name&quot;]</code> 是个 String 字符串类型，为什么会拿不到了？</p>
<p>通过在 Swift 打印 <code>scriptStr</code> 变量我发现，<code>window.iOS</code> 对象中的 name 属性被解析成了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;name&#x27;</span>: App名称</span><br></pre></td></tr></table></figure>

<p>所以 JS 无法拿到，问题就出现在 <code>App名称</code> 上，这原本是个字符串，但注入到 JS 后它并没有被 <code>双引号&quot;&quot;</code> 或 <code>单引号&#39;&#39;</code> 包裹，导致 JS 会把 <code>App名称</code> 当做是个变量名而不是字符串。所以把上面代码改为下方形式就好了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> scriptStr = <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">   window.iOS = &#123;</span></span><br><span class="line"><span class="string">         &#x27;getAppInfo&#x27;: &#123;</span></span><br><span class="line"><span class="string">            &#x27;version&#x27;: &quot;</span>\(appInfo[<span class="string">&quot;version&quot;</span>]!)<span class="string">&quot;,</span></span><br><span class="line"><span class="string">            &#x27;name&#x27;: &quot;</span>\(appInfo[<span class="string">&quot;name&quot;</span>]!)<span class="string">&quot;,</span></span><br><span class="line"><span class="string">         &#125;</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>Swift记录通话时间</title>
    <url>/posts/32380/</url>
    <content><![CDATA[<p>公司 App 项目需要记录用户拨打电话的通话时间，查了下文档，发现 CallKit 提供的接口可以完成此功能。</p>
<a id="more"></a>

<p>代码如下：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> CallKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">WKScriptMessageHandler</span>, <span class="title">WKUIDelegate</span>, <span class="title">WKNavigationDelegate</span>, <span class="title">MFMessageComposeViewControllerDelegate</span>, <span class="title">CXCallObserverDelegate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> callObserver = <span class="type">CXCallObserver</span>()</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> beforeDate: <span class="type">Date!</span> <span class="comment">// 注意：这里必须是全局属性，不能定义局部变量</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ----------- 打电话 --------------</span></span><br><span class="line">  <span class="comment">// 参考: https://stackoverflow.com/questions/13743344/how-can-i-find-out-whether-the-user-pressed-the-call-or-the-cancel-button-when-m</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">callPhone</span><span class="params">(phoneStr: String)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> phone = <span class="string">&quot;telprompt://&quot;</span> + phoneStr</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> url = <span class="type">NSURL</span>(string: phone.replacingOccurrences(of: <span class="string">&quot; &quot;</span>, with: <span class="string">&quot;&quot;</span>, options: .literal, range: <span class="literal">nil</span>)), <span class="type">UIApplication</span>.shared.canOpenURL(url <span class="keyword">as</span> <span class="type">URL</span>) &#123;</span><br><span class="line">            callObserver.setDelegate(<span class="keyword">self</span>, queue: <span class="type">DispatchQueue</span>.main)</span><br><span class="line">            didDetectOutgoingCall = <span class="literal">false</span></span><br><span class="line">            <span class="comment">// we only want to add the observer after the alert is displayed,</span></span><br><span class="line">            <span class="comment">// that&#x27;s why we&#x27;re using asyncAfter(deadline:)</span></span><br><span class="line">            <span class="type">UIApplication</span>.shared.<span class="keyword">open</span>(url <span class="keyword">as</span> <span class="type">URL</span>, options: [:]) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] success <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> success &#123;</span><br><span class="line">                    <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="number">0.3</span>) &#123;</span><br><span class="line">                        <span class="keyword">self</span>?.addNotifObserver()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addNotifObserver</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> selector = <span class="keyword">#selector</span>(appDidBecomeActive)</span><br><span class="line">        <span class="keyword">let</span> notifName = <span class="type">UIApplication</span>.didBecomeActiveNotification</span><br><span class="line">        <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(<span class="keyword">self</span>, selector: selector, name: notifName, object: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    用户取消了打电话</span></span><br><span class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">appDidBecomeActive</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// if callObserver(_:callChanged:) doesn&#x27;t get called after a certain time,</span></span><br><span class="line">        <span class="comment">// the call dialog was not shown - so the Cancel button was pressed</span></span><br><span class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="number">0.3</span>) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> !(<span class="keyword">self</span>?.didDetectOutgoingCall ?? <span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Cancel button pressed&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    用户点击了呼叫</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">callObserver</span><span class="params">(<span class="keyword">_</span>: CXCallObserver, callChanged call: CXCall)</span></span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         拨通:  outgoing :1  onHold :0   hasConnected :0   hasEnded :0</span></span><br><span class="line"><span class="comment">         拒绝:  outgoing :1  onHold :0   hasConnected :0   hasEnded :1</span></span><br><span class="line"><span class="comment">         链接:  outgoing :1  onHold :0   hasConnected :1   hasEnded :0</span></span><br><span class="line"><span class="comment">         挂断:  outgoing :1  onHold :0   hasConnected :1   hasEnded :1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         新来电话:    outgoing :0  onHold :0   hasConnected :0   hasEnded :0</span></span><br><span class="line"><span class="comment">         保留并接听:  outgoing :1  onHold :1   hasConnected :1   hasEnded :0</span></span><br><span class="line"><span class="comment">         另一个挂掉:  outgoing :0  onHold :0   hasConnected :1   hasEnded :0</span></span><br><span class="line"><span class="comment">         保持链接:    outgoing :1  onHold :0   hasConnected :1   hasEnded :1</span></span><br><span class="line"><span class="comment">         对方挂掉:    outgoing :0  onHold :0   hasConnected :1   hasEnded :1</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 接通</span></span><br><span class="line">        <span class="keyword">if</span> call.isOutgoing, call.hasConnected, !call.hasEnded &#123;</span><br><span class="line">            <span class="comment">// 记录当前时间</span></span><br><span class="line">            setBeginDate()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 挂断</span></span><br><span class="line">        <span class="keyword">if</span> call.isOutgoing, call.hasConnected, call.hasEnded &#123;</span><br><span class="line">            <span class="comment">// 计算通话时长</span></span><br><span class="line">            <span class="keyword">let</span> seconds = getCallPhoneTime()</span><br><span class="line"></span><br><span class="line">            webView.evaluateJavaScript(<span class="string">&quot;callPhone(\(seconds))&quot;</span>) &#123; <span class="keyword">_</span>, error <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Error : \(String(describing: error))&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 记录当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setBeginDate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        beforeDate = <span class="type">Date</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算通话时长</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getCallPhoneTime</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> dat = <span class="type">Date</span>(timeInterval: <span class="number">0</span>, since: beforeDate)</span><br><span class="line">        <span class="keyword">let</span> a = dat.timeIntervalSinceNow</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> timeString = <span class="type">String</span>(format: <span class="string">&quot;%0.f&quot;</span>, fabs(a)) <span class="comment">// 转为字符型</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\(timeString)秒&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> timeString</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>Tree-Shaking性能优化实践(笔记)</title>
    <url>/posts/64509/</url>
    <content><![CDATA[<h2 id="何为-Tree-Shaking"><a href="#何为-Tree-Shaking" class="headerlink" title="何为 Tree-Shaking"></a>何为 Tree-Shaking</h2><blockquote>
<p><strong>Tree shaking</strong> 是一个通常用于描述移除 JavaScript 上下文中的未引用代码(dead-code) 行为的术语。</p>
<p>它依赖于 ES2015 中的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/import">import</a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/export">export</a> 语句，用来检测代码模块是否被导出、导入，且被 JavaScript 文件使用。</p>
<p>在现代 JavaScript 应用程序中，我们使用模块打包(如<a href="https://webpack.js.org/">webpack</a>或<a href="https://github.com/rollup/rollup">Rollup</a>)将多个 JavaScript 文件打包为单个文件时自动删除未引用的代码。这对于准备预备发布代码的工作非常重要，这样可以使最终文件具有简洁的结构和最小化大小。</p>
</blockquote>
<p>——&gt; 来自 <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Tree_shaking">MDN</a></p>
<a id="more"></a>

<h2 id="Tree-Shaking-性能优化实践-原理篇"><a href="#Tree-Shaking-性能优化实践-原理篇" class="headerlink" title="Tree-Shaking 性能优化实践 - 原理篇"></a>Tree-Shaking 性能优化实践 - 原理篇</h2><p>链接：<a href="https://juejin.im/post/5a4dc842518825698e7279a9">掘金 - 百度外卖大前端技术团队</a></p>
<h2 id="摇树优化实战"><a href="#摇树优化实战" class="headerlink" title="摇树优化实战"></a>摇树优化实战</h2><p>链接：<a href="https://segmentfault.com/a/1190000019220154">webpack4.29.x 成神之路（十三） 摇树优化(tree shaking)</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>构建工具</category>
        <category>Webpack</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>Uni-app踩坑日常</title>
    <url>/posts/34936/</url>
    <content><![CDATA[<h2 id="HbuilderX"><a href="#HbuilderX" class="headerlink" title="HbuilderX"></a>HbuilderX</h2><h3 id="在-HbuilderX-中第一次启动小程序"><a href="#在-HbuilderX-中第一次启动小程序" class="headerlink" title="在 HbuilderX 中第一次启动小程序"></a>在 HbuilderX 中第一次启动小程序</h3><p>在 HbuilderX 里运行编译 uni-app 的微信小程序版，报：enable ide service (y/n) [27d [27c</p>
<p>解决方案：</p>
<p>在微信开发者工具里点击设置》安全设置，开启服务端口</p>
<img src="/posts/34936/serve.png" class="" title="serve">

<h2 id="图片路径问题"><a href="#图片路径问题" class="headerlink" title="图片路径问题"></a>图片路径问题</h2><h3 id="在-vue-文件中"><a href="#在-vue-文件中" class="headerlink" title="在 .vue 文件中"></a>在 .vue 文件中</h3><p>使用本地图片可以用绝对路径或者相对路径：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/images/logo.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- or --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../static/images/logo.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="在-css-样式文件中"><a href="#在-css-样式文件中" class="headerlink" title="在 .css 样式文件中"></a>在 .css 样式文件中</h3><p><code>background</code> 属性中，得使用下面写法引入本地图片：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">background: url(&#x27;~@/static/images.logo.png&#x27;);</span><br></pre></td></tr></table></figure>

<p>否则图片无法被正确加载。</p>
<!-- more -->

<h3 id="自定义组件-image-的-src-路径"><a href="#自定义组件-image-的-src-路径" class="headerlink" title="自定义组件 image 的 src 路径"></a>自定义组件 image 的 src 路径</h3><p>自定义组件里面使用 <code>&lt;image&gt;</code>时，若 <code>src</code> 使用相对路径可能出现路径查找失败的情况，故建议使用绝对路径。</p>
<p>—— <a href="https://uniapp.dcloud.io/component/image?id=image">uni-app 文档 image 组件</a></p>
<p><strong>错误示范 ❌</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">copy&lt;image</span><br><span class="line">      src&#x3D;&quot;..&#x2F;..&#x2F;static&#x2F;icos&#x2F;star-yellow.png&quot;</span><br><span class="line">&gt;&lt;&#x2F;image&gt;</span><br></pre></td></tr></table></figure>

<img src="/posts/34936/%E5%9B%BE%E7%89%87%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84.png" class="" title="图片相对路径">

<p><strong>正确示范 ✅</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/icos/star-yellow.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/posts/34936/%E5%9B%BE%E7%89%87%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84.png" class="" title="图片绝对路径">

<h2 id="Vue-问题"><a href="#Vue-问题" class="headerlink" title="Vue 问题"></a>Vue 问题</h2><h3 id="v-show-在小程序上不起作用"><a href="#v-show-在小程序上不起作用" class="headerlink" title="v-show 在小程序上不起作用"></a>v-show 在小程序上不起作用</h3><p><strong>场景再现</strong></p>
<p>希望通过点击按钮来切换三行文字的显示隐藏：</p>
<img src="/posts/34936/show%E5%BC%82%E5%B8%B8.png" class="" title="show异常">

<p>代码非常简单，但有两个条件：</p>
<ul>
<li>style 标签添加上 <code>scoped</code></li>
<li>装填文字的容器有自己的 display 属性</li>
</ul>
<img src="/posts/34936/show%E5%BC%82%E5%B8%B8%E6%9D%A1%E4%BB%B6.png" class="" title="show异常条件">

<img src="/posts/34936/show%E5%BC%82%E5%B8%B8%E6%9D%A1%E4%BB%B6%E5%B1%95%E7%A4%BA.png" class="" title="show异常条件展示">

<p>在此种情况下，H5 的效果和预期一样，点击后三行文字都消失，再次点击三行文字都显示，如此往复。</p>
<p>但在微信小程序中第一行文字始终无法消失。</p>
<p><strong>问题所在</strong></p>
<p>在小程序中， .item.data-v-xxx 的样式覆盖掉了 view[hidden] 的样式：</p>
<img src="/posts/34936/show%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98%E6%89%80%E5%9C%A8.png" class="" title="show异常问题所在">

<p>所以本应该默认不显示的第一行文字显示了。</p>
<hr>
<p>而在 H5 上，uni-app 的做法是给当前标签添加上行内样式的 display: none，优先级最高：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">v-show</span>=<span class="string">&quot;show&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>谁特么买小米？！<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>解决办法</strong></p>
<p>在外层包裹一个 div，在上面设置 <code>v-show</code> 来控制元素的隐藏和显示。</p>
<p>这种方案有些繁琐，除此以外，还能在全局样式中加上如下代码即可解决不能使用 v-show 控制显示隐藏的问题：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 解决 v-show 无法控制显示隐藏的bug */</span></span><br><span class="line"><span class="selector-tag">view</span><span class="selector-attr">[hidden]</span>,</span><br><span class="line"><span class="selector-tag">navigator</span><span class="selector-attr">[hidden]</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="组件相关"><a href="#组件相关" class="headerlink" title="组件相关"></a>组件相关</h2><h3 id="uni-icon-h5-端不显示"><a href="#uni-icon-h5-端不显示" class="headerlink" title="uni-icon h5 端不显示"></a>uni-icon h5 端不显示</h3><p>在项目中使用 uni-app 官方提供的 uniIcon 组件时，要注意现有项目中使用的是 <code>uni-icon.vue</code> 还是 <code>uni-icons.vue</code> ，前者是旧版组件，后者是新版，多了个 <code>s</code> 后缀。</p>
<ul>
<li><p>如果使用的前者，注意在页面中导入 <code>uni-icon</code> 时不要起名为 <code>uniIcon</code> ：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">❌<span class="keyword">import</span> uniIcon <span class="keyword">from</span> <span class="string">&#x27;@/components/uni-icon/uni-icon.vue&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这样会导致 H5 端无法显示该图标。<br>解决办法是起个别名，例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">✅<span class="keyword">import</span> swIcon <span class="keyword">from</span> <span class="string">&#x27;@/components/uni-icon/uni-icon.vue&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果使用的后者，要注意使用 snippet 智能提示后，自动生成的代码 <code>&lt;uni-icon type=&quot;&quot;&gt;&lt;/uni-icon&gt;</code> 是有错误的，标签名最后少了个 <code>s</code> ，正确写法是：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">✅</span><br><span class="line"><span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">class</span>=<span class="string">&quot;apply&quot;</span> <span class="attr">type</span>=<span class="string">&quot;plusempty&quot;</span> <span class="attr">size</span>=<span class="string">&quot;20&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>三种情况比较：</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uni-icon</span> <span class="attr">type</span>=<span class="string">&quot;plusempty&quot;</span> <span class="attr">size</span>=<span class="string">&quot;20&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icon</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sw-icon</span> <span class="attr">type</span>=<span class="string">&quot;plusempty&quot;</span> <span class="attr">size</span>=<span class="string">&quot;20&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sw-icon</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;plusempty&quot;</span> <span class="attr">size</span>=<span class="string">&quot;20&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">import uniIcon from &#x27;@/components/uni-icon/uni-icon.vue&#x27; import swIcon from</span><br><span class="line">&#x27;@/components/uni-icon/uni-icon.vue&#x27; import uniIcons from</span><br><span class="line">&#x27;@/components/uni-icons/uni-icons.vue&#x27;</span><br></pre></td></tr></table></figure>

<img src="/posts/34936/image-%E4%B8%89%E7%A7%8D%E8%A1%A8%E7%8E%B0.png" class="" title="image-三种表现">

<p><strong>插件地址：</strong></p>
<p><a href="https://ext.dcloud.net.cn/plugin?id=28">https://ext.dcloud.net.cn/plugin?id=28</a></p>
<h3 id="自定义-modal-弹窗"><a href="#自定义-modal-弹窗" class="headerlink" title="自定义 modal 弹窗"></a>自定义 modal 弹窗</h3><p>uni-app 自带的 <a href="https://uniapp.dcloud.io/api/ui/prompt?id=showmodal">uni.showModal</a> API 的主体内容不支持添加标签，只能添加文字：</p>
<img src="/posts/34936/image-20191011230427295.png" class="" title="image-20191011230427295">

<img src="/posts/34936/image-20191011230445941.png" class="" title="image-20191011230445941">

<p>如果需要在弹窗中显示一个 input 控件或其他元素就无能为力了。</p>
<p><strong>解决办法</strong></p>
<p>在插件市场找到了一款自定义 modal 组件：</p>
<p>文档：<a href="https://ext.dcloud.net.cn/plugin?id=134">https://ext.dcloud.net.cn/plugin?id=134</a></p>
<img src="/posts/34936/image-20191011230508998.png" class="" title="image-20191011230508998">

<h3 id="colorUI-导致-uniapp-的-checkbox-没法儿选中的问题"><a href="#colorUI-导致-uniapp-的-checkbox-没法儿选中的问题" class="headerlink" title="colorUI 导致 uniapp 的 checkbox 没法儿选中的问题"></a>colorUI 导致 uniapp 的 checkbox 没法儿选中的问题</h3><p>给 checkbox 添加 class 就好：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">checkbox</span> <span class="attr">:checked</span>=<span class="string">&quot;item.selected&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;checked&#x27;:item.selected&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="小程序-scroll-view-position-fixed-失效"><a href="#小程序-scroll-view-position-fixed-失效" class="headerlink" title="小程序 scroll-view position-fixed 失效"></a>小程序 scroll-view position-fixed 失效</h3><p>解决方案来源：<a href="https://segmentfault.com/q/1010000009866120">https://segmentfault.com/q/1010000009866120</a></p>
<img src="/posts/34936/bVPyMk.jpeg" class="" title="bVPyMk">

<p>如图，nav 是 scroll-view 的方式横向滚动，当给 scroll-view 的外出 div 加 position: fixed; 定位时，scroll-view 滚动就失效了。</p>
<p>解决方案：把你的 nav-container 宽度设置为 100% 就可以了</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;view</span><br><span class="line">  class=&quot;yyt-product-type-x font-24 position-fixed&quot;</span><br><span class="line">  style=&quot;width: 100vw; z-index:999;top:80rpx&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;scroll-view</span><br><span class="line">    scroll-x</span><br><span class="line">    scroll-with-animation</span><br><span class="line">    class=&quot;scroll-row row bg-white&quot;</span><br><span class="line">    :scroll-left=&quot;scrollLeft&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;scroll-row-item row flex-nowrap&quot;</span>&gt;</span></span><br><span class="line">      &lt;view</span><br><span class="line">        class=&quot;span-5 d-flex flex-column px-2 mt-1&quot;</span><br><span class="line">        v-for=&quot;(item, index) in typeItems&quot;</span><br><span class="line">        @tap=&quot;_onSelctItem(item)&quot;</span><br><span class="line">        :key=&quot;index&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;image</span><br><span class="line">          :src=&quot;item.productTypeUrl&quot;</span><br><span class="line">          class=&quot;rounded-circle&quot;</span><br><span class="line">          style=&quot;width:104rpx;height:104rpx;&quot;</span><br><span class="line">          lazy-load</span><br><span class="line">          mode=&quot;scaleToFill&quot;</span><br><span class="line">        &gt;<span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        &lt;text</span><br><span class="line">          :class=&quot;&#123; &#x27;select-active&#x27;: currentSelectItemId == item.id &#125;&quot;</span><br><span class="line">          style=&quot;width:104rpx&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;&#123; item.productTypeName &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="框架相关"><a href="#框架相关" class="headerlink" title="框架相关"></a>框架相关</h2><h3 id="class-数组对象形式绑定"><a href="#class-数组对象形式绑定" class="headerlink" title="class 数组对象形式绑定"></a>class 数组对象形式绑定</h3><p>非 H5 端不支持<a href="https://cn.vuejs.org/v2/guide/class-and-style.html">Vue 官方文档：Class 与 Style 绑定</a>中的<code>classObject</code>和<code>styleObject</code>语法。</p>
<p>—— <a href="https://uniapp.dcloud.io/use?id=class-%E4%B8%8E-style-%E7%BB%91%E5%AE%9A">uni-app 文档</a></p>
<p><strong>H5</strong></p>
<img src="/posts/34936/image-20191011230609716.png" class="" title="image-20191011230609716">

<p><strong>WX 小程序</strong></p>
<img src="/posts/34936/image-20191011230635046.png" class="" title="image-20191011230635046">

<h3 id="showToast-不支持网络图片的-icon"><a href="#showToast-不支持网络图片的-icon" class="headerlink" title="showToast 不支持网络图片的 icon"></a>showToast 不支持网络图片的 icon</h3><img src="/posts/34936/showToastIcon.png" class="" title="showToastIcon">

<p><a href="https://uniapp.dcloud.io/api/ui/prompt?id=showtoast">官方文档</a>中有这样一段说明：</p>
<img src="/posts/34936/showToastIconInfo.png" class="" title="showToastIconInfo">

<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">uni.showToast(&#123;</span><br><span class="line">  title: <span class="string">&#x27;标题&#x27;</span>,</span><br><span class="line">  duration: <span class="number">2000</span>,</span><br><span class="line">  image: <span class="string">&#x27;/static/images/success.png&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="tabBar-相关"><a href="#tabBar-相关" class="headerlink" title="tabBar 相关"></a>tabBar 相关</h2><h3 id="自定义-picker-无法遮挡-tabBar"><a href="#自定义-picker-无法遮挡-tabBar" class="headerlink" title="自定义 picker 无法遮挡 tabBar"></a>自定义 picker 无法遮挡 tabBar</h3><p>tabBar 的层级比自定义组件都高，这导致一切自定义组件都会被 tabBar 遮挡：</p>
<img src="/posts/34936/tabbar%E9%81%AE%E6%8C%A1picker.png" class="" title="picker遮挡">

<p>如果不希望 tabBar 遮挡自定义组件，可以在现实自定义组件时，手动调用下面方法隐藏 tabBar ，最后在使用完自定义组件后，将其重新显示：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 手动隐藏</span></span><br><span class="line">uni.hideTabBar(OBJECT);</span><br><span class="line"><span class="comment">// 手动显示</span></span><br><span class="line">uni.showTabBar(OBJECT);</span><br></pre></td></tr></table></figure>

<h3 id="H5-底部固定-view-被-tabBar-遮挡"><a href="#H5-底部固定-view-被-tabBar-遮挡" class="headerlink" title="H5 底部固定 view 被 tabBar 遮挡"></a>H5 底部固定 view 被 tabBar 遮挡</h3><p>由于在 H5 端，不存在原生导航栏和 tabBar，也是前端 div 模拟。如果设置了一个固定位置的居底 view，在小程序和 App 端是在 tabBar 上方，但在 H5 端会与 tabBar 重叠。此时可使用<code>--window-bottom</code>，不管在哪个端，都是固定在 tabBar 上方。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">bottom</span>: <span class="selector-tag">calc</span>(<span class="selector-tag">var</span>(<span class="selector-tag">--window-bottom</span>) + 20<span class="selector-tag">px</span>);</span><br></pre></td></tr></table></figure>

<img src="/posts/34936/tabbar%E9%81%AE%E6%8C%A1%E5%9B%BA%E5%AE%9A%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0.png" class="" title="固定元素遮挡">
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>uniapp</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>Uniapp实时监听input输入为数字</title>
    <url>/posts/47344/</url>
    <content><![CDATA[<p>测试要求提现的输入只能为数字+小数点，不许为其他：</p>


<a id="more"></a>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><blockquote>
<p>Wxml</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;input</span><br><span class="line">  type=&quot;number&quot;</span><br><span class="line">  :placeholder=&quot;placeTips&quot;</span><br><span class="line">  placeholder-style=&quot;font-size:24rpx&quot;</span><br><span class="line">  v-model=&quot;amount&quot;</span><br><span class="line">  @input=&quot;checkNum($event)&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>JS</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">checkNum</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">	<span class="keyword">let</span> val = e.target.value.replace(<span class="regexp">/(^\s*)|(\s*$)/g</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">	<span class="built_in">console</span>.log(val)</span><br><span class="line">	<span class="keyword">if</span> (!val) &#123;</span><br><span class="line">		<span class="built_in">this</span>.amount = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> reg = <span class="regexp">/[^\d.]/g</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 只能是数字和小数点，不能是其他输入</span></span><br><span class="line">	val = val.replace(reg, <span class="string">&quot;&quot;</span>)</span><br><span class="line">	<span class="comment">// // 保证第一位只能是数字，不能是点</span></span><br><span class="line">	val = val.replace(<span class="regexp">/^\./g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">	<span class="comment">// // 小数只能出现1位</span></span><br><span class="line">	val = val.replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;$#$&quot;</span>).replace(<span class="regexp">/\./g</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;$#$&quot;</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">	<span class="comment">// // 小数点后面保留2位</span></span><br><span class="line">	val = val.replace(<span class="regexp">/^(\-)*(\d+)\.(\d\d).*$/</span>, <span class="string">&#x27;$1$2.$3&#x27;</span>);</span><br><span class="line">	<span class="built_in">console</span>.log(val);</span><br><span class="line">	<span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.amount = val;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>解决方案</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>VSCode+Vue项目Ctrl加V自动格式化代码</title>
    <url>/posts/22469/</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>期望多人开发 Vue 项目时，大家的代码风格保持一致。并且在 VSCode 中，Ctrl+V 保存代码时自动按照 eslint 规范格式化代码。</p>
<h2 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h2><ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint">ESLint</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=octref.vetur">Vetur</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode">Prettier - Code formatter</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense">Path Intellisense</a></li>
</ul>
<a id="more"></a>

<h2 id="配置-VSCode-用户-Settings-json"><a href="#配置-VSCode-用户-Settings-json" class="headerlink" title="配置 VSCode 用户 Settings.json"></a>配置 VSCode 用户 Settings.json</h2><h3 id="打开方式"><a href="#打开方式" class="headerlink" title="打开方式"></a>打开方式</h3><ol>
<li>文件——&gt;首选项——&gt;设置</li>
<li>Ctrl+P 搜索 settings.json</li>
</ol>
<h3 id="添加配置"><a href="#添加配置" class="headerlink" title="添加配置"></a>添加配置</h3><blockquote>
<p>有注释的才需要添加，其他没注释的可以不用管</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;editor.fontSize&quot;</span>: <span class="number">14</span>,</span><br><span class="line">  <span class="attr">&quot;bracket-pair-colorizer-2.showBracketsInGutter&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;workbench.iconTheme&quot;</span>: <span class="string">&quot;material-icon-theme&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;sync.gist&quot;</span>: <span class="string">&quot;e9262ee54aa0988ee98c24e6be1dada1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;workbench.colorTheme&quot;</span>: <span class="string">&quot;Atom One Dark&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;editor.fontFamily&quot;</span>: <span class="string">&quot;&#x27;Fira Code&#x27;, Menlo, Monaco, &#x27;Courier New&#x27;, monospace&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 新增配置</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;editor.formatOnSave&quot;</span>: <span class="literal">true</span>, <span class="comment">// #每次保存的时候自动格式化</span></span><br><span class="line">  <span class="attr">&quot;editor.codeActionsOnSave&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;source.fixAll.eslint&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;, <span class="comment">// 每次保存的时候将代码按eslint格式进行修复</span></span><br><span class="line">  <span class="attr">&quot;editor.tabSize&quot;</span>: <span class="number">2</span>, <span class="comment">// 重新设定tabSize</span></span><br><span class="line">  <span class="attr">&quot;prettier.semi&quot;</span>: <span class="literal">true</span>, <span class="comment">// 添加代码结尾的分号</span></span><br><span class="line">  <span class="attr">&quot;prettier.singleQuote&quot;</span>: <span class="literal">true</span>, <span class="comment">// 使用单引号替代双引号</span></span><br><span class="line">  <span class="attr">&quot;prettier.arrowParens&quot;</span>: <span class="string">&quot;avoid&quot;</span>, <span class="comment">// 箭头函数参数只有一个时是否要有小括号。</span></span><br><span class="line">  <span class="comment">// avoid - 省略括号</span></span><br><span class="line">  <span class="comment">// always - 总是不省略</span></span><br><span class="line">  <span class="attr">&quot;prettier.htmlWhitespaceSensitivity&quot;</span>: <span class="string">&quot;ignore&quot;</span>, <span class="comment">// 指定 HTML 文件的全局空白区域敏感度</span></span><br><span class="line">  <span class="comment">// &quot;css&quot;- 遵守 CSS display属性的默认值。</span></span><br><span class="line">  <span class="comment">// &quot;strict&quot; - 空格被认为是敏感的。</span></span><br><span class="line">  <span class="comment">// &quot;ignore&quot; - 空格被认为是不敏感的。</span></span><br><span class="line">  <span class="comment">// html 中空格也会占位，影响布局，prettier 格式化的时候可能会将文本换行，造成布局错乱</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// --------------- html -----------------</span></span><br><span class="line">  <span class="comment">//  &lt;a href=&quot;https://prettier.io/&quot;&gt;Prettier is an opinionated code formatter.&lt;/a&gt;</span></span><br><span class="line">  <span class="comment">//  &lt;!-- 变成 --&gt;</span></span><br><span class="line">  <span class="comment">//  &lt;!-- &quot;Prettier is an opinionated code formatter. &quot; 另起一行，在页面的布局上就会多一个节点文本出来 --&gt;</span></span><br><span class="line">  <span class="comment">//  &lt;a href=&quot;https://prettier.io/&quot;&gt;</span></span><br><span class="line">  <span class="comment">//    Prettier is an opinionated code formatter.</span></span><br><span class="line">  <span class="comment">//  &lt;/a&gt;</span></span><br><span class="line">  <span class="comment">// --------------- html -----------------</span></span><br><span class="line">  <span class="attr">&quot;prettier.jsxBracketSameLine&quot;</span>: <span class="literal">true</span>, <span class="comment">// 将 &gt; 多行 JSX 元素放在最后一行的末尾，而不是单独放在下一行（不适用于自闭元素）。</span></span><br><span class="line">  <span class="comment">// true - 放最后一行末尾</span></span><br><span class="line">  <span class="comment">// false - 单独放在末尾的下一行</span></span><br><span class="line">  <span class="attr">&quot;prettier.bracketSpacing&quot;</span>: <span class="literal">true</span>, <span class="comment">// 在对象，数组括号与文字之间加空格 &quot;&#123; foo: bar &#125;&quot;</span></span><br><span class="line">  <span class="attr">&quot;prettier.trailingComma&quot;</span>: <span class="string">&quot;none&quot;</span>, <span class="comment">// 在对象或数组最后一个元素后面是否加逗号（在ES5中加尾逗号）</span></span><br><span class="line">  <span class="attr">&quot;javascript.preferences.quoteStyle&quot;</span>: <span class="string">&quot;single&quot;</span>, <span class="comment">// JS格式化设置单引号</span></span><br><span class="line">  <span class="attr">&quot;typescript.preferences.quoteStyle&quot;</span>: <span class="string">&quot;single&quot;</span>, <span class="comment">// TS格式化设置单引号</span></span><br><span class="line">  <span class="attr">&quot;javascript.format.insertSpaceBeforeFunctionParenthesis&quot;</span>: <span class="literal">false</span>, <span class="comment">// 让函数(名)和后面的括号之间加个空格</span></span><br><span class="line">  <span class="comment">// 配置 ESLint 检查的文件类型</span></span><br><span class="line">  <span class="attr">&quot;eslint.validate&quot;</span>: [<span class="string">&quot;javascript&quot;</span>, <span class="string">&quot;vue&quot;</span>, <span class="string">&quot;html&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;eslint.options&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// 指定vscode的eslint所处理的文件的后缀</span></span><br><span class="line">    <span class="attr">&quot;extensions&quot;</span>: [<span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.vue&quot;</span>, <span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.tsx&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//一定要在vutur.defaultFormatterOptions参数中设置，单独修改prettier扩展的设置是无法解决这个问题的，因为perttier默认忽略了vue文件（事实上从忽略列表移除vue也不能解决这个问题）</span></span><br><span class="line">  <span class="attr">&quot;vetur.format.defaultFormatterOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;prettier&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;semi&quot;</span>: <span class="literal">true</span>, <span class="comment">// 格式化末尾加分号</span></span><br><span class="line">      <span class="attr">&quot;singleQuote&quot;</span>: <span class="literal">true</span>, <span class="comment">// 格式化以单引号为主</span></span><br><span class="line">      <span class="attr">&quot;trailingComma&quot;</span>: <span class="string">&quot;none&quot;</span> <span class="comment">// 是否末尾自动添加逗号（数组，json，对象）</span></span><br><span class="line">      <span class="comment">// &quot;es5&quot; - 在ES5中的对象、数组等最后一个元素后面加逗号</span></span><br><span class="line">      <span class="comment">// &quot;none&quot; - 不加逗号</span></span><br><span class="line">      <span class="comment">// &quot;all&quot; - 尽可能都加逗号 (包括函数function的参数).</span></span><br><span class="line">    &#125;, <span class="comment">// 配置文档：https://prettier.io/docs/en/options.html</span></span><br><span class="line">    <span class="attr">&quot;js-beautify-html&quot;</span>: &#123;</span><br><span class="line">      <span class="comment">// force-aligned | force-expand-multiline vue html代码格式化</span></span><br><span class="line">      <span class="attr">&quot;wrap_attributes&quot;</span>: <span class="string">&quot;force-aligned&quot;</span>, <span class="comment">// 对除第一个属性外的其他每个属性进行换行，并保持对齐</span></span><br><span class="line">      <span class="comment">// - auto: 仅在超出行长度时才对属性进行换行。</span></span><br><span class="line">      <span class="comment">// - force: 对除第一个属性外的其他每个属性进行换行。</span></span><br><span class="line">      <span class="comment">// - force-aligned: 对除第一个属性外的其他每个属性进行换行，并保持对齐。</span></span><br><span class="line">      <span class="comment">// - force-expand-multiline: 对每个属性进行换行。</span></span><br><span class="line">      <span class="comment">// - aligned-multiple: 当超出折行长度时，将属性进行垂直对齐。</span></span><br><span class="line">      <span class="attr">&quot;wrap_line_length&quot;</span>: <span class="number">200</span>, <span class="comment">// 换行长度</span></span><br><span class="line">      <span class="attr">&quot;wrap_width_line&quot;</span>: <span class="literal">false</span>, <span class="comment">// 根据行宽换行</span></span><br><span class="line">      <span class="attr">&quot;semi&quot;</span>: <span class="literal">false</span>, <span class="comment">// 格式化不加分号</span></span><br><span class="line">      <span class="attr">&quot;singleQuote&quot;</span>: <span class="literal">true</span> <span class="comment">// 格式化使用单引号</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;prettyhtml&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;printWidth&quot;</span>: <span class="number">200</span>, <span class="comment">// 每行最多多少字符换行</span></span><br><span class="line">      <span class="attr">&quot;singleQuote&quot;</span>: <span class="literal">false</span>, <span class="comment">// 格式化使用单引号</span></span><br><span class="line">      <span class="attr">&quot;wrapAttributes&quot;</span>: <span class="literal">false</span>, <span class="comment">// 强制属性换行</span></span><br><span class="line">      <span class="attr">&quot;sortAttributes&quot;</span>: <span class="literal">true</span> <span class="comment">// 按字母顺序排序属性</span></span><br><span class="line">    &#125; <span class="comment">// 配置文档：https://github.com/Prettyhtml/prettyhtml</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;vetur.format.defaultFormatter.html&quot;</span>: <span class="string">&quot;js-beautify-html&quot;</span>, <span class="comment">// 使用 js-beautify-html 格式化 html</span></span><br><span class="line">  <span class="attr">&quot;vetur.format.defaultFormatter.js&quot;</span>: <span class="string">&quot;prettier&quot;</span>, <span class="comment">// 使用 prettier 格式化 js</span></span><br><span class="line">  <span class="attr">&quot;[vue]&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;editor.defaultFormatter&quot;</span>: <span class="string">&quot;octref.vetur&quot;</span> <span class="comment">// 使用 vetur 格式化 vue</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;editor.fontFamily&quot;</span>: <span class="string">&quot;&#x27;Fira Code&#x27;, Menlo, Monaco, &#x27;Courier New&#x27;, monospace&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;path-intellisense.mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;@&quot;</span>: <span class="string">&quot;$&#123;workspaceRoot&#125;/src&quot;</span></span><br><span class="line">  &#125; <span class="comment">// Vue路径提示配置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置-eslintrc-js"><a href="#配置-eslintrc-js" class="headerlink" title="配置 .eslintrc.js"></a>配置 .eslintrc.js</h2><p>Vue 项目的根目录下创建 .eslintrc.js ：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    parser: <span class="string">&#x27;babel-eslint&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">    node: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">extends</span>: [<span class="string">&#x27;plugin:vue/essential&#x27;</span>, <span class="string">&#x27;eslint:recommended&#x27;</span>, <span class="string">&#x27;airbnb-base/legacy&#x27;</span>],</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="comment">// 文档：https://cn.eslint.org/docs/rules/</span></span><br><span class="line">    <span class="string">&#x27;generator-star-spacing&#x27;</span>: <span class="string">&#x27;off&#x27;</span>, <span class="comment">// 强制 generator 函数中 * 号周围使用一致的空格</span></span><br><span class="line">    <span class="comment">// 开发模式允许使用console</span></span><br><span class="line">    <span class="string">&#x27;no-console&#x27;</span>: process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;error&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">    <span class="comment">// 开发环境允许使用调试 (生产模式禁用)</span></span><br><span class="line">    <span class="string">&#x27;no-debugger&#x27;</span>: process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;error&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">    <span class="comment">// 禁止使用 var</span></span><br><span class="line">    <span class="string">&#x27;no-var&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;padded-blocks&#x27;</span>: <span class="string">&#x27;off&#x27;</span>, <span class="comment">// 代码块中避免多余留白</span></span><br><span class="line">    <span class="string">&#x27;comma-dangle&#x27;</span>: [<span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;never&#x27;</span>], <span class="comment">// 是否允许对象中出现结尾逗号</span></span><br><span class="line">    <span class="string">&#x27;no-undef&#x27;</span>: <span class="number">0</span>, <span class="comment">// 禁用未声明的变量，除非它们在 /*global */ 注释中被提到</span></span><br><span class="line">    quotes: <span class="number">0</span>, <span class="comment">// 强制使用一致的反勾号、双引号或单引号 (0: double, 1: single, 2: backtick)</span></span><br><span class="line">    eqeqeq: <span class="string">&#x27;off&#x27;</span>, <span class="comment">//  关闭 (要求使用 === 和 !==) 的校验</span></span><br><span class="line">    <span class="string">&#x27;eol-last&#x27;</span>: <span class="string">&#x27;off&#x27;</span>, <span class="comment">// 要求或禁止文件末尾存在空行</span></span><br><span class="line">    indent: <span class="number">0</span>, <span class="comment">// 忽略强制使用一致的缩进</span></span><br><span class="line">    <span class="string">&#x27;no-tabs&#x27;</span>: <span class="number">0</span>, <span class="comment">// 忽略tab检查</span></span><br><span class="line">    <span class="string">&#x27;no-mixed-spaces-and-tabs&#x27;</span>: <span class="number">0</span> <span class="comment">// 忽略检查当空格用于对齐时，允许混合制表符和空格。</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>npm 安装 <code>eslint-config-airbnb-base</code> ：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm info &quot;eslint-config-airbnb-base@latest&quot; peerDependencies</span><br></pre></td></tr></table></figure>

<p>在 <code>.eslintrc.js</code> 中添加（上面配置已添加）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;extends&quot;</span>: <span class="string">&quot;airbnb-base/legacy&quot;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>工具</category>
        <category>IDE</category>
      </categories>
      <tags>
        <tag>VSCode</tag>
      </tags>
  </entry>
  <entry>
    <title>Swift与JS交互</title>
    <url>/posts/17227/</url>
    <content><![CDATA[<h2 id="一-环境"><a href="#一-环境" class="headerlink" title="一. 环境"></a>一. 环境</h2><p>Xcode 11，Swift 5.0, ES6</p>
<h3 id="1-1-介绍"><a href="#1-1-介绍" class="headerlink" title="1.1 介绍"></a>1.1 介绍</h3><ul>
<li>WKWebView —允许通过 URL 加载 Web 内容</li>
<li>WKScriptMessage — 接收 <code>postMessage()</code> 时创建的对象</li>
<li>WKUserContentController —管理 <code>JavaScript</code> 调用和注入</li>
<li>WKScriptMessageHandler —访问 <code>WKScriptMessage</code> 委托方法的协议</li>
<li>WKWebViewConfiguration —传递给 WKWebView 的配置</li>
</ul>
<a id="more"></a>

<h2 id="二-iOS-端"><a href="#二-iOS-端" class="headerlink" title="二. iOS 端"></a>二. iOS 端</h2><h3 id="2-1-添加-WKScriptMessageHandler-协议和相关变量、方法"><a href="#2-1-添加-WKScriptMessageHandler-协议和相关变量、方法" class="headerlink" title="2.1 添加 WKScriptMessageHandler 协议和相关变量、方法"></a>2.1 添加 WKScriptMessageHandler 协议和相关变量、方法</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">WKScriptMessageHandler</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 屏幕宽高</span></span><br><span class="line">   <span class="keyword">let</span> screenW = <span class="type">UIScreen</span>.main.bounds.width</span><br><span class="line">   <span class="keyword">let</span> screenH = <span class="type">UIScreen</span>.main.bounds.height</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 状态栏高度</span></span><br><span class="line">   <span class="keyword">let</span> statusBarHeight: <span class="type">CGFloat</span> = &#123;</span><br><span class="line">      <span class="keyword">var</span> heightToReturn: <span class="type">CGFloat</span> = <span class="number">0.0</span></span><br><span class="line">      <span class="keyword">for</span> window <span class="keyword">in</span> <span class="type">UIApplication</span>.shared.windows &#123;</span><br><span class="line">         <span class="keyword">if</span> <span class="keyword">#available</span>(iOS <span class="number">13.0</span>, *) &#123;</span><br><span class="line">               <span class="keyword">if</span> <span class="keyword">let</span> height = window.windowScene?.statusBarManager?.statusBarFrame.height, height &gt; heightToReturn &#123;</span><br><span class="line">                  heightToReturn = height</span><br><span class="line">               &#125;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">// Fallback on earlier versions</span></span><br><span class="line">               heightToReturn = <span class="type">UIApplication</span>.shared.statusBarFrame.size.height</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> heightToReturn</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// MARK: 获取当前设备安全区域frame</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">safeAreaFrame</span><span class="params">(<span class="keyword">_</span> viewController: UIViewController)</span></span> -&gt; <span class="type">CGRect</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> isIphoneX = <span class="type">UIScreen</span>.main.bounds.height &gt;= <span class="number">812</span> ? <span class="literal">true</span> : <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> navigationBarHeight: <span class="type">CGFloat</span> = isIphoneX ? <span class="number">44</span> : <span class="number">20</span></span><br><span class="line">      <span class="keyword">var</span> tabBarHeight: <span class="type">CGFloat</span> = isIphoneX ? <span class="number">34</span> : <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 标志导航视图控制器是否存在 默认不存在</span></span><br><span class="line">      <span class="comment">// 为什么需要这个？</span></span><br><span class="line">      <span class="comment">// 这里有个坑，当没有导航栏时，如果是iPhoneX等设备，tabBar.frame.height = 49 会不包含底部返回条的高度（34）, 存在导航栏时 tabBar.frame.height = 83</span></span><br><span class="line">      <span class="keyword">var</span> noNavigationExists = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> navigation = viewController.navigationController &#123;</span><br><span class="line">         noNavigationExists = <span class="literal">false</span></span><br><span class="line">         navigationBarHeight += navigation.navigationBar.frame.height</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> tabBarController = viewController.tabBarController &#123;</span><br><span class="line">         tabBarHeight = noNavigationExists ? tabBarHeight : <span class="number">0</span></span><br><span class="line">         tabBarHeight += tabBarController.tabBar.frame.height</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: navigationBarHeight, width: screenW, height: screenH - tabBarHeight - navigationBarHeight)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> frame</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Extension/UIColor+Extension.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIColor</span> </span>&#123;</span><br><span class="line">    <span class="comment">//    rgba方法</span></span><br><span class="line">    <span class="keyword">convenience</span> <span class="keyword">init</span>(red: <span class="type">CGFloat</span>, green: <span class="type">CGFloat</span>, blue: <span class="type">CGFloat</span>, alpha: <span class="type">CGFloat</span> = <span class="number">1.0</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(displayP3Red: red / <span class="number">255.0</span>, green: green / <span class="number">255.0</span>, blue: blue / <span class="number">255.0</span>, alpha: alpha)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    主题色</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">globalBgColor</span>() -&gt; <span class="title">UIColor</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">UIColor</span>(red: <span class="number">7</span>, green: <span class="number">130</span>, blue: <span class="number">255</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-懒加载-webView"><a href="#2-2-懒加载-webView" class="headerlink" title="2.2 懒加载 webView"></a>2.2 懒加载 webView</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MARK: 懒加载 webView</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">lazy</span> <span class="keyword">var</span> webView: <span class="type">WKWebView</span> = &#123;</span><br><span class="line">   <span class="comment">// 创建设置对象</span></span><br><span class="line">   <span class="keyword">let</span> preferences = <span class="type">WKPreferences</span>()</span><br><span class="line">   preferences.javaScriptEnabled = <span class="literal">true</span></span><br><span class="line">   preferences.javaScriptCanOpenWindowsAutomatically = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// 配置 WKWebView</span></span><br><span class="line">   <span class="keyword">let</span> configuration = <span class="type">WKWebViewConfiguration</span>()</span><br><span class="line">   configuration.preferences = preferences</span><br><span class="line">   configuration.userContentController = <span class="type">WKUserContentController</span>()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 注册iOS这个变量,让js能够通过 window.webkit.messageHandlers.iOS.postMessage() 调用 Swift 指定方法</span></span><br><span class="line">   configuration.userContentController.add(<span class="keyword">self</span>, name: <span class="string">&quot;iOS&quot;</span>)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> webView = <span class="type">WKWebView</span>(frame: safeAreaFrame(<span class="keyword">self</span>), configuration: configuration)</span><br><span class="line">   <span class="keyword">return</span> webView</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>

<h3 id="2-3-生命周期内加载和销毁-webView-相关内容"><a href="#2-3-生命周期内加载和销毁-webView-相关内容" class="headerlink" title="2.3 生命周期内加载和销毁 webView 相关内容"></a>2.3 生命周期内加载和销毁 webView 相关内容</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MARK: 生命周期</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">   view.backgroundColor = .white</span><br><span class="line"></span><br><span class="line">   <span class="comment">//        获取当前设备宽高</span></span><br><span class="line">   <span class="keyword">let</span> width: <span class="type">CGFloat</span> = screenW</span><br><span class="line"></span><br><span class="line">   <span class="comment">//        加载h5</span></span><br><span class="line">   <span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">&quot;h5线上的https地址&quot;</span>)</span><br><span class="line">   <span class="keyword">let</span> urlReq = <span class="type">URLRequest</span>(url: url!)</span><br><span class="line">   webView.load(urlReq)</span><br><span class="line"></span><br><span class="line">   view.addSubview(webView)</span><br><span class="line"></span><br><span class="line">   <span class="comment">//        使用UIView覆盖状态栏</span></span><br><span class="line">   statusView = <span class="type">UIView</span>(frame: <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: width, height: statusBarHeight))</span><br><span class="line">   <span class="comment">//        使用 Extension/UIColor+Extension.swift 中的拓展方法</span></span><br><span class="line">   statusView.backgroundColor = <span class="type">UIColor</span>.globalBgColor()</span><br><span class="line">   view.addSubview(statusView)</span><br><span class="line"></span><br><span class="line">   <span class="comment">//        注册iOS标识</span></span><br><span class="line">   webView.evaluateJavaScript(<span class="string">&quot;window.iOS = &#x27;iOS&#x27;&quot;</span>) &#123; <span class="keyword">_</span>, error <span class="keyword">in</span></span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;Error : \(String(describing: error))&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//        获取各种权限</span></span><br><span class="line">   getPermissions()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webViewDidClose</span><span class="params">(<span class="keyword">_</span>: WKWebView)</span></span> &#123;</span><br><span class="line">   <span class="comment">//        销毁，防止内存泄漏</span></span><br><span class="line">   webView.configuration.userContentController.removeScriptMessageHandler(forName: <span class="string">&quot;iOS&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-监听-js-调用-iOS-方法"><a href="#2-4-监听-js-调用-iOS-方法" class="headerlink" title="2.4 监听 js 调用 iOS 方法"></a>2.4 监听 js 调用 iOS 方法</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MARK: 监听js调用iOS方法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">userContentController</span><span class="params">(<span class="keyword">_</span>: WKUserContentController, didReceive message: WKScriptMessage)</span></span> &#123;</span><br><span class="line">   <span class="comment">// 前端通过 window.webkit.messageHandlers.iOS.postMessage 调用原生方法</span></span><br><span class="line">   <span class="comment">// 此处匹配下方的 「iOS」</span></span><br><span class="line">   <span class="keyword">if</span> message.name == iOS &#123;</span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> dict = message.body <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">AnyObject</span>],</span><br><span class="line">            <span class="keyword">let</span> method = dict[<span class="string">&quot;method&quot;</span>] <span class="keyword">as</span>? <span class="type">String</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      iOSHandle(method: method, params: dict[<span class="string">&quot;params&quot;</span>] <span class="keyword">as</span> <span class="type">AnyObject</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: 执行前端调用的接口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">iOSHandle</span><span class="params">(method: String, params: AnyObject)</span></span> &#123;</span><br><span class="line">   <span class="keyword">switch</span> method &#123;</span><br><span class="line">   <span class="comment">// 获取手机通讯录返回给前端</span></span><br><span class="line">   <span class="keyword">case</span> <span class="string">&quot;getContacts&quot;</span>:</span><br><span class="line">      returnContacts &#123;</span><br><span class="line">         <span class="comment">// jsonString 为要返回给前端的 json 字符串</span></span><br><span class="line">         <span class="keyword">self</span>.webView.evaluateJavaScript(<span class="string">&quot;getContacts(&#x27;\(jsonString)&#x27;)&quot;</span>) &#123; <span class="keyword">_</span>, error <span class="keyword">in</span></span><br><span class="line">               <span class="built_in">print</span>(<span class="string">&quot;Error : \(String(describing: error))&quot;</span>)</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   <span class="comment">// 根据前端传递的电话号码调用打电话接口</span></span><br><span class="line">   <span class="keyword">case</span> <span class="string">&quot;makePhoneCall&quot;</span>:</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> p = params <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">AnyObject</span>], <span class="keyword">let</span> phoneStr = p[<span class="string">&quot;phone&quot;</span>] <span class="keyword">as</span>? <span class="type">String</span> &#123;</span><br><span class="line">            makePhoneCall(phoneStr: phoneStr)</span><br><span class="line">      &#125;</span><br><span class="line">   <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;请求失败&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三-JS-端"><a href="#三-JS-端" class="headerlink" title="三. JS 端"></a>三. JS 端</h2><h3 id="3-1-JS-传递参数调用原生方法，但无需返回值"><a href="#3-1-JS-传递参数调用原生方法，但无需返回值" class="headerlink" title="3.1 JS 传递参数调用原生方法，但无需返回值"></a>3.1 JS 传递参数调用原生方法，但无需返回值</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>打电话</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123; String &#125;</span> </span>phoneNumber 电话string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> makePhoneCall = <span class="function"><span class="params">phoneNumber</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 调用iOS下的callPhone方法</span></span><br><span class="line">  <span class="built_in">window</span>.webkit.messageHandlers.iOS.postMessage(&#123;</span><br><span class="line">    method: <span class="string">&#x27;makePhoneCall&#x27;</span>,</span><br><span class="line">    params: &#123;</span><br><span class="line">      phone</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">makePhoneCall(<span class="number">18712345678</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-2-JS-调用原生方法并接收原生方法返回值"><a href="#3-2-JS-调用原生方法并接收原生方法返回值" class="headerlink" title="3.2 JS 调用原生方法并接收原生方法返回值"></a>3.2 JS 调用原生方法并接收原生方法返回值</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取联系人</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>cb 回调函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return </span>字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@e</span>.g. &#123;&quot;555-610-6679&quot;:&quot;TaylorDavid&quot;,&quot;555-522-8243&quot;:&quot;HaroAnna&quot;,&quot;(415) 555-3695&quot;:&quot;BellKate&quot;,&quot;(408) 555-3514&quot;:&quot;HigginsDaniel&quot;,&quot;(707) 555-1854&quot;:&quot;ZakroffHank&quot;,&quot;888-555-1212&quot;:&quot;AppleseedJohn&quot;&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getContacts = <span class="function"><span class="params">cb</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 调用iOS下的getContacts方法</span></span><br><span class="line">  <span class="built_in">window</span>.webkit.messageHandlers.iOS.postMessage(&#123;</span><br><span class="line">    method: <span class="string">&#x27;getContacts&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 将getContacts方法添加到window中</span></span><br><span class="line">  <span class="comment">// 这样Swift代码就可以调用getContacts方法了</span></span><br><span class="line">  <span class="built_in">window</span>[<span class="string">&#x27;getContacts&#x27;</span>] = <span class="function"><span class="params">msg</span> =&gt;</span> &#123;</span><br><span class="line">    cb &amp;&amp; cb(<span class="built_in">JSON</span>.parse(msg));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">getContacts(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 接收联系人数组对象</span></span><br><span class="line">  <span class="built_in">this</span>.contactsList = data;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="四-参考资料"><a href="#四-参考资料" class="headerlink" title="四. 参考资料"></a>四. 参考资料</h2><ul>
<li><a href="https://medium.com/john-lewis-software-engineering/ios-wkwebview-communication-using-javascript-and-swift-ee077e0127eb#75b1">iOS WKWebView Communication Using Javascript and Swift</a></li>
<li><a href="https://juejin.im/post/5baafa39e51d450e664b53b4">iOS 中 WKWebView 和 Native 交互</a></li>
<li><a href="https://www.jianshu.com/p/36c6ffd4c99e">WKWebView 与 vue.js 的交互</a></li>
</ul>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>VSCode插件Sync-Settings同步失败-token失效</title>
    <url>/posts/50280/</url>
    <content><![CDATA[<p>VSCode 有款插件叫做 <a href="https://marketplace.visualstudio.com/items?itemName=Shan.code-settings-sync">Settings Sync</a>，它能将我们在 VSCode 中配置的所有插件上传到 github 的 gist 中去，这样不管我们是换电脑还是重装系统后，都能重新从云端下载一份之前配置好的插件库到电脑中去。</p>
<p>今天突然想到已经很久没更新过插件列表了，就想着把电脑上目前所用到的所有插件列表同步到 gist 中，但发现同步失败，token 过期。下面是解决方案：</p>
<a id="more"></a>

<ol>
<li>打开<a href="https://github.com/">github 官网</a>，点击头像下的 Settings</li>
</ol>
<img src="/posts/50280/home2settings.png" class="" title="home2settings">

<ol>
<li>点击左侧菜单下的 <code>Developer settings</code></li>
</ol>
<img src="/posts/50280/settings2developer.png" class="" title="settings2developer">

<ol>
<li>点击左侧菜单下的 <code>Personal access tokens</code> ，然后点击右侧 pannel 的 <code>Generate new token</code> 按钮新建一个 token</li>
</ol>
<img src="/posts/50280/settings2generate.png" class="" title="settings2generate">

<ol>
<li>起给 token 名字外加功能限制，例如 Note 中填写 <code>settings sync</code> ，然后勾选「Select scopes」下的 gist 复选框，拉到页面最下方点击生成 token</li>
</ol>
<img src="/posts/50280/setings2name.png" class="" title="setings2name">

<ol>
<li>你此时的新 token 就设置好了，复制 token 到剪切板待会用</li>
<li>再次点击页面右上角头像进入 <code>Your gists</code></li>
</ol>
<img src="/posts/50280/settings2gist.png" class="" title="settings2gist">

<ol>
<li>在列表中找到你之前的配置并点击查看详情，复制详情页 url 中最后的一长传 id，这就是你该配置的 gist id，同样复制到剪切板</li>
</ol>
<img src="/posts/50280/gist2list.png" class="" title="gist2list">

<img src="/posts/50280/gist2detail.png" class="" title="gist2detail">

<ol>
<li>回到 VSCode ，键盘快捷键「Shift + Option + P」打开 VSCode 的命令面板，搜索 sync 找到『Sync: 高级选项』点击进入，将刚才复制的 Gist ID 和 token 分别填入配置文件中保存</li>
</ol>
<img src="/posts/50280/vscode2settings.png" class="" title="vscode2settings">

<img src="/posts/50280/vscode2detail.png" class="" title="vscode2detail">

<ol>
<li>最后，快捷键「Shift + Alt + U」上传你最新的 VSCode 插件配置。</li>
</ol>
]]></content>
      <categories>
        <category>工具</category>
        <category>IDE</category>
      </categories>
      <tags>
        <tag>VSCode</tag>
      </tags>
  </entry>
  <entry>
    <title>VSCode配置TypeScript自动编译报错</title>
    <url>/posts/15303/</url>
    <content><![CDATA[<p>2020.10.02 更新：</p>
<p>em… 我在 github 上提问有了回复，链接在此：<a href="https://github.com/microsoft/vscode/issues/107895">https://github.com/microsoft/vscode/issues/107895</a></p>
<p>具体解决方案就是，打开 <code>settings.json</code> ，设置 <code>&quot;terminal.integrated.inheritEnv&quot;</code> 为 true 。</p>
<hr>
<p>之前在 VSCode 中能通过运行任务来监听 ts 文件的代码变更来实时编译 js。然而我今天发现这样会导致报错：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> Executing task: tsc -p <span class="string">&#x27;/Users/macbook/Documents/01ts-intro/tsconfig.json&#x27;</span> --watch &lt;</span></span><br><span class="line"></span><br><span class="line">env: node: No such file or directory</span><br><span class="line">The terminal process &quot;/bin/bash &#x27;-c&#x27;, &#x27;tsc -p &#x27;/Users/macbook/Documents/01ts-intro/tsconfig.json&#x27; --watch&#x27;&quot; failed to launch (exit code: 127).</span><br><span class="line"></span><br><span class="line">Terminal will be reused by tasks, press any key to close it.</span><br></pre></td></tr></table></figure>

<p>尝试了各种办法仍然没有解决，后来在终端直接执行命令反而好了，这里记录一下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tsc -p &#x27;tsconfig.json&#x27; --watch</span><br></pre></td></tr></table></figure>

<h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><p>想要知道如何自动编译 TS？</p>
<p>可以看下掘金的这篇文章：<a href="https://juejin.im/post/6844903829163474952">Visual Studio Code 中配置 TypeScript 自动编译</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>VSCode</tag>
        <tag>TypeScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue+Koa实现cookie传输</title>
    <url>/posts/26486/</url>
    <content><![CDATA[<h2 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h2><p>登录接口设置 cookie：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">let</span> user = &#123;</span><br><span class="line">      username: <span class="string">&#x27;Lance&#x27;</span>,</span><br><span class="line">      age: <span class="number">20</span>,</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    ctx.cookies.set(<span class="string">&#x27;username&#x27;</span>, user.username), &#123;</span><br><span class="line">        <span class="comment">// httpOnly：表示当前设置的cookie是否允许客户端进行操作（js）</span></span><br><span class="line">        <span class="comment">// 默认true，表示这个cookie能用于http协议的数据传输，但不允许js操作和篡改</span></span><br><span class="line">        httpOnly: <span class="literal">false</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>读取浏览器自动带上的 cookie：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/like&#x27;</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 从cookie中读取 username</span></span><br><span class="line">    <span class="keyword">let</span> username = ctx.cookies.get(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>文档：<a href="https://koajs.com/#response">Koa - response</a></p>
<h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 从cookie中获取用户信息cookie</span></span><br><span class="line">  <span class="comment">// 如果有cookie</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">document</span>.cookie) &#123;</span><br><span class="line">      <span class="comment">// cookie = &quot;uid=1; username=admin;&quot; =&gt; [&#x27;uid=1&#x27;, &#x27;username=admin&#x27;]</span></span><br><span class="line">      <span class="keyword">let</span> arr1 = <span class="built_in">document</span>.cookie.split(<span class="string">&quot;; &quot;</span>);</span><br><span class="line">      <span class="keyword">let</span> cookiesArr = arr1.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// item = &quot;uid=1&quot; =&gt; [&#x27;uid&#x27;, 1]</span></span><br><span class="line">          <span class="keyword">let</span> arr2 = item.split(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">              [arr2[<span class="number">0</span>]]: arr2[<span class="number">1</span>]</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// &#123;uid: &quot;6&quot;, username: &quot;YWRtaW4&quot;&#125;</span></span><br><span class="line">      <span class="keyword">let</span> cookie = <span class="built_in">Object</span>.assign(&#123;&#125;, ...cookiesArr);</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="后端-cookie-的加密"><a href="#后端-cookie-的加密" class="headerlink" title="后端 cookie 的加密"></a>后端 cookie 的加密</h2><p>在 <code>app.js</code> 中添加密钥：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="comment">// 密钥</span></span><br><span class="line">app.keys = [<span class="string">&#x27;sw_lance&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p>然后在 <code>routers/main.js</code> 路由中的 cookie 设置中增加一个字段：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置cookie</span></span><br><span class="line">ctx.cookies.set(<span class="string">&#x27;username&#x27;</span>, user.username, &#123;</span><br><span class="line">  signed: <span class="literal">true</span> <span class="comment">// 使用加密方式处理</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样就能加密了，但在前端 chrome 下查看 cookie 会发现，虽然有了加密 cookie，但明文的 cookie 仍然在：</p>
<img src="/posts/26486/%E7%AF%A1%E6%94%B9cookie.png" class="" title="明文cookie">

<h2 id="后端-session-加密"><a href="#后端-session-加密" class="headerlink" title="后端 session 加密"></a>后端 session 加密</h2><p>首先仍然要在 <code>app.js</code> 中添加密钥：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="comment">// 密钥</span></span><br><span class="line">app.keys = [<span class="string">&#x27;sw_lance&#x27;</span>];</span><br><span class="line">npm i koa-session</span><br></pre></td></tr></table></figure>

<p>在 <code>app.js</code> 中引入：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;koa-session&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="comment">// 密钥</span></span><br><span class="line">app.keys = [<span class="string">&#x27;sw_lance&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> CONFIG = &#123;</span><br><span class="line">  key: <span class="string">&#x27;koa:sess&#x27;</span>,</span><br><span class="line">  maxAge: <span class="number">86400000</span>,</span><br><span class="line">  autoCommit: <span class="literal">true</span>,</span><br><span class="line">  overwrite: <span class="literal">true</span>,</span><br><span class="line">  httpOnly: <span class="literal">true</span>,</span><br><span class="line">  signed: <span class="literal">true</span>,</span><br><span class="line">  rolling: <span class="literal">false</span>,</span><br><span class="line">  renew: <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line">app.use(Session(CONFIG, app));</span><br></pre></td></tr></table></figure>

<p>在 <code>routers/main.js</code> 的 login API 中种下 cookie 和 session：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// uid用下面的session存，username没那么重要，可以用cookie</span></span><br><span class="line">    ctx.cookies.set(<span class="string">&#x27;username&#x27;</span>, <span class="keyword">new</span> Buffer(user.get(<span class="string">&#x27;username&#x27;</span>)).toString(<span class="string">&#x27;base64&#x27;</span>), &#123;</span><br><span class="line">        httpOnly: <span class="literal">false</span>,</span><br><span class="line">        signed: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// maxAge: 10000,</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// uid用session存</span></span><br><span class="line">    ctx.session.uid = user.get(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在 <code>routers/main.js</code> 的 <code>like</code> API 中获取 session：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/like&#x27;</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> uid = ctx.session.uid;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>后端</category>
        <category>Node</category>
      </categories>
      <tags>
        <tag>Koa</tag>
        <tag>Cookie</tag>
      </tags>
  </entry>
  <entry>
    <title>Vuex的基本使用</title>
    <url>/posts/36068/</url>
    <content><![CDATA[<h2 id="什么是-Vuex"><a href="#什么是-Vuex" class="headerlink" title="什么是 Vuex"></a>什么是 Vuex</h2><p>Vuex 是一个专为 Vue.js 应用程序开发的状态管理工具。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>首先使用 vue-cli 脚手架工具新建一个项目：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vue create vuex-demo</span><br></pre></td></tr></table></figure>

<p>src文件夹下的目录结构：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src</span><br><span class="line">├── App.vue</span><br><span class="line">├── assets</span><br><span class="line">│   └── logo.png</span><br><span class="line">├── components</span><br><span class="line">│   └── HelloWorld.vue</span><br><span class="line">└── main.js # 入口文件</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="安装-vuex"><a href="#安装-vuex" class="headerlink" title="安装 vuex"></a>安装 vuex</h2><p>命令行下执行：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i vuex</span><br></pre></td></tr></table></figure>

<p>然后在入口文件引入 vuex ：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line">Vue.use(Vuex)</span><br></pre></td></tr></table></figure>

<h2 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h2><p>为了了解 vuex 到底做了什么事情、解决了哪些问题。我们先来实现一个简单的 demo ，有一个标签显示数字，两个按钮分别做数字的 +1 和 -1 操作。</p>
<p>我们先在 <code>src/components/</code> 下的 Normal.vue 组件中使用纯 Vue 版本编写代码：</p>
<blockquote>
<p>Normal.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;normal&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;count&#125;&#125;</span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;inc&quot;</span>&gt;</span> + <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;dec&quot;</span>&gt;</span> - <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      count: 0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">inc</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.count++</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">dec</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.count--</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在 <code>src/App.vue</code> 中引入并使用该组件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Normal</span>&gt;</span><span class="tag">&lt;/<span class="name">Normal</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Normal <span class="keyword">from</span> <span class="string">&#x27;@/components/Normal&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    Normal,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>命令行执行 <code>npm run serve</code> 就能运行 App 了。</p>
<p>如上的代码的含义是：两个 button 标签绑定函数，当点击的时候分别调用 inc 和 dec 方法，接着会调用 vue 中的 methods 的对应的方法<br>。然后会让 data 中的 count 属性值发生改变，改变后会把最新值渲染到视图中。</p>
<p>现在我们来看看使用 vuex 的方式来实现如上 demo ：</p>
<blockquote>
<p>src下新建 <code>vuex/store.js</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意是new【Vuex.Store】实例而不是【Vuex】</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        count: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        inc: <span class="function"><span class="params">state</span> =&gt;</span> state.count++,</span><br><span class="line">        dec: <span class="function"><span class="params">state</span> =&gt;</span> state.count--</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>main.js 中引入</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/vuex/store&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App),</span><br><span class="line">  store</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在 <code>src/components/</code> 下新建 SWVuex.vue 组件</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;vuex&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;count&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;inc&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;dec&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">        computed: &#123;</span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">count</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> <span class="built_in">this</span>.$store.state.count</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">inc</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;inc&#x27;</span>)</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">dec</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;dec&#x27;</span>)</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在 App.vue 中使用 SWVuex 组件</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SWVuex</span>&gt;</span><span class="tag">&lt;/<span class="name">SWVuex</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> SWVuex <span class="keyword">from</span> <span class="string">&#x27;@/components/SWVuex&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    SWVuex</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="两者比较"><a href="#两者比较" class="headerlink" title="两者比较"></a>两者比较</h3><ol>
<li>需要引用 vuex 。</li>
<li>methods 的方法不变，但是方法内的逻辑不在函数内进行，而是让 store 对象去处理。</li>
<li>count 数据不再是一个 data 函数返回的对象的属性了。而是通过 store 方法内的计算字段返回的。</li>
</ol>
<p>回到 store 对象上来，store 对象是 Vuex.Store 的实例。在 store 内分为 state 对象和 mutations 对象，其中 state 存放的是状态，<br>比如 count 属性就是它的状态值，而 mutations 则是一个会引发状态改变的所有方法。</p>
<h2 id="什么是状态管理模式"><a href="#什么是状态管理模式" class="headerlink" title="什么是状态管理模式"></a>什么是状态管理模式</h2><p>简单的理解就是<strong>统一管理和维护各个 vue 组件的可变化状态</strong>。</p>
<p>我们明白 vue 是单向数据流的，那么它的状态管理一般包含如下几部分：</p>
<ol>
<li>state：驱动应用的数据（一般指 data 中返回的数据）</li>
<li>view：一般指模板，以声明的方式将 state 的数据映射到视图</li>
<li>actions：响应在 view 上的用户输入导致的状态变化</li>
</ol>
<p>但是当我们的应用遇到多个组件共享状态时候，那么单向数据流可能不太满足我们的需求，比如：</p>
<ol>
<li>组件的多层嵌套</li>
<li>多个视图依赖同一个状态</li>
</ol>
<p>上面这些情况确实能在不使用 vuex 的情况下实现，但往往会导致写出无法维护的代码。因此我们可以把组件的共享状态<strong>提取出来、全局管理</strong>，因此 vuex 产生了。</p>
<h2 id="Vuex-的优点"><a href="#Vuex-的优点" class="headerlink" title="Vuex 的优点"></a>Vuex 的优点</h2><p>最主要解决了组件之间共享同一状态的问题。可以把组件的共享状态提取出来，作为全局来管理。</p>
<h2 id="什么情况下才推荐使用-Vuex"><a href="#什么情况下才推荐使用-Vuex" class="headerlink" title="什么情况下才推荐使用 Vuex"></a>什么情况下才推荐使用 Vuex</h2><p>大型单页应用！！！如果你的项目不够大，足够简单，最好不要使用 Vuex ，一个简单的 global event bus 就足够所需了。</p>
<h2 id="State-对象状态的访问"><a href="#State-对象状态的访问" class="headerlink" title="State 对象状态的访问"></a>State 对象状态的访问</h2><h3 id="通过-computed-计算属性直接赋值"><a href="#通过-computed-计算属性直接赋值" class="headerlink" title="通过 computed 计算属性直接赋值"></a>通过 computed 计算属性直接赋值</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;vuex&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>通过 $store.state 方式获取：&#123;&#123;$store.state.count&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>通过 computed 计算属性赋值：&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;inc&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;dec&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">        computed: &#123;</span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">count</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> <span class="built_in">this</span>.$store.state.count</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">inc</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;inc&#x27;</span>)</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">dec</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;dec&#x27;</span>)</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="借助-mapState-辅助函数"><a href="#借助-mapState-辅助函数" class="headerlink" title="借助 mapState 辅助函数"></a>借助 mapState 辅助函数</h3><h4 id="对象形式"><a href="#对象形式" class="headerlink" title="对象形式"></a>对象形式</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;vuex&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>通过 $store.state 方式获取：&#123;&#123;$store.state.count&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>通过 computed 计算属性赋值：&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;inc&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;dec&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">        computed: mapState(&#123;</span><br><span class="line"><span class="javascript">            count: <span class="function"><span class="params">state</span> =&gt;</span> state.count</span></span><br><span class="line">        &#125;),</span><br><span class="line">        methods: &#123;</span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">inc</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;inc&#x27;</span>)</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">dec</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;dec&#x27;</span>)</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="数组形式"><a href="#数组形式" class="headerlink" title="数组形式"></a>数组形式</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 数组中的 count 必须和 store.js 中定义的常量 count 同名，因为这是直接访问 state 的 count</span></span><br><span class="line">computed: mapState([<span class="string">&#x27;count&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h2 id="Getters-计算过滤操作"><a href="#Getters-计算过滤操作" class="headerlink" title="Getters 计算过滤操作"></a>Getters 计算过滤操作</h2><p>有时候我们需要从 store 的 state 中派生出一些状态，比如在使用 store 中的 state 之前，我们会对 state 中的某些字段进行过滤——让 count 字段都进行加 10 这样的数据操作；但是如果有多个组件需要用到这个操作的话，那么我们就需要复制这个函数，或者抽取到一个共享函数内，<br>然后多处导入这个函数，但是这上面两种方式都不是太好，因为我们现在有更好的方式来解决它。</p>
<p>Vuex 允许我们在 store 中定义 getters，getters 的返回值会根据它的依赖被缓存起来，且只有当他的依赖值发生改变了才会重新计算。</p>
<p>现在我们对 store.js 文件中的 count 进行一个计算属性的操作，在它每次输出之前，加上20。</p>
<p>如下代码有两个按钮，一个加5，一个减5，那么在加5或者减5之前，先加20，然后再进行加5或者5操作。代码如下：</p>
<blockquote>
<p>store.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        count: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        inc: <span class="function">(<span class="params">state, num</span>) =&gt;</span> state.count += num,</span><br><span class="line">        dec: <span class="function">(<span class="params">state, num</span>) =&gt;</span> state.count -= num</span><br><span class="line">    &#125;,</span><br><span class="line">    getters: &#123;</span><br><span class="line">        <span class="function"><span class="title">myCount</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state.count + <span class="number">20</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>SWVuex.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;vuex&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>通过 $store.state 方式获取：&#123;&#123;$store.state.count&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>通过 computed 计算属性赋值：&#123;&#123;myCount&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>使用 $store.commit(&#x27;inc&#x27;, 5) 方式调用<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- $store.commit(&#x27;inc&#x27;, 5) 第一个参数是方法名，第二个是参数 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.commit(&#x27;inc&#x27;, 5)&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.commit(&#x27;dec&#x27;, 5)&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>使用mapMutations修改状态：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;inc(10)&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;dec(10)&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123;mapState, mapGetters, mapMutations&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">        computed: &#123;</span><br><span class="line"><span class="javascript">            <span class="comment">// mapState([&#x27;count&#x27;]) 此处的 count 必须和 store.js</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// state 中的 count 同名，因为这是直接访问 state 的 count</span></span></span><br><span class="line"><span class="javascript">            ...mapState([<span class="string">&#x27;count&#x27;</span>]),</span></span><br><span class="line"><span class="javascript">            <span class="comment">// mapGetters 辅助函数，</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// 可以将 store 中的 getter 映射到局部计算属性 myCount</span></span></span><br><span class="line"><span class="javascript">            ...mapGetters([<span class="string">&#x27;myCount&#x27;</span>])</span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line"><span class="javascript">            ...mapMutations([<span class="string">&#x27;inc&#x27;</span>, <span class="string">&#x27;dec&#x27;</span>])</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Mutations-修改状态"><a href="#Mutations-修改状态" class="headerlink" title="Mutations 修改状态"></a>Mutations 修改状态</h2><p>Mutations 是修改 vuex 中的 store 的唯一方法。每个 mutations 都有一个字符串的事件类型(type)和一个回调函数(handler)。这个回调函数就是我们进行更改的地方。它也会接受 state 作为第一个参数。</p>
<p>回顾上面的 <code>store.js</code> 中有关 mutations 的代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">    inc: <span class="function">(<span class="params">state, num</span>) =&gt;</span> state.count += num,</span><br><span class="line">    dec: <span class="function">(<span class="params">state, num</span>) =&gt;</span> state.count -= num</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>当我们点击页面上的按钮后会触发事件并执行方法，方法中又会调用 <code>$store.commit(type, args)</code> 来传入参数改变 state 数据。</p>
<h2 id="Actions-异步修改状态"><a href="#Actions-异步修改状态" class="headerlink" title="Actions 异步修改状态"></a>Actions 异步修改状态</h2><p>Actions 和 Mutations 类似，但它用来异步修改 state 的状态。而 Mutations 则是同步修改 state 的状态。</p>
<p>我们在 store.js 中声明 actions，actions 可以调用 mutations 的方法的。代码如下：</p>
<blockquote>
<p>store.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 增加两个 actions 方法</span></span><br><span class="line">actions: &#123;</span><br><span class="line">    <span class="function"><span class="title">incAction</span>(<span class="params">context</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(context)</span><br><span class="line">        <span class="comment">// 调用 mutations 中的 inc 方法，并传参数5</span></span><br><span class="line">        context.commit(<span class="string">&#x27;inc&#x27;</span>, <span class="number">5</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">decAction</span>(<span class="params">context</span>)</span> &#123;</span><br><span class="line">        context.commit(<span class="string">&#x27;dec&#x27;</span>, <span class="number">5</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上方代码中的参数 context 指上下文，即 store 本身。</p>
<p>然后在 SWVuex.vue 中通过 <code>this.$store.dispatch(action方法名, 参数)</code> 的方式调用：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;vuex&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>通过 $store.state 方式获取：&#123;&#123;$store.state.count&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>通过 computed 计算属性赋值：&#123;&#123;myCount&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>使用 $store.commit(&#x27;inc&#x27;, 5) 方式调用<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- $store.commit(&#x27;inc&#x27;, 5) 第一个参数是方法名，第二个是参数 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.commit(&#x27;inc&#x27;, 5)&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.commit(&#x27;dec&#x27;, 5)&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>使用mapMutations修改状态：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;inc(10)&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;dec(10)&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>actions的异步操作<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incAction&quot;</span>&gt;</span> + <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;decAction&quot;</span>&gt;</span> - <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123;mapState, mapGetters, mapMutations&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">        computed: &#123;</span><br><span class="line"><span class="javascript">            <span class="comment">// mapState([&#x27;count&#x27;]) 此处的 count 必须和 store.js</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// state 中的 count 同名，因为这是直接访问 state 的 count</span></span></span><br><span class="line"><span class="javascript">            ...mapState([<span class="string">&#x27;count&#x27;</span>]),</span></span><br><span class="line"><span class="javascript">            <span class="comment">// mapGetters 辅助函数，</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// 可以将 store 中的 getter 映射到局部计算属性 myCount</span></span></span><br><span class="line"><span class="javascript">            ...mapGetters([<span class="string">&#x27;myCount&#x27;</span>])</span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line"><span class="javascript">            ...mapMutations([<span class="string">&#x27;inc&#x27;</span>, <span class="string">&#x27;dec&#x27;</span>]),</span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">incAction</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;incAction&#x27;</span>)</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">decAction</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;decAction&#x27;</span>)</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当然，除了使用 <code>this.$store.dispatch()</code> 的方式以外，还可以借助 <code>mapActions</code> 来简化代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 新加 mapActions</span></span><br><span class="line"><span class="keyword">import</span> &#123;mapState, mapGetters, mapMutations, mapActions&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line">...</span><br><span class="line">methods: &#123;</span><br><span class="line">    ...mapMutations([<span class="string">&#x27;inc&#x27;</span>, <span class="string">&#x27;dec&#x27;</span>]),</span><br><span class="line">    ...mapActions([<span class="string">&#x27;incAction&#x27;</span>, <span class="string">&#x27;decAction&#x27;</span>]) <span class="comment">// +</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vuex</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue使用全局filter</title>
    <url>/posts/7498/</url>
    <content><![CDATA[<h3 id="1-Vue-中-Filter-声明方式"><a href="#1-Vue-中-Filter-声明方式" class="headerlink" title="1. Vue 中 Filter 声明方式"></a>1. Vue 中 Filter 声明方式</h3><p>Vue 中存在两种声明 Filter 过滤器的方式:</p>
<p><strong>全局过滤器</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.filter(<span class="string">&#x27;testFilter1&#x27;</span>, <span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;全局过滤器&#x27;</span>, val);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这种方式将过滤器声明到了 Vue 类型上，所有 Vue 对象即可访问这个过滤器</p>
<a id="more"></a>

<p><strong>本地过滤器</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  filters: &#123;</span><br><span class="line">    <span class="function"><span class="title">testFilter2</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;本地过滤器&#x27;</span>, val);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这种方式将过滤器声明到这个 Vue 对象中，所以只能这个 Vue 对象进行访问</p>
<h3 id="2-Vue-中在-Methods-中访问-Filter"><a href="#2-Vue-中在-Methods-中访问-Filter" class="headerlink" title="2. Vue 中在 Methods 中访问 Filter"></a>2. Vue 中在 Methods 中访问 Filter</h3><p>Vue 中在 Methods 中访问 Filter 有两种方式,分别对应两种 Filter 的声明方式</p>
<p><strong>访问全局过滤器</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getGlobal()&quot;</span>&gt;</span>调用全局过滤器<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  Vue.filter(<span class="string">&#x27;testFilter1&#x27;</span>, <span class="function"><span class="params">val</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&#x27;全局过滤器&#x27;</span>, val);</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript">  <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&#x27;#body&#x27;</span>,</span></span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">getGlobal</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//使用Vue.Filter()方式获取全局过滤器</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> te = Vue.filter(<span class="string">&#x27;testFilter1&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//调用全局过滤器</span></span></span><br><span class="line"><span class="javascript">        te(<span class="string">&#x27;filter&#x27;</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>访问本地过滤器</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getLocal()&quot;</span>&gt;</span>调用本地过滤器<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&#x27;#body&#x27;</span>,</span></span><br><span class="line">    filters: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">testFilter2</span>(<span class="params">val</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&#x27;本地过滤器&#x27;</span>, val);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">getLocal</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//使用this.$options.filters[]方式获取本地过滤器</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> te = <span class="built_in">this</span>.$options.filters[<span class="string">&#x27;testFilter2&#x27;</span>];</span></span><br><span class="line"><span class="javascript">        <span class="comment">//调用本地过滤器</span></span></span><br><span class="line"><span class="javascript">        te(<span class="string">&#x27;filter&#x27;</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>笔记</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-Vue修饰符sync</title>
    <url>/posts/21948/</url>
    <content><![CDATA[<p>转载自：<a href="https://www.jianshu.com/p/6b062af8cf01">简书深入理解 vue 修饰符 sync【 vue sync 修饰符示例】</a></p>
<p>在说 vue 修饰符 sync 前，我们先看下官方文档：<a href="https://link.jianshu.com/?t=https://cn.vuejs.org/v2/guide/components.html%23sync-%E4%BF%AE%E9%A5%B0%E7%AC%A6">vue .sync 修饰符</a>，里面说 vue .sync 修饰符以前存在于 vue1.0 版本里，但是在在 2.0 中移除了 .sync 。但是在 2.0 发布之后的实际应用中，我们发现 .sync 还是有其适用之处，比如在开发可复用的组件库时。我们需要做的只是让子组件改变父组件状态的代码更容易被区分。从 2.3.0 起我们重新引入了 .sync 修饰符，但是这次它只是作为一个编译时的语法糖存在。它会被扩展为一个自动更新父组件属性的 v-on 监听器。<br>示例代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">comp</span> <span class="attr">:foo.sync</span>=<span class="string">&quot;bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">comp</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>会被扩展为：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">comp</span> <span class="attr">:foo</span>=<span class="string">&quot;bar&quot;</span> @<span class="attr">update:foo</span>=<span class="string">&quot;val =&gt; bar = val&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">comp</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当子组件需要更新 foo 的值时，它需要显式地触发一个更新事件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.$emit(<span class="string">&#x27;update:foo&#x27;</span>, newValue);</span><br></pre></td></tr></table></figure>

<p>猛一看不明白，下边我么通过一个实例（弹窗的关闭事件）来说明这个代码到底是怎么运用的。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;details&quot;</span>&gt;</span></span><br><span class="line">    &lt;myComponent</span><br><span class="line">      :show.sync=&quot;valueChild&quot;</span><br><span class="line">      style=&quot;padding: 30px 20px 30px 5px;border:1px solid #ddd;margin-bottom: 10px;&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">myComponent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeValue&quot;</span>&gt;</span>toggle<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  Vue.component(<span class="string">&#x27;myComponent&#x27;</span>, &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">    template: `<span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;show&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span>默认初始值是</span><span class="template-variable">&#123;&#123;<span class="name">show</span>&#125;&#125;</span><span class="xml">，所以是显示的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.stop</span>=<span class="string">&quot;closeDiv&quot;</span>&gt;</span>关闭<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                 <span class="tag">&lt;/<span class="name">div</span>&gt;</span>`,</span></span></span><br><span class="line"><span class="javascript">    props: [<span class="string">&#x27;show&#x27;</span>],</span></span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">closeDiv</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;update:show&#x27;</span>, <span class="literal">false</span>); <span class="comment">//触发 input 事件，并传入新值</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        valueChild: <span class="literal">true</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">changeValue</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.valueChild = !<span class="built_in">this</span>.valueChild;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>动态效果如下：</p>


<p>vue 修饰符 sync 的功能是：当一个子组件改变了一个 prop 的值时，这个变化也会同步到父组件中所绑定。如果我们不用.sync，我们想做上面的那个弹窗功能，我们也可以 props 传初始值，然后事件监听，实现起来也不算复杂。这里用 sync 实现，只是给大家提供一个思路，让其明白他的实现原理，可能有其它复杂的功能适用 sync。</p>
<p><strong>Tip</strong></p>
<p><code>.sync</code> 的作用就是在父级中给组件添加上 <code>v-on:update:xxx</code> 这么一个监听，相当于一个语法糖，所以当你要绑定的是一个简单数据类型的时候，就可以使用它，并且子组件需要用$emit 来配合，而如果绑定的是一个引用类型就没必要了，因为子组件随意修改都会触发。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue如何同时监听多个属性</title>
    <url>/posts/13802/</url>
    <content><![CDATA[<p>在使用 watch 监听属性的时候发现需要同时监听三个属性。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name1: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      name2: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      age: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    <span class="function"><span class="title">listenChange</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; name1, name2 &#125; = <span class="built_in">this</span>;</span><br><span class="line">      <span class="keyword">return</span> &#123; name1, name2 &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  watch: &#123;</span><br><span class="line">    <span class="function"><span class="title">listenChange</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;listenChange :&#x27;</span>, val);</span><br><span class="line">      <span class="keyword">if</span> (val.name1 === val.name2) &#123;</span><br><span class="line">        <span class="built_in">this</span>.$set(<span class="built_in">this</span>, <span class="string">&#x27;age&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.$set(<span class="built_in">this</span>, <span class="string">&#x27;age&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如果不能直接监听多个属性的话，我们可以换个想法，先将多个属性放在一个对象中，直接监听这个对象就可以了，这时候返回的 val 将会打印出你输入的 name1，name2 的内容，可以同时监听到这两个属性。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue如何把参数传给addEventListener</title>
    <url>/posts/27137/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>在 Vue 中使用 <code>document.addEventListener</code> 需要把回调函数抽离出去放到 <code>methods</code> 中，然而 <code>methods</code> 中的默认 this 是 vue 实例，如果想要获取 <code>addEventListener</code> 的 event 事件对象，就得把方法改成箭头函数的形式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  handleKeyDown: <span class="function"><span class="params">event</span> =&gt;</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然而此时在 <code>handleKeyDown</code> 中又拿不到当前 vue 实例了。</p>
<a id="more"></a>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p><strong>使用 ES5 的 .bind()</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">//  监听键盘事件</span></span><br><span class="line">  <span class="built_in">document</span>.addEventListener(<span class="string">&#x27;keydown&#x27;</span>, <span class="built_in">this</span>.handleKeyDown.bind(<span class="literal">null</span>, <span class="built_in">this</span>));</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description </span>监听键盘事件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>vm 当前vue实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>e 事件对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    handleKeyDown: <span class="function">(<span class="params">vm, e</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<p>此刻监听器函数中的第二个参数才是 event 事件，而不是第一个参数。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue数据响应式的简单实现</title>
    <url>/posts/12491/</url>
    <content><![CDATA[<p>今天来实现一个简单的 Vue 数据响应式，最终达到两个基本效果：</p>
<ul>
<li>当用户在 input 中输入内容时，文本节点会跟着改变</li>
<li>当直接更新 message 属性后，页面中 input 标签和文本节点的值会跟着改变</li>
</ul>
<p>最终效果：</p>
<img src="/posts/12491/sw.gif" class="" title="实现效果">

<a id="more"></a>

<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>Vue 实现数据响应式的核心原理是：<strong>借助发布/订阅模式</strong> + <strong>数据劫持</strong> 。</p>
<ul>
<li>创建 vue 实例时深度遍历 data 下所有属性，利用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">Object.defineProperty</a> 把属性转为 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/get">getter/setter</a>。</li>
<li>Vue 实现了 <a href="https://juejin.im/post/5a9108b6f265da4e7527b1a4">发布订阅者模式</a>，在模板编译过程中解析 Vue 指令，给组件中的属性添加上相应订阅者（Watcher），这样在数据变更后会触发相应属性的 setter ，通过消息订阅器（Dep）发消息给所有订阅者（Watcher），从而触发相应组件的更新。</li>
</ul>
<h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── Compiler.js       # 指令解析器</span><br><span class="line">├── Dep.js            # 消息订阅器</span><br><span class="line">├── Observer.js       # 观察者</span><br><span class="line">├── Vue.js            # Vue的简单实现</span><br><span class="line">├── Watcher.js        # 订阅者</span><br><span class="line">├── index.html</span><br><span class="line">└── main.js           # 入口文件</span><br></pre></td></tr></table></figure>

<h2 id="具体代码"><a href="#具体代码" class="headerlink" title="具体代码"></a>具体代码</h2><h3 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h3><p>包含一个 input 标签和文本节点。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span> /&gt;</span></span><br><span class="line">      &#123;&#123;message&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;dist/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Dep-js-消息订阅器"><a href="#Dep-js-消息订阅器" class="headerlink" title="Dep.js 消息订阅器"></a>Dep.js 消息订阅器</h3><p>发布订阅者模式的简单实现。包含核心方法 <code>listen</code> 以及 <code>notify</code> ，<code>listen</code> 负责给属性添加订阅者，<code>notify</code> 负责在属性发生变化时通知所有该属性的订阅者。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;【Dep】实例化了一个消息订阅器&#x27;</span>);</span><br><span class="line">    <span class="comment">// 订阅者数组</span></span><br><span class="line">    <span class="built_in">this</span>.list = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">listen</span>(<span class="params">sub</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 谁要订阅我，就调用listen，把自己添加进订阅者数组中去</span></span><br><span class="line">    <span class="built_in">this</span>.list.push(sub);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">notify</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 当属性发生变化后，会在 setter 中调用此方法，</span></span><br><span class="line">    <span class="comment">// 消息订阅者通知订阅者数组中的所有人执行update操作</span></span><br><span class="line">    <span class="built_in">this</span>.list.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">      item.update();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Dep.prototype.target = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Dep;</span><br></pre></td></tr></table></figure>

<h3 id="main-js-入口文件"><a href="#main-js-入口文件" class="headerlink" title="main.js 入口文件"></a>main.js 入口文件</h3><p>该文件中 new 一个 Vue 实例，并把该实例挂载到 window 对象上。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;./Vue&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    message: <span class="string">&#x27;lance&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.vm = vm;</span><br></pre></td></tr></table></figure>

<h3 id="Observer-js-观察者"><a href="#Observer-js-观察者" class="headerlink" title="Observer.js 观察者"></a>Observer.js 观察者</h3><p>深度遍历 data 下的所有属性，利用 <code>Object.defineProperty</code> 把属性转为 <code>getter/setter</code> ，并在此过程中给每个属性都绑定上发布/订阅模块。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Dep <span class="keyword">from</span> <span class="string">&#x27;./Dep&#x27;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.data = data;</span><br><span class="line">    <span class="built_in">Object</span>.keys(<span class="built_in">this</span>.data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>._bind(data, key, data[key]);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">_bind</span>(<span class="params">data, key, val</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> myDep = <span class="keyword">new</span> Dep();</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(data, key, &#123;</span><br><span class="line">      <span class="comment">// 新建vm实例时，给data添加属性就是第一次赋值，就调用了get</span></span><br><span class="line">      <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 第一次访问这个属性时</span></span><br><span class="line">        <span class="comment">// 把订阅者(Watcher对象)注入发布/订阅模块</span></span><br><span class="line">        <span class="comment">// 后续访问就不用再添加这个属性的订阅者了</span></span><br><span class="line">        <span class="keyword">if</span> (Dep.target) myDep.listen(Dep.target);</span><br><span class="line">        <span class="keyword">return</span> val;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">set</span>(<span class="params">newValue</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (newValue === val) <span class="keyword">return</span>;</span><br><span class="line">        val = newValue;</span><br><span class="line">        myDep.notify();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Observer;</span><br></pre></td></tr></table></figure>

<h3 id="Watcher-js-订阅者"><a href="#Watcher-js-订阅者" class="headerlink" title="Watcher.js 订阅者"></a>Watcher.js 订阅者</h3><p>实现 update 方法，在属性发生变化时收到通知并执行它，从而更新组件数据。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Dep <span class="keyword">from</span> <span class="string">&#x27;./Dep&#x27;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line">  <span class="comment">// watcher需要当前组件中的：</span></span><br><span class="line">  <span class="comment">// 【节点】，【节点上相关的data属性】，【vm实例】</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">node, name, vm</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.node = node;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.vm = vm;</span><br><span class="line">    <span class="comment">// 将消息订阅器实例的当前订阅者设置为自己</span></span><br><span class="line">    Dep.target = <span class="built_in">this</span>;</span><br><span class="line">    <span class="built_in">this</span>.update();</span><br><span class="line">    Dep.target = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">update</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 得到数据变更通知后更新组件</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.node.nodeType === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.node.value = <span class="built_in">this</span>.vm[<span class="built_in">this</span>.name];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.node.nodeValue = <span class="built_in">this</span>.vm[<span class="built_in">this</span>.name];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Watcher;</span><br></pre></td></tr></table></figure>

<h3 id="Compiler-js-指令解析器"><a href="#Compiler-js-指令解析器" class="headerlink" title="Compiler.js 指令解析器"></a>Compiler.js 指令解析器</h3><p>负责解析挂载到 Vue 上的 html 模板，找出 Vue 相关的指令。例如遇到 input 标签上有 <code>v-model</code> ，则给绑定的属性添加订阅者（Watcher），并为 input 标签添加 <em>input</em> 事件，在用户输入 value 后更改 data 中相应属性的值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Watcher <span class="keyword">from</span> <span class="string">&#x27;./Watcher&#x27;</span>;</span><br><span class="line"><span class="comment">// 辨认 &#123;&#123;&#125;&#125; 的正则</span></span><br><span class="line"><span class="keyword">const</span> REG = <span class="regexp">/\&#123;\&#123;(.*)\&#125;\&#125;/</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">el, vm</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.el = <span class="built_in">document</span>.querySelector(el);</span><br><span class="line">    <span class="built_in">this</span>.vm = vm;</span><br><span class="line">    <span class="built_in">this</span>.frag = <span class="built_in">this</span>._createFragment();</span><br><span class="line">    <span class="built_in">this</span>.el.appendChild(<span class="built_in">this</span>.frag);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">_createFragment</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> frag = <span class="built_in">document</span>.createDocumentFragment();</span><br><span class="line">    <span class="keyword">var</span> child;</span><br><span class="line">    <span class="comment">// 遍历挂载对象下的所有节点</span></span><br><span class="line">    <span class="keyword">while</span> ((child = <span class="built_in">this</span>.el.firstChild)) &#123;</span><br><span class="line">      <span class="built_in">this</span>._compile(child);</span><br><span class="line">      frag.appendChild(child);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> frag;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">_compile</span>(<span class="params">node</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="built_in">this</span>;</span><br><span class="line">    <span class="comment">// 类型为元素</span></span><br><span class="line">    <span class="keyword">if</span> (node.nodeType === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> attr = node.attributes;</span><br><span class="line">      <span class="keyword">if</span> (attr.hasOwnProperty(<span class="string">&#x27;v-model&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> name = attr[<span class="string">&#x27;v-model&#x27;</span>].nodeValue;</span><br><span class="line">        <span class="comment">// 添加 input 监听事件</span></span><br><span class="line">        node.addEventListener(<span class="string">&#x27;input&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">          self.vm[name] = e.target.value;</span><br><span class="line">        &#125;);</span><br><span class="line">        node.value = <span class="built_in">this</span>.vm[name];</span><br><span class="line">        <span class="comment">// 给该属性添加订阅者</span></span><br><span class="line">        <span class="keyword">new</span> Watcher(node, name, <span class="built_in">this</span>.vm);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 元素为文本</span></span><br><span class="line">    <span class="keyword">if</span> (node.nodeType === <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="comment">// 目标：转化html中的 &#123;&#123;message&#125;&#125; 和 绑上watcher</span></span><br><span class="line">      <span class="keyword">if</span> (REG.test(node.nodeValue)) &#123;</span><br><span class="line">        <span class="comment">// 获取匹配到的字符串</span></span><br><span class="line">        <span class="keyword">var</span> name = <span class="built_in">RegExp</span>.$1;</span><br><span class="line">        name = name.trim();</span><br><span class="line">        <span class="comment">// 给元素添加订阅者，当vm实例的数据发生改变时,</span></span><br><span class="line">        <span class="comment">// 能收到通知并触发watcher中的update来更新元素上的值</span></span><br><span class="line">        <span class="comment">// 传递：</span></span><br><span class="line">        <span class="comment">// node节点（因为要改变元素中的值）</span></span><br><span class="line">        <span class="comment">// name属性名</span></span><br><span class="line">        <span class="comment">// 实例vm（为了调用vm下的属性）</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;【Compiler】解析到文本元素，给它创建一个watcher实例&#x27;</span>);</span><br><span class="line">        <span class="keyword">new</span> Watcher(node, name, <span class="built_in">this</span>.vm);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Compiler;</span><br></pre></td></tr></table></figure>

<h3 id="Vue-js"><a href="#Vue-js" class="headerlink" title="Vue.js"></a>Vue.js</h3><p>调用 <code>Compiler</code> 和 <code>Observer</code> ，实现数据响应式。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Observer <span class="keyword">from</span> <span class="string">&#x27;./Observer&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Compiler <span class="keyword">from</span> <span class="string">&#x27;./Compiler&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">options</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$options = options;</span><br><span class="line">    <span class="built_in">this</span>.$el = <span class="built_in">this</span>.$options.el;</span><br><span class="line">    <span class="built_in">this</span>._data = <span class="built_in">this</span>.$options.data;</span><br><span class="line">    <span class="built_in">Object</span>.keys(<span class="built_in">this</span>._data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>._proxy(key);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">new</span> Observer(<span class="built_in">this</span>._data);</span><br><span class="line">    <span class="keyword">new</span> Compiler(<span class="built_in">this</span>.$el, <span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 每次获取或赋值data中的属性时这样写代码：</span></span><br><span class="line">  <span class="comment">// Vue.$options.data.message 很长</span></span><br><span class="line">  <span class="comment">// 我们的期望：Vue.message</span></span><br><span class="line">  <span class="function"><span class="title">_proxy</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="built_in">this</span>;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(<span class="built_in">this</span>, key, &#123;</span><br><span class="line">      <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> self._data[key];</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">set</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">        self._data[key] = value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Vue;</span><br></pre></td></tr></table></figure>

<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>根目录下运行 <code>webpack main.js</code> 进行打包，浏览器运行 <code>index.html</code> 文件后便能看到文章开头的实现效果，完。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue深度作用选择器</title>
    <url>/posts/5691/</url>
    <content><![CDATA[<p>之前写 uni-app 在修改三方深层样式时，会使用 <code>/deep/</code> ，例如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> /<span class="selector-tag">deep</span>/ <span class="selector-class">.el-input__inner</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但在我的 Vue 项目中却报错，使用 <code>::v-deep</code> 则可以：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> <span class="selector-pseudo">::v-deep</span> <span class="selector-class">.el-input__inner</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><p><a href="https://vue-loader.vuejs.org/guide/scoped-css.html#deep-selectors">Deep Selectors</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>scss</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue深度监听对象新老值如何保持不一样</title>
    <url>/posts/32592/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>假如你用 vue 监听复杂对象的时候，新旧值通常是一样的，vue 官方也给出了解释：</p>
<blockquote>
<p>注意：在变异 (不是替换) 对象或数组时，旧值将与新值相同，因为它们的引用指向同一个对象/数组。Vue 不会保留变异之前值的副本。</p>
</blockquote>
<a id="more"></a>

<p>那么，问题来了，如何让 vue 深度监听对象新老值如何保持不一样？</p>
<p>Vue 官方也给出了方案：</p>
<blockquote>
<p>观察 Vue 实例变化的一个表达式或计算属性函数。回调函数得到的参数为新值和旧值。表达式只接受监督的键路径。对于更复杂的表达式，用一个函数取代</p>
</blockquote>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>对的，很简单，官方提供的方案就是，对于复杂的表达式，用一个函数取代。</p>
<p>那么我们之间把复杂表达式或者对象，用 computed 属性包装一下，再来监听 computed 属性，不就可以了嘛！</p>
<p><strong>之前的做法：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">data: &#123;</span><br><span class="line">    haoroomsObj: &#123;</span><br><span class="line">        haoroomstestinner: &#123;</span><br><span class="line">            a: <span class="string">&#x27;我是haorooms资源库&#x27;</span>,</span><br><span class="line">            b: <span class="string">&#x27;我是haorooms博客&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">watch: &#123;</span><br><span class="line">  haoroomsObj: &#123;</span><br><span class="line">    handler: <span class="function">(<span class="params">val, olVal</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;我变化了&#x27;</span>, val, olVal)</span><br><span class="line">    &#125;,</span><br><span class="line">    deep: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>此时，对象变化可以监听到，但是 val,和 oldVal 是一样的。</p>
<p><strong>函数包装后监听</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">data:&#123;</span><br><span class="line">    haoroomsObj: &#123;</span><br><span class="line">        haoroomstestinner: &#123;</span><br><span class="line">            a: <span class="string">&#x27;我是haorooms资源库&#x27;</span>,</span><br><span class="line">            b: <span class="string">&#x27;我是haorooms博客&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">computed: &#123;</span><br><span class="line">  <span class="function"><span class="title">newHaorooms</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>.haoroomsObj));</span><br><span class="line">  &#125;</span><br><span class="line">watch: &#123;</span><br><span class="line">  newHaorooms: &#123;</span><br><span class="line">    handler: <span class="function">(<span class="params">val, olVal</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;我变化了&#x27;</span>, val, olVal)</span><br><span class="line">    &#125;,</span><br><span class="line">    deep: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>此时监听打印的值就不一样了。</p>
<p>转载自：<a href="https://www.haorooms.com/post/vue_new_oldval">https://www.haorooms.com/post/vue_new_oldval</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue组件化常用技术总结(笔记)</title>
    <url>/posts/27829/</url>
    <content><![CDATA[<h1 id="组件化常用技术"><a href="#组件化常用技术" class="headerlink" title="组件化常用技术"></a>组件化常用技术</h1><h2 id="组件传值、通信"><a href="#组件传值、通信" class="headerlink" title="组件传值、通信"></a>组件传值、通信</h2><h3 id="父组件-gt-子组件"><a href="#父组件-gt-子组件" class="headerlink" title="父组件 =&gt; 子组件"></a>父组件 =&gt; 子组件</h3><ul>
<li>属性 props</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// child</span></span><br><span class="line">props: &#123;</span><br><span class="line">  msg: <span class="built_in">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// parent</span></span><br><span class="line">&lt;HelloWorld msg=<span class="string">&quot;Welcome to Your Vue.js App&quot;</span> /&gt;;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<ul>
<li>引用 refs</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// parent</span><br><span class="line"><span class="tag">&lt;<span class="name">HelloWorld</span> <span class="attr">ref</span>=<span class="string">&quot;hw&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">this.$refs.hw.xx // P.S. • 如果ref放在了原生DOM元素上，获取的数据就是原生DOM对象</span><br><span class="line">- 可以直接操作 • 如果ref放在了组件对象上，获取的就是组件对象 -</span><br><span class="line">可以获取到组件内data、methods，通过 this.$refs.refName.data名称/method名称 -</span><br><span class="line">可以获取到DOM对象，通过 this.$refs.refName.$el进行操作</span><br></pre></td></tr></table></figure>

<h3 id="子组件-gt-父组件：自定义事件"><a href="#子组件-gt-父组件：自定义事件" class="headerlink" title="子组件 =&gt; 父组件：自定义事件"></a>子组件 =&gt; 父组件：自定义事件</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// child</span></span><br><span class="line">props: &#123; <span class="attr">add</span>: <span class="built_in">Function</span> &#125;</span><br><span class="line"><span class="built_in">this</span>.$emit(<span class="string">&#x27;add&#x27;</span>, good)</span><br><span class="line"></span><br><span class="line"><span class="comment">// parent</span></span><br><span class="line">&lt;Cart @add=<span class="string">&quot;cartAdd($event)&quot;</span>&gt;&lt;/Cart&gt;</span><br></pre></td></tr></table></figure>

<h3 id="兄弟组件：通过共同祖辈组件"><a href="#兄弟组件：通过共同祖辈组件" class="headerlink" title="兄弟组件：通过共同祖辈组件"></a>兄弟组件：通过共同祖辈组件</h3><p>通过共同的祖辈组件搭桥，<code>$parent</code> 或 <code>$root</code>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// brother1</span></span><br><span class="line"><span class="built_in">this</span>.$parent.$on(<span class="string">&#x27;foo&#x27;</span>, handle);</span><br><span class="line"></span><br><span class="line"><span class="comment">// brother2</span></span><br><span class="line"><span class="built_in">this</span>.$parent.$emit(<span class="string">&#x27;foo&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="祖先和后代之间"><a href="#祖先和后代之间" class="headerlink" title="祖先和后代之间"></a>祖先和后代之间</h3><ul>
<li>provide/inject：能够实现祖先给后代传值</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ancestor</span></span><br><span class="line"><span class="function"><span class="title">provide</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> &#123;<span class="attr">foo</span>: <span class="string">&#x27;foo&#x27;</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// descendant</span></span><br><span class="line">inject: [<span class="string">&#x27;foo&#x27;</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>dispatch：后代给祖先传值</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个dispatch方法，指定要派发事件名称和数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">eventName, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> parent = <span class="built_in">this</span>.$parent</span><br><span class="line">  <span class="comment">// 只要还存在父元素就继续往上查找</span></span><br><span class="line">  <span class="keyword">while</span> (parent) &#123;</span><br><span class="line">    <span class="comment">// 父元素用$emit触发</span></span><br><span class="line">    parent.$emit(eventName,data)</span><br><span class="line">    <span class="comment">// 递归查找父元素</span></span><br><span class="line">    parent = parent.$parent</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用，HelloWorld.vue</span></span><br><span class="line">&lt;h1 @click=<span class="string">&quot;dispatch(&#x27;hello&#x27;, &#x27;hello,world&#x27;)&quot;</span>&gt;&#123;&#123; msg &#125;&#125;&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App.vue</span></span><br><span class="line"><span class="built_in">this</span>.$on(<span class="string">&#x27;hello&#x27;</span>, <span class="built_in">this</span>.sayHello)</span><br></pre></td></tr></table></figure>

<h3 id="任意两个组件之间：事件总线-或-vuex"><a href="#任意两个组件之间：事件总线-或-vuex" class="headerlink" title="任意两个组件之间：事件总线 或 vuex"></a>任意两个组件之间：事件总线 或 vuex</h3><ul>
<li>事件总线：创建一个 Bus 类负责事件派发、监听和回调管理</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 自定义Bus：事件派发、监听和回调管理</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bus</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//   eventName1:[fn1,fn2],</span></span><br><span class="line">    <span class="comment">//   eventName2:[fn3,fn4],</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="built_in">this</span>.callbacks = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  $on(name, fn)&#123;</span><br><span class="line">    <span class="built_in">this</span>.callbacks[name] = <span class="built_in">this</span>.callbacks[name] || []</span><br><span class="line">    <span class="built_in">this</span>.callbacks[name].push(fn)</span><br><span class="line">  &#125;</span><br><span class="line">  $emit(name, args)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">this</span>.callbacks[name])&#123;</span><br><span class="line">      <span class="built_in">this</span>.callbacks[name].forEach(<span class="function"><span class="params">cb</span> =&gt;</span> cb(args))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line">Vue.prototype.$bus = <span class="keyword">new</span> Bus()</span><br><span class="line"><span class="comment">// child1</span></span><br><span class="line"><span class="built_in">this</span>.$bus.$on(<span class="string">&#x27;foo&#x27;</span>, handle)</span><br><span class="line"><span class="comment">// child2</span></span><br><span class="line"><span class="built_in">this</span>.$bus.$emit(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line">copy<span class="comment">// 封装 vueEvent.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> VueEvent = <span class="keyword">new</span> Vue();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> VueEvent;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 广播者</span></span><br><span class="line"><span class="keyword">import</span> VueEvent <span class="keyword">from</span> <span class="string">&#x27;../model/VueEvent.js&#x27;</span>;</span><br><span class="line">methods: &#123;</span><br><span class="line">  <span class="function"><span class="title">emitNews</span>(<span class="params"></span>)</span> &#123; VueEvent.$emit(<span class="string">&#x27;to-news&#x27;</span>, <span class="built_in">this</span>.msg) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听者</span></span><br><span class="line"><span class="keyword">import</span> VueEvent <span class="keyword">from</span> <span class="string">&#x27;../model/VueEvent.js&#x27;</span>;</span><br><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  VueEvent.$on(<span class="string">&#x27;to-news&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;...接收到了data...&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Vuex：创建唯一的全局数据管理者 store，通过它管理数据并通知组件状态变更</li>
</ul>
<h2 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h2><blockquote>
<p>Vue 2.6.0 之后采用全新 v-slot 语法取代之前的 slot、slot-scope</p>
</blockquote>
<h3 id="匿名插槽"><a href="#匿名插槽" class="headerlink" title="匿名插槽"></a>匿名插槽</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// comp1</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// parent</span><br><span class="line"><span class="tag">&lt;<span class="name">comp</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">comp</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="具名插槽"><a href="#具名插槽" class="headerlink" title="具名插槽"></a>具名插槽</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// comp2</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// parent</span><br><span class="line"><span class="tag">&lt;<span class="name">Comp2</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 默认插槽用default做参数 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:default</span>&gt;</span>具名插槽<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 具名插槽用插槽名做参数 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:content</span>&gt;</span>内容...<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Comp2</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="作用域插槽"><a href="#作用域插槽" class="headerlink" title="作用域插槽"></a>作用域插槽</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// comp3</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">:foo</span>=<span class="string">&quot;foo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// parent</span><br><span class="line"><span class="tag">&lt;<span class="name">Comp3</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 把v-slot的值指定为作用域上下文对象(e.g. &#123;foo: foo&#125;) --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:default</span>=<span class="string">&quot;ctx&quot;</span>&gt;</span>来自子组件数据：&#123;&#123;ctx.foo&#125;&#125;<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Comp3</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>笔记</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue的生命周期函数</title>
    <url>/posts/33186/</url>
    <content><![CDATA[<h2 id="创建期间的生命周期函数"><a href="#创建期间的生命周期函数" class="headerlink" title="创建期间的生命周期函数"></a>创建期间的生命周期函数</h2><h3 id="beforeCreate"><a href="#beforeCreate" class="headerlink" title="beforeCreate"></a>beforeCreate</h3><p>实例刚在内存中被创建出来，此时还没有初始化好 data 和 methods 属性。</p>
<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>执行 loading 动画。</p>
<h3 id="created"><a href="#created" class="headerlink" title="created"></a>created</h3><p>实例已经在内存中创建完毕，data 和 methods 等属性也已经创建完成。但此刻<strong>还没有开始编译模板</strong>。</p>
<a id="more"></a>

<h4 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h4><ul>
<li>结束掉 loading 动画</li>
<li>做一些初始化工作，比如函数自执行，发起异步请求获取数据</li>
</ul>
<h3 id="beforeMount"><a href="#beforeMount" class="headerlink" title="beforeMount"></a>beforeMount</h3><p>此刻<strong>已经完成了模板的编译</strong>，但<strong>还没有挂载到页面上</strong>。换句话说，此时页面中类似 的语法还没有被替换成真正的数据。</p>
<h3 id="mounted"><a href="#mounted" class="headerlink" title="mounted"></a>mounted</h3><p>此刻已经将编译好的模板挂载到了页面中指定的容器中显示。用户已经可以看到渲染好的页面了。</p>
<h4 id="作用-2"><a href="#作用-2" class="headerlink" title="作用"></a>作用</h4><ul>
<li>由于此刻已经把模板挂载到了页面，所以能够在此钩子函数中获取 DOM 节点。</li>
<li>此函数中也能发起异步请求</li>
</ul>
<h2 id="运行期间的生命周期函数"><a href="#运行期间的生命周期函数" class="headerlink" title="运行期间的生命周期函数"></a>运行期间的生命周期函数</h2><h3 id="beforeUpdate"><a href="#beforeUpdate" class="headerlink" title="beforeUpdate"></a>beforeUpdate</h3><p>状态更新之前执行此函数，此刻 data 中的状态值是最新的，但是<strong>界面上显示的数据还是旧的</strong>。因此此时还没有开始重新渲染 DOM 节点。</p>
<h3 id="updated"><a href="#updated" class="headerlink" title="updated"></a>updated</h3><p>实例更新完毕后调用此函数，此刻 data 中的状态值和界面上显示的数据，都已经完成了更新，界面已经被重新渲染好了。</p>
<h2 id="销毁期间的生命周期函数"><a href="#销毁期间的生命周期函数" class="headerlink" title="销毁期间的生命周期函数"></a>销毁期间的生命周期函数</h2><h3 id="beforeDestroy"><a href="#beforeDestroy" class="headerlink" title="beforeDestroy"></a>beforeDestroy</h3><p>实例销毁之前调用。此刻实例仍然完全可用。</p>
<h4 id="作用-3"><a href="#作用-3" class="headerlink" title="作用"></a>作用</h4><p>一切你想要在组件销毁之前做事，例如弹出确认窗：“你确认删除XXX吗？”</p>
<h3 id="destroyed"><a href="#destroyed" class="headerlink" title="destroyed"></a>destroyed</h3><p>实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue组件通讯$attrs/$listeners</title>
    <url>/posts/47247/</url>
    <content><![CDATA[<h2 id="attrs"><a href="#attrs" class="headerlink" title="$attrs"></a>$attrs</h2><blockquote>
<p>包含了父作用域中不作为 prop 被识别 (且获取) 的特性绑定 (<code>class</code> 和 <code>style</code> 除外)。当一个组件没有声明任何 prop 时，这里会包含所有父作用域的绑定 (<code>class</code> 和 <code>style</code> 除外)，并且可以通过 <code>v-bind=&quot;$attrs&quot;</code> 传入内部组件——在创建高级别的组件时非常有用。</p>
</blockquote>
<p>——&gt; <a href="https://cn.vuejs.org/v2/api/#vm-attrs">Vue.js 官网 - vm.$attrs</a></p>
<p>一句话总结：接收除了 <code>props</code> 声明外的所有绑定属性（class、style 除外）</p>
<a id="more"></a>

<p>图解</p>
<img src="/posts/47247/attrs1.png" class="" title="图解">

<p>由于 <code>child.vue</code> 在 props 中声明了 name 属性，<code>$attrs</code> 中只有 age、gender 两个属性，输出结果为：</p>
<p>{ age: “20”, gender: “man” }</p>
<img src="/posts/47247/attrs2.png" class="" title="attrs2">

<p>另外可以在 <code>grandson.vue</code> 上通过 <code>v-bind=&quot;$attrs&quot;</code>， 可以将属性继续向下传递，让 <code>grandson.vue</code> 也能访问到父组件的属性，这在传递多个属性时会显得很便捷，而不用一条条的进行绑定。</p>
<p>如果想要添加其他属性，可继续绑定属性。但要注意的是，继续绑定的属性和 <code>$attrs</code> 中的属性有重复时，继续绑定的属性优先级会更高。</p>
<h2 id="listeners"><a href="#listeners" class="headerlink" title="$listeners"></a>$listeners</h2><blockquote>
<p>包含了父作用域中的 (不含 <code>.native</code> 修饰器的) <code>v-on</code> 事件监听器。它可以通过 <code>v-on=&quot;$listeners&quot;</code> 传入内部组件——在创建更高层次的组件时非常有用。</p>
</blockquote>
<p>——&gt; <a href="https://cn.vuejs.org/v2/api/#vm-listeners">Vue.js 官网 - vm.$listeners</a></p>
<p>一句话总结：接收除了带有 <code>.native</code> 事件修饰符的所有事件监听器</p>
<img src="/posts/47247/listeners1.png" class="" title="listeners1">

<p><code>App.vue</code> 中对 <code>child.vue</code> 绑定了两个事件，带有 <code>.native</code> 的 <code>click</code> 事件和一个自定义事件，所以在 <code>child.vue</code> 中，输出 <code>$listeners</code> 的结果为：</p>
<p>{ customEvent: fn }</p>
<img src="/posts/47247/listeners2.png" class="" title="listeners2">

<p>同 <code>attrs</code> 属性一样，可以通过 <code>v-on=&quot;$listeners&quot;</code>，将事件监听器继续向下传递，让 <code>grandson.vue</code> 访问到事件，且可以使用 <code>$emit</code> 触发 <code>App.vue</code> 的函数。</p>
<p>如果想要添加其他事件监听器，可继续绑定事件。但要注意的是，继续绑定的事件和 <code>$listeners</code> 中的事件有重复时，不会被覆盖。当 <code>grandson.vue</code> 触发 <code>customEvent</code> 时，<code>child.vue</code> 和 <code>parent.vue</code> 的事件都会被触发，触发顺序类似于冒泡，先到 <code>child.vue</code> 再到 <code>parent.vue</code>。</p>
<h2 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h2><p><a href="https://codesandbox.io/s/eloquent-wood-b2zed">https://codesandbox.io/s/eloquent-wood-b2zed</a></p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>当我们去二次封装别人组件时，可能别人组件上有很多属性，我们不想再次重写一遍</p>
<p>这时候就可以使用 <code>v-bind=&quot;$attrs&quot;</code> 和 <code>v-on=&quot;$listeners&quot;</code> 。这是 vue 2.4 版本提供</p>
<p><code>vm.$attrs</code> 是一个属性，其包含了父作用域中不作为 <code>prop</code> 被识别 (且获取) 的特性绑定 (class 和 style 除外)。这些未识别的属性可以通过 <code>v-bind=&quot;$attrs&quot;</code> 传入内部组件。未识别的事件可通过 v-on=”$listeners”传入。</p>
<p>举个例子，比如我创建了我的按钮组件 <code>myButton</code>，封装了 <code>element-ui</code> 的 <code>el-button</code> 组件（其实什么事情都没做），在使用组件 <code>&lt;my-button /&gt;</code> 时，就可以直接在组件上使用 <code>el-button</code> 的属性,不被 <code>prop</code> 识别的属性会传入到 <code>el-button</code> 元素上去：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">v-bind</span>=<span class="string">&quot;$attrs&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 父组件使用</span><br><span class="line"><span class="tag">&lt;<span class="name">my-button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">size</span>=<span class="string">&#x27;mini&#x27;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue组件开发——无限菜单</title>
    <url>/posts/23904/</url>
    <content><![CDATA[<h2 id="vue-cli-service-global-插件介绍"><a href="#vue-cli-service-global-插件介绍" class="headerlink" title="@vue/cli-service-global 插件介绍"></a>@vue/cli-service-global 插件介绍</h2><p>该 npm 包可以让你在零配置情况下，直接使用 <code>vue serve</code> 和 <code>vue build</code> 命令跑 <code>*.vue</code> 文件，并且可以把它编译打包成一个 Vue 插件。</p>
<h2 id="全局安装"><a href="#全局安装" class="headerlink" title="全局安装"></a>全局安装</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -g @vue/cli-service-global</span><br></pre></td></tr></table></figure>

<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><p>在任意文件夹下新建一个 <code>.vue</code> 文件，例如 <code>App.vue</code> ：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        msg: <span class="string">&#x27;Hello world&#x27;</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>然后命令行中输入：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd 该.vue文件路径</span><br><span class="line">vue serve App.vue</span><br></pre></td></tr></table></figure>

<p>最后打开浏览器输入 <code>http://localhost:8080/</code> 就能看到刚建的 <code>App.vue</code> 组件了。</p>
<h2 id="无限菜单组件开发"><a href="#无限菜单组件开发" class="headerlink" title="无限菜单组件开发"></a>无限菜单组件开发</h2><h3 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h3><ul>
<li>Menu 一级菜单<ul>
<li>MenuItem 成员</li>
</ul>
</li>
<li>SubMenu 含子菜单</li>
</ul>
<p>↓</p>
<ul>
<li>食品生鲜 -&gt; Menu<ul>
<li>休闲食品 -&gt; SubMenu<ul>
<li>零食大礼包 -&gt; Menu<ul>
<li>肉松饼 -&gt; MenuItem</li>
</ul>
</li>
</ul>
</li>
<li>进口食品 -&gt; Menu<ul>
<li>咖啡豆 -&gt; MenuItem</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="文件成员"><a href="#文件成员" class="headerlink" title="文件成员"></a>文件成员</h3><blockquote>
<p>App.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">menu</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">menuitem</span>&gt;</span>菜单1<span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">menuitem</span>&gt;</span>菜单2<span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">menuitem</span>&gt;</span>菜单3<span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">SubMenu</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;template v-slot:title&gt; 等于 &lt;template #title&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> #<span class="attr">title</span>&gt;</span>菜单4<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">menuitem</span>&gt;</span>菜单4-1<span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">menuitem</span>&gt;</span>菜单4-2<span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">SubMenu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Menu <span class="keyword">from</span> <span class="string">&#x27;./Menu&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> MenuItem <span class="keyword">from</span> <span class="string">&#x27;./MenuItem&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> SubMenu <span class="keyword">from</span> <span class="string">&#x27;./SubMenu&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        msg: <span class="string">&#x27;Hello world&#x27;</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      Menu,</span><br><span class="line">      MenuItem,</span><br><span class="line">      SubMenu</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Menu.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;menu&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>MenuItem.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>SubMenu.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;change&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-show</span>=<span class="string">&quot;flag&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        flag: <span class="literal">false</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">change</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.flag = !<span class="built_in">this</span>.flag;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样一个基本的菜单结构就完成了，二级菜单默认被折叠，点击菜单名后可以展开菜单成员。</p>
<img src="/posts/23904/%E4%BA%8C%E7%BA%A7%E8%8F%9C%E5%8D%95.gif" class="" title="基础菜单结构">

<h3 id="增加虚拟数据"><a href="#增加虚拟数据" class="headerlink" title="增加虚拟数据"></a>增加虚拟数据</h3><p>在 <code>App.vue</code> 下添加一个 menuList 数组来模拟多级菜单：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">menuList: [</span><br><span class="line">  &#123;</span><br><span class="line">    title: <span class="string">&#x27;菜单1&#x27;</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        title: <span class="string">&#x27;菜单1-1&#x27;</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123; <span class="attr">title</span>: <span class="string">&#x27;菜单1-1-1&#x27;</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">title</span>: <span class="string">&#x27;菜单1-1-2&#x27;</span> &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            title: <span class="string">&#x27;菜单1-1-3&#x27;</span>,</span><br><span class="line">            children: [&#123; <span class="attr">title</span>: <span class="string">&#x27;菜单1-1-3-1&#x27;</span> &#125;, &#123; <span class="attr">title</span>: <span class="string">&#x27;菜单1-1-3-2&#x27;</span> &#125;]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">title</span>: <span class="string">&#x27;菜单1-2&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">title</span>: <span class="string">&#x27;菜单1-3&#x27;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">title</span>: <span class="string">&#x27;菜单2&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">title</span>: <span class="string">&#x27;菜单3&#x27;</span> &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="仅有一层嵌套时的写法"><a href="#仅有一层嵌套时的写法" class="headerlink" title="仅有一层嵌套时的写法"></a>仅有一层嵌套时的写法</h3><blockquote>
<p>App.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">menu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;menu in menuList&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 没有子菜单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">menuitem</span> <span class="attr">:key</span>=<span class="string">&quot;menu.title&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;!menu.children&quot;</span>&gt;</span>&#123;&#123;menu.title&#125;&#125;<span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 有子菜单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SubMenu</span> <span class="attr">:key</span>=<span class="string">&quot;menu.title&quot;</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">title</span>&gt;</span>菜单4<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">menuitem</span>&gt;</span>菜单4-1<span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 如果子菜单还有子菜单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">SubMenu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们当然不能像上面这样硬编码，否则不得累死，要是碰上夸张点的十几层嵌套不死定了嘛。所以遇到这种重复的内容，就需要抽离出去。在上面代码中，重复的内容就是下面这一部分：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 有子菜单 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SubMenu</span> <span class="attr">:key</span>=<span class="string">&quot;menu.title&quot;</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">title</span>&gt;</span>菜单4<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">menuitem</span>&gt;</span>菜单4-1<span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 如果子菜单还有子菜单 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">SubMenu</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>所以我们新建一个 <code>ReSubMenu.vue</code> 来封装它：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">SubMenu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">title</span>&gt;</span>&#123;&#123;data.title&#125;&#125;<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;child in data.children&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">menuitem</span> <span class="attr">:key</span>=<span class="string">&quot;child.title&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;!child.children&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;child.title&#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 如果子菜单还有子菜单，就调用自己，并把当前对象传过去 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ReSub</span> <span class="attr">:key</span>=<span class="string">&quot;child.title&quot;</span> <span class="attr">:data</span>=<span class="string">&quot;child&quot;</span> <span class="attr">v-else</span>&gt;</span><span class="tag">&lt;/<span class="name">ReSub</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">SubMenu</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &#123;</span></span><br><span class="line"><span class="comment">title: &#x27;菜单1&#x27;,</span></span><br><span class="line"><span class="comment">  children: [&#123;title: &#x27;菜单1-1&#x27;&#125;,</span></span><br><span class="line"><span class="comment">    &#123;title: &#x27;菜单1-2&#x27;&#125;,</span></span><br><span class="line"><span class="comment">    &#123;title: &#x27;菜单1-3&#x27;&#125;]</span></span><br><span class="line"><span class="comment">&#125;, --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> SubMenu <span class="keyword">from</span> <span class="string">&#x27;./SubMenu&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> MenuItem <span class="keyword">from</span> <span class="string">&#x27;./MenuItem&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;ReSub&#x27;</span>, <span class="comment">// 起名字可以使用递归组件</span></span></span><br><span class="line">    props: &#123;</span><br><span class="line">      data: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="function">() =&gt;</span> (&#123;&#125;)</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      SubMenu,</span><br><span class="line">      MenuItem</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;css&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样一来我们就实现了无限菜单：</p>
<img src="/posts/23904/%E6%97%A0%E9%99%90%E8%8F%9C%E5%8D%95.png" class="" title="无限菜单">

<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><blockquote>
<p>App.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">menu</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;menu in menuList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">menuitem</span> <span class="attr">:key</span>=<span class="string">&quot;menu.title&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;!menu.children&quot;</span>&gt;</span></span><br><span class="line">          &#123;&#123;menu.title&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 把重复的内容，抽离出去 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ReSubMenu</span> <span class="attr">:key</span>=<span class="string">&quot;menu.title&quot;</span> <span class="attr">v-else</span> <span class="attr">:data</span>=<span class="string">&quot;menu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ReSubMenu</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- &lt;SubMenu&gt;</span></span><br><span class="line"><span class="comment">        &lt;template v-slot:title&gt; 等于 &lt;template #title&gt;</span></span><br><span class="line"><span class="comment">        &lt;template #title&gt;</span></span><br><span class="line"><span class="comment">          菜单4</span></span><br><span class="line"><span class="comment">        &lt;/template&gt;</span></span><br><span class="line"><span class="comment">        &lt;MenuItem&gt;菜单4-1&lt;/MenuItem&gt;</span></span><br><span class="line"><span class="comment">        &lt;MenuItem&gt;菜单4-2&lt;/MenuItem&gt;</span></span><br><span class="line"><span class="comment">      &lt;/SubMenu&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Menu <span class="keyword">from</span> <span class="string">&#x27;./Menu&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> MenuItem <span class="keyword">from</span> <span class="string">&#x27;./MenuItem&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> SubMenu <span class="keyword">from</span> <span class="string">&#x27;./SubMenu&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> ReSubMenu <span class="keyword">from</span> <span class="string">&#x27;./ReSubMenu&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        menuList: [</span><br><span class="line">          &#123;</span><br><span class="line"><span class="javascript">            title: <span class="string">&#x27;菜单1&#x27;</span>,</span></span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line"><span class="javascript">                title: <span class="string">&#x27;菜单1-1&#x27;</span>,</span></span><br><span class="line">                children: [</span><br><span class="line">                  &#123;</span><br><span class="line"><span class="javascript">                    title: <span class="string">&#x27;菜单1-1-1&#x27;</span></span></span><br><span class="line">                  &#125;,</span><br><span class="line">                  &#123;</span><br><span class="line"><span class="javascript">                    title: <span class="string">&#x27;菜单1-1-2&#x27;</span></span></span><br><span class="line">                  &#125;,</span><br><span class="line">                  &#123;</span><br><span class="line"><span class="javascript">                    title: <span class="string">&#x27;菜单1-1-3&#x27;</span>,</span></span><br><span class="line">                    children: [</span><br><span class="line">                      &#123;</span><br><span class="line"><span class="javascript">                        title: <span class="string">&#x27;菜单1-1-3-1&#x27;</span></span></span><br><span class="line">                      &#125;,</span><br><span class="line">                      &#123;</span><br><span class="line"><span class="javascript">                        title: <span class="string">&#x27;菜单1-1-3-2&#x27;</span></span></span><br><span class="line">                      &#125;</span><br><span class="line">                    ]</span><br><span class="line">                  &#125;</span><br><span class="line">                ]</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line"><span class="javascript">                title: <span class="string">&#x27;菜单1-2&#x27;</span></span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line"><span class="javascript">                title: <span class="string">&#x27;菜单1-3&#x27;</span></span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line"><span class="javascript">            title: <span class="string">&#x27;菜单2&#x27;</span></span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line"><span class="javascript">            title: <span class="string">&#x27;菜单3&#x27;</span></span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      Menu,</span><br><span class="line">      MenuItem,</span><br><span class="line">      SubMenu,</span><br><span class="line">      ReSubMenu</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Menu.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;menu&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>MenuItem.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>SubMenu.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;change&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-show</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sub&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        flag: <span class="literal">false</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">change</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.flag = !<span class="built_in">this</span>.flag;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;css&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.sub</span> &#123;</span></span><br><span class="line">    padding-left: 20px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ReSubMenu.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">SubMenu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">title</span>&gt;</span>&#123;&#123;data.title&#125;&#125;<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;child in data.children&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">menuitem</span> <span class="attr">:key</span>=<span class="string">&quot;child.title&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;!child.children&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;child.title&#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ReSub</span> <span class="attr">:key</span>=<span class="string">&quot;child.title&quot;</span> <span class="attr">:data</span>=<span class="string">&quot;child&quot;</span> <span class="attr">v-else</span>&gt;</span><span class="tag">&lt;/<span class="name">ReSub</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">SubMenu</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &#123;</span></span><br><span class="line"><span class="comment">title: &#x27;菜单1&#x27;,</span></span><br><span class="line"><span class="comment">  children: [&#123;title: &#x27;菜单1-1&#x27;&#125;,</span></span><br><span class="line"><span class="comment">    &#123;title: &#x27;菜单1-2&#x27;&#125;,</span></span><br><span class="line"><span class="comment">    &#123;title: &#x27;菜单1-3&#x27;&#125;]</span></span><br><span class="line"><span class="comment">&#125;, --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> SubMenu <span class="keyword">from</span> <span class="string">&#x27;./SubMenu&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> MenuItem <span class="keyword">from</span> <span class="string">&#x27;./MenuItem&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;ReSub&#x27;</span>, <span class="comment">// 起名字可以使用递归组件</span></span></span><br><span class="line">    props: &#123;</span><br><span class="line">      data: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="function">() =&gt;</span> (&#123;&#125;)</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      SubMenu,</span><br><span class="line">      MenuItem</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue自定义create方法用于通过JS创建组件实例</title>
    <url>/posts/6559/</url>
    <content><![CDATA[<h3 id="方案一：Vue-extend-Component-获取组件构造函数"><a href="#方案一：Vue-extend-Component-获取组件构造函数" class="headerlink" title="方案一：Vue.extend(Component) 获取组件构造函数"></a>方案一：Vue.extend(Component) 获取组件构造函数</h3><p><code>Vue.extend</code> 是 Vue 全局 API，<a href="https://cn.vuejs.org/v2/api/#Vue-extend">官方文档</a> 对其描述如下：</p>
<blockquote>
<p>使用基础 Vue 构造器，创建一个“子类”。参数是一个包含组件选项的对象。</p>
</blockquote>
<p>从官方文档的描述中，我们可以知道，<code>extend</code> 创建的是 Vue 构造器，而不是我们平时常写的组件实例，所以不可以通过 <code>new Vue(&#123; components: testExtend &#125;)</code> 来直接使用，需要通过 <code>new Profile().$mount(&#39;#mount-point&#39;)</code> 来挂载到指定的元素上。</p>
<a id="more"></a>

<h4 id="为什么使用-extend"><a href="#为什么使用-extend" class="headerlink" title="为什么使用 extend"></a>为什么使用 extend</h4><p>在 vue 项目中，我们有了初始化的根实例后，所有页面基本上都是通过 router 来管理，组件也是通过 <code>import</code> 来进行局部注册，所以组件的创建我们不需要去关注，相比 <code>extend</code> 要更省心一点点。但是这样做会有几个缺点：</p>
<ol>
<li>组件模板都是事先定义好的，如果我要从接口动态渲染组件怎么办？</li>
<li>所有内容都是在 <code>#app</code> 下渲染，注册组件都是在当前位置渲染。如果我要实现一个类似于 <code>window.alert()</code> 提示组件要求像调用 JS 函数一样调用它，该怎么办？</li>
</ol>
<p>这时候，<code>Vue.extend + vm.$mount</code> 组合就派上用场了。</p>
<p>接下来，让我们用 Vue.extend() 来实现一个方法，该方法用来动态创建一个组件实例。</p>
<p><strong>步骤一：获取组件构造函数</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue.extend 返回一个预设了部分选项的 Vue 实例构造器，即类似于js 中的构造函数，用来生成组件</span></span><br><span class="line"><span class="keyword">const</span> ConponentConstructor = Vue.extend(Component);</span><br></pre></td></tr></table></figure>

<p><strong>步骤二：构建组件实例并挂载到 DOM 节点上</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 构建一个Component的实例</span></span><br><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> ConponentConstructor(&#123;</span><br><span class="line">  <span class="comment">// render：字符串模板 template 的替代方案，用于返回 createElement 方法创建的 VNode</span></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">createElement</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// render 方法接受 createElement 方法作为第一个参数用来创建 VNode</span></span><br><span class="line">    <span class="keyword">return</span> createElement(Component, &#123; props &#125;); <span class="comment">// 返回 createElement 创建的VNode</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">vm.$mount(); <span class="comment">// $mount() 把Vue实例挂载到DOM节点上  // $mount()方法不设置挂载目标，依然可以转换vnode为真实节点$el</span></span><br></pre></td></tr></table></figure>

<p><strong>步骤三：把当前 Vue 实例关联的 DOM 元素挂载到 body 上</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 把 Vue 实例关联的DOM 元素挂载到 body 上</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(vm.$el);</span><br><span class="line"><span class="comment">// 获取组件实例</span></span><br><span class="line"><span class="keyword">const</span> component = vm.$children[<span class="number">0</span>]; <span class="comment">// vm.$children 当前实例的直接子组件</span></span><br><span class="line">component.remove = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 把当前实例关联的DOM 元素从 body 删除</span></span><br><span class="line">  <span class="built_in">document</span>.body.removeChild(vm.$el);</span><br><span class="line">  <span class="comment">// 销毁实例，此时对应 Vue 实例的所有指令都会被解绑，所有的事件监听器也会被移除</span></span><br><span class="line">  vm.$destroy();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>以下是完整代码：</p>
<p><strong>方案一的第一种写法：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * create 创建一个指定组件的实例</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>Component 组件配置对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>props 传递给组件的属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> create = <span class="function">(<span class="params">Component, props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Vue.extend 返回一个预设了部分选项的 Vue 实例构造器，即类似于js 中的构造函数，用来生成组件</span></span><br><span class="line">  <span class="keyword">const</span> ComponentConstructor = Vue.extend(Component);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在 new ComponentConstructor() 里使用 render 函数，此处返回的是 Vue 实例，还需要通过 vm.$children[0] 来获取组件实例</span></span><br><span class="line">  <span class="keyword">const</span> vm = <span class="keyword">new</span> ComponentConstructor(&#123;</span><br><span class="line">    <span class="comment">// 字符串模板 template 的替代方案，用于返回 createElement 方法创建的 VNode</span></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params">createElement</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// render 方法接受 createElement 方法作为第一个参数用来创建 VNode</span></span><br><span class="line">      <span class="keyword">return</span> createElement(Component, &#123; props &#125;); <span class="comment">// 返回 createElement 创建的VNode</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  vm.$mount(); <span class="comment">// $mount() 把Vue实例挂载到DOM节点上  // $mount()方法不设置挂载目标，依然可以转换vnode为真实节点$el</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把 Vue 实例关联的DOM 元素挂载到 body 上</span></span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(vm.$el);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取组件实例</span></span><br><span class="line">  <span class="keyword">const</span> component = vm.$children[<span class="number">0</span>]; <span class="comment">// vm.$children 当前实例的直接子组件</span></span><br><span class="line">  component.remove = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 把当前实例关联的DOM 元素从 body 删除</span></span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(vm.$el);</span><br><span class="line">    <span class="comment">// 销毁实例，此时对应 Vue 实例的所有指令都会被解绑，所有的事件监听器也会被移除</span></span><br><span class="line">    vm.$destroy();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> component;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> create;</span><br></pre></td></tr></table></figure>

<p><strong>方案一的第二种写法：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * create 创建一个指定组件的实例</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>Component 组件配置对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>props 传递给组件的属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> create = <span class="function">(<span class="params">Component, props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Vue.extend 返回一个预设了部分选项的 Vue 实例构造器，即类似于js 中的构造函数，用来生成组件</span></span><br><span class="line">  <span class="keyword">const</span> Ctor = Vue.extend(Component);</span><br><span class="line">  <span class="comment">// 此处 new Ctor() 后返回的是组件实例，可直接用于挂载</span></span><br><span class="line">  <span class="keyword">const</span> comp = <span class="keyword">new</span> Ctor(&#123; <span class="attr">propsData</span>: props &#125;);</span><br><span class="line">  comp.$mount();</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(comp.$el);</span><br><span class="line">  comp.remove = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 移除dom</span></span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(comp.$el);</span><br><span class="line">    <span class="comment">// 销毁组件</span></span><br><span class="line">    comp.$destroy();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> comp;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> create;</span><br></pre></td></tr></table></figure>

<h3 id="方案二：通过-new-Vue-的方式实例化一个组件实例"><a href="#方案二：通过-new-Vue-的方式实例化一个组件实例" class="headerlink" title="方案二：通过 new Vue() 的方式实例化一个组件实例"></a>方案二：通过 new Vue() 的方式实例化一个组件实例</h3><h4 id="new-Vue"><a href="#new-Vue" class="headerlink" title="new Vue()"></a>new Vue()</h4><blockquote>
<p>new Vue() 用于创建一个 Vue 实例</p>
</blockquote>
<p><strong>步骤一：构建 Component 实例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="comment">// 字符串模板 template 的替代方案，用于返回 createElement 方法创建的 VNode</span></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">createElement</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// render 方法接受 createElement 方法作为第一个参数用来创建 VNode</span></span><br><span class="line">    <span class="keyword">return</span> createElement(Component, &#123; props &#125;); <span class="comment">// 返回 createElement 创建的VNode</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).$mount(); <span class="comment">// 不设置挂载目标，依然可以转换vnode为真实节点$el</span></span><br></pre></td></tr></table></figure>

<p><strong>步骤二：把 Vue 实例关联的 DOM 元素挂载到 body 上</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.appendChild(vm.$el);</span><br></pre></td></tr></table></figure>

<p><strong>步骤三：获取组件实例并返回</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> component = vm.$children[<span class="number">0</span>]; <span class="comment">// vm.$children 当前实例的直接子组件</span></span><br><span class="line">component.remove = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 把当前实例关联的DOM 元素从 body 删除</span></span><br><span class="line">  <span class="built_in">document</span>.body.removeChild(vm.$el);</span><br><span class="line">  <span class="comment">// 销毁实例，此时对应 Vue 实例的所有指令都会被解绑，所有的事件监听器也会被移除</span></span><br><span class="line">  vm.$destroy();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>以下是完整代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Component - 组件配置对象</span></span><br><span class="line"><span class="comment">// props - 传递给它的属性</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">Component, props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 1.构建Component的实例</span></span><br><span class="line">  <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params">h</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// h是createElement</span></span><br><span class="line">      <span class="comment">// 它可以返回一个vnode</span></span><br><span class="line">      <span class="keyword">return</span> h(Component, &#123; props &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).$mount(); <span class="comment">// 不设置挂载目标，依然可以转换vnode为真实节点$el</span></span><br><span class="line">  <span class="comment">// 2.把 Vue 实例关联的DOM 元素挂载到 body 上</span></span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(vm.$el);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.获取组件实例</span></span><br><span class="line">  <span class="keyword">const</span> comp = vm.$children[<span class="number">0</span>];</span><br><span class="line">  comp.remove = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(vm.$el);</span><br><span class="line">    vm.$destroy();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> comp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> create;</span><br></pre></td></tr></table></figure>

<p>我们已经实现了用于创建组件实例的 create 方法，那么我们该怎么使用它呢？</p>
<h3 id="方法调用"><a href="#方法调用" class="headerlink" title="方法调用"></a>方法调用</h3><h4 id="方式一：import-导入"><a href="#方式一：import-导入" class="headerlink" title="方式一：import 导入"></a>方式一：import 导入</h4><p>在你需要调用该方法的文件中通过 import 的方式导入 create 方法，然后直接调用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">create(Notice, &#123;</span><br><span class="line">  title: <span class="string">&#x27;老杨喊你来搬砖&#x27;</span>,</span><br><span class="line">  message: isValid ? <span class="string">&#x27;请求登录。。。&#x27;</span> : <span class="string">&#x27;校验失败了&#x27;</span></span><br><span class="line">&#125;).show();</span><br></pre></td></tr></table></figure>

<p>create 方法的第一个参数是一个已经定义好的组件，第二个参数是传递给传入 create 方法的组件的 props，props 中的属性必须是传入的组件中已经定义好的。</p>
<p>上面代码的含义是通过 create 方法创建 Notice 组件的实例，调用 Notice 组件中定义的 show() 方法显示出来。</p>
<h4 id="方式二：定义成插件，在全局调用"><a href="#方式二：定义成插件，在全局调用" class="headerlink" title="方式二：定义成插件，在全局调用"></a>方式二：定义成插件，在全局调用</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Notice <span class="keyword">from</span> <span class="string">&#x27;@/components/Notice.vue&#x27;</span>；</span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">// 此处是 create 方法的具体实现</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> <span class="function"><span class="title">install</span>(<span class="params">Vue</span>)</span> &#123;</span><br><span class="line"> Vue.prototype.$notice = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> create(Notice, options)</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义成插件后，便可以在全局作用下调用 create 方法了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.$notice（&#123;</span><br><span class="line"> title: <span class="string">&#x27;我是弹窗标题&#x27;</span>,</span><br><span class="line"> message: <span class="string">&#x27;我是弹窗提示信息&#x27;</span>,</span><br><span class="line"> duration: <span class="number">1000</span></span><br><span class="line">&#125;).show();</span><br></pre></td></tr></table></figure>

<p>附上 Notice 组件的代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;box&quot; v-if&#x3D;&quot;isShow&quot;&gt;</span><br><span class="line">    &lt;h3&gt;&#123;&#123; title &#125;&#125;&lt;&#x2F;h3&gt;</span><br><span class="line">    &lt;p class&#x3D;&quot;box-content&quot;&gt;&#123;&#123; message &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    title: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#39;&#39;</span><br><span class="line">    &#125;,</span><br><span class="line">    message: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#39;&#39;</span><br><span class="line">    &#125;,</span><br><span class="line">    duration: &#123;</span><br><span class="line">      type: Number,</span><br><span class="line">      default: 1000</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      isShow: false</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    show() &#123;</span><br><span class="line">      this.isShow &#x3D; true;</span><br><span class="line">      setTimeout(this.hide, this.duration);</span><br><span class="line">    &#125;,</span><br><span class="line">    hide() &#123;</span><br><span class="line">      this.isShow &#x3D; false;</span><br><span class="line">      this.remove();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.box &#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">  width: 100%;</span><br><span class="line">  top: 16px;</span><br><span class="line">  left: 0;</span><br><span class="line">  text-align: center;</span><br><span class="line">  pointer-events: none;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  border: grey 3px solid;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line">.box-content &#123;</span><br><span class="line">  width: 200px;</span><br><span class="line">  margin: 10px auto;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  padding: 8px 16px;</span><br><span class="line">  background: #fff;</span><br><span class="line">  border-radius: 3px;</span><br><span class="line">  margin-bottom: 8px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<p>来源：<a href="https://www.yuque.com/moozi/umgbyh/mps35y">https://www.yuque.com/moozi/umgbyh/mps35y</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>WKWebView通过监听获取加载进度和标题</title>
    <url>/posts/63756/</url>
    <content><![CDATA[<p>转载：<a href="https://www.jianshu.com/p/548a772f433e">https://www.jianshu.com/p/548a772f433e</a></p>
<p>WKWebView 提供了可以监听页面加载进度，以及页面的标题的方法。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> webView = <span class="type">WKWebView</span>(frame: <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: screenWidth, height: screenHeight - navigationHeight ), configuration: <span class="type">WKWebViewConfiguration</span>())</span><br><span class="line"></span><br><span class="line"><span class="built_in">lazy</span> <span class="keyword">private</span> <span class="keyword">var</span> progressView: <span class="type">UIProgressView</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> progress = <span class="type">UIProgressView</span>.<span class="keyword">init</span>(frame: <span class="type">CGRect</span>(x: <span class="type">CGFloat</span>(<span class="number">0</span>), y: <span class="type">CGFloat</span>(<span class="number">0</span>), width: <span class="type">UIScreen</span>.main.bounds.width, height: <span class="number">2</span>))</span><br><span class="line">        progress.tintColor = <span class="type">UIColor</span>.green</span><br><span class="line">        progress.trackTintColor = <span class="type">UIColor</span>.white</span><br><span class="line">        <span class="keyword">return</span> progress</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    webView.addObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">&quot;title&quot;</span>, options: .new, context: <span class="literal">nil</span>)</span><br><span class="line">    webView.addObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">&quot;estimatedProgress&quot;</span>, options: .new, context: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加观察者方法</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">observeValue</span><span class="params">(forKeyPath keyPath: String?, of object: <span class="keyword">Any</span>?, change: [NSKeyValueChangeKey : <span class="keyword">Any</span>]?, context: UnsafeMutableRawPointer?)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//设置进度条</span></span><br><span class="line">   <span class="keyword">if</span> keyPath == <span class="string">&quot;estimatedProgress&quot;</span>&#123;</span><br><span class="line">      progressView.alpha = <span class="number">1.0</span></span><br><span class="line">      progressView.setProgress(<span class="type">Float</span>(webView.estimatedProgress), animated: <span class="literal">true</span>)</span><br><span class="line">      <span class="keyword">if</span> webView.estimatedProgress &gt;= <span class="number">1.0</span> &#123;</span><br><span class="line">            <span class="type">UIView</span>.animate(withDuration: <span class="number">0.3</span>, delay: <span class="number">0.1</span>, options: .curveEaseOut, animations: &#123;</span><br><span class="line">               <span class="keyword">self</span>.progressView.alpha = <span class="number">0</span></span><br><span class="line">            &#125;, completion: &#123; (finish) <span class="keyword">in</span></span><br><span class="line">               <span class="keyword">self</span>.progressView.setProgress(<span class="number">0.0</span>, animated: <span class="literal">false</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//重设标题</span></span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span> keyPath == <span class="string">&quot;title&quot;</span> &#123;</span><br><span class="line">      <span class="keyword">self</span>.title = <span class="keyword">self</span>.webView.title</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>Webpack4-Shimming(垫片)</title>
    <url>/posts/29270/</url>
    <content><![CDATA[<h2 id="先举个栗子-🌰"><a href="#先举个栗子-🌰" class="headerlink" title="先举个栗子 🌰"></a>先举个栗子 🌰</h2><p>假设我们一个用 webpack 打包的项目有以下场景</p>
<blockquote>
<p>index.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&#x27;jquery&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; initUI &#125; <span class="keyword">from</span> <span class="string">&#x27;ui.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> $div = $(<span class="string">&#x27;&lt;div&gt;&lt;/div&gt;&#x27;</span>);</span><br><span class="line">$div.html(<span class="string">&#x27;hello world!&#x27;</span>);</span><br><span class="line">$(<span class="string">&#x27;body&#x27;</span>).append($div);</span><br><span class="line"></span><br><span class="line">initUI();</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<blockquote>
<p>ui.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initUI</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $(<span class="string">&#x27;body&#x27;</span>).css(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;green&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时我们直接打包代码是不能执行的，因为 <code>ui.js</code> 中没有引入 <code>jquery</code>，所以不能使用 <code>$</code> 。</p>
<p>按照正常思路我们会想，不是在 <code>index.js</code> 中一开始就引入了 jquery 么？为什么还会报错？这是因为 webpack 是基于模块打包的，当前模块下的变量只能在当前文件中起作用。所以引入的其他模块中如果也使用了这个变量就失效了。</p>
<p>这种问题场景其实还不止是本地文件，有可能第三方库中也引用了 jquery，但是我们直接去改库的代码是不太现实的。此时，就可以用 shimming（垫片）来解决这个问题。</p>
<h2 id="如何使用垫片插件"><a href="#如何使用垫片插件" class="headerlink" title="如何使用垫片插件"></a>如何使用垫片插件</h2><p>首先要引入 webpack 模块，然后配置插件</p>
<blockquote>
<p>webpack.config.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">    $: <span class="string">&#x27;jquery&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>当我们加上这段代码后，模块在打包的时候，发现你使用了 <code>$</code> 就会在你模块顶部自动加入 <code>import $ from &#39;jquery&#39;</code> 。</p>
<h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><ul>
<li><a href="https://webpack.js.org/plugins/provide-plugin/">ProvidePlugin（官网）</a></li>
<li><a href="https://webpack.docschina.org/plugins/provide-plugin/">ProvidePlugin（中文）</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>构建工具</category>
        <category>Webpack</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>Webpack面试题（面试系列）</title>
    <url>/posts/6706/</url>
    <content><![CDATA[<p>下面的题目都摘自各种 webpack 面试相关的文章，我只选择了感觉很重要的一些题，想要了解更多，可以查看本文最后的参考链接。</p>
<h2 id="webpack-有什么用"><a href="#webpack-有什么用" class="headerlink" title="webpack 有什么用"></a>webpack 有什么用</h2><ul>
<li>静态资源的合并/打包/压缩</li>
<li>解决加载慢，错综复杂的依赖关系</li>
</ul>
<h2 id="有哪些常见-loader-和-plugin，你用过哪些"><a href="#有哪些常见-loader-和-plugin，你用过哪些" class="headerlink" title="有哪些常见 loader 和 plugin，你用过哪些"></a>有哪些常见 loader 和 plugin，你用过哪些</h2><p>loader：</p>
<ul>
<li>css：postcss-l+autoprefixer，style-l(js 到</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>Xcode11手写代码入口启动黑屏解决方案</title>
    <url>/posts/33273/</url>
    <content><![CDATA[<p>环境：Xcode11</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>用 Swift 编写后发现编译通过但启动黑屏。</p>
<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><ul>
<li>Xcode11 默认是会创建通过 UIScene 管理多个 UIWindow 的应用，工程中除了 AppDelegate 外会多一个 SceneDelegate</li>
<li>AppDelegate 和 SceneDelegate 这是 iPadOS 带来的新的多窗口支持的结果，并且有效地将应用程序委托的工作分成两部分</li>
</ul>
<a id="more"></a>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol>
<li>删除掉 info.plist 中 <code>Application Scene Manifest</code> 和 <code>Main storyboard file base name</code> 选项</li>
</ol>
<img src="/posts/33273/scene.png" class="" title="scene">

<img src="/posts/33273/mainstoryboard.png" class="" title="mainstoryboard">

<ol>
<li>删除 <code>SceneDelegate.swift</code> 文件</li>
<li>Appdelegate 新增 windows 属性</li>
</ol>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span> </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> window: <span class="type">UIWindow?</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="keyword">_</span>: UIApplication, didFinishLaunchingWithOptions <span class="keyword">_</span>: [UIApplication.LaunchOptionsKey: <span class="keyword">Any</span>]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">      <span class="comment">// Override point for customization after application launch.</span></span><br><span class="line"></span><br><span class="line">      window = <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">      window?.rootViewController = <span class="type">ViewController</span>()</span><br><span class="line">      window?.makeKeyAndVisible()</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>Xcode</tag>
      </tags>
  </entry>
  <entry>
    <title>Xcode升级12编译报错The linked library is missing one or more architectures required by this target</title>
    <url>/posts/45158/</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>升级 Xcode12 后编译报错，报错提示类似：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">The linked library &#x27;xxxx.a/Framework&#x27; is missing one or more architectures required by this target: armv7.</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>又或者：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xxx/Pods/Target Support Files/Pods-xxx/Pods-xxx-frameworks.sh: line 128: ARCHS[@]: unbound variable</span><br><span class="line">Command PhaseScriptExecution failed with a nonzero exit code</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>在 TARGETS ——&gt; Build Settings-Excluded Architectures 中添加以下代码：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">EXCLUDED_ARCHS__EFFECTIVE_PLATFORM_SUFFIX_simulator__NATIVE_ARCH_64_BIT_x86_64=arm64 arm64e armv7 armv7s armv6 armv8 EXCLUDED_ARCHS=$(inherited) $(EXCLUDED_ARCHS__EFFECTIVE_PLATFORM_SUFFIX_$(EFFECTIVE_PLATFORM_SUFFIX)__NATIVE_ARCH_64_BIT_$(NATIVE_ARCH_64_BIT))</span><br></pre></td></tr></table></figure>

<img src="/posts/45158/comp.png" class="" title="target-build-settings">

<p>保存后重新编译即可。</p>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Xcode</tag>
      </tags>
  </entry>
  <entry>
    <title>Xcode格式化代码</title>
    <url>/posts/7987/</url>
    <content><![CDATA[<p>最近因为业务需要重操旧业，玩起了 iOS。发现 Xcode 没有 VS Code 这种 IDE 自带的格式化代码工具。问了问万能 Will ，推荐了个插件叫 <a href="https://github.com/nicklockwood/SwiftFormat">SwiftFormat</a> 。感觉还不错。这里记录下如何用 CocoPods 安装。</p>
<a id="more"></a>

<h3 id="Pods-引入"><a href="#Pods-引入" class="headerlink" title="Pods 引入"></a>Pods 引入</h3><p>在 <code>Podfile</code> 中添加插件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Pods <span class="keyword">for</span> YYT</span></span><br><span class="line">  ...</span><br><span class="line">  pod &#x27;SwiftFormat/CLI&#x27;</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h3 id="Pods-更新"><a href="#Pods-更新" class="headerlink" title="Pods 更新"></a>Pods 更新</h3><p>项目的根目录执行 Pods 更新：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pod update --no-repo-update</span><br></pre></td></tr></table></figure>

<h3 id="配置脚本"><a href="#配置脚本" class="headerlink" title="配置脚本"></a>配置脚本</h3><p>然后添加运行脚本：</p>
<img src="/posts/7987/image-20201119114158207.png" class="" title="image-20201119114158207">

<p>添加好之后 <code>CMD + B</code> or <code>CMD + R</code> 编译运行时就能自动格式化代码了，赞！</p>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Xcode</tag>
      </tags>
  </entry>
  <entry>
    <title>animation动画（一）</title>
    <url>/posts/57136/</url>
    <content><![CDATA[<h2 id="传送门"><a href="#传送门" class="headerlink" title="传送门"></a>传送门</h2><ul>
<li><a href="https://evestorm.github.io/posts/31280/">animation动画（一）</a></li>
<li><a href="https://evestorm.github.io/posts/20298/">animation动画（二）</a></li>
</ul>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p>CSS Animations 是CSS的一个模块，它定义了如何用关键帧来随时间推移对CSS属性的值进行动画处理。关键帧动画的行为可以通过指定它们的持续时间，它们的重复次数以及它们如何重复来控制。</p>
</blockquote>
<p>———— 出自 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Animations">CSS Animations | MDN</a></p>
<a id="more"></a>

<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 简写 */</span></span><br><span class="line"><span class="selector-tag">animation</span>: 动画名称，一个周期所花费的时间，运动曲线（默认<span class="selector-tag">ease</span>），</span><br><span class="line">           动画延迟（默认0），播放次数（默认1），</span><br><span class="line">           是否反向播放动画（默认<span class="selector-tag">normal</span>），是否暂停动画（默认<span class="selector-tag">running</span>）</span><br></pre></td></tr></table></figure>

<p>就像在介绍中写到的那样，整个 animations 是个模块，包含很多属性来定义动画，比方说 <code>animation-name</code> 、<code>animation-duration</code> 和 <code>animation-delay</code> 等等。但本着快速上手的目的，第一篇文章主要围绕 <code>animation</code> 这个简写属性来讲，因为用它最直观，而且就经验来讲，日常使用最多的也是这个属性。</p>
<h2 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h2><p>一个CSS3动画由两个基本项组成：</p>
<ol>
<li>关键帧（Keyforames） - 用来定义动画的阶段和样式。</li>
<li>动画属性 - 分配关键帧（@keyframes）到一个特定的css元素，来定义它的动画方式。</li>
</ol>
<p>我们围绕这两项讨论，并在这个过程中实现一个按钮不断放大缩小的动画效果：</p>
<img src="/posts/57136/shrink.gif" class="" title="shrink">

<h3 id="keyframes"><a href="#keyframes" class="headerlink" title="keyframes"></a>keyframes</h3><p>关键帧 keyframes 定义了动画在每个阶段的动画效果。它包括：</p>
<ul>
<li>动画名称：定义动画的名称</li>
<li>动画阶段：整个动画阶段用百分比来表示。0% 表示动画的开始状态。100% 表示动画的结束状态。可以在其间添加多个中间状态，比如 20%，60%…</li>
<li>动画属性：给动画每个阶段定义的CSS属性</li>
</ul>
<p>现在我们来编写一段 @keyframes 。动画名称命名为 <code>shrink</code> 。它只有简单的两个阶段：</p>
<ul>
<li>第一阶段（0%）：元素的缩放比例为 1:1</li>
<li>第二阶段（100%）：元素的缩放比例为 1:0.8</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> shrink &#123;</span><br><span class="line">  0% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(<span class="number">0.8</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">0.8</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="动画属性"><a href="#动画属性" class="headerlink" title="动画属性"></a>动画属性</h3><p>接着，我们给要设置动画的元素添加上动画属性。要使动画生效，我们至少要添加以下两个动画属性：</p>
<ul>
<li>animation-name: 动画的名称，在 @keyframes 中定义。</li>
<li>animation-duration: 动画的持续时间，以秒为单位（例如 5s）或毫秒（例如 200ms）。</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="comment">/*  其他样式  */</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">/*  动画名称: shrink  */</span></span><br><span class="line">  <span class="selector-tag">animation-name</span>: <span class="selector-tag">shrink</span>;</span><br><span class="line">  <span class="comment">/*  动画持续时间: 0.5秒 */</span></span><br><span class="line">  <span class="selector-tag">animation-duration</span>: .5<span class="selector-tag">s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样我们就实现页面加载后，一个按钮从开始的原始大小，经过0.5s后变成了原始大小的0.8的动画效果。然而我们希望最终的效果是一个按钮的不断放大和缩小，交替进行。这就得添加 <code>animation-iteration-count</code> 和 <code>animation-direction</code> 两个动画属性了，它们一个用来定义元素动画的循环次数，一个用来定义动画在循环过程中是否反向运动：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">/*  动画的循环次数: 无限次  */</span></span><br><span class="line">  <span class="selector-tag">animation-iteration-count</span>: <span class="selector-tag">infinite</span>;</span><br><span class="line">  <span class="comment">/*  循环是否反向：先正向后反向  */</span></span><br><span class="line">  <span class="selector-tag">animation-direction</span>: <span class="selector-tag">alternate</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终的简写形式如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="selector-tag">animation</span>: <span class="selector-tag">shrink</span> .5<span class="selector-tag">s</span> <span class="selector-tag">linear</span> <span class="selector-tag">alternate</span> <span class="selector-tag">infinite</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完整效果：</p>
<iframe height="265" scrolling="no" title="animation-shrink" src="https://codepen.io/JingW/embed/MRaJrz/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="资源-📚"><a href="#资源-📚" class="headerlink" title="资源 📚"></a>资源 📚</h2><ul>
<li><p>animation | 一个CSS3动画库</p>
<p>【推荐】</p>
<ul>
<li><a href="https://daneden.github.io/animate.css/">点我查看效果</a></li>
</ul>
</li>
<li><p>magic | 另一个CSS3动画库</p>
<ul>
<li><a href="https://www.minimamente.com/example/magic_animations/">点我查看效果</a></li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS3</tag>
      </tags>
  </entry>
  <entry>
    <title>animation动画（二）</title>
    <url>/posts/20298/</url>
    <content><![CDATA[<h2 id="传送门"><a href="#传送门" class="headerlink" title="传送门"></a>传送门</h2><ul>
<li><a href="https://evestorm.github.io/posts/31280/">animation动画（一）</a></li>
<li><a href="https://evestorm.github.io/posts/20298/">animation动画（二）</a></li>
</ul>
<p>老规矩，二系列来谈谈具体每个动画属性的含义和用法，算是一个对知识点的总结吧。</p>
<h2 id="animation-name-动画名称"><a href="#animation-name-动画名称" class="headerlink" title="animation-name 动画名称"></a>animation-name 动画名称</h2><p>CSS语法：<code>animation-name: shrink</code></p>
<p>用来设置元素的动画名称。</p>
<a id="more"></a>

<h2 id="animation-duration-持续时间"><a href="#animation-duration-持续时间" class="headerlink" title="animation-duration 持续时间"></a>animation-duration 持续时间</h2><p>CSS语法：<code>animation-duration: 1s</code></p>
<p>用来指定动画在一个周期内所花费的时间。</p>
<h2 id="animation-timing-function-运动曲线"><a href="#animation-timing-function-运动曲线" class="headerlink" title="animation-timing-function 运动曲线"></a>animation-timing-function 运动曲线</h2><p>CSS语法：<code>animation-timing-function: ease-in-out</code></p>
<p>用来设置元素的动画速度曲线，它的用法和 <a href="https://evestorm.github.io/posts/13167/#transition-timing-function-%E6%95%88%E6%9E%9C%E6%9B%B2%E7%BA%BF">transition-timing-function</a> 类似，想要了解详情的直接点这个链接吧。</p>
<blockquote>
<p>DEMO</p>
</blockquote>
<iframe height="521" scrolling="no" title="animation-timing-function" src="https://codepen.io/JingW/embed/qwbVgB/?height=521&amp;theme-id=0&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="animation-delay-动画延迟"><a href="#animation-delay-动画延迟" class="headerlink" title="animation-delay 动画延迟"></a>animation-delay 动画延迟</h2><p>CSS语法：<code>animation-delay: 1s</code></p>
<p>用来设置动画延迟多少秒/毫秒后才开始执行。正值（例如2s）将在2s后启动动画；负值（例如-2s）将立即执行动画，但是动画会从它的动画序列中的第2s位置处立即开始。</p>
<h2 id="animation-iteration-count-循环次数"><a href="#animation-iteration-count-循环次数" class="headerlink" title="animation-iteration-count 循环次数"></a>animation-iteration-count 循环次数</h2><p>CSS语法：<code>animation-iteration-count: 1s</code></p>
<p>用来设置动画循环的次数，默认值是1，表示动画只播放一次。除了使用正整数来设置次数外，还可以将值设置为 <code>infinite</code> ，表示无限循环。</p>
<h2 id="animation-direction-是否反向"><a href="#animation-direction-是否反向" class="headerlink" title="animation-direction 是否反向"></a>animation-direction 是否反向</h2><p>CSS语法：<code>animation-direction: normal | reverse | alternate | alternate-reverse</code></p>
<p>用来设置动画在循环过程中是否反向运动，默认值为 <code>normal</code> ，即正常模式，动画会从第一帧播放到最后一帧；<code>reverse</code> 表示反向模式，动画会从最后一帧倒着播放到第一帧；<code>alternate</code> 设置动画先正向播放，第二次再从反向播放，交替进行，例如 animation 系列一中的案例；<code>alternate-reverse</code> 则是先让动画反向播放，第二次再正向播放，交替进行。</p>
<h2 id="animation-fill-mode-动画填充模式"><a href="#animation-fill-mode-动画填充模式" class="headerlink" title="animation-fill-mode 动画填充模式"></a>animation-fill-mode 动画填充模式</h2><p>CSS语法：<code>animation-fill-mode: none | forwards | backwards | both</code></p>
<p>用来指定在动画执行之前和之后如何给动画的目标应用样式。这个属性在我第一次接触时没太理解，直到我看了 <a href="https://segmentfault.com/">segmentfault</a> 上的 <a href="https://segmentfault.com/q/1010000003867335">这篇文章</a> 。</p>
<p>在理解它之前，我们需要在脑海里有个概念，那就是一个动画是分为初始状态、等待期、动画执行期、完成期四个阶段的。而上面 animation-fill-mode 接收的四个值则分别对应：</p>
<ul>
<li>none 表示 等待期和完成期，元素样式都为初始状态样式，不受动画定义（@keyframes）的影响</li>
<li>forwards 表示等待期保持初始样式，完成期间保持最后一帧样式</li>
<li>backwards 表示等待期为第一帧样式，完成期跳转为初始样式</li>
<li>both 表示 等待期样式为第一帧样式，完成期保持最后一帧样式</li>
</ul>
<p>单纯的文字不直观？相信下面的这个demo能让你豁然开朗：</p>
<iframe height="435" scrolling="no" title="animation-fill-mode" src="https://codepen.io/JingW/embed/qwNLJE/?height=435&amp;theme-id=0&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="animation-play-state-动画播放状态"><a href="#animation-play-state-动画播放状态" class="headerlink" title="animation-play-state 动画播放状态"></a>animation-play-state 动画播放状态</h2><p>CSS语法：<code>animation-play-state: running | paused</code></p>
<p>用来设置动画的播放或者暂停。比如希望在鼠标经过的时候，让动画先停止下来，鼠标移开之后再继续播放，就可以通过设置 <code>.element:hover &#123; animation-play-state: paused; &#125;</code> 来实现。下面是一个案例，在鼠标移入时钟后指针暂停旋转；移出后时钟继续旋转。</p>
<iframe height="339" scrolling="no" title="animation-play-state闹钟示例" src="https://codepen.io/JingW/embed/rbMWjB/?height=339&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS3</tag>
      </tags>
  </entry>
  <entry>
    <title>chrome修改滚动条样式</title>
    <url>/posts/63768/</url>
    <content><![CDATA[<h2 id="修改滚动条样式"><a href="#修改滚动条样式" class="headerlink" title="修改滚动条样式"></a>修改滚动条样式</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*css主要部分的样式*/</span></span><br><span class="line"><span class="comment">/*定义滚动条宽高及背景，宽高分别对应横竖滚动条的尺寸*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">20px</span>; <span class="comment">/*对垂直流动条有效*/</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>; <span class="comment">/*对水平流动条有效*/</span></span><br><span class="line">  <span class="attribute">display</span>: none; <span class="comment">/* 隐藏滚动条 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*定义滚动条的轨道颜色、内阴影及圆角*/</span></span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-track</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-box-shadow</span>: inset <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.3</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">246</span>, <span class="number">214</span>, <span class="number">214</span>);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*定义滑块颜色、内阴影及圆角*/</span></span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-thumb</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">7px</span>;</span><br><span class="line">  <span class="attribute">-webkit-box-shadow</span>: inset <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.3</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f50e0e</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*定义两端按钮的样式 */</span></span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-button</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*定义右下角汇合处的样式*/</span></span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-corner</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgb</span>(<span class="number">252</span>, <span class="number">227</span>, <span class="number">7</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="隐藏滚动条"><a href="#隐藏滚动条" class="headerlink" title="隐藏滚动条"></a>隐藏滚动条</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">::-webkit-scrollbar</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>CSS</tag>
        <tag>chrome</tag>
      </tags>
  </entry>
  <entry>
    <title>cnchar.js获取汉字的拼音</title>
    <url>/posts/38408/</url>
    <content><![CDATA[<p>分享一个获取汉字拼音的库：</p>
<p><a href="https://github.com/theajack/cnchar">https://github.com/theajack/cnchar</a></p>
<p>几种常用方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">array:返回数组；<span class="string">&quot;汉字&quot;</span>.spell(<span class="string">&quot;array&quot;</span>) =&gt;[<span class="string">&#x27;Han&#x27;</span>,<span class="string">&#x27;Zi&#x27;</span>]</span><br><span class="line"></span><br><span class="line">first:返回首字母 ；<span class="string">&quot;汉字&quot;</span>.spell(<span class="string">&quot;first&quot;</span>) =&gt;<span class="string">&#x27;HZ&#x27;</span></span><br><span class="line"></span><br><span class="line">up:将结果全部大写；<span class="string">&quot;汉字&quot;</span>.spell(<span class="string">&quot;up&quot;</span>) =&gt;<span class="string">&#x27;HANZI&#x27;</span></span><br><span class="line"></span><br><span class="line">low:将结果全部小写；<span class="string">&quot;汉字&quot;</span>.spell(<span class="string">&quot;low&quot;</span>) =&gt;<span class="string">&#x27;hanzi&#x27;</span></span><br><span class="line"></span><br><span class="line">组合使用：<span class="string">&quot;汉字&quot;</span>.spell(<span class="string">&quot;first&quot;</span>,<span class="string">&quot;array&quot;</span>,<span class="string">&#x27;low&#x27;</span>) =&gt;[<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;z&#x27;</span>]</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>解决方案</category>
      </categories>
      <tags>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>css扩大元素点击区域</title>
    <url>/posts/1303/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>项目中遇到使用滑动条的地方，但设计稿上的按钮面积非常小，用户在手机上由于不容易精确触摸到按钮导致拖动滚动条困难：</p>
<img src="/posts/1303/%E6%BB%91%E5%8A%A8%E6%9D%A1.png" class="" title="滑动条设计稿截图">

<a id="more"></a>

<p>所以就想着扩大按钮的点击区域。通常情况下想要扩大点击区域有两种方案：</p>
<ul>
<li>增加 border</li>
<li>添加 padding</li>
</ul>
<p>然而由于此滑动条使用的是三方库，圆形按钮的位置使用的是绝对定位，不太好改它本身的大小，因为这样要调整的 css 样式太多。所以上面两种方案都被毙掉了，最后 Google 到下面方案。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p><strong>使用伪元素扩大可点击区域</strong></p>
<p>伪元素能为其父元素捕获鼠标交互动作，因此，只需通过伪元素扩大父元素的空间大小，就能扩大可点击区域。</p>
<p>代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;extend-via-pseudo-elem&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">.extend-via-pseudo-elem &#123; position: relative; &#125; .extend-via-pseudo-elem::before</span><br><span class="line">&#123; content: &#x27;&#x27;; position: absolute; top: -20px; right: -20px; bottom: -20px;</span><br><span class="line">left: -20px; &#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>cookie与session区别</title>
    <url>/posts/63891/</url>
    <content><![CDATA[<h2 id="保存状态"><a href="#保存状态" class="headerlink" title="保存状态"></a>保存状态</h2><p>cookie 是通过在客户端记录信息确定用户身份的，而 session 则通过在服务器端记录信息来确定用户身份。下面是网上找到的两张图，能够对 cookie 以及 session 在客户端与服务端传递的过程有个较清晰的认识：</p>
<img src="/posts/63891/1550245038963-b61378bb-65db-411e-9069-cf7d2b7a2908-20201119143043224.png" class="" title="cookie">

<img src="/posts/63891/1550245194054-9e6b0a42-c09e-4a8b-8e7e-93ba715e6e5a-20201119143043424.png" class="" title="session">

<a id="more"></a>

<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><p>cookie机制：</p>
<ul>
<li>默认情况下，cookie 保存在内存中，<strong>浏览器关闭</strong>就没了；设置过期时间后，cookie 保存在硬盘上，关闭浏览器仍然存在，直到过期时间结束才消失。</li>
<li>cookie 以<strong>文本形式</strong>保存在客户端，每次请求时都带上它。</li>
</ul>
<p>session机制：</p>
<ul>
<li>每次请求，服务器会检查是否有 sessionid<ul>
<li>有，服务器根据 id 返回对应 session 对象</li>
<li>无，服务器创建新的 session 对象，并把 sessionid 在本次响应中返回给客户端。</li>
</ul>
</li>
<li>通常使用 cookie 方式存储 sessionid 到客户端<ul>
<li>用户禁用 cookie 时，则服务端可以使用URL重写，可以通过 response.encodeURL(url) 进行实现</li>
</ul>
</li>
</ul>
<h2 id="存储方式"><a href="#存储方式" class="headerlink" title="存储方式"></a>存储方式</h2><ul>
<li>cookie 只能保存字符串类型，以文本的方式</li>
<li>session 能支持任何类型的对象</li>
</ul>
<h2 id="存储大小"><a href="#存储大小" class="headerlink" title="存储大小"></a>存储大小</h2><ul>
<li>cookie单个不超过4kb</li>
<li>session没限制</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
  </entry>
  <entry>
    <title>element-ui全屏select下拉框不显示下拉列表的问题</title>
    <url>/posts/35961/</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>项目中需要用到页面全屏功能，使用后发现 element-ui 的 select 组件无法显示下拉列表。</p>
<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>element-ui 默认将弹出框插入到了 <code>body</code> 元素。当设置了某个元素全屏时，会遮挡住原来的 <code>select</code> 下拉数据。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>查看 <a href="https://element.eleme.io/#/zh-CN/component/select#select-attributes">官网文档</a> 发现可以对 <code>el-select</code> 组件设置 <code>popper-append-to-body</code> 属性：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-select</span> <span class="attr">:popper-append-to-body</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>设置为 false 后，弹出框就不会插入到 body 元素下了。</p>
<h2 id="全屏插件"><a href="#全屏插件" class="headerlink" title="全屏插件"></a>全屏插件</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i screenfull</span><br></pre></td></tr></table></figure>

<p>设置某个元素全屏：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> element = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">screenfull.toggle(element);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>UI</category>
        <category>element-ui</category>
      </categories>
      <tags>
        <tag>element-ui</tag>
      </tags>
  </entry>
  <entry>
    <title>element-ui表单验证切换国际化后失效解决方案</title>
    <url>/posts/42521/</url>
    <content><![CDATA[<p>转载自：<a href="https://www.cnblogs.com/listen9436/p/10644527.html">https://www.cnblogs.com/listen9436/p/10644527.html</a></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;el-form</span><br><span class="line">  :model=&quot;ruleForm&quot;</span><br><span class="line">  :rules=&quot;rules&quot;</span><br><span class="line">  ref=&quot;ruleForm&quot;</span><br><span class="line">  label-width=&quot;100px&quot;</span><br><span class="line">  labelPosition=&quot;top&quot;</span><br><span class="line">  :inline=&quot;true&quot;</span><br><span class="line">  class=&quot;demo-ruleForm&quot;</span><br><span class="line">&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">:gutter</span>=<span class="string">&quot;59&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">:label</span>=<span class="string">&quot;$t(&#x27;joinUs.surname&#x27;)&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;surname&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">class</span>=<span class="string">&quot;edit-input&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;ruleForm.surname&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">:label</span>=<span class="string">&quot;$t(&#x27;joinUs.givenName&#x27;)&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;givenName&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">class</span>=<span class="string">&quot;edit-input&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;ruleForm.givenName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">:gutter</span>=<span class="string">&quot;59&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">:label</span>=<span class="string">&quot;$t(&#x27;joinUs.email&#x27;)&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;email&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">class</span>=<span class="string">&quot;edit-input&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;ruleForm.email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">:label</span>=<span class="string">&quot;$t(&#x27;joinUs.phone&#x27;)&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;phoneNumber&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">class</span>=<span class="string">&quot;edit-tel&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">class</span>=<span class="string">&quot;edit-tel1&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;phone1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">class</span>=<span class="string">&quot;line&quot;</span> <span class="attr">:span</span>=<span class="string">&quot;2&quot;</span>&gt;</span>—<span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;14&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">class</span>=<span class="string">&quot;edit-tel2&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;phone2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>需求：<br>必填：</p>
<p>surname givenName email phoneNumber</p>
<p>正则：</p>
<p>surname 只允许输入英文<br>givenName 只允许输入中文<br>phoneNumber 只允许输入 1-20 个数字，<br>email 邮箱</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ruleForm: &#123;</span><br><span class="line">      surname: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      givenName: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      email: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      phoneNumber: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    phone1: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    phone2: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于国际化问题，切换时在 data 中不起作用，需要将表达式放到 computed 属性中</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  rules () &#123;</span><br><span class="line">    <span class="keyword">var</span> validateSurnmae = <span class="function">(<span class="params">rule, value, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> reg = <span class="regexp">/^[A-Za-z]+$/</span></span><br><span class="line">      <span class="keyword">if</span> (!reg.test(value)) &#123;</span><br><span class="line">        callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="built_in">this</span>.$t(<span class="string">&#x27;joinUs.surnameErr3&#x27;</span>)))</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        callback()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> validateGivenName = <span class="function">(<span class="params">rule, value, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> reg = <span class="regexp">/^[\u4e00-\u9fa5]+$/</span></span><br><span class="line">      <span class="keyword">if</span> (!reg.test(value)) &#123;</span><br><span class="line">        callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="built_in">this</span>.$t(<span class="string">&#x27;joinUs.givenNameErr3&#x27;</span>)))</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        callback()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      surname: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="built_in">this</span>.$t(<span class="string">&#x27;joinUs.surnameErr1&#x27;</span>), <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">validator</span>: validateSurnmae, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">min</span>: <span class="number">1</span>, <span class="attr">max</span>: <span class="number">20</span>, <span class="attr">message</span>: <span class="built_in">this</span>.$t(<span class="string">&#x27;joinUs.surnameErr2&#x27;</span>), <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;</span><br><span class="line">      ],</span><br><span class="line">      givenName: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="built_in">this</span>.$t(<span class="string">&#x27;joinUs.givenNameErr1&#x27;</span>), <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">validator</span>: validateGivenName, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">min</span>: <span class="number">1</span>, <span class="attr">max</span>: <span class="number">20</span>, <span class="attr">message</span>: <span class="built_in">this</span>.$t(<span class="string">&#x27;joinUs.givenNameErr2&#x27;</span>), <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">      email: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="built_in">this</span>.$t(<span class="string">&#x27;joinUs.emailError&#x27;</span>), <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">&quot;email&quot;</span>,</span><br><span class="line">          message: <span class="built_in">this</span>.$t(<span class="string">&#x27;joinUs.emailError&#x27;</span>),</span><br><span class="line">          trigger: [<span class="string">&quot;blur&quot;</span>, <span class="string">&quot;change&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      phoneNumber: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="built_in">this</span>.$t(<span class="string">&#x27;joinUs.phoneNumberError1&#x27;</span>), <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;number&#x27;</span>, <span class="attr">message</span>: <span class="built_in">this</span>.$t(<span class="string">&#x27;joinUs.phoneNumberError2&#x27;</span>), <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>UI</category>
        <category>element-ui</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>element-ui</tag>
      </tags>
  </entry>
  <entry>
    <title>element设置表格表头行高样式</title>
    <url>/posts/63255/</url>
    <content><![CDATA[<p>element-ui 设置表头地址：<a href="https://element.eleme.io/#/zh-CN/component/table#table-attributes">https://element.eleme.io/#/zh-CN/component/table#table-attributes</a></p>
<ul>
<li>max-height Table 的最大高度。合法的值为数字或者单位为 px 的高度。</li>
<li>header-row-style 表头行的 style</li>
<li>header-cell-style 表头单元格的 style</li>
<li>row-style 行的 style</li>
<li>cell-style 单元格的 style</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;el-table</span><br><span class="line">  :max-height=&quot;196&quot;</span><br><span class="line">  :header-row-style=&quot;&#123;height: &#x27;46px&#x27;&#125;&quot;</span><br><span class="line">  :header-cell-style=&quot;&#123;height: &#x27;46px&#x27;&#125;&quot;</span><br><span class="line">  :row-style=&quot;&#123;height: &#x27;50px&#x27;&#125;&quot;</span><br><span class="line">  :cell-style=&quot;&#123;height: &#x27;50px&#x27;&#125;&quot;</span><br><span class="line">  stripe</span><br><span class="line">&gt;</span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>UI</category>
        <category>element-ui</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>element-ui</tag>
      </tags>
  </entry>
  <entry>
    <title>flex布局中，保持内容不超出容器的解决办法</title>
    <url>/posts/3930/</url>
    <content><![CDATA[<p>在移动端，flex 布局很好用，它能够根据设备宽度来自动调整容器的宽度，用起来很方便，已经越来越离不开它，但是最近在做项目的时候发现一个问题。</p>
<a id="more"></a>

<p>就是在一个设置了 flex:1 的容器中，如果文字很长，这时候文字就会超出容器，而不是呆在设置好的动态剩余的空间中。由于实际项目的比较复杂，不好拿出来说，这里就把问题简化描述如下：</p>
<p>大致是有一个 main 容器是 flex 布局，左边一个 logo 固定宽高，右边 content 动态宽度。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span> <span class="attr">src</span>=<span class="string">&quot;pic.jpg&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>a name<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span>a info<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;notice&quot;</span>&gt;</span>This is notice content.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">.main &#123; display: flex; &#125; .logo &#123; width: 100px; height: 100px; margin: 10px; &#125;</span><br><span class="line">.content &#123; flex: 1; &#125; .content &gt; * &#123; white-space: nowrap; overflow: hidden;</span><br><span class="line">text-overflow: ellipsis; &#125;12345678910111213141516</span><br></pre></td></tr></table></figure>

<p>.notice 可能会非常长，一些设备下需要隐藏显示，即不换行，并留下省略符…作标记。<br>这里会发现 text-overflow: ellipsis 不生效，省略符根本没有出现。而且因为设置了 nowrap 会发现文字会将 content 撑开，导致内容超出了屏幕。所以必须要解决这个问题。</p>
<blockquote>
<p>尝试取消父元素.content 的 flex: 1，无效。<br>尝试取消.main 容器的 display: flex，省略号出现。</p>
</blockquote>
<p>因此猜测是 flex 布局的问题，进一步猜测省略符需要对父元素限定宽度。<br>尝试对父元素.content 设置 width: 100%无效，但是设置 width: 0 可行。即：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果不设置宽度，.content 可以被子节点无限撑开；因此.notice 总有足够的宽度在一行内显示所有文本，也就不能触发截断省略的效果。测试还有一种方法可以达到效果：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden；;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的二种方法都可以达到我们需要的效果，即给 content 设置了 flex 为 1 的时候，它会动态的获得父容器的剩余宽度，且不会被自己的子元素把内容撑开。</p>
<p>经过测试，以下的方法是无效的：</p>
<blockquote>
<p>给 html, body 设置 max-width，元素似乎能强行撑开页宽；<br>给 body 设置 overflow，页宽不能被撑开了，但元素宽度还在，即元素本身还是溢出；<br>给 html, body 同时设置 max-width 和 overflow，页宽限定在 max-width 内，元素本身还是溢出；<br>给.main 容器设置 overflow: hidden，同理.main 是不溢出了，.notice 本身还是溢出；<br>给.notice 元素设置 width 或 max-width，虽然宽度受限，但在特定宽度下省略符…显示不全，有时只显示两个点..</p>
</blockquote>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
        <category>Flex</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>flex</tag>
      </tags>
  </entry>
  <entry>
    <title>git提交代码到错误的远端分支如何撤回并提交到正确分支</title>
    <url>/posts/61419/</url>
    <content><![CDATA[<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>假如你要提交代码到 bug 分支，然而却忘了切分支，仍然在 dev 开发分支上改了 bug，而且已经推送到远端了。此时你该如何撤回远端在 dev 分支的修改，并把代码推送到正确的远端 bug 分支上呢？</p>
<p>你可以执行下面操作：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 切换到你提交了错误代码的分支</span></span><br><span class="line">git checkout dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> 撤销最近的一次提交</span></span><br><span class="line">git revert HEAD --no-edit</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将revert commit push到远端</span></span><br><span class="line">git push origin dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到正确的分支</span></span><br><span class="line">git checkout bug</span><br><span class="line">将目标 commit 嫁接到当前分支</span><br><span class="line">git cherry-pick db6bb3f &lt;=你之前提交到错误分支的那个commit的SHA</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://zhuanlan.zhihu.com/p/42929114">Git 误操作救命篇一： 如何将改动撤销？</a></p>
]]></content>
      <categories>
        <category>工具</category>
        <category>版本控制</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS13.4+版本h5拍照图片旋转问题的解决方案</title>
    <url>/posts/13740/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>前几天刚解决完 Safari 上 h5 拍照会旋转 90 度的问题，今天更新完苹果系统后（13.4 ——&gt; 13.6），突然发现图片又旋转了。前几天不刚测完是好的么，怎么又出问题了。拿公司测试机 12.6 版本测试了下发现没毛病，就基本定位到问题所在了：iOS13.4+版本可能都存在此问题。</p>
<p>然后就是打断点调试，发现新系统下图片的 <code>Orientation</code> 仍然为 6 ，但其实照片（竖着拍）已经被苹果自动旋转回来了。然后我的代码中针对 6 的情况向右旋转了 90 度，这才导致图片又旋转回去了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span> (Orientation) &#123;</span><br><span class="line">   <span class="keyword">case</span> <span class="number">6</span>: <span class="comment">//需要顺时针（向右）90度旋转</span></span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="判断系统版本"><a href="#判断系统版本" class="headerlink" title="判断系统版本"></a>判断系统版本</h3><p>既然是 iOS 系统版本问题，那么最粗暴的方案就是对系统进行判断，如果高于 13.4，就不去旋转。具体封装的方法代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 判断是IOS13.4以上的系统 13.4以上返回true</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>file 文件资源</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="function"><span class="title">detectImageAutomaticRotation</span>(<span class="params">file</span>)</span> &#123;</span><br><span class="line">   <span class="keyword">let</span> u = navigator.userAgent,</span><br><span class="line">      app = navigator.appVersion;</span><br><span class="line">   <span class="keyword">let</span> isAndroid = u.indexOf(<span class="string">&#x27;Android&#x27;</span>) &gt; -<span class="number">1</span> || u.indexOf(<span class="string">&#x27;Linux&#x27;</span>) &gt; -<span class="number">1</span>; <span class="comment">//g</span></span><br><span class="line">   <span class="keyword">let</span> isIOS = !!u.match(<span class="regexp">/\(i[^;]+;( U;)? CPU.+Mac OS X/</span>); <span class="comment">//ios终端</span></span><br><span class="line">   <span class="keyword">if</span> (isIOS) &#123;</span><br><span class="line">      <span class="keyword">let</span> ver = (navigator.appVersion).match(<span class="regexp">/OS (\d+)_(\d+)_?(\d+)?/</span>);</span><br><span class="line">      <span class="keyword">let</span> ver1 = <span class="built_in">parseInt</span>(ver[<span class="number">1</span>])</span><br><span class="line">      <span class="keyword">let</span> ver2 = <span class="built_in">parseInt</span>(ver[<span class="number">2</span>])</span><br><span class="line">      <span class="keyword">if</span> (ver1 &gt;= <span class="number">13</span> &amp;&amp; ver2 &gt;= <span class="number">4</span>) &#123;</span><br><span class="line">         <span class="comment">// if (file.name == &#x27;image.jpg&#x27;) &#123; //判断是拍照上传的还是相册选取的，IOS拍完照还没有确定的时候，图片的名字统一都是image.jpg</span></span><br><span class="line">         <span class="comment">//    return true</span></span><br><span class="line">         <span class="comment">// &#125;</span></span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>但这个方案有个小的隐患，就是我们无法预知今后苹果是否会把这个“自我修正”行为改回去，一旦有这种情况，我们还要重新变动代码，略显麻烦。</p>
<h3 id="用一张特殊的图片来检测当前浏览器是否对带-EXIF-信息的图片进行回正"><a href="#用一张特殊的图片来检测当前浏览器是否对带-EXIF-信息的图片进行回正" class="headerlink" title="用一张特殊的图片来检测当前浏览器是否对带 EXIF 信息的图片进行回正"></a>用一张特殊的图片来检测当前浏览器是否对带 EXIF 信息的图片进行回正</h3><p>这是网上找到的一种方案，思路就是用一张「 2x1 的 JPEG 且 EXIF Orientation 为 6」的图片来检测当前浏览器是否对带 EXIF 信息的图片进行回正，如果图片变成 1x2，说明浏览器对图片进行了回正。具体代码见下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 用一张特殊的图片来检测当前浏览器是否对带 EXIF 信息的图片进行回正</span></span><br><span class="line"><span class="comment">// 方法来源: https://github.com/blueimp/JavaScript-Load-Image</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 一张 2x1 的 JPEG 图片, EXIF Orientation: 6</span></span><br><span class="line"><span class="keyword">const</span> testAutoOrientationImageURL =</span><br><span class="line">  <span class="string">&#x27;data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAA&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;AAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQE&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/x&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;ABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAA&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;AAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> isImageAutomaticRotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">detectImageAutomaticRotation</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isImageAutomaticRotation === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> img = <span class="keyword">new</span> Image();</span><br><span class="line"></span><br><span class="line">      img.onload = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 如果图片变成 1x2，说明浏览器对图片进行了回正</span></span><br><span class="line">        isImageAutomaticRotation = img.width === <span class="number">1</span> &amp;&amp; img.height === <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        resolve(isImageAutomaticRotation);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      img.src = testAutoOrientationImageURL;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resolve(isImageAutomaticRotation);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://juejin.im/post/6844904162220572686">关于 iOS 13.4.1 后照片在浏览器中旋转的兼容性处理</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>移动端</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>兼容性</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS上input输入内容拦腰截断</title>
    <url>/posts/40889/</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>在 ios 上 input 输入框只显示一半高度的字:</p>
<img src="/posts/40889/input-error.jpeg" class="" title="input输入内容只显示了一半">

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>固定 input 输入框的高度，把 input 输入框写死高度:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* uniapp 写法，非 uniapp 项目给 input 添加固定高度即可 */</span></span><br><span class="line"><span class="selector-tag">uni-input</span> /<span class="selector-tag">deep</span>/ <span class="selector-class">.uni-input-form</span> &#123;</span><br><span class="line">  .uni-input-input &#123;</span><br><span class="line">    <span class="selector-tag">height</span>: 50<span class="selector-tag">rpx</span> !<span class="selector-tag">important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/40889/input-suc.jpeg" class="" title="解决">
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS启动页图片无法全屏显示</title>
    <url>/posts/58404/</url>
    <content><![CDATA[<p>在 Xcode 中设置启动页图片发现上下 Safe Area 区域图片没能填满：</p>
<img src="/posts/58404/safearea.png" class="" title="安全区域未填满">

<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>设置相应约束的 FirstItem ，改 <code>Safe Area</code> 为 <code>SuperView</code> ：</p>
<img src="/posts/58404/safearea2superview.png" class="" title="安全区域未填满">

<h2 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h2><img src="/posts/58404/superview.png" class="" title="安全区域未填满">
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>Xcode</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS微信端字体图标iconfont显示不正常</title>
    <url>/posts/5764/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>iOS 中微信端打开项目发现图标显示成一个个方框；切换页面也同样没显示。但是在 Android 端、IOS 的浏览器显示正常。</p>
<p>备注：刷新页面后能正常显示。</p>
<h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h2><p>iOS 微信端的缓存机制引起的。</p>
<blockquote>
<p>具体原因：刚进入页面会检测微信环境的话会发生一次跳转（获取微信用户信息）,在未跳转前，浏览器正在下载图标文件；而跳转使得<br>这些文件下载终止导致不完整。再跳转后想下载这些文件但因为浏览器缓存机制问题所以复用那些不完整的文件。</p>
</blockquote>
<h2 id="解決方案"><a href="#解決方案" class="headerlink" title="解決方案"></a>解決方案</h2><ol>
<li>微信登录不跳转，由后台静默完成（推荐）；</li>
<li><code>window.onload()</code> 方法中执行跳转，因为此时文件都下载完毕</li>
<li>延迟跳转（在用）</li>
<li>登录完成之后再动态加载字体文件（我使用的方案）</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">login().then(<span class="function"><span class="params">params</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// wx wxReady</span></span><br><span class="line">  <span class="keyword">let</span> iconfont_link = <span class="built_in">document</span>.createElement(<span class="string">&#x27;link);</span></span><br><span class="line"><span class="string">  iconfont_link.setAttribute(&#x27;</span>rel<span class="string">&#x27;, &#x27;</span>stylesheet<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">  iconfont_link.setAttribute(&#x27;</span>href<span class="string">&#x27;, &#x27;</span><span class="comment">//at.alicdn.com/t/font_2275779_59uak70qieo.css&#x27;);</span></span><br><span class="line">  <span class="built_in">document</span>.head.appendChild(iconfont_link);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>移动端</category>
        <category>H5</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>解决方案</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS极光推送-初版</title>
    <url>/posts/15162/</url>
    <content><![CDATA[<h2 id="苹果证书设置"><a href="#苹果证书设置" class="headerlink" title="苹果证书设置"></a>苹果证书设置</h2><h3 id="开启-Push-Notification-功能"><a href="#开启-Push-Notification-功能" class="headerlink" title="开启 Push Notification 功能"></a>开启 Push Notification 功能</h3><p>找到你 App 的 id:</p>
<img src="/posts/15162/image-20200825132620154.png" class="" title="image-20200825132620154">

<p>开启消息推送：</p>
<img src="/posts/15162/image-20200825132503908.png" class="" title="image-20200825132503908">

<a id="more"></a>

<h3 id="配置消息推送"><a href="#配置消息推送" class="headerlink" title="配置消息推送"></a>配置消息推送</h3><img src="/posts/15162/image-20200825132714159.png" class="" title="image-20200825132714159">

<img src="/posts/15162/image-20200825132725279.png" class="" title="image-20200825132725279">

<p>点击 <code>Development SSL Certificate</code> 创建证书：</p>
<img src="/posts/15162/image-20200825132820152.png" class="" title="image-20200825132820152">

<p>上传 csr 文件点击继续：</p>
<img src="/posts/15162/image-20200825132921777.png" class="" title="image-20200825132921777">

<p>开发推送证书配置完毕：</p>
<img src="/posts/15162/image-20200825133009708.png" class="" title="image-20200825133009708">

<p>起个名字下载到本地:</p>
<img src="/posts/15162/image-20200825133126663.png" class="" title="image-20200825133126663">

<p>相同的步骤配置正式环境的推送证书：</p>
<img src="/posts/15162/image-20200825133233873.png" class="" title="image-20200825133233873">

<img src="/posts/15162/image-20200825133314393.png" class="" title="image-20200825133314393">

<p>两个证书配置完毕后的效果：</p>
<img src="/posts/15162/image-20200825133436324.png" class="" title="image-20200825133436324">

<p>分别双击两个证书，在“KeychainAccess”中打开，选择左侧“钥匙串”列表中“登录”，以及“种类”列表中“我的证书”，找到刚才下载的证书，并导出为 .p12 文件。</p>
<p>找到它并设置为总是信任：</p>
<img src="/posts/15162/image-20200825134055576.png" class="" title="image-20200825134055576">

<p>将其导出为 p12 文件：</p>
<img src="/posts/15162/image-20200825134141788.png" class="" title="image-20200825134141788">

<p>同样的方式为生产证书设置总是信任以及导出为 p12 证书。</p>
<h3 id="重新生成一遍-Profile-文件"><a href="#重新生成一遍-Profile-文件" class="headerlink" title="重新生成一遍 Profile 文件"></a>重新生成一遍 Profile 文件</h3><img src="/posts/15162/image-20200825133633752.png" class="" title="image-20200825133633752">

<h2 id="极光配置"><a href="#极光配置" class="headerlink" title="极光配置"></a>极光配置</h2><p>登录极光官网：</p>
<p><a href="https://www.jiguang.cn/">https://www.jiguang.cn/</a></p>
<p>认证开发者账号，此处省略。</p>
<p>进入开发者平台：</p>
<p><a href="https://www.jiguang.cn/dev2/#/newOverview?appKey=">https://www.jiguang.cn/dev2/#/newOverview?appKey=</a></p>
<h3 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h3><img src="/posts/15162/image-20200825135528626.png" class="" title="image-20200825135528626">

<p>填写应用名称以及上传图标：</p>
<img src="/posts/15162/image-20200825135536095.png" class="" title="image-20200825135536095">

<p>创建完毕后会自动跳转：</p>
<img src="/posts/15162/image-20200825135631804.png" class="" title="image-20200825135631804">

<p>进入推送设置：</p>
<img src="/posts/15162/image-20200825135710436.png" class="" title="image-20200825135710436">

<h3 id="iOS-证书配置"><a href="#iOS-证书配置" class="headerlink" title="iOS 证书配置"></a>iOS 证书配置</h3><img src="/posts/15162/image-20200825135731263.png" class="" title="image-20200825135731263">

<p>配置完毕后点击保存：</p>
<img src="/posts/15162/image-20200825141021644.png" class="" title="image-20200825141021644">

<img src="/posts/15162/image-20200825141047595.png" class="" title="image-20200825141047595">

<h2 id="导入极光-SDK"><a href="#导入极光-SDK" class="headerlink" title="导入极光 SDK"></a>导入极光 SDK</h2><p>在 Xcode 中通过 Cocoapods 的方式导入：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pod &#x27;JPush&#x27;, &#x27;3.3.4&#x27;</span><br></pre></td></tr></table></figure>

<p>通过 <code>pod update --no-repo-update</code> 进行 pods 更新。</p>
<h3 id="上架前提醒"><a href="#上架前提醒" class="headerlink" title="上架前提醒"></a>上架前提醒</h3><p>提交新版本或者初次上架之前，最后会遇到一个关于 IDFA 的选项。</p>
<blockquote>
<p>您的 App 正在使用广告标识符 (IDFA)。您必须先提供关于 IDFA 的使用信息或将其从 App 中移除，然后再上传您的二进制文件。</p>
</blockquote>
<p><strong>记得要勾上是</strong>。否则会遇到麻烦。</p>
<p>P.S. 如果你的项目不需要投送广告，可以选择无 IDFA 版本的极光 SDK，集成方式如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pod &#x27;JCore&#x27;, &#x27;2.3.4-noidfa&#x27;</span><br><span class="line">pod &#x27;JPush&#x27;, &#x27;3.3.4&#x27;</span><br></pre></td></tr></table></figure>

<p>配置推送：</p>
<p>我的 Xcode 版本为 11，所以要开启 Application Target 的 Capabilities-&gt; <code>Access WIFI Infomation</code> 选项。</p>
<img src="/posts/15162/image-20200825144319615.png" class="" title="image-20200825144319615">

<p>还有 <code>PushNotifications</code> ，以及打开 <code>Remote notifications</code> ：</p>
<img src="/posts/15162/image-20200825215627247.png" class="" title="image-20200825215627247">

<h3 id="创建桥接文件"><a href="#创建桥接文件" class="headerlink" title="创建桥接文件"></a>创建桥接文件</h3><blockquote>
<p>XXX_Bridging-Header.h （XXX 随便设置，一般用项目名大写字母）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*极光推送*/</span></span><br><span class="line">#<span class="keyword">import</span> &quot;JPUSHService.h&quot;</span><br><span class="line"><span class="comment">// iOS10注册APNs所需头文件</span></span><br><span class="line"><span class="comment">//#ifdef NSFoundationVersionNumber_iOS_9_x_Max</span></span><br><span class="line">#<span class="keyword">import</span> &lt;UserNotifications/UserNotifications.h&gt;</span><br></pre></td></tr></table></figure>

<h3 id="AppDelegate-swift-中编写极光相关代码"><a href="#AppDelegate-swift-中编写极光相关代码" class="headerlink" title="AppDelegate.swift 中编写极光相关代码"></a>AppDelegate.swift 中编写极光相关代码</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  AppDelegate.swift</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> UserNotifications <span class="comment">// 本地通知相关</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span>, <span class="title">JPUSHRegisterDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> window: <span class="type">UIWindow?</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="keyword">_</span>: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: <span class="keyword">Any</span>]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册极光推送</span></span><br><span class="line">        registerJPush(launchOptions: launchOptions)</span><br><span class="line"></span><br><span class="line">        window = <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">        window?.rootViewController = <span class="type">ViewController</span>()</span><br><span class="line">        window?.makeKeyAndVisible()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">applicationDidFinishLaunching</span><span class="params">(<span class="keyword">_</span>: UIApplication)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: 极光推送相关</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">registerJPush</span><span class="params">(launchOptions: [UIApplication.LaunchOptionsKey: <span class="keyword">Any</span>]?)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 注册极光推送</span></span><br><span class="line">        <span class="keyword">let</span> entiity = <span class="type">JPUSHRegisterEntity</span>()</span><br><span class="line"></span><br><span class="line">        entiity.types = <span class="type">Int</span>(<span class="type">UNAuthorizationOptions</span>.alert.rawValue |</span><br><span class="line">            <span class="type">UNAuthorizationOptions</span>.badge.rawValue |</span><br><span class="line">            <span class="type">UNAuthorizationOptions</span>.sound.rawValue)</span><br><span class="line"></span><br><span class="line">        <span class="type">JPUSHService</span>.register(forRemoteNotificationConfig: entiity, delegate: <span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line">        <span class="type">JPUSHService</span>.setup(withOption: launchOptions,</span><br><span class="line">                           appKey: <span class="type">JPushAppKey</span>,</span><br><span class="line">                           channel: <span class="string">&quot;app store&quot;</span>,</span><br><span class="line">                           apsForProduction: <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">jpushNotificationCenter</span><span class="params">(<span class="keyword">_</span>: UNUserNotificationCenter!, willPresent notification: UNNotification!, withCompletionHandler completionHandler: <span class="params">(<span class="params">(Int)</span></span></span></span> -&gt; <span class="type">Void</span>)!) &#123;</span><br><span class="line">        <span class="keyword">let</span> userInfo = notification.request.content.userInfo</span><br><span class="line">        <span class="keyword">if</span> notification.request.trigger <span class="keyword">is</span> <span class="type">UNPushNotificationTrigger</span> &#123;</span><br><span class="line">            <span class="type">JPUSHService</span>.handleRemoteNotification(userInfo)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 需要执行这个方法，选择是否提醒用户，有Badge、Sound、Alert三种类型可以选择设置</span></span><br><span class="line">        completionHandler(<span class="type">Int</span>(<span class="type">UNNotificationPresentationOptions</span>.alert.rawValue))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">jpushNotificationCenter</span><span class="params">(<span class="keyword">_</span>: UNUserNotificationCenter!, didReceive response: UNNotificationResponse!, withCompletionHandler completionHandler: <span class="params">(<span class="params">()</span></span></span></span> -&gt; <span class="type">Void</span>)!) &#123;</span><br><span class="line">        <span class="keyword">let</span> userInfo = response.notification.request.content.userInfo</span><br><span class="line">        <span class="keyword">if</span> response.notification.request.trigger <span class="keyword">is</span> <span class="type">UNPushNotificationTrigger</span> &#123;</span><br><span class="line">            <span class="type">JPUSHService</span>.handleRemoteNotification(userInfo)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 系统要求执行这个方法</span></span><br><span class="line">        completionHandler()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点推送进来执行这个方法</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="keyword">_</span>: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable: <span class="keyword">Any</span>], fetchCompletionHandler completionHandler: @escaping <span class="params">(UIBackgroundFetchResult)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="type">JPUSHService</span>.handleRemoteNotification(userInfo)</span><br><span class="line">        completionHandler(<span class="type">UIBackgroundFetchResult</span>.newData)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 系统获取Token</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="keyword">_</span>: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data)</span></span> &#123;</span><br><span class="line">        <span class="type">JPUSHService</span>.registerDeviceToken(deviceToken)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取token 失败</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="keyword">_</span>: UIApplication, didFailToRegisterForRemoteNotificationsWithError error: Error)</span></span> &#123; <span class="comment">// 可选</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;did Fail To Register For Remote Notifications With Error: \(error)&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 后台进前台</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">applicationDidEnterBackground</span><span class="params">(<span class="keyword">_</span>: UIApplication)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 销毁通知红点</span></span><br><span class="line">				<span class="type">UIApplication</span>.shared.applicationIconBadgeNumber = <span class="number">0</span></span><br><span class="line">				<span class="type">JPUSHService</span>.setBadge(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">let</span> center = <span class="type">UNUserNotificationCenter</span>.current()</span><br><span class="line">        center.removeAllDeliveredNotifications() <span class="comment">// To remove all delivered notifications</span></span><br><span class="line">        center.removeAllPendingNotificationRequests() <span class="comment">// To remove all pending notifications which are not delivered yet but scheduled.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// source: https://stackoverflow.com/questions/40397552/cancelalllocalnotifications-not-working-in-ios10</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">jpushNotificationCenter</span><span class="params">(<span class="keyword">_</span>: UNUserNotificationCenter!, openSettingsFor <span class="keyword">_</span>: UNNotification!)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">jpushNotificationAuthorization</span><span class="params">(<span class="keyword">_</span>: JPAuthorizationStatus, withInfo <span class="keyword">_</span>: [AnyHashable: <span class="keyword">Any</span>]!)</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试通知"><a href="#测试通知" class="headerlink" title="测试通知"></a>测试通知</h3><p>现在我们来测试下发个通知给所有用户：</p>
<img src="/posts/15162/image-20200825155413289.png" class="" title="image-20200825155413289">

<img src="/posts/15162/image-20200825155513706.png" class="" title="image-20200825155513706">

<img src="/posts/15162/image-20200825155522931.png" class="" title="image-20200825155522931">

<p>点击确认就能够发送通知给用户啦。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://docs.jiguang.cn/jpush/client/iOS/ios_guide_new/">iOS SDK 集成指南</a></p>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS版本更新后打开时提醒用户去AppStore更新</title>
    <url>/posts/12210/</url>
    <content><![CDATA[<h2 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h2><ul>
<li>Xcode11</li>
<li>Swift5</li>
<li>Alamofire 5.2.1</li>
<li>SwiftyJSON 5.0.0</li>
</ul>
<a id="more"></a>

<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><blockquote>
<p>AppDelegate.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftyJSON</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> Alamofire</span><br><span class="line"></span><br><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span>, <span class="title">WXApiDelegate</span>, <span class="title">WXApiLogDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> window: <span class="type">UIWindow?</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="keyword">_</span>: UIApplication, didFinishLaunchingWithOptions <span class="keyword">_</span>: [UIApplication.LaunchOptionsKey: <span class="keyword">Any</span>]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="comment">// 检测App是否需要更新</span></span><br><span class="line">        checkVersion()</span><br><span class="line"></span><br><span class="line">        window = <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">        window?.rootViewController = <span class="type">ViewController</span>()</span><br><span class="line">        window?.makeKeyAndVisible()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: App更新</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取版本号</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">checkVersion</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">AF</span>.request(<span class="string">&quot;https://itunes.apple.com/lookup?bundleId=App的bundleId&quot;</span>, method: .<span class="keyword">get</span>, parameters: [:])</span><br><span class="line">            .responseJSON &#123; response <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(response)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> value = response.value &#123;</span><br><span class="line">                    <span class="keyword">let</span> json = <span class="type">JSON</span>(value)</span><br><span class="line">                    <span class="keyword">self</span>.compareVersion(appStoreVersion: json[<span class="string">&quot;results&quot;</span>][<span class="number">0</span>][<span class="string">&quot;version&quot;</span>].stringValue)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 比较版本</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">compareVersion</span><span class="params">(appStoreVersion: String)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(appStoreVersion)</span><br><span class="line">        <span class="keyword">let</span> version: <span class="type">String</span> = (<span class="type">Bundle</span>.main.infoDictionary?[<span class="string">&quot;CFBundleShortVersionString&quot;</span>] <span class="keyword">as</span>? <span class="type">String</span>)!</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> appStoreVersion == version &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;当前已是最新版&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> alertC = <span class="type">UIAlertController</span>(title: <span class="string">&quot;有新版本&quot;</span>, message: <span class="string">&quot;前去更新版本？&quot;</span>, preferredStyle: .alert)</span><br><span class="line">            alertC.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;去更新&quot;</span>, style: .<span class="keyword">default</span>, handler: &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.updateApp(appId: <span class="type">AppID</span>)</span><br><span class="line">            &#125;))</span><br><span class="line">            alertC.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;下次再说&quot;</span>, style: .cancel, handler: &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">            &#125;))</span><br><span class="line">            <span class="type">UIApplication</span>.shared.keyWindow?.rootViewController?.present(alertC, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新App</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateApp</span><span class="params">(appId <span class="keyword">_</span>: String)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 根据iOS系统版本，分别处理</span></span><br><span class="line">        <span class="keyword">let</span> urlString = <span class="string">&quot;itms-apps://itunes.apple.com/app/id\(AppID)&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> url = <span class="type">URL</span>(string: urlString) &#123;</span><br><span class="line">            <span class="comment">// 根据iOS系统版本，分别处理</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">#available</span>(iOS <span class="number">10</span>, *) &#123;</span><br><span class="line">                <span class="type">UIApplication</span>.shared.<span class="keyword">open</span>(url, options: [:],</span><br><span class="line">                                          completionHandler: &#123;</span><br><span class="line">                                              <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">UIApplication</span>.shared.openURL(url)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS的App语言设置为中文</title>
    <url>/posts/64032/</url>
    <content><![CDATA[<p>偶尔发现 App 的拍照弹窗显示的是英文：</p>
<img src="/posts/64032/language.jpeg" class="" title="拍照为英文">

<p>但我在 AppStore 上架的时候明明设置的语言是中文啊。后来网上查询后发现，还需要在项目的 plist 中添加 <code>Localization native development region</code> 为 <code>China</code> ：</p>
<img src="/posts/64032/plist.png" class="" title="plist设置">

<p>效果：</p>
<img src="/posts/64032/plist-china.png" class="" title="效果">
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>input效果汇总</title>
    <url>/posts/32435/</url>
    <content><![CDATA[<h2 id="text-文本框"><a href="#text-文本框" class="headerlink" title="text 文本框"></a>text 文本框</h2><h3 id="focus-时底部下划线展开动画"><a href="#focus-时底部下划线展开动画" class="headerlink" title="focus 时底部下划线展开动画"></a>focus 时底部下划线展开动画</h3><iframe height="310" scrolling="no" title="Input Boxes" src="https://codepen.io/JingW/embed/NWWERVy?height=265&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<a id="more"></a>

<h2 id="search-搜索框"><a href="#search-搜索框" class="headerlink" title="search 搜索框"></a>search 搜索框</h2><h3 id="聚焦时搜索框变宽动画"><a href="#聚焦时搜索框变宽动画" class="headerlink" title="聚焦时搜索框变宽动画"></a>聚焦时搜索框变宽动画</h3><iframe height="310" scrolling="no" title="Search Form with CSS3" src="https://codepen.io/JingW/embed/KKKrNQY?height=265&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="radio-单选按钮"><a href="#radio-单选按钮" class="headerlink" title="radio 单选按钮"></a>radio 单选按钮</h2><h3 id="自定义小圆点（带动画）"><a href="#自定义小圆点（带动画）" class="headerlink" title="自定义小圆点（带动画）"></a>自定义小圆点（带动画）</h3><iframe height="310" scrolling="no" title="CSS radio buttons" src="https://codepen.io/JingW/embed/KKKrgmy?height=265&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="checkbox-多选按钮"><a href="#checkbox-多选按钮" class="headerlink" title="checkbox 多选按钮"></a>checkbox 多选按钮</h2><h3 id="自定义小方框-1"><a href="#自定义小方框-1" class="headerlink" title="自定义小方框 1"></a>自定义小方框 1</h3><iframe height="310" scrolling="no" title="Simple CSS Checkboxes with Font Awesome" src="https://codepen.io/JingW/embed/WNNYRoN?height=265&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="自定义小方框-2"><a href="#自定义小方框-2" class="headerlink" title="自定义小方框 2"></a>自定义小方框 2</h3><iframe height="310" scrolling="no" title="Pure CSS custom checkboxes" src="https://codepen.io/JingW/embed/XWWypeg?height=265&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="select-下拉选项"><a href="#select-下拉选项" class="headerlink" title="select 下拉选项"></a>select 下拉选项</h2><h3 id="纯-CSS-的下拉列表"><a href="#纯-CSS-的下拉列表" class="headerlink" title="纯 CSS 的下拉列表"></a>纯 CSS 的下拉列表</h3><iframe height="310" scrolling="no" title="Pure CSS Select" src="https://codepen.io/JingW/embed/PooxWaM?height=265&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>jsonp解决跨域问题的原理</title>
    <url>/posts/40160/</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p>Jsonp(JSON with Padding) 是 json 的一种”使用模式”，可以让网页从别的域名（网站）那获取资料，即跨域读取数据。</p>
</blockquote>
<p>———— <a href="https://www.runoob.com/json/json-jsonp.html">菜鸟教程-jsonp</a></p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>script 标签的 src 不受同源策略影响，允许跨域。但需要借助服务端的配合。</p>
<a id="more"></a>

<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><blockquote>
<p>前端 index.html</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>天气查询<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;city&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入城市名称&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;查询&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 创建方法用来获取跨域数据（名称随意）</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>[<span class="string">&quot;foo&quot;</span>] = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">             <span class="comment">// 打印获取的数据</span></span></span><br><span class="line"><span class="javascript">             <span class="built_in">console</span>.log(data);</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> btn = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#btn&quot;</span>);</span></span><br><span class="line"><span class="javascript">        btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 获取用户输入城市名</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> = city = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#city&quot;</span>).value;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 动态创建script标签</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> script = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 把回调函数foo的名称 以及 城市名 传递给后端</span></span></span><br><span class="line"><span class="javascript">            script.src = <span class="string">`http://127.0.0.1:8084/weather.php?callback=foo&amp;city=<span class="subst">$&#123;city&#125;</span>`</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> body = <span class="built_in">document</span>.querySelector(<span class="string">&quot;body&quot;</span>);</span></span><br><span class="line">            body.appendChild(script);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>后端 weather.php</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="comment">// 获取前端回调函数名和城市名</span></span><br><span class="line">   <span class="variable">$cb</span> = <span class="variable">$_GET</span>[<span class="string">&quot;callback&quot;</span>];</span><br><span class="line">   <span class="variable">$city</span> = <span class="variable">$_GET</span>[<span class="string">&quot;city&quot;</span>];</span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$city</span> == <span class="string">&quot;shanghai&quot;</span>) &#123;</span><br><span class="line">       <span class="comment">// 调用前端已经定义的函数，把数据当做参数传递给 foo</span></span><br><span class="line">       <span class="keyword">echo</span> <span class="variable">$cb</span>.<span class="string">&quot;(&#x27;上海晴，无风&#x27;)&quot;</span>;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="variable">$cb</span>.<span class="string">&quot;(&#x27;没有查询到你所在城市天气&#x27;)&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样一来当前端请求 <code>http://127.0.0.1:8084/weather.php?callback=foo&amp;city=$&#123;city&#125;</code> 后，后端返回的内容就应该类似这种格式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">foo(<span class="string">&#x27;上海晴，无风&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>本质就是在调用前端已经定义好的 <code>foo</code> 方法，这样就能够获取到后端返回给我们的数据了。</p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>由于 jsonp 解决跨域问题本质上是后端返回一个方法调用。所以不是任何接口都支持 jsonp 来获取到数据的，一旦接口不支持，返回的不是方法调用格式（foo(data)）而是 json 格式（{“msg”: “success”, “data”: {…}}）的话，就说明我们无法通过 jsonp 获取到数据。</p>
<h3 id="第三方接口跨域数据获取"><a href="#第三方接口跨域数据获取" class="headerlink" title="第三方接口跨域数据获取"></a>第三方接口跨域数据获取</h3><p>一旦第三方接口返回的是 json 格式的字符串，我们就无法通过 ajax 或者 jsonp 的方式获取跨域数据。这种情况下我们只能通过自己的服务器当做中转站帮我们前端获取三方接口数据了，因为服务端之间是不存在跨域问题的，所以出现这种情况后，你可以让公司的后端帮帮忙，写一个接口去获取三方接口数据，并暴露一个接口让你能够获取到数据~</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>跨域</tag>
      </tags>
  </entry>
  <entry>
    <title>let和const和var的区别</title>
    <url>/posts/37021/</url>
    <content><![CDATA[<h2 id="const-和-let-异同"><a href="#const-和-let-异同" class="headerlink" title="const 和 let 异同"></a>const 和 let 异同</h2><h3 id="不同点"><a href="#不同点" class="headerlink" title="不同点"></a>不同点</h3><ul>
<li>let 定义变量可以只声明不赋值</li>
<li>const 定义常量声明时必须赋值，一旦定义不可轻易改变</li>
</ul>
<h3 id="相同点"><a href="#相同点" class="headerlink" title="相同点"></a>相同点</h3><p>解决 var 没有块作用域,、变量提升、可以重复声明的问题。 let 和 const 有自己的块作用域, 不存在变量提升问题, 同一块作用域中不可重复声明（会报错）。</p>
<h2 id="let-const-和-var-区别"><a href="#let-const-和-var-区别" class="headerlink" title="let/const 和 var 区别"></a>let/const 和 var 区别</h2><ul>
<li>var 有变量提升，let/const 没有</li>
<li>let/const 的作用域是块，而 var 的作用域是函数</li>
<li>let/const 有暂时性死区，只要 let/const 声明的变量，在未声明之前使用或者赋值都会报错（ReferenceError）</li>
<li>let/const 不能被重复定义</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>ES6</tag>
      </tags>
  </entry>
  <entry>
    <title>macbookpro15款更新Catalina系统导致wifi不可用解决方案</title>
    <url>/posts/21881/</url>
    <content><![CDATA[<p>公司搞了个 15 款的 mbp，需要升级到最新的 macOS Catalina 10.15.17 版本。</p>
<p>然而当我升级完毕后却发现 wifi 不可用。其表现就是右上角菜单中的 wifi 变灰，在「系统——&gt;网络」中，当我尝试手动添加 wifi 时，弹窗中的接口下拉选项中并没有显示 wifi 。</p>
<p>在网上搜了各种方案而且在咨询了 apple 技术服务后都没法解决此问题。后来不愿放弃的我继续 google，最终发现了一篇国外的帖子，帮助我成功找回了 wifi：</p>
<p><a href="https://kozyatnikov.com/mac-os-x-catalina-wifi-not-working-fix">https://kozyatnikov.com/mac-os-x-catalina-wifi-not-working-fix</a></p>
<p>如果你也遇到过此问题，可以根据上面文章的步骤执行来找回 wifi。</p>
]]></content>
      <categories>
        <category>操作系统</category>
        <category>macOS</category>
      </categories>
      <tags>
        <tag>macOS</tag>
      </tags>
  </entry>
  <entry>
    <title>mac安装homebrew出错-Failed to connect to raw.githubusercontent.com port 443/Connection refused error</title>
    <url>/posts/24685/</url>
    <content><![CDATA[<h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h2><p>安装 homebrew 时总是报错：（Failed to connect to raw.githubusercontent.com port 443:Connection refused error）</p>
<p>原因是 github 的 raw.githubusercontent.com 域名解析被污染了。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>修改 hosts 文件</p>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>查询真实 ip</p>
<p>到 <a href="https://www.ipaddress.com/">https://www.ipaddress.com</a> 查询 raw.githubusercontent.com 的真实 ip。</p>
<p>修改 hosts ：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/hosts</span><br></pre></td></tr></table></figure>

<p>添加如下内容：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">199.232.68.133 raw.githubusercontent.com</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>操作系统</category>
        <category>macOS</category>
      </categories>
      <tags>
        <tag>macOS</tag>
      </tags>
  </entry>
  <entry>
    <title>mac网线转接头连接网线无法上网</title>
    <url>/posts/45588/</url>
    <content><![CDATA[<p>mac 笔记本电脑没有直接插网线的接口，所以需要一个转接头。我在某东下单了一个绿联转接头并连上了网线，说明书上说即插即用不用配置，然而我发现并不能直接上网。所以搜索了绿联的外置网卡驱动，下载了一个我这个型号转接头能用的驱动。安装完毕重启 mac 就能直接上网了。</p>
<h3 id="绿联驱动下载地址"><a href="#绿联驱动下载地址" class="headerlink" title="绿联驱动下载地址"></a>绿联驱动下载地址</h3><p><a href="https://www.lulian.cn/download/list-34-cn.html">绿联-驱动下载中心</a></p>
<img src="/posts/45588/image-20201119105228757.png" class="" title="image-20201119105228757">

<p>Ctrl/CMD + F 搜索你的设备型号，然后下载对应平台下的驱动安装就好。</p>
]]></content>
      <categories>
        <category>操作系统</category>
        <category>macOS</category>
      </categories>
  </entry>
  <entry>
    <title>node14+版本下hexo部署失败</title>
    <url>/posts/430/</url>
    <content><![CDATA[<p>最近升级了 node14，发现在用 hexo 写博客部署时失败了，报错大致如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FATAL Something&#x27;s wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.html</span><br><span class="line">TypeError [ERR_INVALID_ARG_TYPE]: The &quot;mode&quot; argument must be integer. Received an instance of Object</span><br><span class="line">    at copyFile (fs.js:1890:10)</span><br><span class="line">    at tryCatcher (C:\Users\Administrator\blog\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at ret (eval at makeNodePromisifiedEval (C:\Users\Administrator\blog\node_modules\bluebird\js\release\promisify.js:184:12), &lt;anonymous&gt;:13:39)</span><br><span class="line">    at C:\Users\Administrator\blog\node_modules\hexo-deployer-git\node_modules\hexo-fs\lib\fs.js:144:39</span><br><span class="line">    at tryCatcher (C:\Users\Administrator\blog\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at Promise._settlePromiseFromHandler (C:\Users\Administrator\blog\node_modules\bluebird\js\release\promise.js:517:31)</span><br><span class="line">    at Promise._settlePromise (C:\Users\Administrator\blog\node_modules\bluebird\js\release\promise.js:574:18)</span><br><span class="line">    at Promise._settlePromise0 (C:\Users\Administrator\blog\node_modules\bluebird\js\release\promise.js:619:10)</span><br><span class="line">    at Promise._settlePromises (C:\Users\Administrator\blog\node_modules\bluebird\js\release\promise.js:699:18)</span><br><span class="line">    at Promise._fulfill (C:\Users\Administrator\blog\node_modules\bluebird\js\release\promise.js:643:18)</span><br><span class="line">    at Promise._resolveCallback (C:\Users\Administrator\blog\node_modules\bluebird\js\release\promise.js:437:57)</span><br><span class="line">    at Promise._settlePromiseFromHandler (C:\Users\Administrator\blog\node_modules\bluebird\js\release\promise.js:529:17)</span><br><span class="line">    at Promise._settlePromise (C:\Users\Administrator\blog\node_modules\bluebird\js\release\promise.js:574:18)</span><br><span class="line">    at Promise._settlePromise0 (C:\Users\Administrator\blog\node_modules\bluebird\js\release\promise.js:619:10)</span><br><span class="line">    at Promise._settlePromises (C:\Users\Administrator\blog\node_modules\bluebird\js\release\promise.js:699:18)</span><br><span class="line">    at Promise._fulfill (C:\Users\Administrator\blog\node_modules\bluebird\js\release\promise.js:643:18)</span><br></pre></td></tr></table></figure>

<p>google 了下发现是 hexo 不支持最新 node14+，issue<a href="https://github.com/hexojs/hexo/issues/4263">见此</a>，解决方案两种：降低 node 版本或者升级最新<a href="mailto:hexo@4.2.1">hexo@4.2.1</a>+。</p>
<p>我尝试了升级 hexo 到 4.2.1 发现并没有什么卵用，照样报相同的错，所以选择了降低 node 版本到稳定版：</p>
<p>直接到官网下载最新稳定版：<a href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a></p>
<p>然后重新执行 <code>hexo clean &amp;&amp; hexo deploy</code> 打包命令就好了。</p>
<p>P.S. 如果打包成功后，最好验证下 hexo 下的分类和标签是否正常工作，我就遇到了点击自己博客首页的「分类」和「标签」后，跳转的页面报 404，原因是打开的路由最后多了个空格：<code>./categories/%20</code> 。不知道啥原因，所以我把 hexo 版本退回到了 3.8.0。这样路由就正确了。</p>
]]></content>
      <categories>
        <category>教程</category>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title>npm-run-build遇到Node Sass could not find a binding for your current environment: OS X 64-bit with Node.js 14.x</title>
    <url>/posts/7710/</url>
    <content><![CDATA[<p>今天 <code>npm run build-prod</code> 打包项目的时候遇到如下报错信息：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Node Sass could not find a binding for your current environment: OS X 64-bit with Node.js</span><br></pre></td></tr></table></figure>

<p>百度了一些解决方案都没法解决问题，后来在 Stack Overflow 上看到了一种解决方案，地址：<a href="https://stackoverflow.com/questions/64612707/node-sass-does-not-yet-support-your-current-environment-windows-64-bit-with-uns">https://stackoverflow.com/questions/64612707/node-sass-does-not-yet-support-your-current-environment-windows-64-bit-with-uns</a></p>
<ol>
<li>install / downgrade node.js to a stable version (LTS) like <a href="https://nodejs.org/en/download/">14.15.0</a></li>
<li>install the compatible node-sass version via <code>npm install node-sass@4.14.0</code>; you can find the list <a href="https://www.npmjs.com/package/node-sass">here</a>, or even install <code>gulp-sass</code>with <code>npm i gulp-sass --save-dev</code>.</li>
</ol>
]]></content>
      <categories>
        <category>解决方案</category>
        <category>Node</category>
      </categories>
      <tags>
        <tag>笔记</tag>
        <tag>解决方案</tag>
      </tags>
  </entry>
  <entry>
    <title>null 和 undefined 的区别</title>
    <url>/posts/63928/</url>
    <content><![CDATA[<h2 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h2><ul>
<li>null 表示一个对象是“没有值”的值，也就是值为“空”</li>
<li>undefined 表示一个变量声明了没有初始化(赋值)</li>
</ul>
<h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><ul>
<li>undefined 的类型(typeof)是 undefined</li>
<li>null 的类型(typeof)是 object</li>
</ul>
<a id="more"></a>

<h2 id="双等三等"><a href="#双等三等" class="headerlink" title="双等三等"></a>双等三等</h2><p>另外，在验证 null 时，一定要使用 <code>===</code> ，因为 <code>==</code> 无法分辨 null 和 undefined ：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">copynull &#x3D;&#x3D; undefined &#x2F;&#x2F; true </span><br><span class="line">null &#x3D;&#x3D;&#x3D; undefined &#x2F;&#x2F; false</span><br></pre></td></tr></table></figure>



<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="undefined"><a href="#undefined" class="headerlink" title="undefined"></a>undefined</h3><ol>
<li>变量提升：只声明未定义默认值就是 undefined</li>
<li>严格模式下：没有明确的执行主体，this 就是 undefined</li>
<li>对象没有这个属性名，属性值是 undefined</li>
<li>函数定义形参不传值，默认就是 undefined</li>
<li>函数没有返回值（没有 return 或者 return; ），默认返回的就是 undefined</li>
<li>数组越界取值也是 undefined （arr=[1,2]; arr[10] =&gt; undefined）</li>
<li>…</li>
</ol>
<h3 id="null"><a href="#null" class="headerlink" title="null"></a>null</h3><ol>
<li>手动设置变量的值或者对象某个属性值为null（此时不赋值，后面会赋值）</li>
<li>在 JS 的 DOM 元素获取中，如果没有获取到指定的元素对象，结果一般都是null</li>
<li>Object.prototype.<strong>proto</strong> 的值也是 null</li>
<li>正则捕获的时候，如果没有捕获到结果，默认也是null</li>
<li>…</li>
</ol>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>Javascript会将未赋值的变量默认值设为undefined；Javascript从来不会将变量设为null。它是用来让程序员表明某个用var声明的变量时没有值的。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
  </entry>
  <entry>
    <title>package.json配置一次npm run start执行多个指令</title>
    <url>/posts/7128/</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>前端项目设置了 express 编写的 mock 数据，每次启动项目得执行两个命令，一个用来开启 vue 客户端，一个用来开启 express 服务端。感觉每次输入两次命令太过麻烦。</p>
<a id="more"></a>

<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>google 了下发现有个模块可以帮助我们实现一次指令执行多个命令：<code>concurrently</code>。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>全局安装：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i -g concurrently</span><br></pre></td></tr></table></figure>

<p>或者项目安装：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i concurrently -D</span><br></pre></td></tr></table></figure>

<p>然后更改 <code>package.json</code>：</p>
<blockquote>
<p>旧</p>
</blockquote>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;mock&quot;:&quot;vue-cli-service serve --mode mock&quot;,</span><br><span class="line">&quot;nodemon&quot;: &quot;nodemon server/index.js&quot;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>新</p>
</blockquote>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;mock&quot;: &quot;concurrently \&quot;vue-cli-service serve --mode mock\&quot; \&quot;nodemon server/index.js\&quot;&quot;,</span><br></pre></td></tr></table></figure>

<h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2><p>其实不安装 <code>concurrently</code> 也能实现执行多个命令，那就是：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;all&quot;: &quot;node server/server.js &amp;&amp; npm run start&quot;</span><br></pre></td></tr></table></figure>

<p>这种方案。</p>
<p>不同的是 concurrently 是并联的，&amp;&amp; 是串联的。</p>
<p>在速度上，第一个方法远比第二个方法要快。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>构建工具</category>
        <category>npm</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>select标签样式调整技巧</title>
    <url>/posts/46310/</url>
    <content><![CDATA[<h2 id="重置丑陋样式"><a href="#重置丑陋样式" class="headerlink" title="重置丑陋样式"></a>重置丑陋样式</h2><p>项目中使用到了 select 标签，但在 Android 和 iOS 上默认展示的效果都很丑而且不一致，网上搜到一个 css 样式可以重置效果，这里记下笔记：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">select</span> &#123;</span><br><span class="line">  <span class="comment">/*移除浏览器默认特殊样式*/</span></span><br><span class="line">  <span class="attribute">appearance</span>: none;</span><br><span class="line">  <span class="attribute">-moz-appearance</span>: none;</span><br><span class="line">  <span class="attribute">-webkit-appearance</span>: none;</span><br><span class="line">  <span class="attribute">-ms-appearance</span>: none;</span><br><span class="line">  <span class="comment">/*移除轮廓样式*/</span></span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="comment">/*移除点击元素时出现的高亮颜色*/</span></span><br><span class="line">  <span class="attribute">-webkit-tap-highlight-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="built_in">rem</span>(<span class="number">1</span>) solid <span class="number">#ebebeb</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">rem</span>(<span class="number">100</span>);</span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">rem</span>(<span class="number">50</span>);</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="built_in">rem</span>(<span class="number">50</span>);</span><br><span class="line">  <span class="comment">/*设置一个块元素首行文本内容之前的缩进量，防止紧紧靠在边上*/</span></span><br><span class="line">  <span class="attribute">text-indent</span>: <span class="built_in">rem</span>(<span class="number">4</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: transparent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="选中项右对齐"><a href="#选中项右对齐" class="headerlink" title="选中项右对齐"></a>选中项右对齐</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">select</span> &#123;</span><br><span class="line">  <span class="attribute">direction</span>: rtl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 默认左对齐属性值为 ltr */</span></span><br></pre></td></tr></table></figure>

<h2 id="select-默认选中项"><a href="#select-默认选中项" class="headerlink" title="select 默认选中项"></a>select 默认选中项</h2><h3 id="原生"><a href="#原生" class="headerlink" title="原生"></a>原生</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;framework&quot;</span> <span class="attr">id</span>=<span class="string">&quot;framework&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;vue&quot;</span>&gt;</span>VueJS<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;react&quot;</span> <span class="attr">selected</span>&gt;</span>ReactJS<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;angular&quot;</span>&gt;</span>AngularJS<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;jquery&quot;</span>&gt;</span>jQuery<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span></span></span><br><span class="line"><span class="javascript">        .querySelector(<span class="string">&#x27;#framework&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        .addEventListener(<span class="string">&#x27;change&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(e.target.value);</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="vue"><a href="#vue" class="headerlink" title="vue"></a>vue</h3><blockquote>
<p>template</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model</span>=<span class="string">&quot;selected&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;selectChange&quot;</span> <span class="attr">class</span>=<span class="string">&quot;select&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">v-for</span>=<span class="string">&quot;(search, key) in searchList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;key&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;search.id&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;search.name&#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span>&#123;</span><br><span class="line">    searchList:[</span><br><span class="line">      &#123;</span><br><span class="line">        id:<span class="string">&#x27;1&#x27;</span>,<span class="attr">name</span>:<span class="string">&#x27;中国&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id:<span class="string">&#x27;2&#x27;</span>,<span class="attr">name</span>:<span class="string">&#x27;美国&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id:<span class="string">&#x27;3&#x27;</span>,<span class="attr">name</span>:<span class="string">&#x27;日本&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    selected:<span class="string">&#x27;2&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在写 vue select 的时候应注意以下几点：</p>
<ul>
<li>v-model 是 select 的指定显示文本，如果没有，当选中 option 中的内容时 select 标签将不会显示出文本。</li>
<li>@change 应尽量写在 select 标签上。</li>
</ul>
<h2 id="onchange-事件获取选中项的-value-和-text"><a href="#onchange-事件获取选中项的-value-和-text" class="headerlink" title="onchange 事件获取选中项的 value 和 text"></a>onchange 事件获取选中项的 value 和 text</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;num&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;xuanze&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>&gt;</span>10<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;15&quot;</span>&gt;</span>15<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;25&quot;</span>&gt;</span>25<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span>&gt;</span>30<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;35&quot;</span>&gt;</span>35<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;40&quot;</span>&gt;</span>40<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> obj = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;xuanze&#x27;</span>); <span class="comment">//定位id</span></span></span><br><span class="line"><span class="javascript">        obj.addEventListener(<span class="string">&#x27;change&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> index = obj.selectedIndex; <span class="comment">// 选中索引</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> value = obj.options[index].value; <span class="comment">// 选中值</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> text = obj.options[index].text; <span class="comment">// 选中展示的文字</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(index, value);</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>position/fixed在Safari下出现随屏幕一起滚动情况</title>
    <url>/posts/6653/</url>
    <content><![CDATA[<p>在 <code>position:fixed/absolute</code> 内加入：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">-webkit-transform</span>: <span class="selector-tag">translateZ</span>(0);</span><br></pre></td></tr></table></figure>

<p>假如有遮罩情况则在内容区域加入：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">margin-bottom</span>: 30<span class="selector-tag">px</span>;</span><br><span class="line"><span class="selector-tag">margin-top</span>: 30<span class="selector-tag">px</span>;</span><br></pre></td></tr></table></figure>

<p>抖动情况则在内容区域加入：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">overflow-y</span>: <span class="selector-tag">auto</span>;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>移动端</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>移动端</tag>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>swift5获取remoteNotification</title>
    <url>/posts/23085/</url>
    <content><![CDATA[<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> userInfo = launchOptions?[<span class="type">UIApplication</span>.<span class="type">LaunchOptionsKey</span>.remoteNotification] <span class="keyword">as</span>? [<span class="type">AnyHashable</span>: <span class="type">Any</span>]</span><br><span class="line"><span class="keyword">if</span> userInfo != <span class="literal">nil</span> &#123;</span><br><span class="line">   <span class="type">JPUSHService</span>.handleRemoteNotification(userInfo)</span><br><span class="line">   <span class="keyword">let</span> notification = <span class="type">NSNotification</span>.<span class="type">Name</span>(rawValue: <span class="string">&quot;jpush&quot;</span>)</span><br><span class="line">   <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.post(name: notification, object: <span class="literal">nil</span>, userInfo: userInfo)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>来源：<a href="https://stackoverflow.com/questions/40209234/how-to-handle-launch-options-in-swift-3-when-a-notification-is-tapped-getting-s">https://stackoverflow.com/questions/40209234/how-to-handle-launch-options-in-swift-3-when-a-notification-is-tapped-getting-s</a></p>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>transform3D转换（二）</title>
    <url>/posts/14243/</url>
    <content><![CDATA[<p>在我当初了解到 transform 后的一段时间，其实是不知道它能够让元素实现 3d 转换的。直到有一天在逛 codepen 时，我发现了下面这个 demo：</p>
<iframe height="393" scrolling="no" title="CSS3 Transforms 3D Perspective Carousel" src="https://codepen.io/JingW/embed/qwrbxK/?height=393&amp;theme-id=0&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<a id="more"></a>

<p>p.s. 原作者地址在这儿：<a href="https://codepen.io/Hubson/pen/XmrEGX">https://codepen.io/Hubson/pen/XmrEGX</a></p>
<p>OS：我靠，还能这样玩儿？赶紧查查如何实现的。（<a href="http://bfy.tw/N9fx">点我重现查找过程</a>）</p>
<p>然后就发现了张鑫旭老师的 <a href="https://www.zhangxinxu.com/wordpress/2012/09/css3-3d-transform-perspective-animate-transition/">这篇文章</a> 。算是给我打开了新世界的大门~ 原来现在的 CSS 都这么强大了，要知道几年前我在学 <code>.NET</code> 时就接触过 HTML 和 CSS，那个时候不还是满屏 div，没啥特效的时代嘛。</p>
<p>扯远了，言归正传。首先来看下面这个图（copy 上面文章来的~）：</p>
<img src="/posts/14243/3dzuobiaoxi.png" class="" title="3d">

<p>这个图就是咱们 3d 变形所依赖的坐标系。要想理解这张图，需要一点空间想象力。我们人在看这个坐标系时，是从左下角的眼睛处从 <code>+Z</code> 往 <code>-Z</code> 里面看的。可以把这个眼睛简单的想象成你自己，由网格组成的正方形平面相当于你在屏幕上创建的一个正方形 div 元素。那么当你设置 <code>transform: translate(200px, 0)</code> 时，你的元素将会向 <code>+X</code> 方向前进，也就是平常在 2d 变换中的向右移动。现在应该理解了吧~</p>
<h2 id="rotateX-rotateY-rotateZ"><a href="#rotateX-rotateY-rotateZ" class="headerlink" title="rotateX, rotateY, rotateZ"></a>rotateX, rotateY, rotateZ</h2><h3 id="rotateX"><a href="#rotateX" class="headerlink" title="rotateX"></a>rotateX</h3><p>rotateX 就是沿着 x 轴进行 3d 旋转。</p>
<p>在下面示例中，我们实现让一个元素沿着它的 x 轴旋转 180°。为了让效果看起来更加明显，我把该元素分成了上下两个部分，并在中间留出了缝隙，以便当做 X 轴看待，当鼠标移入该元素后，它便“沿着” x 轴旋转 180°：</p>
<iframe height="323" scrolling="no" title="transform3d-rotateX" src="https://codepen.io/JingW/embed/EJWKJq/?height=323&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="rotateY"><a href="#rotateY" class="headerlink" title="rotateY"></a>rotateY</h3><p>用和上面类似的方式，我们实现 rotateY 的 3d 旋转效果，让元素沿着 y 轴进行 3d 旋转：</p>
<iframe height="265" scrolling="no" title="transform3d-rotateY" src="https://codepen.io/JingW/embed/JVWbgo/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="rotateZ"><a href="#rotateZ" class="headerlink" title="rotateZ"></a>rotateZ</h3><p>还记得那根 z 轴嘛，当我们垂直于屏幕看向元素时，z 轴在我们眼里就是一个“点”。所以当我们使用 rotateZ 来旋转元素时，元素会沿着 z 轴进行旋转，就是下方元素中间的“点”：</p>
<iframe height="378" scrolling="no" title="transform3d-rotateZ" src="https://codepen.io/JingW/embed/GLWrRE/?height=378&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="perspective-透视"><a href="#perspective-透视" class="headerlink" title="perspective 透视"></a>perspective 透视</h2><p>这个属性英文直译过来就是 透视、视角的意思。</p>
<p>电脑显示屏是个 2d 平面，要想让元素在一个 2d 平面上有立体感（3d 效果），就得利用这个 <code>perspective</code> 透视属性。<code>perspective</code> 可以让一个 2d 平面在转换过程中呈现出 3d 效果。</p>
<p>不知道大家有没有注意到上面有关 rotateY 下的 demo，虽说是沿着元素 y 轴进行旋转，但一点 3d 立体效果都没有，要知道在现实生活中，如果一张卡片沿着它宽度一半儿的 y 轴进行旋转，肯定有近大远小的透视效果，即离我们近的一面越来越大，离我们远的一面越来越小。如果还没有明白，看了下面的示例就知道了（鼠标移入 body 就能触发旋转~）：</p>
<iframe height="583" scrolling="no" title="transform3d-perspective" src="https://codepen.io/JingW/embed/pBewZM/?height=583&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<p>这下是不是明显多啦？其实这都全靠了 <code>perspective</code> 透视，它允许我们为场景添加深度感，原理就是<strong>使 z 轴在靠近观察者的元素看起来更大，而更远的元素看起来更小</strong>。也就是上面提到的“近大远小”。</p>
<p>我们来看看下面这张图：</p>
<img src="/posts/14243/perspective-distance.png" class="" title="perspective-distance">

<p>上图中蓝色圆圈表示三维空间中的元素，字母 d 表示透视的值，即观看者的眼睛和<strong>屏幕</strong>之间的距离。字母 Z 表示元素在 z 轴上的位置。元素在 z 轴上越远，相对于观察者的外观越小，它越接近，就看起来越大。这就是三维空间中透视的效果。</p>
<h2 id="perspective-VS-perspective"><a href="#perspective-VS-perspective" class="headerlink" title="perspective VS perspective()"></a>perspective VS perspective()</h2><p>perspective 有两种写法，一种是直接写在要使用 3d 转换的父元素身上（如上一个 demo）：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 父容器 */</span></span><br><span class="line"><span class="selector-class">.contaienr</span> &#123;</span><br><span class="line">  <span class="comment">/* 将透视属性写在父容器 */</span></span><br><span class="line">  <span class="attribute">perspective</span>: <span class="number">1000px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 需要3d转换的子元素 */</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 触发转换 */</span></span><br><span class="line"><span class="selector-class">.container</span><span class="selector-pseudo">:hover</span> <span class="selector-tag">box</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotateY</span>(<span class="number">180deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这种写法下，一旦“舞台（浏览器显示区域）”上有多个元素都进行了 3d 转换，可能效果就与你的预想不太一样，靠近“舞台”两边的元素会“歪着”进行旋转：</p>
<iframe height="367" scrolling="no" title="transform3d-perspective2" src="https://codepen.io/JingW/embed/KYWedq/?height=367&amp;theme-id=0&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<p>这是为什么呢？答案是因为默认我们观察者的“眼睛”是处于“舞台”正中央的前方的（这个前方是以“舞台”的视角），所以靠近我们观察者左前方的（观察者视角）卡片，在沿着 x 轴做旋转时，就是“歪着”的；同理观察者右前方卡片也是如此。</p>
<p>那么如果你想让它们都与正中央的卡片一样效果的旋转呢？这就引出了第二种写法：<code>perspective()</code> 。该属性写在 3d 转换元素本身上，而不是在其父元素上了：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="comment">/* 1. 沿着x轴旋转180° */</span></span><br><span class="line">  <span class="comment">/* 2. 给3d旋转元素本身添加 perspective 透视 */</span></span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">perspective</span>(<span class="number">500px</span>) <span class="built_in">rotateX</span>(<span class="number">180deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<iframe height="365" scrolling="no" title="transform3d-perspective3" src="https://codepen.io/JingW/embed/EJWpaq/?height=265&amp;theme-id=0&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="perspective-origin"><a href="#perspective-origin" class="headerlink" title="perspective-origin"></a>perspective-origin</h2><p>语法：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">perspective-origin</span>: 50% 50%; <span class="comment">/* 默认值，表示观察者在“舞台”正中央的上方 */</span></span><br><span class="line"><span class="selector-tag">perspective-origin</span>: <span class="selector-tag">left</span> <span class="selector-tag">center</span>; <span class="comment">/* 表示观察者在“舞台”最左边且垂直居中的上方 */</span></span><br></pre></td></tr></table></figure>

<p>该属性用于定义观察者观看三维空间时的位置所在。默认情况下为 x 轴 50%、y 轴 50%。也就是“舞台（屏幕）”正中央的上方。</p>
<p>读者可以尝试用鼠标拖动下方 demo 中的按钮“camera”到“舞台”的各个位置，然后看看三张卡片的 3d 转换效果。当你在拖动“camera”改变它的位置时，也就等同于改变了 <code>perspective-origin</code> 的位置。例如当你把按钮“camera”拖动到左上角，就相当于设置了 <code>perspective-origin: left top</code>。</p>
<iframe height="360" scrolling="no" title="transform3d-perspective-origin" src="https://codepen.io/JingW/embed/vMmNpm/?height=360&amp;theme-id=0&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS3</tag>
      </tags>
  </entry>
  <entry>
    <title>transition过渡（一）</title>
    <url>/posts/41749/</url>
    <content><![CDATA[<h2 id="传送门"><a href="#传送门" class="headerlink" title="传送门"></a>传送门</h2><ul>
<li><a href="https://evestorm.github.io/posts/24967/">transition过渡（一）</a></li>
<li><a href="https://evestorm.github.io/posts/13167/">transition过渡（二）</a></li>
</ul>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p>CSS3 过渡是元素从一种样式逐渐改变为另一种的效果。<br>要实现这一点，必须规定两项内容：</p>
<ul>
<li>指定要添加效果的CSS属性</li>
<li>指定效果的持续时间。</li>
</ul>
</blockquote>
<p>———— 出自 <a href="http://www.runoob.com/css3/css3-transitions.html">菜鸟教程</a></p>
<a id="more"></a>

<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 分开写：*/</span></span><br><span class="line"><span class="selector-tag">transition-property</span>: <span class="selector-tag">css</span>属性名称;</span><br><span class="line"><span class="selector-tag">transition-duration</span>: 过渡所花时间(默认0);</span><br><span class="line"><span class="selector-tag">transition-timing-function</span>: 过渡的时间曲线(默认<span class="selector-tag">ease</span>);</span><br><span class="line"><span class="selector-tag">transition-delay</span>: 延迟时间(默认0);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 简写形式： */</span></span><br><span class="line"><span class="selector-tag">transition</span>： <span class="selector-tag">CSS</span>属性，花费时间，效果曲线(默认<span class="selector-tag">ease</span>)，延迟时间(默认0)</span><br></pre></td></tr></table></figure>

<h2 id="栗子-🌰"><a href="#栗子-🌰" class="headerlink" title="栗子 🌰"></a>栗子 🌰</h2><h3 id="单个属性的变化-—-gt-按钮-hover-效果"><a href="#单个属性的变化-—-gt-按钮-hover-效果" class="headerlink" title="单个属性的变化 —&gt; 按钮 :hover 效果"></a>单个属性的变化 —&gt; 按钮 :hover 效果</h3><p>下面的两个按钮，在鼠标移入时都被设置了 <code>background: yellow;</code> 样式。但只给第一个加上了 <code>transition: background 2s;</code> 属性，意思是如果背景发生变化，则给2s的过渡效果。</p>
<iframe height="265" scrolling="no" title="XGvqMB" src="https://codepen.io/JingW/embed/XGvqMB/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="多个属性的变化-—-gt-单独设置"><a href="#多个属性的变化-—-gt-单独设置" class="headerlink" title="多个属性的变化 —&gt; 单独设置"></a>多个属性的变化 —&gt; 单独设置</h3><p>针对多个属性设置过渡效果，用逗号隔开就好。下面案例鼠标移入后，使正方形过渡到圆形，且颜色逐渐变浅，核心代码：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">background</span> .5<span class="selector-tag">s</span> <span class="selector-tag">ease-out</span>, <span class="selector-tag">border-radius</span> .5<span class="selector-tag">s</span> <span class="selector-tag">ease-in</span>;</span><br></pre></td></tr></table></figure>



<iframe height="265" scrolling="no" title="transition-多属性" src="https://codepen.io/JingW/embed/dLyWKM/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="多个属性的变化-gt-all"><a href="#多个属性的变化-gt-all" class="headerlink" title="多个属性的变化 -&gt; all"></a>多个属性的变化 -&gt; all</h3><p>如果要过渡的css属性较多，可以尝试使用 all 一步搞定。下面案例中将鼠标移入正方形盒子，会使其慢慢缩小为一个圆形，且颜色逐渐变深，核心代码：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">all</span> .5<span class="selector-tag">s</span> <span class="selector-tag">ease-out</span>;</span><br></pre></td></tr></table></figure>



<iframe height="265" scrolling="no" title="transition-多属性-all" src="https://codepen.io/JingW/embed/GLRmXm/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="实用-demo"><a href="#实用-demo" class="headerlink" title="实用 demo"></a>实用 demo</h2><h3 id="下拉导航菜单"><a href="#下拉导航菜单" class="headerlink" title="下拉导航菜单"></a>下拉导航菜单</h3><iframe height="265" scrolling="no" title="transition-下拉导航" src="https://codepen.io/JingW/embed/MxNXex/?height=265&amp;theme-id=0&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS3</tag>
      </tags>
  </entry>
  <entry>
    <title>transform转换（一）</title>
    <url>/posts/45420/</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p>Transform 属性应用于元素的 2D 或 3D 转换。这个属性允许你将元素旋转，缩放，移动，倾斜等。</p>
</blockquote>
<p>———— 出自 <a href="http://www.runoob.com/cssref/css3-pr-transform.html">菜鸟教程</a></p>
<p>这次我们讨论的都是 2D 转换，3D 的后面我会单独出一篇~</p>
<a id="more"></a>

<h2 id="scale-缩放"><a href="#scale-缩放" class="headerlink" title="scale 缩放"></a>scale 缩放</h2><p>这个属性用来放大或缩小元素的大小。语法示例如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: transform <span class="number">1s</span>; <span class="comment">/* 给div的transform属性添加过渡效果 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.5</span>); <span class="comment">/* 让元素放大为原始大小的1.5倍 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<iframe height="491" scrolling="no" title="transform scale" src="https://codepen.io/JingW/embed/eoBPYP/?height=491&amp;theme-id=0&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="translate-位移"><a href="#translate-位移" class="headerlink" title="translate 位移"></a>translate 位移</h2><p>该属性用来让元素向上/向下/向左/向右进行位移。</p>
<p>示例：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">20px</span>, <span class="number">20px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<iframe height="569" scrolling="no" title="LvbqKb" src="https://codepen.io/JingW/embed/LvbqKb/?height=569&amp;theme-id=0&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="rotate-旋转"><a href="#rotate-旋转" class="headerlink" title="rotate 旋转"></a>rotate 旋转</h2><p>该属性让元素能够顺时针或逆时针旋转指定的度数。</p>
<p>示例：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">720deg</span>); <span class="comment">/* 元素顺时针旋转720度 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<iframe height="265" scrolling="no" title="transform rotate" src="https://codepen.io/JingW/embed/BEQELy/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="skew-倾斜"><a href="#skew-倾斜" class="headerlink" title="skew 倾斜"></a>skew 倾斜</h2><p>该属性能够让元素基于 x, y 轴倾斜转换</p>
<p>示例：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">skew</span>(<span class="number">45deg</span>, <span class="number">45deg</span>);</span><br><span class="line">  <span class="comment">/* transform: skewX(25deg);</span></span><br><span class="line"><span class="comment">    transform: skewY(10deg); */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<iframe height="265" scrolling="no" title="transform skew" src="https://codepen.io/JingW/embed/YMpMQM/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<p><strong>注意：</strong> 如果仔细观察上面的示例，当鼠标移入 box 后，不但整个 box 进行了倾斜，里面的子元素和文本内容也会发生倾斜。如果不希望里面的内容发生变化，可以使用相反的 skew 值将其恢复：</p>
<iframe height="265" scrolling="no" title="transform skew2" src="https://codepen.io/JingW/embed/bJBJQg/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="transform-origin-变形原点"><a href="#transform-origin-变形原点" class="headerlink" title="transform-origin 变形原点"></a>transform-origin 变形原点</h2><p>该属性可以配合 <code>transform</code> 属性一起使用，它允许我们指定元素转换的位置原点。默认情况原点位于元素的中心。</p>
<p>例如刚刚上面在讲到 rotate 属性时，我们的旋转是以中心为原点的。但你在某些情况下可能并不想让元素围绕中心旋转，而是左上角旋转，就可以用到该属性。</p>
<p>语法示例：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">transform-origin</span>: left top;</span><br><span class="line">  <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">720deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<iframe height="483" scrolling="no" title="transform transform-origin" src="https://codepen.io/JingW/embed/qwqGxO/?height=483&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="变换组合"><a href="#变换组合" class="headerlink" title="变换组合"></a>变换组合</h2><p>有时候我们可能想要一个元素既旋转又位移，那么我们就可以使用 transform 的简写语法：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">90deg</span>) <span class="built_in">scale</span>(<span class="number">1.5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<iframe height="265" scrolling="no" title="ZZBNmN" src="https://codepen.io/JingW/embed/ZZBNmN/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS3</tag>
      </tags>
  </entry>
  <entry>
    <title>transition过渡（二）</title>
    <url>/posts/13167/</url>
    <content><![CDATA[<h2 id="传送门"><a href="#传送门" class="headerlink" title="传送门"></a>传送门</h2><ul>
<li><a href="https://evestorm.github.io/posts/24967/">transition过渡（一）</a></li>
<li><a href="https://evestorm.github.io/posts/13167/">transition过渡（二）</a></li>
</ul>
<p>上篇文章是对 transition过渡 的一个简单介绍和使用。这篇文章就来聊聊具体属性的含义和用法。</p>
<a id="more"></a>

<h2 id="transition-property-过渡属性"><a href="#transition-property-过渡属性" class="headerlink" title="transition-property 过渡属性"></a>transition-property 过渡属性</h2><p>从上一篇文章能够知道 transition-property 是拿来设置元素中参与过渡的属性的。它的可选值为：</p>
<ul>
<li>none 指所有属性都不参与过渡</li>
<li>all 指所有属性都参与过渡</li>
<li>[IDENT] 指定个别属性参与过渡</li>
</ul>
<p>下面来看一个案例：</p>
<p>👇温馨提示：为了方便看效果，可点击 <code>CSS</code> 按钮折叠代码部分，仅显示页面 👇</p>
<iframe height="265" scrolling="no" title="transition-property-demo1" src="https://codepen.io/JingW/embed/oONwww/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<p>当你依次将鼠标移入上方演示demo中的三个按钮就会发现，都在各自下方显示出了一段文本。我们想要实现的，就是这段文本的显示需要有一个过渡效果，不要太生硬。最简单的一种实现方案就是鼠标移入按钮前，文本容器的 <code>height: 0</code> ，鼠标移入后固定容器高度 <code>height: 150px</code> （第一个按钮效果就用的此方案）。但在实际情况中，往往文本是自适应的，高度无法确定，所以很自然的，我们会想到将 <code>height: 150px</code> 设置为 <code>height: auto</code> ，这样不就能够实现自适应高度的容器过渡了嘛，这就是第二个按钮的一套实现方案。但结果大家都知道了，文本容器不再拥有过渡的动画，而是直接从 <code>0px</code> 瞬间变化到 <code>auto</code>，这是为什么呢？</p>
<p><strong>答案</strong>：并不是所有的属性和属性值都能存在过渡动画。</p>
<p>这里特别需要注意的是，如果想要指定某个属性有过渡状态，就需要保证我们能够计算出过渡过程中每个时间点的属性值。<br>比如，从 <code>height: 0;</code> 过渡到 <code>height: 150px;</code> ，过渡时间是 <code>t</code> ，那我们可以算出在 <code>x</code> 时刻的属性状态是 <code>height: (150px-0)*x/t;</code> 。（注：这里公式成立的前提是假设 <code>transition-timing-function: linear;</code> ，如果<code>transition-timing-function</code> 为其他值，一样可以计算，只不过算法不同）<br>然而刚才第二种方案设置了 <code>height: auto;</code>，则在 <code>x</code> 时刻的属性状态为 <code>height: (auto-0px)*x/t;</code> ，显然，这种状态是不存在的、无法被计算的，因此在设置高度变成 <code>auto</code> 之后，也自然不会再有过渡动画了。</p>
<p><strong>解决方案</strong></p>
<p>第三个按钮的效果就是我们的一种解决方案，在默认状态下，我们不设置文本容器的 <code>height: 0</code> ，而是用 <code>transform: scale(1, 0);</code> 来代替它，意思是在初始状态下，我们的文本容器比例为宽1:1，高1:0，换句话说，宽为我们设置的宽，但高度为0。在鼠标移入按钮后，用 <code>transform: scale(1, 1);</code> 来代替方案二中的 <code>height: auto</code> ，设置文本容器的宽高为1，这样就又能出现过渡动画了。</p>
<p><strong>延伸</strong></p>
<p>由此进行延伸，再比如日常中最常使用的控制元素显示隐藏的代码是 <code>display: block;</code> 和 <code>display: none;</code> ，这也是不存在过渡动画的，因此，可以调整改为使用 <code>opacity: 1;</code> 和 <code>opacity: 0;</code> 来替换。</p>
<h2 id="transition-duration-过渡花费的时间"><a href="#transition-duration-过渡花费的时间" class="headerlink" title="transition-duration 过渡花费的时间"></a>transition-duration 过渡花费的时间</h2><p>这个属性没什么可讲的，用它来设置元素过渡的持续时间</p>
<h2 id="transition-timing-function-效果曲线"><a href="#transition-timing-function-效果曲线" class="headerlink" title="transition-timing-function 效果曲线"></a>transition-timing-function 效果曲线</h2><p>这个属性是设置过渡的动画类型的，换句话说，就是设置在过渡过程中元素值的变化速度。它的可选值包含这样几组：</p>
<ul>
<li>ease | linear | ease-in | ease-out | ease-in-out</li>
<li>step-start | step-end | steps([, [ start | end ] ]?)</li>
<li>cubic-bezier(, , , )</li>
</ul>
<h3 id="预设的五个时间曲线"><a href="#预设的五个时间曲线" class="headerlink" title="预设的五个时间曲线"></a>预设的五个时间曲线</h3><iframe height="519" scrolling="no" title="transition-timing-function-五个预设时间曲线" src="https://codepen.io/JingW/embed/dLyjoN/?height=519&amp;theme-id=0&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="阶跃函数-step"><a href="#阶跃函数-step" class="headerlink" title="阶跃函数 step"></a>阶跃函数 step</h3><p>直接上案例吧，看完效果再来讲阶跃函数几个参数的具体含义：</p>
<iframe height="413" scrolling="no" title="transition-timing-function-阶跃函数" src="https://codepen.io/JingW/embed/PgwWXd/?height=413&amp;theme-id=0&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<p>实际体验了阶跃函数带来的效果后应该对其有个大概认知了吧。阶跃函数接收两个参数，第一个参数为<strong>正整数</strong>，指定阶跃函数的间隔数，你可以理解为把整个过渡过程拆成若干份儿；第二个参数可选，值为<code>[ start | end ]</code>，叫做跃点，指定是在每个间隔的起点还是终点发生阶跃变化，默认值为<code>end</code>。<br>查看上面案例的css代码，你会发现两种 <code>steps</code> 的简写形式：<code>step-start</code> 和 <code>step-end</code> ，它们分别等同于：<code>step-start = steps(1, start)</code> 和 <code>step-end = steps(1, end)</code> 。</p>
<h3 id="cubic-bezier-贝塞尔曲线函数"><a href="#cubic-bezier-贝塞尔曲线函数" class="headerlink" title="cubic-bezier 贝塞尔曲线函数"></a>cubic-bezier 贝塞尔曲线函数</h3><p>贝塞尔曲线函数接收四个参数，取值范围是 0 到 1 之间的数值（包括0和1）。</p>
<p>贝塞尔曲线函数，其实定义的是 <strong>属性状态</strong> 与 <strong>时间</strong> 的一个关系函数。如下坐标轴所示：</p>
<img src="/posts/13167/cubic05000510.png" class="" title="cubic-bezier">

<p>上图坐标轴中横坐标是时间，纵坐标是属性状态，右上角的坐标是(1,1)。在时间曲线中的每一个点，表示的就是对应时刻下属性的取值，每个点的斜率表示的就是在这个时刻属性的变化速度，因此在时间曲线中<strong>斜率越小</strong>，也就是<strong>越平缓</strong>的地方，表示<strong>属性变化速度越慢</strong>；<strong>斜率越大</strong>，也就是<strong>越陡峭</strong>的地方，表示<strong>属性变化速度越快</strong>。如上图中开始跟结束的时候，斜率都比较小，而中间的阶段，斜率比较大，因此这个曲线表示的就是在变化过程中由慢到快再到慢的一个过程。</p>
<p>回到贝塞尔曲线函数接收的四个参数上，前两个是上图中红色点的坐标(x1,y1)，后两个是图中蓝色点的坐标(x2,y2)，也就是 <code>cubic-bezier(x1, y1, x2, y2)</code> 这样的形式。我们可以在 <a href="http://cubic-bezier.com/">http://cubic-bezier.com/</a> 这个工具上来调整我们独特的贝塞尔曲线，通过拖拽红色跟蓝色点，可以形成不一样的贝塞尔曲线。我们发现，其实规定取值范围在[0,1]之间，针对的是<strong>x坐标</strong>，也就是<strong>时间</strong>，因为时间如果超过了这个范围，就会出现在同一个时刻对应了两个不同的属性状态，这个是没有意义的；而y坐标是可以超过这个范围的，如下我们通过拖拽两个点形成了这样一个曲线：</p>
<img src="/posts/13167/cubic55465149.png" class="" title="cubic-bezier">

<p>它表示的是在过渡过程中属性值会超过终止状态的设定值然后再回到终点位置，表现为回弹的效果。大家可以在 <a href="http://cubic-bezier.com/">http://cubic-bezier.com/</a> 上自己拖动两个点尝试一下，最后点击 go 按钮查看效果。</p>
<p>上面两个图的demo效果：</p>
<iframe height="265" scrolling="no" title="transition-timing-function-贝塞尔曲线" src="https://codepen.io/JingW/embed/KYwqgb/?height=265&amp;theme-id=0&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="transition-delay-延迟"><a href="#transition-delay-延迟" class="headerlink" title="transition-delay 延迟"></a>transition-delay 延迟</h2><p>这个属性同样没啥讲的，用它来设置元素延迟过渡的时间。</p>
<h2 id="transition-的不足"><a href="#transition-的不足" class="headerlink" title="transition 的不足"></a>transition 的不足</h2><ul>
<li>无法在页面加载的时候自动触发，因为只有当属性值发生改变的时候才会触发过渡动画。</li>
<li>无法重复播放过渡动画，除非再次触发过渡事件。</li>
<li>无法设置多种状态（keyframes 只有 from，to），只能从初始状态过渡到终止状态，无法再设置其他的状态。</li>
<li>transition 规则作用的是单个属性的过渡状态，不能涉及多个属性，即使定义了 <code>transition: all 1s ease 0s;</code> 这样的规则，其对应的每个属性过渡动画也都是相互独立，相当于是定义了很多个 transition 规则，而每个 transition 只作用于一个属性。</li>
</ul>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><ul>
<li><a href="https://easings.net/en#">Easing Functions Cheat Sheet</a></li>
<li><a href="http://cubic-bezier.com/">cubic-bezier</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS3</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu下nginx基本使用</title>
    <url>/posts/36876/</url>
    <content><![CDATA[<h2 id="安装-Nginx"><a href="#安装-Nginx" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h2><p>终端键入以下命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure>

<p>安装完成后查看版本：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo nginx -v</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nginx version: nginx/1.14.0 (Ubuntu)</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h2><p>如果你服务器打开了防火墙，则还需要打开端口 80 和 443。然后键入：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw allow &#x27;Nginx Full&#x27;</span><br></pre></td></tr></table></figure>

<p>你可以通过下面方式验证更改：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw status</span><br></pre></td></tr></table></figure>

<p>如果出现：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Nginx Full                ALLOW      Anywhere</span><br><span class="line">Nginx Full (v6)            ALLOW      Anywhere (v6)</span><br></pre></td></tr></table></figure>

<p>就说明更改成功。</p>
<h2 id="测试安装"><a href="#测试安装" class="headerlink" title="测试安装"></a>测试安装</h2><p>浏览器中打开 <a href="http://your_ip/">http://your_ip</a> ，就能够看到默认的 Nginx 欢迎页面</p>
<h2 id="使用-systemctl-管理-Nginx-服务"><a href="#使用-systemctl-管理-Nginx-服务" class="headerlink" title="使用 systemctl 管理 Nginx 服务"></a>使用 systemctl 管理 Nginx 服务</h2><p>你可以像任何其他 systemd 命令一样管理 Nginx 服务。 要停止 Nginx 服务，运行：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl stop nginx</span><br></pre></td></tr></table></figure>

<p>要再次启动，请键入：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl start nginx</span><br></pre></td></tr></table></figure>

<p>重新启动 Nginx 服务：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>在进行一些配置更改后重新加载 Nginx 服务：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure>

<p>如果你想禁用 Nginx 服务在启动时启动：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl disable nginx</span><br></pre></td></tr></table></figure>

<p>并重新启用它：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl enable nginx</span><br></pre></td></tr></table></figure>

<p>以上参考来源：<a href="https://www.linuxidc.com/Linux/2018-05/152257.htm">如何在 Ubuntu 18.04 上安装 Nginx</a></p>
<h2 id="配置-404"><a href="#配置-404" class="headerlink" title="配置 404"></a>配置 404</h2><p><code>/etc/nginx/sites-enabled/default</code> 中添加：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80 default_server;</span><br><span class="line">  listen [::]:80 default_server ipv6only=on;</span><br><span class="line"></span><br><span class="line">  . . .</span><br><span class="line"></span><br><span class="line">  error_page 404 /custom_404.html; # 也可以跳转一个其他页面：http://www.baidu.com</span><br><span class="line">  location = /custom_404.html &#123;</span><br><span class="line">          root /usr/share/nginx/html;</span><br><span class="line">          internal;</span><br><span class="line">          allow 118.232.21.221; # 允许谁访问</span><br><span class="line">          deny 118.245.21.123; # 禁止这个 ip 访问</span><br><span class="line">          # 如果有 deny all 这样一个命令，且在 allow 代码的上方，那么即使写了 allow 也不会生效。</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location = /img &#123;</span><br><span class="line">    allow all; # 允许所有人访问(p.s. 当服务器根目录没有img文件夹时，会跳转404页面)</span><br><span class="line">  &#125;</span><br><span class="line">  location = /admin &#123;</span><br><span class="line">    deny all; # 假如有个admin目录，不希望被人访问时设置。当有人访问时，报403禁止访问错误</span><br><span class="line">  &#125;</span><br><span class="line">  location ~ \.php$ &#123;</span><br><span class="line">    deny all; # 正则表达式匹配的方式禁止他人访问 .php 结尾的文件</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://www.centos.bz/2017/03/nginx-error_page-custom-404-50x/">使用 Nginx 的 error_page 指令自定义 404 50x 错误页面</a></p>
<h2 id="关闭自启服务，比如打印机"><a href="#关闭自启服务，比如打印机" class="headerlink" title="关闭自启服务，比如打印机"></a>关闭自启服务，比如打印机</h2><p>先安装一个类 GUI 软件，可以管理自启：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get. install sysv-rc-conf</span><br></pre></td></tr></table></figure>

<p>输入命令 sysv-rc-conf，可以管理开机启动程序。<br>带 x 的都是开机启动的</p>
<p>参考：<a href="https://zhidao.baidu.com/question/509705858.html">如何关闭 ubuntu 不必要的开机启动程序</a></p>
<h2 id="配置虚拟主机："><a href="#配置虚拟主机：" class="headerlink" title="配置虚拟主机："></a>配置虚拟主机：</h2><p>p.s. 默认 nginx 网站根目录为 <code>var/www/html</code></p>
<h3 id="基于端口号的配置"><a href="#基于端口号的配置" class="headerlink" title="基于端口号的配置"></a>基于端口号的配置</h3><p>进入 <code>etc/nginx/sites-available</code> 目录下，新建一个配置，命名为 test ：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim test</span><br></pre></td></tr></table></figure>

<blockquote>
<p>test</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> server配置</span></span><br><span class="line">server &#123;</span><br><span class="line">  listen 8001; # 每行命令结束别忘了加 ; 分号</span><br><span class="line">  listen [::]:8001;</span><br><span class="line"></span><br><span class="line">  server_name localhost;    #你配置的对应的域名</span><br><span class="line">  root /var/www/html/html8001;    #记得在该目录下新建这个文件夹以及默认index.html文件</span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> 你的默认index文件</span></span><br><span class="line">  index index.html</span><br><span class="line"><span class="meta">  #</span><span class="bash">你的root文件所在的地址</span></span><br><span class="line">  location / &#123;</span><br><span class="line">  	try_files $uri $uri/ =404;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>保存退出。</p>
<p>然后在终端停掉 nginx 再重开：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nginx -s quit</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure>

<p><strong>❗️ 注意：</strong>如果你开启了防火墙，记得把配置的 8001 端口开放出来：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw allow 8001/tcp</span><br></pre></td></tr></table></figure>

<p>另外还需在阿里云的安全组规则中把 8001 端口开发出来。</p>
<h3 id="基于-IP-的配置"><a href="#基于-IP-的配置" class="headerlink" title="基于 IP 的配置"></a>基于 IP 的配置</h3><p>把上面 test 文件中的 <code>server_name</code> 改为你的其他 IP 就好。</p>
<h3 id="基于域名的配置"><a href="#基于域名的配置" class="headerlink" title="基于域名的配置"></a>基于域名的配置</h3><p>还是以上面的 <code>test</code> 文件为例，只需要把 <code>server_name</code> 改为你的域名就好。</p>
<p>除此之外，你还需要配置域名解析，例如你使用了阿里云 ECS，那么你需要访问阿里云的域名解析添加记录：</p>
<p>在阿里云的控制台中找到域名管理，然后选择顶级域名 evelance.cn 后面的“解析”字样。在新打开的页面中我们可以看到一个提供域名解析的界面，选择解析类型为 A 类解析，然后输入 mall（我们想要的二级域名的头），然后在地址里面输入我们刚才查看到的 ECS 的公网 ip，然后点击确认，之后我们的解析就会生效了。</p>
<h2 id="使用-Nginx-反向代理"><a href="#使用-Nginx-反向代理" class="headerlink" title="使用 Nginx 反向代理"></a>使用 Nginx 反向代理</h2><p>仍然以 <code>test</code> 文件为例，示例配置如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 8001;</span><br><span class="line">  listen [::]:8001;</span><br><span class="line"></span><br><span class="line">  server_name nginx.evelance.cn;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass http://www.bilibili.com;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Nginx-适配-PC-和移动设备"><a href="#Nginx-适配-PC-和移动设备" class="headerlink" title="Nginx 适配 PC 和移动设备"></a>Nginx 适配 PC 和移动设备</h2><ol>
<li><p>在 <code>/var/www/</code> 目录下新建两个文件夹，分别为：<code>pc</code> 和 <code>mobile</code> 目录：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /var/www</span><br><span class="line">mkdir pc</span><br><span class="line">mkdir mobile</span><br></pre></td></tr></table></figure>
</li>
<li><p>分别在两个目录下新建 <code>index.html</code> 文件并对应键入下面文字以示区分：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是PC<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是Mobile<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>进入 <code>/etc/nginx/sites-enabled/</code> 目录，还是以 <code>test</code> 文件作为示例：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 8001;</span><br><span class="line">  listen [::]:8001;</span><br><span class="line"></span><br><span class="line">  server_name nginx.evelance.cn;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    root /var/www/pc;</span><br><span class="line">    if ($http_user_agent ~* &#x27;(Android|webOS|iPhone|iPod|BlackBerry)&#x27;) &#123;</span><br><span class="line">      root /var/www/mobile;</span><br><span class="line">    &#125;</span><br><span class="line">    index index.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启 nginx ：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nginx -s quit</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="启用-gzip"><a href="#启用-gzip" class="headerlink" title="启用 gzip"></a>启用 gzip</h2><p>进入 <code>/etc/nginx</code> 目录，通过 vim 编辑 <code>nginx.conf</code> 文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /etc/nginx</span><br><span class="line">vim nginx.conf</span><br></pre></td></tr></table></figure>

<p>找到 Gzip Settings 项，发现 nginx 默认是开启 gzip 的：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gzip on;</span><br></pre></td></tr></table></figure>

<p>但我们发现 gzip_types 配置项是被注释了的，所以我们只需要解开注释就好：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gzip_types text/plain text/css application/json application/javascript text/html application/xml text/javascript;</span><br></pre></td></tr></table></figure>

<p>最后重启 nginx</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nginx -s quit</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>后端</category>
        <category>服务器</category>
      </categories>
      <tags>
        <tag>笔记</tag>
        <tag>Nginx</tag>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu下开启/关闭防火墙及端口的命令(笔记)</title>
    <url>/posts/60660/</url>
    <content><![CDATA[<h2 id="开启防火墙"><a href="#开启防火墙" class="headerlink" title="开启防火墙"></a>开启防火墙</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw enable</span><br></pre></td></tr></table></figure>

<h2 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw disable</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="重启防火墙"><a href="#重启防火墙" class="headerlink" title="重启防火墙"></a>重启防火墙</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure>

<h2 id="查看端口开启状态"><a href="#查看端口开启状态" class="headerlink" title="查看端口开启状态"></a>查看端口开启状态</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw status</span><br></pre></td></tr></table></figure>

<h2 id="开启某个端口"><a href="#开启某个端口" class="headerlink" title="开启某个端口"></a>开启某个端口</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw allow 8001/tcp</span><br></pre></td></tr></table></figure>

<h2 id="禁止外部某个端口"><a href="#禁止外部某个端口" class="headerlink" title="禁止外部某个端口"></a>禁止外部某个端口</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw delete allow 8001/tcp</span><br></pre></td></tr></table></figure>

<h2 id="查看端口-ip"><a href="#查看端口-ip" class="headerlink" title="查看端口 ip"></a>查看端口 ip</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netstat -ltn</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>后端</category>
        <category>服务器</category>
      </categories>
      <tags>
        <tag>笔记</tag>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app=&gt;Class与Style绑定</title>
    <url>/posts/53020/</url>
    <content><![CDATA[<h2 id="Class-类和-Style-通过值快速切换"><a href="#Class-类和-Style-通过值快速切换" class="headerlink" title="Class 类和 Style 通过值快速切换"></a>Class 类和 Style 通过值快速切换</h2><p>uni 官方和 vue 文档有不明之出，官方已指出</p>
<a id="more"></a>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;content f f-wrap&quot;</span>&gt;</span></span><br><span class="line">    &lt;image</span><br><span class="line">      class=&quot;logo&quot;</span><br><span class="line">      src=&quot;../../static/image/myHover.png&quot;</span><br><span class="line">      @click=&quot;tap&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            前：样式</span></span><br><span class="line"><span class="comment">            后：控制:显示/隐藏</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 单类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; active: isActive &#125;&quot;</span>&gt;</span>111<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;static&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; active: isActive, &#x27;text-danger&#x27;: hasError &#125;&quot;</span>&gt;</span></span><br><span class="line">      222</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 数组 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;static&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;[activeClass, errorClass]&quot;</span>&gt;</span>333<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 条件 --&gt;</span></span><br><span class="line">    &lt;view</span><br><span class="line">      class=&quot;static&quot;</span><br><span class="line">      v-bind:class=&quot;[isActive ? activeClass : &#x27;&#x27;, errorClass]&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      444</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 数组+对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;static&quot;</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;[&#123; activeGrey: isActive &#125;, errorClass]&quot;</span>&gt;</span></span><br><span class="line">      555</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 执行类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;computedClassStr&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;activeGrey: isActive&#125;&quot;</span>&gt;</span>9999<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- style支持的类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-bind:style</span>=<span class="string">&quot;&#123; color: activeColor, fontSize: fontSize + &#x27;px&#x27; &#125;&quot;</span>&gt;</span></span><br><span class="line">      666</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-bind:style</span>=<span class="string">&quot;[&#123; color: activeColor, fontSize: fontSize + &#x27;px&#x27; &#125;]&quot;</span>&gt;</span></span><br><span class="line">      777</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        title: <span class="string">&#x27;Hello&#x27;</span>,</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 单激活类</span></span></span><br><span class="line"><span class="javascript">        isActive: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">        hasError: <span class="literal">true</span>,</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 多种激活类</span></span></span><br><span class="line">        activeClass: &#123;</span><br><span class="line"><span class="javascript">          active: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">&#x27;text-danger&#x27;</span>: <span class="literal">true</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        errorClass: &#123;</span><br><span class="line"><span class="javascript">          active: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">&#x27;text-danger&#x27;</span>: <span class="literal">false</span></span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">        activeColor: <span class="literal">true</span>,</span></span><br><span class="line">        fontSize: 30</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.fetchData();</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;页面加载&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">onShow</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;页面显示&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">onReady</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;页面初次显示&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">onHide</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;页面隐藏&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">onUnload</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;页面卸载&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">onBackPress</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;页面返回...&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">onShareAppMessage</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;分享!&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">onReachBottom</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;下拉加载...&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">onPageScroll</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;页面滚动...&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">onPullDownRefresh</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;上拉刷新...&#x27;</span>);</span></span><br><span class="line">      uni.stopPullDownRefresh();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// #ifdef APP-PLUS</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">onNavigationBarButtonTap</span>(<span class="params"></span>)</span> &#123;&#125;,</span></span><br><span class="line"><span class="javascript">    <span class="comment">// #endif</span></span></span><br><span class="line"></span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">tap</span>(<span class="params">e</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&#x27;tap点击!&#x27;</span>, e);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">fetchData</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&#x27;拉取数据...&#x27;</span>);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">computedClassStr</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">this</span>.isActive ? <span class="string">&#x27;actives&#x27;</span> : <span class="string">&#x27;active&#x27;</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.active</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#f00</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.activeGrey</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#aaa</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.text-danger</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#f0f</span>;</span></span><br><span class="line">    font-weight: bold;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.f</span> &#123;</span></span><br><span class="line">    display: flex;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.f-wrap</span> &#123;</span></span><br><span class="line">    flex-wrap: wrap;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过模板<strong>（template-style-css）</strong>端控制模板</p>
<img src="/posts/53020/template-style-css.png" class="" title="template-style-css">

<p>通过控制端<strong>（JS-style-css）</strong>来控制行为</p>
<img src="/posts/53020/js-style-css.png" class="" title="js-style-css">

<p>通过<strong>（CSS）</strong>显示端进行显示</p>
<img src="/posts/53020/css-style-css.png" class="" title="css-style-css">
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>uniapp</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app引用高德地图</title>
    <url>/posts/30327/</url>
    <content><![CDATA[<h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> amap <span class="keyword">from</span> <span class="string">&#x27;@/lib/amap/amap-wx.js&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">myAmapFun = <span class="keyword">new</span> amap.AMapWX(&#123;</span><br><span class="line">  key: <span class="built_in">this</span>.key <span class="comment">//该key 是在高德中申请的微信小程序key</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="获取当前定位信息"><a href="#获取当前定位信息" class="headerlink" title="获取当前定位信息"></a>获取当前定位信息</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.myAmapFun.getRegeo(&#123;</span><br><span class="line">  citylimit: <span class="literal">true</span>, <span class="comment">//仅返回指定城市数据</span></span><br><span class="line">  success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res[<span class="number">0</span>].regeocodeData.addressComponent); <span class="comment">// 获取当前位置提示信息</span></span><br><span class="line">    <span class="built_in">console</span>.log(res[<span class="number">0</span>].regeocodeData.pois); <span class="comment">//获取的周边提示信息</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail: <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    uni.showToast(&#123;</span><br><span class="line">      title: <span class="string">&#x27;获取当前定位失败,请手动输入查询&#x27;</span>,</span><br><span class="line">      icon: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="通过输入词，查询周边地址"><a href="#通过输入词，查询周边地址" class="headerlink" title="通过输入词，查询周边地址"></a>通过输入词，查询周边地址</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">myAmapFun.getInputtips(&#123;</span><br><span class="line">  keywords: <span class="string">&#x27;&#x27;</span>, <span class="comment">//输入的words</span></span><br><span class="line">  city: <span class="built_in">this</span>.addressData.cityName, <span class="comment">//指定城市数据</span></span><br><span class="line">  extensions: <span class="string">&#x27;all&#x27;</span>, <span class="comment">//返回地址描述以及附近兴趣点和道路信息，默认&quot;base&quot;</span></span><br><span class="line">  success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (res &amp;&amp; res.tips) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>uniapp</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>uniapp-mock数据</title>
    <url>/posts/59363/</url>
    <content><![CDATA[<p>目前我们公司的页面结构规定的是一个页面一个单独文件夹，并且将页面文件拆成三个，例如：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.homePage/</span><br><span class="line">├── homePage.js</span><br><span class="line">├── homePage.less</span><br><span class="line">└── homePage.vue</span><br></pre></td></tr></table></figure>

<p>所以数据的模拟为了更方便维护，放在对应页面文件夹中再好不过了，下面是实现页面加载 mock 数据的步骤：</p>
<h2 id="方案-1"><a href="#方案-1" class="headerlink" title="方案 1"></a>方案 1</h2><h3 id="1-建立-json-数据"><a href="#1-建立-json-数据" class="headerlink" title="1. 建立 json 数据"></a>1. 建立 json 数据</h3><p>以 <code>homePage</code> 为例，在该文件夹下新建 <code>mock.json</code> 文件；</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;cardData&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;count&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;carditem&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;GK100107900000193&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;测试表单填写限制&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;describe&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;time&quot;</span>: <span class="string">&quot;2020-03-13 16:13:02&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;visitCount&quot;</span>: <span class="number">11</span>,</span><br><span class="line">        <span class="attr">&quot;conversionCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;conversionRatio&quot;</span>: <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;GK105645500000191&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;2.25营销&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;describe&quot;</span>: <span class="string">&quot;2月24日0—24时，31个省（自治区、直辖市）和新疆生产建设兵团报告新增确诊病例508例，新增死亡病例71例（湖北68例，山东2例，广东1例），新增疑似病例530例&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;time&quot;</span>: <span class="string">&quot;2020-02-25 13:41:26&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;visitCount&quot;</span>: <span class="number">21</span>,</span><br><span class="line">        <span class="attr">&quot;conversionCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;conversionRatio&quot;</span>: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;generalData&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;sendPeopleData&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;detailData&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="在-homePage-js-页面中使用"><a href="#在-homePage-js-页面中使用" class="headerlink" title="在 homePage.js 页面中使用"></a>在 <code>homePage.js</code> 页面中使用</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引用</span></span><br><span class="line"><span class="keyword">import</span> mockData <span class="keyword">from</span> <span class="string">&#x27;./mock.json&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">let</span> result = mockData.cardData;</span><br></pre></td></tr></table></figure>

<h2 id="方案-2"><a href="#方案-2" class="headerlink" title="方案 2"></a>方案 2</h2><p>不使用 json 而使用 js 。</p>
<h3 id="建立-js-文件"><a href="#建立-js-文件" class="headerlink" title="建立 js 文件"></a>建立 js 文件</h3><p>还是以 <code>homePage</code> 为例，在该文件夹下新建 <code>mock.json.js</code> 文件；</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> mockData = &#123;</span><br><span class="line">  cardData: &#123;</span><br><span class="line">    count: <span class="number">2</span>,</span><br><span class="line">    carditem: [</span><br><span class="line">      &#123;</span><br><span class="line">        id: <span class="string">&#x27;GK100107900000193&#x27;</span>, <span class="comment">// 优惠券会员卡营销页的ID</span></span><br><span class="line">        name: <span class="string">&#x27;测试表单填写限制&#x27;</span>, <span class="comment">// 优惠券会员卡营销页的Name</span></span><br><span class="line">        describe: <span class="literal">null</span>, <span class="comment">// 优惠券会员卡营销页的描述.</span></span><br><span class="line">        time: <span class="string">&#x27;2020-03-13 16:13:02&#x27;</span>, <span class="comment">// 优惠券会员卡营销页的时间.</span></span><br><span class="line">        visitCount: <span class="number">11</span>, <span class="comment">// 访问量下载量.</span></span><br><span class="line">        conversionCount: <span class="number">0</span>, <span class="comment">// 转化量.</span></span><br><span class="line">        conversionRatio: <span class="number">0</span> <span class="comment">// 转化率.</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id: <span class="string">&#x27;GK105645500000191&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;2.25营销&#x27;</span>,</span><br><span class="line">        describe:</span><br><span class="line">          <span class="string">&#x27;2月24日0—24时，31个省（自治区、直辖市）和新疆生产建设兵团报告新增确诊病例508例，新增死亡病例71例（湖北68例，山东2例，广东1例），新增疑似病例530例&#x27;</span>,</span><br><span class="line">        time: <span class="string">&#x27;2020-02-25 13:41:26&#x27;</span>,</span><br><span class="line">        visitCount: <span class="number">21</span>,</span><br><span class="line">        conversionCount: <span class="number">0</span>,</span><br><span class="line">        conversionRatio: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  generalData: <span class="literal">null</span>,</span><br><span class="line">  sendPeopleData: <span class="literal">null</span>,</span><br><span class="line">  detailData: <span class="literal">null</span>,</span><br><span class="line">  id: <span class="literal">null</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> mockData;</span><br></pre></td></tr></table></figure>

<h3 id="在-homePage-js-页面中使用-1"><a href="#在-homePage-js-页面中使用-1" class="headerlink" title="在 homePage.js 页面中使用"></a>在 <code>homePage.js</code> 页面中使用</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引用</span></span><br><span class="line"><span class="keyword">import</span> mockData <span class="keyword">from</span> <span class="string">&#x27;./mock.json.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">let</span> result = mockData.cardData;</span><br></pre></td></tr></table></figure>

<p>如果要不想集中编写，而是分散定义多个 mock 数据变量，可以写成下面形式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> cardData = &#123;</span><br><span class="line">  count: <span class="number">2</span>,</span><br><span class="line">  carditem: [</span><br><span class="line">    &#123;</span><br><span class="line">      id: <span class="string">&#x27;GK100107900000193&#x27;</span>, <span class="comment">// 优惠券会员卡营销页的ID</span></span><br><span class="line">      name: <span class="string">&#x27;测试表单填写限制&#x27;</span>, <span class="comment">// 优惠券会员卡营销页的Name</span></span><br><span class="line">      describe: <span class="literal">null</span>, <span class="comment">// 优惠券会员卡营销页的描述.</span></span><br><span class="line">      time: <span class="string">&#x27;2020-03-13 16:13:02&#x27;</span>, <span class="comment">// 优惠券会员卡营销页的时间.</span></span><br><span class="line">      visitCount: <span class="number">11</span>, <span class="comment">// 访问量下载量.</span></span><br><span class="line">      conversionCount: <span class="number">0</span>, <span class="comment">// 转化量.</span></span><br><span class="line">      conversionRatio: <span class="number">0</span> <span class="comment">// 转化率.</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      id: <span class="string">&#x27;GK105645500000191&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;2.25营销&#x27;</span>,</span><br><span class="line">      describe:</span><br><span class="line">        <span class="string">&#x27;2月24日0—24时，31个省（自治区、直辖市）和新疆生产建设兵团报告新增确诊病例508例，新增死亡病例71例（湖北68例，山东2例，广东1例），新增疑似病例530例&#x27;</span>,</span><br><span class="line">      time: <span class="string">&#x27;2020-02-25 13:41:26&#x27;</span>,</span><br><span class="line">      visitCount: <span class="number">21</span>,</span><br><span class="line">      conversionCount: <span class="number">0</span>,</span><br><span class="line">      conversionRatio: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> generalData = &#123;</span><br><span class="line">  allMoney: <span class="number">1000.0</span>, <span class="comment">// 总金额</span></span><br><span class="line">  visitCount: <span class="number">999</span>, <span class="comment">// 总访问</span></span><br><span class="line">  orderCount: <span class="number">233</span>, <span class="comment">// 总下单次数</span></span><br><span class="line">  ratio: <span class="number">10</span> <span class="comment">// 转化率</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sendPeopleData = [</span><br><span class="line">  &#123;</span><br><span class="line">    amount: <span class="number">1000.0</span>, <span class="comment">// 总金额</span></span><br><span class="line">    name: <span class="string">&#x27;全部&#x27;</span>, <span class="comment">// 名称</span></span><br><span class="line">    orderCount: <span class="number">777</span>, <span class="comment">// 下单量</span></span><br><span class="line">    ratio: <span class="number">66.6</span>, <span class="comment">// 转化率</span></span><br><span class="line">    visitCount: <span class="number">980</span> <span class="comment">// 访问量</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> detailData = [</span><br><span class="line">  &#123;</span><br><span class="line">    amount: <span class="number">0</span>, <span class="comment">// 总金额</span></span><br><span class="line">    dataTime: <span class="string">&#x27;2020-05-18 00:00:00&#x27;</span>, <span class="comment">// 日期时间</span></span><br><span class="line">    date: <span class="string">&#x27;05.18&#x27;</span>, <span class="comment">// 日期</span></span><br><span class="line">    orderCount: <span class="number">0</span>, <span class="comment">// 下单量</span></span><br><span class="line">    visitCount: <span class="number">0</span> <span class="comment">// 访问量</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; cardData, generalData, sendPeopleData, detailData &#125;;</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> mockMulData <span class="keyword">from</span> <span class="string">&#x27;./mock-mul.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">let</span> result = mockMulData.cardData;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  cardData,</span><br><span class="line">  generalData,</span><br><span class="line">  sendPeopleData,</span><br><span class="line">  detailData</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;./mock-mul.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">let</span> result = generalData;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>两种方案都行，但推荐第二种，因为 json 格式的文件中不能有注释。而 js 的 mock 文件可以。方便阅读和维护。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>uniapp</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>uniapp-全局变量四种方式</title>
    <url>/posts/61889/</url>
    <content><![CDATA[<p><a href="https://uniapp.dcloud.io/collocation/frame/window?id=getapp">https://uniapp.dcloud.io/collocation/frame/window?id=getapp</a></p>
<p><a href="https://ask.dcloud.net.cn/article/35021">https://ask.dcloud.net.cn/article/35021</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>uniapp</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>uniapp吸顶效果</title>
    <url>/posts/7733/</url>
    <content><![CDATA[<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><img src="/posts/7733/%E5%90%B8%E9%A1%B6%E6%95%88%E6%9E%9C.gif" class="" title="吸顶效果">

<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><iframe height="502" scrolling="no" title="列表标题吸顶效果" src="https://codepen.io/JingW/embed/GRgWvKb?height=502&amp;theme-id=default&amp;default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<a id="more"></a>

<h2 id="uni-app-写法"><a href="#uni-app-写法" class="headerlink" title="uni-app 写法"></a>uni-app 写法</h2><blockquote>
<p>template 结构</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 运营概况 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;main-title&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;operationRef&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;operationRef&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>运营概况<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span>&gt;</span>我的<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span>&gt;</span>全店<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ================== 主体内容 =================== --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;overview-com&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 运营概况 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;main-title&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;operationRef&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;operationRef&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>宴会概况<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span>&gt;</span>我的<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span>&gt;</span>全店<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ================== 主体内容 =================== --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;overview-com&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">	<span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			...,</span><br><span class="line">			mainTitleEles: [], <span class="comment">// 所有mainTitle标题对象集合</span></span><br><span class="line">			mainEles: [], <span class="comment">// 所有板块对象集合</span></span><br><span class="line">			ot: [], <span class="comment">//存储每个标题的offsetTop</span></span><br><span class="line">			len: <span class="number">0</span>, <span class="comment">// 标题的个数</span></span><br><span class="line">			searchBottomY: <span class="number">0</span>, <span class="comment">// 搜索view底部距离页面顶部的距离</span></span><br><span class="line">			selectorQuery: &#123;&#125;, <span class="comment">// Uniapp SelectorQuery 对象实例</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 获取 SelectorQuery 对象实例。可以在这个实例上使用 select 等方法选择节点</span></span><br><span class="line">		<span class="built_in">this</span>.selectorQuery = uni.createSelectorQuery().in(<span class="built_in">this</span>);</span><br><span class="line">		<span class="built_in">this</span>.initFixedTop();</span><br><span class="line">	&#125;,</span><br><span class="line">	methods: &#123;</span><br><span class="line">		<span class="comment">// --------------- 监听 mescroll 页面滚动 ------------------------</span></span><br><span class="line">		<span class="comment">// 初始化吸顶标题的工作</span></span><br><span class="line">		<span class="function"><span class="title">initFixedTop</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">			<span class="comment">// 获取所有需要吸顶效果的标题</span></span><br><span class="line">			<span class="built_in">this</span>.mainTitle = <span class="built_in">this</span>.selectorQuery.selectAll(<span class="string">&#x27;.main-title&#x27;</span>);</span><br><span class="line">			uni.createSelectorQuery().selectAll(<span class="string">&#x27;.main-title&#x27;</span>).fields(&#123;</span><br><span class="line">				rect: <span class="literal">true</span>,</span><br><span class="line">				dataset: <span class="literal">true</span></span><br><span class="line">			&#125;, <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">				<span class="built_in">this</span>.mainTitleEles = res;</span><br><span class="line">				<span class="comment">// 标题的个数</span></span><br><span class="line">				<span class="built_in">this</span>.len = <span class="built_in">this</span>.mainTitleEles.length;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.len; i++) &#123;</span><br><span class="line">					<span class="built_in">this</span>.ot.push(<span class="built_in">this</span>.mainTitleEles[i].top); <span class="comment">//获取每个标题的offsetTop</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">// 获取所有需要吸顶的板块</span></span><br><span class="line">				uni.createSelectorQuery().selectAll(<span class="string">&#x27;.main&#x27;</span>).fields(&#123;</span><br><span class="line">					rect: <span class="literal">true</span>,</span><br><span class="line">					dataset: <span class="literal">true</span>,</span><br><span class="line">					size: <span class="literal">true</span></span><br><span class="line">				&#125;, <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">					<span class="built_in">this</span>.mainEles = res;</span><br><span class="line">					<span class="comment">// 存储每个标题的offsetTop（只读属性，返回当前元素相对于其 offsetParent 元素的顶部内边距的距离）</span></span><br><span class="line">					<span class="comment">// 加上 最后一个吸顶板块的高度. 解决滚动到最后一个标题（i）时，无法获取（i+1）的offsetTop</span></span><br><span class="line">					<span class="built_in">this</span>.ot.push(<span class="built_in">this</span>.mainEles[<span class="built_in">this</span>.len - <span class="number">1</span>].top + <span class="built_in">this</span>.mainEles[<span class="built_in">this</span>.len - <span class="number">1</span>].height);</span><br><span class="line">				&#125;).exec();</span><br><span class="line">			&#125;).exec();</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="function"><span class="title">onScroll</span>(<span class="params">mescroll</span>)</span> &#123;</span><br><span class="line">			<span class="comment">// 获取滚动的高度</span></span><br><span class="line">			<span class="keyword">const</span> st = mescroll.scrollTop;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.len; i++) &#123;</span><br><span class="line">				<span class="comment">// 滚动时监听位置，为标题的吸顶设置一个显示范围</span></span><br><span class="line">				<span class="keyword">if</span> (st &gt; <span class="built_in">this</span>.ot[i] &amp;&amp; st &lt; <span class="built_in">this</span>.ot[i + <span class="number">1</span>]) &#123;</span><br><span class="line">					<span class="built_in">this</span>.$refs[<span class="built_in">this</span>.mainTitleEles[i].dataset.id].$el.className = <span class="string">&#x27;main-title fixed&#x27;</span>;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="built_in">this</span>.$refs[<span class="built_in">this</span>.mainTitleEles[i].dataset.id].$el.className = <span class="string">&#x27;main-title&#x27;</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>uni-app 思路和案例 demo 一样，所以就不贴代码的样式了，唯一要注意的一点就是 dom 属性的获取是通过 uni-app <a href="https://uniapp.dcloud.io/api/ui/nodes-info?id=nodesrefboundingclientrect">相关 API</a> 实现的：</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://www.cnblogs.com/angenstern/p/11752432.html">uni-app 获取 dom 元素到顶部的距离以及操作 dom 元素的一些样式</a></li>
<li><a href="https://uniapp.dcloud.io/api/ui/nodes-info?id=nodesrefboundingclientrect">uni.createSelectorQuery()</a></li>
<li><a href="https://blog.csdn.net/zhongshanxian/article/details/81415760">实现多个标题的吸顶效果</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>布局</tag>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>uniapp百度埋点</title>
    <url>/posts/35078/</url>
    <content><![CDATA[<h2 id="模板中添加百度统计脚本"><a href="#模板中添加百度统计脚本" class="headerlink" title="模板中添加百度统计脚本"></a>模板中添加百度统计脚本</h2><blockquote>
<p>template.h5.html</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    &lt;meta</span><br><span class="line">      name=&quot;viewport&quot;</span><br><span class="line">      content=&quot;width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;apple-mobile-web-app-capable&quot;</span> <span class="attr">content</span>=<span class="string">&quot;yes&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;apple-mobile-web-app-status-bar-style&quot;</span> <span class="attr">content</span>=<span class="string">&quot;black&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&lt;%= htmlWebpackPlugin.options.title %&gt;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> _hmt = _hmt || [];</span></span><br><span class="line"><span class="javascript">      (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> hm = <span class="built_in">document</span>.createElement(<span class="string">&#x27;script&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        hm.src = <span class="string">&#x27;https://hm.baidu.com/hm.js?6e499418495097fcf7a57608d3613872&#x27;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> s = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;script&#x27;</span>)[<span class="number">0</span>];</span></span><br><span class="line">        s.parentNode.insertBefore(hm, s);</span><br><span class="line">      &#125;)();</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 控制上传的条件 https://tongji.baidu.com/web/help/article?id=324&amp;type=0</span></span></span><br><span class="line">      _hmt.push([</span><br><span class="line"><span class="javascript">        <span class="string">&#x27;_requirePlugin&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;UrlChangeTracker&#x27;</span>,</span></span><br><span class="line">        &#123;</span><br><span class="line"><span class="javascript">          shouldTrackUrlChange: <span class="function"><span class="keyword">function</span> (<span class="params">newPath, oldPath</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面的代码基本上就可以实现详情页的统计了。但是 vue 这种单页面应用是不支持刷新的，所以具体的统计还要在路由设置了进行设置，下面这段代码加在路由设置的主文件里。具体代如下：</p>
<a id="more"></a>

<h2 id="在你的-utils-js-中添加通用方法"><a href="#在你的-utils-js-中添加通用方法" class="headerlink" title="在你的 utils.js 中添加通用方法"></a>在你的 utils.js 中添加通用方法</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取当前界面和完整参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentPageUrl</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> pages = getCurrentPages(); <span class="comment">// 获取加载的页面</span></span><br><span class="line">  <span class="keyword">let</span> currentPage = pages[pages.length - <span class="number">1</span>]; <span class="comment">// 获取当前页面的对象</span></span><br><span class="line">  <span class="keyword">let</span> url = currentPage.route; <span class="comment">// 当前页面url</span></span><br><span class="line">  <span class="keyword">return</span> url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前页带参数的url</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentPageUrlAndArgs</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> pages = getCurrentPages(); <span class="comment">//获取加载的页面</span></span><br><span class="line">  <span class="keyword">let</span> currentPage = pages[pages.length - <span class="number">1</span>]; <span class="comment">//获取当前页面的对象</span></span><br><span class="line">  <span class="keyword">let</span> url = currentPage.route; <span class="comment">//当前页面url</span></span><br><span class="line">  <span class="keyword">let</span> options = currentPage.options || currentPage.$route.query; <span class="comment">//如果要获取url中所带的参数可以查看options</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//拼接url的参数</span></span><br><span class="line">  <span class="keyword">let</span> urlWithArgs = url + <span class="string">&#x27;?&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> options) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = options[key];</span><br><span class="line">    urlWithArgs += key + <span class="string">&#x27;=&#x27;</span> + value + <span class="string">&#x27;&amp;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  urlWithArgs = urlWithArgs.substring(<span class="number">0</span>, urlWithArgs.length - <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> urlWithArgs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 记录百度事件 https://tongji.baidu.com/web/help/article?id=236&amp;type=0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;eventName&#125;</span> </span>事件名称 比如打电话 关单</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;eventRemark&#125;</span> </span>事件备注  比如 首页底部打电话按钮触发</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example </span>this.$util.baiduEvent(&#x27;客户搜索&#x27;,&#x27;首页顶部客户搜索&#x27;);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">baiduEvent</span>(<span class="params">eventName, eventRemark = <span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> pageUrl = getCurrentPageUrl();</span><br><span class="line">  <span class="keyword">let</span> userInfo = getApp().globalData.userInfo;</span><br><span class="line">  <span class="keyword">if</span> (userInfo) &#123;</span><br><span class="line">    <span class="keyword">let</span> remark = &#123;</span><br><span class="line">      eventRemark: eventRemark,</span><br><span class="line">      marketerId: userInfo.marketerId,</span><br><span class="line">      userName: userInfo.userName,</span><br><span class="line">      storeId: userInfo.currentStoreId,</span><br><span class="line">      storeName: userInfo.currentStoreName</span><br><span class="line">    &#125;;</span><br><span class="line">    _hmt.push([</span><br><span class="line">      <span class="string">&#x27;_trackEvent&#x27;</span>,</span><br><span class="line">      remark.storeName,</span><br><span class="line">      remark.userName,</span><br><span class="line">      eventRemark,</span><br><span class="line">      <span class="built_in">JSON</span>.stringify(remark)</span><br><span class="line">    ]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 用于发送某个指定URL的PV统计请求  https://tongji.baidu.com/web/help/article?id=235&amp;type=0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;pageUrl&#125;</span> </span>页面的URl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example </span>this.$util.baiduPageView();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">baiduPageView</span>(<span class="params">pageUrl</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> userInfo = getApp().globalData.userInfo;</span><br><span class="line">  <span class="keyword">if</span> (userInfo) &#123;</span><br><span class="line">    <span class="comment">// 加上storeId</span></span><br><span class="line">    pageUrl = <span class="string">`<span class="subst">$&#123;pageUrl&#125;</span>?storeId=<span class="subst">$&#123;userInfo.currentStoreId&#125;</span>`</span>;</span><br><span class="line">    _hmt.push([<span class="string">&#x27;_setAutoPageview&#x27;</span>, <span class="literal">false</span>]);</span><br><span class="line">    _hmt.push([<span class="string">&#x27;_trackPageview&#x27;</span>, pageUrl]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="页面中使用"><a href="#页面中使用" class="headerlink" title="页面中使用"></a>页面中使用</h2><h3 id="页面统计"><a href="#页面统计" class="headerlink" title="页面统计"></a>页面统计</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全局路由后置守卫</span></span><br><span class="line">router.afterEach(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 控制页面加入百度统计 统计的需要关联当前门店的ID</span></span><br><span class="line">  <span class="keyword">if</span> (to.meta &amp;&amp; to.meta.isBaiduCount) &#123;</span><br><span class="line">    Vue.prototype.$util.baiduPageView(to.path);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="事件统计"><a href="#事件统计" class="headerlink" title="事件统计"></a>事件统计</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 去搜索页</span></span><br><span class="line"><span class="function"><span class="title">gotoSearch</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="built_in">this</span>.$util.baiduEvent(<span class="string">&#x27;客户搜索&#x27;</span>,<span class="string">&#x27;首页顶部客户搜索&#x27;</span>);</span><br><span class="line">   uni.navigateTo(&#123;</span><br><span class="line">      url: <span class="string">`/pages/common/searchRecord/searchRecord`</span></span><br><span class="line">   &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>uniapp</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>uniapp路由拦截配置</title>
    <url>/posts/30988/</url>
    <content><![CDATA[<p>项目的百度埋点需要做路由拦截，找了个路由插件 <code>uni-simple-router</code> 。下面是按照和基本使用步骤：</p>
<h2 id="安装-uni-simple-router-插件"><a href="#安装-uni-simple-router-插件" class="headerlink" title="安装 uni-simple-router 插件"></a>安装 uni-simple-router 插件</h2><ol>
<li><p>如果是用 hbuilderX 创建的项目，就在插件库中找。</p>
</li>
<li><p>如果是用 cli 创建的项目就如下操作：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install uni-simple-router uni-read-pages</span><br></pre></td></tr></table></figure>

</li>
</ol>
<a id="more"></a>

<h2 id="App-下-main-js-中引用"><a href="#App-下-main-js-中引用" class="headerlink" title="App 下 main.js 中引用"></a>App 下 main.js 中引用</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Router, &#123; RouterMount &#125; <span class="keyword">from</span> <span class="string">&#x27;uni-simple-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------处理路由配置-------------------------------</span></span><br><span class="line"><span class="comment">// 参考 http://hhyang.cn/src/router/api/routerInsatll.html#router-%E6%9E%84%E5%BB%BA%E9%80%89%E9%A1%B9</span></span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  routes: ROUTES, <span class="comment">//路由表</span></span><br><span class="line">  h5: &#123;</span><br><span class="line">    loading: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">routerBeforeEach</span>(<span class="params">e</span>)</span> &#123;&#125;,</span><br><span class="line">  <span class="function"><span class="title">routerAfterEach</span>(<span class="params">e</span>)</span> &#123;&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局路由前置守卫</span></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局路由后置守卫</span></span><br><span class="line">router.afterEach(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 控制页面加入百度统计 统计的需要关联当前门店的ID</span></span><br><span class="line">  <span class="keyword">if</span> (to.meta &amp;&amp; to.meta.isBaiduCount) &#123;</span><br><span class="line">    Vue.prototype.$util.baiduPageView(to.path);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  store,</span><br><span class="line">  ...App</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// #ifdef H5</span></span><br><span class="line">RouterMount(app, <span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line"><span class="comment">// #endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #ifndef H5</span></span><br><span class="line">app.$mount(); <span class="comment">//为了兼容小程序及app端必须这样写才有效果</span></span><br><span class="line"><span class="comment">// #endif</span></span><br></pre></td></tr></table></figure>

<h2 id="配置-vue-config-js"><a href="#配置-vue-config-js" class="headerlink" title="配置 vue.config.js"></a>配置 vue.config.js</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> TransformPages = <span class="built_in">require</span>(<span class="string">&#x27;uni-read-pages&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> tfPages = <span class="keyword">new</span> TransformPages(&#123;</span><br><span class="line">  includes: [<span class="string">&#x27;path&#x27;</span>, <span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;meta&#x27;</span>]</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  productionSourceMap: <span class="literal">false</span>, <span class="comment">// 生产打包时不输出map文件，增加打包速度</span></span><br><span class="line">  configureWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      plugins: [</span><br><span class="line">        <span class="keyword">new</span> tfPages.webpack.DefinePlugin(&#123;</span><br><span class="line">          ROUTES: <span class="built_in">JSON</span>.stringify(tfPages.routes)</span><br><span class="line">        &#125;)</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="对应-pages-json-添加-meta"><a href="#对应-pages-json-添加-meta" class="headerlink" title="对应 pages.json 添加 meta"></a>对应 pages.json 添加 meta</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;pages&quot;</span>: [&#123;</span><br><span class="line">         <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;pages/homePage/homePage&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;style&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;navigationStyle&quot;</span>: <span class="string">&quot;custom&quot;</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">&quot;meta&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;isBaiduCount&quot;</span>: <span class="literal">true</span></span><br><span class="line">         &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      ...</span><br><span class="line">   ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://www.hhyang.cn/">uni-simple-router</a></li>
<li><a href="https://blog.csdn.net/rookieWeb/article/details/106197046">uniapp H5 登录拦截—–uni-simple-router</a></li>
<li><a href="http://www.hhyang.cn/src/router/tutorial/rgRoutes.html#pages-json-%E4%B8%AD%E9%85%8D%E7%BD%AE-routes">自动构建路由表</a></li>
<li><a href="https://www.jianshu.com/p/a37139ab5306">uni-app 配置路由</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>uniapp</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>vscode自定义snippet片段</title>
    <url>/posts/17235/</url>
    <content><![CDATA[<p>最近我有个需求，想要在 github 上使用 markdown 语法时居中图片，然而搜了几种办法都无效，最后在 <a href="https://gist.github.com/DavidWells/7d2e0e1bc78f4ac59a123ddf8b74932d">DavidWells 的 gist</a> 中找到了答案（p.s. 如果无法翻墙，你还可以参考 <a href="https://blog.csdn.net/jingbin_/article/details/52960826">这篇博客</a>）</p>
<p>解决了一个问题又出现了另一个，其实我已经把博客写完了，但其中需要居中的图片比较多，而居中代码还比较繁琐，要是一个个手动替换也太麻烦了。然后就想到了使用 snippet ，官网教程在这里：<a href="https://code.visualstudio.com/docs/editor/userdefinedsnippets">Creating your own snippets</a></p>
<a id="more"></a>

<p>具体该如何实现呢：</p>
<ol>
<li><p>Code → 首选项 → 用户代码片段</p>
</li>
<li><p>在弹出的下拉列表中输入你想要在哪种文件中使用这种片段（例如我只希望在 markdown 文件中使用，就键入 markdown）</p>
</li>
<li><p>此时 vs code 就会帮我们自动新建一个名为 markdown.json 的文件，我们在这个 json 文件中定义我们的代码片段就好了</p>
</li>
<li><p>接着我们进入该文件，编写 snippet 配置：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;Img centered&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;prefix&quot;</span>: <span class="string">&quot;mimg&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;body&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;&lt;div align=center&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;\t&lt;img src=&#x27;$1&#x27; alt=&#x27;$2&#x27; width=&#x27;$3&#x27;&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;&lt;/div&gt;&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Centered image in markdown&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>然而当我保存后在 md 文件中使用时，按下 tab 并没有效果，经过阅读官方文档，发现有这样一句话：<code>Enable it with &quot;editor.tabCompletion&quot;: &quot;on&quot;, type a snippet prefix, and press Tab to insert a snippet.</code></p>
</li>
<li><p>所以你还需要进入 首选项 → 设置 ，在顶部输入框键入 <code>editor.tabCompletion</code> 来搜索此配置，将 <code>off</code> 改为 <code>on</code> 就 OK 了</p>
</li>
<li><p>现在大功告成，在 md 文件中，键入 mimg 后按下 tab 键，先前写好的 snippet 就能够使用了</p>
</li>
</ol>
<p>结语：关于 vs code 的 snippet 片段，网上非常多教程，大家自行搜索就好，这篇笔记的重点是上方第 6 步把 <code>editor.tabCompletion</code> 改为 <code>on</code> 。这一步至关重要，不修改会导致你以为自己的 snippet 设置没生效。</p>
]]></content>
      <categories>
        <category>工具</category>
        <category>IDE</category>
      </categories>
      <tags>
        <tag>VSCode</tag>
      </tags>
  </entry>
  <entry>
    <title>vue-cli3配置多环境打包</title>
    <url>/posts/38395/</url>
    <content><![CDATA[<p>由于公司项目需要多环境 —— dev、test、pre、prod，就看了下 vue-cli3 的多环境配置。通过官方 <a href="https://cli.vuejs.org/zh/guide/mode-and-env.html">vue-cli</a> 文档知晓 vue-cli 提供了三种模式：</p>
<ul>
<li>test</li>
<li>development</li>
<li>production</li>
</ul>
<p>而每种 NODE_ENV 下面可以配置多个环境变量。</p>
<a id="more"></a>

<p>我们可以通过 <code>.env</code> 文件增加后缀来设置某个模式下特有的环境变量。</p>
<p>例如我们可以在项目根目录下创建三个 <code>env</code> 文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.env.development # 开发</span><br><span class="line">.env.prod # 发布</span><br><span class="line">.env.test # 测试</span><br></pre></td></tr></table></figure>

<blockquote>
<p>.env.development 开发环境</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">NODE_ENV = <span class="string">&#x27;development&#x27;</span>;</span><br><span class="line">VUE_APP_API_URL = <span class="string">&#x27;http://...&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>.env.test 测试环境</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">NODE_ENV = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">VUE_APP_API_URL = <span class="string">&#x27;http://...&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>.env.production 发布环境</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">NODE_ENV = <span class="string">&#x27;production&#x27;</span>;</span><br><span class="line">VUE_APP_API_URL = <span class="string">&#x27;http://...&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>如果需要其他环境，可以创建 <code>.env.[model]</code> 文件</p>
<p>例如创建 <code>.env.mock</code> 模拟数据环境，则改写 <code>package.json</code> 文件：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;script&quot;: &#123;</span><br><span class="line">  &quot;dev&quot;: &quot;vue-cli-service serve&quot;,</span><br><span class="line">  &quot;mock&quot;: &quot;vue-cli-service serve --mode mock&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里 需要注意的是 <code>--mode</code> 后面的参数 需要是 <code>.env.[model]</code> 文件 对应的 [mode]</p>
<p>现在 <code>npm run mock</code> 就会执行 <code>vue-cli-service serve --mode mock</code> 脚本，环境变量 <code>VUE_APP_API_URL</code> 就会走 <code>.env.mock</code> 中的配置。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue-cli3</tag>
      </tags>
  </entry>
  <entry>
    <title>vue-cli中sass全局变量配置</title>
    <url>/posts/36073/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>最近使用 <a href="https://github.com/PanJiaChen/vue-element-admin">vue-element-admin</a> 想添加全局变量 <code>src/styles/variables.scss</code> 中的值。然而发现不能直接在组件中使用。</p>
<a id="more"></a>

<p>例如 <code>variables.scss</code> 中定义背景色：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">$bgColor: #041a33; // 背景色</span><br></pre></td></tr></table></figure>

<p>在组件中使用：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.app-main</span> &#123;</span></span><br><span class="line">    ...</span><br><span class="line">    background: $bgColor;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>发现报错如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SassError: Undefined variable.</span><br><span class="line">    ╷</span><br><span class="line">198 │     background: $bgColor;</span><br></pre></td></tr></table></figure>

<p>解决方案是使用 @import 来手动引入 <code>variables.scss</code> ：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;~@/styles/variables.scss&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>虽然不报错了，但是总感觉太麻烦，如果我想在其他组件中使用变量，难道每个组件都得引入一次么？所以 Google 了个新方案。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="安装-sass-依赖包"><a href="#安装-sass-依赖包" class="headerlink" title="安装 sass 依赖包"></a>安装 sass 依赖包</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install sass-resources-loader --save-dev</span><br></pre></td></tr></table></figure>

<h3 id="vue-config-js-配置"><a href="#vue-config-js-配置" class="headerlink" title="vue.config.js 配置"></a>vue.config.js 配置</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  css: &#123;</span><br><span class="line">    loaderOptions: &#123;</span><br><span class="line">      sass: &#123;</span><br><span class="line">        <span class="comment">// 旧版 在 sass-loader v7 中，选项名使用data</span></span><br><span class="line">        data: <span class="string">`@import &quot;~@/assets/scss/variables.scss&quot;;`</span></span><br><span class="line">        <span class="comment">// 新版sass-loader，选项名使用prepend</span></span><br><span class="line">        prependData: <span class="string">`@import &quot;~@/assets/scss/variables.scss&quot;;`</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>本配置适用于.scss .sass 文件(<code>&lt;style lang=&quot;scss&quot;&gt;&lt;/style&gt;</code>)</li>
<li>默认情况下 sass 选项会同时对 sass 和 scss 语法同时生效，因为 scss 语法在内部也是由 sass-loader 处理的。但是在配置 data 或 prepend 选项的时候.scss 语法要求以分号结尾，.sass 语法要求必须没有分号。</li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>vue-cli3</tag>
      </tags>
  </entry>
  <entry>
    <title>vue利用provide+inject实现页面重新渲染</title>
    <url>/posts/57665/</url>
    <content><![CDATA[<p>在 vue 中有时 vuex 或者 computed 的数据改变后数据并不会进行重新渲染，只有刷新后数据才会重新加载，</p>
<p>但如果为了让页面重新加载而采用 window.reload()或者 router.go(0)进行刷新那加载慢闪烁白屏等问题会让客户体验及其不好</p>
<a id="more"></a>

<p>这时就可以进行局部刷新，原理是使用 provide+inject 的组合来控制 router-view 的显示消失完成</p>
<p>provide+inject 这对选项需要一起使用，以允许一个祖先组件向其所有子孙后代注入一个依赖，不论组件层次有多深，并在起上下游关系成立的时间里始终生效</p>
<p>在 app.vue 中注册函数 reload 对属性 isRouterAlive 进行开关操作</p>
<img src="/posts/57665/provide-reload.png" class="" title="provide-reload">

<p>然后在需要使用的组件中注入方法直接 this.reload()使用即可</p>
<img src="/posts/57665/inject-reload.png" class="" title="inject-reload">

<p>补充：在 reload 中的 this.$nextTick()是将回调延迟到下次 DOM 更新循环之后执行，基本等价于 setTimeout(()=&gt;{},0)</p>
<p>能够让一些数据完成接收替换后再进行调用，也是能解决加载问题的方法之一</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>vue项目element-ui消息提示框及确认弹框封装</title>
    <url>/posts/8979/</url>
    <content><![CDATA[<h2 id="utils-下新建封装文件"><a href="#utils-下新建封装文件" class="headerlink" title="utils 下新建封装文件"></a>utils 下新建封装文件</h2><blockquote>
<p>src/utils/confirm.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; MessageBox, Message &#125; <span class="keyword">from</span> <span class="string">&quot;element-ui&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author </span>封装 element-ui 弹框</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">text</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">type</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">handleConfirm</span>(<span class="params">text = <span class="string">&quot;确定执行此操作吗？&quot;</span>, type = <span class="string">&quot;danger&quot;</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> MessageBox.confirm(text, <span class="string">&quot;提示&quot;</span>, &#123;</span><br><span class="line">    confirmButtonText: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">    cancelButtonText: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">    type: type,</span><br><span class="line">    center: <span class="literal">true</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author </span>封装 element-ui 消息提示</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">text</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">type</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">handleAlert</span>(<span class="params">text = <span class="string">&quot;操作成功&quot;</span>, type = <span class="string">&quot;success&quot;</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Message(&#123;</span><br><span class="line">    showClose: <span class="literal">true</span>,</span><br><span class="line">    message: text,</span><br><span class="line">    type: type</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">#页面vue文件中引用</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; handleConfirm, handleAlert &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/confirm&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="title">handleClose</span>(<span class="params">formName</span>)</span> &#123;</span><br><span class="line">      handleConfirm(<span class="string">&#x27;系统将不会保存您所做的更改，确定要离开吗？&#x27;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, err)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">delConfirm</span>(<span class="params">formName</span>)</span> &#123;</span><br><span class="line">      ...</span><br><span class="line">      handleAlert(<span class="string">&#x27;删除成功&#x27;</span>)</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>UI</category>
        <category>element-ui</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>element-ui</tag>
      </tags>
  </entry>
  <entry>
    <title>vue项目如何动态配置后端api地址</title>
    <url>/posts/47242/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>后端希望前端能动态配置 API 地址，但前端往往在 <code>npm run build</code> 生成 <code>dist</code> 后，配置就无法更改了。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>利用 <code>generate-asset-webpack-plugin</code> 插件，在 build 的时候生成 json 配置文件，然后再使用 axios 异步获取 json 配置，从而达到动态配置 API 的目的。</p>
<a id="more"></a>

<h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><h3 id="安装并引入-generate-asset-webpack-plugin"><a href="#安装并引入-generate-asset-webpack-plugin" class="headerlink" title="安装并引入 generate-asset-webpack-plugin"></a>安装并引入 generate-asset-webpack-plugin</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install generate-asset-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<blockquote>
<p>vue.config.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> GenerateAssetPlugin = <span class="built_in">require</span>(<span class="string">&#x27;generate-asset-webpack-plugin&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="定义需要生成的配置内容"><a href="#定义需要生成的配置内容" class="headerlink" title="定义需要生成的配置内容"></a>定义需要生成的配置内容</h3><blockquote>
<p>vue.config.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> createConfig = <span class="function"><span class="keyword">function</span> (<span class="params">compilation</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> cfgJson = &#123;</span><br><span class="line">    server_url: <span class="string">&#x27;http://127.0.0.1&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(cfgJson);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> GenerateAssetPlugin(&#123;</span><br><span class="line">        filename: <span class="string">&#x27;dynamicConfig.json&#x27;</span>,</span><br><span class="line">        fn: (compilation, cb)&#123;</span><br><span class="line">          cb(<span class="literal">null</span>, createConfig(compilation))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译后 dist 根目录下就会生成 <code>dynamicConfig.json</code> 文件。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>vue-cli3</tag>
      </tags>
  </entry>
  <entry>
    <title>vue骨架屏</title>
    <url>/posts/7260/</url>
    <content><![CDATA[<h2 id="什么是骨架屏"><a href="#什么是骨架屏" class="headerlink" title="什么是骨架屏"></a>什么是骨架屏</h2><p>骨架屏就是在页面尚未加载之前先给用户展示出页面的大致结构，直到页面请求数据后渲染页面。<br>骨架屏和 loading 相比较还是骨架屏用户体验感更好。<br>原理其实非常简单，就是在页面还没加载完成时展示一张图片（一般是 Base64 编码），类似下方效果：</p>
<img src="/posts/7260/skeleton-1.png" class="" title="骨架屏效果">

<a id="more"></a>

<h2 id="安装骨架屏插件"><a href="#安装骨架屏插件" class="headerlink" title="安装骨架屏插件"></a>安装骨架屏插件</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install vue-skeleton-webpack-plugin</span><br></pre></td></tr></table></figure>

<h2 id="Skeleton-组件"><a href="#Skeleton-组件" class="headerlink" title="Skeleton 组件"></a>Skeleton 组件</h2><p>在 <code>src/components</code> 下新建 <code>Skeleton.vue</code> 组件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;skeleton&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 我是首页骨架屏图片 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home-skeleton&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../assets/skeleton.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;skeleton&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;css&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.home-skeleton</span> &#123;</span></span><br><span class="line">    width: 100%;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="导出-js"><a href="#导出-js" class="headerlink" title="导出 js"></a>导出 js</h2><p>根目录下新建 <code>skeleton.js</code> 文件用来导出骨架组件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Skeleton <span class="keyword">from</span> <span class="string">&#x27;./components/Skeleton.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    Skeleton</span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">`&lt;Skeleton&gt;&lt;/Skeleton&gt;`</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="单页骨架屏"><a href="#单页骨架屏" class="headerlink" title="单页骨架屏"></a>单页骨架屏</h2><p>在根目录下新建 <code>vue.config.js</code> 配置骨架屏插件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> SkeletonWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;vue-skeleton-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> SkeletonWebpackPlugin(&#123;</span><br><span class="line">        webpackConfig: &#123;</span><br><span class="line">          entry: &#123;</span><br><span class="line">            app: path.resolve(__dirname, <span class="string">&#x27;src/skeleton.js&#x27;</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>搞定 OK~</p>
<h2 id="多页骨架屏"><a href="#多页骨架屏" class="headerlink" title="多页骨架屏"></a>多页骨架屏</h2><p>假如现在我们希望首页加载时出现骨架屏（上面单页的例子），还要在切换到 about 页面后也有个骨架屏。就需要再新建一个 <code>Skeleton</code> 组件了。</p>
<p>在 <code>src/components/</code> 下新建 <code>SkeletonAbout.vue</code> 组件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;skeleton-wrapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;skeleton-header&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;skeleton-block&quot;</span>&gt;</span></span><br><span class="line">      &lt;img</span><br><span class="line">        src=&quot;data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2aWV3Qm94PSIwIDAgMTA4MCAyNjEiPjxkZWZzPjxwYXRoIGlkPSJiIiBkPSJNMCAwaDEwODB2MjYwSDB6Ii8+PGZpbHRlciBpZD0iYSIgd2lkdGg9IjIwMCUiIGhlaWdodD0iMjAwJSIgeD0iLTUwJSIgeT0iLTUwJSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94Ij48ZmVPZmZzZXQgZHk9Ii0xIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIi8+PGZlQ29sb3JNYXRyaXggaW49InNoYWRvd09mZnNldE91dGVyMSIgdmFsdWVzPSIwIDAgMCAwIDAuOTMzMzMzMzMzIDAgMCAwIDAgMC45MzMzMzMzMzMgMCAwIDAgMCAwLjkzMzMzMzMzMyAwIDAgMCAxIDAiLz48L2ZpbHRlcj48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDEpIj48dXNlIGZpbGw9IiMwMDAiIGZpbHRlcj0idXJsKCNhKSIgeGxpbms6aHJlZj0iI2IiLz48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNiIi8+PHBhdGggZmlsbD0iI0Y2RjZGNiIgZD0iTTIzMCA0NGg1MzN2NDZIMjMweiIvPjxyZWN0IHdpZHRoPSIxNzIiIGhlaWdodD0iMTcyIiB4PSIzMCIgeT0iNDQiIGZpbGw9IiNGNkY2RjYiIHJ4PSI0Ii8+PHBhdGggZmlsbD0iI0Y2RjZGNiIgZD0iTTIzMCAxMThoMzY5djMwSDIzMHpNMjMwIDE4MmgzMjN2MzBIMjMwek04MTIgMTE1aDIzOHYzOUg4MTJ6TTgwOCAxODRoMjQydjMwSDgwOHpNOTE3IDQ4aDEzM3YzN0g5MTd6Ii8+PC9nPjwvc3ZnPg==&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        src=&quot;data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2aWV3Qm94PSIwIDAgMTA4MCAyNjEiPjxkZWZzPjxwYXRoIGlkPSJiIiBkPSJNMCAwaDEwODB2MjYwSDB6Ii8+PGZpbHRlciBpZD0iYSIgd2lkdGg9IjIwMCUiIGhlaWdodD0iMjAwJSIgeD0iLTUwJSIgeT0iLTUwJSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94Ij48ZmVPZmZzZXQgZHk9Ii0xIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIi8+PGZlQ29sb3JNYXRyaXggaW49InNoYWRvd09mZnNldE91dGVyMSIgdmFsdWVzPSIwIDAgMCAwIDAuOTMzMzMzMzMzIDAgMCAwIDAgMC45MzMzMzMzMzMgMCAwIDAgMCAwLjkzMzMzMzMzMyAwIDAgMCAxIDAiLz48L2ZpbHRlcj48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDEpIj48dXNlIGZpbGw9IiMwMDAiIGZpbHRlcj0idXJsKCNhKSIgeGxpbms6aHJlZj0iI2IiLz48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNiIi8+PHBhdGggZmlsbD0iI0Y2RjZGNiIgZD0iTTIzMCA0NGg1MzN2NDZIMjMweiIvPjxyZWN0IHdpZHRoPSIxNzIiIGhlaWdodD0iMTcyIiB4PSIzMCIgeT0iNDQiIGZpbGw9IiNGNkY2RjYiIHJ4PSI0Ii8+PHBhdGggZmlsbD0iI0Y2RjZGNiIgZD0iTTIzMCAxMThoMzY5djMwSDIzMHpNMjMwIDE4MmgzMjN2MzBIMjMwek04MTIgMTE1aDIzOHYzOUg4MTJ6TTgwOCAxODRoMjQydjMwSDgwOHpNOTE3IDQ4aDEzM3YzN0g5MTd6Ii8+PC9nPjwvc3ZnPg==&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;css&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.skeleton-header</span> &#123;</span></span><br><span class="line">    height: 40px;</span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#1976d2</span>;</span></span><br><span class="line">    padding: 0;</span><br><span class="line">    margin: 0;</span><br><span class="line">    width: 100%;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.skeleton-block</span> &#123;</span></span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    padding-top: 8px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后回到 <code>src/skeleton.js</code> 中进行改造：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Skeleton <span class="keyword">from</span> <span class="string">&#x27;./components/Skeleton.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> SkeletonAbout <span class="keyword">from</span> <span class="string">&#x27;./components/SkeletonAbout.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    Skeleton,</span><br><span class="line">    SkeletonAbout</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 默认都隐藏，通过在 vue.config.js 中的插件配置中根据id进行判断</span></span><br><span class="line">  template: <span class="string">`&lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;Skeleton style=&quot;display: none;&quot; id=&quot;skeleton-home&quot;&gt;&lt;/Skeleton&gt;</span></span><br><span class="line"><span class="string">      &lt;SkeletonAbout style=&quot;display: none;&quot; id = &quot;skeleton-about&quot;&gt;&lt;/SkeletonAbout&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>修改 <code>vue.config.js</code> 中骨架屏配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> SkeletonWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;vue-skeleton-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    <span class="comment">// 给webpack新增配置</span></span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> SkeletonWebpackPlugin(&#123;</span><br><span class="line">        webpackConfig: &#123;</span><br><span class="line">          entry: &#123;</span><br><span class="line">            app: path.resolve(__dirname, <span class="string">&#x27;src/skeleton.js&#x27;</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        router: &#123;</span><br><span class="line">          mode: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">          routes: [</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">              skeletonId: <span class="string">&#x27;skeleton-home&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">              skeletonId: <span class="string">&#x27;skeleton-about&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>现在刷新首页，就会先显示首页骨架屏，切换到 about 页面刷新，会首先显示 about 页面的骨架屏。</p>
<h2 id="骨架屏插件原理"><a href="#骨架屏插件原理" class="headerlink" title="骨架屏插件原理"></a>骨架屏插件原理</h2><p>骨架屏插件的原理也非常简单，我们只要在 webpack 的 <code>html-webpack-plugin</code> 插件处理 html 之前对 app 根节点下的内容进行替换就 OK 了，下面是一个简化版插件写法：</p>
<blockquote>
<p>vue.config.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> SkeletonWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;vue-skeleton-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 骨架屏插件原理</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPlugin</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// compiler 表示当前整个webpack对象</span></span><br><span class="line">    compiler.plugin(<span class="string">&#x27;compilation&#x27;</span>, <span class="function"><span class="params">compilation</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// compilation 表示当前这次webpack打包的对象（也就是说多次打包会产生多个）</span></span><br><span class="line">      compilation.plugin(</span><br><span class="line">        <span class="comment">// 当前webpack插件在html处理之前，把html替换</span></span><br><span class="line">        <span class="string">&#x27;html-webpack-plugin-before-html-processing&#x27;</span>,</span><br><span class="line">        data =&gt; &#123;</span><br><span class="line">          data.html = data.html.replace(</span><br><span class="line">            <span class="string">`&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;`</span>,</span><br><span class="line">            <span class="string">`</span></span><br><span class="line"><span class="string">              &lt;div id=&quot;app&quot;&gt;</span></span><br><span class="line"><span class="string">                  &lt;div id=&quot;home&quot; style=&quot;display:none&quot;&gt;首页骨架屏&lt;/div&gt;</span></span><br><span class="line"><span class="string">                  &lt;div id=&quot;about&quot; style=&quot;display:none&quot;&gt;about页骨架屏&lt;/div&gt;</span></span><br><span class="line"><span class="string">              &lt;/div&gt;</span></span><br><span class="line"><span class="string">              &lt;script&gt;</span></span><br><span class="line"><span class="string">                  if(window.hash == &#x27;#/about&#x27; ||  location.pathname==&#x27;/about&#x27;)&#123;</span></span><br><span class="line"><span class="string">                      document.getElementById(&#x27;about&#x27;).style.display=&quot;block&quot;</span></span><br><span class="line"><span class="string">                  &#125;else&#123;</span></span><br><span class="line"><span class="string">                      document.getElementById(&#x27;home&#x27;).style.display=&quot;block&quot;</span></span><br><span class="line"><span class="string">                  &#125;</span></span><br><span class="line"><span class="string">              &lt;/script&gt;</span></span><br><span class="line"><span class="string">          `</span></span><br><span class="line">          );</span><br><span class="line">          <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    <span class="comment">// 给webpack新增配置</span></span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="comment">// 使用自己的插件</span></span><br><span class="line">      <span class="keyword">new</span> MyPlugin()</span><br><span class="line">      <span class="comment">// new SkeletonWebpackPlugin(&#123;</span></span><br><span class="line">      <span class="comment">//   webpackConfig: &#123;</span></span><br><span class="line">      <span class="comment">//     entry: &#123;</span></span><br><span class="line">      <span class="comment">//       app: path.resolve(__dirname, &#x27;src/skeleton.js&#x27;)</span></span><br><span class="line">      <span class="comment">//     &#125;</span></span><br><span class="line">      <span class="comment">//   &#125;,</span></span><br><span class="line">      <span class="comment">//   router: &#123;</span></span><br><span class="line">      <span class="comment">//     mode: &#x27;history&#x27;,</span></span><br><span class="line">      <span class="comment">//     routes: [&#123;</span></span><br><span class="line">      <span class="comment">//         path: &#x27;/&#x27;,</span></span><br><span class="line">      <span class="comment">//         skeletonId: &#x27;skeleton-home&#x27;</span></span><br><span class="line">      <span class="comment">//       &#125;,</span></span><br><span class="line">      <span class="comment">//       &#123;</span></span><br><span class="line">      <span class="comment">//         path: &#x27;/about&#x27;,</span></span><br><span class="line">      <span class="comment">//         skeletonId: &#x27;skeleton-about&#x27;</span></span><br><span class="line">      <span class="comment">//       &#125;,</span></span><br><span class="line">      <span class="comment">//     ]</span></span><br><span class="line">      <span class="comment">//   &#125;,</span></span><br><span class="line">      <span class="comment">// &#125;)</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>用户体验</tag>
        <tag>骨架屏</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>一些有用的npm包</title>
    <url>/posts/44396/</url>
    <content><![CDATA[<h2 id="runjs"><a href="#runjs" class="headerlink" title="runjs"></a>runjs</h2><blockquote>
<p>已改名为 tasksfile ，<code>npm install tasksfile</code> 代替</p>
</blockquote>
<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>一个小型构件工具</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install runjs -D</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>在根项目目录中创建 <code>runfile.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; run &#125; = <span class="built_in">require</span>(<span class="string">&#x27;runjs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">name = <span class="string">&#x27;Mysterious&#x27;</span></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Hello <span class="subst">$&#123;name&#125;</span>!`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makedir</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  run(<span class="string">&#x27;mkdir somedir&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  hello,</span><br><span class="line">  makedir</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在你的终端中执行：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npx run hello Tommy</span></span><br><span class="line">Hello Tommy!</span><br><span class="line"><span class="meta">$</span><span class="bash"> npx run makedir</span></span><br><span class="line">mkdir somedir</span><br></pre></td></tr></table></figure>

<h2 id="chalk"><a href="#chalk" class="headerlink" title="chalk"></a>chalk</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><p>给 <code>终端</code> 字符串设置样式</p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install chalk</span><br></pre></td></tr></table></figure>

<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(chalk.blue(<span class="string">&#x27;Hello world!&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><p>Connect 是一个可扩展的 HTTP 服务器框架，用于 node，使用称为中间件的“插件”。</p>
<h3 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install connect</span><br></pre></td></tr></table></figure>

<h3 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">var connect = require(&#x27;connect&#x27;);</span><br><span class="line">var http = require(&#x27;http&#x27;);</span><br><span class="line"></span><br><span class="line">var app = connect();</span><br><span class="line"></span><br><span class="line">// gzip/deflate outgoing responses</span><br><span class="line">var compression = require(&#x27;compression&#x27;);</span><br><span class="line">app.use(compression());</span><br><span class="line"></span><br><span class="line">// store session state in browser cookie</span><br><span class="line">var cookieSession = require(&#x27;cookie-session&#x27;);</span><br><span class="line">app.use(cookieSession(&#123;</span><br><span class="line">    keys: [&#x27;secret1&#x27;, &#x27;secret2&#x27;]</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">// parse urlencoded request bodies into req.body</span><br><span class="line">var bodyParser = require(&#x27;body-parser&#x27;);</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;extended: false&#125;));</span><br><span class="line"></span><br><span class="line">// respond to all requests</span><br><span class="line">app.use(function(req, res)&#123;</span><br><span class="line">  res.end(&#x27;Hello from Connect!\n&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//create node.js http server and listen on port</span><br><span class="line">http.createServer(app).listen(3000);</span><br></pre></td></tr></table></figure>

<h2 id="serve-static"><a href="#serve-static" class="headerlink" title="serve-static"></a>serve-static</h2><h3 id="介绍-3"><a href="#介绍-3" class="headerlink" title="介绍"></a>介绍</h3><p>一款静态资源管理器</p>
<h3 id="安装-3"><a href="#安装-3" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install serve-static</span><br></pre></td></tr></table></figure>

<h3 id="使用-3"><a href="#使用-3" class="headerlink" title="使用"></a>使用</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>),</span><br><span class="line">  url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>),</span><br><span class="line">  fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> serveStatic = <span class="built_in">require</span>(<span class="string">&#x27;serve-static&#x27;</span>),</span><br><span class="line">  <span class="comment">//finalhandler 是 serveStatic 的依赖，不需要特意安装。</span></span><br><span class="line">  finalhandler = <span class="built_in">require</span>(<span class="string">&#x27;finalhandler&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置静态资源服务 (&quot;要静态化的文件路径&quot;,&#123;默认主页的配置&#125;);</span></span><br><span class="line"><span class="keyword">var</span> serve = serveStatic(<span class="string">&#x27;public&#x27;</span>, &#123; <span class="attr">index</span>: [<span class="string">&#x27;index.html&#x27;</span>, <span class="string">&#x27;index.htm&#x27;</span>] &#125;);</span><br><span class="line">http</span><br><span class="line">  .createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//路由清单</span></span><br><span class="line">    <span class="keyword">if</span> (req.url == <span class="string">&#x27;/music&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">//也让其显示 根目录public 下的主页</span></span><br><span class="line">      fs.readFile(<span class="string">&#x27;./public/index.html&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          res.end(<span class="string">&#x27;没有此文件!&#x27;</span>);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">        res.end(data.toString());</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">//读取并呈递完毕之后,在路由中加上return,</span></span><br><span class="line">      <span class="comment">//否则下面的静态资源服务里面会一直寻找这个路由，</span></span><br><span class="line">      <span class="comment">//这个路由是虚拟出来的，因此不会呈递上面我们去读的文件</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用静态资源服务，一般放在中间件最下方，不至于遮蔽中间件的路由</span></span><br><span class="line">    serve(req, res, finalhandler(req, res));</span><br><span class="line">  &#125;)</span><br><span class="line">  .listen(<span class="number">8888</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;ok&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="mockjs"><a href="#mockjs" class="headerlink" title="mockjs"></a>mockjs</h2><h3 id="介绍-4"><a href="#介绍-4" class="headerlink" title="介绍"></a>介绍</h3><p>生成随机数据，拦截 Ajax 请求</p>
<h3 id="安装-4"><a href="#安装-4" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install mockjs</span><br></pre></td></tr></table></figure>

<h3 id="使用-4"><a href="#使用-4" class="headerlink" title="使用"></a>使用</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用 Mock</span></span><br><span class="line"><span class="keyword">var</span> Mock = <span class="built_in">require</span>(<span class="string">&#x27;mockjs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> data = Mock.mock(&#123;</span><br><span class="line">  <span class="comment">// 属性 list 的值是一个数组，其中含有 1 到 10 个元素</span></span><br><span class="line">  <span class="string">&#x27;list|1-10&#x27;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 属性 id 是一个自增数，起始值为 1，每次增 1</span></span><br><span class="line">      <span class="string">&#x27;id|+1&#x27;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 输出结果</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(data, <span class="literal">null</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>构建工具</category>
        <category>npm</category>
      </categories>
      <tags>
        <tag>笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>三栏布局方案(圣杯_双飞翼)</title>
    <url>/posts/10370/</url>
    <content><![CDATA[<h2 id="圣杯布局"><a href="#圣杯布局" class="headerlink" title="圣杯布局"></a>圣杯布局</h2><h3 id="步骤一-HTML框架搭建-amp-初始化CSS"><a href="#步骤一-HTML框架搭建-amp-初始化CSS" class="headerlink" title="步骤一 - HTML框架搭建 &amp; 初始化CSS"></a>步骤一 - HTML框架搭建 &amp; 初始化CSS</h3><p>首先把基本框架搭起来（注意中间部分放最前面）：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span>我是中间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>我是左边<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>我是右边<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>接下来是初始化样式。left, right宽度分别设置为100px和200px；然后设置container的 <code>padding-left: 100px</code> + <code>padding-right: 200px</code> 来占据两侧填充；center宽度设为100%，这样能够自适应剩下的宽度。再让所有子元素左浮动。代码如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">200px</span> <span class="number">0</span> <span class="number">100px</span>; <span class="comment">/* 左边100， 右边200*/</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#e1e1e1</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>; <span class="comment">/* 为了看效果，给个300px把高度撑起来 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.left</span>, <span class="selector-class">.center</span>, <span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 占据父元素剩下的宽度*/</span></span><br><span class="line">    <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时的页面效果：</p>
<img src="/posts/10370/%E5%9C%A3%E6%9D%AFstep1.png" class="" title="圣杯step1">

<h3 id="步骤二-让left占据最左列"><a href="#步骤二-让left占据最左列" class="headerlink" title="步骤二 - 让left占据最左列"></a>步骤二 - 让left占据最左列</h3><p>为了让left能越过center，我们先给它设置一个 -100% 的左边距。这个100%是在container中的宽度，也就是center的宽度：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: -<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="comment">/*为了看left和center的重叠效果，暂时bgc设为半透明*/</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">204</span>,<span class="number">204</span>,.<span class="number">6</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>页面效果：</p>
<img src="/posts/10370/%E5%9C%A3%E6%9D%AFstep2.png" class="" title="圣杯step2">

<p>此时，我们已经让left从“第二行”升到了“第一行”，为了让它靠到最左侧，不与center重叠，可以给它设置相对定位，然后给个 <code>left: -100px</code> ，让它定位到container最左侧：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="comment">/* 设置相对定位 */</span> </span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="comment">/* 靠到最左侧 */</span></span><br><span class="line">    <span class="attribute">left</span>: -<span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: -<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>页面效果：</p>
<img src="/posts/10370/%E5%9C%A3%E6%9D%AFstep3.png" class="" title="圣杯step3">

<h3 id="步骤三-让right占据最右列"><a href="#步骤三-让right占据最右列" class="headerlink" title="步骤三 - 让right占据最右列"></a>步骤三 - 让right占据最右列</h3><p>定位好了left，也是时候让right呆在最右边来填充位置了，我们继续使用负margin：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: -<span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>页面效果：</p>
<img src="/posts/10370/%E5%9C%A3%E6%9D%AFstep4.png" class="" title="圣杯step4">

<h3 id="步骤四-给container设置min-width"><a href="#步骤四-给container设置min-width" class="headerlink" title="步骤四 - 给container设置min-width"></a>步骤四 - 给container设置min-width</h3><p>看起来已经实现了不是吗？但我们还差最后一步，给container设置一个 <code>min-width: 100px</code> （就是左列的宽度），否则当浏览器缩小到一定程度时，这个布局可能会被破坏。原因简单来讲就是：“由于设置了相对定位，所以当left原来的位置和right的位置产生重叠时，由于浮动的原因一行放不下就会换行”。所以布局就被打乱了。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#e1e1e1</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">200px</span> <span class="number">0</span> <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="完整代码-最终效果"><a href="#完整代码-最终效果" class="headerlink" title="完整代码 + 最终效果"></a>完整代码 + 最终效果</h3><p>这样，我们就实现了圣杯布局，完整代码和效果见下：</p>
<iframe height="265" scrolling="no" title="三栏布局 - 圣杯布局" src="https://codepen.io/JingW/embed/VRXYmz/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="双飞翼布局"><a href="#双飞翼布局" class="headerlink" title="双飞翼布局"></a>双飞翼布局</h2><p>如果上面圣杯布局你已经理解并自己实践了一遍，那么这里的双飞翼布局你也应该不再话下。跟着我一起撸一遍代码吧。</p>
<h3 id="步骤一-HTML框架搭建-amp-初始化CSS-1"><a href="#步骤一-HTML框架搭建-amp-初始化CSS-1" class="headerlink" title="步骤一 - HTML框架搭建 &amp; 初始化CSS"></a>步骤一 - HTML框架搭建 &amp; 初始化CSS</h3><p>首先搭建html，仔细观察下方代码你会发现，双飞翼布局在html上面有一点和圣杯布局有差别，那就是双飞翼在center里又套了一个div。到后面你就会知道这样设置的目的。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>我是中间<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>我是左边<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>我是右边<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后编写初始样式。left定宽100；right定宽200；left, right, center全部设置左浮动。其他例如设置颜色高度等等直接看下方代码：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#e1e1e1</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: yellow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.left</span>, <span class="selector-class">.center</span>, <span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<img src="/posts/10370/%E5%8F%8C%E9%A3%9E%E7%BF%BCstep1.png" class="" title="双飞翼step1">

<h3 id="步骤二-设置center为100-宽"><a href="#步骤二-设置center为100-宽" class="headerlink" title="步骤二 - 设置center为100%宽"></a>步骤二 - 设置center为100%宽</h3><p>将center的宽度设为100%，这样会把left，right“挤”到第二行：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<img src="/posts/10370/%E5%8F%8C%E9%A3%9E%E7%BF%BCstep2.png" class="" title="双飞翼step2">

<h3 id="步骤三-分别让left-right回到最左边和最右边"><a href="#步骤三-分别让left-right回到最左边和最右边" class="headerlink" title="步骤三 - 分别让left,right回到最左边和最右边"></a>步骤三 - 分别让left,right回到最左边和最右边</h3><p>接着，给left设置 <code>margin-left: -100%</code> 回到最左边，给right设置 <code>margin-left: -200px</code> 回到最右边。此时center和left,right都有重叠区域，为了看效果，设置了半透明背景颜色。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: -<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: -<span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<img src="/posts/10370/%E5%8F%8C%E9%A3%9E%E7%BF%BCstep3.png" class="" title="双飞翼step3">

<h3 id="步骤四-给center的子div设置左右margin"><a href="#步骤四-给center的子div设置左右margin" class="headerlink" title="步骤四 - 给center的子div设置左右margin"></a>步骤四 - 给center的子div设置左右margin</h3><p>其实上面的效果图已经实现了三栏布局中间自适应。但有个问题是center左右部分区域会被遮挡，这个时候在步骤一提到的center子div的作用就体现出来了，我们可以给它设置一个左右的margin值，分别等于left的宽和right的宽，消除掉重叠的副作用。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.center</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="comment">/* 左margin100，右margin200 */</span></span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">200px</span> <span class="number">0</span> <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<img src="/posts/10370/%E5%8F%8C%E9%A3%9E%E7%BF%BCstep4.png" class="" title="双飞翼step4">

<h3 id="步骤五-给container设置min-width"><a href="#步骤五-给container设置min-width" class="headerlink" title="步骤五 - 给container设置min-width"></a>步骤五 - 给container设置min-width</h3><p>最后，给container设置一个min-width，让container最小宽度不小于left宽+right宽</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#e1e1e1</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大功告成~</p>
<h3 id="完整代码-最终效果-1"><a href="#完整代码-最终效果-1" class="headerlink" title="完整代码 + 最终效果"></a>完整代码 + 最终效果</h3><iframe height="265" scrolling="no" title="三栏布局 - 双飞翼布局" src="https://codepen.io/JingW/embed/wOmBoY/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>布局</tag>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>不常用css样式总结</title>
    <url>/posts/10974/</url>
    <content><![CDATA[<h2 id="设置-input-的-placeholder-的字体样式"><a href="#设置-input-的-placeholder-的字体样式" class="headerlink" title="设置 input 的 placeholder 的字体样式"></a>设置 input 的 placeholder 的字体样式</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">::-webkit-input-placeholder</span> &#123;</span><br><span class="line">  <span class="comment">/* Chrome/Opera/Safari */</span></span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">::-moz-placeholder</span> &#123;</span><br><span class="line">  <span class="comment">/* Firefox 19+ */</span></span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:-ms-input-placeholder</span> &#123;</span><br><span class="line">  <span class="comment">/* IE 10+ */</span></span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:-moz-placeholder</span> &#123;</span><br><span class="line">  <span class="comment">/* Firefox 18- */</span></span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="设置-input-聚焦时的样式"><a href="#设置-input-聚焦时的样式" class="headerlink" title="设置 input 聚焦时的样式"></a>设置 input 聚焦时的样式</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="取消-input-的边框"><a href="#取消-input-的边框" class="headerlink" title="取消 input 的边框"></a>取消 input 的边框</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">border</span>: <span class="selector-tag">none</span>;</span><br><span class="line"><span class="selector-tag">outline</span>: <span class="selector-tag">none</span>;</span><br></pre></td></tr></table></figure>

<h2 id="二、隐藏滚动条或更改滚动条样式"><a href="#二、隐藏滚动条或更改滚动条样式" class="headerlink" title="二、隐藏滚动条或更改滚动条样式"></a>二、隐藏滚动条或更改滚动条样式</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*css主要部分的样式*/</span></span><br><span class="line">/定义滚动条宽高及背景，宽高分别对应横竖滚动条的尺寸 / <span class="selector-pseudo">::-webkit-scrollbar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>; <span class="comment">/*对垂直流动条有效*/</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">10px</span>; <span class="comment">/*对水平流动条有效*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*定义滚动条的轨道颜色、内阴影及圆角*/</span></span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-track</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-box-shadow</span>: inset <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.3</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: rosybrown;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*定义滑块颜色、内阴影及圆角*/</span></span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-thumb</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">7px</span>;</span><br><span class="line">  <span class="attribute">-webkit-box-shadow</span>: inset <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.3</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#e8e8e8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*定义两端按钮的样式*/</span></span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-button</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: cyan;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*定义右下角汇合处的样式*/</span></span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-corner</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: khaki;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、文字超出隐藏并显示省略号"><a href="#三、文字超出隐藏并显示省略号" class="headerlink" title="三、文字超出隐藏并显示省略号"></a>三、文字超出隐藏并显示省略号</h2><h3 id="单行（一定要有宽度）"><a href="#单行（一定要有宽度）" class="headerlink" title="单行（一定要有宽度）"></a>单行（一定要有宽度）</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">width</span>: 200<span class="selector-tag">rpx</span>;</span><br><span class="line"><span class="selector-tag">white-space</span>: <span class="selector-tag">nowrap</span>;</span><br><span class="line"><span class="selector-tag">overflow</span>: <span class="selector-tag">hidden</span>;</span><br><span class="line"><span class="selector-tag">text-overflow</span>: <span class="selector-tag">ellipsis</span>;</span><br></pre></td></tr></table></figure>

<h3 id="多行"><a href="#多行" class="headerlink" title="多行"></a>多行</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">word-break</span>: <span class="selector-tag">break-all</span>;</span><br><span class="line"><span class="selector-tag">display</span>: <span class="selector-tag">-webkit-box</span>;</span><br><span class="line"><span class="selector-tag">-webkit-line-clamp</span>: 2;</span><br><span class="line"><span class="selector-tag">-webkit-box-orient</span>: <span class="selector-tag">vertical</span>;</span><br><span class="line"><span class="selector-tag">overflow</span>: <span class="selector-tag">hidden</span>;</span><br></pre></td></tr></table></figure>

<h2 id="四、控制-div-内的元素自动换行"><a href="#四、控制-div-内的元素自动换行" class="headerlink" title="四、控制 div 内的元素自动换行"></a>四、控制 div 内的元素自动换行</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">word-wrap</span>: <span class="selector-tag">break-word</span>;</span><br><span class="line"><span class="selector-tag">word-break</span>: <span class="selector-tag">break-all</span>;</span><br></pre></td></tr></table></figure>

<h2 id="五、-纯-css-画三角形"><a href="#五、-纯-css-画三角形" class="headerlink" title="五、 纯 css 画三角形"></a>五、 纯 css 画三角形</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#demo</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">border-style</span>: solid;</span><br><span class="line">  <span class="attribute">border-color</span>: transparent transparent red transparent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、-绝对定位元素居中（水平和垂直方向）"><a href="#六、-绝对定位元素居中（水平和垂直方向）" class="headerlink" title="六、 绝对定位元素居中（水平和垂直方向）"></a>六、 绝对定位元素居中（水平和垂直方向）</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#demo</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、表格边框合并"><a href="#七、表格边框合并" class="headerlink" title="七、表格边框合并"></a>七、表格边框合并</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">table</span>,</span><br><span class="line"><span class="selector-tag">tr</span>,</span><br><span class="line"><span class="selector-tag">td</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">table</span> &#123;</span><br><span class="line">  <span class="attribute">border-collapse</span>: collapse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>两栏布局方案汇总</title>
    <url>/posts/44541/</url>
    <content><![CDATA[<p>记录下常见的两栏布局方式。</p>
<h2 id="左边定宽，右边自适应"><a href="#左边定宽，右边自适应" class="headerlink" title="左边定宽，右边自适应"></a>左边定宽，右边自适应</h2><h3 id="模拟table"><a href="#模拟table" class="headerlink" title="模拟table"></a>模拟table</h3><p>父元素 <code>display: table</code> ，子元素左右 <code>table-cell</code> ，左边定宽。</p>
<iframe height="460" scrolling="no" title="两栏布局（左定右自适应）模拟table" src="https://codepen.io/JingW/embed/zbWYMO/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<a id="more"></a>

<h3 id="左浮-右Margin"><a href="#左浮-右Margin" class="headerlink" title="左浮 + 右Margin"></a>左浮 + 右Margin</h3><p>子元素的左边浮动脱标，右边设置 <code>margin-left: 左边元素宽度</code></p>
<iframe height="460" scrolling="no" title="两栏布局（左定右自适应）子元素绝对定位" src="https://codepen.io/JingW/embed/bZvGRY/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="左浮-右BFC"><a href="#左浮-右BFC" class="headerlink" title="左浮 + 右BFC"></a>左浮 + 右BFC</h3><p>子元素左边设置浮动+定宽，右边子元素设置 <code>overflow: hidden</code> 触发自身BFC</p>
<iframe height="460" scrolling="no" title="两栏布局（左定右自适应）左浮 + 右BFC" src="https://codepen.io/JingW/embed/rRdNYR/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="子绝父相"><a href="#子绝父相" class="headerlink" title="子绝父相"></a>子绝父相</h3><p>子绝父相，左边 <code>top, left: 0</code>，右边 <code>top, right: 0</code>，left等于左边宽度。</p>
<iframe height="460" scrolling="no" title="两栏布局（左定右自适应）子绝父相" src="https://codepen.io/JingW/embed/gEeONo/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="flex布局"><a href="#flex布局" class="headerlink" title="flex布局"></a>flex布局</h3><p>父元素 <code>display: flex</code> ，左边定宽，右边 <code>flex: 1</code>。</p>
<iframe height="460" scrolling="no" title="两栏布局（左定右自适应）flex" src="https://codepen.io/JingW/embed/bZvNGx/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>布局</tag>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>优化ECharts+定时器定时刷新数据导致的内存溢出问题</title>
    <url>/posts/55651/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>项目需要使用 ECharts 绘制行车库区 3d 图，并且需要定时刷新数据：</p>
<img src="/posts/55651/echarts-repo-3d.png" class="" title="echarts-repo-3d">

<p>然而数据量太大，导致页面长时间停留后会卡顿：</p>
<img src="/posts/55651/resp-data.png" class="" title="resp-data">

<h2 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h2><ol>
<li>不要把 ECharts 实例或者配置项挂到 vue 下面，Vue 会深度遍历监听所有属性，数据量一大就卡了</li>
<li>对定时器的清除</li>
<li>保证页面中同一个图表只有一个实例，而不是每次刷新数据都新建 ECharts 实例</li>
</ol>
<a id="more"></a>

<h2 id="具体代码"><a href="#具体代码" class="headerlink" title="具体代码"></a>具体代码</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;chart&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;height:&#x27;800px&#x27;,width:&#x27;100%&#x27;&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> <span class="string">&#x27;echarts-gl&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">require</span>(<span class="string">&#x27;echarts/theme/macarons&#x27;</span>); <span class="comment">// echarts theme</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> resize <span class="keyword">from</span> <span class="string">&#x27;@/components/Charts/mixins/resize&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> $reservoir <span class="keyword">from</span> <span class="string">&#x27;@/api/reservoir&#x27;</span>; <span class="comment">// api</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// echarts 实例, 定时器</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> chart = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    mixins: [resize],</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        playground: [] <span class="comment">// 3d库区图数据</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化echarts</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.initChart();</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 数据请求</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.get3DPlayground();</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 设置定时器</span></span></span><br><span class="line"><span class="javascript">      timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.get3DPlayground();</span></span><br><span class="line">      &#125;, 10000);</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="comment">// 页面销毁时移除定时器，销毁echarts实例</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">beforeDestroy</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (!chart) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line">      chart.dispose();</span><br><span class="line"><span class="javascript">      <span class="built_in">clearInterval</span>(timer);</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 获取3d图数据</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">async</span> <span class="function"><span class="title">get3DPlayground</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> data = <span class="keyword">await</span> $reservoir.get3DPlayground();</span></span><br><span class="line">        data = data || [];</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.playground = data.map(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> [</span></span><br><span class="line">            element.ypos / 1000,</span><br><span class="line">            element.xpos / 1000,</span><br><span class="line">            20 - element.zpos / 1000</span><br><span class="line">          ];</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="javascript">        data = <span class="literal">null</span>;</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 更新图表</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">updateChart</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line">        chart.setOption(&#123;</span><br><span class="line">          series: [</span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">              type: <span class="string">&#x27;surface&#x27;</span>,</span></span><br><span class="line"><span class="javascript">              data: <span class="built_in">this</span>.playground,</span></span><br><span class="line">              label: &#123;</span><br><span class="line"><span class="javascript">                show: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                position: <span class="string">&#x27;top&#x27;</span>,</span></span><br><span class="line">                margin: 8</span><br><span class="line">              &#125;,</span><br><span class="line"><span class="javascript">              shading: <span class="string">&#x27;realistic&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化图表</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">initChart</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        chart = echarts.init(<span class="built_in">this</span>.$el, <span class="string">&#x27;white&#x27;</span>, &#123; <span class="attr">renderer</span>: <span class="string">&#x27;canvas&#x27;</span> &#125;);</span></span><br><span class="line">        chart.setOption(&#123;</span><br><span class="line"><span class="javascript">          animation: <span class="literal">true</span>,</span></span><br><span class="line">          animationThreshold: 2000,</span><br><span class="line">          animationDuration: 1000,</span><br><span class="line"><span class="javascript">          animationEasing: <span class="string">&#x27;cubicOut&#x27;</span>,</span></span><br><span class="line">          animationDelay: 0,</span><br><span class="line">          animationDurationUpdate: 300,</span><br><span class="line"><span class="javascript">          animationEasingUpdate: <span class="string">&#x27;cubicOut&#x27;</span>,</span></span><br><span class="line">          animationDelayUpdate: 0,</span><br><span class="line">          color: [],</span><br><span class="line">          series: [</span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">              type: <span class="string">&#x27;surface&#x27;</span>,</span></span><br><span class="line">              data: [],</span><br><span class="line">              label: &#123;</span><br><span class="line"><span class="javascript">                show: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                position: <span class="string">&#x27;top&#x27;</span>,</span></span><br><span class="line">                margin: 8</span><br><span class="line">              &#125;,</span><br><span class="line"><span class="javascript">              shading: <span class="string">&#x27;realistic&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          legend: [</span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">              data: [<span class="string">&#x27;&#x27;</span>],</span></span><br><span class="line">              selected: &#123;&#125;,</span><br><span class="line"><span class="javascript">              show: <span class="literal">true</span>,</span></span><br><span class="line">              padding: 5,</span><br><span class="line">              itemGap: 10,</span><br><span class="line">              itemWidth: 25,</span><br><span class="line">              itemHeight: 14</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          tooltip: &#123;</span><br><span class="line"><span class="javascript">            show: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            trigger: <span class="string">&#x27;item&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            triggerOn: <span class="string">&#x27;mousemove|click&#x27;</span>,</span></span><br><span class="line">            axisPointer: &#123;</span><br><span class="line"><span class="javascript">              type: <span class="string">&#x27;line&#x27;</span></span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            showContent: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            alwaysShowContent: <span class="literal">false</span>,</span></span><br><span class="line">            showDelay: 0,</span><br><span class="line">            hideDelay: 100,</span><br><span class="line">            textStyle: &#123;</span><br><span class="line">              fontSize: 14</span><br><span class="line">            &#125;,</span><br><span class="line">            borderWidth: 0,</span><br><span class="line">            padding: 5</span><br><span class="line">          &#125;,</span><br><span class="line">          visualMap: &#123;</span><br><span class="line"><span class="javascript">            show: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            type: <span class="string">&#x27;continuous&#x27;</span>,</span></span><br><span class="line">            min: 0,</span><br><span class="line">            max: 20,</span><br><span class="line">            inRange: &#123;</span><br><span class="line"><span class="javascript">              color: [<span class="string">&#x27;#f05b72&#x27;</span>, <span class="string">&#x27;#ef5b9c&#x27;</span>, <span class="string">&#x27;#f47920&#x27;</span>, <span class="string">&#x27;#fab27b&#x27;</span>]</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            calculable: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            inverse: <span class="literal">false</span>,</span></span><br><span class="line">            splitNumber: 5,</span><br><span class="line"><span class="javascript">            orient: <span class="string">&#x27;vertical&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            showLabel: <span class="literal">true</span>,</span></span><br><span class="line">            itemWidth: 20,</span><br><span class="line">            itemHeight: 150,</span><br><span class="line">            borderWidth: 0</span><br><span class="line">          &#125;,</span><br><span class="line">          xAxis3D: &#123;</span><br><span class="line"><span class="javascript">            name: <span class="string">&#x27;X&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            type: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            max: <span class="string">&#x27;dataMax&#x27;</span></span></span><br><span class="line">          &#125;,</span><br><span class="line">          yAxis3D: &#123;</span><br><span class="line"><span class="javascript">            name: <span class="string">&#x27;Y&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            type: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            max: <span class="string">&#x27;dataMax&#x27;</span></span></span><br><span class="line">          &#125;,</span><br><span class="line">          zAxis3D: &#123;</span><br><span class="line"><span class="javascript">            name: <span class="string">&#x27;Z&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            type: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            max: <span class="string">&#x27;20&#x27;</span></span></span><br><span class="line">          &#125;,</span><br><span class="line">          grid3D: &#123;</span><br><span class="line">            boxWidth: 20,</span><br><span class="line">            boxHeight: 20,</span><br><span class="line">            boxDepth: 150,</span><br><span class="line">            viewControl: &#123;</span><br><span class="line"><span class="javascript">              autoRotate: <span class="literal">false</span>,</span></span><br><span class="line">              autoRotateSpeed: 20,</span><br><span class="line">              rotateSensitivity: 1</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          title: [</span><br><span class="line">            &#123;</span><br><span class="line">              padding: 5,</span><br><span class="line">              itemGap: 10</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watch: &#123;</span><br><span class="line">      playground: &#123;</span><br><span class="line"><span class="javascript">        immediate: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">        deep: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">handler</span>(<span class="params">newValue, oldValue</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 数据更新时，更新echarts</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.updateChart();</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://github.com/apache/incubator-echarts/issues/12449">ECharts 折现更新卡顿</a></li>
<li><a href="https://blog.csdn.net/weixin_47711357/article/details/110945362">定时器+echarts 运行时间太长导致内存溢出页面崩溃</a></li>
<li><a href="https://juejin.cn/post/6844904082918899720">chrome 内存泄露分析</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>UI</category>
        <category>element-ui</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>element-ui</tag>
      </tags>
  </entry>
  <entry>
    <title>使用Xcode发布iOS-ad-hoc测试版本</title>
    <url>/posts/38926/</url>
    <content><![CDATA[<h2 id="必要准备"><a href="#必要准备" class="headerlink" title="必要准备"></a>必要准备</h2><p>开发者账号（不需要企业级别的开发账号，公司级别的也可以），Xcode</p>
<h2 id="证书创建"><a href="#证书创建" class="headerlink" title="证书创建"></a>证书创建</h2><img src="/posts/38926/image-20200811210411909.png" class="" title="image-20200811210411909">

<img src="/posts/38926/image-20200811210344729.png" class="" title="image-20200811210344729">

<img src="/posts/38926/image-20200811210439870.png" class="" title="image-20200811210439870">

<a id="more"></a>

<p>下载证书</p>
<img src="/posts/38926/image-20200811210609849.png" class="" title="image-20200811210609849">

<p>双击添加到钥匙串：</p>
<img src="/posts/38926/image-20200811220051366.png" class="" title="image-20200811220051366">

<p>双击它，设置永久信任：</p>
<img src="/posts/38926/image-20200811220154160.png" class="" title="image-20200811220154160">

<p>填写 mac 密码更新后就 OK 啦。</p>
<h2 id="App-ID-创建"><a href="#App-ID-创建" class="headerlink" title="App ID 创建"></a>App ID 创建</h2><img src="/posts/38926/image-20200811210734896.png" class="" title="image-20200811210734896">

<h2 id="添加好你的测试用户-iPhone-X-的-uuid"><a href="#添加好你的测试用户-iPhone-X-的-uuid" class="headerlink" title="添加好你的测试用户 iPhone X 的 uuid"></a>添加好你的测试用户 iPhone X 的 uuid</h2><img src="/posts/38926/image-20200811210916996.png" class="" title="image-20200811210916996.png">

<h2 id="创建-Ad-Hoc-类型的描述文件"><a href="#创建-Ad-Hoc-类型的描述文件" class="headerlink" title="创建 Ad Hoc 类型的描述文件"></a>创建 Ad Hoc 类型的描述文件</h2><img src="/posts/38926/image-20200811211011626.png" class="" title="image-20200811211011626">

<img src="/posts/38926/image-20200811211102141.png" class="" title="image-20200811211102141">

<p>选择你刚创建的证书：</p>
<img src="/posts/38926/image-20200811211213717.png" class="" title="image-20200811211213717">

<p>勾选想要测试的 iPhone 手机：</p>
<img src="/posts/38926/image-20200811211324080.png" class="" title="image-20200811211324080">

<p>给描述文件起个名字：</p>
<img src="/posts/38926/image-20200811211832315.png" class="" title="image-20200811211832315">

<p>下载到本地：</p>
<img src="/posts/38926/image-20200811212455059.png" class="" title="image-20200811212455059">

<h2 id="添加到-Xcode"><a href="#添加到-Xcode" class="headerlink" title="添加到 Xcode"></a>添加到 Xcode</h2><p>打开你的 Xcode，双击刚下载的描述文件，啥都没发生就说明 Xcode 添加成功了。</p>
<h2 id="打包分发"><a href="#打包分发" class="headerlink" title="打包分发"></a>打包分发</h2><img src="/posts/38926/image-20200811212805179.png" class="" title="image-20200811212805179">

<p>点击 <code>Distribute App</code> 分发 App：</p>
<img src="/posts/38926/image-20200811213008715.png" class="" title="image-20200811213008715">

<p>选择 Ad hoc 模式：</p>
<img src="/posts/38926/image-20200811213108027.png" class="" title="image-20200811213108027">

<p>下一步，一定要勾选第三项：</p>
<img src="/posts/38926/image-20200811213236309.png" class="" title="image-20200811213236309">

<p>下面重点来了：</p>
<img src="/posts/38926/image-20200811213531074.png" class="" title="image-20200811213531074">

<p>上面四项分别为：</p>
<ul>
<li>你要打包项目所起的 App 名称</li>
<li>ipa 包下载地址（必须为 https）</li>
<li>在线图片地址 57*57（必须为 https）</li>
<li>在线图片地址 512*512（必须为 https）</li>
</ul>
<p>下面选择手动设置签名：</p>
<img src="/posts/38926/image-20200811214652617.png" class="" title="image-20200811214652617">

<p>选择刚生成的证书和描述文件：</p>
<img src="/posts/38926/image-20200811223021884.png" class="" title="image-20200811223021884">

<p>然后点击下一步坐等：</p>
<img src="/posts/38926/image-20200811223138624.png" class="" title="image-20200811223138624">

<p>最后需要输一次电脑开机密码，然后导出：</p>
<img src="/posts/38926/image-20200811224413574.png" class="" title="image-20200811224413574">

<p>导出文件有这些：</p>
<p>然后把 <code>manifest.plist</code> <code>xxx.ipa</code> 包以及两张 app 的 png 图片上传到服务器就好了：</p>
<img src="/posts/38926/image-20200811225217241.png" class="" title="image-20200811225217241">

<p>最后在 iPhone 的 Safari 上输入下面的模板链接就能下载到测试手机上了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">itms-services:<span class="comment">//?action=download-manifest&amp;url=你的服务器https地址/manifest.plist</span></span><br></pre></td></tr></table></figure>

<h2 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h2><p>如果你访问上面地址，在确认地址无误的情况下 Safari 并没有下载，原因可能是服务器没有开启针对 <code>.plist</code> 和 <code>.ipa</code> 文件的访问识别。</p>
<p>如何判断为此种情况了？以 IIS 为例：</p>
<p>直接在浏览器输入你的 ipa 下载地址 <code>https:XXX/yyt_test.ipa</code></p>
<p>出现下面类似截图：</p>
<img src="/posts/38926/image-20200811225556225.png" class="" title="image-20200811225556225">

<p>就说明此文件类型没有配置 MIME 类型。我们去 IIS 管理器配置下就 OK 了：</p>
<img src="/posts/38926/image-20200811225748687.png" class="" title="image-20200811225748687">

<p>选择添加</p>
<img src="/posts/38926/image-20200811225812700.png" class="" title="image-20200811225812700">

<p>添加 .ipa 文件的 MIME：</p>
<p>文件扩展名：**.ipa**</p>
<p>MIME 类型：<strong>application/octet-stream.ipa</strong></p>
<img src="/posts/38926/image-20200811225931403.png" class="" title="image-20200811225931403">

<p>添加 .plist 文件的 MIME:</p>
<p>文件扩展名：**.plist**</p>
<p>MIME 类型：<strong>text/xml</strong></p>
<img src="/posts/38926/image-20200811230001211.png" class="" title="image-20200811230001211">

<p>添加完毕后再次访问，应该就 OK 了。</p>
<h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><p><a href="https://segmentfault.com/a/1190000020617042">使用 XCODE 快速发布 IOS ad hoc 测试版本</a></p>
<p><a href="https://www.hangge.com/blog/cache/detail_1257.html">IIS - 解决 IPA 下载报错（应用程序“DEFAULT WEB SITE”中的服务器错误）</a></p>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>Xcode</tag>
      </tags>
  </entry>
  <entry>
    <title>使用Jekyll搭建GitHubPages博客</title>
    <url>/posts/63074/</url>
    <content><![CDATA[<h2 id="安装-Jekyll"><a href="#安装-Jekyll" class="headerlink" title="安装 Jekyll"></a>安装 Jekyll</h2><p>来源：<a href="https://jekyllrb.com/docs/installation/">https://jekyllrb.com/docs/installation/</a></p>
<h3 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h3><p>终端运行：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure>

<p>安装 Ruby：</p>
<p>Jekyll 依赖 Ruby v2.5.0+，如果你的 macOS 版本为 Catalina 10.15 或以上，则不需要再手动安装，因为系统自带 Ruby 2.6.3 。</p>
<a id="more"></a>

<blockquote>
<p>查看本地 Ruby 版本：<code>ruby -v</code></p>
<p>如果你的版本低于 10.15 则需要下载或更新你的 Ruby</p>
<p>具体下载or更新方案可查看：<a href="https://jekyllrb.com/docs/installation/macos/#install-ruby">https://jekyllrb.com/docs/installation/macos/#install-ruby</a></p>
</blockquote>
<p>安装 Jekyll：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gem install --user-install bundler jekyll</span><br></pre></td></tr></table></figure>

<p>选择你要安装博客的目录下运行：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jekyll new 你博客名(随意，反正最后要全部移动到你的githubpages repo下)</span><br></pre></td></tr></table></figure>

<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>windows安装不再赘述，可查看官网文档安装：<a href="https://jekyllrb.com/docs/installation/windows/">https://jekyllrb.com/docs/installation/windows/</a></p>
<h2 id="安装-minimal-mistakes-jekyll-主题"><a href="#安装-minimal-mistakes-jekyll-主题" class="headerlink" title="安装 minimal-mistakes-jekyll 主题"></a>安装 minimal-mistakes-jekyll 主题</h2><p>github 链接：<a href="https://github.com/mmistakes/minimal-mistakes">https://github.com/mmistakes/minimal-mistakes</a></p>
<h3 id="编辑-Gemfile"><a href="#编辑-Gemfile" class="headerlink" title="编辑 Gemfile"></a>编辑 Gemfile</h3><p>替换你的 <code>Gemfile</code> 文件：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">source &quot;https://rubygems.org&quot;</span><br><span class="line"></span><br><span class="line"># Hello! This is where you manage which Jekyll version is used to run.</span><br><span class="line"># When you want to use a different version, change it below, save the</span><br><span class="line"># file and run `bundle install`. Run Jekyll with `bundle exec`, like so:</span><br><span class="line">#</span><br><span class="line">#     bundle exec jekyll serve</span><br><span class="line">#</span><br><span class="line"># This will help ensure the proper Jekyll version is running.</span><br><span class="line"># Happy Jekylling!</span><br><span class="line"></span><br><span class="line"># gem &quot;github-pages&quot;, group: :jekyll_plugins</span><br><span class="line"></span><br><span class="line"># To upgrade, run `bundle update`.</span><br><span class="line"></span><br><span class="line">gem &quot;github-pages&quot;, group: :jekyll_plugins</span><br><span class="line">gem &quot;minimal-mistakes-jekyll&quot;, :github =&gt; &quot;mmistakes/minimal-mistakes&quot;</span><br><span class="line"></span><br><span class="line"># The following plugins are automatically loaded by the theme-gem:</span><br><span class="line">#   gem &quot;jekyll-paginate&quot;</span><br><span class="line">#   gem &quot;jekyll-sitemap&quot;</span><br><span class="line">#   gem &quot;jekyll-gist&quot;</span><br><span class="line">#   gem &quot;jekyll-feed&quot;</span><br><span class="line">#   gem &quot;jekyll-include-cache&quot;</span><br><span class="line">#</span><br><span class="line"># If you have any other plugins, put them here!</span><br><span class="line">group :jekyll_plugins do</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>运行 <code>bundle install</code> 安装依赖。</p>
<h3 id="配置-config-yml"><a href="#配置-config-yml" class="headerlink" title="配置 _config.yml"></a>配置 _config.yml</h3><p>找到 <code>_config.yml</code> 文件并替换：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Welcome to Jekyll!</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># This config file is meant for settings that affect your whole blog, values</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">which</span> you are expected to <span class="built_in">set</span> up once and rarely edit after that. If you find</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yourself editing this file very often, consider using Jekyll<span class="string">&#x27;s data files</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> feature <span class="keyword">for</span> the data you need to update frequently.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># For technical reasons, this file is *NOT* reloaded automatically when you use</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&#x27;bundle exec jekyll serve&#x27;</span>. If you change this file, please restart the server process.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If you need help with YAML syntax, here are some quick references for you:</span></span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> https://learn-the-web.algonquindesign.ca/topics/markdown-yaml-cheat-sheet/<span class="comment">#yaml</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://learnxinyminutes.com/docs/yaml/</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Site settings</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> These are used to personalize your new site. If you look <span class="keyword">in</span> the HTML files,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> you will see them accessed via &#123;&#123; site.title &#125;&#125;, &#123;&#123; site.email &#125;&#125;, and so on.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You can create any custom variable you would like, and they will be accessible</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the templates via &#123;&#123; site.myvariable &#125;&#125;.</span></span><br><span class="line"></span><br><span class="line">title: Your awesome title</span><br><span class="line">email: your-email@example.com</span><br><span class="line">description: &gt;- # this means to ignore newlines until &quot;baseurl:&quot;</span><br><span class="line">  Write an awesome description for your new site here. You can edit this</span><br><span class="line">  line in _config.yml. It will appear in your document head meta (for</span><br><span class="line">  Google search results) and in your feed.xml site description.</span><br><span class="line">baseurl: &quot;&quot; # the subpath of your site, e.g. /blog</span><br><span class="line">url: &quot;https://evestorm.github.io&quot; # the base hostname &amp; protocol for your site, e.g. http://example.com</span><br><span class="line">repository: &quot;&#123;github_username&#125;/&#123;github_username&#125;.github.io&quot; # 把 &#123;github_username&#125; 替换成你github的username</span><br><span class="line">twitter_username: jekyllrb</span><br><span class="line">github_username:  lance # 你的username，随便填</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Build settings</span></span><br><span class="line">theme: minimal-mistakes-jekyll</span><br><span class="line">plugins:</span><br><span class="line">  - jekyll-feed</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Exclude from processing.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The following items will not be processed, by default.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Any item listed under the `exclude:` key here will be automatically added to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the internal <span class="string">&quot;default list&quot;</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Excluded items can be processed by explicitly listing the directories or</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> their entries<span class="string">&#x27; file path in the `include:` list.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># exclude:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - .sass-cache/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - .jekyll-cache/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - gemfiles/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - Gemfile</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - Gemfile.lock</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - node_modules/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - vendor/bundle/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - vendor/cache/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - vendor/gems/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - vendor/ruby/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后执行 <code>bundle update</code>。</p>
<h3 id="替换和更改"><a href="#替换和更改" class="headerlink" title="替换和更改"></a>替换和更改</h3><ul>
<li><p>替换根目录下 <code>index.markdown</code> 为 <code>index.html</code>  ：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">layout: home</span><br><span class="line">author_profile: true</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
</li>
<li><p>找到 <code>_posts/0000-00-00-welcome-to-jekyll.md</code> 并替换 <code>layout: single</code></p>
</li>
<li><p>删除 <code>about.md</code> 文件</p>
</li>
</ul>
<p>最后执行： <code>bundle exec jekyll serve</code> 本地运行博客。</p>
]]></content>
      <categories>
        <category>教程</category>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Jekyll</tag>
      </tags>
  </entry>
  <entry>
    <title>使用hexo搭建个人博客</title>
    <url>/posts/43303/</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>利用 <a href="https://hexo.io/zh-cn/">Hexo</a> 在 <a href="https://baike.baidu.com/item/github/10145341?fr=aladdin">GitHub</a> 上搭建个人博客。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>你的电脑需要安装下面两个应用程序：</p>
<ul>
<li>NodeJS <a href="http://www.runoob.com/nodejs/nodejs-install-setup.html">如何安装</a></li>
<li>Git <a href="http://www.runoob.com/git/git-install-setup.html">如何安装</a></li>
</ul>
<p>或者直接查看 hexo 的<a href="https://hexo.io/zh-cn/docs/#%E5%AE%89%E8%A3%85%E5%89%8D%E6%8F%90">官方文档</a>查看安装教程。</p>
<a id="more"></a>

<h2 id="安装-Hexo"><a href="#安装-Hexo" class="headerlink" title="安装 Hexo"></a>安装 Hexo</h2><blockquote>
<p><a href="https://hexo.io/zh-cn/docs/">安装文档</a></p>
</blockquote>
<p>终端全局安装：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<h3 id="建站"><a href="#建站" class="headerlink" title="建站"></a>建站</h3><p>安装 Hexo 完成后，请执行下列命令，Hexo 将会在指定文件夹中新建所需要的文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo init 你的站点文件夹</span><br><span class="line">cd 你的站点文件夹</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><p>下方是三个常见命令，可以先执行前俩看看效果，最后一个部署命令待会再执行。</p>
<ul>
<li><code>hexo server -p 5000</code> 本地启动服务器，5000 端口</li>
<li><code>hexo new &#39;你想要创建的文章名称&#39;</code> 创建文章</li>
<li><code>hexo clean &amp;&amp; hexo deploy</code> 部署网站</li>
</ul>
<h3 id="使用第三方主题"><a href="#使用第三方主题" class="headerlink" title="使用第三方主题"></a>使用第三方主题</h3><ul>
<li><a href="https://github.com/iissnan/hexo-theme-next">Next</a> 【推荐】</li>
<li><a href="https://github.com/litten/hexo-theme-yilia">Yilia</a></li>
</ul>
<h4 id="安装-Next-主题"><a href="#安装-Next-主题" class="headerlink" title="安装 Next 主题"></a>安装 Next 主题</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd 你的站点目录</span><br><span class="line">git clone https://github.com/next-theme/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="创建分类和标签"><a href="#创建分类和标签" class="headerlink" title="创建分类和标签"></a>创建分类和标签</h3><h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p>运行：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo new page &quot;categories&quot;</span><br></pre></td></tr></table></figure>

<p>p.s. 命名为 <code>categories</code> 原因是 <code>categories</code> 在 next 主题中是一个关键词对应着分类。</p>
<p>在主站根目录下,也就是你 hexo 的目录下找到 <code>/source/categories/index.md</code>，打开后的效果类似下方代码：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: categories #本页标题</span><br><span class="line">date: 2018-03-13 23:02:50 #创建日期</span><br><span class="line">type: &#x27;categories&#x27; #分类属于</span><br><span class="line">comments: false #如果有启用多说 或者 Disqus评论，默认页面也会带有评论。需要关闭的话，请添加字段 comments 并将值设置为 false</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>接着在 themes 主题文件夹下找到 next 文件夹，修改 _config.yml 文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">home:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="attr">about:</span> <span class="string">/about/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-user</span></span><br><span class="line">  <span class="attr">tags:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-tags</span></span><br><span class="line">  <span class="attr">categories:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-th</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-archive</span></span><br></pre></td></tr></table></figure>

<p>然后在命令行输入添加文章命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo new &#39;你想要创建的文章名称&#39;</span><br></pre></td></tr></table></figure>

<p>根目录(主站目录下)/source/_posts/&lt;刚创建的文章名称&gt;.md，双击打开：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 文章标题</span><br><span class="line">date: 2018-03-13 23:13:23</span><br><span class="line">tags: html #属于哪个标签</span><br><span class="line">categories: interview #属于哪个分类</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<h4 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h4><p>打开命令行，进入博客所在文件夹。执行命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo new page tags</span><br></pre></td></tr></table></figure>

<p>成功后会有一个路径提示</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">INFO Created: ~/Documents/blog/source/tags/index.md</span><br></pre></td></tr></table></figure>

<p>找到对应的文件打开</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: tags</span><br><span class="line">date: 2018-03-14 00:02:05</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>添加 type: “tags”到内容中，添加后是这样的：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 标签</span><br><span class="line">date: 2018-03-14 00:03:52</span><br><span class="line">type: &#x27;tags&#x27;</span><br><span class="line">comments: false</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>打开你的文章页面：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: jQuery对表单的操作及更多应用</span><br><span class="line">date: 2019-03-14 00:03:55</span><br><span class="line">categories: 前端</span><br><span class="line">tags: jQuery  #如果想要多个标签可以 tags: [jQuery, 表格, 表单验证] or</span><br><span class="line"><span class="bullet">-</span> jQuery</span><br><span class="line"><span class="bullet">-</span> 表格</span><br><span class="line"><span class="bullet">-</span> 表单验证</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>p.s. 如果想要实现父子分类，也和标签一样的格式：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">categories:</span><br><span class="line">- IDE</span><br><span class="line">- VSCode</span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://hexo.io/zh-cn/docs/front-matter.html#%E5%88%86%E7%B1%BB%E5%92%8C%E6%A0%87%E7%AD%BE">分类和标签</a></p>
<h5 id="修改文章底部-号标签，改为图标"><a href="#修改文章底部-号标签，改为图标" class="headerlink" title="修改文章底部 # 号标签，改为图标"></a>修改文章底部 # 号标签，改为图标</h5><p>寻找 <code>themes/next/_config.yml</code> 中的 tag_icon ，改为 true</p>
<h3 id="头像设置"><a href="#头像设置" class="headerlink" title="头像设置"></a>头像设置</h3><p>把头像放在站点根目录的 <code>source/uploads/</code> 下，然后在 <code>theme/next/_config.yml</code> 下修改配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">avatar:</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">/uploads/avatar.png</span></span><br></pre></td></tr></table></figure>

<h3 id="侧边栏"><a href="#侧边栏" class="headerlink" title="侧边栏"></a>侧边栏</h3><h4 id="菜单"><a href="#菜单" class="headerlink" title="菜单"></a>菜单</h4><p>在 <code>theme/next/_config.yml</code> 下配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">home:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="comment">#about: /about/ || fa fa-user</span></span><br><span class="line">  <span class="comment">#tags: /tags/ || fa fa-tags</span></span><br><span class="line">  <span class="comment">#categories: /categories/ || fa fa-th</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="comment">#schedule: /schedule/ || fa fa-calendar</span></span><br><span class="line">  <span class="comment">#sitemap: /sitemap.xml || fa fa-sitemap</span></span><br><span class="line">  <span class="comment">#commonweal: /404/ || fa fa-heartbeat</span></span><br></pre></td></tr></table></figure>

<h4 id="社交"><a href="#社交" class="headerlink" title="社交"></a>社交</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">social:</span></span><br><span class="line">  <span class="attr">GitHub:</span> <span class="string">https://github.com/yourname</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-github</span></span><br><span class="line">  <span class="attr">E-Mail:</span> <span class="string">mailto:yourname@gmail.com</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-envelope</span></span><br><span class="line">  <span class="attr">Weibo:</span> <span class="string">https://weibo.com/yourname</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-weibo</span></span><br><span class="line">  <span class="attr">Google:</span> <span class="string">https://plus.google.com/yourname</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-google</span></span><br><span class="line">  <span class="attr">Twitter:</span> <span class="string">https://twitter.com/yourname</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-twitter</span></span><br><span class="line">  <span class="attr">FB Page:</span> <span class="string">https://www.facebook.com/yourname</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-facebook</span></span><br><span class="line">  <span class="attr">StackOverflow:</span> <span class="string">https://stackoverflow.com/yourname</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-stack-overflow</span></span><br><span class="line">  <span class="attr">YouTube:</span> <span class="string">https://youtube.com/yourname</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-youtube</span></span><br><span class="line">  <span class="attr">Instagram:</span> <span class="string">https://instagram.com/yourname</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-instagram</span></span><br><span class="line">  <span class="attr">Skype:</span> <span class="string">skype:yourname?call|chat</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-skype</span></span><br></pre></td></tr></table></figure>

<h3 id="阅读更多"><a href="#阅读更多" class="headerlink" title="阅读更多"></a>阅读更多</h3><p>在文章想要截断的地方添加 <code>&lt;!-- more --&gt;</code> ，这样在文章列表中就会只展示到截断位置为止。</p>
<h2 id="第三方插件"><a href="#第三方插件" class="headerlink" title="第三方插件"></a>第三方插件</h2><h3 id="永久-URL-生成：hexo-abbrlink"><a href="#永久-URL-生成：hexo-abbrlink" class="headerlink" title="永久 URL 生成：hexo-abbrlink"></a>永久 URL 生成：hexo-abbrlink</h3><ul>
<li>用来生成每篇博客永久 URL 链接的</li>
<li>Repo: <a href="https://github.com/rozbo/hexo-abbrlink">https://github.com/rozbo/hexo-abbrlink</a></li>
<li>执行： <code>npm install hexo-abbrlink --save</code></li>
</ul>
<h3 id="部署到-GitHub：hexo-deployer-git"><a href="#部署到-GitHub：hexo-deployer-git" class="headerlink" title="部署到 GitHub：hexo-deployer-git"></a>部署到 GitHub：hexo-deployer-git</h3><ul>
<li>将本地博客部署到 GitHub</li>
<li>Repo: <a href="https://hexo.io/zh-cn/docs/one-command-deployment">https://hexo.io/zh-cn/docs/one-command-deployment</a>)</li>
<li>执行： <code>npm install hexo-deployer-git --save</code></li>
</ul>
<p><strong>如何部署</strong></p>
<p>在 <code>_config.yml</code> 下配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">&#x27;https://github.com/evestorm/evestorm.github.io&#x27;</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">&#x27;gh-pages&#x27;</span></span><br></pre></td></tr></table></figure>

<p>然后在你的 githubpages 的 repo 下新建 <code>gh-pages</code> 分支，最后执行：<code>hexo clean &amp;&amp; hexo deploy</code> 即可部署。</p>
<h3 id="本地热更新：hexo-server"><a href="#本地热更新：hexo-server" class="headerlink" title="本地热更新：hexo-server"></a>本地热更新：hexo-server</h3><ul>
<li>服务器模块。在启动期间，Hexo 会监视文件变动并自动更新</li>
<li>Repo: <a href="https://github.com/hexojs/hexo-server">https://github.com/hexojs/hexo-server</a></li>
<li>执行： <code>npm install hexo-server –save</code></li>
</ul>
<h3 id="关键词搜索：LocalSearch"><a href="#关键词搜索：LocalSearch" class="headerlink" title="关键词搜索：LocalSearch"></a>关键词搜索：LocalSearch</h3><ul>
<li>本地搜索</li>
<li>Repo: <a href="https://github.com/theme-next/hexo-generator-searchdb">https://github.com/theme-next/hexo-generator-searchdb</a></li>
<li>执行：<code>npm install hexo-generator-searchdb --save</code></li>
</ul>
<p><strong>配置博客</strong></p>
<p>安装完成，编辑博客配置文件：<code>hexo/_config.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">content:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">html</span></span><br></pre></td></tr></table></figure>

<p><strong>配置主题</strong></p>
<p>Next 主题自带搜索设置，编辑主题配置文件：<code>_config.yml</code></p>
<p>找到文件中 Local search 的相关配置，设为 <code>true</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Local search</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/next-theme/hexo-generator-searchdb</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># If auto, trigger search by changing input.</span></span><br><span class="line">  <span class="comment"># If manual, trigger search by pressing enter key or search button.</span></span><br><span class="line">  <span class="attr">trigger:</span> <span class="string">auto</span></span><br><span class="line">  <span class="comment"># Show top n results per article, show all results by setting to -1</span></span><br><span class="line">  <span class="attr">top_n_per_article:</span> <span class="number">1</span></span><br><span class="line">  <span class="comment"># Unescape html strings to the readable one.</span></span><br><span class="line">  <span class="attr">unescape:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Preload the search data when the page loads.</span></span><br><span class="line">  <span class="attr">preload:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>最后记得 hexo 重新部署。</p>
<h3 id="统计分析：busuanzi-count"><a href="#统计分析：busuanzi-count" class="headerlink" title="统计分析：busuanzi_count"></a>统计分析：busuanzi_count</h3><p>NexT 主题集成了不蒜子（busuanzi_count）统计功能，在 NexT 配置文件中找到关键词 <code>busuanzi_count:</code> ，把 enable 设置为 true</p>
<p>p.s. 除此之外，如果设置为 true 后仍然无效，且打开控制台显示 js 报错。有可能是不蒜子链接失效的原因，需要在 Next 主题配置文件位置：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">themes\next\layout\_third-party\analytics\busuanzi-counter.swig</span><br></pre></td></tr></table></figure>

<p>修改 script 链接为：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;script</span><br><span class="line">  async</span><br><span class="line">  src=&quot;https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js&quot;</span><br><span class="line">&gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="评论功能：ChangYan"><a href="#评论功能：ChangYan" class="headerlink" title="评论功能：ChangYan"></a>评论功能：ChangYan</h3><p>文档地址：<a href="https://theme-next.js.org/docs/third-party-services/comments.html#Changyan-China">https://theme-next.js.org/docs/third-party-services/comments.html#Changyan-China</a></p>
<ul>
<li><p>注册登录：<a href="https://changyan.kuaizhan.com/">https://changyan.kuaizhan.com/</a></p>
</li>
<li><p>获取 APP ID 和 APP KEY</p>
</li>
<li><p>设置 changyan enable: true:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># changyan</span></span><br><span class="line"><span class="attr">changyan:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">appid:</span></span><br><span class="line">  <span class="attr">appkey:</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="代码块复制"><a href="#代码块复制" class="headerlink" title="代码块复制"></a>代码块复制</h3><p>下载<a href="https://raw.githubusercontent.com/zenorocha/clipboard.js/master/dist/clipboard.min.js">clipboard.min.js</a>并保存至<code>themes\next\source\js\clipboard.min.js</code></p>
<p>在 <code>.\themes\next\source\js\</code> 下创建 <code>clipboard-use.js</code> , 添加如下内容：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*页面载入完成后，创建复制按钮*/</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="meta">  &#x27;use strict&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> initCopyCode = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> parents = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;.highlight .code&#x27;</span>);</span><br><span class="line">    parents.forEach(<span class="function"><span class="params">parent</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> btn = <span class="built_in">document</span>.createElement(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">      <span class="keyword">let</span> i = <span class="built_in">document</span>.createElement(<span class="string">&#x27;i&#x27;</span>);</span><br><span class="line">      <span class="keyword">let</span> span = <span class="built_in">document</span>.createElement(<span class="string">&#x27;span&#x27;</span>);</span><br><span class="line">      btn.classList.add(<span class="string">&#x27;btn-copy&#x27;</span>);</span><br><span class="line">      btn.setAttribute(<span class="string">&#x27;data-clipboard-snippet&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">      i.classList.add(<span class="string">&#x27;fa&#x27;</span>, <span class="string">&#x27;fa-clipboard&#x27;</span>);</span><br><span class="line">      span.innerText = <span class="string">&#x27;复制&#x27;</span>;</span><br><span class="line">      i.appendChild(span);</span><br><span class="line">      btn.appendChild(i);</span><br><span class="line">      parent.insertBefore(btn, parent.firstChild);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> ClipboardJS(<span class="string">&#x27;.btn-copy&#x27;</span>, &#123;</span><br><span class="line">      target: <span class="function"><span class="keyword">function</span> (<span class="params">trigger</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> trigger.nextElementSibling;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  initCopyCode();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在 <code>根目录\source\_data\</code> 下创建 <code>styles.styl</code> ，添加如下内容：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">// 代码块复制按钮</span><br><span class="line">// <span class="selector-tag">--------------------------------------------------</span></span><br><span class="line"><span class="selector-class">.highlight</span> &#123;</span><br><span class="line">  //方便copy代码按钮（btn-copy）的定位</span><br><span class="line">  <span class="selector-tag">position</span>: <span class="selector-tag">relative</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn-copy</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(#fcfcfc, #eee);</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#d5d5d5</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">-webkit-user-select</span>: none;</span><br><span class="line">  <span class="attribute">-moz-user-select</span>: none;</span><br><span class="line">  <span class="attribute">-ms-user-select</span>: none;</span><br><span class="line">  <span class="attribute">user-select</span>: none;</span><br><span class="line">  <span class="attribute">-webkit-appearance</span>: none;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">13px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="attribute">-webkit-transition</span>: opacity <span class="number">0.3s</span> ease-in-out;</span><br><span class="line">  <span class="attribute">-o-transition</span>: opacity <span class="number">0.3s</span> ease-in-out;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="number">0.3s</span> ease-in-out;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">2px</span> <span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn-copy</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.highlight</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.btn-copy</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>source\_data\</code> 下创建 <code>body-end.swig</code> ，添加如下内容：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 代码块复制功能 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/js/clipboard.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/js/clipboard-use.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 next 配置文件中启用 <code>styles.styl</code> 和 <code>body-end.swig</code>：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">custom_file_path:</span><br><span class="line">  bodyEnd: source/_data/body-end.swig</span><br><span class="line">  style: source/_data/styles.styl</span><br></pre></td></tr></table></figure>

<h3 id="常用配置"><a href="#常用配置" class="headerlink" title="常用配置"></a>常用配置</h3><p><a href="https://blog.csdn.net/lewky_liu/article/details/81277337">Hexo 瞎折腾系列(4) - 站点首页不显示文章全文</a></p>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// npm全局安装Hexo</span><br><span class="line">npm install -g hexo-cli</span><br><span class="line"></span><br><span class="line">// 新建Hexo项目</span><br><span class="line">hexo init &lt;folder&gt;</span><br><span class="line">cd &lt;folder&gt;</span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">// 新建文章</span><br><span class="line">hexo new &#x27;文章名&#x27;</span><br><span class="line"></span><br><span class="line">// 启动服务器</span><br><span class="line">hexo server -p 5000</span><br><span class="line"></span><br><span class="line">// 生成静态文件</span><br><span class="line">hexo generate --watch</span><br><span class="line"></span><br><span class="line">// 部署</span><br><span class="line">hexo clean &amp;&amp; hexo deploy</span><br></pre></td></tr></table></figure>

<h2 id="相关配置及资源"><a href="#相关配置及资源" class="headerlink" title="相关配置及资源"></a>相关配置及资源</h2><ul>
<li><a href="https://juejin.im/post/5bcd2d395188255c3b7dc1db#heading-42">Hexo+NexT 打造一个炫酷博客</a></li>
<li><a href="https://me.idealli.com/post/e8d13fc.html">这应该是最全的 hexo 博客搭建以及 next 美化教程</a></li>
<li><a href="https://leancloud.cn/">LeanCloud</a></li>
<li><a href="https://eirunye.github.io/2018/09/15/Hexo%E6%90%AD%E5%BB%BAGitHub%E5%8D%9A%E5%AE%A2%E2%80%94%E6%89%93%E9%80%A0%E7%82%AB%E9%85%B7%E7%9A%84NexT%E4%B8%BB%E9%A2%98%E2%80%94%E9%AB%98%E7%BA%A7%E2%80%94%E5%9B%9B/">Hexo 搭建 GitHub 博客—打造炫酷的 NexT 主题–高级(四)</a></li>
<li><a href="http://www.missfli.com/2018/06/19/github-hexo-next-08.html">Hexo NexT 主题代码块添加复制功能</a></li>
<li><a href="https://ihaoming.top/archives/9a935f57.html">修改 hexo 博客 next 主题文章页面宽度</a></li>
<li><a href="https://hexo.io/zh-cn/docs/asset-folders.html">在 Hexo 中使用资源文件夹添加图片</a></li>
</ul>
]]></content>
      <categories>
        <category>教程</category>
        <category>博客</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>使用lorem在HTML中生成随机文本</title>
    <url>/posts/22606/</url>
    <content><![CDATA[<p>看 b 站视频偶尔知道的这个功能，VSCode 可以自动生成随机文本。这样平常就不用在编写前端页面时重复 copy 文字用来占位了。</p>
<p>使用方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">lorem + 单词数量;</span><br></pre></td></tr></table></figure>

<img src="/posts/22606/lorem.gif" class="" title="lorem">

<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p><strong>Lorem ipsum</strong></p>
<blockquote>
<p>Lorem ipsum，中文又称“乱数假文”， 是指一篇常用于排版设计领域的拉丁文文章，主要的目的为测试文章或文字在不同字型、版型下看起来的效果，通常网站还没建设好时会出现这段文字</p>
</blockquote>
<ul>
<li>[来自百度百科](<a href="https://baike.baidu.com/item/Lorem">https://baike.baidu.com/item/Lorem</a> ipsum/3684081?fr=aladdin)</li>
</ul>
]]></content>
      <categories>
        <category>工具</category>
        <category>IDE</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>VSCode</tag>
      </tags>
  </entry>
  <entry>
    <title>使用nvm管理node版本</title>
    <url>/posts/48432/</url>
    <content><![CDATA[<h1 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h1><h2 id="卸载之前安装的-node"><a href="#卸载之前安装的-node" class="headerlink" title="卸载之前安装的 node"></a>卸载之前安装的 node</h2><p>如果安装 nvm 之前本地已全局安装过 node，请在终端执行下面脚本删除 node：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看已经安装在全局的模块</span></span><br><span class="line">npm ls -g --depth=0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除全局 node_modules 目录</span></span><br><span class="line">sudo rm -rf /usr/local/lib/node_modules</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除 node</span></span><br><span class="line">sudo rm /usr/local/bin/node</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除全局 node 模块注册的软链</span></span><br><span class="line">cd /usr/local/bin &amp;&amp; ls -l | grep &quot;../lib/node_modules/&quot; | awk &#x27;&#123;print $9&#125;&#x27;| xargs rm</span><br></pre></td></tr></table></figure>

<h2 id="安装-nvm"><a href="#安装-nvm" class="headerlink" title="安装 nvm"></a>安装 nvm</h2><p>打开终端，进入当前用户的 home 目录：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ~</span><br></pre></td></tr></table></figure>

<p>使用 ls -a 显示当前目录下的所有文件（夹）（包含隐藏文件及文件夹），查看有没有 .bash_profile 文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls -a</span><br></pre></td></tr></table></figure>

<p>如果没有就创建：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">touch ~/.bash_profile</span><br></pre></td></tr></table></figure>

<p>然后执行 nvm 安装：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh | bash</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh | bash</span><br></pre></td></tr></table></figure>

<p>安装完成后，终端输入 nvm 验证是否安装成功，终端可能出现 Command not found，这并非没有安装成功，试试重启终端再输入 nvm 。一般情况下此时已可用。</p>
<h2 id="执行-nvm-命令提示-Command-not-found"><a href="#执行-nvm-命令提示-Command-not-found" class="headerlink" title="执行 nvm 命令提示 Command not found"></a>执行 nvm 命令提示 Command not found</h2><p>如果你的系统是最新更新的 macOS Catalina ，则重启终端也可能没用，因为默认的 shell 是 zsh，所以找不到配置文件。</p>
<p>解决方案：</p>
<h3 id="一-通过-source-读取并执行命令"><a href="#一-通过-source-读取并执行命令" class="headerlink" title="一. 通过 source 读取并执行命令"></a>一. 通过 source 读取并执行命令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.新建一个 .zshrc 文件（如果没有的话）</span></span><br><span class="line">touch ~/.zshrc</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.在 ~/.zshrc文件最后，增加一行</span></span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>

<p>重启终端后就能使用 nvm 命令了。</p>
<h3 id="二-拷贝-bash-profile-中的-nvm-相关环境配置到-zshrc-中去"><a href="#二-拷贝-bash-profile-中的-nvm-相关环境配置到-zshrc-中去" class="headerlink" title="二. 拷贝 .bash_profile 中的 nvm 相关环境配置到 .zshrc 中去"></a>二. 拷贝 .bash_profile 中的 nvm 相关环境配置到 .zshrc 中去</h3><p>我在执行完方法以后，发现 nvm 命令是有了，但是我的终端 zsh 文字出现了乱码。所以我采取了方法二。</p>
<p>打开 .bash_profile 文件，将其中的 nvm 环境配置复制一份到 .zshrc 文件代码中的末尾去：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export NVM_DIR=&quot;$HOME/.nvm&quot;</span><br><span class="line">[ -s &quot;$NVM_DIR/nvm.sh&quot; ] &amp;&amp; \. &quot;$NVM_DIR/nvm.sh&quot;  # This loads nvm</span><br><span class="line">[ -s &quot;$NVM_DIR/bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR/bash_completion&quot;  # This loads nvm bash_completion</span><br></pre></td></tr></table></figure>

<p>重启终端再次执行 nvm ，发现能够使用。</p>
<h1 id="Window-10-64bit"><a href="#Window-10-64bit" class="headerlink" title="Window 10 64bit"></a>Window 10 64bit</h1><p>摘自：<a href="https://zhuanlan.zhihu.com/p/81801605">Windows nvm 的安装使用(及排坑)</a></p>
<h2 id="卸载系统上现有-node（如果有）"><a href="#卸载系统上现有-node（如果有）" class="headerlink" title="卸载系统上现有 node（如果有）"></a>卸载系统上现有 node（如果有）</h2><blockquote>
<p>此处基于<a href="https://link.zhihu.com/?target=https://www.bbsmax.com/A/1O5EPPR3J7/">windows 下 nvm 安装 node 之后 npm 命令找不到问题解决办法</a>，在此基础上简化和完善。</p>
</blockquote>
<ul>
<li>在卸载程序中卸载 node</li>
<li>在环境变量中删除所有与 node 相关的路径(无论是 user 级，还是 system 级)</li>
<li>删除以下路径的文件(可能只有部分文件才有) C:\Program Files (x86)\nodejs</li>
</ul>
<blockquote>
<p>C:\Program Files\nodejs<br>C:\Users{User}\AppData\Roaming\npm<br>C:\Users{User}\AppData\Roaming\npm-cache<br>C:\Users{User}\node_modules (在我电脑上的路径)</p>
</blockquote>
<h2 id="下载-nvm"><a href="#下载-nvm" class="headerlink" title="下载 nvm"></a>下载 nvm</h2><p>下载最新版 nvm 并安装<a href="https://link.zhihu.com/?target=https://github.com/coreybutler/nvm-windows/releases">nvm-setup.zip</a></p>
<h2 id="更换镜像源"><a href="#更换镜像源" class="headerlink" title="更换镜像源"></a>更换镜像源</h2><p>在 <code>路径 C:\Users\&#123;User&#125;\AppData\Roaming\nvm\settings.txt</code> 下添加以下两条</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">node_mirror: https:<span class="comment">//npm.taobao.org/mirrors/node/</span></span><br><span class="line">npm_mirror: https:<span class="comment">//npm.taobao.org/mirrors/npm/</span></span><br></pre></td></tr></table></figure>

<p>此时如果你还仔细观察，会发现<code>C:\Program Files</code>下的 nodejs 问家家其实是一个快捷方式，指向的是 nvm 的安装路径<code>C:\Users\i353667\AppData\Roaming\nvm</code>下对应的 node 版本。</p>
<h1 id="nvm-常见命令"><a href="#nvm-常见命令" class="headerlink" title="nvm 常见命令"></a>nvm 常见命令</h1><ul>
<li>nvm ls 列出安装 node 的所有版本</li>
<li>nvm current 显示当前使用的版本</li>
<li>nvm install 安装指定的版本，如 nvm install v8.13.0</li>
<li>nvm uninstall 卸载指定的版本</li>
<li>nvm use node-version 切换使用指定的版本</li>
<li>nvm alias default v12.18.4 设置默认 node 版本</li>
<li>nvm deactivate 解除当前版本绑定</li>
<li>nvm ls-remote 获取远程可用版本</li>
<li>nvm list available 获取可用的 node 版本列表</li>
</ul>
]]></content>
      <categories>
        <category>后端</category>
        <category>Node</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>nvm</tag>
      </tags>
  </entry>
  <entry>
    <title>使用you-get下载网站视频</title>
    <url>/posts/21487/</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><code>you-get</code> 是 <code>GitHub</code> 上的一个开源项目，可以帮助我们下载大多主流网站上的视频、图片及音频。</p>
<p><strong>GitHub Repo 地址：</strong> <a href="https://github.com/soimort/you-get">soimort/you-get</a></p>
<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>有时候希望能在 B 站下载在线视频到本地，然而 B 站只支持在手机端缓存。所以 Google 了下发现了一个插件：「<a href="https://chrome.google.com/webstore/detail/bilibili%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E4%B8%8B%E8%BD%BD%E5%8A%A9%E6%89%8B/bfcbfobhcjbkilcbehlnlchiinokiijp?utm_source=chrome-ntp-icon">bilibili 哔哩哔哩下载助手</a>」（点击左侧链接在 google 应用商店直接下载），下载完成后打开你要下载的 B 站 视频链接，右下角就会出现一个按钮：</p>
<img src="/posts/21487/%E6%89%93%E5%BC%80b%E7%AB%99%E5%8A%A9%E6%89%8B.png" class="" title="打开b站助手截图">

<p>点击后就弹出下载详情，直接按下图配置点击合并下载即可：</p>
<img src="/posts/21487/b%E7%AB%99%E4%B8%8B%E8%BD%BD%E5%8A%A9%E6%89%8B.png" class="" title="b站下载助手使用截图">

<p>扯远了，其实到目前为止一切都非常顺利，但这个助手插件有个问题就是有时候下载特别快有时候又特别慢，慢起来一个 200M 视频要下载 1 两个小时。所以我又开始了找工具征程。最后就发现了今天的主角————「you-get」。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>首先你需要安装 python3 最新版。（没有 python 的需要前往 python <a href="https://www.python.org/">官方</a>按照教程下载）。</p>
<p>然后在本地安装 you-get：</p>
<h3 id="Windows-用户"><a href="#Windows-用户" class="headerlink" title="Windows 用户"></a>Windows 用户</h3><p>按住键盘「win+R」打开运行窗口，输入 <code>cmd</code> 点确定，然后键入如下命名：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip3 install you-get</span><br><span class="line">pip3 install --upgrade you-get</span><br><span class="line">python -m pip install --upgrade pip</span><br></pre></td></tr></table></figure>

<p>执行完上面三步并没有报错就代表安装成功了。</p>
<h3 id="Mac-用户"><a href="#Mac-用户" class="headerlink" title="Mac 用户"></a>Mac 用户</h3><p>mac 这边更简单，快捷键「Ctrl+空格」输入 Terminal 回车启动，键入下方命名（和 Windows 一样，前提是安装最新版 python3.7+ ）：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip3 install you-get</span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>安装完成后咱们就能愉快的下载视频了。示例如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">you-get https://www.bilibili.com/video/av8106130?p=2</span><br></pre></td></tr></table></figure>

<h3 id="下载目录"><a href="#下载目录" class="headerlink" title="下载目录"></a>下载目录</h3><p>视频下载后存储在本地的地址就是你执行下载命名时所在的目录。</p>
]]></content>
      <categories>
        <category>效率</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>you-get</tag>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>减小Xcode体积</title>
    <url>/posts/4133/</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>今天用 <code>iStat Menus</code> 看了下硬盘大小，发现已用了 90%的空间。怎么突然这么大了？再用 <code>CleanMyMac</code> 查看了大文件空间占用，发现 Xcode 占了 53 个 G… 然后就想着应该有什么办法能减小 Xcode 体积。</p>
<a id="more"></a>

<h2 id="清理方案"><a href="#清理方案" class="headerlink" title="清理方案"></a>清理方案</h2><p>下面路径进入可以在 Finder 中按下快捷键 <code>Shift + Cmd + G</code> 进入。</p>
<ol>
<li>此文件夹下放的是连接真机生成的文件，可以全部删掉或者把不常用的版本删掉，再次连接设备会自动生成</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> ~/Library/Developer/Xcode/iOS DeviceSupport</span></span><br></pre></td></tr></table></figure>

<ol>
<li>app 打包生成的文件，可以删掉不需要的项目打包文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> ~/Library/Developer/Xcode/Archives</span></span><br></pre></td></tr></table></figure>

<ol>
<li>项目的索引文件等，可以全部删除，或者删除不常用的项目，再次打开项目会自动生成</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> ~/Library/Developer/Xcode/DerivedData</span></span><br></pre></td></tr></table></figure>

<p>删除了上述文件夹下不需要的文件后，我的 SSD 从 90%减少到了 85%。</p>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Xcode</tag>
      </tags>
  </entry>
  <entry>
    <title>函数中的rest参数</title>
    <url>/posts/29820/</url>
    <content><![CDATA[<h2 id="什么是-REST-参数"><a href="#什么是-REST-参数" class="headerlink" title="什么是 REST 参数"></a>什么是 REST 参数</h2><p>REST参数翻译过来就是剩余参数，<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Rest_parameters">MDN</a>上的定义是：</p>
<blockquote>
<p>剩余参数语法允许我们将一个不定数量的参数表示为一个数组。</p>
</blockquote>
<a id="more"></a>

<h2 id="示例说明"><a href="#示例说明" class="headerlink" title="示例说明"></a>示例说明</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...theArgs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> theArgs.reduce(<span class="function">(<span class="params">previous, current</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> previous + current;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line"><span class="comment">// expected output: 6</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</span><br><span class="line"><span class="comment">// expected output: 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 下例中，剩余参数包含了从第二个到最后的所有实参，然后用第一个实参依次乘以它们</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">multiplier, ...theArgs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> theArgs.map(<span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> multiplier * element;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = multiply(<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); </span><br><span class="line"><span class="built_in">console</span>.log(arr);  <span class="comment">// [2, 4, 6]</span></span><br></pre></td></tr></table></figure>

<h2 id="rest-参数和-arguments-对象的区别"><a href="#rest-参数和-arguments-对象的区别" class="headerlink" title="rest 参数和 arguments 对象的区别"></a>rest 参数和 arguments 对象的区别</h2><p>剩余参数和 <code>arguments</code>对象之间的区别主要有三个：</p>
<ul>
<li><p>剩余参数只包含那些没有对应形参的实参，而 <code>arguments</code> 对象包含了传给函数的所有实参。</p>
</li>
<li><p><code>arguments</code>对象不是一个真正的数组，而剩余参数是真正的 <code>Array</code>实例，也就是说你能够在它上面直接使用所有的数组方法，比如 <code>sort</code>，<code>map</code>，<code>forEach</code>或<code>pop</code>。</p>
</li>
<li><pre><code>arguments
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">对象还有一些附加的属性 （如</span><br><span class="line"></span><br></pre></td></tr></table></figure>
callee</code></pre>
<p>属性）。</p>
<ul>
<li>arguments.callee 属性包含当前正在执行的函数。</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>ES6</tag>
      </tags>
  </entry>
  <entry>
    <title>函数防抖&amp;函数节流</title>
    <url>/posts/40572/</url>
    <content><![CDATA[<h2 id="什么是节流和防抖"><a href="#什么是节流和防抖" class="headerlink" title="什么是节流和防抖"></a>什么是节流和防抖</h2><ul>
<li>debounce（防抖）的作用是在让在用户动作停止后延迟 x ms 再执行回调。</li>
<li>throttle（节流）的作用是在用户动作期间每隔一定时间（如 200ms）执行一次回调。</li>
</ul>
<a id="more"></a>

<h2 id="如何理解"><a href="#如何理解" class="headerlink" title="如何理解"></a>如何理解</h2><h3 id="防抖"><a href="#防抖" class="headerlink" title="防抖"></a>防抖</h3><p>如果有人进电梯（触发事件），那电梯将在 10 秒钟后出发（执行事件），这时如果又有人进电梯了（在 10 秒内再次触发该事件），我们又得等 10 秒再出发（重新计时）。</p>
<h3 id="节流"><a href="#节流" class="headerlink" title="节流"></a>节流</h3><p>游戏中人物的技能 CD，当技能处于闲置状态时，按下技能键（触发事件）能立马生效（执行事件）。生效后有技能冷却时间，期间不管你按多少下技能键（触发事件），就算把键盘按爆，都无法再次触发技能，直到冷却完毕。</p>
<p>P.S. CD 时间：Cool Down Time</p>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><h3 id="防抖-1"><a href="#防抖-1" class="headerlink" title="防抖"></a>防抖</h3><ol>
<li>表单提交按钮的连续点击，防止重复提交。比如重复发送一篇文章。</li>
<li>搜索查询（连续输入文字后发送 AJAX 请求进行验证，（停止输入后）验证一次就好）</li>
<li>滚动事件 scroll（只需执行触发的最后一次滚动事件的处理程序）</li>
</ol>
<h3 id="节流-1"><a href="#节流-1" class="headerlink" title="节流"></a>节流</h3><ol>
<li>自动保存草稿功能，当用户在输入的时候(一直触发事件),单位时间内只保存一次草稿。</li>
<li>上拉加载更多，防止用户暴力快速上滑。隔一段时间才能触发一次</li>
<li>滚动事件 scroll，（只要页面滚动就会间隔一段时间判断一次）</li>
</ol>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="防抖-2"><a href="#防抖-2" class="headerlink" title="防抖"></a>防抖</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 防抖函数：函数被触发 n 秒后再执行回调，如果在这 n 秒内又被触发，则重新计时</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>fn 要执行的函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>delay  delay毫秒后执行回调</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn, delay = <span class="number">500</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// 为了封装，这里使用了闭包来保存局部变量=&gt;tip:  闭包保护的变量会一直保存在内存中但又不会 “污染” 全局的变量</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      fn.apply(context, <span class="built_in">arguments</span>);</span><br><span class="line">      timer = <span class="literal">null</span>;</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="节流-2"><a href="#节流-2" class="headerlink" title="节流"></a>节流</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 节流函数：规定一个单位时间，在这个单位时间内，只能有一次触发事件的回调函数执行</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>fn 要执行的函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>gapTime  单位时间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn, gapTime = <span class="number">500</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> canUse = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (canUse) &#123;</span><br><span class="line">      fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">      canUse = <span class="literal">false</span>;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> (canUse = <span class="literal">true</span>), gapTime);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><iframe height="842" scrolling="no" title="函数防抖&amp;函数节流" src="https://codepen.io/JingW/embed/yLyJPaP?height=842&amp;theme-id=default&amp;default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><ul>
<li><a href="http://obkoro1.com/web_accumulate/accumulate/JS/%E5%87%BD%E6%95%B0%E9%98%B2%E6%8A%96%E5%92%8C%E5%87%BD%E6%95%B0%E8%8A%82%E6%B5%81.html#%E9%98%B2%E6%8A%96%E5%87%BD%E6%95%B0-debounce">防抖函数&amp;节流函数</a></li>
<li><a href="https://segmentfault.com/a/1190000017208571">JS 函数节流和函数防抖</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>利用padding-bottom特性实现height随width变化保持比例不变</title>
    <url>/posts/2610/</url>
    <content><![CDATA[<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>希望每个网格高度等于宽度，而宽度已被设为 33.333%：</p>
<img src="/posts/2610/grid-padding-bottom.png" class="" title="grid">

<a id="more"></a>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><iframe height="644" scrolling="no" title="padding-bottom 高度自适应" src="https://codepen.io/JingW/embed/qBENXJr?height=644&amp;theme-id=default&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><blockquote>
<p>一个元素的 padding，如果值是一个百分比，那这个百分比是相对于其父元素的宽度而言的，padding-bottom 也是如此。</p>
</blockquote>
<p>使用 <code>padding-bottom</code> 代替 <code>height</code> 来实现高度与宽度成比例的效果，将 <code>padding-bottom</code> 设置为想要实现的 <code>height</code> 的值。同时将其 <code>height</code> 设置为 0 以使元素的「高度」等于 <code>padding-bottom</code> 的值，从而实现需要的效果。</p>
<h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><ul>
<li><a href="http://www.fly63.com/article/detial/1751">css 保持 div 等高宽比</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>布局</tag>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>前端vscode插件配置</title>
    <url>/posts/11039/</url>
    <content><![CDATA[<p>先把下面插件都安装下，最后使用 <code>settings.json</code> 去覆盖你本地自己的文件。</p>
<h3 id="外观配置"><a href="#外观配置" class="headerlink" title="外观配置"></a>外观配置</h3><ul>
<li><strong>主题</strong>：<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=chriseckenrode.vscode-chester-atom">Chester Atom</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=azemoh.one-monokai">One Monokai Theme</a> [目前在使用]</li>
</ul>
</li>
<li><strong>图标</strong>：<a href="https://marketplace.visualstudio.com/items?itemName=emmanuelbeziat.vscode-great-icons">VSCode Great Icons</a></li>
<li><strong>字体</strong>：<a href="https://github.com/tonsky/FiraCode/wiki">Fira Code</a></li>
</ul>
<a id="more"></a>

<h4 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h4><img src="/posts/11039/vscode-theme.png" class="" title="UI-Show">

<h3 id="风格检查、格式化"><a href="#风格检查、格式化" class="headerlink" title="风格检查、格式化"></a>风格检查、格式化</h3><ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint">ESLint</a> JS 代码审查工具</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=shinnn.stylelint">StyleLint</a> CSS 代码审查工具</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=DavidAnson.vscode-markdownlint">MarkdownLint</a> Markdown 代码审查工具</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode">Prettier</a> 代码格式化工具</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=HookyQR.beautify">Beautify</a> 代码格式化工具</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=octref.vetur">Vetur</a> Vue 开发工具</li>
</ul>
<h3 id="编码效率"><a href="#编码效率" class="headerlink" title="编码效率"></a>编码效率</h3><h4 id="代码片段"><a href="#代码片段" class="headerlink" title="代码片段"></a>代码片段</h4><ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=abusaidm.html-snippets">HTML Snippets</a> HTML 代码智能提示</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=xabikos.JavaScriptSnippets">Javascript (ES6) Code Snippets</a> ES6 代码智能提示</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=nikhilkumar80.js-patterns-snippets">Javascript Patterns Snippets</a> JavaScript 代码提示</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=joelday.docthis">Document This</a>，一键给代码中的类、函数加上注释，支持函数声明、函数表达式、箭头函数等；</li>
</ul>
<h4 id="代码补全"><a href="#代码补全" class="headerlink" title="代码补全"></a>代码补全</h4><ul>
<li><a href="https://link.juejin.im/?target=https://marketplace.visualstudio.com/items?itemName=formulahendry.auto-close-tag">Auto Close Tag</a>，在打开标签并且键入 <code>&lt;/</code> 的时候，能自动补全要闭合的标签；</li>
<li><a href="https://link.juejin.im/?target=https://marketplace.visualstudio.com/items?itemName=formulahendry.auto-rename-tag">Auto Rename Tag</a>，在修改标签名时，能在你修改开始（结束）标签的时候修改对应的结束（开始）标签。</li>
<li><a href="https://link.juejin.im/?target=https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense">Path Intellisense</a>，文件路径补全，在你用任何方式引入文件系统中的路径时提供智能提示和自动完成。</li>
<li><a href="https://link.juejin.im/?target=https://marketplace.visualstudio.com/items?itemName=christian-kohler.npm-intellisense">NPM Intellisense</a>，NPM 依赖补全，在你引入任何 node_modules 里面的依赖包时提供智能提示和自动完成。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=Zignd.html-css-class-completion">IntelliSense for CSS class names in HTML</a>，CSS 类名补全，会自动扫描整个项目里面的 CSS 类名并在你输入类名时做智能提示。</li>
<li><a href="https://link.juejin.im/?target=https://emmet.io">Emmet</a>，VSCode 已经内置，官方介绍文档<a href="https://link.juejin.im/?target=https://code.visualstudio.com/docs/editor/emmet">参见</a>。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=steoates.autoimport">Auto Import</a>，自动查找、解析并提供所有可导入（import）的代码文件</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=aaron-bond.better-comments">Better Comments</a> 代码注释高亮</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=wix.vscode-import-cost">Import Cost</a> 显示导入的包的大小</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense">Path Intellisense</a> 智能识别引用文件路径</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=meganrogge.template-string-converter">Template String Converter</a> 字符串中添加变量时，自动转为模板字符串形式</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=sdras.vue-vscode-snippets">Vue VSCode Snippets</a> Vue 代码补全</li>
</ul>
<h4 id="代码运行"><a href="#代码运行" class="headerlink" title="代码运行"></a>代码运行</h4><ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.code-runner">Code Runner</a> 代码一键运行<!-- [![Code Runner](前端vscode插件配置/162c15a64b468fd8.gif)](https://user-gold-cdn.xitu.io/2018/4/14/162c15a64b468fd8?imageslim) -->
<img src="/posts/11039/162c15a64b468fd8.gif" class="" title="Code-Runner">

</li>
</ul>
<h3 id="功能增强"><a href="#功能增强" class="headerlink" title="功能增强"></a>功能增强</h3><ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=Shan.code-settings-sync">Settings Sync</a>，基于 Gist 实现 VSCode 用户配置、快捷键配置、已安装插件列表等的备份和恢复功能，配置过程有详细精确的操作步骤文档。生成的备份 Gist 默认是私密的，如果你想设置为共享的，也可以一键切换。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=streetsidesoftware.code-spell-checker">Code Spell Checker</a> 代码拼写检查</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=donjayamanne.githistory">Git History</a> 查看文件 Git 历史记录</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer">Live Server</a> 开启本地服务器</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=Shan.code-settings-sync">Settings Sync</a> 同步 vscode 配置</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens">GitLens — Git supercharged</a> Git 源代码管理工具</li>
</ul>
<h3 id="外观增强"><a href="#外观增强" class="headerlink" title="外观增强"></a>外观增强</h3><ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=wayou.vscode-todo-highlight">TODO Highlight</a><br>维护时间稍长的代码仓库免不了会有各种 TODO、FIXME、HACK 之类的标记，TODO Highlight 能够帮我们把这些关键词高亮出来，在你翻阅代码时非常醒目，就像是在大声提醒你尽快把他解决掉。支持自定义配置需要高亮的关键词，实际使用比较坑的地方是，TODO、FIXME 之类的后面必须加上冒号，否则无法高亮。<!-- [![TODO Highlight](前端vscode插件配置/1)](https://user-gold-cdn.xitu.io/2018/4/14/162c1592cecf92d8?imageView2/0/w/1280/h/960/format/webp/ignore-error/1) -->
<img src="/posts/11039/1.png" class="" title="TODO-Highlight"></li>
<li><a href="https://link.juejin.im/?target=https://marketplace.visualstudio.com/items?itemName=naumovs.color-highlight">Color Highlight</a>，识别代码中的颜色，包括各种颜色格式。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer-2">Bracket Pair Colorizer Bracket Pair Colorizer 2</a>，识别代码中的各种括号，并且标记上不同的颜色，方便你扫视到匹配的括号。</li>
</ul>
<h4 id="用户设置（User-Settings）"><a href="#用户设置（User-Settings）" class="headerlink" title="用户设置（User Settings）"></a>用户设置（User Settings）</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;editor.fontSize&quot;</span>: <span class="number">14</span>, <span class="comment">// 编辑器字体大小</span></span><br><span class="line">  <span class="attr">&quot;bracket-pair-colorizer-2.showBracketsInGutter&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;workbench.iconTheme&quot;</span>: <span class="string">&quot;vscode-great-icons&quot;</span>, <span class="comment">// 文件icon图标</span></span><br><span class="line">  <span class="attr">&quot;sync.gist&quot;</span>: <span class="string">&quot;e9262ee54aa0988ee98c24e6be1dada1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;workbench.colorTheme&quot;</span>: <span class="string">&quot;One Monokai&quot;</span>, <span class="comment">// 主题</span></span><br><span class="line">  <span class="attr">&quot;editor.fontFamily&quot;</span>: <span class="string">&quot;&#x27;Fira Code&#x27;, Menlo, Monaco, &#x27;Courier New&#x27;, monospace&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;editor.fontLigatures&quot;</span>: <span class="literal">true</span>, <span class="comment">// 这个控制是否启用字体连字，true启用，false不启用，这里选择启用</span></span><br><span class="line">  <span class="comment">// 新增配置</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;editor.formatOnSave&quot;</span>: <span class="literal">true</span>, <span class="comment">// #每次保存的时候自动格式化</span></span><br><span class="line">  <span class="attr">&quot;editor.codeActionsOnSave&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;source.fixAll.eslint&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;, <span class="comment">// 每次保存的时候将代码按eslint格式进行修复</span></span><br><span class="line">  <span class="attr">&quot;editor.tabSize&quot;</span>: <span class="number">2</span>, <span class="comment">// 重新设定tabSize</span></span><br><span class="line">  <span class="attr">&quot;prettier.semi&quot;</span>: <span class="literal">true</span>, <span class="comment">// 添加代码结尾的分号</span></span><br><span class="line">  <span class="attr">&quot;prettier.singleQuote&quot;</span>: <span class="literal">true</span>, <span class="comment">// 使用单引号替代双引号</span></span><br><span class="line">  <span class="attr">&quot;prettier.arrowParens&quot;</span>: <span class="string">&quot;avoid&quot;</span>, <span class="comment">// 箭头函数参数只有一个时是否要有小括号。</span></span><br><span class="line">  <span class="comment">// avoid - 省略括号</span></span><br><span class="line">  <span class="comment">// always - 总是不省略</span></span><br><span class="line">  <span class="attr">&quot;prettier.htmlWhitespaceSensitivity&quot;</span>: <span class="string">&quot;ignore&quot;</span>, <span class="comment">// 指定 HTML 文件的全局空白区域敏感度</span></span><br><span class="line">  <span class="comment">// &quot;css&quot;- 遵守 CSS display属性的默认值。</span></span><br><span class="line">  <span class="comment">// &quot;strict&quot; - 空格被认为是敏感的。</span></span><br><span class="line">  <span class="comment">// &quot;ignore&quot; - 空格被认为是不敏感的。</span></span><br><span class="line">  <span class="comment">// html 中空格也会占位，影响布局，prettier 格式化的时候可能会将文本换行，造成布局错乱</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// --------------- html -----------------</span></span><br><span class="line">  <span class="comment">//  &lt;a href=&quot;https://prettier.io/&quot;&gt;Prettier is an opinionated code formatter.&lt;/a&gt;</span></span><br><span class="line">  <span class="comment">//  &lt;!-- 变成 --&gt;</span></span><br><span class="line">  <span class="comment">//  &lt;!-- &quot;Prettier is an opinionated code formatter. &quot; 另起一行，在页面的布局上就会多一个节点文本出来 --&gt;</span></span><br><span class="line">  <span class="comment">//  &lt;a href=&quot;https://prettier.io/&quot;&gt;</span></span><br><span class="line">  <span class="comment">//    Prettier is an opinionated code formatter.</span></span><br><span class="line">  <span class="comment">//  &lt;/a&gt;</span></span><br><span class="line">  <span class="comment">// --------------- html -----------------</span></span><br><span class="line">  <span class="attr">&quot;prettier.jsxBracketSameLine&quot;</span>: <span class="literal">true</span>, <span class="comment">// 将 &gt; 多行 JSX 元素放在最后一行的末尾，而不是单独放在下一行（不适用于自闭元素）。</span></span><br><span class="line">  <span class="comment">// true - 放最后一行末尾</span></span><br><span class="line">  <span class="comment">// false - 单独放在末尾的下一行</span></span><br><span class="line">  <span class="attr">&quot;prettier.bracketSpacing&quot;</span>: <span class="literal">true</span>, <span class="comment">// 在对象，数组括号与文字之间加空格 &quot;&#123; foo: bar &#125;&quot;</span></span><br><span class="line">  <span class="attr">&quot;prettier.trailingComma&quot;</span>: <span class="string">&quot;none&quot;</span>, <span class="comment">// 在对象或数组最后一个元素后面是否加逗号（在ES5中加尾逗号）</span></span><br><span class="line">  <span class="attr">&quot;javascript.preferences.quoteStyle&quot;</span>: <span class="string">&quot;single&quot;</span>, <span class="comment">// JS格式化设置单引号</span></span><br><span class="line">  <span class="attr">&quot;typescript.preferences.quoteStyle&quot;</span>: <span class="string">&quot;single&quot;</span>, <span class="comment">// TS格式化设置单引号</span></span><br><span class="line">  <span class="attr">&quot;javascript.format.insertSpaceBeforeFunctionParenthesis&quot;</span>: <span class="literal">false</span>, <span class="comment">// 让函数(名)和后面的括号之间加个空格</span></span><br><span class="line">  <span class="comment">// 配置 ESLint 检查的文件类型</span></span><br><span class="line">  <span class="attr">&quot;eslint.validate&quot;</span>: [<span class="string">&quot;javascript&quot;</span>, <span class="string">&quot;vue&quot;</span>, <span class="string">&quot;html&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;eslint.options&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// 指定vscode的eslint所处理的文件的后缀</span></span><br><span class="line">    <span class="attr">&quot;extensions&quot;</span>: [<span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.vue&quot;</span>, <span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.tsx&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//一定要在vutur.defaultFormatterOptions参数中设置，单独修改prettier扩展的设置是无法解决这个问题的，因为perttier默认忽略了vue文件（事实上从忽略列表移除vue也不能解决这个问题）</span></span><br><span class="line">  <span class="attr">&quot;vetur.format.defaultFormatterOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;prettier&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;semi&quot;</span>: <span class="literal">true</span>, <span class="comment">// 格式化末尾加分号</span></span><br><span class="line">      <span class="attr">&quot;singleQuote&quot;</span>: <span class="literal">true</span>, <span class="comment">// 格式化以单引号为主</span></span><br><span class="line">      <span class="attr">&quot;trailingComma&quot;</span>: <span class="string">&quot;none&quot;</span> <span class="comment">// 是否末尾自动添加逗号（数组，json，对象）</span></span><br><span class="line">      <span class="comment">// &quot;es5&quot; - 在ES5中的对象、数组等最后一个元素后面加逗号</span></span><br><span class="line">      <span class="comment">// &quot;none&quot; - 不加逗号</span></span><br><span class="line">      <span class="comment">// &quot;all&quot; - 尽可能都加逗号 (包括函数function的参数).</span></span><br><span class="line">    &#125;, <span class="comment">// 配置文档：https://prettier.io/docs/en/options.html</span></span><br><span class="line">    <span class="attr">&quot;js-beautify-html&quot;</span>: &#123;</span><br><span class="line">      <span class="comment">// force-aligned | force-expand-multiline vue html代码格式化</span></span><br><span class="line">      <span class="attr">&quot;wrap_attributes&quot;</span>: <span class="string">&quot;force-aligned&quot;</span>, <span class="comment">// 对除第一个属性外的其他每个属性进行换行，并保持对齐</span></span><br><span class="line">      <span class="comment">// - auto: 仅在超出行长度时才对属性进行换行。</span></span><br><span class="line">      <span class="comment">// - force: 对除第一个属性外的其他每个属性进行换行。</span></span><br><span class="line">      <span class="comment">// - force-aligned: 对除第一个属性外的其他每个属性进行换行，并保持对齐。</span></span><br><span class="line">      <span class="comment">// - force-expand-multiline: 对每个属性进行换行。</span></span><br><span class="line">      <span class="comment">// - aligned-multiple: 当超出折行长度时，将属性进行垂直对齐。</span></span><br><span class="line">      <span class="attr">&quot;wrap_line_length&quot;</span>: <span class="number">200</span>, <span class="comment">// 换行长度</span></span><br><span class="line">      <span class="attr">&quot;wrap_width_line&quot;</span>: <span class="literal">false</span>, <span class="comment">// 根据行宽换行</span></span><br><span class="line">      <span class="attr">&quot;semi&quot;</span>: <span class="literal">false</span>, <span class="comment">// 格式化不加分号</span></span><br><span class="line">      <span class="attr">&quot;singleQuote&quot;</span>: <span class="literal">true</span> <span class="comment">// 格式化使用单引号</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;prettyhtml&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;printWidth&quot;</span>: <span class="number">200</span>, <span class="comment">// 每行最多多少字符换行</span></span><br><span class="line">      <span class="attr">&quot;singleQuote&quot;</span>: <span class="literal">false</span>, <span class="comment">// 格式化使用单引号</span></span><br><span class="line">      <span class="attr">&quot;wrapAttributes&quot;</span>: <span class="literal">false</span>, <span class="comment">// 强制属性换行</span></span><br><span class="line">      <span class="attr">&quot;sortAttributes&quot;</span>: <span class="literal">true</span> <span class="comment">// 按字母顺序排序属性</span></span><br><span class="line">    &#125; <span class="comment">// 配置文档：https://github.com/Prettyhtml/prettyhtml</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;vetur.format.defaultFormatter.html&quot;</span>: <span class="string">&quot;js-beautify-html&quot;</span>, <span class="comment">// 使用 js-beautify-html 格式化 html</span></span><br><span class="line">  <span class="attr">&quot;vetur.format.defaultFormatter.js&quot;</span>: <span class="string">&quot;prettier&quot;</span>, <span class="comment">// 使用 prettier 格式化 js</span></span><br><span class="line">  <span class="attr">&quot;[vue]&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;editor.defaultFormatter&quot;</span>: <span class="string">&quot;octref.vetur&quot;</span> <span class="comment">// 使用 vetur 格式化 vue</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;path-intellisense.mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;@&quot;</span>: <span class="string">&quot;$&#123;workspaceRoot&#125;/src&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;liveServer.settings.donotShowInfoMsg&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;editor.quickSuggestions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;strings&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125; <span class="comment">// Vue路径提示配置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>工具</category>
        <category>IDE</category>
      </categories>
      <tags>
        <tag>VSCode</tag>
      </tags>
  </entry>
  <entry>
    <title>前端面试系列大纲</title>
    <url>/posts/46036/</url>
    <content><![CDATA[<blockquote>
<p>❗️ 持续更新中…❗️</p>
</blockquote>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>根据网上各大前端面试题文章以及自我总结，沉淀下来的一套面试题合集，包含前端知识点 + 面试题。</p>
<h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><h3 id="1-HTML"><a href="#1-HTML" class="headerlink" title="1 HTML"></a>1 HTML</h3><p>根据以往面试经验，HTML 部分很少有问到。所以这里仅列举一旦考则必问的面试题</p>
<a id="more"></a>

<h4 id="1-1-面试题"><a href="#1-1-面试题" class="headerlink" title="1.1 面试题"></a>1.1 面试题</h4><ul>
<li><a href="https://evestorm.github.io/posts/13781/">HTML 面试题</a></li>
</ul>
<h3 id="2-CSS"><a href="#2-CSS" class="headerlink" title="2 CSS"></a>2 CSS</h3><p>个人经验：这部分面试题一般笔试考知识点多一些（多背），面试考布局更多一些（多实践）。所以 CSS 我拆成了两部分，把布局单独拧出来了。</p>
<h4 id="2-1-知识点-部分面试题"><a href="#2-1-知识点-部分面试题" class="headerlink" title="2.1 知识点 + 部分面试题"></a>2.1 知识点 + 部分面试题</h4><ul>
<li><a href="https://evestorm.github.io/posts/49170/">CSS 知识点</a></li>
</ul>
<h4 id="2-2-布局"><a href="#2-2-布局" class="headerlink" title="2.2 布局"></a>2.2 布局</h4><ul>
<li><a href="https://evestorm.github.io/posts/10415/">CSS 布局面试题</a></li>
</ul>
<h3 id="3-JavaScript"><a href="#3-JavaScript" class="headerlink" title="3 JavaScript"></a>3 JavaScript</h3><p>这部分是面试重中之重，基本上啥都可能考。譬如比较经典的一个有关 axios 的面试题：</p>
<ul>
<li>问：a、b、c 三个请求，希望 c 在 a、b 获取数据后再发请求，要是你你会怎么做？</li>
<li>答：axios.all 先请求 a、b，再在 then 的第一个回调中请求 c ，巴拉巴拉…</li>
<li>问：那 axios.all 内部是通过什么实现的呢？</li>
<li>答：Promise.all，巴拉巴拉…</li>
<li>问：如果不用 Promise 该如何实现？</li>
<li>答：可以用 高阶函数 ，巴拉巴拉…</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 示例（使用node读取文件做场景来说明）</span></span><br><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> arr = [];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  arr.push(data);</span><br><span class="line">  <span class="keyword">if</span> (arr.length === <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="comment">// get ab</span></span><br><span class="line">    <span class="comment">// todo c</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">fs.readFile(<span class="string">&#x27;./a.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  fn(data);</span><br><span class="line">&#125;);</span><br><span class="line">fs.readFile(<span class="string">&#x27;./b.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  fn(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>可以看出，往往 JS 面试题是层层深入的，需要你有坚实的基础，并且在平常开发时不仅满足会使用各种库和框架，还要深入了解原理。所以这一小节内容较多，各位做好抗压准备。</p>
<h4 id="3-1-知识点"><a href="#3-1-知识点" class="headerlink" title="3.1 知识点"></a>3.1 知识点</h4><ul>
<li><a href="https://evestorm.github.io/posts/31920/">JS 知识点</a></li>
</ul>
<h4 id="3-2-面试题"><a href="#3-2-面试题" class="headerlink" title="3.2 面试题"></a>3.2 面试题</h4><ul>
<li><a href="https://evestorm.github.io/posts/41818/">JS 笔试题</a></li>
<li><a href="https://evestorm.github.io/posts/24235/">JS 面试题</a></li>
</ul>
<h3 id="4-浏览器-网络"><a href="#4-浏览器-网络" class="headerlink" title="4 浏览器/网络"></a>4 浏览器/网络</h3><p>浏览器这边主要考察兼容性，当然有时候也考察下 HTTP 缓存等内容，所以我把它们归到了一起方便复习。</p>
<ul>
<li><a href="https://evestorm.github.io/posts/38402/">浏览器</a></li>
</ul>
<h3 id="5-框架-工具"><a href="#5-框架-工具" class="headerlink" title="5 框架 + 工具"></a>5 框架 + 工具</h3><h4 id="5-1-Vue"><a href="#5-1-Vue" class="headerlink" title="5.1 Vue"></a>5.1 Vue</h4><p>Vue 没什么好说的，数据响应式（双向数据绑定）是一定会问到的，其它例如生命周期之类的也常常出现，具体查看下面链接：</p>
<ul>
<li><a href="https://evestorm.github.io/posts/53756/">Vue 面试题</a></li>
</ul>
<h4 id="5-2-Webpack"><a href="#5-2-Webpack" class="headerlink" title="5.2 Webpack"></a>5.2 Webpack</h4><p>个人在面试中很少被问到 webpack 的问题？唯一一次与 webpack 相关的还是在一次面试的笔试题中，有这样一道：</p>
<blockquote>
<p>写出你知道的性能优化方案（不要写 webpack 工具能做到的）</p>
</blockquote>
<p>虽然我自己没碰到过，但保不齐其他公司不爱问，所以还是放在这儿：</p>
<ul>
<li><a href="https://evestorm.github.io/posts/47462/">如何使用 webpack4</a></li>
<li><a href="https://evestorm.github.io/posts/6706/">Webpack 面试题</a></li>
</ul>
<h3 id="6-性能优化"><a href="#6-性能优化" class="headerlink" title="6 性能优化"></a>6 性能优化</h3><p>性能优化现在应该是必考题了，我去几家公司面就有几家会问到，常考的知识点有「首屏优化」「重排重绘优化」以及「css3 动画优化」等。不太了解这部分的童鞋可以看下面链接：</p>
<ul>
<li><a href="https://evestorm.github.io/posts/41624/">网站性能优化</a></li>
<li><a href="https://evestorm.github.io/posts/47143/">web 性能优化-实践</a></li>
</ul>
<h3 id="7-算法"><a href="#7-算法" class="headerlink" title="7 算法"></a>7 算法</h3><p>这部分目前是我薄弱项，暂时不能给到大家更多帮助。不过对于面一般普通前端来说，也就顶多问一下常见的排序算法了。</p>
<p>这是我之前整理的常见排序算法：可以 <a href="https://evestorm.github.io/posts/59937/">点击此处</a> 查看。</p>
<p>其他算法面试题会在后续更新…</p>
<h2 id="简历模板"><a href="#简历模板" class="headerlink" title="简历模板"></a>简历模板</h2><p>网上的简历模板一搜一大堆，不过大都既不实用也不好看。所以最后我再分享几个觉得不错的模板给大家参考：</p>
<h3 id="纸质模板"><a href="#纸质模板" class="headerlink" title="纸质模板"></a>纸质模板</h3><ul>
<li><a href="https://www.resumeviking.com/wp-content/uploads/2018/01/Dwight-Kavanagh-Resume-IT-QA-Analyst-11.pdf">https://www.resumeviking.com/wp-content/uploads/2018/01/Dwight-Kavanagh-Resume-IT-QA-Analyst-11.pdf</a><img src="/posts/46036/resume0.png" class="" title="resume0"></li>
<li><a href="https://www.resumeviking.com/wp-content/uploads/2019/04/Emily_Carter_-_Resume_-_English_Teacher-9.pdf">https://www.resumeviking.com/wp-content/uploads/2019/04/Emily_Carter_-_Resume_-_English_Teacher-9.pdf</a><img src="/posts/46036/resume1.png" class="" title="resume1"></li>
<li><a href="https://www.resumeviking.com/wp-content/uploads/2018/09/Karen_Philips_-_Resume_-_Web_Designer-4.pdf">https://www.resumeviking.com/wp-content/uploads/2018/09/Karen_Philips_-_Resume_-_Web_Designer-4.pdf</a><img src="/posts/46036/resume2.png" class="" title="resume2">

</li>
</ul>
<p>上面两份模板都来自 <a href="https://www.resumeviking.com/templates/">此网站</a> ，想寻找更满意的版本可以进去逛逛。</p>
<h3 id="在线模板"><a href="#在线模板" class="headerlink" title="在线模板"></a>在线模板</h3><ul>
<li><a href="http://zhangwenli.com/cv/">http://zhangwenli.com/cv/</a><ul>
<li>下载地址：<a href="https://github.com/Ovilia/cv">https://github.com/Ovilia/cv</a></li>
</ul>
</li>
<li><a href="https://html5up.net/read-only">https://html5up.net/read-only</a><ul>
<li>下载地址：上方链接右上角 Download</li>
</ul>
</li>
</ul>
<h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2><p>本项目整合了大量下方资源的面试题内容，但毕竟是按照我自己技术栈整合的，所以如果你还想查缺补漏（例如 react 相关面试题等），可以点击下方链接了解更多：</p>
<ul>
<li><a href="https://github.com/markyun/My-blog/tree/master/Front-end-Developer-Questions/Questions-and-Answers">前端开发面试题</a></li>
<li><a href="https://juejin.im/post/5aae076d6fb9a028cc6100a9">前端面试考点多？看这些文章就够了</a></li>
<li><a href="https://github.com/KieSun/Front-end-knowledge">KieSun/Front-end-knowledge</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>去除图片上下左右间隙</title>
    <url>/posts/31251/</url>
    <content><![CDATA[<h2 id="情景"><a href="#情景" class="headerlink" title="情景"></a>情景</h2><p>当在定宽父容器下有多张图片顺序排列时，图片的上下左右之间都有间隙：</p>
<iframe height="265" scrolling="no" title="KEBmRP" src="https://codepen.io/JingW/embed/KEBmRP/?height=265&amp;theme-id=0&amp;default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<a id="more"></a>

<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><ul>
<li>左右：因为 img 是 inline-block 元素，元素代码之间有『换行（回车），空格，tab』时会产生左右间隙。</li>
<li>上下：行内元素默认与父容器基线对齐，而基线与父容器底部有一定间隙，所以上下图片间有间隙。</li>
</ul>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ul>
<li>移除上下间隙：<ul>
<li>img本身设置 <code>display: block;</code></li>
<li>父元素设置 <code>font-size: 0;</code> （基线与字体大小有关，字体为零，基线间就没距离了）</li>
<li>img本身设置 <code>vertical-align: bottom;</code>（让inline-block 的 img 与每行的底部对齐）</li>
</ul>
</li>
<li>移除左右间距：<ul>
<li>行内元素间不要有换行，连成一行写消除间隙（阅读性差，不推荐）</li>
<li>第一行img结尾写上 <code>&lt;!--</code> ，第二行img开头跟上 <code>--&gt;</code> 。即利用注释消除间距</li>
<li>父元素 <code>font-size: 0</code></li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>布局</tag>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>向强大的svg迈进</title>
    <url>/posts/18004/</url>
    <content><![CDATA[<p>文章链接：<a href="https://aotu.io/notes/2020/06/09/strong-svg/">https://aotu.io/notes/2020/06/09/strong-svg/</a></p>
]]></content>
  </entry>
  <entry>
    <title>在VueCli3项目中使用Bootstrap</title>
    <url>/posts/53837/</url>
    <content><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i bootstrap jquery popper.js --save</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>在项目根目录下新建或修改<code>vue.config.js</code></p>
<a id="more"></a>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">        $: <span class="string">&#x27;jquery&#x27;</span>,</span><br><span class="line">        jQuery: <span class="string">&#x27;jquery&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;window.jQuery&#x27;</span>: <span class="string">&#x27;jquery&#x27;</span>,</span><br><span class="line">        Popper: [<span class="string">&#x27;popper.js&#x27;</span>, <span class="string">&#x27;default&#x27;</span>]</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><p>在<code>main.js</code>中引入</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;bootstrap&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;bootstrap/dist/css/bootstrap.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;jquery&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>在组件模板中，可以像常规开发那样使用 bootstrap</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mt-0 mt-md-2&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-12 col-lg-9 px-0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;Right d-none d-lg-block col-lg-3  pl-2 p-0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>Bootstrap</tag>
      </tags>
  </entry>
  <entry>
    <title>在vue-cli3项目中解决动态引入图片img404的问题</title>
    <url>/posts/39457/</url>
    <content><![CDATA[<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>最新需要在项目中动态显示侧边栏菜单的图标。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>按照一般的开发模式，静态图片路径是相对路径还是绝对路径都可以，因为图片路径是静态的是死的，所以 webpack 去找这个图片路径的时候是能找到的。</p>
<p>但是我的这个路径是动态的，我在 <code>computed</code> 给出一个拼接了变量的路径，项目启动在浏览器下死活出不了这个图片，死活都是 404。</p>
<a id="more"></a>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  <span class="function"><span class="title">fullURL</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`../assets/icc-icon/<span class="subst">$&#123;<span class="built_in">this</span>.customIcon&#125;</span>.png`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述这样的路径是不行的，一直是 404，原因也讲了点，vue-cli3 中内置的 webpack 会把图片当做一个模块引用，然后打包等等，路径就不对了，我们的静态资源是不需要打包等等的，。</p>
<p>静态资源是直接被 webpack copy 到对应的静态资源文件夹下，所以根本原因就在于，用了动态路径的图片，webpack 将它认作为一个模块打包了，路径错乱，所以 404。</p>
<p>找到了原因就很简单了，解决这个动态路径图片 404 的方案其实 vue-cli3 官网就有写过：<a href="https://cli.vuejs.org/zh/guide/html-and-static-assets.html#%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90">vue-cli3 的官方解决方案</a></p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><blockquote>
<p>Sidebar.vue</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      customIcon: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      baseUrl: process.env.BASE_URL <span class="comment">// 项目根目录路径前缀</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>把你所用的动态图片 img 放到 public 目录下:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── favicon.ico</span><br><span class="line">├── index.html</span><br><span class="line">└── sidebar-icon</span><br><span class="line">    ├── hc-control.png</span><br><span class="line">    ├── hc-list.png</span><br><span class="line">    ├── home.png</span><br><span class="line">    ├── material.png</span><br><span class="line">    ├── package.png</span><br><span class="line">    ├── repo.png</span><br><span class="line">    ├── secure.png</span><br><span class="line">    ├── sys-arg.png</span><br><span class="line">    └── sys-manage.png</span><br></pre></td></tr></table></figure>

<p>修改你的动态路径图片地址:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  <span class="function"><span class="title">fullURL</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.baseUrl&#125;</span>sidebar-icon/<span class="subst">$&#123;<span class="built_in">this</span>.customIcon&#125;</span>.png`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;img :src=<span class="string">&quot;fullURL&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>垂直居中方案汇总</title>
    <url>/posts/12733/</url>
    <content><![CDATA[<p>这里汇总了常见的元素居中方案。</p>
<h2 id="水平居中"><a href="#水平居中" class="headerlink" title="水平居中"></a>水平居中</h2><h3 id="行内元素水平居中"><a href="#行内元素水平居中" class="headerlink" title="行内元素水平居中"></a>行内元素水平居中</h3><p>核心：给父元素添加 <code>text-align: center</code></p>
<iframe height="265" scrolling="no" title="行内元素水平居中" src="https://codepen.io/JingW/embed/mvaNXw/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<a id="more"></a>

<h3 id="块级元素水平居中"><a href="#块级元素水平居中" class="headerlink" title="块级元素水平居中"></a>块级元素水平居中</h3><p>核心：子元素自身 <code>margin: 0 auto;</code></p>
<iframe height="291" scrolling="no" title="块元素水平居中" src="https://codepen.io/JingW/embed/moxbxb/?height=291&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="多个div水平居中"><a href="#多个div水平居中" class="headerlink" title="多个div水平居中"></a>多个div水平居中</h3><h4 id="传统方案"><a href="#传统方案" class="headerlink" title="传统方案"></a>传统方案</h4><p>核心：父元素设置 <code>text-align: center</code> ，子元素设置 <code>inline-block</code></p>
<iframe height="265" scrolling="no" title="多个div水平居中 - 传统方案" src="https://codepen.io/JingW/embed/KEoPGq/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h4 id="Flex方案"><a href="#Flex方案" class="headerlink" title="Flex方案"></a>Flex方案</h4><p>核心：父元素 <code>display: flex</code> + <code>justify-content: center</code> + <code>align-items: center</code></p>
<iframe height="265" scrolling="no" title="多个div水平居中-flex" src="https://codepen.io/JingW/embed/XGEroY/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h2 id="水平垂直居中"><a href="#水平垂直居中" class="headerlink" title="水平垂直居中"></a>水平垂直居中</h2><h3 id="table自带水平垂直居中"><a href="#table自带水平垂直居中" class="headerlink" title="table自带水平垂直居中"></a>table自带水平垂直居中</h3><p>核心：使用 <code>table&gt;tr&gt;td</code> 布局</p>
<iframe height="460" scrolling="no" title="div水平垂直居中 - table" src="https://codepen.io/JingW/embed/xBWxwe/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="模拟table"><a href="#模拟table" class="headerlink" title="模拟table"></a>模拟table</h3><p>核心：父元素 <code>display: table</code> ，子元素 <code>display: table-cell</code> + <code>vertical-align: middle</code></p>
<iframe height="460" scrolling="no" title="div水平垂直居中 - 模拟table" src="https://codepen.io/JingW/embed/aMYbZx/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="子绝父相-子元素-margin-auto"><a href="#子绝父相-子元素-margin-auto" class="headerlink" title="子绝父相 + 子元素 margin:auto"></a>子绝父相 + 子元素 margin:auto</h3><p>核心：子元素相对于父元素绝对定位，<code>top</code>、<code>right</code>、<code>bottom</code>、<code>left</code> 都设为0，margi设为auto</p>
<iframe height="460" scrolling="no" title="div水平垂直居中 - 子绝父相 + Margin Auto" src="https://codepen.io/JingW/embed/PLRYrz/?height=460&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="子绝父相-负margin"><a href="#子绝父相-负margin" class="headerlink" title="子绝父相 + 负margin"></a>子绝父相 + 负margin</h3><p>核心：子元素相对于父元素绝对定位，<code>top</code>、<code>left</code>设为50%，margin相对自身宽/高一半</p>
<iframe height="460" scrolling="no" title="div水平垂直居中 - 子绝父相 + 负Margin" src="https://codepen.io/JingW/embed/oVqNvK/?height=460&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="子绝父相-translate"><a href="#子绝父相-translate" class="headerlink" title="子绝父相 + translate"></a>子绝父相 + translate</h3><p>核心：子元素相对于父元素绝对定位，<code>top</code>、<code>left</code>设为50%，此时子元素左上角在父元素中心，然后让子元素向左上角位移自身宽度的一半</p>
<iframe height="460" scrolling="no" title="div水平垂直居中 - 子绝父相 + translate" src="https://codepen.io/JingW/embed/EMExjr/?height=456&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<h3 id="Flex布局"><a href="#Flex布局" class="headerlink" title="Flex布局"></a>Flex布局</h3><p>父元素 <code>display: flex</code>，<code>justify-content</code> 和 <code>align-items</code> 都设为 center 实现垂直居中</p>
<iframe height="460" scrolling="no" title="div水平垂直居中 - flex" src="https://codepen.io/JingW/embed/rRdNyo/?height=265&amp;theme-id=0&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>布局</tag>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>【转载】大屏上的全屏页面的自适应适配方案</title>
    <url>/posts/61674/</url>
    <content><![CDATA[<p>转载自：<a href="https://www.njleonzhang.com/2018/08/15/flexible-pc-full-screen.html">https://www.njleonzhang.com/2018/08/15/flexible-pc-full-screen.html</a></p>
<p>通常来说PC端的页面并不像移动端页面那样对屏幕大小和分别率有那么强的依赖。一般的页面都是取屏幕中间的一块宽度(1280px), 两边留白, 高度随着内容的长度滚动。这样无论窗口怎么变化，页面都是可用的。比如，我们的这个页面. 然而也有少数的页面，天生就是要在 pc 端全屏显示的，其中最为典型的代表就是全屏的 dashboard 页面。比如：</p>
<p>当然，如果 dashboard 页面是内嵌在一些管理页面里的，通常是允许滚动的。</p>
<img src="/posts/61674/ba7c9abd-2f10-3890-cfed-f8c389248b53.png" class="" title="admin_dashboard">

<p>但是，如果 dashboard 是用于官方宣传，比如在电视机或者广告屏上的展示的时候，通常是不允许滚动条出现的。比如:</p>
<img src="/posts/61674/0349a840-ed31-06be-207c-e748883522b7.png" class="" title="天猫">

<a id="more"></a>

<blockquote>
<p>这种 dashboard 有个帅气的名字叫数据可视化。</p>
</blockquote>
<h2 id="通常的做法"><a href="#通常的做法" class="headerlink" title="通常的做法"></a>通常的做法</h2><p>为了实现全屏的这种 dashboard, 通常的做法就是要对宽度和高度都做百分比（网格）来实现了。但是这种方案的缺点在于:</p>
<ul>
<li>实现太麻烦。设计师给的设计稿通常是 px 为单位标注的，我们需要仔细的计算宽度和高度的比例，然后小心处理页面的布局。</li>
<li>难以处理屏幕宽高比与设计图不符时，带来的元素变形。所以最后展示的屏幕不能和设计稿的屏幕的宽高比差距太大。</li>
</ul>
<p>比如，下面这个简单的页面就是用百分比方案来做的。设计师给的图的比例为 16: 9。</p>
<img src="/posts/61674/16-9.png" class="" title="16:9">

<img src="/posts/61674/1-1.png" class="" title="1:1">

<p>当窗口比例是 16 : 9 的时候黄色的长方形显示符合设计，当窗口变成正方形的时候，黄色部分也跟着变方了，这必然会影响显示效果。</p>
<p>可以在浏览器中打开，改变窗口大小页面来体验这个<a href="https://quellingblade.github.io/postcss-px-to-rem/percent.html">百分比方案</a>。</p>
<h2 id="理想的效果"><a href="#理想的效果" class="headerlink" title="理想的效果"></a>理想的效果</h2><p>我心目中的理想效果可能是像下面这个页面一样，无论窗口怎么变，我们的内容都保持原来的比例，并尽量占满窗口（类似 background contain 的效果）。</p>
<ul>
<li>屏幕尺寸和设计稿比例(16:9)一致时，占满屏幕</li>
</ul>
<img src="/posts/61674/full-screen.png" class="" title="full-screen">

<ul>
<li>屏幕尺寸比设计图比例瘦时，上下留白，左右占满，并上下居中, 显示的比例保持16：9</li>
</ul>
<img src="/posts/61674/square.png" class="" title="square">

<ul>
<li>屏幕尺寸比设计图比例胖时，左右留白，上下占满，并左右居中, 显示的比例保持16：9</li>
</ul>
<img src="/posts/61674/600-300.png" class="" title="600:300">

<p>可以在浏览器中打开，改变窗口大小页面来体验这个<a href="https://quellingblade.github.io/postcss-px-to-rem/percent.html">flexible方案</a></p>
<h2 id="rem-方案"><a href="#rem-方案" class="headerlink" title="rem 方案"></a>rem 方案</h2><p>熟悉移动端的自适应方案的朋友对 rem 适应方案，肯定不陌生，最出名的就是阿里的 <a href="https://github.com/amfe/lib-flexible">lib-flexible</a> 方案。可能你已经猜到，本文的这个方案肯定也是基于 rem 的。</p>
<p>rem (font size of the root element), 是 css3 的引入的一个大小单位。即相对于根元素的 font-size 值的大小。所谓根元素在网页里一般就是 html. 举例说明：下例中，<code>html 的 font-size 大小</code>是 20px, 那么 1.4rem 和 2.4 rem 就分别代表着 28px 和 48px 了。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123; <span class="attribute">font-size</span>: <span class="number">20px</span>; &#125;</span><br><span class="line"><span class="selector-tag">test1</span> &#123;</span><br><span class="line">  width: 1.4rem; //1.4 × 20px = 28px</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">test2</span> &#123;</span><br><span class="line">  height: 2.4rem; //2.4 × 20px = 48px</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假设我们的设计稿其尺寸为 1920 * 1280 px，并且实际运行这个网页的屏幕分别率也是 1920 * 1280. 那么，这网页就好做了。简单粗暴地，按图中的元素的尺寸和位置，直接利用绝对定位把所有元素撸出来就行了。比如，设计稿中有这样一个元素:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.doughnut</span> &#123;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这不刚介绍了 rem, 我们试着用 rem 为单位来写一下 <code>doughnut</code> 元素的 css。我们把页面的 html 元素的 font-size 设置为 1920 / 10 = 192 px. 那么 <code>doughnut</code> 这个元素就应该写作：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.doughnut</span> &#123;</span><br><span class="line">  top:  .781rem;     // 150 / 192 = 0.781</span><br><span class="line">  left: .156rem;     // 30  / 192 = 0.156</span><br><span class="line">  width: 2.083rem;   // 400 / 192 = 2.083</span><br><span class="line">  height: 1.563rem;  // 300 / 192 = 1.564</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>恩。。。。这不是有病么？算成 rem，然后设置一下 html 的 font-size 让浏览器再算回去？显摆自己的数学好么？23333。</p>
<p>注意上上面有一个假设，<strong>屏幕大小正好是 1920 * 1280</strong>。这个假设真的很假，根本不可能，一旦用了 px，那么一切长宽都死了。这时你再看一眼 rem，真实的长度为：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">实际长度(px) = rootFontSize (html 的 font-size) * rem 长度</span><br></pre></td></tr></table></figure>

<p>那么这个实际长度必然有一下特点：</p>
<ul>
<li>所有长度的比例必然和设计图一致。</li>
<li>实际的显示长度完全由 <code>html 的 font-size</code> 值决定（线性关系）。</li>
</ul>
<p>我们来证明一下：</p>
<blockquote>
<p>设：设计稿上有任一1条线: A, A 的长度为 xx, <code>计算 rem 值的基准</code>为 zz<br>那么 css 里，A 的长度表示为 xzxz (rem)</p>
<p>设网页运行时的 html 的 font-size 值为 fsfs，</p>
<p>那么 A 的实际显示长度就分为 xfszxfsz (px)</p>
<p>所以：</p>
<ol>
<li>对于任意2条线，其实际长度的比例为 x1fszx1fsz ： x2fszx2fsz 就等于 他们在设计图上的比例 x1x1 : x2x2</li>
<li>对于任意一条线，xx 和 zz 是固定值，其实际值随着 fsfs 值线性关系变化的</li>
</ol>
</blockquote>
<p>我们取设计图的边框的4条线来分析, 那么<code>设计稿</code>，<code>真实显示（画布）</code>和 <code>显示窗口（全屏时，即为屏幕）</code>的关系如下图所示:</p>
<img src="/posts/61674/70ef9642-13d0-a15c-ff25-23feaef1029b.png" class="" title="70ef9642-13d0-a15c-ff25-23feaef1029b">

<ul>
<li>设计稿的宽高分别为 axax 和 ayay, 比例为 xx : yy.</li>
<li>实际显示的范围（我们称其为画布）比例和设计稿保持一致，所以可以设实际显示的画布的宽高为bx:bybx:by, 且所有线的实际显示长度是由 <code>html 的 font-size 值</code> fsfs 线性决定的。</li>
<li>屏幕的尺寸不确定，假设其宽度为 ww, 高度为 hh</li>
</ul>
<blockquote>
<p>小结一下，用了上面提到的 rem 来方案后，我们做出来的页面是一个<strong>和设计稿比例一致的</strong>，并且<strong>大小根据网页运行时的 html 的 font-size的值缩放</strong>的页面。</p>
</blockquote>
<p>既然页面的大小可以按<strong>html 的 font-size的值</strong>缩放，那么如果我希望<strong>画布的实际显示宽度</strong>始终和<strong>浏览器窗口宽度</strong>保持一致的话（即下图这样的状态），<strong>html 的 font-size的值</strong>应该如何设置呢？</p>
<img src="/posts/61674/19e45d16-534a-9ac3-578c-83bb3f01b45f.png" class="" title="19e45d16-534a-9ac3-578c-83bb3f01b45f">

<p>我们假设 <code>计算 rem 值的基准</code> 为设计稿宽度的 1q1q:</p>
<blockquote>
<p>假设，设计稿窗口宽为 axax，高为 ayay, 则<code>计算 rem 值的基准</code> zz 为 axqaxq</p>
<p>那么按上面的公式，浏览器中画布实际的<br>宽度为 axfsaxq=fsqaxfsaxq=fsq，<br>高度为 ayfsaxq=qyfsxayfsaxq=qyfsx</p>
<p>浏览器窗口的宽度 ww 要等于画布实际的宽度，即 w=fsqw=fsq，则 fs=wqfs=wq</p>
</blockquote>
<p>好的，从数学回到我们的工程中来，我们的设计稿尺寸是 1920 * 1280。我们取 qq 这个值为 10, 则 <code>计算 rem 值的基准</code> zz 为 axq=192010=192axq=192010=192. 然后我们把<strong>所有元素的长、宽、位置、字体大小等原来 <code>px</code> 单位都转换成 rem</strong>，网页加载后，我们<strong>用 js 去计算当前浏览器窗口的宽度，并设置 <code>html 的 font-size</code> fsfs 为<code>当前浏览器窗口的宽度</code> ww 的 1q1q，即 w10w10，这样我们就做出了一个100%宽度的、等比例缩放设计稿的页面</strong>了。</p>
<blockquote>
<p>通过这样的设置，我就得到了一个<strong>和设计稿比例一致的</strong>，<strong>宽度与窗口大小一致</strong>的页面。</p>
</blockquote>
<p>到此为止，就是现有 rem 方案的核心内容了。</p>
<p>说了半天，都是别人的方案，读者可能会问了，那博主你干了啥？</p>
<h2 id="我的方案"><a href="#我的方案" class="headerlink" title="我的方案"></a>我的方案</h2><p>回头想一下，我们要的是什么？现在这个方案，能满足我们的要求么？我们来逐条分析：</p>
<ul>
<li>屏幕（窗口）尺寸和设计稿比例(x:yx:y)一致时，占满屏幕</li>
</ul>
<img src="/posts/61674/327c8e32-cb68-0615-fa7f-b0bbec3dc4f1.png" class="" title="327c8e32-cb68-0615-fa7f-b0bbec3dc4f1">

<p>这种情况肯定没问题，屏幕和真实页面完美重合.</p>
<ul>
<li>屏幕（窗口）尺寸比设计图比例瘦时，上下留白，左右占满，并上下居中, 显示的比例保持(x:yx:y)</li>
</ul>
<img src="/posts/61674/19e45d16-534a-9ac3-578c-83bb3f01b45f(1).png" class="" title="19e45d16-534a-9ac3-578c-83bb3f01b45f(1)">

<p>这种情况也没问题，真实页面高度小于屏幕，然后页面内容上下居中就可以了。</p>
<ul>
<li>屏幕（窗口）尺寸比设计图比例胖时，左右留白，上下占满，并左右居中, 显示的比例保持(x:yx:y)</li>
</ul>
<img src="/posts/61674/c2b3b4d8-759c-14ce-2ffe-6ab2f59b15b4.png" class="" title="c2b3b4d8-759c-14ce-2ffe-6ab2f59b15b4">

<p>问题出现了，在这种场景下，页面的高度超出了屏幕的高度，这就会导致垂直滚动条了。这就是我的方案处理的地方了。在这种场景下，我们需要页面的高度缩小为屏幕的高度，当然为了保持比例页面的宽度等也要等比例缩小.换句话说我们要把所有的线的长度等比例缩小，缩小后画布的高度要等于屏幕的高度，即下图所示的状态:</p>
<img src="/posts/61674/d312b3ec-ded3-746f-9e59-7daa68811f30.png" class="" title="d312b3ec-ded3-746f-9e59-7daa68811f30">

<p>要等比例缩小所有的长度，那么操作 <code>html 的 font-size</code> fsfs 的值就能做到了。我们上面的分析中，我们已经计算了页面（画布）的真实高度</p>
<blockquote>
<p>那么按上面的公式，浏览器中页面（画布）的真实<br>高度为 ayfsaxq=qyfsx</p>
</blockquote>
<p>在此场景下，我们需要把画布真实高度值缩小到屏幕的高度,</p>
<blockquote>
<p>设窗口的高度为 hh,<br>设缩小比例为 ss, 则有 h=qyfsxsh=qyfsxs, 得 s=xhqyfss=xhqyfs<br>即我们需要在页面（画布）真实高度上 qyfsxqyfsx 乘上个缩小系数 xhqyfsxhqyfs，可以使 页面（画布）的真是高等于窗口的高度了<br>又因为 fs=wqfs=wq, 则这个缩小系数可变换为:<br>xhqywq=xhyw=xy/whxhqywq=xhyw=xy/wh, 即 设计稿宽高比窗口宽高比</p>
</blockquote>
<p>Bingo. 综上可知: 当窗口尺寸比设计图比例胖时，只要我们在原来 fsfs 值的基础上，乘上 设计稿宽高比窗口宽高比设计稿宽高比窗口宽高比 的缩小系数，就可以实现我们想要的效果了。</p>
<h2 id="工程应用"><a href="#工程应用" class="headerlink" title="工程应用"></a>工程应用</h2><p>好了，前面的理论，你看着头疼，我写着更头疼。终于到了喜闻乐见的运用环节了。</p>
<p>按照前面的一顿操作，应用这个方案，我们需要做2件事: （以设计稿的尺寸为 1920 * 1280 为例）</p>
<ol>
<li>在 css 表示长度的时候，用设计稿上的长度除以 192, 算得 rem 的值。</li>
<li>页面内写一段 js 代码，根据我们上面的公式去计算并设置 <code>html 元素的 font-size</code> 值。</li>
</ol>
<p>关于第1点：如果告诉你所有的长度你要自己算。。。可能这个方案马上就没人用了，因为真的要算死人。参照 <a href="https://github.com/amfe/lib-flexible">lib-flexible</a> 的方案，我写了一个 <a href="https://github.com/QuellingBlade/postcss-px-to-rem">post-css 插件</a>来帮助你做这个计算，效果就是你不用算了，图上是多少长度，你写多少就行了，这个 rem 的转换由<a href="https://github.com/QuellingBlade/postcss-px-to-rem">插件</a>完成。</p>
<p>关于第2点：这段 js 代码我已经为你写好了 <a href="https://github.com/QuellingBlade/lib-flexible-for-dashboard">lib-flexible-for-dashboard</a>, 直接嵌入你的 html 里就行。考虑到这段 js 代码，会计算 font-size 的值，这个值会决定所有的长度，所以这个值要优先计算出来，最好的方案就是把这段代码拷贝到 html 的 head 里去（这个操作被称为 inline）. 为了方便你使用webpack 和 npm 管理这个库，我们还为你准备了一个 <a href="https://github.com/QuellingBlade/html-webpack-inline-plugin">webpack 插件</a>，帮助你去做 inline.</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><blockquote>
<p>talk is cheap, show me the <a href="https://github.com/njleonzhang/flexible-pc-full-screen">code</a></p>
</blockquote>
<p>设计稿是这样的一个 1920 * 1280（16：9）的图:</p>
<img src="/posts/61674/562e47bd-abda-dae4-7765-68706b5a978e.png" class="" title="562e47bd-abda-dae4-7765-68706b5a978e">

<p>实现的[效果]在这：<a href="http://www.njleonzhang.com/flexible-pc-full-screen/">http://www.njleonzhang.com/flexible-pc-full-screen/</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我是站在巨人的肩膀上，针对全屏 pc 页面这一特别场景做出了一个个人比较满意的方案，希望能给有需要的朋友一些帮助。</p>
<p>相关项目：</p>
<ul>
<li><a href="https://github.com/njleonzhang/flexible-pc-full-screen">https://github.com/njleonzhang/flexible-pc-full-screen</a></li>
<li><a href="https://github.com/QuellingBlade/postcss-px-to-rem">https://github.com/QuellingBlade/postcss-px-to-rem</a></li>
<li><a href="https://github.com/QuellingBlade/lib-flexible-for-dashboard">https://github.com/QuellingBlade/lib-flexible-for-dashboard</a></li>
<li><a href="https://github.com/QuellingBlade/html-webpack-inline-plugin">https://github.com/QuellingBlade/html-webpack-inline-plugin</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>大屏</tag>
      </tags>
  </entry>
  <entry>
    <title>奇妙的-webkit-background-clip</title>
    <url>/posts/12897/</url>
    <content><![CDATA[<p>github 链接：<a href="https://github.com/chokcoco/iCSS/issues/14">https://github.com/chokcoco/iCSS/issues/14</a></p>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><iframe height="1449" scrolling="no" title="existential gradient buttons" src="https://codepen.io/JingW/embed/gObGjww?height=1449&amp;theme-id=default&amp;default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>

<p>原特效链接：<a href="https://codepen.io/cubeghost/pen/ByJGEN">A PEN BY alex baldwin</a></p>
<h2 id="相关资源"><a href="#相关资源" class="headerlink" title="相关资源"></a>相关资源</h2><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-clip">MDN - background-clip</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/border-image-slice">MDN - border-image-slice</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>CSS3</tag>
      </tags>
  </entry>
  <entry>
    <title>【转载】如何在Mac上配置一个本地Web服务器</title>
    <url>/posts/28116/</url>
    <content><![CDATA[<p>来源：<a href="https://shannonchenchn.github.io/2018/10/22/How-do-you-set-up-a-local-web-server-on-Mac/">https://shannonchenchn.github.io/2018/10/22/How-do-you-set-up-a-local-web-server-on-Mac/</a></p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li>我们为什么需要服务器？<ul>
<li><ol>
<li>本地文件 VS. 远程文件</li>
</ol>
</li>
<li><ol>
<li>直接访问本地文件时存在的问题</li>
</ol>
</li>
</ul>
</li>
<li>方法一、启动 Mac 自带的 Apache 服务器</li>
<li>方法二：使用 Python 的 SimpleHTTPServer 模块启动服务器</li>
</ul>
<a id="more"></a>

<h3 id="我们为什么需要服务器？"><a href="#我们为什么需要服务器？" class="headerlink" title="我们为什么需要服务器？"></a>我们为什么需要服务器？</h3><h4 id="1-本地文件-VS-远程文件"><a href="#1-本地文件-VS-远程文件" class="headerlink" title="1. 本地文件 VS. 远程文件"></a>1. 本地文件 VS. 远程文件</h4><p>通常情况下，你可以通过在浏览器中直接打开或者通过一个 URL 来访问一个文件。</p>
<p>使用浏览器访问本地文件时，一般地址是 <code>file://</code> 开头的本地文件地址。<br>而访问远程文件时，一般地址是 <code>http://</code> 或者 <code>https://</code> 开头的地址，表示这个文件通过 http 协议访问的。</p>
<h4 id="2-直接访问本地文件时存在的问题"><a href="#2-直接访问本地文件时存在的问题" class="headerlink" title="2. 直接访问本地文件时存在的问题"></a>2. 直接访问本地文件时存在的问题</h4><p>在有些情况下，你打开一个本地的 html 文件时，会出现运行错误。</p>
<p>导致这些错误的原因主要有以下两个：<br>（1） 其中包含了异步请求。 如果你直接打开本地文件运行，一些浏览器（包括 Chrome）将不会运行其中的异步请求（请参阅 从服务器获取数据）。 这是因为安全限制而导致的（更多关于 Web 安全的信息，请参阅<a href="https://developer.mozilla.org/en-US/docs/Learn/Server-side/First_steps/Website_security">Website security</a>）。</p>
<p>比如，你直接在浏览器中打开含有如下内容的文件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      request.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(request);</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 发送请求:</span></span></span><br><span class="line"><span class="javascript">      request.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;./data.json&#x27;</span>);</span></span><br><span class="line">      request.send();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>HTML 测试页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>测试页面<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后，你会在 console 中看到这样的错误：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">index.html:12 Failed to load file:///Users/ShannonChen/Desktop/Playground/nodejs_example/data.json: Cross origin requests are only supported for protocol schemes: http, data, chrome, chrome-extension, https.</span><br></pre></td></tr></table></figure>

<p>（2） 执行文件中的代码时需要通过执行一些附加逻辑（如 PHP 或 Python）才能获得结果，而不仅仅是直接访问一个文件。</p>
<p>比如，我登录了京东网站后，查看购物车页面时，需要服务器返回的是包含我的购物车数据的页面，这个时候，就需要服务端在接收到请求后，跟我的用户信息（一般是 cookie）来返回匹配的数据。</p>
<h3 id="方法一、启动-Mac-自带的-Apache-服务器"><a href="#方法一、启动-Mac-自带的-Apache-服务器" class="headerlink" title="方法一、启动 Mac 自带的 Apache 服务器"></a>方法一、启动 Mac 自带的 Apache 服务器</h3><ol>
<li>运行 Apache <code>$ sudo apachectl start</code></li>
<li>退出 Apache <code>$ sudo apachectl stop</code></li>
<li>把工程文件夹放到以下位置中 <code>/Library/WebServer/Documents</code></li>
<li>在浏览器中访问：在地址栏中输入地址 <code>http://localhost/工程文件夹名称/</code>，回车。</li>
</ol>
<p><strong>注意：</strong> 不再需要使用后一定要记得退出，否则会消耗电脑性能。</p>
<p>Q：如何修改 Apache 的默认端口？<br>A：首先，找到 Apache 的配置文件，位于 <code>/etc/apache2</code> 下的 <code>httpd.conf</code>。<br>然后，找到 <code>Listen 80</code> 那一行，修改成你想要的端口即可。</p>
<h3 id="方法二：借助-Mac-系统自带的-Python，使用其中的-SimpleHTTPServer-模块启动服务器"><a href="#方法二：借助-Mac-系统自带的-Python，使用其中的-SimpleHTTPServer-模块启动服务器" class="headerlink" title="方法二：借助 Mac 系统自带的 Python，使用其中的 SimpleHTTPServer 模块启动服务器"></a>方法二：借助 Mac 系统自带的 Python，使用其中的 SimpleHTTPServer 模块启动服务器</h3><ol>
<li><p>安装 Python，其实 Mac 系统就自带了 Python2.7。</p>
</li>
<li><p>通过 <code>cd &lt;your-working-dir&gt;</code> 进入到你的工作目录下，也就是你要让别人访问的文件所在的目录。</p>
</li>
<li><p>在工作目录下执行下面的命令后，就可以启动服务了：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如果你的 Python 版本是 3.X</span></span><br><span class="line">python3 -m http.server</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果你的 Python 版本是 2.X</span></span><br><span class="line">python -m SimpleHTTPServer</span><br></pre></td></tr></table></figure>
</li>
<li><p>默认情况下，上面的操作将会在本地 Web 服务器上的端口 8000 上运行工作目录中的内容。您可以通过在浏览器中输入 URL <code>http://localhost:8000</code> 并回车，来访问此服务器。你会看到列出的目录的内容，点击就可以查看你想运行的 HTML 文件。</p>
</li>
</ol>
<p>Q：如何修改服务器的默认端口？<br>A：可以通过运行下面的命令来指定一个端口号：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如果你的 Python 版本是 3.X</span></span><br><span class="line">python -m http.server &lt;your-port&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果你的 Python 版本是 2.X</span></span><br><span class="line">python -m SimpleHTTPServer &lt;your-port&gt;</span><br></pre></td></tr></table></figure>

<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>方法二相比方法一来说，更简单、方便，也更灵活，而且还可以随时在终端上看到服务器的状态。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Learn/Common_questions/set_up_a_local_testing_server">How do you set up a local testing server? - Learn web development | MDN</a>（推荐阅读）</li>
<li><a href="https://www.jianshu.com/p/d006a34a343f">Mac OS X 启用 Web 服务器</a></li>
<li><a href="http://www.jianshu.com/p/90d5fa728861">Mac 自带的本地服务器的使用</a></li>
<li><a href="https://blog.csdn.net/seafishyls/article/details/44546809">Mac OS 原来自带了 apache，基本用法总结</a></li>
</ul>
]]></content>
      <categories>
        <category>后端</category>
        <category>服务器</category>
      </categories>
  </entry>
  <entry>
    <title>如何实现一个简单的骨架屏效果</title>
    <url>/posts/11567/</url>
    <content><![CDATA[<p>之前博客提到了如何在 Vue 中使用插件实现骨架屏效果，而且骨架屏 UI 素材使用的是图片。一旦我们没有设计师帮助提供图片或者插件失效就没辙了。所以这次记录下如何在不使用插件的前提下，使用 HTML+CSS 实现一个自定义骨架屏。</p>
<h3 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h3><img src="/posts/11567/skeleton.png" class="" title="最终效果">

<a id="more"></a>

<h3 id="代码文件"><a href="#代码文件" class="headerlink" title="代码文件"></a>代码文件</h3><h4 id="封装组件"><a href="#封装组件" class="headerlink" title="封装组件"></a>封装组件</h4><blockquote>
<p>yyt-st-skeleton.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 预定selectTable的骨架屏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;yyt-st-skeleton&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123; top: top + &#x27;rpx&#x27; &#125;&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;show&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 区域名称 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;yyt-st-area-name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 桌台列表 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;yyt-st-table-list-wrapper&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-else</span>&gt;</span><span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;yyt-st-skeleton&#x27;</span>,</span></span><br><span class="line">    props: &#123;</span><br><span class="line">      top: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">Number</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="number">100</span>,</span></span><br><span class="line"><span class="javascript">        <span class="built_in">require</span>: <span class="literal">false</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">      show: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">Boolean</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">        <span class="built_in">require</span>: <span class="literal">true</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;&#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;&#125;;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="keyword">@import</span> url(<span class="string">&#x27;yyt-st-skeleton.less&#x27;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>yyt-st-skeleton.less</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.bgImg</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">    <span class="number">90deg</span>,</span><br><span class="line">    rgba(#fff, <span class="number">0</span>),</span><br><span class="line">    <span class="built_in">rgba</span>(#fff, <span class="number">0.5</span>),</span><br><span class="line">    <span class="built_in">rgba</span>(#fff, <span class="number">0</span>)</span><br><span class="line">  );</span><br><span class="line">  background-size: 40px 100%; // width of the shine</span><br><span class="line">  <span class="selector-tag">background-repeat</span>: <span class="selector-tag">no-repeat</span>; // <span class="selector-tag">No</span> <span class="selector-tag">need</span> <span class="selector-tag">to</span> <span class="selector-tag">repeat</span> <span class="selector-tag">the</span> <span class="selector-tag">shine</span> <span class="selector-tag">effect</span></span><br><span class="line">  <span class="selector-tag">background-position</span>: <span class="selector-tag">left</span> <span class="selector-tag">-40px</span> <span class="selector-tag">top</span> 0; // <span class="selector-tag">Place</span> <span class="selector-tag">shine</span> <span class="selector-tag">on</span> <span class="selector-tag">the</span> <span class="selector-tag">left</span> <span class="selector-tag">side</span>, <span class="selector-tag">with</span> <span class="selector-tag">offset</span> <span class="selector-tag">on</span> <span class="selector-tag">the</span> <span class="selector-tag">left</span> <span class="selector-tag">based</span> <span class="selector-tag">on</span> <span class="selector-tag">the</span> <span class="selector-tag">width</span> <span class="selector-tag">of</span> <span class="selector-tag">the</span> <span class="selector-tag">shine</span> <span class="selector-tag">-</span> <span class="selector-tag">see</span> <span class="selector-tag">background-size</span></span><br><span class="line">  animation: shine 1s ease infinite; // increase animation time to see effect in &#x27;slow-mo&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@bg: #e6e6e6;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.yyt-st-skeleton</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">align-items</span>: flex-start;</span><br><span class="line"></span><br><span class="line">  .yyt-st-area-name &#123;</span><br><span class="line">    <span class="selector-tag">width</span>: <span class="selector-tag">calc</span>(100% / 3 <span class="selector-tag">-</span> 20<span class="selector-tag">rpx</span>);</span><br><span class="line">    <span class="selector-tag">height</span>: 40<span class="selector-tag">rpx</span>;</span><br><span class="line">    <span class="selector-tag">background-color</span>: <span class="keyword">@bg</span>;</span><br><span class="line">    <span class="selector-tag">margin-bottom</span>: 10<span class="selector-tag">rpx</span>;</span><br><span class="line">    <span class="selector-tag">margin-left</span>: 10<span class="selector-tag">rpx</span>;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.bgImg</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.yyt-st-table-list-wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">10</span>rpx;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid-template-rows</span>: <span class="built_in">repeat</span>(auto-fill, calc(<span class="number">100vw</span> / <span class="number">3</span> - <span class="number">2</span> * <span class="number">10</span>rpx));</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(auto-fill, calc(<span class="number">100%</span> / <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">    &amp; &gt; div &#123;</span><br><span class="line">      <span class="selector-tag">background-color</span>: <span class="keyword">@bg</span>;</span><br><span class="line">      <span class="selector-tag">background-clip</span>: <span class="selector-tag">content-box</span>;</span><br><span class="line">      <span class="selector-tag">margin</span>: 10<span class="selector-tag">rpx</span>;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.bgImg</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> shine &#123;</span><br><span class="line">  // <span class="selector-tag">to</span> &#123;</span><br><span class="line">  // 	// Move shine from left to right, with offset on the right based on the width of the shine - see background-size</span><br><span class="line">  // 	<span class="selector-tag">background-position</span>: <span class="selector-tag">right</span> <span class="selector-tag">-40px</span> <span class="selector-tag">top</span> 0;</span><br><span class="line">  // &#125;</span><br><span class="line">  0% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  50% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.6</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用组件"><a href="#使用组件" class="headerlink" title="使用组件"></a>使用组件</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">yyt-st-skeleton</span> <span class="attr">:show</span>=<span class="string">&quot;!ready&quot;</span> <span class="attr">:top</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 数据加载成功后被骨架屏替换掉的页面元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yyt-st-skeleton</span>&gt;</span></span><br><span class="line"></span><br><span class="line">export default &#123; data() &#123; return &#123; ready: false, //</span><br><span class="line">页面加载成功为true，默认为false &#125; &#125;, methods: &#123; requestData() &#123;</span><br><span class="line"><span class="comment">&lt;!-- 模拟数据加载 --&gt;</span></span><br><span class="line">setTimeout(() =&gt; &#123; this.ready = true; &#125;, 2000); &#125; &#125; &#125;</span><br></pre></td></tr></table></figure>

<p>骨架屏原理其实很简单，它其实就是个占位组件，用简单的 HTML 和 CSS 就能实现，当页面请求时显示，请求完毕后隐藏，与此同时显示加载数据成功后的界面。</p>
<p>如果需要在等待期间骨架屏有动画效果，使用 CSS3 的 animation + @keyframes 就能完成。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>用户体验</tag>
        <tag>骨架屏</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>如何对scss变量做cacl计算</title>
    <url>/posts/1852/</url>
    <content><![CDATA[<p>写页面时需要对一个 scss 变量做 css 的 calc 处理，发现直接使用变量浏览器无法识别，Google 后发现要对变量处理才能正常使用：</p>
<p>假定定义卡片变量 <code>$cardWidth: 450px</code>，如果要使用 <code>calc</code>，直接 <code>width: calc($cardWidth * 2);</code> 这么用是不行的，需要按如下使用方法：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">width: calc(#&#123;$cardWidth&#125; * 2);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
        <category>SCSS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>如何清除浮动</title>
    <url>/posts/12906/</url>
    <content><![CDATA[<h2 id="为什么要清除浮动"><a href="#为什么要清除浮动" class="headerlink" title="为什么要清除浮动"></a>为什么要清除浮动</h2><p>其实浮动（e.g. <code>float: left;</code>）本质上是用来做文字混排的，但却被我们拿来做布局，这个时候虽然实现了某些效果，但也带来了不少副作用。</p>
<p>由于浮动元素不再占有原文档流的位置，所以它会对后续元素的排版带来影响（无视浮动元素，就当它不存在过）。因此我们很多时候要做的，就是消除浮动元素造成的影响。清除浮动的本质主要是为了解决父元素因为子元素浮动造成的内部高度为0的问题。</p>
<a id="more"></a>

<h2 id="clear"><a href="#clear" class="headerlink" title="clear"></a>clear</h2><p>清除浮动的核心css属性是 clear ，基本语法如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">选择器: &#123;</span><br><span class="line">    <span class="attribute">clear</span>: 属性值;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">属性值</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">left</td>
<td align="left">不允许左侧有浮动元素（清除左侧浮动的影响）</td>
</tr>
<tr>
<td align="left">right</td>
<td align="left">不允许右侧有浮动元素（清除右侧浮动的影响）</td>
</tr>
<tr>
<td align="left">both</td>
<td align="left">同时清除左右两侧浮动的影响</td>
</tr>
</tbody></table>
<h2 id="清除浮动常见方案"><a href="#清除浮动常见方案" class="headerlink" title="清除浮动常见方案"></a>清除浮动常见方案</h2><h3 id="额外标记法"><a href="#额外标记法" class="headerlink" title="额外标记法"></a>额外标记法</h3><p>在浮动元素后面添加一个空标签，例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;float: left;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;clear: both;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>优点：通俗易懂，书写方便<br>缺点：加入了过多的没有实际含义的额外标签，结构化差。</p>
<h3 id="父元素添加overflow"><a href="#父元素添加overflow" class="headerlink" title="父元素添加overflow"></a>父元素添加overflow</h3><p>通过触发BFC达到清除浮动的效果。（p.s. 对bfc不了解可以看<a href="https://evestorm.github.io/posts/9722/">这篇</a>文章）</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优点：代码简洁<br>缺点：超出的内容会被隐藏</p>
<h3 id="before和after双伪元素方案"><a href="#before和after双伪元素方案" class="headerlink" title="before和after双伪元素方案"></a>before和after双伪元素方案</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span> &#123; </span><br><span class="line">    <span class="attribute">content</span>:<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="attribute">display</span>: table;  <span class="comment">/* 触发BFC清除浮动 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">    <span class="attribute">*zoom</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优点：代码简洁<br>缺点：IE6-7不支持:after，需要使用 <code>zoom: 1</code> 触发 <code>hasLayout</code></p>
<h3 id="使用after伪元素（我平常使用的）"><a href="#使用after伪元素（我平常使用的）" class="headerlink" title="使用after伪元素（我平常使用的）"></a>使用after伪元素（我平常使用的）</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">::after</span> &#123;  </span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;.&quot;</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">visibility</span>: hidden;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">    <span class="attribute">*zoom</span>: <span class="number">1</span>;</span><br><span class="line">&#125;   <span class="comment">/* IE6、7 专有 */</span></span><br></pre></td></tr></table></figure>

<p>使用方式：给浮动元素的父元素添加一个class类：<code>clearfix</code><br>优点：一次书写多处使用，并且符合闭合浮动思想，结构语义化正确<br>缺点：IE6-7不支持:after，需要使用 <code>zoom: 1</code> 触发 <code>hasLayout</code><br>注意：<code>content:&quot;.&quot;</code> 内容尽量不为空，可以跟一个小点，否则在firefox 7.0前的版本会生成空格</p>
<h2 id="after-和-after-的区别"><a href="#after-和-after-的区别" class="headerlink" title=":after 和 ::after 的区别"></a>:after 和 ::after 的区别</h2><p>:before、:after 在旧版本里是伪元素，CSS3的规范里 “:” 用来表示伪类，”::” 用来表示伪元素，但是在高版本浏览器下 :before、:after 会被自动识别为 ::before、::after ，这样做的目的是用来做兼容处理。</p>
<h3 id="相同点"><a href="#相同点" class="headerlink" title="相同点"></a>相同点</h3><p>伪类对象，用来设置对象前的内容<br>:before 和 ::before 写法是等效的</p>
<h3 id="不同点"><a href="#不同点" class="headerlink" title="不同点"></a>不同点</h3><p>:before 是 css2 的写法，::before 是 css3 的写法<br>:before 兼容性比 ::before要好</p>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>伪类元素必须要配合 content 属性一起使用，否则无效<br>伪类元素是css渲染层加入的，不能通过js来操作</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>布局</tag>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>如何解决0.1+0.2不等于0.3的问题</title>
    <url>/posts/21245/</url>
    <content><![CDATA[<h2 id="为何会出现此问题？"><a href="#为何会出现此问题？" class="headerlink" title="为何会出现此问题？"></a>为何会出现此问题？</h2><p>总结一句话：这是因为二进制模拟十进制进行运算时的精度问题。</p>
<p>具体可查看 <a href="https://juejin.im/post/5b90e00e6fb9a05cf9080dff">0.1 + 0.2 不等于 0.3？为什么 JavaScript 有这种“骚”操作？</a> 这篇掘金文章。</p>
<a id="more"></a>

<h2 id="如何解决"><a href="#如何解决" class="headerlink" title="如何解决"></a>如何解决</h2><h3 id="Number-EPSILON"><a href="#Number-EPSILON" class="headerlink" title="Number.EPSILON"></a>Number.EPSILON</h3><p>第一种方法是利用 <code>Number.EPSILON</code> ，这个值无限接近于 0。0.1+0.2 的精度误差在这个值的范围内：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">numbersEqual</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.abs(a-b)&lt;<span class="built_in">Number</span>.EPSILON;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a=<span class="number">0.1</span>+<span class="number">0.2</span>， b=<span class="number">0.3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(numbersEqual(a,b));    <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<h3 id="内置函数-toFixed"><a href="#内置函数-toFixed" class="headerlink" title="内置函数 toFixed"></a>内置函数 toFixed</h3><p>利用 <code>parseFloat</code> + 内置函数 toFixed：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatNum</span>(<span class="params">num, fixed = <span class="number">10</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// a.toFixed(fixed) 先转为小数点10位的字符串 &quot;0.3000000000&quot;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseFloat</span>(a.toFixed(fixed)); <span class="comment">// 然后通过parseFloat转为浮点数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">0.1</span> + <span class="number">0.2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(formatNum(a)); <span class="comment">//0.3</span></span><br></pre></td></tr></table></figure>

<h3 id="内置函数-toPrecision"><a href="#内置函数-toPrecision" class="headerlink" title="内置函数 toPrecision"></a>内置函数 toPrecision</h3><p>我平常用此函数来计算精度，具体可参考 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/toPrecision">Number.prototype.toPrecision() | MDN</a>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 内置函数toPrecision(中文：精确，精度)</span></span><br><span class="line"><span class="comment">// 参数是精度.比如5.1234，传2返回5.1，传1返回5；0.2+0.1传2返回0.30</span></span><br><span class="line">(<span class="number">0.1</span> + <span class="number">0.2</span>).toPrecision(<span class="number">10</span>) == <span class="number">0.3</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>字体侵权避坑指南</title>
    <url>/posts/9274/</url>
    <content><![CDATA[<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p>本文摘录自：<a href="https://www.uisdc.com/avoiding-pits-in-font-copyright">https://www.uisdc.com/avoiding-pits-in-font-copyright</a></p>
<p><strong>初始设定：</strong>字体，微软雅黑。</p>
<p><strong>场景设定：</strong>因产品需要，客户希望在 windows 的客户端查看网站都能够和设计稿保持一致用微软雅黑。项目组给了两种前端解决方案：</p>
<ul>
<li>在 css 样式文件中：引用字体样式为微软雅黑。</li>
<li>在网站样式文件中，打包微软雅黑字体，客户打开网站会预加载微软雅黑字体。</li>
</ul>
<p>请问两种解决方案应该用哪一个？</p>
<a id="more"></a>

<p><strong>案例分析：</strong></p>
<p>应使用第一种方案，因为第一种方案，我们只是设定了如果载体有安装微软雅黑的字体的客户端，那网站显示字体，这个字体授权的控制单位在客户端那里。如果用第二种方案，我们预置了，不管任何客户端都加载微软雅黑字体，除非客户已经购买了微软雅黑所属的方正公司授权商用，否则即判定为字体侵权。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">font-family: &#x27;微软雅黑&#x27;;</span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;MyFont&#x27;</span>; <span class="comment">/* 字体名称 */</span></span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;微软雅黑.ttf&#x27;</span>); <span class="comment">/*字体源文件*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="字体侵权情况"><a href="#字体侵权情况" class="headerlink" title="字体侵权情况"></a>字体侵权情况</h2><p>1 图片或视频中使用了版权字体。</p>
<ol start="2">
<li>网站本身引入了字体库文件（直接将整个字体库加载了，也就是说如果浏览者没有这个字体，则会下载这种）</li>
</ol>
]]></content>
      <categories>
        <category>设计</category>
        <category>平面</category>
      </categories>
      <tags>
        <tag>字体侵权</tag>
      </tags>
  </entry>
  <entry>
    <title>安卓模拟器跑不了项目</title>
    <url>/posts/56861/</url>
    <content><![CDATA[<p>下了个 Android Studio 准备跑 App，但发现 run 之后只启动了模拟器却并没有安装上 App 。后来发现选择模拟器设备一栏显示如图所示文字：</p>
<img src="/posts/56861/x86_not_support.png" class="" title="x86_not_support">

<p>网上搜了下上图红框内容，找到了解决方案：</p>
<p><a href="https://stackoverflow.com/questions/41775988/what-is-the-reason-for-the-error-device-supports-x86-but-apk-only-supports-arm">https://stackoverflow.com/questions/41775988/what-is-the-reason-for-the-error-device-supports-x86-but-apk-only-supports-arm</a></p>
<p>在项目中找到对应注释代码：</p>
<img src="/posts/56861/comment_x86.png" class="" title="comment_x86">

<p>解开注释：</p>
<img src="/posts/56861/support_x86.png" class="" title="support_x86">

<p>然后重新编译下就好了：</p>
<img src="/posts/56861/rebuild.png" class="" title="rebuild">

<p>最后点击运行就能把 app 跑到模拟器上了：</p>
<img src="/posts/56861/x86_disappear.png" class="" title="x86_disappear">
]]></content>
      <categories>
        <category>移动端</category>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>宏任务&amp;微任务</title>
    <url>/posts/20664/</url>
    <content><![CDATA[<h2 id="先-Mark-一下，抽空再写…"><a href="#先-Mark-一下，抽空再写…" class="headerlink" title="先 Mark 一下，抽空再写…"></a>先 Mark 一下，抽空再写…</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;sync1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout1&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeoutPromise&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise&#x27;</span>);</span><br><span class="line">  resolve();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;pro_then&#x27;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;pro_timeout&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;last_setTimeout&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;sync2&#x27;</span>);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
  </entry>
  <entry>
    <title>对HTML语义化的理解</title>
    <url>/posts/2906/</url>
    <content><![CDATA[<h2 id="对HTML语义化的理解"><a href="#对HTML语义化的理解" class="headerlink" title="对HTML语义化的理解"></a>对HTML语义化的理解</h2><p>核心：用正确的标签做正确的事情</p>
<ol>
<li>利与开发：方便代码的阅读和维护</li>
<li>利于SEO：方便爬虫根据 语义标签 确定 页面结构 和 关键字 的权重</li>
</ol>
<a id="more"></a>

<h2 id="常见语义化标签"><a href="#常见语义化标签" class="headerlink" title="常见语义化标签"></a>常见语义化标签</h2><p>一图胜千言：</p>
<img src="/posts/2906/f8442d9e-e30d-11e6-85aa-3e3fb75f9695.jpg" class="" title="语义化demo">


<p>元素细节：</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/main">main</a> 存放每个页面独有的内容。每个页面上只能用一次 <code>&lt;main&gt;</code>，且直位于 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/body">``</a>中。最好不要把它嵌套进其它元素。</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/article">article</a> 包围的内容即一篇文章，与页面其它部分无关（比如一篇博文）。</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/section">section</a> 与 <code>&lt;article&gt;</code> 类似，但 <code>&lt;section&gt;</code> 更适用于组织页面使其按功能（比如迷你地图、一组文章标题和摘要）分块。一般的最佳用法是：以 <a href="https://developer.mozilla.org/en-US/Learn/HTML/Howto/Set_up_a_proper_title_hierarchy">标题</a> 作为开头；也可以把一篇 <code>&lt;article&gt;</code> 分成若干部分并分别置于不同的 <code>&lt;section&gt;</code> 中，也可以把一个区段 <code>&lt;section&gt;</code> 分成若干部分并分别置于不同的 <code>&lt;article&gt;</code> 中，取决于上下文。</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/aside">aside</a> 包含一些间接信息（术语条目、作者简介、相关链接，等等）。</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/header">header</a> 是简介形式的内容。如果它是 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/body">body</a> 的子元素，那么就是网站的全局页眉。如果它是 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/article">article</a> 或<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/section">section</a> 的子元素，那么它是这些部分特有的页眉（此 <code>&lt;header&gt;</code> 非彼 <a href="https://developer.mozilla.org/zh-CN/docs/learn/HTML/Introduction_to_HTML/The_head_metadata_in_HTML#%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%A0%87%E9%A2%98">标题</a>）。</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/nav">nav</a> 包含页面主导航功能。其中不应包含二级链接等内容。</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/footer">footer</a> 包含了页面的页脚部分。</li>
</ul>
<p>来源：<a href="https://developer.mozilla.org/zh-CN/docs/learn/HTML/Introduction_to_HTML/%E6%96%87%E4%BB%B6%E5%92%8C%E7%BD%91%E7%AB%99%E7%BB%93%E6%9E%84">文档与网站架构</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>HTML</category>
      </categories>
  </entry>
  <entry>
    <title>对this指向的判定</title>
    <url>/posts/33207/</url>
    <content><![CDATA[<h2 id="对-this-的理解"><a href="#对-this-的理解" class="headerlink" title="对 this 的理解"></a>对 this 的理解</h2><p>对于this指向的判定，时刻记住下面两点就好：</p>
<ul>
<li>普通函数的 this 指向是在函数的执行期间绑定的，换句话说 this 总是指向函数的<strong>直接</strong>调用者</li>
<li>箭头函数的 this 指向是在函数创建期间就绑定好了的，指向的是创建该箭头函数所在的作用域对象</li>
</ul>
<a id="more"></a>

<h2 id="普通函数中的this"><a href="#普通函数中的this" class="headerlink" title="普通函数中的this"></a>普通函数中的this</h2><p>这里直接引用 <a href="https://github.com/getify/You-Dont-Know-JS">You-Dont-Know-JS</a> 中对 this 的判定步骤：</p>
<ol>
<li>函数是通过 <code>new</code> 被调用的吗（<strong>new 绑定</strong>）？如果是，<code>this</code> 就是新构建的对象。<br><code>var bar = new foo()</code></li>
<li>函数是通过 <code>call</code> 或 <code>apply</code> 被调用（<strong>明确绑定</strong>），甚至是隐藏在 <code>bind</code> <em>硬绑定</em> 之中吗？如果是，<code>this</code> 就是那个被明确指定的对象。<br><code>var bar = foo.call( obj2 )</code></li>
<li>函数是通过环境对象（也称为拥有者或容器对象）被调用的吗（<strong>隐含绑定</strong>）？如果是，<code>this</code> 就是那个环境对象。<br><code>var bar = obj1.foo()</code></li>
<li>否则，使用默认的 <code>this</code>（<strong>默认绑定</strong>）。如果在 <code>strict mode</code> 下，就是 <code>undefined</code>，否则是 <code>global</code> 对象。<br><code>var bar = foo()</code></li>
</ol>
<h2 id="常见this指向"><a href="#常见this指向" class="headerlink" title="常见this指向"></a>常见this指向</h2><ul>
<li>普通函数中this ——&gt; window</li>
<li>构造函数中this ——&gt; new出来的实例对象</li>
<li>方法中的this ——&gt; 实例对象</li>
<li>原型中的方法中的this ——&gt; 实例对象</li>
<li>定时器中的this ——&gt; window</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>this</tag>
      </tags>
  </entry>
  <entry>
    <title>对闭包的理解</title>
    <url>/posts/29980/</url>
    <content><![CDATA[<h2 id="什么是闭包"><a href="#什么是闭包" class="headerlink" title="什么是闭包"></a>什么是闭包</h2><p>我一直认为，MDN是前端学习的在线指南。只要有不懂的语法，或者不懂的概念，查找资料的首选就应该是它。虽然早些年做iOS开发的时候就就接触过闭包，但如今已经忘得一干二净，所以在想要了解闭包的时候，第一件事就是在MDN中搜索。<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures">其中</a>给到了一个闭包的例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">&quot;Mozilla&quot;</span>;    <span class="comment">// name 是一个被 init 创建的局部变量</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">displayName</span>(<span class="params"></span>) </span>&#123; <span class="comment">// displayName() 是内部函数,一个闭包</span></span><br><span class="line">        alert(name);         <span class="comment">// 使用了父函数中声明的变量</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> displayName;      <span class="comment">// 返回 displayName 这个函数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myFunc = makeFunc();</span><br><span class="line">myFunc(); <span class="comment">// 当执行myFunc时，其实调用了displayName，会弹窗显示&quot;Mozilla&quot;</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>在上面这个例子中，一个函数套了一个函数，且这个内部函数使用到了外部函数中的变量，这个时候就形成了闭包。有什么用呢？其中一个用处就如上面代码所示，能够让 makeFunc 函数外面也能访问 name 这个局部变量。换句话说，闭包缓存了数据，延长了作用域链。</p>
<p>Kyle Simpson编写的<a href="https://github.com/getify/You-Dont-Know-JS">You-Dont-Know-JS</a>中对闭包的总结我觉得很精髓：</p>
<blockquote>
<p>闭包就是当一个函数即使是在它的词法作用域之外被调用时，也可以记住并访问它的词法作用域。</p>
</blockquote>
<h2 id="闭包的特性"><a href="#闭包的特性" class="headerlink" title="闭包的特性"></a>闭包的特性</h2><ol>
<li>函数内再嵌套函数</li>
<li>内部函数可以引用外层的参数和变量</li>
<li>参数和变量不会被垃圾回收机制回收</li>
</ol>
<h2 id="闭包的用途"><a href="#闭包的用途" class="headerlink" title="闭包的用途"></a>闭包的用途</h2><h3 id="读取正确的值"><a href="#读取正确的值" class="headerlink" title="读取正确的值"></a>读取正确的值</h3><p>一个经典的例子，给 ul&gt;li 下面的每个 li 节点添加点击事件，让其弹出当前 li 元素的索引：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;ul id=<span class="string">&quot;testUL&quot;</span>&gt;</span><br><span class="line">    &lt;li&gt; index = <span class="number">0</span>&lt;/li&gt;</span><br><span class="line">    &lt;li&gt; index = <span class="number">1</span>&lt;/li&gt;</span><br><span class="line">    &lt;li&gt; index = <span class="number">2</span>&lt;/li&gt;</span><br><span class="line">    &lt;li&gt; index = <span class="number">3</span>&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> nodes = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;li&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; nodes.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">        nodes[i].onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<p>运行上述代码后就会发现，每次打印的结果都显示为4，而不是真正的索引值。这是因为点击事件的匿名函数发生在for循环之后，而for循环执行完毕时 i 的值就为4，所以点谁都是同样的结果。那么这个时候就能通过<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F">立即执行函数</a> + <strong>闭包</strong>的方法解决此问题：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> nodes = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;li&quot;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; nodes.length; i += <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="javascript">        nodes[i].onclick = (<span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123; <span class="comment">// 1. IIFE创建一个函数作用域</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// 4. 返回这个匿名函数，延长作用域链</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">// 3. 内部嵌套的匿名函数使用到了IIFE的参数i，形成闭包</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(i);</span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="javascript">        &#125;)(i); <span class="comment">// 2. 给IIFE传递每次for循环的i</span></span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个时候触发click事件，打印的值就是li元素的索引了。</p>
<h3 id="高级排他"><a href="#高级排他" class="headerlink" title="高级排他"></a>高级排他</h3><p>这个例子有点像上面的，现在我们要个需求：在一个 <code>ul li</code> 列表中，鼠标移入时高亮当前li标签，移除之前li标签的高亮状态。</p>
<p>常规写法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 假设给li添加active类可以让标签高亮</span></span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> list = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;li&#x27;</span>)</span><br><span class="line">    <span class="comment">// 遍历每个标签</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> li = list[i]</span><br><span class="line">      li.onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// mouseover触发后遍历整个列表，将所有标签class设为空</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; list.length; j++) &#123;</span><br><span class="line">          list[j].className = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 最后给当前li标签添加active</span></span><br><span class="line">        <span class="built_in">this</span>.className = <span class="string">&#x27;active&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码能够实现功能，然而一旦列表非常长性能就不高，所以可以利用闭包来缓存li标签的索引，使其与标签一一对应：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> list = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;li&#x27;</span>)</span><br><span class="line">  <span class="comment">// 记录上一次选中的li标签的对应索引</span></span><br><span class="line">  <span class="keyword">let</span> preActiveIndex = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params">j</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> li = list[i]</span><br><span class="line">      li.onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 清除上次li标签的高亮</span></span><br><span class="line">        list[preActiveIndex].className = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="comment">// 设置当前位高亮</span></span><br><span class="line">        <span class="built_in">this</span>.className = <span class="string">&#x27;active&#x27;</span></span><br><span class="line">        <span class="comment">// 赋值</span></span><br><span class="line">        preActiveIndex = j</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="模块化开发"><a href="#模块化开发" class="headerlink" title="模块化开发"></a>模块化开发</h3><p>在团队开发中，为了避免命名冲突通常不同成员会把自己的代码单独封装起来，最后return一个对象出去，挂载到window上。这样其他人也可以使用，而且能在一定程度上避免命名冲突：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">w</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> money = <span class="number">1000</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    money *= <span class="number">10</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;赚了一笔钱，总资产：&quot;</span> + money + <span class="string">&quot;元&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    money--</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;花了一笔钱，总资产：&quot;</span> + money + <span class="string">&quot;元&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 向外暴露对象</span></span><br><span class="line">  w.myTools = &#123;</span><br><span class="line">    get,</span><br><span class="line">    set</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="built_in">window</span>)</span><br></pre></td></tr></table></figure>

<h3 id="函数节流防抖"><a href="#函数节流防抖" class="headerlink" title="函数节流防抖"></a>函数节流防抖</h3><p>在日常开发中，我们也经常用到函数节流与防抖，通常我们会将它们封装为函数，这样可以在需要的地方直接调用使用，还不会污染全局：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>防抖节流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 函数防抖 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn, delay</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> timer = <span class="literal">null</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ctx = <span class="built_in">this</span>,</span></span><br><span class="line"><span class="javascript">            args = <span class="built_in">arguments</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (timer) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">window</span>.clearTimeout(timer)</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        timer = <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line">          fn.apply(ctx, args)</span><br><span class="line"><span class="javascript">          timer = <span class="literal">null</span></span></span><br><span class="line">        &#125;, delay);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="comment">// 搜索框做函数防抖避免用户高频输入内容</span></span></span><br><span class="line"><span class="javascript">    input.addEventListener(<span class="string">&#x27;input&#x27;</span>, debounce(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e.target.value)</span></span><br><span class="line">    &#125;, 500))</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 函数节流 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn, delay</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> canUse = <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ctx = <span class="built_in">this</span>,</span></span><br><span class="line"><span class="javascript">            args = <span class="built_in">arguments</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (canUse) &#123;</span></span><br><span class="line">          fn.apply(ctx, args)</span><br><span class="line"><span class="javascript">          canUse = <span class="literal">false</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            canUse = <span class="literal">true</span></span></span><br><span class="line">          &#125;, delay);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="comment">// 对于像onresize这样的高频事件，可以使用函数节流让其回调函数中的代码隔一段时间再次执行</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onresize = throttle(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      input.value = <span class="built_in">Math</span>.random() * <span class="number">100</span></span></span><br><span class="line">    &#125;, 1000)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h2><p>其实闭包并不会造成内存泄漏，现在的垃圾回收机制已经很成熟了。但早期的IE（ie4-ie6）版本里，对宿主对象（也就是document对象）采用是引用计数的<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management">垃圾回收机制</a>，闭包导致内存泄漏的一个原因就是这个算法的一个缺陷。循环引用会导致没法回收，这个循环引用只限定于有宿主对象参与的循环引用，而js对象之间即使形成循环引用，也不会产生内存泄漏，因为对js对象的回收算法不是计数的方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">closure</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;oDiv&#x27;</span>);<span class="comment">//oDiv用完之后一直驻留在内存中</span></span><br><span class="line">    oDiv.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(<span class="string">&#x27;oDiv.innerHTML&#x27;</span>);<span class="comment">//这里用oDiv导致内存泄露</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上代码创建了一个作为 div 元素事件处理程序的闭包，而这个闭包则又创建了一个循环引用。</span></span><br><span class="line"><span class="comment">// 由于匿名函数保存了一个对closure()的活动对象的引用，因此就会导致无法减少 div 的引用数。</span></span><br><span class="line"><span class="comment">// 只要匿名函数存在，element 的引用数至少也是1，因此它所占用的内存就永远不会被回收</span></span><br><span class="line"></span><br><span class="line">closure();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//最后应将oDiv解除引用来避免内存泄露</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">closure</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;oDiv&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> test = oDiv.innerHTML;</span><br><span class="line">    oDiv.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(test);</span><br><span class="line">    &#125;;</span><br><span class="line">    oDiv = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 解决办法: 把 oDiv.innerHTML 的一个副本保存在一个变量中，</span></span><br><span class="line"><span class="comment">// 从而消除闭包中该变量的循环引用,同时将 oDiv 变量设为null。</span></span><br></pre></td></tr></table></figure>

<p>所以我们要保持良好的编程习惯，在使用完闭包后记得释放内存：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">9999999999999</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(arr)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fn2</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> f = fn1()</span><br><span class="line">f() <span class="comment">// 调用完后没有释放，arr就会一直在内存中占着，导致内存泄漏</span></span><br><span class="line"><span class="comment">// 记得释放</span></span><br><span class="line">f = <span class="literal">null</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>闭包</tag>
      </tags>
  </entry>
  <entry>
    <title>封装element-ui的el-upload实现上传删除和预览</title>
    <url>/posts/463/</url>
    <content><![CDATA[<h2 id="父组件"><a href="#父组件" class="headerlink" title="父组件"></a>父组件</h2><a id="more"></a>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;驾驶证照片&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;licenseImg&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ↓鼠标移上去的提示信息↓ --&gt;</span></span><br><span class="line">    &lt;el-tooltip</span><br><span class="line">      class=&quot;item&quot;</span><br><span class="line">      effect=&quot;dark&quot;</span><br><span class="line">      content=&quot;最多选择一个文件&quot;</span><br><span class="line">      placement=&quot;top-start&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      <span class="comment">&lt;!-- 封装的子组件 --&gt;</span></span><br><span class="line">      &lt;upload-img</span><br><span class="line">        ref=&quot;licenseImg&quot;</span><br><span class="line">        refName=&quot;licenseImg&quot;</span><br><span class="line">        :fileList=&quot;drivingLicenseUploadList&quot;</span><br><span class="line">        id=&quot;license&quot;</span><br><span class="line">        :limit=&quot;1&quot;</span><br><span class="line">        @handleChange=&quot;handleChange&quot;</span><br><span class="line">        @handleRemove=&quot;handleRemove&quot;</span><br><span class="line">      &gt;<span class="tag">&lt;/<span class="name">upload-img</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-tooltip</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如果上传了，则隐藏获取的，显示上传的--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;drivingLicenseUploadList.length &gt; 0&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    &lt;img</span><br><span class="line">      v-else</span><br><span class="line">      v-for=&quot;(img, idx) in basicFormData.licenseImgUrls&quot;</span><br><span class="line">      :key=&quot;idx&quot;</span><br><span class="line">      :src=&quot;img.url&quot;</span><br><span class="line">      @click=&quot;handleImgPreview(img.url)&quot;</span><br><span class="line">      alt=&quot;&quot;</span><br><span class="line">      width=&quot;50%&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &#123;&#123; basicFormData.licenseImg &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> uploadImg <span class="keyword">from</span> <span class="string">&#x27;@/components/common/uploadImg&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;edit&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        basicFormData: &#123;</span><br><span class="line">          ...</span><br><span class="line"><span class="javascript">          licenseImg: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 驾驶证照片</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="comment">//  展示用</span></span></span><br><span class="line">          licenseImgUrls: [</span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">              filePath: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 文件路径</span></span></span><br><span class="line"><span class="javascript">              url: <span class="string">&#x27;&#x27;</span> <span class="comment">// 远程url链接</span></span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="javascript">          ], <span class="comment">// 驾驶</span></span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        drivingLicenseUploadList: [], <span class="comment">// 驾驶证图片上传列表参数</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        dialogImageUrl: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        dialogVisible: <span class="literal">false</span> <span class="comment">// 图片预览</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      /**</span><br><span class="line">       * @description 上传的图片改变</span><br><span class="line">       * @param file 当前文件</span><br><span class="line">       * @param fileList 所有文件列表</span><br><span class="line">       * @param type 删除的哪个字段的图片</span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="keyword">async</span> <span class="function"><span class="title">handleChange</span>(<span class="params">file, fileList, type</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line">          license: &#123;</span><br><span class="line"><span class="javascript">            list: <span class="built_in">this</span>.drivingLicenseUploadList,</span></span><br><span class="line"><span class="javascript">            target: <span class="string">&quot;licenseImg&quot;</span>,</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="javascript">        <span class="comment">// 图片上传限制</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> isLt5M = file.size / <span class="number">1024</span> / <span class="number">1024</span> &lt; <span class="number">5</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (!isLt5M) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$message.warning(<span class="string">&quot;上传图片大小不能超过5MB！&quot;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">// console.log(this.$refs[obj[type].target].$refs[obj[type].target]);</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 清空上传列表</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$refs[obj[type].target].$refs[obj[type].target].clearFiles();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">        <span class="comment">//  上传当前文件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="built_in">this</span>.uploadImgFile(file);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (data.filePath) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.basicFormData[obj[type].target] = data.filePath;</span></span><br><span class="line">          obj[type].list.splice(0, obj[type].list.length);</span><br><span class="line"><span class="javascript">          <span class="keyword">for</span> (<span class="keyword">const</span> x <span class="keyword">of</span> fileList) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> fileName = x.name + x.size;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (x.raw) &#123;</span></span><br><span class="line">              obj[type].list.push(&#123;</span><br><span class="line">                ...x,</span><br><span class="line">                fileName,</span><br><span class="line"><span class="javascript">                fileUrl: x.uid === file.uid ? data.url : x.fileUrl, <span class="comment">// 远程url</span></span></span><br><span class="line"><span class="javascript">                filePath: x.uid === file.uid ? data.filePath : x.filePath, <span class="comment">// tms标识地址</span></span></span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      /**</span><br><span class="line">       * @description 删除操作</span><br><span class="line">       * @param file 当前文件</span><br><span class="line">       * @param type 删除的哪个字段的图片</span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="keyword">async</span> <span class="function"><span class="title">handleRemove</span>(<span class="params">file, type</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line">          license: &#123;</span><br><span class="line"><span class="javascript">            list: <span class="built_in">this</span>.drivingLicenseUploadList,</span></span><br><span class="line"><span class="javascript">            target: <span class="string">&quot;licenseImg&quot;</span>,</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="javascript">        <span class="comment">// 移除当前图片</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="built_in">this</span>.deleteImgFile(file.filePath);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (data) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> targetIdx = obj[type].list.findIndex(</span></span><br><span class="line">            (item) =&gt; item.uid !== file.uid</span><br><span class="line">          );</span><br><span class="line">          obj[type].list.splice(targetIdx, 1);</span><br><span class="line"><span class="javascript">          <span class="comment">// 如果删除成功，则还原成最初的filePath</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.basicFormData[obj[type].target] =</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.basicFormData.identificationImgUrl.length &gt; <span class="number">0</span></span></span><br><span class="line"><span class="javascript">              ? <span class="built_in">this</span>.basicFormData.identificationImgUrl[<span class="number">0</span>].filePath</span></span><br><span class="line"><span class="javascript">              : <span class="string">&quot;&quot;</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      /**</span><br><span class="line">       * @description 预览图片</span><br><span class="line">       * @param url 图片url</span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">handleImgPreview</span>(<span class="params">url</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.dialogImageUrl = url;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.dialogVisible = <span class="literal">true</span>;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      /**</span><br><span class="line">       * @description 上传图片文件</span><br><span class="line">       * @param file File原始文件</span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">uploadImgFile</span>(<span class="params">file</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//  构造FormData</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> uploadForm = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="javascript">        uploadForm.append(<span class="string">&quot;file&quot;</span>, file.raw);</span></span><br><span class="line"><span class="javascript">        uploadForm.append(<span class="string">&quot;moduleName&quot;</span>, <span class="string">&quot;driver&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;HXConfig.Instance().mdaHttpUrl&#125;</span>/commonImg/uploadFile`</span>;</span></span><br><span class="line"><span class="javascript">          httpAsync(url, <span class="string">&quot;post&quot;</span>, uploadForm, &#123;</span></span><br><span class="line"><span class="javascript">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;multipart/form-data&quot;</span>,</span></span><br><span class="line"><span class="javascript">            PROJECTCODE: <span class="string">&quot;TMS&quot;</span>,</span></span><br><span class="line"><span class="javascript">            SID: <span class="built_in">localStorage</span>.getItem(<span class="string">&quot;hafSID&quot;</span>),</span></span><br><span class="line">          &#125;)</span><br><span class="line"><span class="javascript">            .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">if</span> (res.code === <span class="number">0</span>) &#123;</span></span><br><span class="line">                resolve(res.data);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"><span class="javascript">            .catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">console</span>.log(e);</span></span><br><span class="line">              reject(e);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      /**</span><br><span class="line">       * @description 删除图片</span><br><span class="line">       * @param filePath 图片tms路径</span><br><span class="line"><span class="javascript">       * @returns &#123;<span class="built_in">Promise</span>&lt;unknown&gt;&#125;</span></span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">deleteImgFile</span>(<span class="params">filePath</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;</span></span></span></span><br><span class="line">            HXConfig.Instance().mdaHttpUrl</span><br><span class="line">          &#125;/commonImg/deleteListFilePath`;</span><br><span class="line">          httpAsync(</span><br><span class="line">            url,</span><br><span class="line"><span class="javascript">            <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line">            [</span><br><span class="line">              &#123;</span><br><span class="line">                filePath,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">              PROJECTCODE: <span class="string">&quot;TMS&quot;</span>,</span></span><br><span class="line"><span class="javascript">              SID: <span class="built_in">localStorage</span>.getItem(<span class="string">&quot;hafSID&quot;</span>),</span></span><br><span class="line">            &#125;</span><br><span class="line">          )</span><br><span class="line"><span class="javascript">            .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">if</span> (res.code === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">                resolve(<span class="literal">true</span>);</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"><span class="javascript">            .catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">console</span>.log(e);</span></span><br><span class="line">              reject(e);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="子组件"><a href="#子组件" class="headerlink" title="子组件"></a>子组件</h2><blockquote>
<p>uploadImg/index.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &lt;el-upload</span><br><span class="line">      :ref=&quot;refName&quot;</span><br><span class="line">      action=&quot;&quot;</span><br><span class="line">      :limit=&quot;1&quot;</span><br><span class="line">      :multiple=&quot;true&quot;</span><br><span class="line">      list-type=&quot;picture-card&quot;</span><br><span class="line">      accept=&quot;.png,.jpg,.jpeg&quot;</span><br><span class="line">      :auto-upload=&quot;false&quot;</span><br><span class="line">      :file-list=&quot;fileLists&quot;</span><br><span class="line">      :on-change=&quot;_handleChange&quot;</span><br><span class="line">      :on-exceed=&quot;_handleExceed&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">slot</span>=<span class="string">&quot;default&quot;</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-plus&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;file&quot;</span> <span class="attr">slot-scope</span>=<span class="string">&quot;&#123; file &#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;el-upload-list__item-thumbnail&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;file.url&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;el-upload-list__item-actions&quot;</span>&gt;</span></span><br><span class="line">          &lt;span</span><br><span class="line">            class=&quot;el-upload-list__item-preview&quot;</span><br><span class="line">            @click=&quot;_handlePictureCardPreview(file)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-zoom-in&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          &lt;span</span><br><span class="line">            class=&quot;el-upload-list__item-delete&quot;</span><br><span class="line">            @click=&quot;_handleRemove(file)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-delete&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;dialogVisible&quot;</span> <span class="attr">append-to-body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;dialogImageUrl&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    props: &#123;</span><br><span class="line">      id: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 用来区分同一个页面多个图片上传</span></span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">String</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="string">&#x27;license&#x27;</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">      limit: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">Number</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="number">3</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">      fileList: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">Array</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="function">() =&gt;</span> []</span></span><br><span class="line">      &#125;,</span><br><span class="line">      handleChange: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 文件改变</span></span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">Function</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="function">() =&gt;</span> &#123;&#125;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      handleRemove: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 删除文件</span></span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">Function</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="function">() =&gt;</span> &#123;&#125;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      refName: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">String</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        dialogImageUrl: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        dialogVisible: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">        fileLists: <span class="built_in">this</span>.fileList</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;&#125;,</span></span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">_handlePictureCardPreview</span>(<span class="params">file</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.dialogImageUrl = file.url;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.dialogVisible = <span class="literal">true</span>;</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">_handleExceed</span>(<span class="params">files, fileList</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$message.warning(</span></span><br><span class="line"><span class="javascript">          <span class="string">`当前限制选择 <span class="subst">$&#123;<span class="built_in">this</span>.limit&#125;</span> 个文件，本次选择了 <span class="subst">$&#123;</span></span></span></span><br><span class="line">            files.length</span><br><span class="line">          &#125; 个文件，共选择了 $&#123;files.length + fileList.length&#125; 个文件`</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">_handleChange</span>(<span class="params">file, fileList</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;handleChange&#x27;</span>, file, fileList, <span class="built_in">this</span>.id);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 移除图片</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">_handleRemove</span>(<span class="params">file</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;handleRemove&#x27;</span>, file, <span class="built_in">this</span>.id);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 将图片文件传回给父组件</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">submitFile</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;submitImg&#x27;</span>, <span class="built_in">this</span>.fileLists);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.el-icon-plus</span> &#123;</span></span><br><span class="line">    font-size: 30px !important;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.el-icon-edit</span> &#123;</span></span><br><span class="line">    font-size: 18px !important;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.el-icon-zoom-in</span> &#123;</span></span><br><span class="line">    font-size: 18px !important;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.el-icon-delete</span> &#123;</span></span><br><span class="line">    font-size: 18px !important;</span><br><span class="line">    color: rgb(243, 143, 130);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.el-input</span> &gt;&gt;&gt; <span class="selector-class">.el-textarea__inner</span> &#123;</span></span><br><span class="line">    font-size: 18px !important;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>UI</category>
        <category>element-ui</category>
      </categories>
      <tags>
        <tag>element-ui</tag>
      </tags>
  </entry>
  <entry>
    <title>小程序formId获取</title>
    <url>/posts/35316/</url>
    <content><![CDATA[<img src="/posts/35316/pushmessage.jpeg" class="" title="效果截图">

<h2 id="1-什么是-formId"><a href="#1-什么是-formId" class="headerlink" title="1. 什么是 formId"></a>1. 什么是 formId</h2><p><code>formId</code> 是小程序可以向用户发送模板消息的通行证，简单而言，你只有获取到 <code>formId</code>，把它交给后台，后台同学才能向用户发送通知消息，而这个通行证的有效期只有七天。这是微信为了防止小程序滥用通知消息骚扰用户而提出的一种策略。</p>
<h2 id="2-formId-的获取"><a href="#2-formId-的获取" class="headerlink" title="2. formId 的获取"></a>2. formId 的获取</h2><p>小程序的 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/template-message.html">模板消息文档</a> 中说，获取 <code>formId</code> 有以下两种途径：</p>
<ul>
<li>支付</li>
<li>提交表单</li>
</ul>
<p>用户支付一次，能获取 3 个 <code>formId</code>，用户提交表单一次可得到一个 <code>formId</code> 。如果小程序中没有支付行为，但又有需要向用户发送消息的需求，这个时候就只能依靠提交表单了。</p>
<h3 id="2-1-下发条件说明"><a href="#2-1-下发条件说明" class="headerlink" title="2. 1 下发条件说明"></a>2. 1 下发条件说明</h3><p>以下摘自 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/template-message.html#%E4%B8%8B%E5%8F%91%E6%9D%A1%E4%BB%B6%E8%AF%B4%E6%98%8E">模板消息文档 - 下发条件说明</a></p>
<h4 id="2-1-1-支付"><a href="#2-1-1-支付" class="headerlink" title="2.1.1 支付"></a>2.1.1 支付</h4><p>当用户在小程序内完成过支付行为，可允许开发者向用户在 7 天内推送有限条数的模板消息（1 次支付可下发 3 条，多次支付下发条数独立，互相不影响）</p>
<h4 id="2-1-2-提交表单"><a href="#2-1-2-提交表单" class="headerlink" title="2.1.2 提交表单"></a>2.1.2 提交表单</h4><p>当用户在小程序内发生过提交表单行为且该表单声明为要发模板消息的，开发者需要向用户提供服务时，可允许开发者向用户在 7 天内推送有限条数的模板消息（1 次提交表单可下发 1 条，多次提交下发条数独立，相互不影响）</p>
<h3 id="2-2-代码示例"><a href="#2-2-代码示例" class="headerlink" title="2.2 代码示例"></a>2.2 代码示例</h3><p>获取 <code>formId</code> 必须使用小程序/uni-app 的 <code>form</code> 组件，它本身有个属性叫 <code>report-submit</code> ，当在标签中加入这个属性时，一旦表单提交，<code>submit</code> 回调中就可以拿到 <code>formId</code> 了。</p>
<blockquote>
<p>html</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 微信小程序代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">bindsubmit</span>=<span class="string">&quot;formSubmit&quot;</span> <span class="attr">report-submit</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">formType</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- uni-app 代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> @<span class="attr">submit</span>=<span class="string">&quot;formSubmit&quot;</span> <span class="attr">:report-submit</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">form-type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交表单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  // formSubmit 为提交事件触发的自定义方法</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">formSubmit: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取表单id</span></span><br><span class="line">  <span class="keyword">const</span> formId = e.detail.formId;</span><br><span class="line">  <span class="comment">// 非真机运行时 formId 应该为 &#x27;the formId is a mock one&#x27;</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;表单id:&#x27;</span>, formId);</span><br><span class="line">  <span class="comment">// 获取后可通过异步请求将 formId 传递给后端</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>重要：</strong></p>
<p>在微信开发者工具中运行获取的 <code>formId</code> 为 <code>the formId is a mock one</code> ，要获得真实有效的 <code>formId</code> 需要在真机上运行。</p>
<h3 id="2-3-获取尽可能多的-formId"><a href="#2-3-获取尽可能多的-formId" class="headerlink" title="2.3 获取尽可能多的 formId"></a>2.3 获取尽可能多的 formId</h3><p>从运营的角度而言，<code>formId</code> 肯定是越多越好。所以每一个页面上用户的每一次点击我们都巴不得触发一次表单提交。哪怕从界面上讲，这次点击可能是跳转，弹窗的功能，跟表单完全无关，都要把 <code>button</code> 放在一个 <code>form</code> 中。但是这样无疑增加了前端的工作量，因为需要为每个页面的 <code>submit</code> 事件绑定一个上传 <code>formId</code> 的方法。一个可行的方法是借助 <code>vue</code> 的 <code>mixin</code>，为每一个页面实例混入一个上传 <code>formId</code> 的方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line">Vue.mixin(&#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">uploadFormId</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.req(&#123;</span><br><span class="line">        url: <span class="string">&#x27;/api/v1/formid?formId=&#x27;</span> + e.target.formId</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>另外一个方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_collectWeChatFormId</span>(<span class="params">formId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> token = wx.getStorageSync(<span class="string">&#x27;token_/cookies&#x27;</span>),</span><br><span class="line">    openId = wx.getStorageSync(<span class="string">&#x27;openid_cookies&#x27;</span>),</span><br><span class="line">    orign = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;formId&#x27;</span>, formId);</span><br><span class="line">  <span class="keyword">if</span> (formId == <span class="string">&#x27;the formId is a mock one&#x27;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`模拟器中运行！`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (formId.length == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`formId不能为空`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> site = <span class="string">&#x27;你的收集接口&#x27;</span>,</span><br><span class="line">    dates = &#123;</span><br><span class="line">      token: token,</span><br><span class="line">      openId: openId,</span><br><span class="line">      formId: formId,</span><br><span class="line">      orign: orign</span><br><span class="line">    &#125;,</span><br><span class="line">    md =</span><br><span class="line">      <span class="string">&#x27;token=&#x27;</span> +</span><br><span class="line">      token +</span><br><span class="line">      <span class="string">&#x27;&amp;openId=&#x27;</span> +</span><br><span class="line">      openId +</span><br><span class="line">      <span class="string">&#x27;&amp;formId=&#x27;</span> +</span><br><span class="line">      formId +</span><br><span class="line">      <span class="string">&#x27;&amp;orign=&#x27;</span> +</span><br><span class="line">      orign;</span><br><span class="line">  requestHttp(site, dates, md, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">    <span class="built_in">console</span>.log(res.data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-小程序模板消息接口更新"><a href="#3-小程序模板消息接口更新" class="headerlink" title="3. 小程序模板消息接口更新"></a>3. 小程序模板消息接口更新</h2><p>请注意，小程序模板消息接口将于 2020 年 1 月 10 日下线，开发者可使用<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html">订阅消息功能</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>移动端</category>
        <category>小程序</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
        <tag>小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>常见Shell命令</title>
    <url>/posts/54337/</url>
    <content><![CDATA[<h2 id="常见终端命令"><a href="#常见终端命令" class="headerlink" title="常见终端命令"></a>常见终端命令</h2><ul>
<li><pre><code>ls
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  \- 用来列出文件和目录</span><br><span class="line"></span><br><span class="line">  - &#96;ls -l&#96; 列出文件和目录（长列表形式，更详细）</span><br><span class="line">  - &#96;ls *.png&#96; 列出后缀为 png 的图像文件</span><br><span class="line"></span><br><span class="line">- &#96;mkdir&#96; - 用来新建目录</span><br><span class="line"></span><br><span class="line">- &#96;&#96;&#96;</span><br><span class="line">  mv</span><br></pre></td></tr></table></figure>

\- 移动文件

- `mv logo.png Project` 把 logo.png 文件移入 Project 文件夹
- `mv Document/*.png Project` 把 Document 文件夹下所有 .png 结尾文件扔进 Project 文件夹</code></pre>
</li>
<li><p><code>cd</code> - 用来更换当前目录</p>
</li>
<li><p><code>pwd</code> - 查看当前工作目录</p>
</li>
<li><p><code>rm</code> - 用来删除文件和目录</p>
</li>
<li><p><code>rmdir</code> - 用来删除目录</p>
</li>
<li><pre><code>cat</code></pre>
<p>- 查看文件内容（文件内容过多会直接定位到文件最底部）</p>
<ul>
<li><code>cat less</code> 只显示一屏高度的文件内容（按下 q 退出）</li>
</ul>
</li>
</ul>
<h3 id="less-分页器"><a href="#less-分页器" class="headerlink" title="less 分页器"></a>less 分页器</h3><ul>
<li>要<strong>向下</strong>滚动，按下</li>
<li><code>j</code> 或 <code>↓</code> 一次向下移动一行</li>
<li><code>d</code> 按照一半的屏幕幅面移动</li>
<li><code>f</code> 按照整个屏幕幅面移动</li>
<li>要 <strong>向上</strong>滚动，按上</li>
<li><code>k</code> 或 <code>↑</code> 一次向上移动一行</li>
<li><code>u</code> 按照一半的屏幕幅面移动</li>
<li><code>b</code> 按照整个屏幕幅面移动</li>
<li>按下 <code>q</code> 可以<strong>退出</strong>日志（返回普通的命令提示符）</li>
</ul>
]]></content>
      <categories>
        <category>后端</category>
        <category>脚本</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title>常见排序算法</title>
    <url>/posts/59937/</url>
    <content><![CDATA[<h2 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h2><p>冒泡排序是一种交换排序，基本思想是：两两比较相邻记录的关键字，如果反序则交换，直到没有反序的记录为止。</p>
<h3 id="算法步骤"><a href="#算法步骤" class="headerlink" title="算法步骤"></a>算法步骤</h3><ol>
<li>比较相邻的元素。如果第一个比第二个大，就交换他们两个。</li>
<li>对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对。这步做完后，最后的元素会是最大的数。</li>
<li>针对所有的元素重复以上的步骤，除了最后一个。</li>
<li>持续每次对越来越少的元素重复上面的步骤，直到没有任何一对数字需要比较。</li>
</ol>
<h3 id="动图演示"><a href="#动图演示" class="headerlink" title="动图演示"></a>动图演示</h3><img src="/posts/59937/%E5%86%92%E6%B3%A1.gif" class="" title="冒泡">

<a id="more"></a>

<p>———— 动图来自《菜鸟教程》</p>
<p>说明：绿色表示当前正在比较的两个相邻元素；橘黄色表示已排完序的元素，不再参与后续的比较</p>
<h3 id="代码实现（JS）"><a href="#代码实现（JS）" class="headerlink" title="代码实现（JS）"></a>代码实现（JS）</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">3</span>, <span class="number">44</span>, <span class="number">38</span>, <span class="number">5</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">36</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">2</span>, <span class="number">46</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">50</span>, <span class="number">48</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myBubbleSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = arr.length, temp;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; i++) &#123; <span class="comment">// 趟数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; len - <span class="number">1</span> - i; j++) &#123; <span class="comment">// 当前趟要比较的次数</span></span><br><span class="line">            <span class="keyword">if</span> (arr[j] &gt; arr[j+<span class="number">1</span>]) &#123;        <span class="comment">// 相邻元素两两比较</span></span><br><span class="line">                temp = arr[j];              <span class="comment">// 元素交换</span></span><br><span class="line">                arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">                arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码与图片配合食用更加~</p>
<img src="/posts/59937/%E5%86%92%E6%B3%A12.png" class="" title="冒泡2">

<hr>
<h2 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h2><p>选择排序是一种简单直观的排序算法，无论什么数据进去都是 O(n²) 的时间复杂度。所以用到它的时候，数据规模越小越好。唯一的好处可能就是不占用额外的内存空间了吧。</p>
<h3 id="算法步骤-1"><a href="#算法步骤-1" class="headerlink" title="算法步骤"></a>算法步骤</h3><ol>
<li>首先在未排序序列中找到最小（大）元素，存放到排序序列的起始位置。</li>
<li>再从剩余未排序元素中继续寻找最小（大）元素，然后放到已排序序列的末尾。</li>
<li>重复第2步，直到所有元素均排序完毕。</li>
</ol>
<h3 id="动图演示-1"><a href="#动图演示-1" class="headerlink" title="动图演示"></a>动图演示</h3><img src="/posts/59937/%E9%80%89%E6%8B%A9.gif" class="" title="选择">

<h3 id="代码实现（JS）-1"><a href="#代码实现（JS）-1" class="headerlink" title="代码实现（JS）"></a>代码实现（JS）</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">3</span>, <span class="number">44</span>, <span class="number">38</span>, <span class="number">5</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">36</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">2</span>, <span class="number">46</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">50</span>, <span class="number">48</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mySelectionSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = arr.length;</span><br><span class="line">    <span class="keyword">var</span> minIndex, temp;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; i++) &#123;       <span class="comment">// 第 i 轮选择</span></span><br><span class="line">        minIndex = i;                         <span class="comment">// 每轮开始假设起始元素为最小值</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = i + <span class="number">1</span>; j &lt; len; j++) &#123;   <span class="comment">// 遍历剩余未排序元素</span></span><br><span class="line">            <span class="keyword">if</span> (arr[j] &lt; arr[minIndex]) &#123;     <span class="comment">// 寻找最小的数</span></span><br><span class="line">                minIndex = j;                 <span class="comment">// 将最小数的索引保存</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        temp = arr[i];                         <span class="comment">// 交换起始元素与真正的最小值</span></span><br><span class="line">        arr[i] = arr[minIndex];</span><br><span class="line">        arr[minIndex] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配图：</p>
<img src="/posts/59937/%E9%80%89%E6%8B%A92.png" class="" title="选择2">

<hr>
<h2 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h2><p>插入排序的原理应该是最容易理解的，因为只要你打过扑克牌就应该能秒懂。插入排序是一种最简单直观的排序算法，它的工作原理是通过构建有序序列，对于未排序数据，在已排序序列中从后向前扫描，找到相应位置并插入。</p>
<h3 id="算法步骤-2"><a href="#算法步骤-2" class="headerlink" title="算法步骤"></a>算法步骤</h3><ol>
<li>从第一个元素开始，该元素可以认为已经被排序；</li>
<li>取出下一个元素，在已经排序的元素序列中从后向前扫描；</li>
<li>如果该元素（已排序）大于新元素，将该元素移到下一位置；</li>
<li>重复步骤3，直到找到已排序的元素小于或者等于新元素的位置；</li>
<li>将新元素插入到该位置后；</li>
<li>重复步骤2~5。</li>
</ol>
<h3 id="动图演示-2"><a href="#动图演示-2" class="headerlink" title="动图演示"></a>动图演示</h3><img src="/posts/59937/%E6%8F%92%E5%85%A5.gif" class="" title="插入">

<h3 id="代码实现（JS）-2"><a href="#代码实现（JS）-2" class="headerlink" title="代码实现（JS）"></a>代码实现（JS）</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">3</span>, <span class="number">44</span>, <span class="number">38</span>, <span class="number">5</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">36</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">2</span>, <span class="number">46</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">50</span>, <span class="number">48</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myInsertSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = arr.length;</span><br><span class="line">    <span class="keyword">var</span> insertItem; <span class="comment">// 要插入的元素</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从数组的第二个元素开始循环将数组中的元素插入</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">        insertItem = arr[i]; <span class="comment">// 设置数组中的第2个元素为第一次遍历要插入的数据</span></span><br><span class="line">        <span class="keyword">var</span> j = i - <span class="number">1</span>;       <span class="comment">// 已排序好数组的最后一个元素的索引</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将已排好序的元素从最后一个往前依次与待插入元素比较，</span></span><br><span class="line">        <span class="keyword">while</span> (j &gt;= <span class="number">0</span> &amp;&amp; insertItem &lt; arr[j]) &#123;</span><br><span class="line">            <span class="comment">// 如果要插入的元素小于第j个元素,就将第j个元素向后移动</span></span><br><span class="line">            arr[j + <span class="number">1</span>] = arr[j];</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 直到要插入的元素不小于第j个元素,将insertNote插入到数组中</span></span><br><span class="line">        arr[j + <span class="number">1</span>] = insertItem;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 例如for循环中 i 等于 2 时，已排序完毕的元素为[3,44]，进入for循环</span></span><br><span class="line">    <span class="comment">// 待插入元素为 arr[2]，也就是38;</span></span><br><span class="line">    <span class="comment">// j=i-1也就是2-1等于1</span></span><br><span class="line">    <span class="comment">// while循环比较，待插入元素38是小于arr[j]（j=1）44 的 =&gt; 条件成立</span></span><br><span class="line">        <span class="comment">// arr[j+1]要等于arr[j] =&gt; arr[2]要等于arr[1] =&gt; arr[2]=44 =&gt; 此刻数组前三个元素：[3,44,44]</span></span><br><span class="line">        <span class="comment">// j-- =&gt; j=1-1也就是0</span></span><br><span class="line">    <span class="comment">// 再来一轮while比较，待插入元素38现在不小于arr[j] 也就是arr[0]的3，所以直接退出while循环</span></span><br><span class="line">    <span class="comment">// arr[j+1]=insertItem =&gt; arr[1]=38 =&gt; 数组前三排序完毕：[3,38,44]</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h2><p>希尔排序也是一种插入排序，它是简单插入排序的一个改进版，也称为缩小增量排序，同时该算法是冲破O(n2）的第一批算法之一。本文会以图解的方式详细介绍希尔排序的基本思想及其代码实现。</p>
<p>希尔排序是把记录按下标的一定增量分组，对每组使用直接插入排序算法排序；随着增量逐渐减少，每组包含的关键词越来越多，当增量减至1时，整个文件恰被分成一组，算法便终止。</p>
<h3 id="算法步骤-示例"><a href="#算法步骤-示例" class="headerlink" title="算法步骤(示例)"></a>算法步骤(示例)</h3><p>在此我们选择增量 <code>gap=数组长度length/2</code>，缩小增量继续以 <code>gap = gap/2</code> 的方式，这种增量选择我们可以用一个序列来表示：<code>&#123;n/2,(n/2)/2...1&#125;</code>，称为增量序列。当然，希尔排序的增量序列有很多种，这里采用的是比较常用的一种作为示例：</p>
<img src="/posts/59937/%E5%B8%8C%E5%B0%94.png" class="" title="希尔排序">

<p>在上面这幅图中：</p>
<p>初始时，有一个大小为 10 的无序序列。</p>
<p>在第一趟排序中，我们设 gap1 = 10 / 2 = 5，即相隔距离为 5 的元素组成一组，可以分为 5 组。接下来，按照直接插入排序的方法对每个组进行排序。</p>
<p>在第二趟排序中，我们把上次的 gap 缩小一半，即 gap2 = gap1 / 2 = 2 (取整)。这样每相隔距离为 2 的元素组成一组，可以分为 2 组。按照直接插入排序的方法对每个组进行排序。</p>
<p>在第三趟排序中，再次把 gap 缩小一半，即gap3 = gap2 / 2 = 1。 这样相隔距离为 1 的元素组成一组，即只有一组。按照直接插入排序的方法对每个组进行排序。此时，排序已经结束。</p>
<p><strong>注意</strong>：图中有两个相等数值的元素 5 和 5 。我们可以清楚的看到，在排序过程中，两个元素位置交换了。<br>所以，希尔排序是不稳定的算法。</p>
<h3 id="代码演示（JS）"><a href="#代码演示（JS）" class="headerlink" title="代码演示（JS）"></a>代码演示（JS）</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">3</span>, <span class="number">44</span>, <span class="number">38</span>, <span class="number">5</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">36</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">2</span>, <span class="number">46</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">50</span>, <span class="number">48</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myShellSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> gap = <span class="built_in">Math</span>.floor(arr.length / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span> &lt;= gap) &#123;</span><br><span class="line">        <span class="comment">// 把距离为 gap 的元素编为一个组，扫描所有组</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = gap; i &lt; arr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> j = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">var</span> temp = arr[i];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 对距离为 gap 的元素组进行排序</span></span><br><span class="line">            <span class="keyword">for</span> (j = i - gap; j &gt;= <span class="number">0</span> &amp;&amp; temp &lt; arr[j]; j = j - gap) &#123;</span><br><span class="line">                arr[j + gap] = arr[j];</span><br><span class="line">            &#125;</span><br><span class="line">            arr[j + gap] = temp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`gap = <span class="subst">$&#123;gap&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(arr);</span><br><span class="line">        gap = <span class="built_in">Math</span>.floor(gap / <span class="number">2</span>); <span class="comment">// 减小增量</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h2><p>归并排序是利用归并的思想实现的排序方法，该算法采用经典的分治策略（分治法将问题分成一些小的问题然后递归求解，而治的阶段则将分的阶段得到的各答案”修补”在一起，即分而治之)。</p>
<img src="/posts/59937/%E5%BD%92%E5%B9%B6.png" class="" title="分而治之">

<p>可以看到这种结构很像一棵完全二叉树，下面的归并排序代码将会采用递归去实现（你也可采用迭代的方式去实现）。<strong>分</strong>阶段可以理解为就是递归拆分子序列的过程，递归深度为logn。</p>
<h3 id="算法步骤-3"><a href="#算法步骤-3" class="headerlink" title="算法步骤"></a>算法步骤</h3><ol>
<li>申请空间，使其大小为两个已经排序序列之和，该空间用来存放合并后的序列</li>
<li>设定两个指针，最初位置分别为两个已经排序序列的起始位置</li>
<li>比较两个指针所指向的元素，选择相对小的元素放入到合并空间，并移动指针到下一位置</li>
<li>重复步骤 3 直到某一指针达到序列尾</li>
<li>将另一序列剩下的所有元素直接复制到合并序列尾</li>
</ol>
<h3 id="图片演示"><a href="#图片演示" class="headerlink" title="图片演示"></a>图片演示</h3><img src="/posts/59937/%E5%BD%92%E5%B9%B62.png" class="" title="归并排序">

<p>图片来自博客<a href="https://www.cnblogs.com/chengxiao/p/6194356.html">《图解排序算法之归并排序》</a></p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">3</span>, <span class="number">44</span>, <span class="number">38</span>, <span class="number">5</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">36</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">2</span>, <span class="number">46</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">50</span>, <span class="number">48</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergeSort</span>(<span class="params">arr</span>) </span>&#123; <span class="comment">// 采用自上而下的递归方法</span></span><br><span class="line">    <span class="keyword">var</span> len = arr.length;</span><br><span class="line">    <span class="keyword">if</span> (len &lt; <span class="number">2</span>) <span class="keyword">return</span> arr;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">var</span> middle = <span class="built_in">Math</span>.floor(len / <span class="number">2</span>), <span class="comment">// 将未排序数组拆分成两半分而治之</span></span><br><span class="line">        left = arr.slice(<span class="number">0</span>, middle),</span><br><span class="line">        right = arr.slice(middle);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> merge(mergeSort(left), mergeSort(right));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params">left, right</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (left.length &amp;&amp; right.length) &#123;</span><br><span class="line">      	<span class="comment">// 两边的起始元素相互比较，始终将小的一方的头元素弹出，并push到准备好的容器result中</span></span><br><span class="line">        <span class="keyword">if</span> (left[<span class="number">0</span>] &lt;= right[<span class="number">0</span>]) &#123;</span><br><span class="line">            result.push(left.shift());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result.push(right.shift());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (left.length)</span><br><span class="line">        result.push(left.shift());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (right.length)</span><br><span class="line">        result.push(right.shift());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h2><p>快速排序的基本思想是：通过一趟排序将待排记录分割成独立的两部分，其中一部分记录的元素均比另一部分记录的元素小，继而再分别对这两部分记录递归的进行同样的排序操作。</p>
<h3 id="算法步骤-4"><a href="#算法步骤-4" class="headerlink" title="算法步骤"></a>算法步骤</h3><ol>
<li>把数组中第一个元素当做一个基准值，称为“基准”（Pivot）</li>
</ol>
<img src="/posts/59937/%E5%BF%AB%E6%8E%92.png" class="" title="快排">

<ol>
<li>重新排序数列，把所有比基准值小的元素摆放在基准前面，所有比基准值大元素摆放在基准后面。在这个分区退出之后，该基准就处于数列的中间位置。这个称为分区（partition）操作；</li>
</ol>
<img src="/posts/59937/%E5%BF%AB%E6%8E%922.png" class="" title="快排2">

<img src="/posts/59937/%E5%BF%AB%E6%8E%923.png" class="" title="快排3">

<ol>
<li>递归地把小于基准值元素的子数列和大于基准值元素的子数列排序；</li>
</ol>
<img src="/posts/59937/%E5%BF%AB%E6%8E%924.png" class="" title="快排4">

<h3 id="分区（Partition）思路"><a href="#分区（Partition）思路" class="headerlink" title="分区（Partition）思路"></a>分区（Partition）思路</h3><p>首先把未排序数组的第一个（最左边）元素设置为基准，把它的位置叫做 <code>l</code> ：</p>
<img src="/posts/59937/%E5%BF%AB%E6%8E%925.png" class="" title="快排5">

<p>然后依次向后查看所有元素，在查看过程中，不断的调整后面元素的位置，使得后面的元素分为两部分，一部分都小于 v ；一部分都大于 v 。</p>
<p>我们用 <code>j</code> 来不断记录这两部分的分割线位置。而 e 就是我们要判断的下一个元素，用索引 <code>i</code> 来表示，<code>i</code> 会遍历每一个元素，来看该如何调整这个元素。</p>
<p>在下图中，我们用 <code>arr[l+1 ... j]</code> 来表示小于 v 的橙色部分，用 <code>arr[j+1 ... i-1]</code> 来表示大于 v 的紫色部分。</p>
<img src="/posts/59937/%E5%BF%AB%E6%8E%926.png" class="" title="快排6">

<p>接下来就要看如何来调整下一个元素 e 的位置。分情况讨论：</p>
<p><strong>当 e 大于 v 时</strong>，我们直接让 e 融入大于 v 的部分，并让 <code>i++</code></p>
<img src="/posts/59937/%E5%BF%AB%E6%8E%927.png" class="" title="快排7">

<img src="/posts/59937/%E5%BF%AB%E6%8E%928.png" class="" title="快排8">


<p><strong>当 e 小于 v 时</strong>，我们让 e 和大于 v 部分的第一个元素交换位置。</p>
<img src="/posts/59937/%E5%BF%AB%E6%8E%929.png" class="" title="快排9">

<img src="/posts/59937/%E5%BF%AB%E6%8E%9210.png" class="" title="快排10">

<p>把 e 融入到小于 v 的部分。此时就需要让分隔线的索引位置 <code>j++</code> ，相应的，索引 <code>i</code> 的位置也要 <code>i++</code> 以便查看下一个元素。</p>
<img src="/posts/59937/%E5%BF%AB%E6%8E%9211.png" class="" title="快排11">

<img src="/posts/59937/%E5%BF%AB%E6%8E%9212.png" class="" title="快排12">

<p>以这样的步骤我们就能遍历完整个数组，如下图所示</p>
<img src="/posts/59937/%E5%BF%AB%E6%8E%9213.png" class="" title="快排13">


<p>现在还差最后一个步骤，那就是把基准值 v ，与小于 v 部分的最后一个元素交换位置。此刻 v 左边都小于它，v 右边都大于它，而 <code>j</code> 指向的就是基准值所在的位置。这样我们就完成了分区（Partition）操作。</p>
<img src="/posts/59937/%E5%BF%AB%E6%8E%9214.png" class="" title="快排14">

<h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">3</span>, <span class="number">44</span>, <span class="number">38</span>, <span class="number">5</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">36</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">2</span>, <span class="number">46</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">50</span>, <span class="number">48</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">quickSort</span>(<span class="params">arr, left, right</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = arr.length,</span><br><span class="line">        partitionIndex,         <span class="comment">// 分区索引</span></span><br><span class="line">        left = <span class="keyword">typeof</span> left != <span class="string">&#x27;number&#x27;</span> ? <span class="number">0</span> : left,</span><br><span class="line">        right = <span class="keyword">typeof</span> right != <span class="string">&#x27;number&#x27;</span> ? len - <span class="number">1</span> : right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (left &gt;= right) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过分区找到分隔点，再分别快排左右两部分</span></span><br><span class="line">    partitionIndex = partition(arr, left, right);</span><br><span class="line">    quickSort(arr, left, partitionIndex - <span class="number">1</span>);</span><br><span class="line">    quickSort(arr, partitionIndex + <span class="number">1</span>, right);</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">partition</span>(<span class="params">arr, left, right</span>) </span>&#123; <span class="comment">// 分区操作</span></span><br><span class="line">    <span class="keyword">var</span> v = left,   <span class="comment">// 设定基准值（pivot）</span></span><br><span class="line">        j = left;  <span class="comment">// arr[l+1...j] ; arr[j+1...i]</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = j + <span class="number">1</span>; i &lt;= right; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &lt; arr[v]) &#123; <span class="comment">// 当前要判断元素 小于 基准元素时</span></span><br><span class="line">            j++; <span class="comment">// 分隔点右移</span></span><br><span class="line">            swap(arr, i, j);   <span class="comment">// 让 当前元素 与大于 v 部分的第一个元素交换位置</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 此处不用写 else ，因为当大于基准元素时，直接i++就好，</span></span><br><span class="line">        <span class="comment">// 而i++，for循环已经帮我们做了</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 循环完毕后，交换基准值和小于v部分的最后一个元素的位置</span></span><br><span class="line">    swap(arr, v, j);</span><br><span class="line">    <span class="keyword">return</span> j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">swap</span>(<span class="params">arr, i, j</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> temp = arr[i];</span><br><span class="line">    arr[i] = arr[j];</span><br><span class="line">    arr[j] = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(quickSort(arr, <span class="number">0</span>, arr.length));</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="计数排序"><a href="#计数排序" class="headerlink" title="计数排序"></a>计数排序</h2><p>计数排序不是基于比较的排序算法，其核心在于将输入的数据值转化为键存储在额外开辟的数组空间中。 作为一种线性时间复杂度的排序，计数排序要求输入的数据必须是有确定范围的整数。</p>
<h3 id="算法步骤-5"><a href="#算法步骤-5" class="headerlink" title="算法步骤"></a>算法步骤</h3><ol>
<li>找出待排序的数组中最大和最小的元素；</li>
<li>统计数组中每个值为 i 的元素出现的次数，存入数组 Count 的第 i 项；</li>
<li>对所有的计数累加（从 Count 中的第一个元素开始，每一项和前一项相加）；</li>
<li>反向填充目标数组：将每个元素 i 放在新数组的第 Count(i) 项，每放一个元素就将 Count(i) 减去1。</li>
</ol>
<h3 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">3</span>, <span class="number">44</span>, <span class="number">38</span>, <span class="number">5</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">36</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">2</span>, <span class="number">46</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">50</span>, <span class="number">48</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">countingSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = arr.length,</span><br><span class="line">        Result = [],</span><br><span class="line">        Count = [],</span><br><span class="line">        min = max = arr[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查找最大最小值,并将arr数置入Count数组中,统计出现次数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        min = min &lt;= arr[i] ? min : arr[i];</span><br><span class="line">        max = max &gt;= arr[i] ? max : arr[i];</span><br><span class="line">        Count[arr[i]] = Count[arr[i]] ? Count[arr[i]] + <span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从最小值-&gt;最大值,将计数逐项相加</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = min; j &lt; max; j++) &#123;</span><br><span class="line">        Count[j + <span class="number">1</span>] = (Count[j + <span class="number">1</span>] || <span class="number">0</span>) + (Count[j] || <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Count中,下标为arr数值,数据为arr数值出现次数;反向填充数据进入Result数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> k = len - <span class="number">1</span>; k &gt;= <span class="number">0</span>; k--) &#123;</span><br><span class="line">        <span class="comment">// Result[位置] = arr数据</span></span><br><span class="line">        Result[Count[arr[k]] - <span class="number">1</span>] = arr[k];</span><br><span class="line">        <span class="comment">// 减少Count数组中保存的计数</span></span><br><span class="line">        Count[arr[k]]--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(countingSort(arr));</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>后端</category>
        <category>算法</category>
      </categories>
  </entry>
  <entry>
    <title>转载-常见正则表达式合集</title>
    <url>/posts/40424/</url>
    <content><![CDATA[<p>转载自：<a href="http://obkoro1.com/web_accumulate/codeBlack/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%94%B6%E9%9B%86.html#%E5%B8%B8%E8%A7%81%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%90%88%E9%9B%86">常见正则表达式合集</a></p>
<p>为了避免用户胡乱输入就通过验证，很多时候我们都会采用正则表达式来验证一下用户输入的信息是否符合规范。这部分的内容基本上是在网上收集来的，这里跟大家一起分享一下，有需要的可以记在自己的有道云笔记里面。</p>
<a id="more"></a>

<h3 id="如何验证？"><a href="#如何验证？" class="headerlink" title="如何验证？"></a>如何验证？</h3><p>验证的方式当然是很多了，这里推荐采用<a href="http://www.w3school.com.cn/js/jsref_test_regexp.asp">test()</a>方法来验证。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue = RegExpObject.test(string);<span class="comment">// RegExpObject为正则 string是要检测的字符串</span></span><br><span class="line"><span class="comment">// 如果字符串 string 中含有与 RegExpObject 匹配的文本，则返回 true，否则返回 false。</span></span><br><span class="line"><span class="keyword">if</span> (isTrue)&#123;</span><br><span class="line">    <span class="comment">//验证成功 do something</span></span><br><span class="line">&#125;elseP&#123;</span><br><span class="line">    <span class="comment">//验证失败</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="身份证号码正则表达式："><a href="#身份证号码正则表达式：" class="headerlink" title="身份证号码正则表达式："></a>身份证号码正则表达式：</h3><p>第一代身份证只有 15 位数，第二代身份证有 18 位数，各位按照需求来选择表达式。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第二代身份证号码正则</span></span><br><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/^[1-9]\d&#123;5&#125;(18|19|20)\d&#123;2&#125;((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d&#123;3&#125;[0-9Xx]$/</span>;</span><br><span class="line"><span class="comment">//第一代身份证正则表达式(15位)</span></span><br><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/^[1-9]\d&#123;7&#125;((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d&#123;3&#125;$/</span>;</span><br></pre></td></tr></table></figure>

<h3 id="手机号码正则表达式："><a href="#手机号码正则表达式：" class="headerlink" title="手机号码正则表达式："></a>手机号码正则表达式：</h3><p>时间截止为：2018 年 1 月 11 日</p>
<ul>
<li>移动号段：134 135 136 137 138 139 147 148 150 151 152 157 158 159 172 178 182 183 184 187 188 198</li>
<li>联通号段：130 131 132 145 146 155 156 166 171 175 176 185 186</li>
<li>电信号段：133 149 153 173 174 177 180 181 189 199</li>
<li>虚拟运营商：170</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/^(13[0-9]|14[5-9]|15[012356789]|166|17[0-8]|18[0-9]|19[8-9])[0-9]&#123;8&#125;$/</span>;</span><br></pre></td></tr></table></figure>

<h3 id="邮箱正则表达式："><a href="#邮箱正则表达式：" class="headerlink" title="邮箱正则表达式："></a>邮箱正则表达式：</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/^([A-Za-z0-9_\-\.\u4e00-\u9fa5])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]&#123;2,8&#125;)$/</span>;</span><br></pre></td></tr></table></figure>

<h3 id="用户名正则"><a href="#用户名正则" class="headerlink" title="用户名正则:"></a>用户名正则:</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//用户名正则，4到16位（字母，数字，下划线，减号）</span></span><br><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/^[a-zA-Z0-9_-]&#123;4,16&#125;$/</span>;</span><br></pre></td></tr></table></figure>

<h3 id="密码正则"><a href="#密码正则" class="headerlink" title="密码正则:"></a>密码正则:</h3><p>密码正则，以字母开头，长度在 6~18 之间，只能包含字母、数字和下划线</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue =^[a-zA-Z]\w&#123;<span class="number">5</span>,<span class="number">17</span>&#125;$;</span><br></pre></td></tr></table></figure>

<p>强密码正则，最少 6 位，包括至少 1 个大写字母，1 个小写字母，1 个数字，1 个特殊字符</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/^.*(?=.&#123;6,&#125;)(?=.*\d)(?=.*[A-Z])(?=.*[a-z])(?=.*[!@#$%^&amp;*? ]).*$/</span>;</span><br></pre></td></tr></table></figure>

<h3 id="QQ-号码正则"><a href="#QQ-号码正则" class="headerlink" title="QQ 号码正则:"></a>QQ 号码正则:</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/^[1-9][0-9]&#123;4,10&#125;$/</span>;</span><br></pre></td></tr></table></figure>

<h3 id="微信号码正则"><a href="#微信号码正则" class="headerlink" title="微信号码正则:"></a>微信号码正则:</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//微信号正则，6至20位，以字母开头，字母，数字，减号，下划线</span></span><br><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/^[a-zA-Z]([-_a-zA-Z0-9]&#123;5,19&#125;)+$/</span>;</span><br></pre></td></tr></table></figure>

<h3 id="特殊字符检测正则"><a href="#特殊字符检测正则" class="headerlink" title="特殊字符检测正则:"></a>特殊字符检测正则:</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/[&quot;&#x27;&lt;&gt;%;)(&amp;+]+-!！@#$~/</span>;</span><br></pre></td></tr></table></figure>

<h3 id="域名正则"><a href="#域名正则" class="headerlink" title="域名正则:"></a>域名正则:</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue=[a-zA-Z0-<span class="number">9</span>][-a-zA-Z0-<span class="number">9</span>]&#123;<span class="number">0</span>,<span class="number">62</span>&#125;(<span class="regexp">/.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+/</span>.?;</span><br></pre></td></tr></table></figure>

<h3 id="车牌号码正则"><a href="#车牌号码正则" class="headerlink" title="车牌号码正则:"></a>车牌号码正则:</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]&#123;1&#125;[A-Z]&#123;1&#125;[A-Z0-9]&#123;4&#125;[A-Z0-9挂学警港澳]&#123;1&#125;$/</span>;</span><br></pre></td></tr></table></figure>

<h3 id="包含中文正则"><a href="#包含中文正则" class="headerlink" title="包含中文正则:"></a>包含中文正则:</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/[\u4E00-\u9FA5]/</span>;</span><br><span class="line"><span class="comment">//这个可以用于验证用户的真实姓名。</span></span><br></pre></td></tr></table></figure>

<h3 id="护照正则"><a href="#护照正则" class="headerlink" title="护照正则:"></a>护照正则:</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/^(P\d&#123;7&#125;|G\d&#123;7,8&#125;|TH\d&#123;7,8&#125;|S\d&#123;7,8&#125;|A\d&#123;7,8&#125;|L\d&#123;7,8&#125;|\d&#123;9&#125;|D\d+|1[4,5]\d&#123;7&#125;)$/</span>;</span><br></pre></td></tr></table></figure>

<h3 id="固定电话正则："><a href="#固定电话正则：" class="headerlink" title="固定电话正则："></a>固定电话正则：</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue=(\(\d&#123;<span class="number">3</span>,<span class="number">4</span>&#125;\)|\d&#123;<span class="number">3</span>,<span class="number">4</span>&#125;-|\s)?\d&#123;<span class="number">8</span>&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="IP-地址正则"><a href="#IP-地址正则" class="headerlink" title="IP 地址正则:"></a>IP 地址正则:</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue=\d+\.\d+\.\d+\.\d+;</span><br></pre></td></tr></table></figure>

<h3 id="邮政编码正则"><a href="#邮政编码正则" class="headerlink" title="邮政编码正则:"></a>邮政编码正则:</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue=[<span class="number">1</span>-<span class="number">9</span>]&#123;<span class="number">1</span>&#125;(\d+)&#123;<span class="number">5</span>&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="经纬度正则"><a href="#经纬度正则" class="headerlink" title="经纬度正则:"></a>经纬度正则:</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//经度正则</span></span><br><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/^(\-|\+)?(((\d|[1-9]\d|1[0-7]\d|0&#123;1,3&#125;)\.\d&#123;0,6&#125;)|(\d|[1-9]\d|1[0-7]\d|0&#123;1,3&#125;)|180\.0&#123;0,6&#125;|180)$/</span>;</span><br><span class="line"><span class="comment">//纬度正则</span></span><br><span class="line"><span class="keyword">let</span> isTrue = <span class="regexp">/^(\-|\+)?([0-8]?\d&#123;1&#125;\.\d&#123;0,6&#125;|90\.0&#123;0,6&#125;|[0-8]?\d&#123;1&#125;|90)$/</span>;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>正则</category>
      </categories>
      <tags>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>微信web开发者工具input，button按钮偏移</title>
    <url>/posts/40884/</url>
    <content><![CDATA[<p>使用微信 web 开发者工具开发时有时会发现如图，明明 input 框和 button 框在下面，但只有点击箭头位置时才能有效果</p>
<img src="/posts/40884/huanghelou.png" class="" title="huanghelou">

<p>解决方法：</p>
<p>在排除样式上的错误的情况下：这是因为高分屏 win10 的显示设置默认是 125%，只需调整为 100%即可：</p>
<img src="/posts/40884/win10%E5%88%86%E8%BE%A8%E7%8E%87%E8%B0%83%E6%95%B4.png" class="" title="分辨率调整">
]]></content>
      <categories>
        <category>前端</category>
        <category>移动端</category>
        <category>微信开发</category>
      </categories>
      <tags>
        <tag>微信开发</tag>
      </tags>
  </entry>
  <entry>
    <title>微信小程序Image图片实现宽度100%，高度自适应</title>
    <url>/posts/1126/</url>
    <content><![CDATA[<p>做法如下：</p>
<p>样式设置宽度 100%：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加属性 mode=”widthFix”：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;img&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/static/images/hello.png&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>移动端</category>
        <category>小程序</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
        <tag>小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>微信小程序canvas绘制的图片真机不显示</title>
    <url>/posts/13054/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>公司小程序项目有个页面需要用 canvas 绘制图片保存，其中图片资源是从后端获取的网络图片。然而在测试中发现，模拟器上图片能正常绘制，但真机只有开了调试模式才能显示图片，一旦关闭调试模式后，canvas 就空白一片，啥都看不见。</p>
<a id="more"></a>

<h2 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h2><p>一开始简单 google 下，都说是因为图片得下载到本地，获取临时路径后才能绘制。然而我就是这么做的，所以此路不通。最后阅读 <a href="https://developers.weixin.qq.com/community/develop/doc/0002c0cddf05c81490a6649cf51c00">这篇文章</a> 后才明白问题出在哪儿。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>首先检查你的网络图片地址的域名在不在微信白名单内，这个可以在「微信公众平台-小程序」中配置，此处不表。重点是在绘制 canvas 时，得先下载这张网络图片到本地，所以还得在「微信公众平台-小程序」中的「服务器配置-downloadFile」合法域名中配置你网络图片的域名：</p>
<img src="/posts/13054/%E6%9C%8D%E5%8A%A1%E5%99%A8download%E5%9F%9F%E5%90%8D%E8%AE%BE%E7%BD%AE.png" class="" title="服务器download域名设置">

<p>完…</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>移动端</category>
        <category>小程序</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
        <tag>解决方案</tag>
        <tag>小程序</tag>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>微信小程序热更新</title>
    <url>/posts/15012/</url>
    <content><![CDATA[<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 及时更新微信小程序</span></span><br><span class="line"><span class="function"><span class="title">updateWxApp</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> updateManager = uni.getUpdateManager();</span><br><span class="line">  updateManager.onCheckForUpdate(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 请求完新版本信息的回调</span></span><br><span class="line">    <span class="keyword">if</span> (res.hasUpdate) &#123;</span><br><span class="line">      updateManager.onUpdateReady(<span class="function"><span class="keyword">function</span>(<span class="params">res2</span>) </span>&#123;</span><br><span class="line">        uni.showModal(&#123;</span><br><span class="line">          title: <span class="string">&#x27;更新提示&#x27;</span>,</span><br><span class="line">          content: <span class="string">&#x27;发现新版本，是否重启应用?&#x27;</span>,</span><br><span class="line">          cancelColor: <span class="string">&#x27;#eeeeee&#x27;</span>,</span><br><span class="line">          confirmColor: <span class="string">&#x27;#FF0000&#x27;</span>,</span><br><span class="line">          <span class="function"><span class="title">success</span>(<span class="params">res2</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (res2.confirm) &#123;</span><br><span class="line">              <span class="comment">// 新的版本已经下载好，调用 applyUpdate 应用新版本并重启</span></span><br><span class="line">              updateManager.applyUpdate();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  updateManager.onUpdateFailed(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 新的版本下载失败</span></span><br><span class="line">    uni.showModal(&#123;</span><br><span class="line">      title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">      content: <span class="string">&#x27;检查到有新版本，但下载失败，请检查网络设置&#x27;</span>,</span><br><span class="line">      <span class="function"><span class="title">success</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.confirm) &#123;</span><br><span class="line">          <span class="comment">// 新的版本已经下载好，调用 applyUpdate 应用新版本并重启</span></span><br><span class="line">          updateManager.applyUpdate();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/15012/%E5%BE%AE%E4%BF%A1%E7%83%AD%E6%9B%B4%E6%96%B0.png" class="" title="微信热更新">

<p>uniapp 小程序更新: <a href="https://uniapp.dcloud.io/api/other/update">https://uniapp.dcloud.io/api/other/update</a></p>
<p>模拟热更新 ：<a href="https://jingyan.baidu.com/article/624e7459f4103674e8ba5acb.html">https://jingyan.baidu.com/article/624e7459f4103674e8ba5acb.html</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>移动端</category>
        <category>小程序</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
        <tag>小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>扩展(spread)和剩余(rest)操作符</title>
    <url>/posts/56177/</url>
    <content><![CDATA[<p>转载自：<a href="https://github.com/coffe1891/frontend-hard-mode-interview/blob/master/1/1.2.12.md">https://github.com/coffe1891/frontend-hard-mode-interview/blob/master/1/1.2.12.md</a></p>
<h2 id="spread-和-rest-的区别"><a href="#spread-和-rest-的区别" class="headerlink" title="spread 和 rest 的区别"></a>spread 和 rest 的区别</h2><p>spread 和 rest 运算符都是<code>...</code>+<code>变量/参数</code>的形式。是 spread 还是 rest，要根据上下文情境来判断。</p>
<h3 id="1-spread"><a href="#1-spread" class="headerlink" title="1.spread"></a>1.spread</h3><p>当被用于迭代器中时，它是 spread 操作符：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>, ...[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="number">5</span>);</span><br><span class="line"><span class="comment">// 1 2 3 4 5</span></span><br><span class="line"><span class="built_in">console</span>.log([<span class="number">1</span>, ...[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="number">5</span>]);</span><br><span class="line"><span class="comment">//[1,2,3,4,5]</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> numbers = [<span class="number">4</span>, <span class="number">38</span>];</span><br><span class="line">add(...numbers); <span class="comment">// 42</span></span><br></pre></td></tr></table></figure>

<p>spread 主要形式是<code>...[Array]</code>，表示对数组的展开。</p>
<a id="more"></a>

<h3 id="2-rest"><a href="#2-rest" class="headerlink" title="2.rest"></a>2.rest</h3><p>当被用于定义函数的参数时，是 rest 操作符：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">push</span>(<span class="params">...items</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(items);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">4</span>;</span><br><span class="line">push(a, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="comment">//[4,1,2,3]</span></span><br></pre></td></tr></table></figure>

<p>rest 主要是将函数的多个参数转化成数组，<strong>而且只能放在函数参数的最后一个位置</strong>，否则，比如<code>（array,...items,other）</code>会报错。</p>
<p>而 rest 的出现，让已经不被推荐使用的<code>arguments</code>彻底寿终正寝了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(args.join());</span><br><span class="line">  <span class="built_in">console</span>.log([...arguments].join()); <span class="comment">//spread形式的用法</span></span><br><span class="line">&#125;)([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="comment">//&gt;&gt; 1,2,3</span></span><br><span class="line"><span class="comment">//&gt;&gt; 1,2,3</span></span><br></pre></td></tr></table></figure>

<h2 id="用法示例"><a href="#用法示例" class="headerlink" title="用法示例"></a>用法示例</h2><h3 id="1-添加属性"><a href="#1-添加属性" class="headerlink" title="1.添加属性"></a>1.添加属性</h3><p>克隆一个对象，同时向(浅)拷贝对象添加附加属性。<br>在这个示例中，user 被(浅)拷贝，password 属性被添加到 userWithPass 中。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">id</span>: <span class="number">100</span>, <span class="attr">name</span>: <span class="string">&#x27;Howard Moon&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> userWithPass = &#123; ...user, <span class="attr">password</span>: <span class="string">&#x27;Password!&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line">user; <span class="comment">//&gt;&gt; &#123; id: 100, name: &#x27;Howard Moon&#x27; &#125;</span></span><br><span class="line">userWithPass; <span class="comment">//&gt;&gt; &#123; id: 100, name: &#x27;Howard Moon&#x27;, password: &#x27;Password!&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-对象合并"><a href="#2-对象合并" class="headerlink" title="2.对象合并"></a>2.对象合并</h3><p>将两个对象合并到一个新对象中。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> part1 = &#123; <span class="attr">id</span>: <span class="number">100</span>, <span class="attr">name</span>: <span class="string">&#x27;Howard Moon&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> part2 = &#123; <span class="attr">id</span>: <span class="number">100</span>, <span class="attr">password</span>: <span class="string">&#x27;Password!&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user1 = &#123; ...part1, ...part2 &#125;;</span><br><span class="line"><span class="comment">//&gt;&gt; &#123; id: 100, name: &#x27;Howard Moon&#x27;, password: &#x27;Password!&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<p>对象也可以使用以下语法合并：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> partial = &#123; <span class="attr">id</span>: <span class="number">100</span>, <span class="attr">name</span>: <span class="string">&#x27;Howard Moon&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> user = &#123; ...partial, <span class="attr">id</span>: <span class="number">100</span>, <span class="attr">password</span>: <span class="string">&#x27;Password!&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line">user; <span class="comment">//&gt;&gt; &#123; id: 100, name: &#x27;Howard Moon&#x27;, password: &#x27;Password!&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-排除对象属性"><a href="#3-排除对象属性" class="headerlink" title="3.排除对象属性"></a>3.排除对象属性</h3><p>可以结合使用 rest 运算符删除属性。 在下面这个例子里，password 被删除 ，其余的属性作为 rest 返回。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> noPassword = <span class="function">(<span class="params">&#123; password, ...rest &#125;</span>) =&gt;</span> rest;</span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  id: <span class="number">100</span>,</span><br><span class="line">  name: <span class="string">&#x27;coffe1891&#x27;</span>,</span><br><span class="line">  password: <span class="string">&#x27;Password!&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">noPassword(user); <span class="comment">//&gt;&gt; &#123; id: 100, name: &#x27;coffe1891&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-动态排除属性"><a href="#4-动态排除属性" class="headerlink" title="4.动态排除属性"></a>4.动态排除属性</h3><p>函数接受一个 prop 作为参数。使用计算对象属性名称，可以从克隆中动态地删除属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user1 = &#123;</span><br><span class="line">  id: <span class="number">100</span>,</span><br><span class="line">  name: <span class="string">&#x27;coffe1891&#x27;</span>,</span><br><span class="line">  password: <span class="string">&#x27;Password!&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> removeProperty = <span class="function"><span class="params">prop</span> =&gt;</span> <span class="function">(<span class="params">&#123; [prop]: _, ...rest &#125;</span>) =&gt;</span> rest;</span><br><span class="line"><span class="comment">//                     ----       ------</span></span><br><span class="line"><span class="comment">//                          \   /</span></span><br><span class="line"><span class="comment">//                dynamic destructuring</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> removePassword = removeProperty(<span class="string">&#x27;password&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> removeId = removeProperty(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"></span><br><span class="line">removePassword(user1); <span class="comment">//&gt;&gt; &#123; id: 100, name: &#x27;coffe1891&#x27; &#125;</span></span><br><span class="line">removeId(user1); <span class="comment">//&gt;&gt; &#123; name: &#x27;coffe1891&#x27;, password: &#x27;Password!&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-对属性进行排序"><a href="#5-对属性进行排序" class="headerlink" title="5.对属性进行排序"></a>5.对属性进行排序</h3><p>有时性质并不按照我们需要的顺序排列。 使用一些技巧，我们可以将属性推到列表的顶部，或者将它们移到底部。若要将 id 移动到第一个位置，在扩展对象之前将 <code>id: undefined</code> 添加到新的 Object 最前面。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user3 = &#123;</span><br><span class="line">  password: <span class="string">&#x27;Password!&#x27;</span>,</span><br><span class="line">  name: <span class="string">&#x27;Naboo&#x27;</span>,</span><br><span class="line">  id: <span class="number">300</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> organize = <span class="function"><span class="params">object</span> =&gt;</span> (&#123; <span class="attr">id</span>: <span class="literal">undefined</span>, ...object &#125;);</span><br><span class="line"><span class="comment">//                            -------------</span></span><br><span class="line"><span class="comment">//                          /</span></span><br><span class="line"><span class="comment">//  move id to the first property</span></span><br><span class="line"></span><br><span class="line">organize(user3);</span><br><span class="line"><span class="comment">//&gt;&gt; &#123; id: 300, password: &#x27;Password!&#x27;, name: &#x27;Naboo&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<p>若要将 password 移到最后一个属性，请从对象中解构 password。然后在使用 Rest 操作符后重新设置 password 属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user3 = &#123;</span><br><span class="line">  password: <span class="string">&#x27;Password!&#x27;</span>,</span><br><span class="line">  name: <span class="string">&#x27;Naboo&#x27;</span>,</span><br><span class="line">  id: <span class="number">300</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> organize = <span class="function">(<span class="params">&#123; password, ...object &#125;</span>) =&gt;</span> (&#123; ...object, password &#125;);</span><br><span class="line"><span class="comment">//              --------</span></span><br><span class="line"><span class="comment">//             /</span></span><br><span class="line"><span class="comment">// move password to last property</span></span><br><span class="line"></span><br><span class="line">organize(user3);</span><br><span class="line"><span class="comment">//&gt;&gt; &#123; name: &#x27;Naboo&#x27;, id: 300, password: &#x27;Password!&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-默认属性"><a href="#6-默认属性" class="headerlink" title="6.默认属性"></a>6.默认属性</h3><p>默认属性是仅当它们不包含在原始对象中时才设置的值。<br>在本例中，user2 不包含 quotes 属性。 setdefaults 函数确保所有对象都设置了 quotes 属性，否则它将被设置为<code>[]</code>。<br>当调用 setDefaults (user2)时，返回值将包含 quotes 属性: <code>[]</code>。<br>在调用 setDefaults (user4)时，因为 user4 已经有了 quotes 属性，所以不会修改该属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user2 = &#123;</span><br><span class="line">  id: <span class="number">200</span>,</span><br><span class="line">  name: <span class="string">&#x27;Vince Noir&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user4 = &#123;</span><br><span class="line">  id: <span class="number">400</span>,</span><br><span class="line">  name: <span class="string">&#x27;Bollo&#x27;</span>,</span><br><span class="line">  quotes: [<span class="string">&quot;I&#x27;ve got a bad feeling about this...&quot;</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setDefaults = <span class="function">(<span class="params">&#123; quotes = [], ...object &#125;</span>) =&gt;</span> (&#123; ...object, quotes &#125;);</span><br><span class="line"></span><br><span class="line">setDefaults(user2);</span><br><span class="line"><span class="comment">//&gt;&gt; &#123; id: 200, name: &#x27;Vince Noir&#x27;, quotes: [] &#125;</span></span><br><span class="line"></span><br><span class="line">setDefaults(user4);</span><br><span class="line"><span class="comment">//&gt;&gt; &#123;</span></span><br><span class="line"><span class="comment">//&gt;&gt;   id: 400,</span></span><br><span class="line"><span class="comment">//&gt;&gt;   name: &#x27;Bollo&#x27;,</span></span><br><span class="line"><span class="comment">//&gt;&gt;   quotes: [&quot;I&#x27;ve got a bad feeling about this...&quot;]</span></span><br><span class="line"><span class="comment">//&gt;&gt; &#125;</span></span><br></pre></td></tr></table></figure>

<p>如果你希望默认值先出现而不是后出现，也可以这样写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> setDefaults = <span class="function">(<span class="params">&#123; ...object &#125;</span>) =&gt;</span> (&#123; <span class="attr">quotes</span>: [], ...object &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="7-属性重命名"><a href="#7-属性重命名" class="headerlink" title="7.属性重命名"></a>7.属性重命名</h3><p>通过结合上面的技术，可以创建一个函数来重命名属性。假设有一些大写 ID 的对象属性名应该是小写的 id。 首先从对象解构 ID 然后在对象 Spread 时将其作为 id 添加回去。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> renamed = <span class="function">(<span class="params">&#123; ID, ...object &#125;</span>) =&gt;</span> (&#123; <span class="attr">id</span>: ID, ...object &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  ID: <span class="number">500</span>,</span><br><span class="line">  name: <span class="string">&#x27;Bob Fossil&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">renamed(user); <span class="comment">//&gt;&gt; &#123; id: 500, name: &#x27;Bob Fossil&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="8-添加条件属性"><a href="#8-添加条件属性" class="headerlink" title="8.添加条件属性"></a>8.添加条件属性</h3><p>在这个例子中，只有当 password 是真实的时候才会添加 password。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">id</span>: <span class="number">100</span>, <span class="attr">name</span>: <span class="string">&#x27;Howard Moon&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> password = <span class="string">&#x27;Password!&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> userWithPassword = &#123;</span><br><span class="line">  ...user,</span><br><span class="line">  id: <span class="number">100</span>,</span><br><span class="line">  ...(password &amp;&amp; &#123; password &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">userWithPassword; <span class="comment">//&gt;&gt; &#123; id: 100, name: &#x27;Howard Moon&#x27;, password: &#x27;Password!&#x27; &#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>指数函数的中缀表示法</title>
    <url>/posts/15070/</url>
    <content><![CDATA[<p>这个是与 <code>Math.pow</code> 有关的特性，还记得 <code>i++,x += x</code> 这种写法吗，指数函数的中缀表示法与之类似。与 python 语言一样，JavaScript 也采用两个星符号 <code>**</code> 来表示 Math.pow。好处有两个：<br>a. 中缀表示法比函数表示法更简洁，这使它更可取。<br>b. 方便数学、物理、机器人学等领域的计算。</p>
<p>用法示例如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//用法一：x ** y</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> squared = <span class="number">2</span> ** <span class="number">2</span>; <span class="comment">//等同于: 2 * 2</span></span><br><span class="line"><span class="keyword">let</span> cubed = <span class="number">2</span> ** <span class="number">3</span>; <span class="comment">//等同于: 2 * 2 * 2</span></span><br><span class="line"><span class="comment">//用法二：x **= y</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">2</span>;</span><br><span class="line">a **= <span class="number">2</span>; <span class="comment">//等同于: a = a * a;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">3</span>;</span><br><span class="line">b **= <span class="number">3</span>; <span class="comment">//等同于: b = b * b * b;</span></span><br></pre></td></tr></table></figure>

<p>没错，是一块很甜的<strong>语法糖</strong>（指计算机语言中添加的某种语法，这种语法对语言的功能并没有影响，但是更方便程序员使用）。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>数组的遍历方法</title>
    <url>/posts/64478/</url>
    <content><![CDATA[<p>下面是总结的数组遍历的常见方法</p>
<h2 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h2><ul>
<li>标准for循环</li>
<li>forEach((当前值, 当前索引, 当前数组) =&gt; {…}, [, 绑定的this])`<ul>
<li>无法中途退出循环，只能用 return 退出本次回调，进行下一次回调</li>
<li>它总是返回 undefined 值，即使你 return 了一个值</li>
</ul>
</li>
<li>for…in（不推荐）会把继承链的对象属性都会遍历一遍，而且数组遍历不一定按次序<ul>
<li>for-in 循环返回的是所有能通过对象访问的、可枚举的属性</li>
</ul>
</li>
<li>for (variable of iterable)（ES6）可迭代Array，Map，Set，String等（迭代的是值value）<ul>
<li>在 for..of 中如果遍历中途要退出，可以使用 break 退出循环</li>
</ul>
</li>
</ul>
<a id="more"></a>

<h2 id="ES5"><a href="#ES5" class="headerlink" title="ES5"></a>ES5</h2><ul>
<li><p>map (不改变原数组) 会给原数组中的每个元素都按顺序调用一次 callback 函数</p>
</li>
<li><p>reduce (不改变原数组) 数组中的前项和后项做某种计算,并累计最终值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 语法：</span></span><br><span class="line"><span class="comment">// arr.reduce(function(total, currentValue, currentIndex, arr), initialValue)</span></span><br><span class="line"><span class="comment">// callback 参数</span></span><br><span class="line"><span class="comment">// (累积器, 当前元素, 当前元素索引, 当前数组)</span></span><br><span class="line"><span class="comment">// initialValue:指定第一次回调 的第一个参数</span></span><br><span class="line"><span class="keyword">var</span> wallets = [<span class="number">4</span>, <span class="number">7.8</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">var</span> totalMoney = wallets.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">countedMoney, curMoney</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> countedMoney + curMoney;</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>filter (不改变原数组)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"><span class="keyword">var</span> morearr = arr.filter(<span class="function"><span class="keyword">function</span> (<span class="params">number</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> number &gt; <span class="number">3</span></span><br><span class="line">&#125;) <span class="comment">// [4,5,6]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>every (不改变原数组) 测试数组的所有元素是否都通过了指定函数的测试</p>
<ul>
<li>如果数组中检测到有一个元素不满足，则整个表达式返回 false ，且剩余的元素不会再进行检测</li>
<li>如果所有元素都满足条件，则返回 true</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="keyword">var</span> result = arr.every(<span class="function"><span class="keyword">function</span> (<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item &gt; <span class="number">2</span></span><br><span class="line">&#125;) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>some (不改变原数组) 测试是否至少有一个元素通过 callback 中的条件。对于放在空数组上的任何条件，此方法返回 false</p>
<ul>
<li>如果有一个元素满足条件，则表达式返回true, 剩余的元素不会再执行检测</li>
<li>如果没有满足条件的元素，则返回false</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// some(callback, thisArg)</span></span><br><span class="line"><span class="comment">// callback:</span></span><br><span class="line"><span class="comment">//    (当前元素, 当前索引, 调用some的数组)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="keyword">var</span> result = arr.some(<span class="function"><span class="keyword">function</span> (<span class="params">item,index</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item &gt; <span class="number">3</span></span><br><span class="line">&#125;) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h2><ul>
<li><p>find() &amp; findIndex() 根据条件找到数组成员</p>
<ul>
<li>find 定义：用于找出第一个符合条件的数组成员，并返回该成员，如果没有符合条件的成员，则返回 undefined</li>
<li>findIndex 定义：返回第一个符合条件的数组成员的位置，如果所有成员都不符合条件，则返回-1</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 语法</span></span><br><span class="line"><span class="keyword">let</span> new_array = arr.find(<span class="function"><span class="keyword">function</span>(<span class="params">currentValue, index, arr</span>), <span class="title">thisArg</span>)</span></span><br><span class="line"><span class="function"><span class="title">let</span> <span class="title">new_array</span> = <span class="title">arr</span>.<span class="title">findIndex</span>(<span class="params"><span class="keyword">function</span>(currentValue, index, arr), thisArg</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 这两个方法都可以识别<span class="title">NaN</span>,弥补了<span class="title">indexOf</span>的不足</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// <span class="title">find</span></span></span><br><span class="line"><span class="function"><span class="title">let</span> <span class="title">a</span> = [1, 4, -5, 10].<span class="title">find</span>(<span class="params">(n) =&gt; n &lt; <span class="number">0</span></span>)</span>; <span class="comment">// 返回元素-5</span></span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">1</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">10</span>,<span class="literal">NaN</span>].find(<span class="function">(<span class="params">n</span>) =&gt;</span> <span class="built_in">Object</span>.is(<span class="literal">NaN</span>, n));  <span class="comment">// 返回元素NaN</span></span><br><span class="line"><span class="comment">// findIndex</span></span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">10</span>].findIndex(<span class="function">(<span class="params">n</span>) =&gt;</span> n &lt; <span class="number">0</span>); <span class="comment">// 返回索引2</span></span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">1</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">10</span>,<span class="literal">NaN</span>].findIndex(<span class="function">(<span class="params">n</span>) =&gt;</span> <span class="built_in">Object</span>.is(<span class="literal">NaN</span>, n));  <span class="comment">// 返回索引4</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>keys() &amp; values() &amp; entries() 遍历键名、遍历键值、遍历键名+键值</p>
<ul>
<li>三个方法都返回一个新的 Array Iterator 对象，对象根据方法不同包含不同的值</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 语法</span></span><br><span class="line">array.keys()   array.values()   array.entries()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">of</span> [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>].keys()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(index);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> elem <span class="keyword">of</span> [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>].values()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(elem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &#x27;a&#x27;</span></span><br><span class="line"><span class="comment">// &#x27;b&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [index, elem] <span class="keyword">of</span> [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>].entries()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(index, elem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0 &quot;a&quot;</span></span><br><span class="line"><span class="comment">// 1 &quot;b&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
  </entry>
  <entry>
    <title>更改element-ui分页组件的文字部分</title>
    <url>/posts/19569/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>UI 设计稿中，分页部分的文字和 element-ui 中的有点偏差。</p>
<blockquote>
<p>element-ui</p>
</blockquote>
<img src="/posts/19569/page.png" class="" title="page">

<blockquote>
<p>设计稿</p>
</blockquote>
<img src="/posts/19569/page-ui.png" class="" title="page-ui">

<p>现在想要把「前往」改成「前往第」。然而 element-ui 文档中并没有给出跳转页面文字部分的配置。</p>
<a id="more"></a>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>在 github 上搜了下相关 issue 后找到了一种方案：使用 element-ui 提供的国际化部分进行文字替换。地址为：<a href="https://github.com/ElemeFE/element/issues/16030">https://github.com/ElemeFE/element/issues/16030</a></p>
<p>具体在 Vue 项目中如何做呢？</p>
<h3 id="在-assets-文件夹中新增-locale-cn-js-文件。"><a href="#在-assets-文件夹中新增-locale-cn-js-文件。" class="headerlink" title="在 assets 文件夹中新增 /locale/cn.js 文件。"></a>在 assets 文件夹中新增 <code>/locale/cn.js</code> 文件。</h3><blockquote>
<p>locale/cn.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  el: &#123;</span><br><span class="line">    pagination: &#123;</span><br><span class="line">      goto: <span class="string">&#x27;前往第&#x27;</span>,</span><br><span class="line">      pagesize: <span class="string">&#x27;条/页&#x27;</span>,</span><br><span class="line">      total: <span class="string">`共 &#123;total&#125; 条`</span>,</span><br><span class="line">      pageClassifier: <span class="string">&#x27;页&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<img src="/posts/19569/cn.png" class="" title="cn">

<h3 id="main-js-中配置国际化"><a href="#main-js-中配置国际化" class="headerlink" title="main.js 中配置国际化"></a>main.js 中配置国际化</h3><blockquote>
<p>main.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> Element <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./styles/element-variables.scss&#x27;</span>; <span class="comment">// 覆盖一些element-ui样式风格</span></span><br><span class="line"><span class="keyword">import</span> locale <span class="keyword">from</span> <span class="string">&#x27;./assets/locale/cn&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入 ECharts</span></span><br><span class="line"><span class="keyword">import</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Element, &#123;</span><br><span class="line">  locale</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><p>上述步骤做完后确实能改分页组件的文字部分了，但发现了个新问题。el-table 组件在没有数据时，「暂无数据」这样的默认提示文字消失了。</p>
<p>所以我们还需要把 el-table 这部分缺失文字覆盖补全：</p>
<blockquote>
<p>locale/cn.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  el: &#123;</span><br><span class="line">    table: &#123;</span><br><span class="line">      emptyText: <span class="string">&#x27;暂无数据&#x27;</span>,</span><br><span class="line">      confirmFilter: <span class="string">&#x27;筛选&#x27;</span>,</span><br><span class="line">      resetFilter: <span class="string">&#x27;重置&#x27;</span>,</span><br><span class="line">      clearFilter: <span class="string">&#x27;全部&#x27;</span>,</span><br><span class="line">      sumText: <span class="string">&#x27;合计&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    pagination: &#123;</span><br><span class="line">      goto: <span class="string">&#x27;前往第&#x27;</span>,</span><br><span class="line">      pagesize: <span class="string">&#x27;条/页&#x27;</span>,</span><br><span class="line">      total: <span class="string">`共 &#123;total&#125; 条`</span>,</span><br><span class="line">      pageClassifier: <span class="string">&#x27;页&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>main.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> Element <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./styles/element-variables.scss&#x27;</span>; <span class="comment">// 覆盖一些element-ui样式风格</span></span><br><span class="line"><span class="keyword">import</span> zhLang <span class="keyword">from</span> <span class="string">&#x27;element-ui/lib/locale/lang/zh-CN&#x27;</span>; <span class="comment">// 引入官方的中文国际化</span></span><br><span class="line"><span class="keyword">import</span> locale <span class="keyword">from</span> <span class="string">&#x27;./assets/locale/cn&#x27;</span>; <span class="comment">// 引入自己的</span></span><br><span class="line"></span><br><span class="line">Vue.use(Element, &#123;</span><br><span class="line">  locale: &#123; ...zhLang, ...locale &#125;, <span class="comment">// 使用本地的 locale 去覆盖官方的 zhLang</span></span><br><span class="line">&#125;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>UI</category>
        <category>element-ui</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>element-ui</tag>
      </tags>
  </entry>
  <entry>
    <title>有序表查找之二分查找</title>
    <url>/posts/39853/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>二分查找又名折半查找。它的前提是所操作的数据集是一个有序的数据集。它的基本思想是：开始时，先找出有序集合中间的那个元素。如果此元素比要查找的元素大，就接着在较小的一个半区进行查找；反之，如果此元素比要找的元素小，就在较大的一个半区进行查找。在每个更小的数据集中重复这个查找过程，直到找到要查找的元素或者数据集不能再分割。</p>
<h2 id="图解"><a href="#图解" class="headerlink" title="图解"></a>图解</h2><img src="/posts/39853/1556938076685-7ebcf60f-aaf7-4f4c-ba78-0f4d7b9a3099.png" class="" title="二分查找">

<a id="more"></a>

<h2 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h2><p>二分查找可以应用于任何类型的数据，但前提是这些数据是按某种规则进行排序的。这使得它在处理那些频繁插入和删除操作的数据集时不太高效。因为执行完插入和删除操作后，无法保证数据集的有序性，在查找前还得先维护一个有序数据集，从而导致查找过程代价太高。此外，元素必须存储在连续的空间中。</p>
<p>因此，当待搜索的集合是相对静态的数据集时，此时使用二分查找是最好的选择。</p>
<h2 id="代码示例（JS）"><a href="#代码示例（JS）" class="headerlink" title="代码示例（JS）"></a>代码示例（JS）</h2><blockquote>
<p>非递归实现</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">4</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">33</span>, <span class="number">46</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">77</span>, <span class="number">101</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">binary_search</span>(<span class="params">arr, target</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> min = <span class="number">0</span>,</span><br><span class="line">        max = arr.length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (min &lt;= max) &#123;</span><br><span class="line">        <span class="keyword">var</span> mid = <span class="built_in">parseInt</span>((min + max) / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (target === arr[mid]) &#123;</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &gt; arr[mid]) &#123;</span><br><span class="line">            min = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            max = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(binary_search(arr, <span class="number">33</span>));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>递归实现</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">4</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">33</span>, <span class="number">46</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">77</span>, <span class="number">101</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">binary_search</span>(<span class="params">arr, min, max, target</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (min &gt; max) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mid = <span class="built_in">parseInt</span>((min + max) / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (target === arr[mid]) &#123;</span><br><span class="line">        <span class="keyword">return</span> mid;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &gt; arr[mid]) &#123;</span><br><span class="line">        min = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> binary_search(arr, min, max, target);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        max = mid - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> binary_search(arr, min, max, target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(binary_search(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>, <span class="number">33</span>));</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>后端</category>
        <category>算法</category>
      </categories>
  </entry>
  <entry>
    <title>注册Apple公司账号</title>
    <url>/posts/14487/</url>
    <content><![CDATA[<h2 id="账号种类说明"><a href="#账号种类说明" class="headerlink" title="账号种类说明"></a>账号种类说明</h2><img src="/posts/14487/account-info.png" class="" title="account-info">

<h2 id="开发账号注册"><a href="#开发账号注册" class="headerlink" title="开发账号注册"></a>开发账号注册</h2><p>打开 <a href="https://developer.apple.com/cn/">https://developer.apple.com/cn/</a></p>
<img src="/posts/14487/1593654146303-a3ecaffd-b89e-4424-9ee4-7c49766d5227.png" class="" title="1593654146303-a3ecaffd-b89e-4424-9ee4-7c49766d5227">

<a id="more"></a>

<p>下拉到底部，点击加入 Developer Program 计划：</p>
<img src="/posts/14487/1593654213828-95bdfa13-491a-42fd-b169-a6f97862aa96.png" class="" title="1593654213828-95bdfa13-491a-42fd-b169-a6f97862aa96">

<p>点击后进入了: <a href="https://developer.apple.com/cn/programs/">https://developer.apple.com/cn/programs/</a> ，点击注册：</p>
<img src="/posts/14487/1593654266899-069b82b0-0dba-48b3-b290-6bc7beee7b84.png" class="" title="1593654266899-069b82b0-0dba-48b3-b290-6bc7beee7b84">

<p>进入：<a href="https://developer.apple.com/cn/programs/enroll/">https://developer.apple.com/cn/programs/enroll/</a> 下拉到底点击 <code>开始注册</code> ：</p>
<img src="/posts/14487/1593654374793-7167c244-4a5c-4236-9e43-83ace2468f79.png" class="" title="1593654374793-7167c244-4a5c-4236-9e43-83ace2468f79">

<p>接着会跳转到此页面：</p>
<img src="/posts/14487/1593654430297-0db40669-fdbe-47e9-92ee-b126c7a132f4.png" class="" title="1593654430297-0db40669-fdbe-47e9-92ee-b126c7a132f4">

<p>如果已经有了 Apple ID，登陆即可，否则点击下方立即创建 Apple ID。</p>
<p>点击登陆后需要通过苹果的双重认证：</p>
<img src="/posts/14487/1593654628838-57676f0f-a211-4b87-8141-e907e2c56a52.png" class="" title="1593654628838-57676f0f-a211-4b87-8141-e907e2c56a52">

<p>查看手机收到的验证码信息填入后会跳转到 <a href="https://developer.apple.com/enroll/app">https://developer.apple.com/enroll/app</a> ：</p>
<img src="/posts/14487/1593654687710-34b30ed1-3468-4ec1-a699-ad547f3bfb4f.png" class="" title="1593654687710-34b30ed1-3468-4ec1-a699-ad547f3bfb4f">

<h2 id="Apple-Developer-APP-下载与注册"><a href="#Apple-Developer-APP-下载与注册" class="headerlink" title="Apple Developer APP 下载与注册"></a>Apple Developer APP 下载与注册</h2><p>接下来在你的 iPhone 上的 App Store 下载 <code>Apple Developer</code> APP 。</p>
<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p>点击 「账户——&gt;登录」</p>
<img src="/posts/14487/1593656597418-fd813679-84fd-4654-9da9-da5f62fd63ce.png" class="" title="1593656597418-fd813679-84fd-4654-9da9-da5f62fd63ce">

<h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><p>点击现在注册：</p>
<img src="/posts/14487/1593656719386-06f62f09-c018-47b8-9a9c-705e00e6941b.png" class="" title="1593656719386-06f62f09-c018-47b8-9a9c-705e00e6941b">

<p>点击继续：</p>
<img src="/posts/14487/1593656769698-65848482-746d-4bdd-b259-39828897705a.png" class="" title="1593656769698-65848482-746d-4bdd-b259-39828897705a">

<p>继续：</p>
<img src="/posts/14487/1593656825654-6b9f67f3-38af-4f07-9572-4c8e84d46336.png" class="" title="1593656825654-6b9f67f3-38af-4f07-9572-4c8e84d46336">

<p>接着输入你的个人详细信息，接着自拍认证，然后填写你的档案。完成后选择实体类型，选组织：</p>
<img src="/posts/14487/1593657455669-10160865-77cd-4588-ae03-dbb9b164e72d.png" class="" title="1593657455669-10160865-77cd-4588-ae03-dbb9b164e72d">

<p>接着填写组织详情：</p>
<img src="/posts/14487/1593658419845-dc0aa8c3-6ea2-4ff4-9da7-56902286f7f6.png" class="" title="1593658419845-dc0aa8c3-6ea2-4ff4-9da7-56902286f7f6">

<p>法人实体填写公司名字全称的英文翻译。e.g.</p>
<p>Wuhan Cewei Information Technology Co., Ltd.</p>
<h3 id="邓白氏码（DUNS）注册"><a href="#邓白氏码（DUNS）注册" class="headerlink" title="邓白氏码（DUNS）注册"></a>邓白氏码（DUNS）注册</h3><p>如果已经有了 DUNS（邓白氏码），可以点击 <a href="https://developer.apple.com/cn/support/D-U-N-S/">此链接</a> 查找：</p>
<img src="/posts/14487/1593660782338-3692cab9-ff4d-42c3-8bd6-91027a3b098a.png" class="" title="1593660782338-3692cab9-ff4d-42c3-8bd6-91027a3b098a">

<img src="/posts/14487/1593660693743-f0bb94b4-0f92-48c9-ae06-ca2f8d098c8a.png" class="" title="1593660693743-f0bb94b4-0f92-48c9-ae06-ca2f8d098c8a">

<p>填写完毕后点击「继续」按钮，跳转到此页面：</p>
<img src="/posts/14487/1593661204347-5eb85f3c-e96b-45d4-98ce-d6d070e6dc90.png" class="" title="1593661204347-5eb85f3c-e96b-45d4-98ce-d6d070e6dc90">

<p>选择你的组织地址后，点击「继续」按钮。</p>
<p>如果没有邓白氏码 ，就点<a href="https://developer.apple.com/enroll/duns-lookup/#!/search">此链接</a>页面最下方的申请：</p>
<img src="/posts/14487/1593662690830-2cf83cf8-d6b4-4618-affc-ba1a2ed4bc7f.png" class="" title="1593662690830-2cf83cf8-d6b4-4618-affc-ba1a2ed4bc7f">

<p>地址为：<a href="https://developer.apple.com/enroll/duns-lookup/#!/request">https://developer.apple.com/enroll/duns-lookup/#!/request</a></p>
<img src="/posts/14487/1593662738246-f07dd184-d57b-492e-b991-30a7b25c5e8d.png" class="" title="1593662738246-f07dd184-d57b-492e-b991-30a7b25c5e8d">

<p>点击提交后弹出如下界面：</p>
<img src="/posts/14487/1593662826028-764d0a54-2ec5-477d-b52d-726a227c18d3.png" class="" title="1593662826028-764d0a54-2ec5-477d-b52d-726a227c18d3">

<p>然后一会儿你会收到一封 D&amp;B 邮件，告知你他们收到了你的请求，会在 14 个工作日完成申请。</p>
<p>接着 2 天内你会接到邓白氏的电话，告诉你发送了一封邮件到你邮箱，让你查收并按照邮件内容提供资料给他们，邮件内容如下：</p>
<img src="/posts/14487/1593844202474-b85da619-9314-4de4-9024-ce691e8a199b.png" class="" title="1593844202474-b85da619-9314-4de4-9024-ce691e8a199b">

<p><strong>注意：</strong></p>
<ul>
<li>上方截图中打马赛克的地方写的是你必须在截止日之前提交资料给他们</li>
<li>确认函 pdf 需要打印出来，然后签名盖章，之后拍照提交</li>
<li>提供的营业执照和公司公章都必须是拍摄的实物版本，类似下方示例<ul>
<li><img src="/posts/14487/1594099260811-579706bd-f9b1-4507-8aca-342ad863dc53.png" class="" title="1594099260811-579706bd-f9b1-4507-8aca-342ad863dc53"></li>
<li><img src="/posts/14487/1594099321268-e19fa3d4-bf92-4aa7-9895-e94c2a436225.png" class="" title="1594099321268-e19fa3d4-bf92-4aa7-9895-e94c2a436225">

</li>
</ul>
</li>
</ul>
<p>不出意外，2 天内会收到一封邮件，内容如下：</p>
<img src="/posts/14487/1594099504651-ffcef520-46bd-4cbe-926c-5bf773078fc3.jpeg" class="" title="1594099504651-ffcef520-46bd-4cbe-926c-5bf773078fc3">

<h3 id="继续注册"><a href="#继续注册" class="headerlink" title="继续注册"></a>继续注册</h3><p>申请到了邓白氏码之后，回到开发者 APP，继续填写信息：</p>
<img src="/posts/14487/1594605618968-583f9d16-fc6c-49aa-85ea-b5caf55d5802.png" class="" title="1594605618968-583f9d16-fc6c-49aa-85ea-b5caf55d5802">

<p>点击继续：</p>
<img src="/posts/14487/1594605747512-4e7280e2-3e6a-4919-ae84-c974003e25e3.png" class="" title="1594605747512-4e7280e2-3e6a-4919-ae84-c974003e25e3">

<p>过一会儿会收到一封邮，告知 apple 已经收到了你的计划申请。</p>
<p>然后一天后你会接到一个电话，跟你合适申请的一些信息。</p>
<p>比如开启双重验证，添加至少两个受信任的电话号码。</p>
<p>完成这些操作以后，回到你的「开发者 App」，继续注册流程：</p>
<img src="/posts/14487/1594776452743-614606d8-5343-44af-a022-12dae8faea9f.png" class="" title="1594776452743-614606d8-5343-44af-a022-12dae8faea9f">

<h3 id="同意并付款"><a href="#同意并付款" class="headerlink" title="同意并付款"></a>同意并付款</h3><p>点击「继续您的注册流程」后，会出现一个同意协议，点击同意后再付款就好了。</p>
<p>P.S. 电子发票会在 48 小时内发送到邮箱。</p>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><p><a href="https://developer.apple.com/cn/support/app-account/">使用 Apple Developer App 注册和管理您的帐户</a></p>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>用JS实现翻转二叉树</title>
    <url>/posts/50491/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>翻转二叉树就是把二叉树每一层的左右顺序颠倒过来。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><blockquote>
<p>输入</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">     <span class="number">4</span></span><br><span class="line">   /   \</span><br><span class="line">  <span class="number">2</span>     <span class="number">7</span></span><br><span class="line"> / \   / \</span><br><span class="line"><span class="number">1</span>   <span class="number">3</span> <span class="number">6</span>   <span class="number">9</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>输出</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">     <span class="number">4</span></span><br><span class="line">   /   \</span><br><span class="line">  <span class="number">7</span>     <span class="number">2</span></span><br><span class="line"> / \   / \</span><br><span class="line"><span class="number">9</span>   <span class="number">6</span> <span class="number">3</span>   <span class="number">1</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="算法步骤"><a href="#算法步骤" class="headerlink" title="算法步骤"></a>算法步骤</h2><p>如果根节点不为空，那么将左右子结点交换，然后将左右子结点进行递归调用。</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> invertTree = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (root !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> temp = root.left;</span><br><span class="line">    root.left = root.right;</span><br><span class="line">    root.right = temp;</span><br><span class="line">    invertTree(root.left);</span><br><span class="line">    invertTree(root.right);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> root;</span><br><span class="line"> </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>后端</category>
        <category>算法</category>
      </categories>
  </entry>
  <entry>
    <title>理解Vue中的computed用法以及和methods、watch的区别(摘录)</title>
    <url>/posts/42683/</url>
    <content><![CDATA[<p>摘录来源：<a href="https://www.cnblogs.com/tugenhua0707/p/11760466.html">https://www.cnblogs.com/tugenhua0707/p/11760466.html</a></p>
<h2 id="一-理解-Vue-中的-computed-用法"><a href="#一-理解-Vue-中的-computed-用法" class="headerlink" title="一. 理解 Vue 中的 computed 用法"></a>一. 理解 Vue 中的 computed 用法</h2><p>computed 是计算属性的; 它会根据所依赖的数据动态显示新的计算结果, 该计算结果会被缓存起来。computed 的值在 getter 执行后是会被缓存的。如果所依赖的数据发生改变时候, 就会重新调用 getter 来计算最新的结果。</p>
<p>下面我们根据官网中的 demo 来理解下 computed 的使用及何时使用 computed。</p>
<p>computed 设计的初衷是为了使模板中的逻辑运算更简单, 比如在 Vue 模板中有很多复杂的数据计算的话, 我们可以把该计算逻辑放入到 computed 中去计算。</p>
<a id="more"></a>

<p>下面我们看下官网中的一个 demo 如下:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    &lt;script</span><br><span class="line">      type=&quot;text/javascript&quot;</span><br><span class="line">      src=&quot;https://cn.vuejs.org/js/vue.js&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>&#123;&#123; msg.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="javascript">          msg: <span class="string">&#x27;hello&#x27;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如上代码, 我们的 data 属性中的 msg 默认值为 ‘hello’; 然后我们在 vue 模板中会对该数据值进行反转操作后输出数据, 因此在页面上就会显示 ‘olleh’; 这样的数据。这是一个简单的运算, 但是如果页面中的运算比这个还更复杂的话, 这个时候我们可以使用 computed 来进行计算属性值, computed 的目的就是能使模板中的运算逻辑更简单。因此我们现在需要把上面的代码改写成下面如下代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    &lt;script</span><br><span class="line">      type=&quot;text/javascript&quot;</span><br><span class="line">      src=&quot;https://cn.vuejs.org/js/vue.js&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>原来的数据: &#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>反转后的数据为: &#123;&#123; reversedMsg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="javascript">          msg: <span class="string">&#x27;hello&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">reversedMsg</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// this 指向 vm 实例</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="built_in">this</span>.msg.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>);</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如上代码, 我们在 computed 中声明了一个计算属性 reversedMsg。我们提供的 reversedMsg 函数, 将用作属性 vm.reversedMsg 的 getter 函数; 我们可以在上面实例化后代码中, 打印如下信息:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(vm);</span><br></pre></td></tr></table></figure>

<p>打印信息如下所示, 我们可以看到 vm.reversedMsg = ‘olleh’;</p>
<img src="/posts/42683/computed-reversedMsg.png" class="" title="computed-reversedMsg">

<p>我们也可以打开控制台, 当我们修改 vm.msg 的值后, vm.reversedMsg 的值也会发生改变，如下控制台打印的信息可知:</p>
<p><a href="https://gitee.com/evestorm/various_resources/raw/master/vue/vm.msg.png"><img src="%E7%90%86%E8%A7%A3Vue%E4%B8%AD%E7%9A%84computed%E7%94%A8%E6%B3%95%E4%BB%A5%E5%8F%8A%E5%92%8Cmethods%E3%80%81watch%E7%9A%84%E5%8C%BA%E5%88%AB(%E6%91%98%E5%BD%95)/vm.msg.png" alt="img"></a></p>
<img src="/posts/42683/vm-msg.png" class="" title="vm.msg">

<p>如上打印的信息我们可以看得到, 我们的 vm.reversedMsg 的值依赖于 vm.msg 的值，当 vm.msg 的值发生改变时, vm.reversedMsg 的值也会得到更新。</p>
<h3 id="computed-应用场景"><a href="#computed-应用场景" class="headerlink" title="computed 应用场景"></a>computed 应用场景</h3><ol>
<li>适用于一些重复使用数据或复杂及费时的运算。我们可以把它放入 computed 中进行计算, 然后会在 computed 中缓存起来, 下次就可以直接获取了。</li>
<li>如果我们需要的数据依赖于其他的数据的话, 我们可以把该数据设计为 computed 中。</li>
</ol>
<h2 id="二：computed-和-methods-的区别"><a href="#二：computed-和-methods-的区别" class="headerlink" title="二：computed 和 methods 的区别?"></a>二：computed 和 methods 的区别?</h2><p>如上 demo 代码, 如果我们通过在表达式中调用方法也可以达到同样的效果, 现在我们把代码改成方法, 如下代码:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    &lt;script</span><br><span class="line">      type=&quot;text/javascript&quot;</span><br><span class="line">      src=&quot;https://cn.vuejs.org/js/vue.js&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>原来的数据: &#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>反转后的数据为: &#123;&#123; reversedMsg() &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="javascript">          msg: <span class="string">&#x27;hello&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        /*</span><br><span class="line">      computed: &#123;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">reversedMsg</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// this 指向 vm 实例</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="built_in">this</span>.msg.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      */</span><br><span class="line">        methods: &#123;</span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">reversedMsg</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// this 指向 vm 实例</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="built_in">this</span>.msg.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>);</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(vm);</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如上代码, 我们反转后的数据在模板中调用的是方法 reversedMsg(); 该方法在 methods 中也定义了。那么也可以实现同样的效果, 那么他们之间到底有什么区别呢?</p>
<h3 id="computed-和-methods-区别是"><a href="#computed-和-methods-区别是" class="headerlink" title="computed 和 methods 区别是"></a>computed 和 methods 区别是</h3><ol>
<li>computed 是基于响应性依赖来进行缓存的。只有在响应式依赖发生改变时它们才会重新求值, 也就是说, 当 msg 属性值没有发生改变时, 多次访问 reversedMsg 计算属性会立即返回之前缓存的计算结果, 而不会再次执行 computed 中的函数。但是 methods 方法中是每次调用, 都会执行函数的, methods 它不是响应式的。</li>
<li>computed 中的成员可以只定义一个函数作为只读属性, 也可以定义成 get/set 变成可读写属性, 但是 methods 中的成员没有这样的。</li>
</ol>
<p>我们可以再看下如下 demo：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    &lt;script</span><br><span class="line">      type=&quot;text/javascript&quot;</span><br><span class="line">      src=&quot;https://cn.vuejs.org/js/vue.js&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>第一次调用computed属性: &#123;&#123; reversedMsg &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>第二次调用computed属性: &#123;&#123; reversedMsg &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>第三次调用computed属性: &#123;&#123; reversedMsg &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 下面是methods调用 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>第一次调用methods方法: &#123;&#123; reversedMsg1() &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>第二次调用methods方法: &#123;&#123; reversedMsg1() &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>第三次调用methods方法: &#123;&#123; reversedMsg1() &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="javascript">          msg: <span class="string">&#x27;hello&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">reversedMsg</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="number">1111</span>);</span></span><br><span class="line"><span class="javascript">            <span class="comment">// this 指向 vm 实例</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="built_in">this</span>.msg.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>);</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">reversedMsg1</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="number">2222</span>);</span></span><br><span class="line"><span class="javascript">            <span class="comment">// this 指向 vm 实例</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="built_in">this</span>.msg.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>);</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(vm);</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>执行后的结果如下所示:</p>
<p><a href="https://gitee.com/evestorm/various_resources/raw/master/vue/mul-computed.png"><img src="%E7%90%86%E8%A7%A3Vue%E4%B8%AD%E7%9A%84computed%E7%94%A8%E6%B3%95%E4%BB%A5%E5%8F%8A%E5%92%8Cmethods%E3%80%81watch%E7%9A%84%E5%8C%BA%E5%88%AB(%E6%91%98%E5%BD%95)/mul-computed.png" alt="img"></a></p>
<p>如上代码我们可以看到, 在 computed 中有属性 reversedMsg, 然后在该方法中会打印 1111; 信息出来, 在 methods 中的方法 reversedMsg1 也会打印 2222 信息出来, 但是在 computed 中, 我们除了第一次之后，再次获取 reversedMsg 值后拿得是缓存里面的数据, 因此就不会再执行该 reversedMsg 函数了。但是在 methods 中, 并没有缓存, 每次执行 reversedMsg1()方法后，都会打印信息。<br>从上面截图信息我们就可以验证的。</p>
<p>那么我们现在再来理解下缓存的作用是什么呢? computed 为什么需要缓存呢? 我们都知道我们的 http 也有缓存, 对于一些静态资源, 我们 nginx 服务器会缓存我们的静态资源，如果静态资源没有发生任何改变的话, 会直接从缓存里面去读取,这样就不会重新去请求服务器数据, 也就是避免了一些无畏的请求, 提高了访问速度, 优化了用户体验。</p>
<p>对于我们 computed 的也是一样的。如上面代码, 我们调用了 computed 中的 reversedMsg 方法一共有三次，如果我们也有上百次调用或上千次调用的话, 如果依赖的数据没有改变, 那么每次调用都要去计算一遍, 那么肯定会造成很大的浪费。因此 computed 就是来优化这件事的。</p>
<h2 id="三：Vue-中的-watch-的用法"><a href="#三：Vue-中的-watch-的用法" class="headerlink" title="三：Vue 中的 watch 的用法"></a>三：Vue 中的 watch 的用法</h2><p>watch 它是一个对 data 的数据监听回调, 当依赖的 data 的数据变化时, 会执行回调。在回调中会传入 newVal 和 oldVal 两个参数。<br>Vue 实列将会在实例化时调用$watch(), 他会遍历 watch 对象的每一个属性。</p>
<h3 id="watch-的使用场景是"><a href="#watch-的使用场景是" class="headerlink" title="watch 的使用场景是"></a>watch 的使用场景是</h3><p>当在 data 中的某个数据发生变化时, 我们需要做一些操作, 或者当需要在数据变化时执行异步或开销较大的操作时. 我们就可以使用 watch 来进行监听。</p>
<h4 id="watch-普通监听和深度监听"><a href="#watch-普通监听和深度监听" class="headerlink" title="watch 普通监听和深度监听"></a>watch 普通监听和深度监听</h4><p>如下普通监听数据的基本测试代码如下:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    &lt;script</span><br><span class="line">      type=&quot;text/javascript&quot;</span><br><span class="line">      src=&quot;https://cn.vuejs.org/js/vue.js&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>空智个人信息情况: &#123;&#123; basicMsg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        空智今年的年龄:</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;age&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="javascript">          basicMsg: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">          age: 31,</span><br><span class="line"><span class="javascript">          single: <span class="string">&#x27;单身&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        watch: &#123;</span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">age</span>(<span class="params">newVal, oldVal</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.basicMsg = <span class="string">&#x27;今年&#x27;</span> + newVal + <span class="string">&#x27;岁&#x27;</span> + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.single;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>显示效果如下：</p>
<img src="/posts/42683/single.png" class="" title="single">

<p>如上代码, 当我们在 input 输入框中输入年龄后, 比如 32, 那么 watch 就能对 ‘age’ 这个属性进行监听，当值发生改变的时候, 就会把最新的计算结果赋值给 ‘basicMsg’ 属性值, 因此最后在页面上就会显示 ‘basicMsg’ 属性值了。</p>
<h4 id="理解-handler-方法及-immediate-属性"><a href="#理解-handler-方法及-immediate-属性" class="headerlink" title="理解 handler 方法及 immediate 属性"></a>理解 handler 方法及 immediate 属性</h4><p>如上 watch 有一个特点是: 第一次初始化页面的时候, 是不会去执行 age 这个属性监听的, 只有当 age 值发生改变的时候才会执行监听计算. 因此我们上面第一次初始化页面的时候, ‘basicMsg’ 属性值默认为空字符串。那么我们现在想要第一次初始化页面的时候也希望它能够执行 ‘age’ 进行监听, 最后能把结果返回给 ‘basicMsg’ 值来。因此我们需要修改下我们的 watch 的方法，需要引入 handler 方法和 immediate 属性, 代码如下所示:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    &lt;script</span><br><span class="line">      type=&quot;text/javascript&quot;</span><br><span class="line">      src=&quot;https://cn.vuejs.org/js/vue.js&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>空智个人信息情况: &#123;&#123; basicMsg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        空智今年的年龄:</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;age&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="javascript">          basicMsg: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">          age: 31,</span><br><span class="line"><span class="javascript">          single: <span class="string">&#x27;单身&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        watch: &#123;</span><br><span class="line">          age: &#123;</span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">handler</span>(<span class="params">newVal, oldVal</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">this</span>.basicMsg = <span class="string">&#x27;今年&#x27;</span> + newVal + <span class="string">&#x27;岁&#x27;</span> + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.single;</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            immediate: <span class="literal">true</span></span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如上代码, 我们给我们的 age 属性绑定了一个 handler 方法。其实我们之前的 watch 当中的方法默认就是这个 handler 方法。但是在这里我们使用了 immediate: true; 属性，含义是: 如果在 watch 里面声明了 age 的话, 就会立即执行里面的 handler 方法。如果 immediate 值为 false 的话,那么效果就和之前的一样, 就不会立即执行 handler 这个方法的。因此设置了 immediate:true 的话,第一次页面加载的时候也会执行该 handler 函数的。即第一次 basicMsg 有值。</p>
<p>因此第一次页面初始化效果如下：</p>
<img src="/posts/42683/single-2.png" class="" title="single-2">

<h4 id="理解-deep-属性"><a href="#理解-deep-属性" class="headerlink" title="理解 deep 属性"></a>理解 deep 属性</h4><p>watch 里面有一个属性为 deep，含义是：是否深度监听某个对象的值, 该值默认为 false。</p>
<p>如下测试代码:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    &lt;script</span><br><span class="line">      type=&quot;text/javascript&quot;</span><br><span class="line">      src=&quot;https://cn.vuejs.org/js/vue.js&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>空智个人信息情况: &#123;&#123; basicMsg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        空智今年的年龄:</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;obj.age&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line">          obj: &#123;</span><br><span class="line"><span class="javascript">            basicMsg: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">            age: 31,</span><br><span class="line"><span class="javascript">            single: <span class="string">&#x27;单身&#x27;</span></span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        watch: &#123;</span><br><span class="line">          obj: &#123;</span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">handler</span>(<span class="params">newVal, oldVal</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">this</span>.basicMsg =</span></span><br><span class="line"><span class="javascript">                <span class="string">&#x27;今年&#x27;</span> + newVal.age + <span class="string">&#x27;岁&#x27;</span> + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.obj.single;</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            immediate: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            deep: <span class="literal">true</span> <span class="comment">// 需要添加deep为true即可对obj进行深度监听</span></span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如上测试代码, 如果我们不把 deep: true 添加的话,当我们在输入框中输入值的时候，改变 obj.age 值后，obj 对象中的 handler 函数是不会被执行到的。受 JS 的限制, Vue 不能检测到对象属性的添加或删除的。它只能监听到 obj 这个对象的变化,比如说对 obj 赋值操作会被监听到。比如在 mounted 事件钩子函数中对我们的 obj 进行重新赋值操作, 如下代码:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.obj = &#123;</span><br><span class="line">    age: <span class="number">22</span>,</span><br><span class="line">    basicMsg: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    single: <span class="string">&#x27;单身&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后我们的页面会被渲染到 age 为 22; 因此这样我们的 handler 函数才会被执行到。如果我们需要监听对象中的某个属性值的话, 我们可以使用 deep 设置为 true 即可生效。deep 实现机制是: 监听器会一层层的往下遍历, 给对象的所有属性都加上这个监听器。当然性能开销会非常大的。</p>
<p>当然我们可以直接对对象中的某个属性进行监听的，比如就对 ‘obj.age’ 来进行监听， 如下代码也是可以生效的。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    &lt;script</span><br><span class="line">      type=&quot;text/javascript&quot;</span><br><span class="line">      src=&quot;https://cn.vuejs.org/js/vue.js&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>空智个人信息情况: &#123;&#123; basicMsg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        空智今年的年龄:</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;obj.age&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line">          obj: &#123;</span><br><span class="line"><span class="javascript">            basicMsg: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">            age: 31,</span><br><span class="line"><span class="javascript">            single: <span class="string">&#x27;单身&#x27;</span></span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        watch: &#123;</span><br><span class="line"><span class="javascript">          <span class="string">&#x27;obj.age&#x27;</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">handler</span>(<span class="params">newVal, oldVal</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">this</span>.basicMsg = <span class="string">&#x27;今年&#x27;</span> + newVal + <span class="string">&#x27;岁&#x27;</span> + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.obj.single;</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            immediate: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// deep: true // 需要添加deep为true即可对obj进行深度监听</span></span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="watch-和-computed-的区别"><a href="#watch-和-computed-的区别" class="headerlink" title="watch 和 computed 的区别"></a>watch 和 computed 的区别</h4><p>相同点：他们两者都是观察页面数据变化的。</p>
<p>不同点：computed 只有当依赖的数据变化时才会计算, 当数据没有变化时, 它会读取缓存数据。<br>watch 每次都需要执行函数。watch 更适用于数据变化时的异步操作。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>笔记</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>监听某个元素的宽度变化-ResizeObserver</title>
    <url>/posts/30804/</url>
    <content><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>项目中需要监听某个特定元素的宽度变化。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><blockquote><p><strong><code>ResizeObserver</code></strong> 接口可以监听到 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element"><code>Element</code></a> 的内容区域或 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SVGElement"><code>SVGElement</code></a>的边界框改变。内容区域则需要减去内边距 padding。（有关内容区域、内边距资料见<a href="https://developer.mozilla.org/docs/Learn/CSS/Introduction_to_CSS/Box_model">盒子模型</a> ）<br>ResizeObserver 避免了在自身回调中调整大小，从而触发的无限回调和循环依赖。它仅通过在后续帧中处理 DOM 中更深层次的元素来实现这一点。如果（浏览器）遵循规范，只会在绘制前或布局后触发调用。</p>
<footer><strong>MDN</strong><cite><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver">ResizeObserver</a></cite></footer></blockquote>

<a id="more"></a>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ro = <span class="keyword">new</span> ResizeObserver(<span class="function"><span class="params">entries</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> entries) &#123;</span><br><span class="line">    <span class="keyword">const</span> cr = entry.contentRect;</span><br><span class="line">    <span class="comment">// console.log(&#x27;Element:&#x27;, entry.target)</span></span><br><span class="line">    <span class="comment">// console.log(`Element size: $&#123;cr.width&#125;px x $&#123;cr.height&#125;px`)</span></span><br><span class="line">    <span class="comment">// console.log(`Element padding: $&#123;cr.top&#125;px ; $&#123;cr.left&#125;px`)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">ro.observe(<span class="built_in">document</span>.querySelector(<span class="string">&#x27;target-element&#x27;</span>));</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
        <category>DOM</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>DOM</tag>
      </tags>
  </entry>
  <entry>
    <title>真机调试或打包时There are no devices registered in your account on the developer website</title>
    <url>/posts/32648/</url>
    <content><![CDATA[<p>真机测试打包的时候 Xcode 运行报错：</p>
<blockquote>
<p>There are no devices registered in your account on the developer website. Plug in and select a device to have Xcode register it</p>
</blockquote>
<img src="/posts/32648/signing.png" class="" title="signing">

<p>原因：</p>
<ol>
<li>真机调试时：一般是首次调试，左上角没有选择真机 iPhone</li>
<li>打包时：苹果要求我们打包上架之前至少要在开发者网站注册一台真机，大多数人都不会遇到这种情况，因为在上架前我们肯定会真机调试一下，在调试的时候 Xcode 就自动帮我们注册了。</li>
</ol>
<p>但也有少数人从没在真机上调试过就直接打包的。<br>（把错误直译过来就是：我们没有在开发者账号（Apple ID）上注册 iOS 设备（真机）他让我们把 iOS 设备连上电脑，选择一个设备让 Xcode 自动帮我们注册一下。）</p>
<p>解决方法：</p>
<p>连上 iPhone，在 Xcode 左上角选择刚连上的真机 iPhone（而不是模拟器），然后运行一下，Xcode 就自动帮我们注册了这台 iPhone 了。</p>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>禁止uniapp&quot;v-longpress&quot;事件在滚动屏幕时也会触发</title>
    <url>/posts/27545/</url>
    <content><![CDATA[<img src="/posts/27545/lock-table.png" class="" title="锁台">

<p>选中某个桌台滑动屏幕也会触发解锁弹窗。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>监听 <code>@touchstart</code> 和 <code>@touchmove</code> 事件</p>
<p>在 <code>@touchstart</code> 触发时保存当前选中的桌台，<code>@touchmove</code> 触发时移除 <code>@touchstart</code> 中保存的桌台，最后在 <code>v-longpress</code> 事件触发时，判断桌台是否存在，存在则弹出 modal，否则忽略。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>uniapp</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>移动端input类型为date的placeholder不显示</title>
    <url>/posts/23431/</url>
    <content><![CDATA[<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>在移动端项目开发中，DatetimePicker（时间选择器） 组件是非常常用的，并且市面上各大移动端 UI 框架也都帮我们封装了，然而绝大部分框架封装的该组件都是从底部弹出式滚动选择的（Android 和 iOS 真机上都如此），例如下面形式：</p>
<img src="/posts/23431/datepicker.png" class="" title="Vant-UI中的时间选择器组件">

<a id="more"></a>

<p>然而这仅针对 iOS 用户友好，但对于用惯了 Android 手机的用户来说，下面形式的时间选择才是他们熟悉的形式：</p>
<img src="/posts/23431/android-datetime-picker.png" class="" title="安卓默认时间选择器">

<p>所以往往我们会放弃掉框架帮我们封装好的组件，自己用原始 <code>input[type=date]</code> 实现一个或者借助其他基于原始 input 标签封装的时间选择器。这里顺带提一个我感觉用起来还不错的库：<a href="https://flatpickr.js.org/">flatpickr</a>，github 地址为：<a href="https://github.com/flatpickr/flatpickr">flatpickr/flatpickr</a> 。</p>
<p>我在项目中就使用到了这个库，然而在开发中遇到了一个小问题，设计稿上要求，我们的时间选择器组件默认情况下显示一段 placeholder ，然而在真机上我发现，无论 iOS 还是 Android 下，input 始终为空，设置的 placeholder 无效。原本我以为这是 flatpickr 做了手脚，简单查看了源码后发现并不是它的锅。最后 Google 后才知道，这就是 <code>input[type=date]</code> 元素在手机端上的一个 feature ，不过我感觉就是个 bug ，我设置了你凭什么不给我显示？。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>前面铺垫了这么多，其实解决方案涉及到的代码量并不多，原理就是使用 css 伪类给 input[type=date] 设置默认 content 为 placeholder ，再设置 input 状态为 focus 时移除这个 placeholder 属性，最后在触发 blur 时把 placeholder 添加回来。具体代码如下：</p>
<blockquote>
<p>html</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;text-date&quot;</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择日期&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>css</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&#x27;date&#x27;</span>]</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="built_in">attr</span>(placeholder);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&#x27;text-date&#x27;</span>).focus(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  $(<span class="built_in">this</span>).removeAttr(<span class="string">&#x27;placeholder&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&#x27;text-date&#x27;</span>).blur(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.value === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    $(<span class="built_in">this</span>).attr(<span class="string">&#x27;placeholder&#x27;</span>, <span class="string">&#x27;请选择日期&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>兼容性</tag>
        <tag>移动端</tag>
      </tags>
  </entry>
  <entry>
    <title>管理github上的star</title>
    <url>/posts/45568/</url>
    <content><![CDATA[<p>随着 github 上 star 的项目越来越多，找起来也越来越不方便。</p>
<p>Google 了一下发现个不错的网站能帮我们管理 star：<a href="https://link.zhihu.com/?target=https://astralapp.com/">https://astralapp.com/</a></p>
<p>特性：</p>
<ul>
<li>GitHub 授权之后自动同步所有 Star 项目</li>
<li>可以使用标签分组（支持一个项目多个标签）</li>
<li>可以给每个 repo 添加自己的笔记</li>
<li>如果 Star 项目有变动可点击左上同步按钮同步</li>
</ul>
<p>效果：</p>
<img src="/posts/45568/astral.png" class="" title="astral">
]]></content>
      <categories>
        <category>效率</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title>苹果app如何在其他人电脑上发版</title>
    <url>/posts/62601/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>之前只有我的电脑能发版，其他电脑上传不了；希望在其他电脑上也能发版。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>在能发版的电脑上 Xcode -&gt; Preferences… -&gt; Accounts -&gt; 左下角齿轮 -&gt; Export Account 。然后会导出一个文件，把这个文件传给另一台机器，然后安装就好了。</p>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Xcode</tag>
      </tags>
  </entry>
  <entry>
    <title>上架AppStore</title>
    <url>/posts/16027/</url>
    <content><![CDATA[<h2 id="一-开发证书申请"><a href="#一-开发证书申请" class="headerlink" title="一. 开发证书申请"></a>一. 开发证书申请</h2><p>进入 <a href="https://developer.apple.com/account">https://developer.apple.com/account</a></p>
<p>点击「Certificates, Identifiers &amp; Profiles」</p>
<img src="/posts/16027/1594882664645-69f13a17-f828-4f4f-8549-8456bf43955c.png" class="" title="1594882664645-69f13a17-f828-4f4f-8549-8456bf43955c">

<p>点击添加 Certificates ：</p>
<img src="/posts/16027/1594880841216-49e2644f-7fdd-4118-a903-6b65b1062d1c.png" class="" title="1594880841216-49e2644f-7fdd-4118-a903-6b65b1062d1c">

<a id="more"></a>

<p>选择「iOS App Development」后直接点继续：</p>
<img src="/posts/16027/1594882628147-8e4f75f8-55af-49e2-8fe1-822d6e9a421a.png" class="" title="1594882628147-8e4f75f8-55af-49e2-8fe1-822d6e9a421a">

<p>选择证书：</p>
<img src="/posts/16027/1594882942036-e8aa6a74-9aa9-4dcc-be0e-8dab42a193a0.png" class="" title="1594882942036-e8aa6a74-9aa9-4dcc-be0e-8dab42a193a0">

<p>证书获取：</p>
<p>打开 Mac 上的钥匙串访问「Keychain Access」，在菜单选择「钥匙串访问 =&gt; 证书助手 =&gt; 从证书颁发机构请求证书」：</p>
<img src="/posts/16027/1594883082166-c51bf79c-75f5-4b8c-9549-456e0882f2b8.png" class="" title="1594883082166-c51bf79c-75f5-4b8c-9549-456e0882f2b8">

<p>输入邮件，选择「存储到磁盘」：</p>
<img src="/posts/16027/1594883153988-e95dadae-c233-4b72-ab36-b88568ca6ad5.png" class="" title="1594883153988-e95dadae-c233-4b72-ab36-b88568ca6ad5">

<p>选择保存位置：</p>
<img src="/posts/16027/1594883271573-2202faf1-fb20-42ad-ad5a-201df2f437ce.png" class="" title="1594883271573-2202faf1-fb20-42ad-ad5a-201df2f437ce">

<p>点击保存：</p>
<img src="/posts/16027/1594883294243-47fc2b34-abe2-4669-bc6f-dcdd2d07bdfb.png" class="" title="1594883294243-47fc2b34-abe2-4669-bc6f-dcdd2d07bdfb">

<p>然后上传刚刚生成的证书，点击继续：</p>
<img src="/posts/16027/1594883362266-e498f8f7-524d-4f13-baf3-10b43ea72a28.png" class="" title="1594883362266-e498f8f7-524d-4f13-baf3-10b43ea72a28">

<p>下载你的证书：</p>
<img src="/posts/16027/1594883417680-6287c257-31ac-48a6-9ca1-69f6574cd95c.png" class="" title="1594883417680-6287c257-31ac-48a6-9ca1-69f6574cd95c">

<p>双击下载的证书安装：</p>
<img src="/posts/16027/1594883457231-06e24b7b-4d64-4802-b735-b142e66e50de.png" class="" title="1594883457231-06e24b7b-4d64-4802-b735-b142e66e50de">

<p>输入密码后就能安装成功了：</p>
<img src="/posts/16027/1594883656140-431b1c3e-ffb9-4155-a07a-a9cb1ee1a081.png" class="" title="1594883656140-431b1c3e-ffb9-4155-a07a-a9cb1ee1a081">

<h2 id="二-App-证书申请"><a href="#二-App-证书申请" class="headerlink" title="二. App 证书申请"></a>二. App 证书申请</h2><p>回到开发者控制台，选择「Identifiers」添加「Identifiers」：</p>
<img src="/posts/16027/1594883949751-2e2fcee3-19bc-4f03-92d6-23a7347ca321.png" class="" title="1594883949751-2e2fcee3-19bc-4f03-92d6-23a7347ca321">

<p>选择「App IDs」点继续：</p>
<img src="/posts/16027/1594884014199-d2ae7597-2ef0-4554-9dff-3dd342062b7b.png" class="" title="1594884014199-d2ae7597-2ef0-4554-9dff-3dd342062b7b">

<p>选择类型点继续：</p>
<img src="/posts/16027/1594884065440-665c827a-7357-471b-8605-23140dc81ce5.png" class="" title="1594884065440-665c827a-7357-471b-8605-23140dc81ce5">

<p>添加证书描述和 Bundle ID（需要使用 APNs 时，必须选择“Explicit”，不能使用“Wildcard”）：</p>
<img src="/posts/16027/1594884403089-e434e459-4bb5-4238-803d-a09b0673d16a.png" class="" title="1594884403089-e434e459-4bb5-4238-803d-a09b0673d16a">

<p>勾选下方你程序中所需的功能：</p>
<img src="/posts/16027/1594884621351-b7a26ad4-10d8-444e-97f9-a08df8acf2b5.png" class="" title="1594884621351-b7a26ad4-10d8-444e-97f9-a08df8acf2b5">

<p>点击右上角继续后会让你确认一次信息，确认无误后点击注册：</p>
<img src="/posts/16027/1594884722253-c8b1290e-3f47-4c88-bf58-e134776477bc.png" class="" title="1594884722253-c8b1290e-3f47-4c88-bf58-e134776477bc">

<p>然后网页会自动跳转回「Identifiers」，可以看到你刚创建的证书：</p>
<img src="/posts/16027/1594884768812-d518acf7-6c65-4265-8efc-2c47e7db265a.png" class="" title="1594884768812-d518acf7-6c65-4265-8efc-2c47e7db265a">

<h2 id="三-APNs-p12-推送证书"><a href="#三-APNs-p12-推送证书" class="headerlink" title="三. APNs.p12 推送证书"></a>三. APNs.p12 推送证书</h2><p>点击添加：</p>
<img src="/posts/16027/1594884951069-97b6f494-8c9a-4f0f-b27b-fa7d5c71be94.png" class="" title="1594884951069-97b6f494-8c9a-4f0f-b27b-fa7d5c71be94">

<p>新建证书需要注意选择证书种类。分为开发环境和通用环境两种。推荐场景通用环境推送证书，可以推送开发环境、生产环境、voip 等：</p>
<img src="/posts/16027/1594885019849-fbbbb133-00b6-4f65-9dbb-ac429b1e3c87.png" class="" title="1594885019849-fbbbb133-00b6-4f65-9dbb-ac429b1e3c87">

<p>选择完点击继续，会让你选择需要使用推送证书的「App ID」，再点继续：</p>
<img src="/posts/16027/1594885120950-97feb067-cb6c-4a7f-b5d7-2f281dab756b.png" class="" title="1594885120950-97feb067-cb6c-4a7f-b5d7-2f281dab756b">

<p>这里需要你上传 CSR 文件，就是在第一步生成的「CertificateSigningRequest.certSigningRequest」文件，的选择上传后点击继续：</p>
<img src="/posts/16027/1594885430506-a70cf350-35f8-4758-8d11-b8cf5486d354.png" class="" title="1594885430506-a70cf350-35f8-4758-8d11-b8cf5486d354">

<p>创建成功后点击「Download」下载，后缀为 <code>.cer</code> 文件：</p>
<img src="/posts/16027/1594885478624-b6b54634-1124-4aca-b800-77c7991986fc.png" class="" title="1594885478624-b6b54634-1124-4aca-b800-77c7991986fc">

<img src="/posts/16027/1594885502725-bebeb9e3-6a55-43ad-b947-6023ccde937f.png" class="" title="1594885502725-bebeb9e3-6a55-43ad-b947-6023ccde937f">

<p>保存到本地后同样双击证书导入钥匙串：</p>
<img src="/posts/16027/1594885646116-db9e333e-268b-4293-a3ac-3bfd3acef1aa.png" class="" title="1594885646116-db9e333e-268b-4293-a3ac-3bfd3acef1aa">

<p><strong>注意</strong></p>
<ul>
<li>有效证书左侧存在一个小三角标记，代表证书存在对应秘钥，导出时记得关闭小三角标记。有效推送证书的名称为<code>Apple Push Services</code>或<code>Apple Development IOS Push Services</code>。</li>
<li><code>Apple Push Services</code>命名是<code>通用环境推送证书</code></li>
<li><code>Apple Development IOS Push Services</code> 命名是 <code>开发环境推送证书</code></li>
</ul>
<p>点击左侧 钥匙串-登录-种类证书，找到刚才导入的证书，右击导出<code>.p12</code>证书，并为其设置密码：</p>
<img src="/posts/16027/1594886620406-e8586ad0-e6ca-4a79-9238-215b2bfd1cc1.png" class="" title="1594886620406-e8586ad0-e6ca-4a79-9238-215b2bfd1cc1">

<img src="/posts/16027/1594886432653-5b48abce-1bc1-45f6-b807-e181b028f948.png" class="" title="1594886432653-5b48abce-1bc1-45f6-b807-e181b028f948">

<h2 id="四-APNs-Auth-Key-证书（-p8-证书）"><a href="#四-APNs-Auth-Key-证书（-p8-证书）" class="headerlink" title="四. APNs Auth Key 证书（.p8 证书）"></a>四. APNs Auth Key 证书（.p8 证书）</h2><p>什么是 apns auth key:</p>
<p>Use the Apple Push Notification service for your notification requests. One key is used for all of your apps.（使用苹果推送通知服务通知服务，一个密钥可以用于你所有的应用程序）</p>
<p>而且正常的证书对应不同的 app，推送证书又有生产模式，开发者模式，使用起来非常的不方便。如果使用 apns auth key 就可以解决上述所有问题。</p>
<p>在控制台 - <code>Certificates, Identifiers &amp; Profiles</code>中，选择左侧<code>Key</code>，点击<code>+</code>新建。</p>
<img src="/posts/16027/1594886755529-8eaddc42-c245-488d-b701-504784a05f73.png" class="" title="1594886755529-8eaddc42-c245-488d-b701-504784a05f73">

<p>填写<code>Key Name</code>，勾选<code>Apple Push Notifications service (APNs)</code>，点击<code>Continue</code>按钮：</p>
<img src="/posts/16027/1594886822835-6fc8a3b2-f5da-4467-a652-4b99d225cdb8.png" class="" title="1594886822835-6fc8a3b2-f5da-4467-a652-4b99d225cdb8">

<p>点击注册：</p>
<img src="/posts/16027/1594886852251-d6ea99cf-7482-4c8a-8612-9a7124f535cf.png" class="" title="1594886852251-d6ea99cf-7482-4c8a-8612-9a7124f535cf">

<p>创建成功后，点击<code>Download</code>按钮下载。</p>
<p>注意：只能下载一次，妥善保管。</p>
<img src="/posts/16027/1594886917691-e4b89269-7b19-418f-bd57-584166dfea44.png" class="" title="1594886917691-e4b89269-7b19-418f-bd57-584166dfea44">

<p>点击下载或完成后会回退到控制台，上面显示有你刚刚创建的 Key：</p>
<img src="/posts/16027/1594886963068-96e1642e-fbdd-451f-bfee-00e69389a9a1.png" class="" title="1594886963068-96e1642e-fbdd-451f-bfee-00e69389a9a1">

<h2 id="五-Provisioning-Profile（描述文件）创建"><a href="#五-Provisioning-Profile（描述文件）创建" class="headerlink" title="五. Provisioning Profile（描述文件）创建"></a>五. Provisioning Profile（描述文件）创建</h2><p>在控制台 - <code>Certificates, Identifiers &amp; Profiles</code>中，选择左侧<code>Profiles</code>，点击<code>+</code>新建：</p>
<img src="/posts/16027/1594887275568-c495e110-353a-4b78-ab99-4506e47caf82.png" class="" title="1594887275568-c495e110-353a-4b78-ab99-4506e47caf82">

<p>选择此<code>Provisioning Profile</code>的环境后，点击<code>Continue</code>按钮：</p>
<img src="/posts/16027/1594887518943-7ffb64f2-64ac-4192-b361-c0ab28dee28e.png" class="" title="1594887518943-7ffb64f2-64ac-4192-b361-c0ab28dee28e">

<p>选择要创建<code>Provisioning Profile</code>的<code>App ID</code>后，点击<code>Continue</code>按钮：</p>
<img src="/posts/16027/1594887561994-9adf087e-349c-41fd-868c-48cfb6854b39.png" class="" title="1594887561994-9adf087e-349c-41fd-868c-48cfb6854b39">

<p>选择所属的开发者证书，（这里创建了多个开发者证书，建议只创建一个，方便管理）为了方便，选择了<code>Select All</code>，再点击<code>Continue</code>进入下一步：</p>
<img src="/posts/16027/1594887668290-be1143b1-b63d-4d91-b5b1-d3a55dbd105e.png" class="" title="1594887668290-be1143b1-b63d-4d91-b5b1-d3a55dbd105e">

<p>为该<code>Provisioning Profile</code>选择将要安装的设备（一般选择<code>Select All</code>），点击<code>Continue</code>。</p>
<p>注：App Store 或者 In House 默认所有设备。</p>
<img src="/posts/16027/1594887748290-a8349248-3dc8-4c91-ba71-d55a255d2100.png" class="" title="1594887748290-a8349248-3dc8-4c91-ba71-d55a255d2100">

<p>给该<code>Provisioning Profile</code>填写<code>Profile Name</code>，建议命名<code>环境+AppID</code>，点击<code>generate</code>完成创建。</p>
<img src="/posts/16027/1594887856732-4f82668f-4e6b-4028-a53e-713856db6856.png" class="" title="1594887856732-4f82668f-4e6b-4028-a53e-713856db6856">

<p>创建成功后就能下载到本地了：</p>
<img src="/posts/16027/1594887943226-0a83dd2a-ceb0-4e43-bfed-f1e662ddf1f7.png" class="" title="1594887943226-0a83dd2a-ceb0-4e43-bfed-f1e662ddf1f7">

<p>双击下载的<code>Provisioning Profile</code>文件，添加到<code>Xcode</code>，即可使用该<code>AppID(Bundle ID)</code>创建应用和进行真机调试。</p>
<h2 id="六-创建-App"><a href="#六-创建-App" class="headerlink" title="六. 创建 App"></a>六. 创建 App</h2><p>进入 <a href="https://appstoreconnect.apple.com/apps">https://appstoreconnect.apple.com/apps</a> 点击左上角「加号」来添加 app：</p>
<img src="/posts/16027/1594897913529-196b1812-e985-4e84-8a62-486746be4e3c.png" class="" title="1594897913529-196b1812-e985-4e84-8a62-486746be4e3c">

<img src="/posts/16027/1594897954861-3de37674-7029-470b-9dca-229b06723dd8.png" class="" title="1594897954861-3de37674-7029-470b-9dca-229b06723dd8">

<h2 id="七-发布-App-到-TestFlight"><a href="#七-发布-App-到-TestFlight" class="headerlink" title="七. 发布 App 到 TestFlight"></a>七. 发布 App 到 TestFlight</h2><p>Xcode 选择「Generic iOS Device」：</p>
<img src="/posts/16027/1594905858560-2e2e13f9-10d8-40d8-b286-a4730b60ede0.png" class="" title="1594905858560-2e2e13f9-10d8-40d8-b286-a4730b60ede0">

<p>菜单「Product -&gt; Archive」开始打包：</p>
<img src="/posts/16027/1594905886097-58d0e07d-15ff-4404-bd50-7fe5b877b9e3.png" class="" title="1594905886097-58d0e07d-15ff-4404-bd50-7fe5b877b9e3">

<p>接着选择「Validate App」进行验证：</p>
<img src="/posts/16027/1594906458754-920bc282-b1e3-4a50-9be8-3c95694b539e.png" class="" title="1594906458754-920bc282-b1e3-4a50-9be8-3c95694b539e">

<p>点「next」：</p>
<img src="/posts/16027/1594906485066-1e5b4c66-d2ad-4662-a991-f0f20cc534ef.png" class="" title="1594906485066-1e5b4c66-d2ad-4662-a991-f0f20cc534ef">

<p>选择手动签名：</p>
<img src="/posts/16027/1594906513638-2ad211c3-3e78-4af3-bac4-ea0c04cd252b.png" class="" title="1594906513638-2ad211c3-3e78-4af3-bac4-ea0c04cd252b">

<p>选择证书和 bundle id：</p>
<img src="/posts/16027/1594906542543-d12a879f-c80f-46c2-9700-b993163beb14.png" class="" title="1594906542543-d12a879f-c80f-46c2-9700-b993163beb14">

<p>接着点「Next」进行验证：</p>
<img src="/posts/16027/1594906656535-9c84ab3b-a98e-48c0-bfbb-347a46e8e476.png" class="" title="1594906656535-9c84ab3b-a98e-48c0-bfbb-347a46e8e476">

<p>验证通过后就可以选择「Distribute App」分发 app 了：</p>
<img src="/posts/16027/1594906754071-a872d477-bcbb-4056-87f0-c4c646f003ef.png" class="" title="1594906754071-a872d477-bcbb-4056-87f0-c4c646f003ef">

<p>一路点击最后选择 upload 上传就好了。</p>
<p>接着来到：<a href="https://appstoreconnect.apple.com/apps">https://appstoreconnect.apple.com/apps</a> 进入 TestFlight 查看你上传的 app：</p>
<img src="/posts/16027/1594909160793-31a36ffe-02a7-4714-a61a-0ea61aee527b.png" class="" title="1594909160793-31a36ffe-02a7-4714-a61a-0ea61aee527b">

<p>过一会有可能会出现状态变为如图所示：</p>
<img src="/posts/16027/1594909228013-0cf5ef31-00b5-4892-9e15-c9578fb28791.png" class="" title="1594909228013-0cf5ef31-00b5-4892-9e15-c9578fb28791">

<p>点击管理选择否然后就可以开始内部测试了：</p>
<img src="/posts/16027/1594905696761-7de9c5a9-40b9-4a23-a2c1-79e49632e8d6.png" class="" title="1594905696761-7de9c5a9-40b9-4a23-a2c1-79e49632e8d6">

<p>接着你可以在后台添加测试人员（邮箱）：</p>
<img src="/posts/16027/1594909424008-f6ff7f17-cf8d-44a5-bf06-26dc8991abe0.png" class="" title="1594909424008-f6ff7f17-cf8d-44a5-bf06-26dc8991abe0">

<p>添加后你所添加的测试人员的邮箱就会收到一封邀请，打开邮件，您会看到一个 TestFlight 前往的按钮，点一下，就会弹出来一个对话框，里面有一个邀请码，拷贝。</p>
<p>然后在手机上的 TestFlight “兑换”，帖上您的邀请码，确认。</p>
<p>然后就可以看到待安装的 App 了，安装，打开，输入账号密码，开启测试。</p>
<h2 id="十-附录"><a href="#十-附录" class="headerlink" title="十. 附录"></a>十. 附录</h2><h3 id="证书（Certificate）与描述文件（Provisioning-Profiles）"><a href="#证书（Certificate）与描述文件（Provisioning-Profiles）" class="headerlink" title="证书（Certificate）与描述文件（Provisioning Profiles）"></a><a href="https://www.cnblogs.com/rslai/p/9291159.html">证书（Certificate）与描述文件（Provisioning Profiles）</a></h3><h4 id="证书："><a href="#证书：" class="headerlink" title="证书："></a>证书：</h4><p>证书是用来给应用程序签名的，只有经过签名的应用程序才能保证他的来源是可信任的，并且代码是完整的， 未经修改的。在 Xcode Build Setting 的 Code Signing Identity 中，你可以设置用于为代码签名的证书。</p>
<h4 id="p12："><a href="#p12：" class="headerlink" title=".p12："></a>.p12：</h4><p>因为直接从 Apple 下载的证书只有公钥，没有私钥。没办法证明这个证书是你的(没有办法证明你有这个权利)。而从本地钥匙串中导出的.p12 文件是包含公钥和私钥的，也就是说可以把证书上描述的权利赋予他人。</p>
<h4 id="描述文件："><a href="#描述文件：" class="headerlink" title="描述文件："></a>描述文件：</h4><p>描述文件里包含了 App ID , Certificates （证书）, Devices（设备）。 说明生成描述文件需要用到这些信息。我们要打包或者在真机上运行一个应用程序，首先需要证书来进行签名，用来标识这个应用程序是合法的、安全的、完整的等等。然后需要指明它的 App ID，并且验证 Bundle ID 是否与其一致。再次，如果是真机调试，需要确认这台设备能否用来运行程序。而 Provisioning Profile 就把这些信息全部打包在一起，方便我们在调试和发布程序打包时使用，这样我们只要在不同的情况下选择不同的 profile 文件就可以了。而且这个 Provisioning Profile 文件会在打包时嵌入.ipa 的包里。</p>
<h2 id="七-参考链接"><a href="#七-参考链接" class="headerlink" title="七. 参考链接"></a>七. 参考链接</h2><p><a href="http://docs.getui.com/getui/mobile/ios/apns/">iOS 证书配置指南</a></p>
<p><a href="https://www.jianshu.com/p/ae11b893284b">手把手教你搞定 ios 的证书申请</a></p>
<p><a href="https://www.cnblogs.com/rslai/p/9291159.html">证书（Certificate）与描述文件（Provisioning Profiles）</a></p>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>解决&#39;node-pre-gyp WARN Using needle for node-pre-gyp https download&#39;问题</title>
    <url>/posts/36648/</url>
    <content><![CDATA[<p>华为云跑前端流水线发现进度一直卡在：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">node-pre-gyp WARN Using needle for node-pre-gyp https download</span><br></pre></td></tr></table></figure>

<p>进行不下去。</p>
<a id="more"></a>

<p>在本机进行测试：删除项目根目录下 <code>node_modules</code> 文件夹重新进行 <code>npm i </code> 安装发现也卡在这儿。但 <code>CTRL+C</code> 停止脚本执行后再 <code>npm i</code> 就不会卡主了，而且 <code>npm run dev</code> 执行脚本也能正常启动项目。如果你只是在本地安装，这也算是一个解决办法。</p>
<p>然而华为云流水线无法 <code>CTRL+C</code> 停止后在 <code>npm i</code> ，所以上述办法行不通。还是老老实实 google 下吧，然而搜了很多方案都没法解决此问题，最后在一个 github issue 中找到了解决方案：</p>
<p><a href="https://github.com/mapbox/node-pre-gyp/issues/526">https://github.com/mapbox/node-pre-gyp/issues/526</a></p>
<p>也就是用 <code>npm i --canvas_binary_host_mirror=https://npm.taobao.org/mirrors/node-canvas-prebuilt/</code> 替换 <code>npm i</code> 来执行。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>构建工具</category>
        <category>npm</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>解决canvas转image/jpeg透明背景变黑问题</title>
    <url>/posts/46911/</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>png 图片转 jpeg 时，透明区域被填充成黑色</p>
<h2 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h2><a id="more"></a>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Canvas：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border: 1px solid #ccc;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Base64转码后的图片：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;base64Img&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> base64Img = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;base64Img&#x27;</span>),</span></span><br><span class="line"><span class="javascript">        canvas = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;canvas&#x27;</span>),</span></span><br><span class="line"><span class="javascript">        ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 创建新图片</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> img = <span class="keyword">new</span> Image();</span></span><br><span class="line"><span class="javascript">      img.src = <span class="string">&#x27;off.png&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line">      img.addEventListener(</span><br><span class="line"><span class="javascript">        <span class="string">&#x27;load&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 绘制图片到canvas上</span></span></span><br><span class="line">          canvas.width = img.width;</span><br><span class="line">          canvas.height = img.height;</span><br><span class="line"></span><br><span class="line">          ctx.drawImage(img, 0, 0);</span><br><span class="line"></span><br><span class="line"><span class="javascript">          getBase64(canvas, <span class="function"><span class="keyword">function</span> (<span class="params">dataUrl</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 展示base64位的图片</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> newImg = <span class="built_in">document</span>.createElement(<span class="string">&#x27;img&#x27;</span>);</span></span><br><span class="line">            newImg.src = dataUrl;</span><br><span class="line"></span><br><span class="line">            base64Img.appendChild(newImg);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="literal">false</span></span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 获取canvas的base64图片的dataURL（图片格式为image/jpeg）</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">getBase64</span>(<span class="params">canvas, callback</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> dataURL = canvas.toDataURL(<span class="string">&#x27;image/jpeg&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="literal">undefined</span>) &#123;</span></span><br><span class="line">          callback(dataURL);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/posts/46911/canvas.png" class="" title="透明背景变黑">

<h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h2><p>canvas 转为 <code>jpeg</code> 之前会移除 <code>alpha</code> 通道，所以透明区域被填充成了黑色。</p>
<h2 id="期待效果"><a href="#期待效果" class="headerlink" title="期待效果"></a>期待效果</h2><p><code>canvas</code> 可以将 <code>png</code> 的透明区域填充成白色。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="1-将透明的-pixel-设成白色"><a href="#1-将透明的-pixel-设成白色" class="headerlink" title="1. 将透明的 pixel 设成白色"></a>1. 将透明的 pixel 设成白色</h3><p>因为 png 图片的背景都是透明的，所以我们可以寻找透明的 pixel，然后将其全部设置成白色。</p>
<p>代码片段：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将canvas的透明背景设置成白色</span></span><br><span class="line"><span class="keyword">var</span> imgData = ctx.getImageData(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line"><span class="keyword">var</span> data = imgData.data;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i += <span class="number">4</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (data[i + <span class="number">3</span>] &lt; <span class="number">255</span>) &#123;</span><br><span class="line">    data[i] = <span class="number">255</span> - data[i];</span><br><span class="line">    data[i + <span class="number">1</span>] = <span class="number">255</span> - data[i + <span class="number">1</span>];</span><br><span class="line">    data[i + <span class="number">2</span>] = <span class="number">255</span> - data[i + <span class="number">2</span>];</span><br><span class="line">    data[i + <span class="number">3</span>] = <span class="number">255</span> - data[i + <span class="number">3</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ctx.putImageData(imgData, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>完整代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Canvas：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border: 1px solid #ccc;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Base64转码后的图片：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;base64Img&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> base64Img = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;base64Img&#x27;</span>),</span></span><br><span class="line"><span class="javascript">        canvas = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;canvas&#x27;</span>),</span></span><br><span class="line"><span class="javascript">        ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 创建新图片</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> img = <span class="keyword">new</span> Image();</span></span><br><span class="line"><span class="javascript">      img.src = <span class="string">&#x27;off.png&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line">      img.addEventListener(</span><br><span class="line"><span class="javascript">        <span class="string">&#x27;load&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 绘制图片到canvas上</span></span></span><br><span class="line">          canvas.width = img.width;</span><br><span class="line">          canvas.height = img.height;</span><br><span class="line"></span><br><span class="line">          ctx.drawImage(img, 0, 0);</span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="comment">// 将canvas的透明背景设置成白色</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> imgData = ctx.getImageData(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> data = imgData.data;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i += <span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (data[i + <span class="number">3</span>] &lt; <span class="number">255</span>) &#123;</span></span><br><span class="line">              data[i] = 255 - data[i];</span><br><span class="line">              data[i + 1] = 255 - data[i + 1];</span><br><span class="line">              data[i + 2] = 255 - data[i + 2];</span><br><span class="line">              data[i + 3] = 255 - data[i + 3];</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          ctx.putImageData(imgData, 0, 0);</span><br><span class="line"></span><br><span class="line"><span class="javascript">          getBase64(canvas, <span class="function"><span class="keyword">function</span> (<span class="params">dataUrl</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 展示base64位的图片</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> newImg = <span class="built_in">document</span>.createElement(<span class="string">&#x27;img&#x27;</span>);</span></span><br><span class="line">            newImg.src = dataUrl;</span><br><span class="line"></span><br><span class="line">            base64Img.appendChild(newImg);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="literal">false</span></span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 获取canvas的base64图片的dataURL（图片格式为image/jpeg）</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">getBase64</span>(<span class="params">canvas, callback</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> dataURL = canvas.toDataURL(<span class="string">&#x27;image/jpeg&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="literal">undefined</span>) &#123;</span></span><br><span class="line">          callback(dataURL);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<img src="/posts/46911/tran2white.png" class="" title="透明转白">

<p>从图中可以看出这个方案是有缺陷的，当 png 图片上存在半透明区域时，也会将其填充为黑色。</p>
<p>解决方案来源：<a href="https://stackoverflow.com/questions/32160098/change-html-canvas-black-background-to-white-background-when-creating-jpg-image">Change html canvas black background to white background when creating jpg image from png image</a></p>
<h3 id="2-在-canvas-绘制前填充白色背景"><a href="#2-在-canvas-绘制前填充白色背景" class="headerlink" title="2. 在 canvas 绘制前填充白色背景"></a>2. 在 canvas 绘制前填充白色背景</h3><p>代码片段：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在canvas绘制前填充白色背景</span></span><br><span class="line">ctx.fillStyle = <span class="string">&#x27;#fff&#x27;</span>;</span><br><span class="line">ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br></pre></td></tr></table></figure>

<p>完整代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Canvas：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border: 1px solid #ccc;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Base64转码后的图片：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;base64Img&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> base64Img = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;base64Img&#x27;</span>),</span></span><br><span class="line"><span class="javascript">        canvas = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;canvas&#x27;</span>),</span></span><br><span class="line"><span class="javascript">        ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 创建新图片</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> img = <span class="keyword">new</span> Image();</span></span><br><span class="line"><span class="javascript">      img.src = <span class="string">&#x27;off.png&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line">      img.addEventListener(</span><br><span class="line"><span class="javascript">        <span class="string">&#x27;load&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 绘制图片到canvas上</span></span></span><br><span class="line">          canvas.width = img.width;</span><br><span class="line">          canvas.height = img.height;</span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="comment">// 在canvas绘制前填充白色背景</span></span></span><br><span class="line"><span class="javascript">          ctx.fillStyle = <span class="string">&#x27;#fff&#x27;</span>;</span></span><br><span class="line">          ctx.fillRect(0, 0, canvas.width, canvas.height);</span><br><span class="line"></span><br><span class="line">          ctx.drawImage(img, 0, 0);</span><br><span class="line"></span><br><span class="line"><span class="javascript">          getBase64(canvas, <span class="function"><span class="keyword">function</span> (<span class="params">dataUrl</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 展示base64位的图片</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> newImg = <span class="built_in">document</span>.createElement(<span class="string">&#x27;img&#x27;</span>);</span></span><br><span class="line">            newImg.src = dataUrl;</span><br><span class="line"></span><br><span class="line">            base64Img.appendChild(newImg);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="literal">false</span></span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 获取canvas的base64图片的dataURL（图片格式为image/jpeg）</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">getBase64</span>(<span class="params">canvas, callback</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> dataURL = canvas.toDataURL(<span class="string">&#x27;image/jpeg&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="literal">undefined</span>) &#123;</span></span><br><span class="line">          callback(dataURL);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<img src="/posts/46911/pre2white.png" class="" title="设置前设置白色背景">

<p>显然，在 canvas 绘制前填充白色背景这种方法，不仅简单，而且对 png 图片的半透明区域填充难看的黑色块。推荐这种解决方案。</p>
<p>解决方案来源：<a href="https://stackoverflow.com/questions/27736288/how-to-fill-the-whole-canvas-with-specific-color">How to fill the whole canvas with specific color</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>HTML</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>解决方案</tag>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>解决浮点数运算误差</title>
    <url>/posts/46988/</url>
    <content><![CDATA[<h3 id="解决什么问题"><a href="#解决什么问题" class="headerlink" title="解决什么问题"></a>解决什么问题</h3><p>前端计算产生的精度误差</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">0.14</span> * <span class="number">100</span>);</span><br><span class="line"><span class="comment">// log 14.000000000000002</span></span><br></pre></td></tr></table></figure>

<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><h4 id="不推荐-toFixed"><a href="#不推荐-toFixed" class="headerlink" title="不推荐 toFixed()"></a>不推荐 toFixed()</h4><a id="more"></a>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">100.</span>toFixed(<span class="number">2</span>)); <span class="comment">// 100.00</span></span><br><span class="line"><span class="built_in">console</span>.log((<span class="number">0.105</span>).toFixed(<span class="number">2</span>)); <span class="comment">// 0.10 与预期不符</span></span><br></pre></td></tr></table></figure>

<p>这种方法大部分场合都适用，但是存在尾数是 5 的时候会不进位的问题。</p>
<h4 id="不推荐-Math-round"><a href="#不推荐-Math-round" class="headerlink" title="不推荐 Math.round()"></a>不推荐 Math.round()</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.round(<span class="number">100</span> * <span class="number">100</span>) / <span class="number">100</span>); <span class="comment">//100</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.round(<span class="number">100.0</span> * <span class="number">100</span>) / <span class="number">100</span>); <span class="comment">//100</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.round(<span class="number">100.01</span> * <span class="number">100</span>) / <span class="number">100</span>); <span class="comment">//100.01</span></span><br></pre></td></tr></table></figure>

<p>这种方法存在当数字是整数或者小数点后数字为 0，或者原数字长度比我们要保留的长度短时，保留有问题的情况。</p>
<h4 id="推荐-自己封装"><a href="#推荐-自己封装" class="headerlink" title="推荐 自己封装"></a>推荐 自己封装</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>四舍五入保留指定小数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>n 数字</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>r 保留位数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">preciseRound</span>(<span class="params">n, r = <span class="number">2</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> int = <span class="built_in">Math</span>.floor(n).toString();</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> n !== <span class="string">&#x27;number&#x27;</span> || <span class="keyword">typeof</span> r !== <span class="string">&#x27;number&#x27;</span>) <span class="keyword">return</span> <span class="string">&#x27;Not a Number&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (int[<span class="number">0</span>] == <span class="string">&#x27;-&#x27;</span> || int[<span class="number">0</span>] == <span class="string">&#x27;+&#x27;</span>) int = int.slice(int[<span class="number">1</span>], int.length);</span><br><span class="line">  <span class="keyword">return</span> n.toPrecision(int.length + r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="四舍五入格式化金额"><a href="#四舍五入格式化金额" class="headerlink" title="四舍五入格式化金额"></a>四舍五入格式化金额</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将数值四舍五入(保留2位小数)后格式化成金额形式</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>num 数值(Number或者String)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return </span>金额格式的字符串,如&#x27;1,234,567.45&#x27;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@type <span class="variable">String</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatCurrency</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  num = num.toString().replace(<span class="regexp">/\$|\,/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">isNaN</span>(num)) num = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> sign = num == (num = <span class="built_in">Math</span>.abs(num));</span><br><span class="line">  num = <span class="built_in">Math</span>.floor(num * <span class="number">100</span> + <span class="number">0.50000000001</span>);</span><br><span class="line">  <span class="keyword">let</span> cents = num % <span class="number">100</span>;</span><br><span class="line">  num = <span class="built_in">Math</span>.floor(num / <span class="number">100</span>).toString();</span><br><span class="line">  <span class="keyword">if</span> (cents &lt; <span class="number">10</span>) cents = <span class="string">&#x27;0&#x27;</span> + cents;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">Math</span>.floor((num.length - (<span class="number">1</span> + i)) / <span class="number">3</span>); i++)</span><br><span class="line">    num =</span><br><span class="line">      num.substring(<span class="number">0</span>, num.length - (<span class="number">4</span> * i + <span class="number">3</span>)) +</span><br><span class="line">      <span class="string">&#x27;,&#x27;</span> +</span><br><span class="line">      num.substring(num.length - (<span class="number">4</span> * i + <span class="number">3</span>));</span><br><span class="line">  <span class="keyword">return</span> (sign ? <span class="string">&#x27;&#x27;</span> : <span class="string">&#x27;-&#x27;</span>) + num + <span class="string">&#x27;.&#x27;</span> + cents;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-20个ChromeDevTools调试技巧</title>
    <url>/posts/709/</url>
    <content><![CDATA[<p><strong>译者按：</strong> Chrome DevTools 很强大，甚至可以替代 IDE 了！</p>
<ul>
<li>原文: <a href="https://medium.com/frontmen/art-of-debugging-with-chrome-devtools-ab7b5fd8e0b4">Art of debugging with Chrome DevTools</a></li>
<li>译者: <a href="https://www.fundebug.com/">Fundebug</a></li>
</ul>
<p><strong>为了保证可读性，本文采用意译而非直译。另外，本文版权归原作者所有，翻译仅用于学习。</strong></p>
<p><strong>小编推荐：<a href="https://www.fundebug.com/">Fundebug</a>专注于 JavaScript、微信小程序、微信小游戏，Node.js 和 Java 线上 bug 实时监控。真的是一个很好用的 bug 监控服务，众多大佬公司都在使用。</strong></p>
<p>谷歌开发者工具提供了一系列的功能来帮助开发者高效 Debug 网页应用，让他们可以更快地查找和修复 bug。在谷歌的开发者工具中，有非常多有用的小工具，但是很多开发者并不知道。通过这篇文章，我把我常用的那些高效 Debug 的 Chrome 开发者工具的功能分享给大家。</p>
<p>_简洁起见，接下来我会使用<code>开发者工具</code>来指代<code>谷歌开发者工具</code>_。</p>
<p>在我们开始之前，你需要做一些准备工作。</p>
<a id="more"></a>

<h3 id="使用金丝雀版"><a href="#使用金丝雀版" class="headerlink" title="使用金丝雀版"></a><strong>使用金丝雀版</strong></h3><p>如果你想使用谷歌最新的版本和开发者工具，你可以下载<a href="https://www.google.com/chrome/canary/">金丝雀版本</a>，甚至把它设置为开发默认打开的浏览器。金丝雀版本旨在为早期接受者提供最新的更新。它可能不稳定，但是大多数时候是没问题的。你要习惯去使用最新最强的谷歌浏览器。</p>
<p><strong>1. 开启开发者工具的实验性功能</strong></p>
<p>你可以到<code>chrome://flags</code>页面，然后开启<code>Developer Tools experiments</code>选项。</p>
<p>当开启后，在开发者工具的设置页面，可以发现多了一个<code>Experiments</code>选项。如果我使用的一些功能你没有看到，那么请到<code>Experiments</code>窗口打开。</p>
<p><strong>2.超级实验性功能</strong></p>
<p>如果我使用到的功能在<code>Experiments</code>列表没有，那么它可能是一个 WIP 功能(WIP 指 working in progress)。你可以这样开启：页面处在<code>Experiments</code>界面，连续敲击<code>shift</code>键 6 次来开启 WIP 功能。</p>
<img src="/posts/709/Experiments.gif" class="" title="Experiments">

<h3 id="Console"><a href="#Console" class="headerlink" title="Console"></a><strong>Console</strong></h3><p>当 Debug 的时候，我们绝大部分时间是在和 Console 打交道。我们往往在代码中插入很多 Console logs，通过打印变量值来 debug。鉴于 Console 对于我们这么重要，很有必要了解所有开发者工具提供的相关的 APIs 和快捷键。</p>
<p><strong>3. 总是打印对象</strong></p>
<p>我的第一个建议其实和开发者工具没有关系，而是我一直使用的一个技巧。在使用<code>console.log();</code>的时候，不仅仅打印变量，而是要打印对象，用大括号(<code>&#123;&#125;</code>)将变量包围起来。这样的优点是不仅会把变量的值打印，同时还会将变量名打印出来。</p>
<img src="/posts/709/log.png" class="" title="log">
<img src="/posts/709/superlog.png" class="" title="superlog">

<p><strong>4. 使用 console.table 来打印多条目数据</strong></p>
<p>如果你要打印的变量是一个数组，每一个元素都是一个对象。我建议你使用<code>console.table</code>来打印，其表格化的呈现更加美观易读。</p>
<img src="/posts/709/logtable.png" class="" title="logtable">

<p><strong>5. 给 log 加点颜色</strong></p>
<p>log 有时候变得非常多，包含你自己的、一些第三方扩展或者浏览器的 logs。除了使用过滤器(filter)以外，你还可以使用颜色来更好地区分。</p>
<img src="/posts/709/logcolor.png" class="" title="logcolor">

<p><strong>6. $ 和 $$</strong></p>
<p>如果你在 console 下没有任何库使用<code>$</code>和<code>$$</code>，那么你可以使用它们分别作为<code>document.querySelector()</code> 和 <code>document.querySelectorAll()</code>的快捷键。</p>
<p>除了提供了一个更加快捷的方式外，还有一个好处，<code>$$</code>返回一个数组，而不是<a href="http://2ality.com/2013/05/quirk-array-like-objects.html">array-like</a>的<a href="https://developer.mozilla.org/en-US/docs/Web/API/NodeList">NodeList</a>. 所以你可以直接使用<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce">reduce</a>和<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">filter</a> 函数。</p>
<p>你可以使用<code>$$</code>检查页面中的无效链接：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.all(</span><br><span class="line">  $$(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    .map(<span class="function"><span class="params">link</span> =&gt;</span> link.href)</span><br><span class="line">    .map(<span class="function"><span class="params">href</span> =&gt;</span> fetch(href))</span><br><span class="line">)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;All links working&#x27;</span>))</span><br><span class="line">  .catch(<span class="function">() =&gt;</span> <span class="built_in">console</span>.error(<span class="string">&#x27;Some links are broken&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p><strong>7. $0</strong></p>
<p>如果你想引用某个 DOM 元素，使用<code>$0</code>。<code>$0</code>指向你当前在 Element 中选中的元素。如果指定了<code>$0</code>，<code>$1</code>指向之前选中的元素。以此类推，直到<code>$4</code>都可以使用。</p>
<p><strong>8. $_</strong></p>
<p><code>$_</code>记录了最后一次在 Console 计算的表达式。</p>
<p><strong>9. getEventListeners()</strong></p>
<p><code>getEventListeners(domElement)</code> 返回在 DOM 元素上注册的所有的事件。请看下面的例子：</p>
<img src="/posts/709/getEventListeners.gif" class="" title="getEventListeners">

<p>你也许注意到了，当我在 console 里输入表达式的时候，其结果立即被计算出来了。你可以看到我并没有敲击 Enter 键，而结果已经显示出来。这个是金丝雀版本的一个新功能，叫做”Eager Evaluation”。</p>
<img src="/posts/709/EagerEvaluation.png" class="" title="EagerEvaluation">

<p><strong>10. debug(fn)</strong></p>
<p>在上面的例子中，如果你想在点击按钮后的执行过程中暂停，你可以使用<code>debug</code>函数。<code>debug(fn)</code>接收一个函数作为参数，当每次该函数被调用时，Debugger 就会在该函数的第一行中断执行。</p>
<p>想象一下你要 debug 一个按钮的问题，但是你不知道这个按钮对应的事件函数在代码中什么位置。除了去大量的源代码中慢慢寻找之外，还有一个巧妙的方法。使用<code>getEventListeners</code>函数，然后将<code>debug</code>方法注入进去。这样，当你点击按钮的时候，就会在该函数的第一行停下来。</p>
<p><strong>11. copy(obj)</strong></p>
<p><code>copy(anything)</code> 是一个很有用的工具函数方便你将任何东西拷贝到系统的粘贴板暂存。</p>
<p>给<code>copy</code>函数传入一个没有格式的 JSON，会返回格式化的结果：</p>
<img src="/posts/709/copy.gif" class="" title="copy">

<p><strong>12. Top-level await</strong></p>
<p><code>async/await</code> 使得异步操作变得更加容易和可读。唯一的问题在于<code>await</code>需要在 async 函数中使用。如果我们要在 DevTools 的控制台使用，需要一些特殊的处理，使用<strong>I</strong>mmediately <strong>I</strong>nvoked <strong>A</strong>sync <strong>F</strong>unction <strong>E</strong>xpression (IIAFE). 一点都不方便。好在 DevTools 已经支持直接使用 await 了。</p>
<img src="/posts/709/await.png" class="" title="await">

<h3 id="Debugging-in-the-Sources-panel"><a href="#Debugging-in-the-Sources-panel" class="headerlink" title="Debugging in the Sources panel"></a>Debugging in the Sources panel</h3><p>在 source 面板，使用 breakpoints，stepping-into, stepping-over 等方式，你可以很好地掌控程序的执行状态，来发现代码问题。接下里我不会介绍大家都知道的基础内容，而是一些我经常使用的建议和技巧。</p>
<p><strong>13. 开启 auto-pretty print</strong></p>
<p>在金丝雀版本的实验模式下，你可以开启自动美化代码模式。</p>
<img src="/posts/709/autopre.png" class="" title="autopre">

<p><strong>14. 使用条件断点在生产环境中注入 console logs</strong></p>
<p>断点是一个很棒的功能。但还有一个更棒的：条件断点。只有当设定的条件满足的时候，中断才会执行。也就是说 DevTools 并不会每次都中断程序的执行，而只是在你想要它中断的时候才中断。想了解更多：查看<a href="https://developers.google.com/web/updates/2015/07/set-a-breakpoint-based-on-a-certain-condition">这里</a>.</p>
<p>在生产环境下，因为不能修改源代码，我喜欢使用条件断点来注入 console.log。如果我的断点仅仅是一个 console.log，DevTools 不会中断，因为 console.log 返回 undefined,，是一个 false 的值。但是它会执行我注入的表达式，可以看到输出结果。</p>
<p><a href="https://gitee.com/evestorm/various_resources/raw/master/tools/insertlog.gif"><img src="%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%9120%E4%B8%AAChromeDevTools%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/insertlog.gif" alt="img"></a></p>
<img src="/posts/709/insertlog.gif" class="" title="insertlog">

<p>为什么不直接使用普通的断点，并且查看变量呢？有时候我并不想这样做。比如，当我在分析那些频繁执行的操作，例如触摸或则滑动。我并不想每一次都导致 Debugger 触发程序中断，但是我想看到程序输出的结果。</p>
<p><strong>15. 暂停 UI 在 Hover 状态下的展示结果</strong></p>
<p>我们很难去检查一个只有在 Hover 状态下展示的元素。比如，如何去检查一个 tooltip？如果你右键并选择检查，元素已经消失了。那么有办法吗？</p>
<p>我是这么操作的：</p>
<ol>
<li>打开 sources 面板</li>
<li>显示 tooltip</li>
<li>使用快捷键来暂停脚本执行(将鼠标停留在暂停的图标上查看快捷键)</li>
<li>回到 Elements 面板，然后像通常一样去检查元素</li>
</ol>
<p><a href="https://gitee.com/evestorm/various_resources/raw/master/tools/tooltips.gif"><img src="%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%9120%E4%B8%AAChromeDevTools%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/tooltips.gif" alt="img"></a></p>
<img src="/posts/709/tooltips.gif" class="" title="tooltips">

<p><strong>16. XHR breakpoints</strong></p>
<p>如果想要理解一个请求是如何执行的，可以使用 sources 面板的 XHR breakpoints。</p>
<p><strong>17. 使用 DevTools 作为 IDE</strong></p>
<p>DevTools 的 source 面板可以说相当强大。你可以快速查找，跳转到某一行，某个函数，执行一段代码，使用多行光标等等。这些功能在<a href="https://medium.com/google-developers/devtools-tips-for-sublime-text-users-cdd559ee80f8">这篇 medium 文章中有详细描述</a>。</p>
<p>既然如此，为啥不把整个开发都搬到这里呢。这样就不需要浪费时间切换 IDE 和浏览器了。</p>
<p>如果你有一个使用<a href="https://github.com/facebook/create-react-app">create-react-app</a>或则<a href="https://github.com/vuejs/vue-cli">vue-cli</a>构建的项目，你可以直接把整个文件夹拖到 Sources 面板下。DevTools 会自动对所有文件做映射。所以，你可以在 DevTools 下修改文件并立即查看。这样，整个开发效率，特别是 Debugging 效率绝对提高了。</p>
<img src="/posts/709/ide.gif" class="" title="ide">

<p><strong>18. 使用 network overrides 来简单调试生产代码</strong></p>
<p>如果你正在 Debugging 一个生产环境下面的 bug，你可以使用<code>network overrides</code>来调试，而不用在本地搭建整个配置。</p>
<p>你可以很容易将任何远程的资源下载一份本地的版本，然后可以在 DevTools 下编辑，并且 DevTools 会更新展示你编辑后的文件。</p>
<img src="/posts/709/networkoverrides.gif" class="" title="networkoverrides">

<p>在生产环境下，也可以很容易 Debugging，并且做一些性能上的测试也变得容易。</p>
<h3 id="19-Nodejs-debugging"><a href="#19-Nodejs-debugging" class="headerlink" title="19. Nodejs debugging"></a><strong>19. Nodejs debugging</strong></h3><p>如果你想使用 DevTools 的 Debugger 来 debug Node.js 应用，你可以使用<code>--inspect-brk</code> flag 来开启：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">node --inspect-brk script.js</span><br></pre></td></tr></table></figure>

<p>跳转到<code>chrome://inspect</code>页面，在<code>Remote Target</code>选项，可以看到 Node 程序。</p>
<p>并且，在 DevTools 中你会看到一个绿色的 Node 图标，点击图标会打开针对 Node 的 Chrome Debugger。</p>
<p><a href="https://gitee.com/evestorm/various_resources/raw/master/tools/node-debuger.gif"><img src="%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%9120%E4%B8%AAChromeDevTools%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/node-debuger.gif" alt="img"></a></p>
<img src="/posts/709/node-debuger.gif" class="" title="node-debuger">

<p>如果你想要用 DevTools Debugger 来 debug 你的单元测试，你需要这样调用：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">copynode --inspect-brk .&#x2F;node_modules&#x2F;.bin&#x2F;jest</span><br></pre></td></tr></table></figure>

<p>不过这样做其实很麻烦，我们需要自己找到相应的路径。 GoogleChromeLabs 最近发布了一个新的工具非常好用，叫做：<a href="https://github.com/GoogleChromeLabs/ndb">ndb</a>。使用 ndb，你只需要：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ndb npx jest</span><br></pre></td></tr></table></figure>

<p>如果你有一个自定义的脚本，你可以这样调用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ndb npm run unit</span><br></pre></td></tr></table></figure>

<p>更妙的是，如果你在一个有配置<code>package.json</code>的项目下调用<code>ndb</code>，他甚至会自动分析 package.json 中的脚本，方便你直接使用 DevTools。</p>
<p><strong>20. 使用 Snippets 来辅助 Debugging</strong></p>
<p>DevTools 提供了一个可以创建和保存小段代码的工具，我很喜欢用它们来加速我的工作。比如 lodashify —  可以快速给任何应用添加 lodash。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  &#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> element = <span class="built_in">document</span>.createElement(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">  element.src =</span><br><span class="line">    <span class="string">&#x27;https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.15.0/lodash.min.js&#x27;</span>;</span><br><span class="line">  element.type = <span class="string">&#x27;text/javascript&#x27;</span>;</span><br><span class="line">  <span class="built_in">document</span>.head.appendChild(element);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>另一个小的工具函数式用来增强对象的属性，每次被访问或则修改，它都会提供给我充分的信息，比如谁访问了，谁更改了它。在 Debugging 的时候，非常有用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> traceProperty = <span class="function">(<span class="params">object, property</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> value = object[property];</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(object, property, &#123;</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.trace(<span class="string">`<span class="subst">$&#123;property&#125;</span> requested`</span>);</span><br><span class="line">      <span class="keyword">return</span> value;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">newValue</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.trace(<span class="string">`setting <span class="subst">$&#123;property&#125;</span> to `</span>, newValue);</span><br><span class="line">      value = newValue;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><a href="https://gitee.com/evestorm/various_resources/raw/master/tools/methodtools.gif"><img src="%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%9120%E4%B8%AAChromeDevTools%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/methodtools.gif" alt="img"></a></p>
<img src="/posts/709/methodtools.gif" class="" title="methodtools">

<p>还有很多非常有用的<a href="http://bgrins.github.io/devtools-snippets/">devtools 代码片段</a>，你可以直接拿去使用。</p>
<h3 id="关于-Fundebug"><a href="#关于-Fundebug" class="headerlink" title="关于 Fundebug"></a>关于 Fundebug</h3><p><a href="https://www.fundebug.com/">Fundebug</a>专注于 JavaScript、微信小程序、微信小游戏、支付宝小程序、React Native、Node.js 和 Java 实时 BUG 监控。 自从 2016 年双十一正式上线，Fundebug 累计处理了 6 亿+错误事件，得到了 Google、360、金山软件等众多知名用户的认可。欢迎免费试用！</p>
<p>版权声明:<br>转载时请注明作者 Fundebug 以及本文地址：<br><a href="https://blog.fundebug.com/2018/08/22/art-of-debugging-with-chrome-devtools/">https://blog.fundebug.com/2018/08/22/art-of-debugging-with-chrome-devtools/</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>浏览器</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-CSS-currentColor变量的使用</title>
    <url>/posts/30008/</url>
    <content><![CDATA[<p>转载自：<a href="https://www.cnblogs.com/Wayou/p/css-currentColor.html">https://www.cnblogs.com/Wayou/p/css-currentColor.html</a></p>
<p>CSS 中存在一个神秘的变量，少有人知自然也不怎么为人所用。它就是<code>currentColor</code>变量（或者说是 CSS 关键字，但我觉得称为变量好理解些）。</p>
<h1 id="初识"><a href="#初识" class="headerlink" title="初识"></a>初识</h1><p>它是何物？具有怎样的功效？它从哪里来？带着这些疑问我们继续。</p>
<a id="more"></a>

<p>下面是来自<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/color_value#currentColor_keyword">MDN 的解释</a>：</p>
<blockquote>
<p><code>currentColor</code>代表了当前元素被应用上的<code>color</code>颜色值。 使用它可以将当前这个颜色值应用到其他属性上，或者嵌套元素的其他属性上。</p>
</blockquote>
<p>你这可以这么理解，CSS 里你可以在任何需要写颜色的地方使用<code>currentColor</code>这个变量，这个变量的值是当前元素的<code>color</code>值。如果当前元素没有在 CSS 里显示地指定一个<code>color</code>值，那它的颜色值就遵从 CSS 规则，从父级元素继承而来。</p>
<p>到此似乎解决了上面三个哲学式的提问，但依然有些模糊。程序员之间的交流，还是上码才好。</p>
<ul>
<li>场景 1</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>约么？<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">p&#123; color: red; &#125;</span><br></pre></td></tr></table></figure>

<p>此时，<code>&lt;p&gt;</code>标签<code>currentColor</code>的值为<code>red</code>。</p>
<ul>
<li>场景 2</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>约么？<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">.container&#123; color: #00ff00; &#125;</span><br></pre></td></tr></table></figure>

<p>现在，我们没有给<code>&lt;p&gt;</code>标签指定颜色，它的<code>color</code>从父级容器也就是<code>class</code>为<code>container</code>的<code>div</code>继承而来，换句话说此时<code>p</code>标签的<code>color</code>为<code>#00ff00</code>，<code>currentColor</code>又是直接去取元素的<code>color</code>值，所以此时<code>p</code>标签的<code>currentColor</code>值也为<code>#00ff00</code>。</p>
<img src="/posts/30008/071703026553532.png" class="" width="071703026553532">

<ul>
<li>场景 3</li>
</ul>
<p>如果父级元素也没有写<code>color</code>呢？其实这里都还是 CSS 规则的范畴，跟本文的主角关系不太大。但本着不啰嗦会死的原则，就展开了讲。</p>
<p>如果父级元素也没有指定颜色，那它的父级元素就会从父级的父级去继承，直到文档的根结点<code>html</code>标签都还没显示指定一个颜色呢，就应用上浏览器默认的颜色呗~</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>我来组成头部<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>约么？<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span>战神金钢，宇宙的保护神！<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">/** * 无CSS */</span><br></pre></td></tr></table></figure>

<img src="/posts/30008/071703151234623.png" class="" width="071703151234623">

<p>那，这个时候的黑色其实是浏览器默认给的。此时<code>p</code>标签的<code>currentColor</code>自然也跟<code>color</code>值一样，为黑色，纯黑的<code>#000</code>。</p>
<h1 id="如何用？"><a href="#如何用？" class="headerlink" title="如何用？"></a>如何用？</h1><p>了解它是怎样的物品后，下面问题来了，如何用？有额外的<code>buff</code>效果么，耗蓝多么，CD 时间长么。。。</p>
<p>前面说道，它就是一个 CSS 变量，存储了颜色值，这个值来自当前元素的<code>color</code>CSS 属性。当你需要为该元素其他属性指定颜色的时候，它就可以登上舞台了。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span>好好说话，有话好好说<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">.container&#123; color: #3CAADB; border: 4px solid currentColor; &#125;</span><br></pre></td></tr></table></figure>

<p>这里我们第一次领略了<code>currentColor</code>的奇效。在指定边框颜色的时候，我们直接使用<code>currentColor</code>变量，而没有写一个传统的颜色值。</p>
<p>你似乎也知道了该如何用了。不只是<code>border</code>，其他能够使用颜色的地方，比如<code>background</code>，<code>box-shadow</code>等等。</p>
<h1 id="带你装逼带你飞"><a href="#带你装逼带你飞" class="headerlink" title="带你装逼带你飞"></a>带你装逼带你飞</h1><p>新技能就是如此炫酷。大开脑洞任性地去使用吧！</p>
<h2 id="与渐变混搭"><a href="#与渐变混搭" class="headerlink" title="与渐变混搭"></a>与渐变混搭</h2><p>你可能无法想象到的是，除了可以将<code>currentColor</code>用到普通需要颜色的场景，它同样可以被用在渐变中。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">.container&#123; height:200px; color: #3CAADB; background-image: linear-gradient(to</span><br><span class="line">right, #fff, currentColor 100%); &#125;</span><br></pre></td></tr></table></figure>

<p>甚至也可用于填充 svg，下面会有相应示例。</p>
<h2 id="与-CSS-动画结合"><a href="#与-CSS-动画结合" class="headerlink" title="与 CSS 动画结合"></a>与 CSS 动画结合</h2><p>当与 CSS <code>animation</code>结合，可以得到更加有创意的效果，比如<a href="http://codepen.io/scottkellum/pen/Fhxql">这个来自 codepen 的示例</a></p>
<p>See the Pen <a href="http://codepen.io/scottkellum/pen/Fhxql/">currentColor</a> by Scott Kellum (<a href="http://codepen.io/scottkellum">@scottkellum</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<h2 id="更加简洁的-CSS"><a href="#更加简洁的-CSS" class="headerlink" title="更加简洁的 CSS"></a>更加简洁的 CSS</h2><p>其实，新技能不只是装逼那么单纯，合理的使用<code>currentColor</code> 变量会让你的 CSS 代码变得简洁。这才是我们想要达到的目的。以炫技为目的技能是没有生产意义的。</p>
<p>看下面这个例子（这个示例灵感来自<a href="http://osvaldas.info/keeping-css-short-with-currentcolor">这里</a>）</p>
<img src="/posts/30008/071703343112594.png" class="" width="071703343112594">

<p>我们在按钮中使用了一个 svg 图标。你是一个负责任的 FE，所以，对这个按钮的各种状态<code>:focus</code>，<code>:hover</code>，<code>:active</code>都作了样式上的处理。同时，为了让图标也跟着保持一致的姿态变更，需要把对<code>&lt;a&gt;</code>标签的样式处理同样就到到<code>&lt;svg&gt;</code>标签上。于是你的 CSS 代码看起来就是下面这样的了。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*a 标签*/</span></span><br><span class="line"><span class="selector-class">.button</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#117b6f</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.2em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#01b19a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#02d7bb</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*svg 标签*/</span></span><br><span class="line"><span class="selector-class">.button</span> <span class="selector-tag">svg</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">17px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">17px</span>;</span><br><span class="line">  <span class="attribute">fill</span>: <span class="number">#117b6f</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">:hover</span> <span class="selector-tag">svg</span>,</span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">:focus</span> <span class="selector-tag">svg</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: <span class="number">#01b19a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">:active</span> <span class="selector-tag">svg</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: <span class="number">#02d7bb</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你也发现了，代码有点冗余。接下来，我们用<code>currentColor</code>来将它简化一下。于是成了下面这样：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*a 标签*/</span></span><br><span class="line"><span class="selector-class">.button</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#117b6f</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.2em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#01b19a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#02d7bb</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*svg 标签*/</span></span><br><span class="line"><span class="selector-class">.button</span> <span class="selector-tag">svg</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">17px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">17px</span>;</span><br><span class="line">  <span class="attribute">fill</span>: currentColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="更好维护的-CSS"><a href="#更好维护的-CSS" class="headerlink" title="更好维护的 CSS"></a>更好维护的 CSS</h2><p>仔细想想不难发现，当使用<code>currentColor</code>后，我们的 CSS 也变得更加好维护了。</p>
<p>还拿上面的按钮示例来说，优化之前不但代码冗余，而且哪天 PM 来劲了说这颜色饱看，给换个其他色。于是你得把<code>&lt;a&gt;</code>标签和<code>&lt;svg&gt;</code>一起换了。</p>
<p>但优化后就不一样了，因为<code>&lt;svg&gt;</code>使用的填充是<code>currentColor</code>，你只需要改变<code>&lt;a&gt;</code>标签的颜色，它也就跟着变了。真正做到了牵一发而不动全身。这不正是众码友们毕生所追求的理想编程境界么。</p>
<h1 id="浏览器兼容性"><a href="#浏览器兼容性" class="headerlink" title="浏览器兼容性"></a>浏览器兼容性</h1><p>一提到浏览器兼容性，FE 同学们或许就不敢那么任性了。之前你可能是这样的：</p>
<img src="/posts/30008/071703530141880.gif" class="" width="071703530141880">

<p>当听到 IE 传来的噩耗，你可能是这样的：</p>
<img src="/posts/30008/071704166706318.gif" class="" width="071704166706318">

<p>经查，<a href="http://caniuse.com/#search=currentcolor">can i use</a> 没有关于它的数据。</p>
<p>经测，</p>
<ul>
<li>本机 Win7 搭载的 IE8 不支持</li>
<li>本机安装的火狐 31 发来战报表示支持</li>
<li>Chrome，你猜？</li>
<li>本机 Safari 5.1.7 也表示支持</li>
<li>本机 Opera 26 同样表示支持</li>
</ul>
<p>根据<a href="http://demosthenes.info/blog/908/The-First-CSS-Variable-currentColor">这篇文章</a>的描述，它是可以很好地工作在在所有现代浏览器和 IE9+上的，甚至是各浏览器对应的移动版本。所以，在 IE 不是主要客户对象的情况下，还是可以放心使用的。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://css-tricks.com/currentcolor/">css-tricks currentColor</a></li>
<li><a href="http://osvaldas.info/keeping-css-short-with-currentcolor">Keeping CSS short with currentColor</a></li>
<li><a href="http://demosthenes.info/blog/908/The-First-CSS-Variable-currentColor">The First CSS Variable: currentColor</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-CSS3不规则投影（filter/drop-shadow）滤镜</title>
    <url>/posts/48484/</url>
    <content><![CDATA[<p>转载地址：</p>
<p><a href="https://www.jianshu.com/p/5cbab78f02b3">https://www.jianshu.com/p/5cbab78f02b3</a></p>
<p>codepen 地址：</p>
<p><a href="https://codepen.io/JingW/pen/OJMWgOP">https://codepen.io/JingW/pen/OJMWgOP</a></p>
<iframe height="692" scrolling="no" title="filter(drop-shadow)" src="https://codepen.io/JingW/embed/OJMWgOP?height=692&amp;theme-id=light&amp;default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 997.594px;"></iframe>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>CSS3</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-H5移动端开发遇到的问题集合总结</title>
    <url>/posts/9479/</url>
    <content><![CDATA[<h2 id="转载来源"><a href="#转载来源" class="headerlink" title="转载来源"></a>转载来源</h2><p><a href="https://juejin.im/post/6844903959287562254">掘金 - 稍微整理了几个经常在 H5 移动端开发遇到的东西 😢</a></p>
<h2 id="弹出数字键盘"><a href="#弹出数字键盘" class="headerlink" title="弹出数字键盘"></a>弹出数字键盘</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 有&quot;#&quot; &quot;*&quot;符号输入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;tel&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 纯数字 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">pattern</span>=<span class="string">&quot;\d*&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p><code>安卓</code>跟<code>IOS</code>的表现形式应该不一样，大家可以自己试试。当运用了正则<code>pattern</code>后，就不用关注<code>input</code>的类型了 😂</p>
<img src="/posts/9479/keyboard.png" class="" title="软键盘">

<h2 id="调用系统的某些功能"><a href="#调用系统的某些功能" class="headerlink" title="调用系统的某些功能"></a>调用系统的某些功能</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 拨号 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;tel:10086&quot;</span>&gt;</span>打电话给: 10086<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 发送短信 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;sms:10086&quot;</span>&gt;</span>发短信给: 10086<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 发送邮件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;mailto:839626987@qq.com&quot;</span>&gt;</span>发邮件给：839626987@qq.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 选择照片或者拍摄照片 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 选择视频或者拍摄视频 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;video/*&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 多选 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">multiple</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>同上 🤦‍♂️</p>
<img src="/posts/9479/default-behavior.png" class="" title="默认行为">

<h2 id="打开原生应用"><a href="#打开原生应用" class="headerlink" title="打开原生应用"></a>打开原生应用</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;weixin://&quot;</span>&gt;</span>打开微信<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;alipays://&quot;</span>&gt;</span>打开支付宝<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;alipays://platformapi/startapp?saId=10000007&quot;</span>&gt;</span></span><br><span class="line">  打开支付宝的扫一扫功能</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;alipays://platformapi/startapp?appId=60000002&quot;</span>&gt;</span>打开支付宝的蚂蚁森林<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这种方式叫做<code>URL Scheme</code>，是一种协议，一般用来访问<code>APP</code>或者<code>APP</code>中的某个功能/页面（如唤醒<code>APP</code>后打开指定页面或者使用某些功能）😒</p>
<p><code>URL Scheme</code>的基本格式如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">     行为(应用的某个功能/页面)</span><br><span class="line">            |</span><br><span class="line">scheme://[path][?query]</span><br><span class="line">   |               |</span><br><span class="line">应用标识       功能需要的参数</span><br></pre></td></tr></table></figure>

<p>一般是由<code>APP</code>开发者自己定义，比如规定一些<code>参数</code>或者<code>路径</code>让其他开发者来访问，就像上面的例子 🍤</p>
<p>注意事项：</p>
<ul>
<li>唤醒<code>APP</code>的条件是你的手机已经安装了该<code>APP</code></li>
<li>某些浏览器会禁用此协议，比如微信内部浏览器（除非开了白名单）</li>
</ul>
<h2 id="解决-active-伪类失效"><a href="#解决-active-伪类失效" class="headerlink" title="解决 active 伪类失效"></a>解决 active 伪类失效</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ontouchstart</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>给 body 注册一个空事件即可 😂</p>
<h2 id="忽略自动识别"><a href="#忽略自动识别" class="headerlink" title="忽略自动识别"></a>忽略自动识别</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 忽略浏览器自动识别数字为电话号码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;format-detection&quot;</span> <span class="attr">content</span>=<span class="string">&quot;telephone=no&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 忽略浏览器自动识别邮箱账号 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;format-detection&quot;</span> <span class="attr">content</span>=<span class="string">&quot;email=no&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>当页面上的内容包含了手机号/邮箱等，会自动转换成可点击的链接 😁</p>
<p>比如你有如下代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>13192733603<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>但是有些浏览器会识别为手机，并且可以点击拨号 😒</p>
<h2 id="解决-input-失焦后页面没有回弹"><a href="#解决-input-失焦后页面没有回弹" class="headerlink" title="解决 input 失焦后页面没有回弹"></a>解决 input 失焦后页面没有回弹</h2><p>一般出现在<code>IOS设备中的微信内部浏览器</code>，出现的条件为：</p>
<ul>
<li>页面高度过小</li>
<li>聚焦时，页面需要往上移动的时候</li>
</ul>
<p>所以一般<code>input</code>在页面上方或者顶部都不会出现无法回弹 🤣</p>
<p>解决办法为，在聚焦时，获取当前滚动条高度，然后失焦时，赋值之前获取的高度：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">focus</span>=<span class="string">&quot;focus&quot;</span> @<span class="attr">blur</span>=<span class="string">&quot;blur&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        scrollTop: 0</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">focus</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.scrollTop = <span class="built_in">document</span>.scrollingElement.scrollTop;</span></span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">blur</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.scrollingElement.scrollTo(<span class="number">0</span>, <span class="built_in">this</span>.scrollTop);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="禁止长按"><a href="#禁止长按" class="headerlink" title="禁止长按"></a>禁止长按</h2><p>以上行为可以总结成这几个（每个手机以及浏览器的表现形式不一样）：<code>长按图片保存</code>、<code>长按选择文字</code>、<code>长按链接/手机号/邮箱时呼出菜单</code>。</p>
<p>想要禁止这些浏览器的默认行为，可以使用以下<code>CSS</code>：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">// 禁止长按图片保存</span><br><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-touch-callout</span>: none;</span><br><span class="line">  pointer-events: none; // 像微信浏览器还是无法禁止，加上这行样式即可</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 禁止长按选择文字</span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-user-select</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 禁止长按呼出菜单</span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-touch-callout</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="滑动不顺畅，粘手"><a href="#滑动不顺畅，粘手" class="headerlink" title="滑动不顺畅，粘手"></a>滑动不顺畅，粘手</h2><p>一般出现在<code>IOS</code>设备中，自定义盒子使用了<code>overflow: auto || scroll</code>后出现的情况。</p>
<p>优化代码：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-overflow-scrolling</span>: touch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="屏幕旋转为横屏时，字体大小会变"><a href="#屏幕旋转为横屏时，字体大小会变" class="headerlink" title="屏幕旋转为横屏时，字体大小会变"></a>屏幕旋转为横屏时，字体大小会变</h2><p>具体出现的情况不明 😒，有时候有有时候没有，欢迎指出。</p>
<p>优化代码：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">-webkit-text-size-adjust</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="最简单的-rem-自适应"><a href="#最简单的-rem-自适应" class="headerlink" title="最简单的 rem 自适应"></a>最简单的 rem 自适应</h2><p>大家都知道，rem 的值是根据根元素的字体大小相对计算的，但是我们每个设备的大小不一样，所以根元素的字体大小要动态设置 😂</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">100vw</span> / <span class="number">3.75</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.14rem</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p>像我一般的话，直接搞 lib-flexible、postcss-pxtorem 就完事啦！</p>
<h2 id="滑动穿透"><a href="#滑动穿透" class="headerlink" title="滑动穿透"></a>滑动穿透</h2><p>当你想在出现<code>遮罩</code>的时候，锁住用户的滚动行为，你可以这么做。</p>
<p>假设<code>HTML</code>结构如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mask&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>我是弹框<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>CSS</code>样式如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.mask</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>($color: #<span class="number">333</span>, $alpha: <span class="number">0.6</span>);</span><br><span class="line"></span><br><span class="line">  .content &#123;</span><br><span class="line">    <span class="selector-tag">padding</span>: 20<span class="selector-tag">px</span>;</span><br><span class="line">    <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span><br><span class="line">    <span class="selector-tag">width</span>: 300<span class="selector-tag">px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p>可以看到，当在<code>遮罩</code>上滑动的时候，是会穿透到父节点的，最简单的办法就是阻住默认行为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">&#x27;.mask&#x27;</span>).addEventListener(<span class="string">&#x27;touchmove&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  event.preventDefault(&#123;</span><br><span class="line">    passive: <span class="literal">false</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<p>如果在<code>vue</code>中，你可以这么写：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mask&quot;</span> @<span class="attr">touchumove.prevent</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果<code>.content</code>也有滚动条，那么只要阻止<code>遮罩</code>本身就行：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">&#x27;.mask&#x27;</span>).addEventListener(<span class="string">&#x27;touchmove&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.target.classList.contains(<span class="string">&#x27;mask&#x27;</span>))</span><br><span class="line">    event.preventDefault(&#123;</span><br><span class="line">      passive: <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mask&quot;</span> @<span class="attr">touchumove.self.prevent</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样，当出现<code>遮罩</code>的时候用户的滑动就会被锁住啦 👌</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><ul>
<li><a href="https://www.cnblogs.com/xiahj/p/8036419.html">深入研究-webkit-overflow-scrolling:touch 及 ios 滚动</a></li>
<li><a href="https://juejin.im/post/6844903519410094088">-webkit-overflow-scrolling:touch 属性副作用–QQ 内置浏览器空白处理</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>移动端</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>移动端</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-JavaScript扩展运算符的13个用法</title>
    <url>/posts/46865/</url>
    <content><![CDATA[<p>转载自：<a href="https://mp.weixin.qq.com/s/57rsKjxtXcmpOLz61u4l2g">https://mp.weixin.qq.com/s/57rsKjxtXcmpOLz61u4l2g</a></p>
<p>我相信你一定或多或少的接触或使用过 <code>JS</code> 中的扩展操作符（Spread Operator），在基本形式中，扩展操作符看起来像三个点，比如如下这样：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[...arr];</span><br></pre></td></tr></table></figure>

<p>而实际上，它也就是这么用的，但是如果事情有这么简单，就不用我在这里写了。扩展操作符给我最大的印象就是，这玩意还挺方便的，然而最近写代码的时候经常性的遇到需要使用扩展操作符的场景，所以我干脆在网上找了些资料，把平时常见的应用场景给罗列了下，发现这个操作符是真的强大，有多强大？来看看下面这些用法吧。</p>
<a id="more"></a>

<h2 id="字符串转数组"><a href="#字符串转数组" class="headerlink" title="字符串转数组"></a>字符串转数组</h2><p>字符串转数组最普遍的做法是这样：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> arr = str.split(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// [&#x27;h&#x27;, &#x27;e&#x27;, &#x27;l&#x27;, &#x27;l&#x27;, &#x27;o&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>而使用了扩展操作符后可以这样：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> arr = [...str];</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// [&#x27;h&#x27;, &#x27;e&#x27;, &#x27;l&#x27;, &#x27;l&#x27;, &#x27;o&#x27;]</span></span><br></pre></td></tr></table></figure>

<h2 id="将类数组转换为数组"><a href="#将类数组转换为数组" class="headerlink" title="将类数组转换为数组"></a>将类数组转换为数组</h2><p>在 <code>JS</code> 中有一种数据结构叫做 <code>NodeList</code>，它和数组很相似，也被叫做“类数组”，类数组是什么？在 MDN 中是这么定义它的：</p>
<blockquote>
<p>类数组：拥有一个 length 属性和若干索引属性的任意对象。</p>
</blockquote>
<p>类数组有哪些呢？以下这些可以看成是类数组：</p>
<ul>
<li><code>NodeList</code>：<code>document.querySelectorAll()</code> 返回的对象；</li>
<li><code>HTMLCollection</code>：<code>document.getElementsByTagName()</code> 返回的对象；</li>
<li><code>Arguments</code>：函数里的参数对象；</li>
</ul>
<p>类数组没有数组的一些方法比如 <code>push</code>、<code>map</code> 等，所以经常需要将它们转成数组，而通常我们是这么转化的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> nodeList = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(nodeList <span class="keyword">instanceof</span> NodeList); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = <span class="built_in">Array</span>.apply(<span class="literal">null</span>, nodeList);</span><br><span class="line"><span class="built_in">console</span>.log(arr <span class="keyword">instanceof</span> <span class="built_in">Array</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="keyword">let</span> arr2 = [].slice.call(nodeList);</span><br><span class="line"><span class="built_in">console</span>.log(arr2 <span class="keyword">instanceof</span> <span class="built_in">Array</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 又或者</span></span><br><span class="line"><span class="keyword">let</span> arr3 = <span class="built_in">Array</span>.from(nodeList);</span><br><span class="line"><span class="built_in">console</span>.log(arr3 <span class="keyword">instanceof</span> <span class="built_in">Array</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>而有了扩展操作符可以这么做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> nodeList = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> arr = [...nodeList];</span><br><span class="line"><span class="built_in">console</span>.log(arr <span class="keyword">instanceof</span> <span class="built_in">Array</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="向数组中添加项"><a href="#向数组中添加项" class="headerlink" title="向数组中添加项"></a>向数组中添加项</h2><p>往数组中添加几项通常这样操作：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从头部添加</span></span><br><span class="line">arr.unshift(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// [1, 2, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从尾部添加</span></span><br><span class="line">arr.push(<span class="number">6</span>, <span class="number">7</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// [1，2, 5, 6, 7]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从任意位置添加</span></span><br><span class="line">arr.splice(<span class="number">2</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// [1，2, 3, 4, 5, 6, 7]</span></span><br></pre></td></tr></table></figure>

<p>使用扩展操作符后：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">arr = [<span class="number">1</span>, <span class="number">2</span>, ...arr, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure>

<h2 id="拷贝数组和对象"><a href="#拷贝数组和对象" class="headerlink" title="拷贝数组和对象"></a>拷贝数组和对象</h2><p>通常拷贝一个数组，可以这么做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> arr2 = arr.concat();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="keyword">let</span> arr3 = arr.slice();</span><br><span class="line">arr[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// [2, 3, 5, 7]</span></span><br><span class="line"><span class="built_in">console</span>.log(arr2); <span class="comment">// [1, 3, 5, 7]</span></span><br><span class="line"><span class="built_in">console</span>.log(arr3); <span class="comment">// [1, 3, 5, 7]</span></span><br></pre></td></tr></table></figure>

<p>但是有了扩展操作符，拷贝数组就能写得很简单：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> arr2 = [...arr];</span><br><span class="line">arr[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr2); <span class="comment">// [1, 3, 5, 7]</span></span><br></pre></td></tr></table></figure>

<p>同样的，扩展操作符还能拷贝对象。拷贝对象的通常做法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123; <span class="attr">name</span>: <span class="string">&#x27;布兰&#x27;</span>, <span class="attr">age</span>: <span class="number">12</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> p2 = <span class="built_in">Object</span>.assign(&#123;&#125;, person);</span><br><span class="line">person.age = <span class="number">20</span>;</span><br><span class="line"><span class="built_in">console</span>.log(person); <span class="comment">// &#123; name: &#x27;布兰&#x27;, age: 20 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(p2); <span class="comment">// &#123; name: &#x27;布兰&#x27;, age: 12 &#125;</span></span><br></pre></td></tr></table></figure>

<p>有了扩展操作符，拷贝一个对象就相当方便了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123; <span class="attr">name</span>: <span class="string">&#x27;布兰&#x27;</span>, <span class="attr">age</span>: <span class="number">12</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> p2 = &#123; ...person &#125;;</span><br><span class="line">person.age = <span class="number">20</span>;</span><br><span class="line"><span class="built_in">console</span>.log(person); <span class="comment">// &#123; name: &#x27;布兰&#x27;, age: 20 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(p2); <span class="comment">// &#123; name: &#x27;布兰&#x27;, age: 12 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 甚至还可以这么写</span></span><br><span class="line"><span class="keyword">let</span> &#123; ...p3 &#125; = person;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：扩展操作符只能深拷贝结构为一层的对象，如果对象是两层的结构，那么使用扩展操作符拷贝会是浅拷贝。</p>
</blockquote>
<h2 id="合并数组或对象"><a href="#合并数组或对象" class="headerlink" title="合并数组或对象"></a>合并数组或对象</h2><p>数组合并通常是这么做的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>];</span><br><span class="line"><span class="keyword">let</span> arr3 = arr1.concat(arr2);</span><br><span class="line"><span class="built_in">console</span>.log(arr3); <span class="comment">// [1, 3, 5, 2, 4, 6]</span></span><br></pre></td></tr></table></figure>

<p>使用扩展操作符后，可以这么写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>];</span><br><span class="line"><span class="keyword">let</span> arr3 = [...arr1, ...arr2];</span><br><span class="line"><span class="built_in">console</span>.log(arr3); <span class="comment">// [1, 3, 5, 2, 4, 6]</span></span><br></pre></td></tr></table></figure>

<p>对了，它除了能合并数组外还能合并对象呢。合并对象，通常的做法是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = &#123; <span class="attr">name</span>: <span class="string">&#x27;布兰&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> p2 = &#123; <span class="attr">age</span>: <span class="number">12</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> p3 = <span class="built_in">Object</span>.assign(&#123;&#125;, p1, p2);</span><br><span class="line"><span class="built_in">console</span>.log(p3); <span class="comment">// &#123; name: &#x27;布兰&#x27;, age: 12&#125;</span></span><br></pre></td></tr></table></figure>

<p>用扩展操作符合并对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = &#123; <span class="attr">name</span>: <span class="string">&#x27;布兰&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> p2 = &#123; <span class="attr">age</span>: <span class="number">12</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> p3 = &#123; ...p1, ...p2 &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(p3); <span class="comment">// &#123; name: &#x27;布兰&#x27;, age: 12&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="解构对象"><a href="#解构对象" class="headerlink" title="解构对象"></a>解构对象</h2><p>经常我们给对象设置参数的时候会这么做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">  name: <span class="string">&#x27;布兰&#x27;</span>,</span><br><span class="line">  age: <span class="number">12</span>,</span><br><span class="line">  sex: <span class="string">&#x27;male&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> name = person.name;</span><br><span class="line"><span class="keyword">let</span> age = person.age;</span><br><span class="line"><span class="keyword">let</span> sex = person.sex;</span><br></pre></td></tr></table></figure>

<p>而有了扩展操作符，我们就可以这么写，不过其实如下这种写法并不是扩展操作符的写法 🤣，而是剩余操作符的写法，虽然写出来后看起来差不多，但就在操作对象这一点上，基本上可以认为它和扩展操作符是相反的操作，扩展操作符是用来展开对象的属性到多个变量上，而剩余操作符是用来把多个参数凝聚到一个变量上。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">  name: <span class="string">&#x27;布兰&#x27;</span>,</span><br><span class="line">  age: <span class="number">12</span>,</span><br><span class="line">  sex: <span class="string">&#x27;male&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> &#123; name, ...reset &#125; = person;</span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// &#x27;布兰&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(reset); <span class="comment">// &#123; age: 12, sex: &#x27;male&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="给对象添加属性"><a href="#给对象添加属性" class="headerlink" title="给对象添加属性"></a>给对象添加属性</h2><p>给对象加属性通常这样加：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123; <span class="attr">name</span>: <span class="string">&#x27;布兰&#x27;</span> &#125;;</span><br><span class="line">person.age = <span class="number">12</span>;</span><br><span class="line"><span class="built_in">console</span>.log(person); <span class="comment">// &#123; name: &#x27;布兰&#x27;, age: 12 &#125;</span></span><br></pre></td></tr></table></figure>

<p>使用扩展操作符给对象添加属性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123; <span class="attr">name</span>: <span class="string">&#x27;布兰&#x27;</span> &#125;;</span><br><span class="line">person = &#123; ...person, <span class="attr">age</span>: <span class="number">12</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(person); <span class="comment">// &#123; name: &#x27;布兰&#x27;, age: 12 &#125;</span></span><br></pre></td></tr></table></figure>

<p>关于使用扩展操作符给对象添加属性，这里有 2 个小技巧：</p>
<p>-</p>
<ul>
<li><ol>
<li>给新对象设置默认值：</li>
</ol>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 默认 person 对象的 age 属性值 为 12</span></span><br><span class="line"><span class="keyword">let</span> person = &#123; <span class="attr">age</span>: <span class="number">12</span>, ...&#123; <span class="attr">name</span>: <span class="string">&#x27;布兰&#x27;</span> &#125; &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(person); <span class="comment">// &#123; age: 12, name: &#x27;布兰&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<p>-</p>
<ul>
<li><ol>
<li>重写对象属性</li>
</ol>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123; <span class="attr">name</span>: <span class="string">&#x27;布兰&#x27;</span>, <span class="attr">age</span>: <span class="number">12</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// person 对象的 age 属性被重写为 20</span></span><br><span class="line">person = &#123; ...person, <span class="attr">age</span>: <span class="number">20</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(person); <span class="comment">// &#123; name: &#x27;布兰&#x27;, age: 20 &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="设置对象-Getter"><a href="#设置对象-Getter" class="headerlink" title="设置对象 Getter"></a>设置对象 Getter</h2><p>设置对象 <code>Getter</code> 通常做法是这样：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123; <span class="attr">name</span>: <span class="string">&#x27;布兰&#x27;</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">&#x27;age&#x27;</span>, &#123;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">12</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  enumerable: <span class="literal">true</span>,</span><br><span class="line">  configurable: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(person.age); <span class="comment">// 12</span></span><br></pre></td></tr></table></figure>

<p>而有了扩展操作符后可以这么写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123; <span class="attr">name</span>: <span class="string">&#x27;布兰&#x27;</span> &#125;;</span><br><span class="line">person = &#123;</span><br><span class="line">  ...person,</span><br><span class="line">  <span class="keyword">get</span> <span class="title">age</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">12</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(person.age); <span class="comment">// 12</span></span><br></pre></td></tr></table></figure>

<h2 id="将数组作为函数参数展开"><a href="#将数组作为函数参数展开" class="headerlink" title="将数组作为函数参数展开"></a>将数组作为函数参数展开</h2><p>如果我们有一个形参是多个参数的函数，但是当调用的时候发现入参却是一个数组，常规做法是这样：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">a, b, c</span>) </span>&#123;&#125;</span><br><span class="line">fn.apply(<span class="literal">null</span>, arr);</span><br></pre></td></tr></table></figure>

<p>使用扩展操作符后，就简单多了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">a, b, c</span>) </span>&#123;&#125;</span><br><span class="line">fn(...arr);</span><br></pre></td></tr></table></figure>

<h2 id="无限参数的函数"><a href="#无限参数的函数" class="headerlink" title="无限参数的函数"></a>无限参数的函数</h2><p>如果有这么一个累加函数，他会把所有传递进来的参数都加起来，普通做法是把参数都整合到数组里，然后这样做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSum</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr.reduce(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> acc + cur);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(doSum([<span class="number">1</span>, <span class="number">3</span>])); <span class="comment">// 4</span></span><br><span class="line"><span class="built_in">console</span>.log(doSum([<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>])); <span class="comment">// 9</span></span><br></pre></td></tr></table></figure>

<p>如果参数不是数组，而是需要一个个传递，相当于函数必须支持无限参数，那可能会这么做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSum</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = <span class="built_in">arguments</span>.length; i &lt; l; i++) &#123;</span><br><span class="line">    sum += <span class="built_in">arguments</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 或者</span></span><br><span class="line">  <span class="comment">// let args = [].slice.call(arguments)</span></span><br><span class="line">  <span class="comment">// return args.reduce((acc, cur) =&gt; acc + cur)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(doSum(<span class="number">1</span>, <span class="number">3</span>)); <span class="comment">// 4</span></span><br><span class="line"><span class="built_in">console</span>.log(doSum(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>)); <span class="comment">// 9</span></span><br><span class="line"><span class="built_in">console</span>.log(doSum(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>)); <span class="comment">// 16</span></span><br></pre></td></tr></table></figure>

<p>而有了扩展操作符，就简单多了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSum</span>(<span class="params">...arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr.reduce(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> acc + cur);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(doSum(<span class="number">1</span>, <span class="number">3</span>)); <span class="comment">// 4</span></span><br><span class="line"><span class="built_in">console</span>.log(doSum(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>)); <span class="comment">// 9</span></span><br><span class="line"><span class="built_in">console</span>.log(doSum(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>)); <span class="comment">// 16</span></span><br></pre></td></tr></table></figure>

<h2 id="扩展函数的剩余参数"><a href="#扩展函数的剩余参数" class="headerlink" title="扩展函数的剩余参数"></a>扩展函数的剩余参数</h2><p>有的时候一个函数需要传递很多的参数，比如小程序页面（<code>WePY</code>）的 <code>onLoad</code> 生命周期函数里就可能有很多别的页面传递过来的参数，然后还需要在函数里进行一些数据初始化工作，这样一来就会显得很臃肿不美观，比如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">a, b, x, y</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 进行一系列初始化数据工作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而使用了扩展操作符后，我们就可以按照业务把参数进行解构，把本该在一个函数里进行初始化的工作拆分成多个，可以这么做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">other</span>(<span class="params">x, y</span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">a, b, ...restConfig</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 使用 a 和 b 参数进行操作</span></span><br><span class="line">  <span class="comment">// 其余参数传给原始函数</span></span><br><span class="line">  <span class="keyword">return</span> other(...restConfig);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结合-Math-函数使用"><a href="#结合-Math-函数使用" class="headerlink" title="结合 Math 函数使用"></a>结合 Math 函数使用</h2><p>比如当需要对一个数组求最大值的时候，通常会这么做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">3</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">max</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [].concat(arr).sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> b - a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(max(arr)[<span class="number">0</span>]); <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">arr.reduce(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> <span class="built_in">Math</span>.max(acc, cur)); <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 又或者</span></span><br><span class="line"><span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, arr); <span class="comment">// 8</span></span><br></pre></td></tr></table></figure>

<p>但是使用扩展操作符后，能够把给数组求最大值写得更加简洁：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">3</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">let</span> max = <span class="built_in">Math</span>.max(...arr);</span><br><span class="line"><span class="built_in">console</span>.log(max); <span class="comment">// 8</span></span><br></pre></td></tr></table></figure>

<h2 id="在-new-表达式中使用"><a href="#在-new-表达式中使用" class="headerlink" title="在 new 表达式中使用"></a>在 new 表达式中使用</h2><p>假设有一个数组格式的日期，想要通过 Date 构造函数创建一个日期实例的话，可能会这么做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">2021</span>, <span class="number">1</span>, <span class="number">1</span>];</span><br><span class="line"><span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>([].toString.call(arr));</span><br><span class="line"><span class="built_in">console</span>.log(date); <span class="comment">// &#x27;Mon Feb 01 2021 00:00:00 GMT+0800 (中国标准时间)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="keyword">let</span> date2 = <span class="keyword">new</span> (<span class="built_in">Function</span>.prototype.bind.apply(<span class="built_in">Date</span>, [<span class="literal">null</span>].concat(arr)))();</span><br><span class="line"><span class="built_in">console</span>.log(date2); <span class="comment">// &#x27;Mon Feb 01 2021 00:00:00 GMT+0800 (中国标准时间)&#x27;</span></span><br></pre></td></tr></table></figure>

<p>而有了扩展操作符就简单多了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">2021</span>, <span class="number">1</span>, <span class="number">1</span>];</span><br><span class="line"><span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(...arr);</span><br><span class="line"><span class="built_in">console</span>.log(date); <span class="comment">// &#x27;Mon Feb 01 2021 00:00:00 GMT+0800 (中国标准时间)&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个操作符真可谓使用简单无脑，但是功能效率上不得不说很强大，所以我们要做的就是只要记住在什么时候使用它就好了，于是乎为了让大家能更好的记住这 13 种使用场景，我特意做了一个图，方便大家记忆，是不是很贴？是的话请不要吝啬你的爱心，给个小星星 👍 吧，感谢感谢。以上这些只列了 13 种写法，我觉得作为一个这么强大的操作符，肯定有更多使用的场景，欢迎把你们知道的写到评论区吧。</p>
<img src="/posts/46865/comb.png" class="" title="comb">
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
        <category>ES6</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>ES6</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-Prettier看这一篇就行了</title>
    <url>/posts/50170/</url>
    <content><![CDATA[<p>原文：<a href="https://zhuanlan.zhihu.com/p/81764012">https://zhuanlan.zhihu.com/p/81764012</a></p>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ul>
<li><a href="https://prettier.io/docs/en/options.html">prettier</a></li>
<li><a href="https://blog.csdn.net/ganyingxie123456/article/details/105957586">使用 prettier 统一编码风格</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>构建工具</category>
        <category>prettier</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
        <tag>prettier</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-Uni-App=&gt;事件处理、事件绑定、事件传参</title>
    <url>/posts/37783/</url>
    <content><![CDATA[<p>转载来源：<a href="https://blog.csdn.net/Dream_Weave/article/details/87722578">https://blog.csdn.net/Dream_Weave/article/details/87722578</a></p>
<h3 id="uni-app-事件"><a href="#uni-app-事件" class="headerlink" title="uni-app 事件"></a><strong>uni-app 事件</strong></h3><p>事件映射表，左侧为 WEB 事件，右侧为 <code>uni-app</code> 对应事件</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attribute">click</span>: <span class="string">&#x27;tap&#x27;</span>,</span><br><span class="line">  touchstart: <span class="string">&#x27;touchstart&#x27;</span>,</span><br><span class="line">  touchmove: <span class="string">&#x27;touchmove&#x27;</span>,</span><br><span class="line">  touchcancel: <span class="string">&#x27;touchcancel&#x27;</span>,</span><br><span class="line">  touchend: <span class="string">&#x27;touchend&#x27;</span>,</span><br><span class="line">  tap: <span class="string">&#x27;tap&#x27;</span>,</span><br><span class="line">  longtap: <span class="string">&#x27;longtap&#x27;</span>,</span><br><span class="line">  input: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">  change: <span class="string">&#x27;change&#x27;</span>,</span><br><span class="line">  submit: <span class="string">&#x27;submit&#x27;</span>,</span><br><span class="line">  blur: <span class="string">&#x27;blur&#x27;</span>,</span><br><span class="line">  focus: <span class="string">&#x27;focus&#x27;</span>,</span><br><span class="line">  reset: <span class="string">&#x27;reset&#x27;</span>,</span><br><span class="line">  confirm: <span class="string">&#x27;confirm&#x27;</span>,</span><br><span class="line">  columnchange: <span class="string">&#x27;columnchange&#x27;</span>,</span><br><span class="line">  linechange: <span class="string">&#x27;linechange&#x27;</span>,</span><br><span class="line">  error: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">  scrolltoupper: <span class="string">&#x27;scrolltoupper&#x27;</span>,</span><br><span class="line">  scrolltolower: <span class="string">&#x27;scrolltolower&#x27;</span>,</span><br><span class="line">  scroll: <span class="string">&#x27;scroll&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p><strong>*在 input 和 textarea 中 change 事件会被转为 blur 事件。*</strong></p>
<p><strong>踩坑注意：</strong></p>
<p>上列表中没有的原生事件也可以使用，例如 map 组件的 regionchange 事件直接在组件上写成 @regionchange,同时这个事件也非常特殊，它的 event type 有 begin 和 end 两个，导致我们无法在 handleProxy 中区分到底是什么事件，所以你在监听此类事件的时候同时监听事件名和事件类型既 <code>&lt;map @regiοnchange=&quot;functionName&quot; @end=&quot;functionName&quot; @begin=&quot;functionName&quot;&gt;&lt;map&gt;</code><br>平台差异所致，bind 和 catch 事件同时绑定时候，只会触发 bind ,catch 不会被触发，要避免踩坑。</p>
<h3 id="事件修饰符"><a href="#事件修饰符" class="headerlink" title="事件修饰符"></a><strong>事件修饰符</strong></h3><p>stop 的使用会阻止冒泡，但是同时绑定了一个非冒泡事件，会导致该元素上的 catchEventName 失效！<br>prevent 可以直接干掉，因为 uni-app 里没有什么默认事件，比如 submit 并不会跳转页面<br>self 没有可以判断的标识<br>once 也不能做，因为 uni-app 没有 removeEventListener, 虽然可以直接在 handleProxy 中处理，但非常的不优雅，违背了原意，暂不考虑<br>按键修饰符：uni-app 运行在手机端，没有键盘事件，所以不支持按键修饰符。</p>
<h3 id="事件绑定-click"><a href="#事件绑定-click" class="headerlink" title="事件绑定 @click"></a><strong>事件绑定 @click</strong></h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;demo&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;clickTest&quot;</span> @<span class="attr">longtap</span>=<span class="string">&quot;longtap&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      clickTest: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&#x27;click&#x27;</span>);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      longtap: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&#x27;longtap&#x27;</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.demo</span> &#123;</span></span><br><span class="line">    width: 500px;</span><br><span class="line">    margin: 50px auto;</span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#8f8f90</span>;</span></span><br><span class="line">    height: 500px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意在小程序中观察对应事件对象，可以利用此对象获取更多信息。</p>
<h3 id="事件传参（动态参数演示）"><a href="#事件传参（动态参数演示）" class="headerlink" title="事件传参（动态参数演示）"></a><strong>事件传参（动态参数演示）</strong></h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    &lt;view</span><br><span class="line">      v-for=&quot;(item, index) in students&quot;</span><br><span class="line">      class=&quot;persons&quot;</span><br><span class="line">      @click=&quot;menuClick&quot;</span><br><span class="line">      v-bind:id=&quot;index&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123;index&#125;&#125; - &#123;&#123;item.name&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    data: &#123;</span><br><span class="line">      students: [</span><br><span class="line"><span class="javascript">        &#123; <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;,</span></span><br><span class="line"><span class="javascript">        &#123; <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      menuClick: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(e.target.id);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.persons</span> &#123;</span></span><br><span class="line">    width: 750px;</span><br><span class="line">    line-height: 2.2em;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>uniapp</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-Vue全局组件自动注册</title>
    <url>/posts/64138/</url>
    <content><![CDATA[<p>在 Vue 中，我们通过 <code>Vue.component(&#39;MyComponentName&#39;, &#123; /* ... */ &#125;)</code> 的方式来进行全局组件注册，但如果需要全局注册的组件很多，这时代码就会变得比较臃肿，例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 注册 5 个全局组件</span></span><br><span class="line"><span class="keyword">import</span> ExampleComponent1 <span class="keyword">from</span> <span class="string">&#x27;./components/exampleComponent1/index&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ExampleComponent2 <span class="keyword">from</span> <span class="string">&#x27;./components/exampleComponent2/index&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ExampleComponent3 <span class="keyword">from</span> <span class="string">&#x27;./components/exampleComponent3/index&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ExampleComponent4 <span class="keyword">from</span> <span class="string">&#x27;./components/exampleComponent4/index&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ExampleComponent5 <span class="keyword">from</span> <span class="string">&#x27;./components/exampleComponent5/index&#x27;</span>;</span><br><span class="line"></span><br><span class="line">Vue.component(<span class="string">&#x27;ExampleComponent1&#x27;</span>, ExampleComponent1);</span><br><span class="line">Vue.component(<span class="string">&#x27;ExampleComponent2&#x27;</span>, ExampleComponent2);</span><br><span class="line">Vue.component(<span class="string">&#x27;ExampleComponent3&#x27;</span>, ExampleComponent3);</span><br><span class="line">Vue.component(<span class="string">&#x27;ExampleComponent4&#x27;</span>, ExampleComponent4);</span><br><span class="line">Vue.component(<span class="string">&#x27;ExampleComponent5&#x27;</span>, ExampleComponent5);</span><br></pre></td></tr></table></figure>

<p>下面我们就针对这块痛点，做些优化。</p>
<a id="more"></a>

<h2 id="循环注册"><a href="#循环注册" class="headerlink" title="循环注册"></a>循环注册</h2><p>回看上面的演示代码，最先能想到的优化方式，就是能不能做到批量注册，但查了 Vue 的手册，并没有看到组件批量注册的 API。</p>
<p>没办法，只能改变下思路，既然不能批量注册，那能不能做一层循环，在循环体内依次注册我们的组件呢？</p>
<p>答案当然是可以的，来看下我的实现代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ExampleComponent1 <span class="keyword">from</span> <span class="string">&#x27;./components/exampleComponent1/index&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ExampleComponent2 <span class="keyword">from</span> <span class="string">&#x27;./components/exampleComponent2/index&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ExampleComponent3 <span class="keyword">from</span> <span class="string">&#x27;./components/exampleComponent3/index&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ExampleComponent4 <span class="keyword">from</span> <span class="string">&#x27;./components/exampleComponent4/index&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ExampleComponent5 <span class="keyword">from</span> <span class="string">&#x27;./components/exampleComponent5/index&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> components = &#123;</span><br><span class="line">  ExampleComponent1,</span><br><span class="line">  ExampleComponent2,</span><br><span class="line">  ExampleComponent3,</span><br><span class="line">  ExampleComponent4,</span><br><span class="line">  ExampleComponent5</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Object</span>.keys(components).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">  Vue.component(key, components[key]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>首先组件还是要手动引入，引入之后我定义了一个 <code>components</code> 的对象，将引入组件的变量名存放在 <code>components</code> 对象里，最后通过 <code>Object.keys()</code> 方法循环对象并注册组件。</p>
<p>这个方法虽然减轻了一部分工作，但实际使用中，依旧还是比较麻烦，于是我又开始思考能否做到全自动注册。</p>
<h2 id="自动注册"><a href="#自动注册" class="headerlink" title="自动注册"></a>自动注册</h2><p>之前在阅读 <a href="https://github.com/PanJiaChen/vue-admin-template">vue-admin-template</a> 的时候，学习到了一个语法 <code>require.context()</code> ，这是 Webpack 的一个 API ，它能做到遍历文件夹中的指定文件并自动引入。</p>
<p>既然能遍历指定文件，还能自动引入，这就已经解决了主要问题了，而我要做无非就是在遍历指定文件的同时，将其注册就可以了。</p>
<p>下面来看下实现代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> componentsContext = <span class="built_in">require</span>.context(<span class="string">&#x27;./components&#x27;</span>, <span class="literal">true</span>, <span class="regexp">/index.vue$/</span>);</span><br><span class="line">componentsContext.keys().forEach(<span class="function"><span class="params">component</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取文件中的 default 模块</span></span><br><span class="line">  <span class="keyword">const</span> componentConfig = componentsContext(component).default;</span><br><span class="line">  Vue.component(componentConfig.name, componentConfig);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>首先通过 <code>require.context()</code> 获取 ./components 目录下所有文件夹里的 index.vue 文件，然后循环依次读取文件中的 default 模块，并使用组件的 <code>name</code> 做为组件名进行组件注册。</p>
<blockquote>
<p>需要注意的是，组件必须设置 <code>name</code> 值，因为注册的组件名就是 <code>name</code> 值，所以还要确保不能重名。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;ExampleComponent1&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>到此为止，我们已经实现组件的全局自动注册功能了，只需按照规范写好组件，放到 ./components 目录下即可，程序就会自动遍历并注册，无需我再手动操作。</p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p>组件有另一种调用方式，也就是通过 js 调用，例如 ElementUI 里的 <a href="https://element.eleme.cn/#/zh-CN/component/notification">Notification</a> 组件，它的调用就是通过 <code>this.$notify()</code> 的方式调用，而 <code>$notify</code> 方法是 ElementUI 挂载到 Vue 原型链上的一个全局方法。</p>
<p>针对这种通过 js 调用的组件，我们需要在原有组件同目录下增加一个 js 文件，里面的代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> component = <span class="built_in">require</span>(<span class="string">&#x27;./main.vue&#x27;</span>).default;</span><br><span class="line"><span class="keyword">const</span> <span class="title">constructor</span> = <span class="title">Vue</span>.<span class="title">extend</span>(<span class="params">component</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> exampleComponent1 = <span class="function"><span class="params">options</span> =&gt;</span> &#123;</span><br><span class="line">  options = options || &#123;&#125;;</span><br><span class="line">  <span class="keyword">let</span> instance = <span class="keyword">new</span> <span class="title">constructor</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    data: options</span></span><br><span class="line"><span class="params">  &#125;</span>);</span><br><span class="line">  instance.vm = instance.$mount();</span><br><span class="line">  instance.dom = instance.vm.$el;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(instance.dom);</span><br><span class="line">  <span class="keyword">return</span> instance.vm;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  install: <span class="function"><span class="params">Vue</span> =&gt;</span> &#123;</span><br><span class="line">    Vue.prototype[<span class="string">`$<span class="subst">$&#123;component.name&#125;</span>`</span>] = exampleComponent1;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这时候，我们还需要修改一下自动注册的代码。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> componentsContext = <span class="built_in">require</span>.context(</span><br><span class="line">  <span class="string">&#x27;./components&#x27;</span>,</span><br><span class="line">  <span class="literal">true</span>,</span><br><span class="line">  /index.(vue|js)$/</span><br><span class="line">);</span><br><span class="line">componentsContext.keys().forEach(<span class="function"><span class="params">component</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 组件配置信息</span></span><br><span class="line">  <span class="keyword">const</span> componentConfig = componentsContext(component).default;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/.vue$/</span>.test(component)) &#123;</span><br><span class="line">    Vue.component(componentConfig.name, componentConfig);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Vue.use(componentConfig);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在循环依次读取文件中的 default 模块的时候，判断一下文件是 vue 文件还是 js 文件，如果是 vue 文件，则进行组件注册，如果是 js 文件，则将组件挂载到 Vue 原型链上。</p>
<p>上面这个 Demo，在实际使用中，就可以通过 <code>this.$ExampleComponent1()</code> 的方式调用组件了。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>全局组件自动注册的功能也加入到 <a href="https://gitee.com/eoner/vue-automation/">vue-autumation</a> 中，这是一个基于 Vue CLI 3 制作的 Vue 脚手架，能方便快速进行业务开发，欢迎大家关注。</p>
<p>作者：Hooray<br>链接：<a href="https://juejin.cn/post/6844903893244051463">https://juejin.cn/post/6844903893244051463</a><br>来源：掘金<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>vue-cli3</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-Vue小技巧</title>
    <url>/posts/38620/</url>
    <content><![CDATA[<blockquote>
<p>夏眠不觉晓，处处蚊子咬，夜来键盘声，发落知多少?</p>
</blockquote>
<p>每天都在写代码，虽然手底下马不停蹄的敲，但是该来的加班还是会来的，如何能更快的完成手头的工作，提高自己的开发效率，今天小编给大家带来了这几个 Vue 小技巧，终于可以在六点像小鹿一样奔跑着下班了。先赞后看，艳遇不断，哈哈哈哈</p>
<a id="more"></a>

<h2 id="学会使用-attrs-与-listeners，二次包装组件就靠它了"><a href="#学会使用-attrs-与-listeners，二次包装组件就靠它了" class="headerlink" title="学会使用$attrs 与 $listeners，二次包装组件就靠它了"></a>学会使用<code>$attrs</code> 与 <code>$listeners</code>，二次包装组件就靠它了</h2><p>前几天产品经理给我甩过来一份管理系统的设计原型，我打开看了看，虽然内心是拒绝的，但是为了活着，还是要做的。小编看了看原型，发现系统中的大部分弹框右下角都是确定和取消两个按钮。如果使用 element-ui 提供的<code>Dialog</code>，那么每一个弹框都要手动加按钮，不但代码量增多，而且后面如果按钮 UI，需求发生变化，改动量也比较大。</p>
<img src="/posts/38620/image-20200801173818506.png" class="" title="image-20200801173818506">

<p>如果可以将<code>Dialog</code>进行二次封装，将按钮封装到组件内部，就可以不用重复去写了。说干就干。</p>
<h3 id="定义基本弹框代码"><a href="#定义基本弹框代码" class="headerlink" title="定义基本弹框代码"></a>定义基本弹框代码</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;visibleDialog&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--内容区域的默认插槽--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用弹框的footer插槽添加按钮--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">footer</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--对外继续暴露footer插槽，有个别弹框按钮需要自定义--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--将取消与确定按钮集成到内部--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;$_handleCancel&quot;</span>&gt;</span>取 消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;$_handleConfirm&quot;</span>&gt;</span>确 定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    props: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 对外暴露visible属性，用于显示隐藏弹框</span></span></span><br><span class="line">      visible: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">Boolean</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="literal">false</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 通过计算属性，对.sync进行转换，外部也可以直接使用visible.sync</span></span></span><br><span class="line">      visibleDialog: &#123;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="built_in">this</span>.visible;</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">set</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.$emit(<span class="string">&#x27;update:visible&#x27;</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 对外抛出cancel事件</span></span></span><br><span class="line">      $_handleCancel() &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;cancel&#x27;</span>);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 对外抛出 confirm事件</span></span></span><br><span class="line">      $_handleConfirm() &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;confirm&#x27;</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过上面的代码，我们已经将按钮封装到组件内部了，效果如下图所示：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--外部使用方式 confirm cancel 是自定义的事件 opened是包装el-dialog的事件，通过$listeners传入到el-dialog里面--&gt;</span></span><br><span class="line">&lt;custom-dialog</span><br><span class="line">  :visible.sync=&quot;visibleDialog&quot;</span><br><span class="line">  @opened=&quot;$_handleOpened&quot;</span><br><span class="line">  @confirm=&quot;$_handleConfirm&quot;</span><br><span class="line">  @cancel=&quot;$_handleCancel&quot;</span><br><span class="line">&gt;</span><br><span class="line">  这是一段内容</span><br><span class="line"><span class="tag">&lt;/<span class="name">custom-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果图</p>
<img src="/posts/38620/image-20200801173750045.png" class="" title="image-20200801173750045">

<p>但上面的代码存在一个问题，无法将<code>Dialog</code>自身的属性和事件暴露到外部（虽然可以通过<code>props</code>及<code>$emit</code>一个一个添加，但是很麻烦）,这时候就可以使用<code>$attrs</code>与<code>$listeners</code></p>
<h3 id="使用-attrs与-listeners"><a href="#使用-attrs与-listeners" class="headerlink" title="使用$attrs与$listeners"></a>使用<code>$attrs</code>与<code>$listeners</code></h3><blockquote>
<p><code>$attrs</code>: 当组件在调用时传入的属性没有在<code>props</code>里面定义时，传入的属性将被绑定到<code>$attrs</code>属性内（<code>class</code>与<code>style</code>除外，他们会挂载到组件最外层元素上）。并可通过<code>v-bind=&quot;$attrs&quot;</code>传入到内部组件中</p>
</blockquote>
<blockquote>
<p><code>$listeners</code>: 当组件被调用时，外部监听的这个组件的所有事件都可以通过<code>$listeners</code>获取到。并可通过<code>v-on=&quot;$listeners&quot;</code>传入到内部组件中。</p>
</blockquote>
<p>修改弹框代码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!---使用了v-bind与v-on监听属性与事件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;visibleDialog&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;$attrs&quot;</span> <span class="attr">v-on</span>=<span class="string">&quot;$listeners&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--其他代码不变--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//默认情况下父作用域的不被认作 props 的 attribute 绑定 (attribute bindings)</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//将会“回退”且作为普通的 HTML attribute 应用在子组件的根元素上。</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//通过设置 inheritAttrs 到 false，这些默认行为将会被去掉</span></span></span><br><span class="line"><span class="javascript">    inheritAttrs: <span class="literal">false</span></span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!---外部使用方式--&gt;</span></span><br><span class="line">&lt;custom-dialog</span><br><span class="line">  :visible.sync=&quot;visibleDialog&quot;</span><br><span class="line">  title=&quot;测试弹框&quot;</span><br><span class="line">  @opened=&quot;$_handleOpened&quot;</span><br><span class="line">&gt;</span><br><span class="line">  这是一段内容</span><br><span class="line"><span class="tag">&lt;/<span class="name">custom-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对于<code>$attrs</code>，我们也可以使用<code>$props</code>来代替,实现代码如下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;visibleDialog&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;$props&quot;</span> <span class="attr">v-on</span>=<span class="string">&quot;$listeners&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--其他代码不变--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; Dialog &#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    props: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 将Dialog的props通过扩展运算符展开到props属性里面</span></span></span><br><span class="line">      ...Dialog.props</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>但上面的代码存在一定的缺陷，有些组件存在非<code>props</code>的属性，比如对于一些封装的表单组件，我们可能需要给组件传入原生属性，但实际原生属性并没有在组件的<code>props</code>上面定义，这时候，如果通过上面的方式去包装组件，那么这些原生组件将无法传递到内部组件里面。</p>
<p>感谢@陌上兮月的提醒</p>
<h2 id="使用require-context实现前端工程自动化"><a href="#使用require-context实现前端工程自动化" class="headerlink" title="使用require.context实现前端工程自动化"></a>使用<code>require.context</code>实现前端工程自动化</h2><p><code>require.context</code>是一个<code>webpack</code>提供的 Api,通过执行<code>require.context</code>函数获取一个特定的上下文,主要是用于实现自动化导入模块。</p>
<p>什么时候用？当一个 js 里面需要手动引入过多的其他文件夹里面的文件时，就可以使用。</p>
<p>在 Vue 项目开发过程中，我们可能会遇到这些可能会用到<code>require.context</code>的场景</p>
<ol>
<li>当我们路由页面比较多的时候，可能会将路由文件拆分成多个，然后再通过<code>import</code>引入到<code>index.js</code>路由主入口文件中</li>
<li>当使用 svg symbol 时候，需要将所有的 svg 图片导入到系统中（建议使用 svg-sprite-loader）</li>
<li>开发了一系列基础组件，然后把所有组件都导入到<code>index.js</code>中，然后再放入一个数组中，通过遍历数组将所有组件进行安装。</li>
</ol>
<p>对于上述的几个场景，如果我们需要导入的文件比较少的情况下，通过<code>import</code>一个一个去导入还可以接受，但对于量比较大的情况，就变成了纯体力活，而且每次修改增加都需要在主入口文件内进行调整。这时候我们就可以通过<code>require.context</code>去简化这个过程。</p>
<p>现在以上述第三条为例,来说明<code>require.context</code>的用法</p>
<h3 id="常规用法"><a href="#常规用法" class="headerlink" title="常规用法"></a>常规用法</h3><img src="/posts/38620/image-20200801173947500.png" class="" title="image-20200801173947500">

<p>组件通过常规方式安装</p>
<img src="/posts/38620/image-20200801174014055.png" class="" title="image-20200801174014055">

<h3 id="require-context基本语法"><a href="#require-context基本语法" class="headerlink" title="require.context基本语法"></a><code>require.context</code>基本语法</h3><img src="/posts/38620/image-20200801174043722.png" class="" title="image-20200801174043722">

<h3 id="通过require-context安装Vue组件"><a href="#通过require-context安装Vue组件" class="headerlink" title="通过require.context安装Vue组件"></a>通过<code>require.context</code>安装<code>Vue</code>组件</h3><img src="/posts/38620/image-20200801174148366.png" class="" title="image-20200801174148366">

<h2 id="自定义v-model-原来这么简单"><a href="#自定义v-model-原来这么简单" class="headerlink" title="自定义v-model,原来这么简单"></a>自定义<code>v-model</code>,原来这么简单</h2><p>在用 Vue 开发前端时，不论使用原生还是封装好的 UI 库，对于表单组件，一般都会使用到<code>v-model</code>。虽然<code>v-model</code>是一个语法糖，但是吃到嘴里挺甜的啊。学会自定义<code>v-model</code>，还是很有必要的。</p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>一个组件上的<code>v-model</code>默认是通过在组件上面定义一个名为<code>value</code>的 props,同时对外暴露一个名为<code>input</code>的事件。</p>
<p>源码：</p>
<img src="/posts/38620/image-20200801174250770.png" class="" title="image-20200801174250770">

<p>使用方式：</p>
<img src="/posts/38620/image-20200801174306771.png" class="" title="image-20200801174306771">

<h3 id="自定义属性与事件"><a href="#自定义属性与事件" class="headerlink" title="自定义属性与事件"></a>自定义属性与事件</h3><p>通常情况下，使用<code>value</code>属性与<code>input</code>事件没有问题，但是有时候有些组件会将<code>value</code>属性或<code>input</code>事件用于不同的目的，比如对于单选框、复选框等类型的表单组件的<code>value</code>属性就有其他用处，参考（developer.mozilla.org/en-US/docs/…）。或者希望属性名称或事件名称与实际行为更贴切，比如<code>active</code>,<code>checked</code>等属性名。</p>
<img src="/posts/38620/image-20200801174334734.png" class="" title="image-20200801174334734">

<h2 id="使用-sync-更优雅的实现数据双向绑定"><a href="#使用-sync-更优雅的实现数据双向绑定" class="headerlink" title="使用.sync,更优雅的实现数据双向绑定"></a>使用<code>.sync</code>,更优雅的实现数据双向绑定</h2><p>在<code>Vue</code>中，<code>props</code>属性是单向数据传输的,父级的 prop 的更新会向下流动到子组件中，但是反过来不行。可是有些情况，我们需要对 prop 进行“双向绑定”。上文中，我们提到了使用<code>v-model</code>实现双向绑定。但有时候我们希望一个组件可以实现多个数据的“双向绑定”，而<code>v-model</code>一个组件只能有一个(Vue3.0 可以有多个)，这时候就需要使用到<code>.sync</code>。</p>
<h3 id="sync与v-model的异同"><a href="#sync与v-model的异同" class="headerlink" title=".sync与v-model的异同"></a><code>.sync</code>与<code>v-model</code>的异同</h3><p>相同点：</p>
<ul>
<li>两者的本质都是语法糖，目的都是实现组件与外部数据的双向绑定</li>
<li>两个都是通过属性+事件来实现的</li>
</ul>
<p>不同点(个人观点，如有不对，麻烦下方评论指出，谢谢)：</p>
<ul>
<li>一个组件只能定义一个<code>v-model</code>,但可以定义多个<code>.sync</code></li>
<li><code>v-model</code>与<code>.sync</code>对于的事件名称不同，<code>v-model</code>默认事件为<code>input</code>,可以通过配置<code>model</code>来修改，<code>.sync</code>事件名称固定为<code>update:属性名</code></li>
</ul>
<h3 id="自定义-sync"><a href="#自定义-sync" class="headerlink" title="自定义.sync"></a>自定义<code>.sync</code></h3><p>在开发业务时，有时候需要使用一个遮罩层来阻止用户的行为（更多会使用遮罩层+loading 动画），下面通过自定义<code>.sync</code>来实现一个遮罩层</p>
<img src="/posts/38620/image-20200801174408922.png" class="" title="image-20200801174408922">

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--调用方式--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">custom-overlay</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;visible&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        visible: <span class="literal">false</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="动态组件，让页面渲染更灵活"><a href="#动态组件，让页面渲染更灵活" class="headerlink" title="动态组件，让页面渲染更灵活"></a>动态组件，让页面渲染更灵活</h2><p>前两天产品经理来了新的需求了，告诉我，需要根据用户的权限不同，页面上要显示不同的内容，然后我就哼哧哼哧的将不同权限对应的组件写了出来，然后再通过<code>v-if</code>来判断要显示哪个组件，就有了下面的代码</p>
<img src="/posts/38620/image-20200801174503641.png" class="" title="image-20200801174503641">

<p>但是看到上面代码的那一长串<code>v-if</code>,<code>v-else-if</code>,我感觉我的代码洁癖症要犯了，不行，这样<code>code review</code>过不了关，我连自己这一关都过不了，这时候就改动态组件发挥作用了。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;roleComponent&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;roleComponent&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> AdminInfo <span class="keyword">from</span> <span class="string">&#x27;./admin-info&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> BookkeeperInfo <span class="keyword">from</span> <span class="string">&#x27;./bookkeeper-info&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> HrInfo <span class="keyword">from</span> <span class="string">&#x27;./hr-info&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> UserInfo <span class="keyword">from</span> <span class="string">&#x27;./user-info&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    components: &#123;</span><br><span class="line">      AdminInfo,</span><br><span class="line">      BookkeeperInfo,</span><br><span class="line">      HrInfo,</span><br><span class="line">      UserInfo</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        roleComponents: &#123;</span><br><span class="line">          admin: AdminInfo,</span><br><span class="line">          bookkeeper: BookkeeperInfo,</span><br><span class="line">          hr: HrInfo,</span><br><span class="line">          user: UserInfo</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        role: <span class="string">&#x27;user&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        roleComponent: <span class="literal">undefined</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> &#123; role, roleComponents &#125; = <span class="built_in">this</span>;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.roleComponent = roleComponents[role];</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="mixins，更高效的实现组件内容的复用"><a href="#mixins，更高效的实现组件内容的复用" class="headerlink" title="mixins，更高效的实现组件内容的复用"></a><code>mixins</code>，更高效的实现组件内容的复用</h2><p><code>mixins</code>是<code>Vue</code>提供的一种混合机制，用来更高效的实现组件内容的复用。怎么去理解混入呢，我觉得和<code>Object.assign</code>，但实际与<code>Object.assign</code>又有所不同。</p>
<h3 id="基本示例"><a href="#基本示例" class="headerlink" title="基本示例"></a>基本示例</h3><p>在开发 echarts 图表组件时，需要在窗口尺寸发生变化时，重置图表的大小，此时如果在每个组件里面都去实现一段监听代码，代码重复太多了，此时就可以使用混入来解决这个问题</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 混入代码 resize-mixins.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; debounce &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="keyword">const</span> resizeChartMethod = <span class="string">&#x27;$__resizeChartMethod&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 在组件内部将图表init的引用映射到chart属性上</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      chart: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;resize&#x27;</span>, <span class="built_in">this</span>[resizeChartMethod])</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">beforeDestroy</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.removeEventListener(<span class="string">&#x27;reisze&#x27;</span>, <span class="built_in">this</span>[resizeChartMethod])</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 通过lodash的防抖函数来控制resize的频率</span></span><br><span class="line">    [resizeChartMethod]: debounce(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.chart) &#123;</span><br><span class="line">        <span class="built_in">this</span>.chart.resize()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">100</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--图表组件代码--&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;chart&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> echartMixins <span class="keyword">from</span> <span class="string">&#x27;./echarts-mixins&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// mixins属性用于导入混入，是一个数组，数组可以传入多个混入对象</span></span><br><span class="line">  mixins: [echartMixins],</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      chart: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.chart = echarts.init(<span class="built_in">this</span>.$el)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="不同位置的混入规则"><a href="#不同位置的混入规则" class="headerlink" title="不同位置的混入规则"></a>不同位置的混入规则</h3><p>在<code>Vue</code>中，一个混入对象可以包含任意组件选项，但是对于不同的组件选项，会有不同的合并策略。</p>
<ol>
<li><code>data</code> 对于<code>data</code>,在混入时会进行递归合并，如果两个属性发生冲突，则以组件自身为主，如上例中的<code>chart</code>属性</li>
<li>生命周期钩子函数</li>
</ol>
<p>对于生命周期钩子函数，混入时会将同名钩子函数加入到一个数组中，然后在调用时依次执行。混入对象里面的钩子函数会优先于组件的钩子函数执行。如果一个组件混入了多个对象，对于混入对象里面的同名钩子函数，将按照数组顺序依次执行，如下代码:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mixin1 = &#123;</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;我是第一个输出的&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mixin2 = &#123;</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;我是第二个输出的&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  mixins: [mixin1, mixin2],</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;我是第三个输出的&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol>
<li>其他选项 对于值为对象的选项，如<code>methods</code>,<code>components</code>,<code>filter</code>,<code>directives</code>,<code>props</code>等等，将被合并为同一个对象。两个对象键名冲突时，取组件对象的键值对。</li>
</ol>
<h3 id="全局混入"><a href="#全局混入" class="headerlink" title="全局混入"></a>全局混入</h3><p>混入也可以进行全局注册。一旦使用全局混入，那么混入的选项将在所有的组件内生效，如下代码所示：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.mixin(&#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将埋点方法通过全局混入添加到每个组件内部</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 建议将埋点方法绑定到Vue的原型链上面，如：Vue.prototype.$track = () =&gt; &#123;&#125;</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="title">track</span>(<span class="params">message</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>请谨慎使用全局混入，因为它会影响每个单独创建的 Vue 实例 (包括第三方组件)。大多数情况下，只应当应用于自定义选项，</strong></p>
<p>最后我想说：不要吹灭你的灵感和你的想象力; 不要成为你的模型的奴隶。——文森特・梵高</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-Webpack4 如何优雅打包缓存文件</title>
    <url>/posts/64694/</url>
    <content><![CDATA[<p>一般来说，对于静态资源，我们都希望浏览器能够进行缓存，那样以后进入页面就可以直接使用缓存资源，页面直接直逼火箭速度打开，既提高了用户的体验也节省了宽带资源。</p>
<p>当然浏览器缓存方法有很多种，这里只简单讨论下 webpack 利用 hash 方式修改文件名，以达到缓存目的。</p>
<h2 id="webpack-hash"><a href="#webpack-hash" class="headerlink" title="webpack hash"></a>webpack hash</h2><p>webpack 内置了多种可使用 hash，官网解释分别如下：</p>
<ul>
<li><code>hash</code>：the hash of the module identifier</li>
<li><code>chunkHash</code>：the hash of the chunk content</li>
<li><code>contentHash</code>：the hash of extracted content</li>
</ul>
<p>注：hash 的默认长度为 20 个字符，可通过 <code>output.hashDigestLength</code> 全局配置，或使用 <code>[hash:16]</code> 方式配置，还可以通过 <code>output.hashDigest</code> 配置何时生成 hash。</p>
<p>那么问题来了，这么多种 hash 该如何选择呢？</p>
<a id="more"></a>

<h2 id="实战-hash"><a href="#实战-hash" class="headerlink" title="实战 hash"></a>实战 hash</h2><p>基础的配置文件如下（基于 webpack 4，入口文件分别为 index 和 detail，其中每个文件中引入了一个图片）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">&#x27;none&#x27;</span>, <span class="comment">// 设置为 none，避免 development 或 production 默认设置的一些影响</span></span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    detail: <span class="string">&#x27;./src/detail.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;[name].[hash].js&#x27;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="hash（the-hash-of-the-module-identifier）"><a href="#hash（the-hash-of-the-module-identifier）" class="headerlink" title="hash（the hash of the module identifier）"></a>hash（the hash of the module identifier）</h3><p>首先，我们来解释下 the module identifier。webpack 默认为给各个模块分配一个 id 以作标识，用来处理模块之间的依赖关系。而默认的 id 命名规则是根据模块引入的顺序，赋予一个整数(1、2、3……)。如下图就是使用 hash 的打包，index 和 detail 作为 entry 的两个入口，可以看到其 hash 值是一样的，而另外两个图片的 hash 值是不同的。</p>


<p>由于该 hash 是基于整个 module identifier 序列计算得到的，所以 JS 或 CSS 文件如果使用该 hash，则所有值都一样，而任意增添或删减一个模块的依赖，都会对整个 id 序列造成影响，从而改变 hash 值。这样的话 JS 或 CSS 文件是不适合使用该 hash 值的。</p>
<p>当然对于图片、字体、PDF 等资源该 hash 还是可以生成一个唯一值的。</p>
<h4 id="runtime-amp-manifest"><a href="#runtime-amp-manifest" class="headerlink" title="runtime &amp; manifest"></a>runtime &amp; manifest</h4><p>假如我们什么都不改动，只是重新跑一次构建，会惊奇的发现 index 和 detail 的 hash 值居然变了（图片的 hash 是不变的），如下图：</p>


<p>这究竟是怎么回事呢？webpack 官方解释为：</p>
<blockquote>
<p>This is because webpack includes certain boilerplate, specifically the <a href="https://webpack.js.org/concepts/manifest/">runtime and manifest</a>, in the entry chunk.</p>
</blockquote>
<p>为了解决这个不稳定的因素，webpack 4 提供了一个配置可以直接把 boilerplate 给单独抽离出来，配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">  runtimeChunk: <span class="string">&#x27;single&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样我们就能得到一个 runtime 的 js 文件，如下图：</p>


<h3 id="chunkhash（the-hash-of-the-chunk-content）"><a href="#chunkhash（the-hash-of-the-chunk-content）" class="headerlink" title="chunkhash（the hash of the chunk content）"></a>chunkhash（the hash of the chunk content）</h3><p>现在我们把 hash 改成 chunkhash ，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">  filename: <span class="string">&#x27;[name].[chunkhash].js&#x27;</span>,</span><br><span class="line">  path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重新跑下构建，会发现打包出来的三个 JS 文件的 chunkhash 值是不一样的了，如下：</p>


<p>现在我们在 index 文件中再引入一个 JS 模块，重新打包如下：</p>


<p>我们会发现 index 和 detail 文件的 chunkhash 都变了，这就奇怪了，按理来说 detail 文件我们根本没有改变啊，为什么它的 chunkhash 值变了呢？</p>
<p>其实根本原因还是 module identifier，因为 index 新引入的模块改变了以后所有模块的 id 值，所以 detail 文件中引入的模块 id 值发生了改变，于是 detail 的 chunkhash 也随着发生改变。</p>
<p>解决方案是将默认的数字 id 命名规则换成路径的方式。webpack 4 中当 mode 为 development 会默认启动</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">  namedModules: <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然如果是生产环境的话，全路径是有点太长，所以我们可以换成使用<a href="https://webpack.js.org/plugins/hashed-module-ids-plugin/">HashedModuleIdsPlugin</a> 插件来根据路径生成的 hash 作为 module identifier。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.HashedModuleIdsPlugin(),</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>这样最后 chunkhash 改变的就只有修改的文件了，也达到了我们想要的效果。</p>
<h3 id="contenthash（the-hash-of-extracted-content）"><a href="#contenthash（the-hash-of-extracted-content）" class="headerlink" title="contenthash（the hash of extracted content）"></a>contenthash（the hash of extracted content）</h3><p>现在我们将 CSS 样式单独抽离生成文件（使用了 <a href="https://webpack.js.org/plugins/mini-css-extract-plugin/">MiniCssExtractPlugin</a> 插件），会发现其 chunkhash 值跟该 entry 的 js 文件的 chunkhash 是一样的，如下图：</p>


<p>现在如果只改变 CSS 文件，会发现对应的 entry JS 和 CSS 文件的 chunkhash 都会改变。（注意：可能以前 <a href="https://webpack.js.org/plugins/extract-text-webpack-plugin/">ExtractTextWebpackPlugin</a> 不会改变，所以只能对抽离的 CSS 文件使用 contenthash）。</p>
<p>反正不管同时变或不变，可能都不是我们想要的效果，我们需要应该是改变了什么就反应到什么文件上。而不是 CSS 和 JS 文件的 chunkhash 同时改变或不变，无法区分 CSS 和 JS 的更新。</p>
<p>所以这里抽离出来的 CSS 文件将使用 contenthash，以区分 CSS 文件和 JS 文件的更新。</p>
<h3 id="Chunks-ID"><a href="#Chunks-ID" class="headerlink" title="Chunks ID"></a>Chunks ID</h3><p>然而这还没有结束，还有个问题，那就是目前我们的 chunks ID 还是以自增的数字命名的，这当我们的 entry 文件发生改变（新增或删除）的时候，原先的 chunks ID 就有可能发生变化。于是我们也需要把数字改掉就好，webpack 4 在 <code>optimization</code> 新增了一个 <code>namedChunks</code> 配置，该配置开发环境为 <code>true</code>，生产环境为 <code>false</code>，所以在生产环境的时候我们为了构建稳定的 hash 时，还是需要把该选项设置为 <code>true</code>，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    namedChunks: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>为了一份理想的缓存文件，我们需要做这些事情：</p>
<ul>
<li>抽离 boilerplate（[runtime &amp; manifest）</li>
<li>将 module identifier 默认的数字标识方式转成使用路径标识</li>
<li>JS 文件使用 chunkhash</li>
<li>抽离的 CSS 样式文件使用 contenthash</li>
<li>gif|png|jpe?g|eot|woff|ttf|svg|pdf 等使用 hash</li>
<li>设置 <code>namedChunks</code> 为 true</li>
</ul>
<h2 id="原文地址"><a href="#原文地址" class="headerlink" title="原文地址"></a>原文地址</h2><p><a href="https://imweb.io/topic/5b6f224a3cb5a02f33c013ba">Webpack4 如何优雅打包缓存文件</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>构建工具</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>Webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-axios发post请求-后端接收不到参数的解决方案</title>
    <url>/posts/32468/</url>
    <content><![CDATA[<p>转载自：<a href="https://blog.csdn.net/csdn_yudong/article/details/79668655">https://blog.csdn.net/csdn_yudong/article/details/79668655</a></p>
<h2 id="问题场景"><a href="#问题场景" class="headerlink" title="问题场景"></a>问题场景</h2><p>下面一个正常的 axios post 请求，后端说没有接收到你的传参：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">  headers: &#123;</span><br><span class="line">    deviceCode: <span class="string">&#x27;A95ZEF1-47B5-AC90BF3&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/api/lockServer/search&#x27;</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    username,</span><br><span class="line">    pwd</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h2><h3 id="要点一"><a href="#要点一" class="headerlink" title="要点一"></a>要点一</h3><p>原因就是这次的接口使用 java spring mvc<br>并且在这个方法上使用了注解 @RequestParam</p>
<p>那么这个是什么意思呢，这个是只能从请求的地址中取出参数，也就是只能从 username=admin&amp;password=admin 这种字符串中解析出参数。</p>
<h3 id="要点二"><a href="#要点二" class="headerlink" title="要点二"></a>要点二</h3><p>我们还可以看到我们这次请求的 Content-Type：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">application/json;charset=UTF-8</span><br></pre></td></tr></table></figure>

<p>axios 会帮我们 <strong>转换请求数据和响应数据</strong> 以及 <strong>自动转换 JSON 数据</strong></p>
<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><ul>
<li>Make <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequests</a> from the browser</li>
<li>Make <a href="http://nodejs.org/api/http.html">http</a> requests from node.js</li>
<li>Supports the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> API</li>
<li>Intercept request and response</li>
<li><mark>Transform request and response data</mark></li>
<li>Cancel requests</li>
<li>Automatic transforms for JSON data</li>
<li>Client side support for protecting against <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">XSRF</a></li>
</ul>
<p>在 axios 源码中发现下面这段内容：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">transformRequest: [<span class="function"><span class="keyword">function</span> <span class="title">transformRequest</span>(<span class="params">data, headers</span>) </span>&#123;</span><br><span class="line">    normalizeHeaderName(headers, <span class="string">&#x27;Accept&#x27;</span>);</span><br><span class="line">    normalizeHeaderName(headers, <span class="string">&#x27;Content-Type&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (utils.isFormData(data) ||</span><br><span class="line">      utils.isArrayBuffer(data) ||</span><br><span class="line">      utils.isBuffer(data) ||</span><br><span class="line">      utils.isStream(data) ||</span><br><span class="line">      utils.isFile(data) ||</span><br><span class="line">      utils.isBlob(data)</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (utils.isArrayBufferView(data)) &#123;</span><br><span class="line">      <span class="keyword">return</span> data.buffer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (utils.isURLSearchParams(data)) &#123;</span><br><span class="line">      setContentTypeIfUnset(headers, <span class="string">&#x27;application/x-www-form-urlencoded;charset=utf-8&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> data.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ========= 如果data是object，就会转 ========</span></span><br><span class="line">    <span class="keyword">if</span> (utils.isObject(data)) &#123;</span><br><span class="line">      setContentTypeIfUnset(headers, <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;],</span><br></pre></td></tr></table></figure>

<p>我们知道在做 post 请求的时候，我们的传参是 data: {…} 或者直接 {…} 的形式传递的，嗯，就是下面这两种形式：</p>
<p>【第一种】</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">axios</span><br><span class="line">  .post(<span class="string">&#x27;/user&#x27;</span>, &#123;</span><br><span class="line">    firstName: <span class="string">&#x27;Fred&#x27;</span>,</span><br><span class="line">    lastName: <span class="string">&#x27;Flintstone&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line">  .catch(<span class="function">() =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>【第二种】</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/user/12345&#x27;</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    firstName: <span class="string">&#x27;Fred&#x27;</span>,</span><br><span class="line">    lastName: <span class="string">&#x27;Flintstone&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>非常的刺激，这两种形式无一例外都触发了 axios 源码中【很关键】的那一段代码</p>
<h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>也就是说，我们的 <code>Content-Type</code> 变成了 <code>application/json;charset=utf-8</code><br>然后，因为我们的参数是 JSON 对象，axios 帮我们做了一个 stringify 的处理。<br>而且查阅 axios 文档可以知道：axios 使用 post 发送数据时，默认是直接把 json 放到请求体中提交到后端的。</p>
<p>那么，这就与我们服务端要求的 <code>&#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;</code> 以及 <code>@RequestParam</code> 不符合。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>【用 URLSearchParams 传递参数】</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> param = <span class="keyword">new</span> URLSearchParams();</span><br><span class="line">param.append(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line">param.append(<span class="string">&#x27;pwd&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line">axios(&#123;</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/api/lockServer/search&#x27;</span>,</span><br><span class="line">  data: param</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意的是： URLSearchParams 不支持所有的浏览器，但是总体的支持情况还是 OK 的，所以优先推荐这种简单直接的解决方案</p>
</blockquote>
<h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p><em>网上有很多方案说使用</em></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">axios.defaults.headers.post[<span class="string">&#x27;Content-Type&#x27;</span>] =</span><br><span class="line">  <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;headers&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>我试了一下，其实这样还是不行的</em></p>
<p>【还需要额外的操作，（我们要将参数转换为 query 参数）】</p>
<p>引入 qs ，这个库是 axios 里面包含的，不需要再下载了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Qs <span class="keyword">from</span> <span class="string">&#x27;qs&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">  username: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">  pwd: <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">axios(&#123;</span><br><span class="line">  headers: &#123;</span><br><span class="line">    deviceCode: <span class="string">&#x27;A95ZEF1-47B5-AC90BF3&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/api/lockServer/search&#x27;</span>,</span><br><span class="line">  data: Qs.stringify(data)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="方案三"><a href="#方案三" class="headerlink" title="方案三"></a>方案三</h3><p>在请求中添加 <code>transformRequest</code> :</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Qs <span class="keyword">from</span> <span class="string">&#x27;qs&#x27;</span>;</span><br><span class="line">axios(&#123;</span><br><span class="line">  url: <span class="string">&#x27;/api/lockServer/search&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  transformRequest: [</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 对 data 进行任意转换处理</span></span><br><span class="line">      <span class="keyword">return</span> Qs.stringify(data);</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  headers: &#123;</span><br><span class="line">    deviceCode: <span class="string">&#x27;A95ZEF1-47B5-AC90BF3&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    username: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">    pwd: <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="方案四"><a href="#方案四" class="headerlink" title="方案四"></a>方案四</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">axios.post(<span class="string">&#x27;/api/lockServer/search&#x27;</span>, <span class="string">&quot;userName=&#x27;admin&#x27;&amp;pwd=&#x27;admin&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>axios</tag>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-chrome调试技巧-汇总</title>
    <url>/posts/62808/</url>
    <content><![CDATA[<h2 id="打印"><a href="#打印" class="headerlink" title="打印"></a>打印</h2><h3 id="console-table"><a href="#console-table" class="headerlink" title="console.table"></a>console.table</h3><p>使用 <code>console.table()</code> 可以将传入的对象，或数组以表格形式输出。适合排列整齐的元素：</p>
<img src="/posts/62808/console_table.png" class="" title="console_table效果图">

<h3 id="让日志更易读"><a href="#让日志更易读" class="headerlink" title="让日志更易读"></a>让日志更易读</h3><p>即使 <code>console.log</code> 一个简单变量，你都可能会忘记（或混淆）哪一个是那个。当你有不同的变量需要打印的时候，阅读起来会更费劲。</p>
<img src="/posts/62808/log-ugly.png" class="" title="难以阅读的log">

<blockquote>
<p>“嗯？哪一个值对应哪一个变量来着？”</p>
</blockquote>
<p>为了让它变得更加易读，你可以打印一个对象 - 只需将所有<code>console.log</code> 的参数包装在大括号中。感谢 ECMAScript 2015 中引入了 <code>enhanced object literal(增强对象文字面量)</code> ，所以这（加了个括号）就是你需要做的全部了：</p>
<img src="/posts/62808/log-nice.png" class="" title="友好的日志">

<a id="more"></a>

<h2 id="触发伪类"><a href="#触发伪类" class="headerlink" title="触发伪类"></a>触发伪类</h2><p>右键单击 <code>Elements</code> 面板中的目标元素节点并选择「force state」。或者在 <code>Styles</code> 子窗格中单击「:hov」图标。可以触发元素上的伪类来研究元素在悬停时的效果和样式：</p>
<img src="/posts/62808/chromehover.gif" class="" title="触发伪类">

<h2 id="ALT-单击可以展开所有子节点"><a href="#ALT-单击可以展开所有子节点" class="headerlink" title="ALT+单击可以展开所有子节点"></a>ALT+单击可以展开所有子节点</h2><p>在 Elements 面板中,使用 Alt+单击可以展开该 Dom 节点下的所有 Dom 子节点：</p>
<img src="/posts/62808/2019082016164342.gif" class="" title="alt+单击展开所有子节点">

<h2 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h2><h3 id="拷贝资源"><a href="#拷贝资源" class="headerlink" title="拷贝资源"></a>拷贝资源</h3><p>你可以通过全局的方法 <code>copy()</code> 在 <code>console</code> 里 <code>copy</code> 任何你能拿到的资源，例如：</p>
<img src="/posts/62808/copy_resource.gif" class="" title="copy资源">

<h3 id="拷贝-HTML-最快的方式"><a href="#拷贝-HTML-最快的方式" class="headerlink" title="拷贝 HTML (最快的方式)"></a>拷贝 HTML (最快的方式)</h3><p>可能你知道右击或者点击在 <code>html</code> 元素边上的省略号(…)就能将它 <code>copy</code> 到操作系统剪贴板中 但你同样可以用非常古老的 <code>[ctrl] + [c]</code> + <code>[ctrl] + [v]</code> 大法来实现同样的效果！</p>
<img src="/posts/62808/copy_html.gif" class="" title="copy_html">

<h2 id="snippet-代码块"><a href="#snippet-代码块" class="headerlink" title="snippet 代码块"></a>snippet 代码块</h2><p>作用：Chrome 开发者工具的 Snippets 提供了在 Chrome 里保存及运行或者调试一段 js 代码的功能<br>入口：Chrome 开发者工具-Sources 面板-Snippets 面板</p>
<p>直达：<a href="https://juejin.im/post/5c2653b4e51d457b8c1f5c41">你不知道的 Chrome 调试工具技巧 第二十一天：Snippets(代码块)</a></p>
<h2 id="在控制台中引用上一次的执行结果"><a href="#在控制台中引用上一次的执行结果" class="headerlink" title="在控制台中引用上一次的执行结果"></a>在控制台中引用上一次的执行结果</h2><p>我们常常需要在控制台中调试代码。比如你想知道如何在 JavaScript 中反转字符串，然后你在网络上搜索相关信息并找到以下代可行代码。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;abcde&#x27;</span>.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure>

<img src="/posts/62808/split.jpg" class="" title="split">

<p>没问题，上面的代码确实对字符串进行了翻转。但你还想了解 split()、reverse()、join() 这些方法的作用以及运行他们的中间步骤的结果。因此，现在你想逐步执行上述代码，可能会编写如下内容：</p>
<img src="/posts/62808/chrome-split.jpg" class="" title="chrome-split">

<p>好了，经过上面这些操作，我们确实知道了每个方法运行的返回值，也就了解了各个方法的作用。</p>
<p>但是，这给人的感觉有点多此一举。上面的做法既容易出错，又难以理解。实际上，在控制台中，我们可以使用魔术变量$_引用上一次操作的结果。</p>
<img src="/posts/62808/chrome-full.jpg" class="" title="chrome-full">

<p>$_是一个特殊变量，它的值始终等于控制台中上一次操作的执行结果。它可以让你更加优雅地调试代码。</p>
<h2 id="重新发送-XHR-请求"><a href="#重新发送-XHR-请求" class="headerlink" title="重新发送 XHR 请求"></a>重新发送 XHR 请求</h2><p>XHR，即 XMLHttpRequest，是一种创建 AJAX 请求的 JavaScript API 。<br>在我们的前端项目中，我们经常需要使用 XHR 向后端发出请求来获取数据。如果你想重新发送 XHR 请求，那么该怎么办呢？<br>对于新手来说，可能会选择刷新页面，但这可能比较麻烦。实际上，我们可以直接在“网络”面板中进行调试。</p>
<img src="/posts/62808/xhr.jpg" class="" title="xhr">

<h2 id="将复制图像为-Data-URI"><a href="#将复制图像为-Data-URI" class="headerlink" title="将复制图像为 Data URI"></a>将复制图像为 Data URI</h2><p>处理网页上的图像的通常有两种方法，一种是通过外部资源链接加载它们，另一种是将图像编码为 Data URI。</p>
<blockquote>
<p>Data URL，即前缀为 data:协议的 URL，允许内容创建者在文档中嵌入小文件。在被 WHATWG 撤消该名称之前，它们被称为“Data URI”。</p>
</blockquote>
<p>将这些小图像编码到 Data URL 并将它们直接嵌入到我们的代码中，可以减少页面需要发出的 HTTP 请求的数量，从而加快页面加载速度。</p>
<p>所以在 Chrome 浏览器中，我们该如何将图像转换为 Data URL 呢？可以参考下面的 gif 图像：</p>
<img src="/posts/62808/datauri.jpg" class="" title="datauri">

<h2 id="改变颜色格式"><a href="#改变颜色格式" class="headerlink" title="改变颜色格式"></a>改变颜色格式</h2><p>在颜色预览中使用<code>Shift + Click</code> ，可以在<code>rgba</code>, <code>hsl</code> 和 <code>hexadecimal</code> 这三种格式中改变。</p>
<img src="/posts/62808/color-picker.gif" class="" title="color-picker">

<h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><ul>
<li><a href="https://segmentfault.com/a/1190000012957199">Javascript 调试命令——你只会 Console.log() ?</a></li>
<li><a href="https://juejin.im/post/5c2653b4e51d457b8c1f5c41">【译】你不知道的 Chrome 调试工具技巧 第二十一天：Snippets(代码块)</a></li>
<li><a href="https://blog.fundebug.com/2018/08/22/art-of-debugging-with-chrome-devtools/">20 个 Chrome DevTools 调试技巧（译）</a></li>
</ul>
]]></content>
      <categories>
        <category>效率</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
        <tag>chrome</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-git配置ssh服务</title>
    <url>/posts/1071/</url>
    <content><![CDATA[<p>原文：<a href="https://juejin.cn/post/6844904066032599054">https://juejin.cn/post/6844904066032599054</a></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在管理 Git 项目上，很多时候都是直接使用<code>https url</code>克隆到本地，当然也有有些人使用<code>SSH url</code>克隆到本地。</p>
<p>这两种方式的主要区别在于：</p>
<ul>
<li>使用<code>https url</code>克隆对初学者来说会比较方便，复制<code>https url</code>然后到 git Bash 里面直接用 clone 命令克隆到本地就好了，但是每次 fetch 和 push 代码都需要输入账号和密码，这也是 https 方式的麻烦之处。</li>
<li>而使用<code>SSH url</code>克隆却需要在克隆之前先配置和添加好<code>SSH key</code>，因此，如果你想要使用<code>SSH url</code>克隆的话，你必须是这个项目的拥有者。否则你是无法添加<code>SSH key</code>的，另外 ssh 默认是每次 fetch 和 push 代码都不需要输入账号和密码，如果你想要每次都输入账号密码才能进行 fetch 和 push 也可以另外进行设置。</li>
</ul>
<p>下面主要是讲述如何配置使用 ssh 方式来提交和克隆代码。</p>
<a id="more"></a>

<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="配置本机-ssh"><a href="#配置本机-ssh" class="headerlink" title="配置本机 ssh"></a>配置本机 ssh</h2><h3 id="一、确定的是你的电脑上是安装过-Git"><a href="#一、确定的是你的电脑上是安装过-Git" class="headerlink" title="一、确定的是你的电脑上是安装过 Git"></a>一、确定的是你的电脑上是安装过 Git</h3><p>打开<code>cmd</code>，查看 git 版本：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">输入：git --version</span><br><span class="line">显示：git version 2.20.1.windows.1</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>如果显示类似<code>git version 2.20.1.windows.1</code>的 Git 版本，说明你的电脑是安装过 Git 的；否则请左转<a href="https://juejin.im/post/6844903749631098893#heading-4">打开 Git 的正确姿势</a>，把 Git 安装完了再来，不送。</p>
<h3 id="二、查看是否配置了-git-用户名和邮箱"><a href="#二、查看是否配置了-git-用户名和邮箱" class="headerlink" title="二、查看是否配置了 git 用户名和邮箱"></a>二、查看是否配置了 git 用户名和邮箱</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">输入：git config user.name</span><br><span class="line">显示：用户名</span><br><span class="line">输入：git config user.email</span><br><span class="line">显示用户邮箱</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>如果没有配置，那么需要配置用户名和邮箱：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">输入：git config --global user.name &quot;xxx&quot;</span><br><span class="line"></span><br><span class="line">输入：git config --global user.email &quot;xxx&quot;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="三、查看是否配置过-SSH-Key-密钥"><a href="#三、查看是否配置过-SSH-Key-密钥" class="headerlink" title="三、查看是否配置过 SSH Key(密钥)"></a>三、查看是否配置过 SSH Key(密钥)</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">输入：cd ~/.ssh</span><br><span class="line">输入：ls，</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>查看该文件下的文件，看是否存在 <code>id_isa</code> 和 <code>id_isa.pub</code> 文件（也可以是别的文件名，只要 <code>yourName</code> 和 <code>yourName.pub</code> 成对存在就可以），如果存在的话，证明已经存在 ssh key 了，可以直接跳过<code>4、生成SSH Key</code>这一步骤，</p>
<h3 id="四、生成-SSH-Key-密钥"><a href="#四、生成-SSH-Key-密钥" class="headerlink" title="四、生成 SSH Key(密钥)"></a>四、生成 SSH Key(密钥)</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">输入: ssh-keygen -t rsa -C &quot;你的邮箱&quot;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>此处会提示<code>Enter file in which to save the key (/Users/shutong/.ssh/id_rsa):</code>这样一段内容,让我们输入文件名，如果第 3 步的文件存在的话最好在这里修改一下文件名以防覆盖之前的内容；如果第 3 步的文件不存在的话则直接按<code>enter</code>键就好了。</p>
<p>之后会有提示你是否需要设置密码，如果设置了每次使用 Git 都会用到密码，一般都是直接不写为空，直接<code>enter</code>就好了。</p>
<p>上述操作执行完毕后，在<code>~/.ssh/</code>目录会生成<code>XXX-rsa</code>(私钥)和<code>XXX-rsa.pub</code>(公钥)，它们默认的存储路径是：</p>
<blockquote>
<p>C:\Users\Administrator.ssh</p>
</blockquote>
<p><strong>注意</strong></p>
<blockquote>
<p>个人建议生成的 rsa 最好单独命名不要使用默认名称，因为有可能 sshkey 可能会用在多个地方，一不小心就可能被覆盖然后导致 git 功能异常</p>
</blockquote>
<h3 id="五、添加公钥到你的远程仓库（github）"><a href="#五、添加公钥到你的远程仓库（github）" class="headerlink" title="五、添加公钥到你的远程仓库（github）"></a>五、添加公钥到你的远程仓库（github）</h3><h4 id="1-、查看你生成的公钥："><a href="#1-、查看你生成的公钥：" class="headerlink" title="1 、查看你生成的公钥："></a>1 、查看你生成的公钥：</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">输入：cat ~/.ssh/id_rsa.pub</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>这里会把公钥显示出来，我们把这段内容复制出来。</p>
<h4 id="2、添加公钥到远程仓库"><a href="#2、添加公钥到远程仓库" class="headerlink" title="2、添加公钥到远程仓库:"></a>2、添加公钥到远程仓库:</h4><p>登陆你的 github 帐户 -&gt; 点击你的头像，然后点击 <code>Settings</code> -&gt; 左栏点击 <code>SSH and GPG keys</code> -&gt; 点击 <code>New SSH key</code></p>
<p>然后将复制的公钥内容，粘贴进<code>Key</code>文本域内。 <code>title</code>域，自己随便起个名字。</p>
<p>点击 <code>Add SSH key</code>。</p>
<h4 id="2、查看-ssh-文件是否配置成功"><a href="#2、查看-ssh-文件是否配置成功" class="headerlink" title="2、查看 ssh 文件是否配置成功"></a>2、查看 ssh 文件是否配置成功</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">输入： ssh -T git@github.com</span><br><span class="line">输出： Hi danygitgit! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>恭喜你，你的设置已经成功了。</p>
<h3 id="六、修改-git-的-remote-url"><a href="#六、修改-git-的-remote-url" class="headerlink" title="六、修改 git 的 remote url"></a>六、修改 git 的 remote url</h3><p>如果之前添加的是<code>HTTPS</code>协议的 github 仓库地址，那么每次 push 或者 pull 仍然需要密码，所以，我们需要将其修改为<code>ssh</code>协议的，这样，就不需要这么麻烦了。</p>
<p>那么我们应该怎么办呢？</p>
<h4 id="1、查看当前的-remote-url"><a href="#1、查看当前的-remote-url" class="headerlink" title="1、查看当前的 remote url"></a>1、查看当前的 remote url</h4><p>首先进入本地仓库，右键 -&gt; <code>Git Bash Here</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">输入： git remote -v</span><br><span class="line">输出： origin https://github.com/danygitgit/document-library.git (fetch)</span><br><span class="line">输出： origin https://github.com/danygitgit/document-library.git (push)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>如果是以上的结果那么说明此项目是使用<code>https</code>协议进行访问的（如果地址是 git 开头则表示是<code>git</code>协议）</p>
<h4 id="2、复制远程仓库的-ssh-链接"><a href="#2、复制远程仓库的-ssh-链接" class="headerlink" title="2、复制远程仓库的 ssh 链接"></a>2、复制远程仓库的 ssh 链接</h4><p>登陆你的远程仓库，在上面可以看到你的 ssh 协议相应的 url，类似：</p>
<blockquote>
<p><a href="mailto:&#103;&#105;&#x74;&#x40;&#x67;&#x69;&#x74;&#104;&#117;&#98;&#46;&#x63;&#x6f;&#x6d;">&#103;&#105;&#x74;&#x40;&#x67;&#x69;&#x74;&#104;&#117;&#98;&#46;&#x63;&#x6f;&#x6d;</a>:danygitgit/document-library.git</p>
</blockquote>
<p>复制此 ssh 链接。</p>
<h4 id="2、修改-git-的-remote-url"><a href="#2、修改-git-的-remote-url" class="headerlink" title="2、修改 git 的 remote url"></a>2、修改 git 的 remote url</h4><p>方法有三种：</p>
<ol>
<li>修改命令</li>
</ol>
<blockquote>
<p>git remote origin set-url [url]</p>
</blockquote>
<ol>
<li>先删后加</li>
</ol>
<blockquote>
<p>git remote rm origin git remote add origin [url]</p>
</blockquote>
<ol>
<li>直接修改<code>config</code>文件</li>
</ol>
<p>找到仓库下 <code>.git</code> 文件夹下的<code>config</code>文件，打开，可以看到以下内容</p>
<blockquote>
<p>[core] repositoryformatversion = 0 filemode = false bare = false logallrefupdates = true symlinks = false ignorecase = true[remote “origin”] url =<a href="https://github.com/danygitgit/document-library.git">https://github.com/danygitgit/document-library.git</a> fetch = +refs/heads/<em>:refs/remotes/origin/</em>[branch “master”] remote = origin merge = refs/heads/master</p>
</blockquote>
<p>将文件中的 <code>url =https://github.com/danygitgit/document-library.git</code>更改为 <code>url = git@github.com:danygitgit/document-library.git</code> 即可。</p>
<p>修改后的文件如下</p>
<blockquote>
<p>[core] repositoryformatversion = 0 filemode = false bare = false logallrefupdates = true symlinks = false ignorecase = true[remote “origin”] url = <a href="mailto:&#x67;&#x69;&#x74;&#64;&#103;&#x69;&#116;&#x68;&#117;&#x62;&#46;&#99;&#x6f;&#109;">&#x67;&#x69;&#x74;&#64;&#103;&#x69;&#116;&#x68;&#117;&#x62;&#46;&#99;&#x6f;&#109;</a>:danygitgit/document-library.git fetch = +refs/heads/<em>:refs/remotes/origin/</em>[branch “master”] remote = origin merge = refs/heads/master</p>
</blockquote>
<p>以后，不管是 push 还是 pull，你都不需要再提交密码了。</p>
<h3 id="七、Sourcetree-配置-ssh-密钥"><a href="#七、Sourcetree-配置-ssh-密钥" class="headerlink" title="七、Sourcetree 配置 ssh 密钥"></a>七、Sourcetree 配置 ssh 密钥</h3><p><code>SourceTree</code>是一款 git 管理可视化工具，就不需要繁琐的敲打命令行了。个人比较推荐，无论在 windows 环境还是 mac 的 os 环境。<a href="https://www.sourcetreeapp.com/">官网链接</a></p>
<p>关于<code>SourceTree</code>的安装及配置就不赘述了，具体请参考</p>
<ul>
<li><a href="https://blog.csdn.net/wangjiangrong/article/details/80287041">Git SourceTree 免登陆安装及配置 生成 ssh</a></li>
<li><a href="https://www.cnblogs.com/liuxin-673855200/p/11151835.html">SOURCETREE 3.1.3 版本跳过 BITBUCKET 注册方法（亲测好用） | 淡忘&amp;天涯</a></li>
<li><a href="https://jingyan.baidu.com/article/9faa7231cdec65473d28cb11.html">Sourcetree 配置 ssh 密钥</a></li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>磨刀不误砍柴工。勇于尝试，善于总结。开启你的 Git 踩坑之旅吧！</p>
<p>路漫漫其修远兮，希望 Git 可以帮我们记录每一个脚印，每一步成长。与诸君共勉。</p>
<p>祝大家 2020 更上一层楼！</p>
<h1 id="相关资源"><a href="#相关资源" class="headerlink" title="相关资源"></a>相关资源</h1><ul>
<li><a href="https://segmentfault.com/a/1190000016365283">解决 sourceTree 的 git clone 报 SSH 密钥认证失败的问题</a></li>
</ul>
]]></content>
      <categories>
        <category>工具</category>
        <category>版本控制</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-husky+lint-staged助力团队编码规范</title>
    <url>/posts/63036/</url>
    <content><![CDATA[<p>转载自：<a href="https://neveryu.github.io/2020/06/10/husky-lint-staged/">https://neveryu.github.io/2020/06/10/husky-lint-staged/</a></p>
<h2 id="快速集成"><a href="#快速集成" class="headerlink" title="快速集成"></a>快速集成</h2><p>在提交 git 之前，我们需要校验我们的代码是否符合规范，如果不符合，则不允许提交代码。</p>
<p>首先，安装依赖：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -D husky</span><br><span class="line"></span><br><span class="line">// lint-staged 可以让husky只检验git工作区的文件，不会导致你一下出现成百上千个错误</span><br><span class="line">npm install -D lint-staged</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>然后修改 <code>package.json</code>，增加配置：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line"> &quot;precommit&quot;: &quot;eslint src/**/*.js&quot;</span><br><span class="line">&#125;</span><br><span class="line">&quot;husky&quot;: &#123;</span><br><span class="line">  &quot;hooks&quot;: &#123;</span><br><span class="line">    &quot;pre-commit&quot;: &quot;lint-staged&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;lint-staged&quot;: &#123;</span><br><span class="line">  &quot;src/**/*.&#123;js,vue&#125;&quot;: [&quot;prettier --write&quot;, &quot;eslint --cache --fix&quot;, &quot;git add&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>git commit</code> 之前会进入 工作区文件的扫描，执行 <code>prettier</code> 脚本，修改 <code>eslint</code> 问题，然后重要提交到工作区。</p>
<h2 id="深入了解"><a href="#深入了解" class="headerlink" title="深入了解"></a>深入了解</h2><h1 id="了解-githooks"><a href="#了解-githooks" class="headerlink" title="了解 githooks"></a>了解 githooks</h1><p>Git Hooks 就是在 Git 执行特定事件（如 commit、push、receive 等）时触发运行的脚本，类似于“钩子函数”，没有设置可执行的钩子将被忽略。</p>
<p>在项目的 <code>.git/hooks</code> 目录中，有一些 <code>.sample</code> 结尾的钩子示例脚本，如果想启用对应的钩子，只需手动删除后缀，即可。（删除某一个 hook 的后缀 <code>.sample</code> 即可启用该 hook 脚本，默认是不启用的。）</p>
<p>【但是，我们一般不去改动 <code>.git/hooks</code> 里面的文件，因为我们使用 husky 】</p>
<h1 id="husky"><a href="#husky" class="headerlink" title="husky"></a>husky</h1><ul>
<li>husky 的安装</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i husky -D --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>husky 在安装过程中会在 <code>.git/hooks</code> 文件夹中生成一系列的 <code>git hook</code> 脚本。</p>
<blockquote>
<p>需要注意的是：你要留意 husky 的安装信息，是否为你安装了 <code>git</code> 钩子。</p>
</blockquote>
<p>如果安装正确的话，可以看到 husky 会打印出如下消息：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> node husky install</span></span><br><span class="line">husky &gt; setting up git hooks</span><br><span class="line">husky &gt; done</span><br></pre></td></tr></table></figure>

<p>h<img src="/posts/63036/husky-2.png" class="" title="husky-2"></p>
<p>但也有可能：</p>
<img src="/posts/63036/husky-1.png" class="" title="husky-1">

<p>这个就是由于电脑 <code>node</code> 版本的原因，跳过了 Git 钩子安装，相当于是没有安装成功哦~</p>
<p>OK，假设你的 husky 安装是正常的，那么 husky 为你安装的 hooks 将会生效。这样我们在 <code>git commit</code> 的时候会触发 <code>pre-commit</code> 钩子从而触发到 huksy。</p>
<p>我们在 <code>package.json</code> 文件中配置 husky 的钩子需要执行的 命令 或 操作。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;husky&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;hooks&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;pre-commit&quot;</span>: <span class="string">&quot;echo \&quot;git commit trigger husky pre-commit hook\&quot; &quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，在 <code>git commit</code> 的时候就会看到 <code>pre-commit</code> 执行了。</p>
<img src="/posts/63036/husky-3.png" class="" title="husky-3.png">

<p>从 1.0.0 开始，husky 的配置可以使用 <code>.huskyrc</code>、<code>.huskyrc.json</code>、<code>.huskyrc.js</code> 或 <code>husky.config.js</code> 文件</p>
<h2 id="钩子中执行多个命令"><a href="#钩子中执行多个命令" class="headerlink" title="钩子中执行多个命令"></a>钩子中执行多个命令</h2><ul>
<li><p>根据 npm script 的规则，使用 &amp;&amp;</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;husky&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;hooks&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;pre-commit&quot;</span>: <span class="string">&quot;echo \&quot;git commit trigger husky pre-commit hook\&quot; &amp;&amp; npm run test&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果您更喜欢使用数组，建议的方法是在 <code>.huskyrc.js</code> 中定义它们</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> tasks = <span class="function"><span class="params">arr</span> =&gt;</span> arr.join(<span class="string">&#x27; &amp;&amp; &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  hooks: &#123;</span><br><span class="line">    <span class="string">&#x27;pre-commit&#x27;</span>: tasks([<span class="string">&#x27;npm run lint&#x27;</span>, <span class="string">&#x27;npm run test&#x27;</span>])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="hook-拦截"><a href="#hook-拦截" class="headerlink" title="hook 拦截"></a>hook 拦截</h2><p>为了阻止提交，<code>pre-commit</code> 脚本必须以非零的退出代码退出。</p>
<p>如果您的提交未被阻止，请检查脚本退出代码。</p>
<p>当然 husky 不止能验证 <code>commit</code> ，也可以进行 <code>push</code> 等其他操作验证，这里就不一一举例了，具体可以参照 <a href="https://www.npmjs.com/package/husky">npm husky</a> 。</p>
<hr>
<h1 id="lint-staged"><a href="#lint-staged" class="headerlink" title="lint-staged"></a>lint-staged</h1><p><code>lint-staged</code> 是一个在 git 暂存文件上（也就是被 <code>git add</code> 的文件）运行已配置的 linter（或其他）任务。<code>lint-staged</code> 总是将所有暂存文件的列表传递给任务。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;lint-staged&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;src/**/*.&#123;js,vue&#125;&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;prettier --write&quot;</span>,</span><br><span class="line">    <span class="string">&quot;eslint --cache --fix&quot;</span>,</span><br><span class="line">    <span class="string">&quot;git add&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里 lint-staged 的配置是：在 git 的待提交的文件中，在 src 目录下的所有 <code>.js</code> <code>.vue</code> 都要执行三条命令。前两条一会儿说，后一条是将处理过的代码重新 add 到 git 中。</p>
<p>结合我们前面介绍的 husky，配合 husky 的 pre-commit 钩子，将会形成一个自动化工具链。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;husky&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;hooks&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;pre-commit&quot;</span>: <span class="string">&quot;lint-staged&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;lint-staged&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;src/**/*.&#123;js,vue&#125;&quot;</span>: [<span class="string">&quot;prettier --write&quot;</span>, <span class="string">&quot;eslint --cache --fix&quot;</span>, <span class="string">&quot;git add&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 commit 之前，将暂存区的内容做一次 代码检查 和 代码美化，然后再添加到暂存区；然后再 commit，完美！！</p>
<p>从 v3.1 开始，您现在可以使用不同的方式进行 lint-staged 配置：</p>
<ul>
<li>lint-staged 在你的对象 package.json</li>
<li>.lintstagedrc JSON 或 YML 格式的文件</li>
<li>lint-staged.config.js JS 格式的文件</li>
<li>使用 –config 或 -c 标志传递配置文件</li>
</ul>
<h1 id="mrm"><a href="#mrm" class="headerlink" title="mrm"></a>mrm</h1><p><a href="https://github.com/sapegin/mrm">mrm</a> 是一个自动化工具。<strong>推荐</strong></p>
<p>它将根据 package.json 依赖项中的代码质量工具来安装和配置 husky 和 lint-staged，因此请确保在此之前安装并配置所有代码质量工具，如 Prettier 和 ESlint</p>
<p>安装 mrm 并执行 lint-staged 任务：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i mrm -D --registry=https://registry.npm.taobao.org</span><br><span class="line">npx mrm lint-staged</span><br></pre></td></tr></table></figure>

<p><a href="https://mrm.js.org/">mrm 文档、mrm api doc</a></p>
<h1 id="关于-prettier-的问题"><a href="#关于-prettier-的问题" class="headerlink" title="关于 prettier 的问题"></a>关于 prettier 的问题</h1><p>prettier 是一个很好的格式化代码的插件，但对已经有一定迭代完成度的代码不推荐使用。使用该插件后，它会将原有的代码也进行格式化，造成很多不可知的问题，我就是前车之鉴，使用 prettier 后，原本已经没有 eslint 问题的代码，又多出了更多的不知道什么原因的报错，只能将代码回退处理。</p>
<p>所以，这也就是我们为什么在 <code>lint-staged</code> 中，执行 <code>prettier</code> 的原因。</p>
]]></content>
      <categories>
        <category>工具</category>
        <category>IDE</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-moment的高频用法总结</title>
    <url>/posts/63031/</url>
    <content><![CDATA[<p>转载自：<a href="https://zhuanlan.zhihu.com/p/113350786">https://zhuanlan.zhihu.com/p/113350786</a></p>
<h3 id="指定语言；不然可能引起一些不必要的-bug。"><a href="#指定语言；不然可能引起一些不必要的-bug。" class="headerlink" title="指定语言；不然可能引起一些不必要的 bug。"></a><strong>指定语言；不然可能引起一些不必要的 bug。</strong></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 记得指定为对应的语言；</span><br><span class="line"> moment.locale(<span class="string">&#x27;zh-cn&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取时间戳"><a href="#获取时间戳" class="headerlink" title="获取时间戳"></a><strong>获取时间戳</strong></h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line"># 精确到毫秒</span><br><span class="line"></span><br><span class="line">moment().valueOf()</span><br><span class="line">## 1584182611042 ；返回值为数值类型</span><br><span class="line">moment().format(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">## 返回值为字符串类型</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 精确到秒</span><br><span class="line">moment().unix()</span><br><span class="line">##  1584182618 精确到秒  返回值为数值类型</span><br><span class="line">moment().format(<span class="string">&#x27;X&#x27;</span>)</span><br><span class="line">##  返回值为字符串类型</span><br></pre></td></tr></table></figure>

<h3 id="生成指定时间的-moment"><a href="#生成指定时间的-moment" class="headerlink" title="生成指定时间的 moment"></a><strong>生成指定时间的 moment</strong></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">moment(<span class="string">&quot;1995-12-25&quot;</span>);</span><br><span class="line"></span><br><span class="line"># 带格式</span><br><span class="line"># 解析器会忽略非字母和数字的字符，因此以下两个都将会返回相同的东西。</span><br><span class="line">moment(<span class="string">&quot;12-25-1995&quot;</span>, <span class="string">&quot;MM-DD-YYYY&quot;</span>);</span><br><span class="line">moment(<span class="string">&quot;12/25/1995&quot;</span>, <span class="string">&quot;MM-DD-YYYY&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取对象"><a href="#获取对象" class="headerlink" title="获取对象"></a><strong>获取对象</strong></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">moment().toObject();</span><br><span class="line"># 返回一个包括：年、月、日、时、分、秒、毫秒的对象</span><br><span class="line"># &#123;</span><br><span class="line">    years: <span class="number">2020</span></span><br><span class="line">    months: <span class="number">2</span></span><br><span class="line">    date: <span class="number">14</span></span><br><span class="line">    hours: <span class="number">18</span></span><br><span class="line">    minutes: <span class="number">47</span></span><br><span class="line">    seconds: <span class="number">56</span></span><br><span class="line">    milliseconds: <span class="number">526</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a><strong>格式化</strong></h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">moment().format();</span><br><span class="line"># 2020-03-14T19:14:05+08:00</span><br><span class="line"></span><br><span class="line">moment().format(<span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>);</span><br><span class="line"># 2020-03-14 19:23:29</span><br></pre></td></tr></table></figure>

<h3 id="获取时间"><a href="#获取时间" class="headerlink" title="获取时间"></a><strong>获取时间</strong></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 获取今天0时0分0秒</span><br><span class="line">moment().startOf(<span class="string">&#x27;day&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># 获取本周第一天(周日)0时0分0秒</span><br><span class="line">moment().startOf(<span class="string">&#x27;week&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># 获取本周周一0时0分0秒</span><br><span class="line">moment().startOf(<span class="string">&#x27;isoWeek&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># 获取当前月第一天0时0分0秒</span><br><span class="line">moment().startOf(<span class="string">&#x27;month&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># 获取指定日期的0时0分0秒</span><br><span class="line">moment(<span class="string">&#x27;2019-10-20&#x27;</span>).startOf(<span class="string">&#x27;day&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># 获取今天23时59分59秒</span><br><span class="line">moment().endOf(<span class="string">&#x27;day&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># 获取本周最后一天(周六)23时59分59秒</span><br><span class="line">moment().endOf(<span class="string">&#x27;week&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># 获取本周周日23时59分59秒</span><br><span class="line">moment().endOf(<span class="string">&#x27;isoWeek&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># 获取当前月最后一天23时59分59秒</span><br><span class="line">moment().endOf(<span class="string">&#x27;month&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="获取当月第一天是星期几"><a href="#获取当月第一天是星期几" class="headerlink" title="获取当月第一天是星期几"></a><strong>获取当月第一天是星期几</strong></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 用于设置星期几，其中星期日为 0、星期六为 6</span><br><span class="line">moment().startOf(<span class="string">&#x27;month&#x27;</span>).day()</span><br></pre></td></tr></table></figure>

<h3 id="获取前-n-天-后-n-天"><a href="#获取前-n-天-后-n-天" class="headerlink" title="获取前 n 天 / 后 n 天"></a><strong>获取前 n 天 / 后 n 天</strong></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">moment().add(<span class="number">7</span>, <span class="string">&#x27;days&#x27;</span>);</span><br><span class="line">moment().subtract(<span class="number">7</span>, <span class="string">&#x27;days&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="比较两个时间的大小"><a href="#比较两个时间的大小" class="headerlink" title="比较两个时间的大小"></a><strong>比较两个时间的大小</strong></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 第二个参数用于确定精度，且不仅仅是要检查的单个值，因此使用 day 将会检查年份、月份、日期。</span><br><span class="line"></span><br><span class="line">moment(<span class="string">&#x27;2010-10-31&#x27;</span>).isBefore(<span class="string">&#x27;2010-12-31&#x27;</span>, <span class="string">&#x27;day&#x27;</span>);</span><br><span class="line"># true</span><br><span class="line"></span><br><span class="line">moment(<span class="string">&#x27;2010-10-20&#x27;</span>).isBefore(<span class="string">&#x27;2010-12-31&#x27;</span>, <span class="string">&#x27;year&#x27;</span>);</span><br><span class="line"># false</span><br><span class="line"></span><br><span class="line">moment(<span class="string">&#x27;2010-10-20&#x27;</span>).isAfter(<span class="string">&#x27;2009-12-31&#x27;</span>, <span class="string">&#x27;year&#x27;</span>);</span><br><span class="line"># true</span><br><span class="line"></span><br><span class="line">moment(<span class="string">&#x27;2010-10-20&#x27;</span>).isSame(<span class="string">&#x27;2009-12-31&#x27;</span>, <span class="string">&#x27;year&#x27;</span>);</span><br><span class="line"># 判断两个时间是否相等</span><br><span class="line"></span><br><span class="line"># 需要注意的是， isBefore与isAfter 都是开区间，如果想使用闭区间，应使用</span><br><span class="line">isSameOrBefore</span><br><span class="line">isSameOrAfter</span><br></pre></td></tr></table></figure>

<h3 id="两个时间的相差几天"><a href="#两个时间的相差几天" class="headerlink" title="两个时间的相差几天"></a><strong>两个时间的相差几天</strong></h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">moment([<span class="number">2008</span>, <span class="number">2</span>, <span class="number">27</span>]).diff([<span class="number">2007</span>, <span class="number">0</span>, <span class="number">28</span>], <span class="string">&#x27;day&#x27;</span>);</span><br><span class="line"># 424</span><br></pre></td></tr></table></figure>

<h3 id="是否是闰年"><a href="#是否是闰年" class="headerlink" title="是否是闰年"></a><strong>是否是闰年</strong></h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">moment().isLeapYear();</span><br><span class="line"># true</span><br><span class="line"></span><br><span class="line">moment([<span class="number">2001</span>]).isLeapYear()</span><br><span class="line"># false</span><br></pre></td></tr></table></figure>

<h3 id="获取-月份和星期-枚举列表"><a href="#获取-月份和星期-枚举列表" class="headerlink" title="获取 月份和星期 枚举列表"></a><strong>获取 月份和星期 枚举列表</strong></h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">moment.months()</span><br><span class="line"></span><br><span class="line"># [&quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;, &quot;October&quot;, &quot;November&quot;, &quot;December&quot;]</span><br><span class="line"></span><br><span class="line">moment.monthsShort()</span><br><span class="line"># [&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;]</span><br><span class="line"></span><br><span class="line">moment.weekdays()</span><br><span class="line"># [&quot;Sunday&quot;, &quot;Monday&quot;, &quot;Tuesday&quot;, &quot;Wednesday&quot;, &quot;Thursday&quot;, &quot;Friday&quot;, &quot;Saturday&quot;]</span><br><span class="line"></span><br><span class="line">moment.weekdaysMin()</span><br><span class="line"># [&quot;Su&quot;, &quot;Mo&quot;, &quot;Tu&quot;, &quot;We&quot;, &quot;Th&quot;, &quot;Fr&quot;, &quot;Sa&quot;]</span><br></pre></td></tr></table></figure>

<h3 id="克隆"><a href="#克隆" class="headerlink" title="克隆"></a><strong>克隆</strong></h3><p>所有的 <code>moment</code> 都是可变的。 调用任何一种操作方法都会改变原始的 <code>moment</code>。 如果要创建副本并对其进行操作，则应在操作 <code>moment</code> 之前使用 <code>moment#clone</code>。</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line"># 在 moment 上调用 moment() 将会克隆它。</span><br><span class="line">var a = moment([2012]);</span><br><span class="line">var b = moment(a);</span><br><span class="line">a.year(2000);</span><br><span class="line">b.year(); // 2012</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 此外，也可以调用 moment#clone 克隆 moment。</span><br><span class="line">var a = moment([2012]);</span><br><span class="line">var b = a.clone();</span><br><span class="line">a.year(2000);</span><br><span class="line">b.year(); // 2012</span><br></pre></td></tr></table></figure>

<h3 id="获取当月总天数"><a href="#获取当月总天数" class="headerlink" title="获取当月总天数"></a><strong>获取当月总天数</strong></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">moment().daysInMonth();</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a><strong>参考链接</strong></h3><p><a href="https://link.zhihu.com/?target=http://momentjs.cn/">Moment.js 中文网 momentjs.cn</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
        <tag>笔记</tag>
        <tag>momentjs</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-npm更换淘宝镜像源</title>
    <url>/posts/49607/</url>
    <content><![CDATA[<p>转载自：<a href="https://blog.csdn.net/u012780176/article/details/82586358">https://blog.csdn.net/u012780176/article/details/82586358</a></p>
<p>打开终端：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>官方源：</p>
<p>默认源</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm config set registry https://registry.npmjs.org</span><br></pre></td></tr></table></figure>

<p>换源：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>配置后通过以下方法验证是否成功:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm config get registry</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>构建工具</category>
        <category>npm</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-postcss-px2rem-插件进行页面自适应</title>
    <url>/posts/63504/</url>
    <content><![CDATA[<p>转载自：<a href="https://blog.csdn.net/qq_24991841/article/details/88887053">https://blog.csdn.net/qq_24991841/article/details/88887053</a></p>
<h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h2><blockquote>
<p>npm i postcss-px2rem -D</p>
</blockquote>
<h2 id="2-vue-config-js-文件中"><a href="#2-vue-config-js-文件中" class="headerlink" title="2.vue.config.js 文件中"></a>2.vue.config.js 文件中</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> px2rem = <span class="built_in">require</span>(<span class="string">&#x27;postcss-px2rem&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> postcss = px2rem(&#123;</span><br><span class="line">  remUnit: <span class="number">192</span> <span class="comment">//基准大小 baseSize，需要和rem.js中相同</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 其他内容</span></span><br><span class="line">  css: &#123;</span><br><span class="line">    loaderOptions: &#123;</span><br><span class="line">      postcss: &#123;</span><br><span class="line">        plugins: [postcss]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="3-在-src-下创建-rem-js-文件夹"><a href="#3-在-src-下创建-rem-js-文件夹" class="headerlink" title="3.在 src 下创建 rem.js 文件夹"></a>3.在 src 下创建 rem.js 文件夹</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setRemInit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// postcss-px2rem的内容</span></span><br><span class="line">  <span class="comment">// 基准大小</span></span><br><span class="line">  <span class="keyword">const</span> baseSize = <span class="number">192</span>;</span><br><span class="line">  <span class="comment">// 设置 rem 函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setRem</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 当前页面宽度相对于 1920 px(设计稿尺寸)的缩放比例，可根据自己需要修改。</span></span><br><span class="line">    <span class="keyword">const</span> scale = <span class="built_in">document</span>.documentElement.clientWidth / <span class="number">1920</span>;</span><br><span class="line">    <span class="comment">// 设置页面根节点字体大小</span></span><br><span class="line">    <span class="built_in">document</span>.documentElement.style.fontSize = <span class="string">`<span class="subst">$&#123;baseSize * scale&#125;</span>px`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这个if语句代码，是用来控制屏幕的最小宽度，不需要可以可以不写</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Number</span>(<span class="built_in">document</span>.documentElement.style.fontSize.slice(<span class="number">0</span>, -<span class="number">2</span>)) &lt;= <span class="number">130</span>) &#123;</span><br><span class="line">      <span class="built_in">document</span>.documentElement.style.fontSize = <span class="string">&#x27;130px&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 初始化</span></span><br><span class="line">  setRem();</span><br><span class="line">  <span class="comment">// 改变窗口大小时重新设置 rem</span></span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;resize&#x27;</span>, setRem);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-在-main-js-中引用-rem-js"><a href="#4-在-main-js-中引用-rem-js" class="headerlink" title="4.在 main.js 中引用 rem.js"></a>4.在 main.js 中引用 rem.js</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; setRemInit &#125; <span class="keyword">from</span> <span class="string">&#x27;@/rem&#x27;</span>;</span><br><span class="line"></span><br><span class="line">setRemInit(); <span class="comment">//进行初始化立即运行</span></span><br></pre></td></tr></table></figure>

<p><strong>注：参数解释：<br>baseSize 是用来设置 html font-size 的大小 。<br>remUnit 在 postcss-px2rem 中对你设置 px 转化为 rem，例如，width: 1920px, remUnit = 192 。 则页面渲染完成后，你会发现， width : 10rem; 1920/192 =10。 所以你要保证 baseSize 和 remUnit 对值始终一致，这样才能将 html font-size 和 px 建立正确对关系</strong></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-vue项目中枚举值统一维护管理</title>
    <url>/posts/56971/</url>
    <content><![CDATA[<p>转载自：<a href="https://www.jianshu.com/p/75516ec4f366">https://www.jianshu.com/p/75516ec4f366</a></p>
<p>由于多页面有时需要共同的表单枚举选择，页面以及 table 需要显示枚举值 label 以及有时需要根据枚举值判断，故个人使用如下枚举方式进行统一管理。</p>
<a id="more"></a>

<h3 id="在-common-或者个人模块下创建单独枚举-js-如-enums-js。然后导入-common-Enum-js-并添加一个字面量对象。"><a href="#在-common-或者个人模块下创建单独枚举-js-如-enums-js。然后导入-common-Enum-js-并添加一个字面量对象。" class="headerlink" title="在 common 或者个人模块下创建单独枚举 js,如 enums.js。然后导入@/common/Enum.js 并添加一个字面量对象。"></a>在 common 或者个人模块下创建单独枚举 js,如 enums.js。然后导入@/common/Enum.js 并添加一个字面量对象。</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 落户任务状态</span></span><br><span class="line">settleTaskStatusEnum: <span class="keyword">new</span> Enum()</span><br><span class="line">  .add(<span class="string">&#x27;ALL&#x27;</span>, <span class="string">&#x27;全部&#x27;</span>, <span class="literal">null</span>)</span><br><span class="line">  .add(<span class="string">&#x27;SETTLE&#x27;</span>, <span class="string">&#x27;待落户&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">  .add(<span class="string">&#x27;SETTLED&#x27;</span>, <span class="string">&#x27;已落户&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">  .add(<span class="string">&#x27;CANCEL&#x27;</span>, <span class="string">&#x27;已取消&#x27;</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<h3 id="如需要表单选择可如下使用："><a href="#如需要表单选择可如下使用：" class="headerlink" title="如需要表单选择可如下使用："></a>如需要表单选择可如下使用：</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;el-select</span><br><span class="line">  style=&quot;width: 99%&quot;</span><br><span class="line">  v-model=&quot;query.taskStatus&quot;</span><br><span class="line">  clearable</span><br><span class="line">  placeholder=&quot;请选择&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;-- 传统做法 --&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> <span class="attr">:label</span>=<span class="string">&quot;待落户 &quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">:label</span>=<span class="string">&quot;已落户 &quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> <span class="attr">:label</span>=<span class="string">&quot;已取消&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  &lt;-- 基于枚举类的方法 --&gt;</span><br><span class="line">  &lt;el-option</span><br><span class="line">    v-for=&quot;item in enums.settleTaskStatusEnum&quot;</span><br><span class="line">    :key=&quot;item.value&quot;</span><br><span class="line">    :value=&quot;item.value&quot;</span><br><span class="line">    :label=&quot;item.label&quot;</span><br><span class="line">  &gt;<span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如：</p>
<img src="/posts/56971/element-select.jpg" class="" title="element-select">

<h3 id="如需页面以及-table-显示枚举-label-可如下使用："><a href="#如需页面以及-table-显示枚举-label-可如下使用：" class="headerlink" title="如需页面以及 table 显示枚举 label 可如下使用："></a>如需页面以及 table 显示枚举 label 可如下使用：</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;-- 可以避免为每个枚举值进行判断后，再取其label，后端返回taskStatus:1 --&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;taskStatus&quot;</span> <span class="attr">label</span>=<span class="string">&quot;任务状态&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">    &lt;-- 传统做法：定义function通过switch或者if判断并返回label --&gt; &#123;&#123;</span><br><span class="line">    switch(scope.row.taskStatus) case 0:... case 1... case 2.... &#125;&#125; &lt;--</span><br><span class="line">    基于枚举类的方法 --&gt; &#123;&#123;</span><br><span class="line">    enums.settleTaskStatusEnum.getLabelByValue(scope.row.taskStatus) &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如：</p>
<img src="/posts/56971/status.jpg" class="" title="status">

<h3 id="如需根据枚举值判断可如下使用："><a href="#如需根据枚举值判断可如下使用：" class="headerlink" title="如需根据枚举值判断可如下使用："></a>如需根据枚举值判断可如下使用：</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 只能对【待落户】的数据点击</span></span><br><span class="line"><span class="comment">// 传统做法（硬编码）</span></span><br><span class="line"><span class="keyword">if</span> (item.taskStatus === <span class="number">1</span>) &#123;</span><br><span class="line">  <span class="built_in">this</span>.settleBtnDisabled = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 基于枚举类方法，可以防止硬编码</span></span><br><span class="line"><span class="keyword">if</span> (item.taskStatus === enums.settleTaskStatusEnum.SETTLE.value) &#123;</span><br><span class="line">  <span class="built_in">this</span>.settleBtnDisabled = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="以下为具体-Enum-类"><a href="#以下为具体-Enum-类" class="headerlink" title="以下为具体 Enum 类"></a>以下为具体 Enum 类</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 枚举类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author </span>meilin.huang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Enum</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 添加枚举字段</span></span><br><span class="line"><span class="comment">   * field: 枚举字段</span></span><br><span class="line"><span class="comment">   * label: 界面显示</span></span><br><span class="line"><span class="comment">   * value: 枚举值</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">add</span>(<span class="params">field, label, value</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>[field] = &#123; label, value &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 根据枚举value获取其label</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">getLabelByValue</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 字段不存在返回‘’</span></span><br><span class="line">    <span class="keyword">if</span> (value === <span class="literal">undefined</span> || value === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> [key, val] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(<span class="built_in">this</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (val.value === value) &#123;</span><br><span class="line">        <span class="keyword">return</span> val.label;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
        <tag>Vue</tag>
        <tag>枚举</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-一份值得收藏的Git异常处理清单</title>
    <url>/posts/3646/</url>
    <content><![CDATA[<p>转载自：<a href="https://www.zoo.team/article/git-exception">https://www.zoo.team/article/git-exception</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Git 作为一种分布式版本控制系统已经成为现在开发的宠儿，不仅应用在前端、后端、客户端等开发场景中，也成为各行业互联网企业分工协作的必备技能之一。</p>
<p>大家在使用过程中总会碰到这样那样的问题，本文主要针对以下经常发生的几种异常情况提供一些解决方案：</p>
<ol>
<li>本地工作区文件恢复</li>
<li>远程分支删除后，删除本地分支与其关联</li>
<li>修改提交时的备注内容</li>
<li>修改分支名，实现无缝衔接</li>
<li>撤回提交</li>
<li>撤销本地分支合并</li>
<li>恢复误删的本地分支</li>
<li>不确定哪个分支有自己提交的 commit</li>
</ol>
<a id="more"></a>

<h2 id="（一）本地工作区文件恢复"><a href="#（一）本地工作区文件恢复" class="headerlink" title="（一）本地工作区文件恢复"></a>（一）本地工作区文件恢复</h2><p>大家都知道，一个文件夹中的文件如果被删掉了，那只有在垃圾箱里面找了。如果垃圾箱里面的也被删掉了，以笔者的常识在不借助工具的情况下怕是就找不到了，emmmm。。。</p>
<p>不过，关联了 Git 的文件和文件夹就不一样了，有了本地仓库和远程仓库的双重保护，找到一个被删除的文件也不过就分分钟，一个命令行的事情吧。</p>
<p><strong>语法</strong>：<code>git checkout &lt;filename/dirname&gt;</code></p>
<p><strong>命令</strong>：<code>git checkout 1.js</code></p>
<p>这一命令主要用于本地工作区文件的撤回，下图是一个工作区文件被删除后的完美恢复过程。</p>
<img src="/posts/3646/upload_920b7e3506bb38783b9fa76a02da6f08.jpeg" class="" title="本地工作区文件恢复">

<h2 id="（二）远程分支删除后，删除本地分支及关联"><a href="#（二）远程分支删除后，删除本地分支及关联" class="headerlink" title="（二）远程分支删除后，删除本地分支及关联"></a>（二）远程分支删除后，删除本地分支及关联</h2><p>为方便分支提交，一般情况下会用本地命令 <code>git branch --set-upstream-to=origin/master master</code> 建立本地分支与远程分支的关联，从 master 拉出的分支可以自动建立与远程已有分支的关联，这样可以很方便的使用 <code>git pull</code> 和 <code>git push</code> 拉取远程分支的代码和将本地分支提交到远程。</p>
<p>Git 远程分支删除之后，本地分支就无法成功推送到远程，想要重新建立与远程仓库的关联，就需要先删除其原本的与已删除的远程分支的关联。</p>
<p>如下图所示，需要删除的远程分支为 feature/test，使用 <code>git push origin --delete feature/test</code> 删除掉对应的远程分支之后，删除本地分支关联。</p>
<img src="/posts/3646/upload_99b520a28a62d42f3194b581ce5260de.jpeg" class="" title="远程分支删除后-删除本地分支及关联">

<p><strong>语法</strong>：<code>git branch --unset-upstream &lt;branchname&gt;</code></p>
<p><strong>命令</strong>：<code>git branch --unset-upstream feature/test</code></p>
<p>删除掉关联关系之后，用 <code>git branch -vv</code> 命令可查看到本地分支与远程分支的关联关系如下图所示，可观察到 feature/test 分支已经没有关联的远程分支了。</p>
<img src="/posts/3646/upload_3374b5759d80e6182686168170651a30.jpeg" class="" title="远程分支删除后-删除本地分支及关联2">

<h2 id="（三）修改提交时的备注内容"><a href="#（三）修改提交时的备注内容" class="headerlink" title="（三）修改提交时的备注内容"></a>（三）修改提交时的备注内容</h2><p>平时提交代码很多时候因为军情紧急，会在刚提交的时候填写了自己不太满意的备注，但笔者本人有点强迫症，一定要把它改成想要的样子咋办。。。。，不要慌，还是有解决办法滴！</p>
<p>想要修改最近一次提交的“修改 xxx 功能”的备注：</p>
<img src="/posts/3646/upload_aa5aea5ec813838347da49ea572fee47.jpeg" class="" title="修改提交时的备注内容1">

<p><strong>语法</strong>：<code>git commit --amend</code></p>
<p><strong>命令</strong>：<code>git commit --amend</code></p>
<img src="/posts/3646/upload_e520df726617b30859396f8572fdb427.jpeg" class="" title="修改提交时的备注内容2">

<p>使用 <code>git log --pretty=oneline</code> 查看内容，发现已经成功修改啦。<strong>需要注意的是此项命令会修改提交时的 commit-id，即会覆盖原本的提交，需要谨慎操作</strong>。</p>
<h2 id="（四）修改分支名，实现无缝衔接"><a href="#（四）修改分支名，实现无缝衔接" class="headerlink" title="（四）修改分支名，实现无缝衔接"></a>（四）修改分支名，实现无缝衔接</h2><p>开发中的大佬都是拥有极快手速的人，建了个分支一不小心打错了某个字母或者两个字母打反了，可能就与本意存在较大误差了，Git 提供一种已经拉取了分支，在上面开发了不少的内容，但后来发现原本拉的分支名字就有问题的修复方法。</p>
<p>例如，我们的想新建的分支名为 feature/story-13711，却写成了 feature/stor-13711：</p>
<p><strong>语法</strong>：<code>git branch -m &lt;oldbranch&gt; &lt;newbranch&gt;</code></p>
<p><strong>命令</strong>：<code>git branch -m feature/stor-13711 feature/story-13711</code></p>
<img src="/posts/3646/upload_a9796f83e3e9b5367779fa97f8366b2c.jpeg" class="" title="修改分支名-实现无缝衔接">

<p>执行完之后发现文件的工作区已修改内容一点都没有变化，真正的实现了无痛过渡，皆大欢喜！</p>
<h2 id="（五）撤回提交"><a href="#（五）撤回提交" class="headerlink" title="（五）撤回提交"></a>（五）撤回提交</h2><p>日常工作中，可能由于需求变更、或者误操作等原因需要进行提交的撤回：</p>
<p>如下分析了各种原因撤销的场景，主要包括：</p>
<ul>
<li>已将更改交到本地存储，需要撤回提交</li>
<li>用新的提交内容替换上一次的提交</li>
<li>本地提交了错误的文件</li>
</ul>
<h3 id="已将更改提交到本地，需要撤回提交"><a href="#已将更改提交到本地，需要撤回提交" class="headerlink" title="已将更改提交到本地，需要撤回提交"></a>已将更改提交到本地，需要撤回提交</h3><p><strong>语法</strong>： <code>git reset --soft [&lt;commit-id&gt;/HEAD~n&gt;]</code></p>
<p><strong>命令</strong>：<code>git reset --soft HEAD~1</code></p>
<p>命令执行完成后，查看文件变更记录，可发现如下图所示：</p>
<img src="/posts/3646/upload_9e6f0b0e2803cabcd1bd109957985ab3.jpeg" class="" title="已将更改提交到本地-需要撤回提交">

<p>文件变更记录与未提交之前的文件变更记录是一致的，只是撤销了 commit 的操作。</p>
<h3 id="用新的更改替换撤回的更改"><a href="#用新的更改替换撤回的更改" class="headerlink" title="用新的更改替换撤回的更改"></a>用新的更改替换撤回的更改</h3><p>提交之中可能有些地方需要优化，我们可以撤销本次的 commit 以及文件暂存状态，修改之后再重新添加到暂存区进行提交。</p>
<p><strong>语法</strong>： <code>git reset --mixed [&lt;commit-id&gt;/HEAD~n&gt;]</code></p>
<p><strong>命令</strong>：<code>git reset --mixed HEAD~1</code></p>
<p>命令执行完成后，查看文件变更记录，可发现如下图所示：</p>
<img src="/posts/3646/upload_317b27f5fb6cddb0d3f4b0866107fb0d.jpeg" class="" title="用新的更改替换撤回的更改">

<p>已变更的文件都未添加到暂存区，撤销了 commit 和 add 的操作。</p>
<h3 id="本地提交了错误的文件"><a href="#本地提交了错误的文件" class="headerlink" title="本地提交了错误的文件"></a>本地提交了错误的文件</h3><p>本地将完全错误的，本不应提交的内容提交到了仓库，需要进行撤销，可以使用 –hard 参数</p>
<p><strong>语法</strong>： <code>git reset --hard [&lt;commit-id&gt;/HEAD~n&gt;]</code></p>
<p><strong>命令</strong>：<code>git reset --hard HEAD~1</code></p>
<p>命令执行完成后，查看文件变更记录，可发现如下图所示：</p>
<img src="/posts/3646/upload_f2dbca8b9718214953fa34bc02bd52c0.jpeg" class="" title="本地提交了错误的文件">

<p>已追踪文件的变更内容都消失了，撤销了 commit 和 add 的操作，同时撤销了本地已追踪内容的修改；未追踪的内容不会被改变。从上面的效果可以看到，文件的修改都会被撤销。**-hard 参数需要谨慎使用**。</p>
<h2 id="（六）撤销本地分支合并"><a href="#（六）撤销本地分支合并" class="headerlink" title="（六）撤销本地分支合并"></a>（六）撤销本地分支合并</h2><p>实际操作中，总会有很多的干扰，导致我们合并了并不该合并的分支到目标分支上。解决这种问题的方式有两种，<code>git reset</code> 和 <code>git revert</code>。 reset 的语法和命令之前已经介绍过，不做赘述， revert 的语法和命令和 reset 一致。但是产生的实际效果会有不同。</p>
<p>可以先来看下 revert 操作的实际效果，合并分支之后的效果如下图所示：</p>
<img src="/posts/3646/upload_86f7f94c4118991d03d9cb6c47277828.jpeg" class="" title="撤销本地分支合并">

<p>撤销合并：</p>
<p><strong>语法</strong>：<code>git revert &lt;commit-id&gt;</code></p>
<p><strong>命令</strong>：<code>git revert 700920</code></p>
<p>下图为执行命令后的效果：</p>
<img src="/posts/3646/upload_3ac3f2f171d3b51782c19ce0e8a4db6f.jpeg" class="" title="撤销本地分支合并2">

<p>经过前后对比可知，revert 执行之后会在原本的记录中新增一条提交记录。</p>
<p>reset 如上 “本地文件撤销” 例子所述，会删除掉原本已有的提交记录，在合并分支中，会删除原本合并分支的记录。revert 则有不同，会保留原本合并分支的记录，并在其上新增一条提交记录，便于之后有需要仍然能够回溯到 revert 之前的状态。</p>
<p>从需要提交到远程分支的角度来讲，reset 能够“毁尸灭迹”，不让别人发现我们曾经错误的合并过分支（<strong>注：多人协作中，需要谨慎使用</strong>）；revert 则会将合并分支和撤回记录一并显示在远程提交记录上。</p>
<h2 id="（七）恢复误删的本地分支"><a href="#（七）恢复误删的本地分支" class="headerlink" title="（七）恢复误删的本地分支"></a>（七）恢复误删的本地分支</h2><p>本地分支拉取之后，由于疏忽被删除，而且本地的分支并没有被同步到远程分支上，此时想要恢复本地分支。</p>
<p>误删的分支为 feature/delete，使用 <code>git reflog</code> 命令可查看到该仓库下的所有历史操作，如下图所示：</p>
<img src="/posts/3646/upload_b652bae25cb19d5b4800170c296def28.jpeg" class="" title="恢复误删的本地分支">

<p><strong>语法</strong>：<code>git checkout -b &lt;branch-name&gt; &lt;commit-id&gt;</code></p>
<p><strong>命令</strong>：<code>git checkout -b feature/delete HEAD@&#123;2&#125;</code></p>
<p>命令执行完成后，分支恢复到 HEAD@{2} 的快照，即从 master 分支拉取 feature/delete 分支的内容，仍然缺少“新增 xxx 文件”的提交，直接将文件内容恢复到最新的提交内容，使用命令 <code>git reset --hard HEAD@&#123;1&#125;</code> 即可实现硬性覆盖本地工作区内容的目的。<code>git reflog</code> 命令获取到的内容为本地仓库所有发生过的变更，可谓恢复利器，既可向前追溯，亦可向后调整，满满的时光追溯器的赶脚啊。。。</p>
<h2 id="（八）不确定哪个分支有自己提交的-commit"><a href="#（八）不确定哪个分支有自己提交的-commit" class="headerlink" title="（八）不确定哪个分支有自己提交的 commit"></a>（八）不确定哪个分支有自己提交的 commit</h2><p>工作中会经常碰到一种场景，某个提交先后合并到了各个分支上，但后来发现提交的这个修改是有问题的，需要排查到底哪个分支包含这个提交，然后将其修复掉。</p>
<p>需要先确定有问题的提交的 commit-id :</p>
<img src="/posts/3646/upload_b9d3c4c2dffdf45b78b41021d8efdce6.jpeg" class="" title="不确定哪个分支有自己提交的commit1">

<p>然后查看本地所有的分支：</p>
<img src="/posts/3646/upload_dfe14e32a79a8926637a10a6caffd761.jpeg" class="" title="不确定哪个分支有自己提交的commit2">

<p>可以看到本地有 4 个分支，本地的分支数量非人为控制的，在使用状态的分支直接删掉也不合适，分支数量达到一定程度，一个一个分支查找也不现实。Git 提供了一种能够直接通过 commit-id 查找出包含该内容分支的命令。</p>
<p><strong>语法</strong>：<code>git branch --contains &lt;commit-id&gt;</code></p>
<p><strong>命令</strong>：<code>git branch --contains 700920</code></p>
<p>命令执行后可以看到包含该问题提交的分支如下图所示，就可以很方便的在对应分支上修复内容啦。</p>
<img src="/posts/3646/upload_04c088890f184b87c394a2759fc2eabd.jpeg" class="" title="不确定哪个分支有自己提交的commit3">

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文介绍的是实际工作场景中可能出现的几种异常情况及解决方式，希望能够对大家有所帮助，不足之处敬请指正。实际上现在已经有很多 Git 操作对应的工具可以使用，需要明白的是工具中的每个操作等同于 Git 命令行的哪个命令，会有什么样的结果，以避免一些不必要发生的错误。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="https://www.edureka.co/blog/common-git-mistakes/#pushed">Git 错误集锦和修复方法</a></p>
<p><a href="https://www.jianshu.com/p/ea6341224e89">Git 中.gitignore 的配置语法</a></p>
<p><a href="https://juejin.im/post/5b0e5adc6fb9a009d82e4f20">git reset 和 git revert</a></p>
]]></content>
      <categories>
        <category>工具</category>
        <category>版本控制</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-使用Object键值替换Switch</title>
    <url>/posts/10849/</url>
    <content><![CDATA[<p>转载地址：<a href="https://www.cnblogs.com/ZerlinM/p/13595810.html">https://www.cnblogs.com/ZerlinM/p/13595810.html</a><br>原文地址：<a href="https://ultimatecourses.com/blog/deprecating-the-switch-statement-for-object-literals">https://ultimatecourses.com/blog/deprecating-the-switch-statement-for-object-literals</a></p>
<p>在许多编程语言中，switch 语句存在 - 但是它应该更长吗？如果你是一个 JavaScript 程序员，你经常跳进和跳出对象，创建，实例化和操作它们。对象非常灵活，它们是 JavaScript 中几乎所有内容的核心，使用它们代替 switch 语句是我最近一直在做的事情。</p>
<a id="more"></a>

<h2 id="什么是-switch-语句"><a href="#什么是-switch-语句" class="headerlink" title="什么是 switch 语句?"></a>什么是 switch 语句?</h2><p>如果您以前没有使用 switch 过或者有点不确定它是做什么的，那么让我们来看看吧。什么 switch 是输入并提供输出，例如正在运行的代码。<br>让我们来看一个通常的 switch 陈述：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> type = <span class="string">&#x27;coke&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> drink;</span><br><span class="line"><span class="keyword">switch</span> (type) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;coke&#x27;</span>:</span><br><span class="line">    drink = <span class="string">&#x27;Coke&#x27;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;pepsi&#x27;</span>:</span><br><span class="line">    drink = <span class="string">&#x27;Pepsi&#x27;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    drink = <span class="string">&#x27;Unknown drink!&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(drink); <span class="comment">// &#x27;Coke&#x27;</span></span><br></pre></td></tr></table></figure>

<p>它类似于 if 和 else 语句，但它应该评估单个值 - 在 switch 我们使用 a case 来评估每个值。<br>当你开始看到很多 else if 陈述时，某些东西可能是错误的，通常你会使用类似于 switch 它更适合目的和意图的东西。这是一些 else if 滥用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">&#x27;coke&#x27;</span>) &#123;</span><br><span class="line">    type = <span class="string">&#x27;Coke&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">&#x27;pepsi&#x27;</span>) &#123;</span><br><span class="line">    type = <span class="string">&#x27;Pepsi&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">&#x27;mountain dew&#x27;</span>) &#123;</span><br><span class="line">    type = <span class="string">&#x27;Mountain Dew&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">&#x27;lemonade&#x27;</span>) &#123;</span><br><span class="line">    type = <span class="string">&#x27;Lemonade&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">&#x27;fanta&#x27;</span>) &#123;</span><br><span class="line">    type = <span class="string">&#x27;Fanta&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// acts as our &quot;default&quot;</span></span><br><span class="line">    type = <span class="string">&#x27;Unknown drink!&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;You&#x27;ve picked a &quot;</span> + type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个实现太松散了，有错误的余地，加上它是一个非常冗长的语法，可以不断重复自己。还有一个黑客攻击的空间，因为你可以评估每个内部的多个表达式 else if，例如 else if (type === ‘coke’ &amp;&amp; somethingElse ！== ‘apples’)。这 switch 是该工作的最佳工具，尽管您需要不断添加 break;语句以防止案件失败，这是其众多问题之一。</p>
<h2 id="开关问题"><a href="#开关问题" class="headerlink" title="开关问题"></a>开关问题</h2><p>switch 从程序控制流程到其处理代码块的非标准方式存在多个问题，其余的 JavaScript 使用花括号而交换机则不然。从语法上讲，它不是 JavaScript 的最佳选择，也不是它的设计。我们被迫 break;在每个语句中手动添加语句 case，这可能导致难以调试和嵌套错误，如果我们忘记了！道格拉斯·克罗克福德（Douglas Crockford）曾多次撰写和谈论过这个问题，他的建议是谨慎对待。</p>
<p>我们经常在 JavaScript 中使用 Object 查找，通常用于我们永远不会考虑使用的东西 switch- 那么为什么不使用 Object 键值替换 switch？对象更灵活，具有更好的可读性和可维护性，我们不需要手动 break;每个“案例”。他们对新的 JavaScript 开发人员也很友好，因为他们是标准对象。</p>
<p>随着“案例”数量的增加，对象（哈希表）的性能优于交换机的平均成本（案例的顺序很重要）。对象方法是哈希表查找，并且交换机必须评估每个案例，直到它遇到匹配和中断。</p>
<h2 id="对象文本查找"><a href="#对象文本查找" class="headerlink" title="对象文本查找"></a>对象文本查找</h2><p>我们一直使用对象，无论是构造函数还是文字。通常，我们将它们用于对象查找目的，以从 Object 属性中获取值。<br>让我们设置一个 String 仅返回值的简单 Object 键值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> drinks = &#123;</span><br><span class="line">    coke: <span class="string">&#x27;Coke&#x27;</span>,</span><br><span class="line">    pepsi: <span class="string">&#x27;Pepsi&#x27;</span>,</span><br><span class="line">    lemonade: <span class="string">&#x27;Lemonade&#x27;</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="string">&#x27;Default item&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;The drink I chose was &#x27;</span> + (drinks[type] || drinks[<span class="string">&#x27;default&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> drink = getDrink(<span class="string">&#x27;coke&#x27;</span>);</span><br><span class="line"><span class="comment">// The drink I chose was Coke</span></span><br><span class="line"><span class="built_in">console</span>.log(drink);</span><br></pre></td></tr></table></figure>

<p>我们从交换机中保存了几行代码，对我而言，数据在演示中更加清晰。我们甚至可以进一步简化它，没有默认情况：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="string">&#x27;The drink I chose was &#x27;</span> +</span><br><span class="line">    &#123;</span><br><span class="line">      coke: <span class="string">&#x27;Coke&#x27;</span>,</span><br><span class="line">      pepsi: <span class="string">&#x27;Pepsi&#x27;</span>,</span><br><span class="line">      lemonade: <span class="string">&#x27;Lemonade&#x27;</span></span><br><span class="line">    &#125;[type]</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是，我们可能需要比 a 更复杂的代码 String，这可能会挂在函数内部。为了简洁和易于理解的示例，我将从新创建的函数返回上述字符串：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> type = <span class="string">&#x27;coke&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> drinks = &#123;</span><br><span class="line">  coke: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Coke&#x27;</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  pepsi: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Pepsi&#x27;</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  lemonade: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Lemonade&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>区别在于我们需要调用 Object 文字的函数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">drinks[type]();</span><br></pre></td></tr></table></figure>

<p>更具可维护性和可读性。我们也不必担心 break;陈述和案例会失败-这只是一个普通的对象。<br>通常，我们会 switch 在函数内部放入一个 return 值，因此在这里做同样的事情，然后将对象文字查找转换为可用的函数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> drinks = &#123;</span><br><span class="line">    coke: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;Coke&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    pepsi: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;Pepsi&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    lemonade: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;Lemonade&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> drinks[type]();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// let&#x27;s call it</span></span><br><span class="line"><span class="keyword">var</span> drink = getDrink(<span class="string">&#x27;coke&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(drink); <span class="comment">// &#x27;Coke&#x27;</span></span><br></pre></td></tr></table></figure>

<p>不错，很容易，但这并不能满足“ default”的要求 case，因此我们可以轻松创建它：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> fn;</span><br><span class="line">  <span class="keyword">var</span> drinks = &#123;</span><br><span class="line">    coke: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;Coke&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    pepsi: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;Pepsi&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    lemonade: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;Lemonade&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;Default item&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// if the drinks Object contains the type</span></span><br><span class="line">  <span class="comment">// passed in, let&#x27;s use it</span></span><br><span class="line">  <span class="keyword">if</span> (drinks[type]) &#123;</span><br><span class="line">    fn = drinks[type];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// otherwise we&#x27;ll assign the default</span></span><br><span class="line">    <span class="comment">// also the same as drinks.default</span></span><br><span class="line">    <span class="comment">// it&#x27;s just a little more consistent using square</span></span><br><span class="line">    <span class="comment">// bracket notation everywhere</span></span><br><span class="line">    fn = drinks[<span class="string">&#x27;default&#x27;</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fn();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// called with &quot;dr pepper&quot;</span></span><br><span class="line"><span class="keyword">var</span> drink = getDrink(<span class="string">&#x27;dr pepper&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(drink); <span class="comment">// &#x27;Default item&#x27;</span></span><br></pre></td></tr></table></figure>

<p>我们可以简化上面的内容，if 并在表达式中 else 使用 or ||运算符：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> drinks = &#123;</span><br><span class="line">    coke: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;Coke&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    pepsi: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;Pepsi&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    lemonade: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;Lemonade&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;Default item&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (drinks[type] || drinks[<span class="string">&#x27;default&#x27;</span>])();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这会将两个对象查找包装在括号内( )，将它们视为表达式。然后调用表达式的结果。如果 drinks[type]在查找中未找到，则默认为 drinks[‘default’]，简单！<br>我们不具备总是 return 里面的函数或者，我们可以改变引用任何变量然后返回它：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> drink;</span><br><span class="line">  <span class="keyword">var</span> drinks = &#123;</span><br><span class="line">    coke: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      drink = <span class="string">&#x27;Coke&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    pepsi: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      drink = <span class="string">&#x27;Pepsi&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    lemonade: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      drink = <span class="string">&#x27;Lemonade&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      drink = <span class="string">&#x27;Default item&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// invoke it</span></span><br><span class="line">  (drinks[type] || drinks[<span class="string">&#x27;default&#x27;</span>])();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// return a String with chosen drink</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;The drink I chose was &#x27;</span> + drink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> drink = getDrink(<span class="string">&#x27;coke&#x27;</span>);</span><br><span class="line"><span class="comment">// The drink I chose was Coke</span></span><br><span class="line"><span class="built_in">console</span>.log(drink);</span><br></pre></td></tr></table></figure>

<p>这些是非常基本的解决方案，而 Object 字面量包含一个 function 返回 a 的值 String，在您只需要 a 的情况下 String，可以将 a String 用作键的值-在某些情况下，该函数将包含逻辑，该逻辑将从该函数返回。如果您要混合使用函数和字符串，则始终可以使用函数来保存查找 type 和调用（如果是函数）会更容易-我们不想尝试调用 String。</p>
<h2 id="对象字面量“告吹”"><a href="#对象字面量“告吹”" class="headerlink" title="对象字面量“告吹”"></a>对象字面量“告吹”</h2><p>对于 switch 案例，我们可以让它们失败（这意味着一个以上的案例可以应用于特定的代码段）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> type = <span class="string">&#x27;coke&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> snack;</span><br><span class="line"><span class="keyword">switch</span> (type) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;coke&#x27;</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;pepsi&#x27;</span>:</span><br><span class="line">    snack = <span class="string">&#x27;Drink&#x27;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;cookies&#x27;</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;crisps&#x27;</span>:</span><br><span class="line">    snack = <span class="string">&#x27;Food&#x27;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    drink = <span class="string">&#x27;Unknown type!&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(snack); <span class="comment">// &#x27;Drink&#x27;</span></span><br></pre></td></tr></table></figure>

<p>让我们 coke 和 pepsi“贯穿”以不添加 break 语句。为 Object Literals 执行此操作非常简单且更具说明性 - 并且不易出错。我们的代码突然变得更加结构化，可读性和可重用性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSnack</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> snack;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isDrink</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (snack = <span class="string">&#x27;Drink&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isFood</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (snack = <span class="string">&#x27;Food&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> snacks = &#123;</span><br><span class="line">    coke: isDrink,</span><br><span class="line">    pepsi: isDrink,</span><br><span class="line">    cookies: isFood,</span><br><span class="line">    crisps: isFood</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> snacks[type]();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> snack = getSnack(<span class="string">&#x27;coke&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(snack); <span class="comment">// &#x27;Drink&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Object 键值是 JavaScript 中流动的一种更自然的控制，switch 有点陈旧和笨重，并且容易出现调试错误。对象更具可扩展性，可维护性，我们可以更好地测试它们。它们也是设计模式的一部分，在日常的其他编程任务中非常常用。对象键值可以包含函数以及任何其他对象类型，这使它们非常灵活！键值中的每个函数也都有函数作用域，因此我们可以从我们调用的父函数 getDrink 返回闭包（在这种情况下返回闭包）。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-前端动画必知必会：React和Vue都在用的FLIP思想实战</title>
    <url>/posts/7822/</url>
    <content><![CDATA[<p>转载自：<a href="https://zhuanlan.zhihu.com/p/146641652">https://zhuanlan.zhihu.com/p/146641652</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在 Vue 的官网中的过渡动画章节中，可以看到一个很酷炫的**<a href="https://link.zhihu.com/?target=https://cn.vuejs.org/v2/guide/transitions.html%23%E5%88%97%E8%A1%A8%E7%9A%84%E6%8E%92%E5%BA%8F%E8%BF%87%E6%B8%A1">动画效果</a>**</p>
<img src="/posts/7822/v2-741e6456c4471c34f6e346d3032ff323_b.jpg" class="" title="v2-741e6456c4471c34f6e346d3032ff323_b">

<p>乍一看，让我们手写出这个逻辑应该是非常复杂的，先看看本文最后要实现的效果吧，和这个案例是非常类似的。</p>
<a id="more"></a>

<h2 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h2><img src="/posts/7822/v2-67ea1b4e81adc6d0ee281a79c4a9da64_b.jpg" class="" title="v2-67ea1b4e81adc6d0ee281a79c4a9da64_b">

<p>也可以直接进预览网址里看：</p>
<p><a href="https://link.zhihu.com/?target=http://sl1673495.gitee.io/flip-animation">http://sl1673495.gitee.io/flip-animation</a></p>
<p>图片素材依然引用自知乎问题**<a href="https://www.zhihu.com/question/28997505">《有个漂亮女朋友是种怎样的体验？》</a>**，侵删。</p>
<h2 id="分析需求"><a href="#分析需求" class="headerlink" title="分析需求"></a>分析需求</h2><p>拿到了这个需求，第一直觉是怎么做？假设第一行第一个图片移动到了第二行第三列，是不是要计算出第一行的高度，再计算出第二行前两个元素的宽度，然后从初始的坐标点通过 CSS 或者一些动画 API 移动过去？这样做是可以，但是在图片不定高不定宽，并且一次要移动很多图片情况下，这个计算方法就非常复杂了。并且这种情况下，图片的坐标都需要我们手动管理，非常不利于维护和扩展。</p>
<p>换种思路，能不能直接很自然的把 DOM 元素通过原生 API 添加到 DOM 树中，然后让浏览器帮我们好这个终点值，最后我们再动画位移过去？</p>
<p>在文档里我们发现一个名词：<code>FLIP</code>，这给了我们一个线索，是不是用这个玩意就可以写出这个动画呢？</p>
<p>答案是肯定的，顺着这个线索找到 <code>Aerotwist</code> 社区里的一篇文章：**<a href="https://link.zhihu.com/?target=https://aerotwist.com/blog/flip-your-animations/">flip-your-animations</a>**，以这篇文章为切入点，一步步来实现一个类似的效果。</p>
<h2 id="FLIP"><a href="#FLIP" class="headerlink" title="FLIP"></a>FLIP</h2><p><code>FLIP</code> 究竟是什么东西呢？先看下它的定义：</p>
<h3 id="First"><a href="#First" class="headerlink" title="First"></a><strong>First</strong></h3><p>即将做动画的元素的初始状态（比如位置、透明度等等）。</p>
<h3 id="Last"><a href="#Last" class="headerlink" title="Last"></a><strong>Last</strong></h3><p>即将做动画的元素的最终状态。</p>
<h3 id="Invert"><a href="#Invert" class="headerlink" title="Invert"></a><strong>Invert</strong></h3><p>这一步比较关键，假设我们图片的初始位置是 <code>左: 0, 上：0</code>，元素动画后的最终位置是 <code>左：100, 上100</code>，那么很明显这个元素是向右下角运动了 <code>100px</code>。</p>
<p><strong>但是</strong>，此时我们不按照常规思维去先计算它的最终位置，然后再命令元素从 <code>0, 0</code> 运动到 <code>100, 100</code>，而是<strong>先让元素自己移动过去</strong>（比如在 Vue 中用数据来驱动，在数组前面追加几个图片，之前的图片就自己移动到下面去了）。</p>
<p>这里有一个关键的知识点要注意了，也是我在之前的文章**<a href="https://link.zhihu.com/?target=https://juejin.im/post/5ec73026f265da76da29cb25">《深入解析你不知道的 EventLoop 和浏览器渲染、帧动画、空闲回调》</a>**中提到过的：</p>
<p>DOM 元素属性的改变（比如 <code>left</code>、<code>right</code>、 <code>transform</code> 等等），会被集中起来延迟到浏览器的下一帧统一渲染，所以我们可以得到一个这样的中间时间点：<strong>DOM 状态（位置信息）改变了，而浏览器还没渲染</strong>。</p>
<p>有了这个前置条件，我们就可以保证先让 Vue 去操作 DOM 变更，此时浏览器还未渲染，我们已经能得到 DOM 状态变更后的位置了。</p>
<p>说的具体点，假设我们的图片是一行两个排列，图片数组初始化的状态是 <code>[img1, img2</code>，此时我们往数组头部追加两个元素 <code>[img3, img4, img1, img2]</code>，那么 <code>img1</code> 和 <code>img2</code> 就自然而然的被挤到下一行去了。</p>
<p>假设 <code>img1</code> 的初始位置是 <code>0, 0</code>，被数据驱动导致的 DOM 改变挤下去后的位置是 <code>100, 100</code>，那么此时浏览器还没有渲染，我们可以在这个时间点把 <code>img1.style.transform = translate(-100px, -100px)</code>，让它 先 <strong>Invert</strong> 倒置回位移前的位置。</p>
<h3 id="Play"><a href="#Play" class="headerlink" title="Play"></a><strong>Play</strong></h3><p>倒置了以后，想要让它做动画就很简单了，再让它回到 <code>0, 0</code> 的位置即可，本文会采用最新的 <code>Web Animation API</code> 来实现最后的 <code>Play</code>。</p>
<p><strong><a href="https://link.zhihu.com/?target=https://developer.mozilla.org/zh-CN/docs/Web/API/Animation">MDN 文档：Web Animation</a></strong></p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>首先图片渲染很简单，就让图片通过简单的排成 4 列即可：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.wrap</span> &#123;</span></span><br><span class="line">    display: flex;</span><br><span class="line">    flex-wrap: wrap;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.img</span> &#123;</span></span><br><span class="line">    width: 25%;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img-wrap&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;src in imgs&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;src&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">ref</span>=<span class="string">&quot;imgs&quot;</span> <span class="attr">class</span>=<span class="string">&quot;img&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;src&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>那么关键点就在于怎么往这个 <code>imgs</code> 数组里追加元素后，做一个流畅的路径动画。</p>
<p>我们来实现追加图片的方法 <code>add</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> newData = <span class="built_in">this</span>.getSister()</span><br><span class="line">  <span class="keyword">await</span> preload(newData)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先随机的取出几张图片作为待放入数组的元素，利用 <code>new Image</code> 预加载这些图片，防止渲染一堆空白图片到屏幕上。</p>
<p>然后定义一个计算一组 DOM 元素位置的函数 <code>getRects</code>，利用 <code>getBoundingClientRect</code> 可以获得最新的位置信息，这个方法在接下来获取图片元素旧位置和新位置时都要使用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRects</span>(<span class="params">doms</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> doms.map(<span class="function"><span class="params">dom</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> rect = dom.getBoundingClientRect();</span><br><span class="line">    <span class="keyword">const</span> &#123; left, top &#125; = rect;</span><br><span class="line">    <span class="keyword">return</span> &#123; left, top &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前已有的图片</span></span><br><span class="line"><span class="keyword">const</span> prevImgs = <span class="built_in">this</span>.$refs.imgs.slice();</span><br><span class="line"><span class="keyword">const</span> prevPositions = getRects(prevImgs);</span><br></pre></td></tr></table></figure>

<p>记录完图片的旧位置后，就可以向数组里追加新的图片了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.imgs = newData.concat(<span class="built_in">this</span>.imgs);</span><br></pre></td></tr></table></figure>

<p>随后就是比较关键的点了，我们知道 Vue 是异步渲染的，也就是改变了这个 <code>imgs</code> 数组后不会立刻发生 DOM 的变动，此时我们要用到 <code>nextTick</code> 这个 API，这个 API 把你传入的回调函数放进了 <code>microTask</code> 队列，正如上文提到的事件循环的文章里所说，<code>microTask</code>队列的执行一定发生在浏览器重新渲染前。</p>
<p>由于先调用了 <code>this.imgs = newData.concat(this.imgs)</code> 这段代码，触发了 Vue 的响应式依赖更新，此时 Vue 内部会把本次 DOM 更新的渲染函数先放到 <code>microTask</code>队列中，此时的队列是<code>[changeDOM]</code>。</p>
<p>调用了 <code>nextTick(callback)</code> 后，这个<code>callback</code>函数也会被追加到队列中，此时的队列是 <code>[changeDOM, callback]</code>。</p>
<p>这下聪明的你肯定就明白了，为什么 <code>nextTick</code>的回调函数里一定能获取到最新的 DOM 元素，此时新加入图片的 DOM 已经在 DOM 树中，但是屏幕还没有发生绘制，调用 <code>getBoundingClientRect</code> 可以触发「强制同步布局」，此后的代码里就可以获取到 DOM 在屏幕预计出现的准确位置。（注意，位置信息是最新的，但是屏幕上并没有发生绘制）</p>
<p>由于我们之前保存了图片元素节点的数组 <code>prevImgs</code>，所以在 <code>nextTick</code> 里对这些旧图片再调用一次 <code>getRect</code> 方法，获取到的就是旧图片的最新位置了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 最新 DOM 状态</span></span><br><span class="line">  <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 再调用同样的方法获取最新的元素位置</span></span><br><span class="line">    <span class="keyword">const</span> currentPositions = getRects(prevImgs)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>此时我们已经拥有了 <code>Invert</code> 步骤的关键信息，新位置和旧位置，那么接下来就很简单了，把图片数组循环做一个倒置后 <code>Play</code>的动画即可。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">prevImgs.forEach(<span class="function">(<span class="params">imgRef, imgIndex</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> currentPosition = currentPositions[imgIndex];</span><br><span class="line">  <span class="keyword">const</span> prevPosition = prevPositions[imgIndex];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 倒置后的位置，虽然图片移动到最新位置了，但你先给我回去，等着我来让你做动画。</span></span><br><span class="line">  <span class="keyword">const</span> invert = &#123;</span><br><span class="line">    left: prevPosition.left - currentPosition.left,</span><br><span class="line">    top: prevPosition.top - currentPosition.top</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> keyframes = [</span><br><span class="line">    <span class="comment">// 初始位置是倒置后的位置</span></span><br><span class="line">    &#123;</span><br><span class="line">      transform: <span class="string">`translate(<span class="subst">$&#123;invert.left&#125;</span>px, <span class="subst">$&#123;invert.top&#125;</span>px)`</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 图片更新后本来应该在的位置</span></span><br><span class="line">    &#123; <span class="attr">transform</span>: <span class="string">&#x27;translate(0)&#x27;</span> &#125;</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    duration: <span class="number">300</span>,</span><br><span class="line">    easing: <span class="string">&#x27;cubic-bezier(0,0,0.32,1)&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始运动！</span></span><br><span class="line">  <span class="keyword">const</span> animation = imgRef.animate(keyframes, options);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>此时一个非常流畅的路径动画效果就完成了。</p>
<p>完整实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> newData = <span class="built_in">this</span>.getSister()</span><br><span class="line">  <span class="keyword">await</span> preload(newData)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> prevImgs = <span class="built_in">this</span>.$refs.imgs.slice()</span><br><span class="line">  <span class="keyword">const</span> prevPositions = getRects(prevImgs)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.imgs = newData.concat(<span class="built_in">this</span>.imgs)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> currentPositions = getRects(prevImgs)</span><br><span class="line"></span><br><span class="line">    prevImgs.forEach(<span class="function">(<span class="params">imgRef, imgIndex</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> currentPosition = currentPositions[imgIndex]</span><br><span class="line">      <span class="keyword">const</span> prevPosition = prevPositions[imgIndex]</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> invert = &#123;</span><br><span class="line">        left: prevPosition.left - currentPosition.left,</span><br><span class="line">        top: prevPosition.top - currentPosition.top,</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> keyframes = [</span><br><span class="line">        &#123;</span><br><span class="line">          transform: <span class="string">`translate(<span class="subst">$&#123;invert.left&#125;</span>px, <span class="subst">$&#123;invert.top&#125;</span>px)`</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; <span class="attr">transform</span>: <span class="string">&quot;translate(0)&quot;</span> &#125;,</span><br><span class="line">      ]</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> options = &#123;</span><br><span class="line">        duration: <span class="number">300</span>,</span><br><span class="line">        easing: <span class="string">&quot;cubic-bezier(0,0,0.32,1)&quot;</span>,</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> animation = imgRef.animate(keyframes, options)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="乱序"><a href="#乱序" class="headerlink" title="乱序"></a>乱序</h2><p>现在我们想要实现官网 demo 中的 <code>shuffle</code> 效果，有了追加图片逻辑的铺垫，是不是已经觉得思路如泉涌了？没错，即使图片被打乱的再厉害，只要我们有「图片开始时的位置」和「图片结束时的位置」，那就可以轻松做到路径动画。</p>
<p>现在我们需要做的是把动画的逻辑抽离出来，我们分析一下整条链路：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">保存旧位置 -&gt; 改变数据驱动视图更新 -&gt; 获得新位置 -&gt; 利用 FLIP 做动画</span><br></pre></td></tr></table></figure>

<p>其实外部只需要传入一个 <code>update</code> 方法告诉我们如何去更新图片数组，就可以把这个逻辑完全抽象到一个函数里去。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">scheduleAnimation</span>(<span class="params">update</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 获取旧图片的位置</span></span><br><span class="line">  <span class="keyword">const</span> prevImgs = <span class="built_in">this</span>.$refs.imgs.slice()</span><br><span class="line">  <span class="keyword">const</span> prevSrcRectMap = createSrcRectMap(prevImgs)</span><br><span class="line">  <span class="comment">// 更新数据</span></span><br><span class="line">  update()</span><br><span class="line">  <span class="comment">// DOM更新后</span></span><br><span class="line">  <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> currentSrcRectMap = createSrcRectMap(prevImgs)</span><br><span class="line">    <span class="built_in">Object</span>.keys(prevSrcRectMap).forEach(<span class="function">(<span class="params">src</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> currentRect = currentSrcRectMap[src]</span><br><span class="line">      <span class="keyword">const</span> prevRect = prevSrcRectMap[src]</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> invert = &#123;</span><br><span class="line">        left: prevRect.left - currentRect.left,</span><br><span class="line">        top: prevRect.top - currentRect.top,</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> keyframes = [</span><br><span class="line">        &#123;</span><br><span class="line">          transform: <span class="string">`translate(<span class="subst">$&#123;invert.left&#125;</span>px, <span class="subst">$&#123;invert.top&#125;</span>px)`</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; <span class="attr">transform</span>: <span class="string">&quot;&quot;</span> &#125;,</span><br><span class="line">      ]</span><br><span class="line">      <span class="keyword">const</span> options = &#123;</span><br><span class="line">        duration: <span class="number">300</span>,</span><br><span class="line">        easing: <span class="string">&quot;cubic-bezier(0,0,0.32,1)&quot;</span>,</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> animation = currentRect.img.animate(keyframes, options)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么追加图片和乱序的函数就变得非常简单了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 追加图片</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> newData = <span class="built_in">this</span>.getSister()</span><br><span class="line">  <span class="keyword">await</span> preload(newData)</span><br><span class="line">  <span class="built_in">this</span>.scheduleAnimation(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.imgs = newData.concat(<span class="built_in">this</span>.imgs)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 乱序图片</span></span><br><span class="line"><span class="function"><span class="title">shuffle</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.scheduleAnimation(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.imgs = shuffle(<span class="built_in">this</span>.imgs)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h2><p><a href="https://link.zhihu.com/?target=https://github.com/sl1673495/flip-animation">https://github.com/sl1673495/flip-animation</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="FLIP-1"><a href="#FLIP-1" class="headerlink" title="FLIP"></a><strong>FLIP</strong></h3><p>FLIP 不光可以做位置变化的动画，对于透明度、宽高等等也一样可以很轻松的实现。</p>
<p>比如电商平台中经常会出现一个动画，点击一张商品图片后，商品从它本来的位置慢慢的放大成了一张完整的页面。</p>
<p><code>FLIP</code>的思路掌握后，只要你知道元素动画前的状态和元素动画后的状态，你都可以轻松的通过「倒置状态」后，让它们做一个流畅的动画后到达目的地，并且此时的 DOM 状态是很干净的，而不是通过大量计算的方式强迫它从 <code>0, 0</code> 位移到 <code>100, 100</code>，并且让 DOM 样式上留下 <code>transform: translate(100px, 100px)</code> 类似的字样。</p>
<h3 id="Web-Animation"><a href="#Web-Animation" class="headerlink" title="Web Animation"></a><strong>Web Animation</strong></h3><p>利用 <code>Web Animation API</code> 可以让我们用 JavaScript 更加直观的描述我们需要元素去做的动画，想象一下这个需求如果用 CSS 来做，我们大概会这样去完成这个需求：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> currentImgStyle = currentRect.img.style;</span><br><span class="line">currentImgStyle.transform = <span class="string">`translate(<span class="subst">$&#123;invert.left&#125;</span>px, <span class="subst">$&#123;invert.top&#125;</span>px)`</span>;</span><br><span class="line">currentImgStyle.transitionDuration = <span class="string">&#x27;0s&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">this</span>._reflow = <span class="built_in">document</span>.body.offsetHeight;</span><br><span class="line"></span><br><span class="line">currentRect.img.classList.add(<span class="string">&#x27;move&#x27;</span>);</span><br><span class="line"></span><br><span class="line">currentImgStyle.transform = currentRect.img.style.transitionDuration = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">currentRect.img.addEventListener(<span class="string">&#x27;transitionend&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  currentRect.img.classList.remove(<span class="string">&#x27;move&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这是选择用比较原生的方式去控制 CSS 样式实现的 FLIP 动画，这段代码让我觉得不舒服的点在于：</p>
<ol>
<li>需要通过 <code>class</code> 的增加和删除来和 CSS 来进行交互，整体流程不太符合直觉。</li>
<li>需要监听动画完成事件，并且做一些清理操作，容易遗漏。</li>
<li>需要利用 <code>document.body.offsetHeight</code> 这样的方式触发 <code>强制同步布局</code>，比较 hack 的知识点。</li>
<li>需要利用 <code>this._reflow = document.body.offsetHeight</code> 这样的方式向元素实例上增加一个没有意义的属性，防止被 Rollup 等打包工具 <code>tree-shaking</code> 误删。 比较 hack 的知识点 +1。</li>
</ol>
<p>而利用 <code>Web Animation API</code> 的代码则变得非常符合直觉和易于维护：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> keyframes = [</span><br><span class="line">  &#123;</span><br><span class="line">    transform: <span class="string">`translate(<span class="subst">$&#123;invert.left&#125;</span>px, <span class="subst">$&#123;invert.top&#125;</span>px)`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">transform</span>: <span class="string">&#x27;&#x27;</span> &#125;</span><br><span class="line">];</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  duration: <span class="number">300</span>,</span><br><span class="line">  easing: <span class="string">&#x27;cubic-bezier(0,0,0.32,1)&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> animation = currentRect.img.animate(keyframes, options);</span><br></pre></td></tr></table></figure>

<p>关于兼容性问题，W3C 已经提供了 **<code>Web Animation API Polyfill</code>**，可以放心大胆的使用。</p>
<p>期待在不久的未来，我们可以抛弃旧的动画模式，迎接这种更新更好的 API。</p>
<p>希望这篇文章能让对动画发愁的你有一些收获，谢谢！</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
        <category>动画</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
        <tag>解决方案</tag>
        <tag>动画</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-彻底理解cookie-session-token</title>
    <url>/posts/44111/</url>
    <content><![CDATA[<h2 id="发展史"><a href="#发展史" class="headerlink" title="发展史"></a>发展史</h2><p>1、很久很久以前，Web 基本上就是文档的浏览而已， 既然是浏览，作为服务器， 不需要记录谁在某一段时间里都浏览了什么文档，每次请求都是一个新的 HTTP 协议， 就是请求加响应， 尤其是我不用记住是谁刚刚发了 HTTP 请求， 每个请求对我来说都是全新的。这段时间很嗨皮</p>
<p>2、但是随着交互式 Web 应用的兴起，像在线购物网站，需要登录的网站等等，马上就面临一个问题，那就是要管理会话，必须记住哪些人登录系统， 哪些人往自己的购物车中放商品， 也就是说我必须把每个人区分开，这就是一个不小的挑战，因为 HTTP 请求是无状态的，所以想出的办法就是给大家发一个会话标识(session id), 说白了就是一个随机的字串，每个人收到的都不一样， 每次大家向我发起 HTTP 请求的时候，把这个字符串给一并捎过来， 这样我就能区分开谁是谁了</p>
<p>3、这样大家很嗨皮了，可是服务器就不嗨皮了，每个人只需要保存自己的 session id，而服务器要保存所有人的 session id ！ 如果访问服务器多了， 就得由成千上万，甚至几十万个。</p>
<p>这对服务器说是一个巨大的开销 ， 严重的限制了服务器扩展能力， 比如说我用两个机器组成了一个集群， 小 F 通过机器 A 登录了系统， 那 session id 会保存在机器 A 上， 假设小 F 的下一次请求被转发到机器 B 怎么办？ 机器 B 可没有小 F 的 session id 啊。</p>
<p>有时候会采用一点小伎俩： session sticky ， 就是让小 F 的请求一直粘连在机器 A 上， 但是这也不管用， 要是机器 A 挂掉了， 还得转到机器 B 去。</p>
<p>那只好做 session 的复制了， 把 session id 在两个机器之间搬来搬去， 快累死了。</p>
<a id="more"></a>

<img src="/posts/44111/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A11.png" class="" title="负载均衡1">

<p>后来有个叫 Memcached 的支了招： 把 session id 集中存储到一个地方， 所有的机器都来访问这个地方的数据， 这样一来，就不用复制了， 但是增加了单点失败的可能性， 要是那个负责 session 的机器挂了， 所有人都得重新登录一遍， 估计得被人骂死。</p>
<img src="/posts/44111/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A12.png" class="" title="负载均衡2">

<p>也尝试把这个单点的机器也搞出集群，增加可靠性， 但不管如何， 这小小的 session 对我来说是一个沉重的负担</p>
<p>4、于是有人就一直在思考， 我为什么要保存这可恶的 session 呢， 只让每个客户端去保存该多好？</p>
<p>可是如果不保存这些 session id , 怎么验证客户端发给我的 session id 的确是我生成的呢？ 如果不去验证，我们都不知道他们是不是合法登录的用户， 那些不怀好意的家伙们就可以伪造 session id , 为所欲为了。</p>
<p>嗯，对了，关键点就是验证 ！</p>
<p>比如说， 小 F 已经登录了系统， 我给他发一个令牌(token)， 里边包含了小 F 的 user id， 下一次小 F 再次通过 Http 请求访问我的时候， 把这个 token 通过 Http header 带过来不就可以了。</p>
<p>不过这和 session id 没有本质区别啊， 任何人都可以可以伪造， 所以我得想点儿办法， 让别人伪造不了。</p>
<p>那就对数据做一个签名吧， 比如说我用 HMAC-SHA256 算法，加上一个只有我才知道的密钥， 对数据做一个签名， 把这个签名和数据一起作为 token ， 由于密钥别人不知道， 就无法伪造 token 了。</p>
<img src="/posts/44111/token%E7%AE%97%E6%B3%95.png" class="" title="token算法">

<p>这个 token 我不保存， 当小 F 把这个 token 给我发过来的时候，我再用同样的 HMAC-SHA256 算法和同样的密钥，对数据再计算一次签名， 和 token 中的签名做个比较， 如果相同， 我就知道小 F 已经登录过了，并且可以直接取到小 F 的 user id , 如果不相同， 数据部分肯定被人篡改过， 我就告诉发送者： 对不起，没有认证。</p>
<img src="/posts/44111/token%E9%AA%8C%E8%AF%81.png" class="" title="token验证">

<p>Token 中的数据是明文保存的（虽然我会用 Base64 做下编码， 但那不是加密）， 还是可以被别人看到的， 所以我不能在其中保存像密码这样的敏感信息。</p>
<p>当然， 如果一个人的 token 被别人偷走了， 那我也没办法， 我也会认为小偷就是合法用户， 这其实和一个人的 session id 被别人偷走是一样的。</p>
<p>这样一来， 我就不保存 session id 了， 我只是生成 token , 然后验证 token ， 我用我的 CPU 计算时间获取了我的 session 存储空间 ！</p>
<p>解除了 session id 这个负担， 可以说是无事一身轻， 我的机器集群现在可以轻松地做水平扩展， 用户访问量增大， 直接加机器就行。 这种无状态的感觉实在是太好了！</p>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>cookie 是一个非常具体的东西，指的就是浏览器里面能永久存储的一种数据，仅仅是浏览器实现的一种数据存储功能。</p>
<p>cookie 由服务器生成，发送给浏览器，浏览器把 cookie 以 kv 形式保存到某个目录下的文本文件内，下一次请求同一网站时会把该 cookie 发送给服务器。由于 cookie 是存在客户端上的，所以浏览器加入了一些限制确保 cookie 不会被恶意使用，同时不会占据太多磁盘空间，所以每个域的 cookie 数量是有限的。</p>
<h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>session 从字面上讲，就是会话。这个就类似于你和一个人交谈，你怎么知道当前和你交谈的是张三而不是李四呢？对方肯定有某种特征（长相等）表明他就是张三。</p>
<p>session 也是类似的道理，服务器要知道当前发请求给自己的是谁。为了做这种区分，服务器就要给每个客户端分配不同的“身份标识”，然后客户端每次向服务器发请求的时候，都带上这个“身份标识”，服务器就知道这个请求来自于谁了。至于客户端怎么保存这个“身份标识”，可以有很多种方式，对于浏览器客户端，大家都默认采用 cookie 的方式。</p>
<p>服务器使用 session 把用户的信息临时保存在了服务器上，用户离开网站后 session 会被销毁。这种用户信息存储方式相对 cookie 来说更安全，可是 session 有一个缺陷：如果 web 服务器做了负载均衡，那么下一个操作请求到了另一台服务器的时候 session 会丢失。</p>
<h2 id="Token"><a href="#Token" class="headerlink" title="Token"></a>Token</h2><p>在 Web 领域基于 Token 的身份验证随处可见。在大多数使用 Web API 的互联网公司中，tokens 是多用户下处理认证的最佳方式。</p>
<p>以下几点特性会让你在程序中使用基于 Token 的身份验证</p>
<ol>
<li>无状态、可扩展</li>
<li>支持移动设备</li>
<li>跨程序调用</li>
<li>安全</li>
</ol>
<p>那些使用基于 Token 的身份验证的大佬们</p>
<p>大部分你见到过的 API 和 Web 应用都使用 tokens。例如 Facebook, Twitter, Google+, GitHub 等。</p>
<h3 id="Token-的起源"><a href="#Token-的起源" class="headerlink" title="Token 的起源"></a>Token 的起源</h3><p>在介绍基于 Token 的身份验证的原理与优势之前，不妨先看看之前的认证都是怎么做的。</p>
<h4 id="基于服务器的验证"><a href="#基于服务器的验证" class="headerlink" title="基于服务器的验证"></a>基于服务器的验证</h4><p>我们都是知道 HTTP 协议是无状态的，这种无状态意味着程序需要验证每一次请求，从而辨别客户端的身份。</p>
<p>在这之前，程序都是通过在服务端存储的登录信息来辨别请求的。这种方式一般都是通过存储 Session 来完成。</p>
<p>下图展示了基于服务器验证的原理</p>
<img src="/posts/44111/session.png" class="" title="session">

<p>随着 Web，应用程序，已经移动端的兴起，这种验证的方式逐渐暴露出了问题。尤其是在可扩展性方面。</p>
<h4 id="基于服务器验证方式暴露的一些问题"><a href="#基于服务器验证方式暴露的一些问题" class="headerlink" title="基于服务器验证方式暴露的一些问题"></a>基于服务器验证方式暴露的一些问题</h4><ol>
<li>Session：每次认证用户发起请求时，服务器需要去创建一个记录来存储信息。当越来越多的用户发请求时，内存的开销也会不断增加。</li>
<li>可扩展性：在服务端的内存中使用 Seesion 存储登录信息，伴随而来的是可扩展性问题。</li>
<li>CORS(跨域资源共享)：当我们需要让数据跨多台移动设备上使用时，跨域资源的共享会是一个让人头疼的问题。在使用 Ajax 抓取另一个域的资源，就可以会出现禁止请求的情况。</li>
<li>CSRF(跨站请求伪造)：用户在访问银行网站时，他们很容易受到跨站请求伪造的攻击，并且能够被利用其访问其他的网站。</li>
</ol>
<p>在这些问题中，可扩展行是最突出的。因此我们有必要去寻求一种更有行之有效的方法。</p>
<h4 id="基于-Token-的验证原理"><a href="#基于-Token-的验证原理" class="headerlink" title="基于 Token 的验证原理"></a>基于 Token 的验证原理</h4><p>基于 Token 的身份验证是无状态的，我们不将用户信息存在服务器或 Session 中。</p>
<p>这种概念解决了在服务端存储信息时的许多问题</p>
<p>NoSession 意味着你的程序可以根据需要去增减机器，而不用去担心用户是否登录。</p>
<p>基于 Token 的身份验证的过程如下:</p>
<ol>
<li>用户通过用户名和密码发送请求。</li>
<li>程序验证。</li>
<li>程序返回一个签名的 token 给客户端。</li>
<li>客户端储存 token,并且每次用于每次发送请求。</li>
<li>服务端验证 token 并返回数据。</li>
</ol>
<p>每一次请求都需要 token。token 应该在 HTTP 的头部发送从而保证了 Http 请求无状态。我们同样通过设置服务器属性 Access-Control-Allow-Origin: *，让服务器能接受到来自所有域的请求。需要主要的是，在 ACAO 头部标明(designating)*时，不得带有像 HTTP 认证，客户端 SSL 证书和 cookies 的证书。</p>
<p>实现思路：</p>
<img src="/posts/44111/token%E6%B5%81%E7%A8%8B.png" class="" title="token流程">

<ol>
<li>用户登录校验，校验成功后就返回 Token 给客户端。</li>
<li>客户端收到数据后保存在客户端</li>
<li>客户端每次访问 API 是携带 Token 到服务器端。</li>
<li>服务器端采用 filter 过滤器校验。校验成功则返回请求数据，校验失败则返回错误码</li>
</ol>
<p>当我们在程序中认证了信息并取得 token 之后，我们便能通过这个 Token 做许多的事情。</p>
<p>我们甚至能基于创建一个基于权限的 token 传给第三方应用程序，这些第三方程序能够获取到我们的数据（当然只有在我们允许的特定的 token）</p>
<h4 id="Tokens-的优势"><a href="#Tokens-的优势" class="headerlink" title="Tokens 的优势"></a>Tokens 的优势</h4><p><strong>无状态、可扩展</strong></p>
<p>在客户端存储的 Tokens 是无状态的，并且能够被扩展。基于这种无状态和不存储 Session 信息，负载负载均衡器能够将用户信息从一个服务传到其他服务器上。</p>
<p>如果我们将已验证的用户的信息保存在 Session 中，则每次请求都需要用户向已验证的服务器发送验证信息(称为 Session 亲和性)。用户量大时，可能会造成一些拥堵。</p>
<p>但是不要着急。使用 tokens 之后这些问题都迎刃而解，因为 tokens 自己 hold 住了用户的验证信息。</p>
<p><strong>安全性</strong></p>
<p>请求中发送 token 而不再是发送 cookie 能够防止 CSRF(跨站请求伪造)。即使在客户端使用 cookie 存储 token，cookie 也仅仅是一个存储机制而不是用于认证。不将信息存储在 Session 中，让我们少了对 session 操作。</p>
<p>token 是有时效的，一段时间之后用户需要重新验证。我们也不一定需要等到 token 自动失效，token 有撤回的操作，通过 token revocataion 可以使一个特定的 token 或是一组有相同认证的 token 无效。</p>
<p><strong>可扩展性</strong></p>
<p>Tokens 能够创建与其它程序共享权限的程序。例如，能将一个随便的社交帐号和自己的大号(Fackbook 或是 Twitter)联系起来。当通过服务登录 Twitter(我们将这个过程 Buffer)时，我们可以将这些 Buffer 附到 Twitter 的数据流上(we are allowing Buffer to post to our Twitter stream)。</p>
<p>使用 tokens 时，可以提供可选的权限给第三方应用程序。当用户想让另一个应用程序访问它们的数据，我们可以通过建立自己的 API，得出特殊权限的 tokens。</p>
<p><strong>多平台跨域</strong></p>
<p>我们提前先来谈论一下 CORS(跨域资源共享)，对应用程序和服务进行扩展的时候，需要介入各种各种的设备和应用程序。</p>
<p>Having our API just serve data, we can also make the design choice to serve assets from a CDN. This eliminates the issues that CORS brings up after we set a quick header configuration for our application.</p>
<p>只要用户有一个通过了验证的 token，数据和资源就能够在任何域上被请求到。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Access-Control-Allow-Origin: *</span><br></pre></td></tr></table></figure>

<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://zhuanlan.zhihu.com/p/63061864">https://zhuanlan.zhihu.com/p/63061864</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>缓存</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-怎样在Mac上删除iPhone和iPad备份</title>
    <url>/posts/21365/</url>
    <content><![CDATA[<p>本地 iPhone 和 iPad 备份可能会占用大量空间。以下是查看正在使用多少空间并释放空间的方法。这些技巧适用于 macOS Catalina，macOS Mojave 和其他最新版本的 macOS。</p>
<p>从 Mac 删除 iPhone 和 iPad 备份之前，建议您将它们导出到外部驱动器。您可以使用 Time Machine 或简单地复制并粘贴备份文件夹。您也可以打开 iCloud 备份。删除备份之前，请确保已将其复制到其他位置，或者确保不再需要它。</p>
<a id="more"></a>

<h2 id="从存储管理中删除备份"><a href="#从存储管理中删除备份" class="headerlink" title="从存储管理中删除备份"></a>从存储管理中删除备份</h2><p>macOS Mojave 引入了一个新的存储管理工具，该工具列出了 iOS 备份。以前，您必须导航到特定的 Finder 文件夹才能查看 Mac 上的所有 iOS 备份文件。</p>
<p>要访问它，请单击菜单栏中的“ Apple”图标，然后选择“关于本机”选项。</p>


<p>在这里，切换到“存储”选项卡，然后单击“管理”按钮。</p>


<p>在“存储管理”窗口中，单击侧栏中的“ iOS 文件”选项。</p>
<p>现在，您将在此处看到所有 iOS 文件备份。右键单击要删除的 iOS 备份，然后单击“删除”选项。</p>


<p>再次单击“删除”按钮以确认您的选择。</p>


<p>现在，iOS 备份将被删除，您将获得存储空间。重复此过程以删除其他备份。</p>
<p><strong>PC 或 Mac 上我的 iPhone 或 iPad 备份在哪里？</strong></p>
<h2 id="从-Finder-删除-iPhone-和-iPad-备份"><a href="#从-Finder-删除-iPhone-和-iPad-备份" class="headerlink" title="从 Finder 删除 iPhone 和 iPad 备份"></a>从 Finder 删除 iPhone 和 iPad 备份</h2><p>从 macOS Catalina 开始，Apple 将 iTunes 应用程序拆分为多个应用程序-音乐，播客和电视。现在，Finder 负责同步 iPhone 和 iPad。</p>
<p>如果习惯于从 iTunes 管理设备备份，则可以从 Finder 应用程序执行相同的步骤。</p>
<p>首先，将 iPhone 或 iPad 连接到 Mac，打开 Finder 应用程序，然后从侧栏中选择设备。在这里，单击“管理备份”按钮。</p>


<p>现在，弹出窗口将列出 Mac 上的所有 iPhone 和 iPad 备份。选择要删除的备份，然后单击“删除备份”按钮。</p>


<p>在弹出窗口中，通过单击“删除”按钮确认您的步骤。</p>
<p><a href="https://evestorm.github.io/posts/21365/%E5%9C%A8Finder%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3%E4%B8%AD%E5%8D%95%E5%87%BB%E2%80%9C%E5%88%A0%E9%99%A4%E2%80%9D%E6%8C%89%E9%92%AE.png"><img src="%E8%BD%AC%E8%BD%BD-%E6%80%8E%E6%A0%B7%E5%9C%A8Mac%E4%B8%8A%E5%88%A0%E9%99%A4iPhone%E5%92%8CiPad%E5%A4%87%E4%BB%BD/%E5%9C%A8Finder%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3%E4%B8%AD%E5%8D%95%E5%87%BB%E2%80%9C%E5%88%A0%E9%99%A4%E2%80%9D%E6%8C%89%E9%92%AE-20201119101636083.png" alt="在Finder弹出窗口中单击“删除”按钮">在 Finder 弹出窗口中单击“删除”按钮</a></p>
<p>iOS 备份现在将被删除。您可以对要删除的所有备份执行此操作。</p>
<p><strong>如何在没有 iTunes 的情况下备份和还原 iPhone 或 iPad</strong></p>
<h2 id="在-Finder-中查找所有-iPhone-和-iPad-备份"><a href="#在-Finder-中查找所有-iPhone-和-iPad-备份" class="headerlink" title="在 Finder 中查找所有 iPhone 和 iPad 备份"></a>在 Finder 中查找所有 iPhone 和 iPad 备份</h2><p>如果您没有运行 macOS Mojave，或者只想手动删除文件和文件夹，则可以从 Finder 应用程序中删除。</p>
<p>所有 iPhone 和 iPad 备份都存储在“库”文件夹中的一个特定子文件夹中。</p>
<p>您可以使用 Spotlight 搜索快速到达那里。单击菜单栏上的“搜索”图标或按 Command + Space 将其打开，粘贴以下文本，然后按 Enter。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/Library/Application Support/MobileSync/Backup/</span><br></pre></td></tr></table></figure>



<p>Finder 将立即打开，您将看到 iOS 备份的所有文件夹。唯一的问题是文件夹名称不可读。您将不知道与备份关联的 iOS 设备。但是，您可以使用时间戳记来计算备份的时间。</p>
<p>如果要从 Mac 删除所有 iOS 备份，这是最快的方法。</p>
<p>您可以选择要删除的备份（文件夹），单击鼠标右键，然后选择“移至垃圾箱”选项将其删除。</p>


<p>要释放 Mac 上的存储空间，请右键单击“垃圾箱”图标，然后选择“空垃圾箱”。</p>

]]></content>
      <categories>
        <category>操作系统</category>
        <category>macOS</category>
      </categories>
      <tags>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-滚动视差-CSS不在话下</title>
    <url>/posts/56953/</url>
    <content><![CDATA[<p>掘金链接：<a href="https://juejin.im/post/5b6d0756e51d4562b31ad23c">https://juejin.im/post/5b6d0756e51d4562b31ad23c</a></p>
<p>github 链接：<a href="https://github.com/chokcoco/iCSS/issues/37">https://github.com/chokcoco/iCSS/issues/37</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-编写高质量可维护的代码：优雅命名</title>
    <url>/posts/55714/</url>
    <content><![CDATA[<p>转载自：<a href="https://mp.weixin.qq.com/s/-_Ji2NZOh5CmQ0ciA0vsUA">https://mp.weixin.qq.com/s/-_Ji2NZOh5CmQ0ciA0vsUA</a></p>
<h2 id="编写高质量可维护的代码：优雅命名"><a href="#编写高质量可维护的代码：优雅命名" class="headerlink" title="编写高质量可维护的代码：优雅命名"></a>编写高质量可维护的代码：优雅命名</h2><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>俗话说得好，万事开头难。而对于前端 coder 来说，每次新项目、新需求来的时候，我想大家最苦恼的往往就是如何去命名，无论是项目名称、页面的文件名称亦或是代码中的方法名称，对于我来说，但凡名字想好了以后，我觉得需求就已经写完一半了。</p>
<p>如何才能更好，更优雅的去解决这些命名问题呢？在这之前，先随我看一些不合适的命名示例吧。</p>
<a id="more"></a>

<h2 id="不合适的命名"><a href="#不合适的命名" class="headerlink" title="不合适的命名"></a>不合适的命名</h2><p>我们先来看一些例子：</p>
<ul>
<li>无意义的，抽象的，任何地方可以使用，谁都不知道你这里用的命名来源是谁</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">const</span> data;</span><br><span class="line"><span class="keyword">const</span> info;</span><br><span class="line"><span class="keyword">const</span> tool;</span><br></pre></td></tr></table></figure>

<ul>
<li>简称，单词的简称或者缩写很容易让人无法确定具体指代什么</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">const</span> comp;</span><br><span class="line"><span class="keyword">const</span> crt_date;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">const</span> components;</span><br><span class="line"><span class="keyword">const</span> company;</span><br><span class="line"><span class="keyword">const</span> current_date;</span><br></pre></td></tr></table></figure>

<ul>
<li>数字或者字母结尾的命名，让其他人无法获取这些之间的区别</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">const</span> button1;</span><br><span class="line"><span class="keyword">const</span> button2;</span><br><span class="line"><span class="keyword">const</span> info1;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">const</span> importButton;</span><br><span class="line"><span class="keyword">const</span> userInfo;</span><br></pre></td></tr></table></figure>

<ul>
<li>全局的地方不要用前置或后置下划线，前置下划线通常代表了私有变量</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">const</span> _firstName_ = <span class="string">&#x27;Zcy&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> firstName_ = <span class="string">&#x27;Zcy&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> _firstName = <span class="string">&#x27;Zcy&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">const</span> firstName = <span class="string">&#x27;Zcy&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="命名规则"><a href="#命名规则" class="headerlink" title="命名规则"></a>命名规则</h2><p>如何让命名更简单呢，只要遵循一些规则规范，总能将复杂的事情拆分开来，变成一件简单的事情。</p>
<h3 id="直白、有意义"><a href="#直白、有意义" class="headerlink" title="直白、有意义"></a>直白、有意义</h3><p>想要让你的命名简单易懂，最简单的方式就是直白并且有意义，直接了当的在命名中体现出你这个命名的功能，或者描述，举个例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatList</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> data = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserInfo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatNewsList</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> articleData = [];</span><br></pre></td></tr></table></figure>

<p>如果在页面中定义了上面这样的变量，哪种写法可以让你在没有注释的情况下，就能快速了解原作者的书写意图呢？（当然，代码中还是需要一些必要注释的）。</p>
<p>所以在命名的时候，需要的就是直白、完备、有意义，让别人通过命名就能了解到这个名称（无论是变量、方法或者是样式名）背后的的含义，这样的命名就是高效的、易懂的。</p>
<h3 id="遵从惯例、标准"><a href="#遵从惯例、标准" class="headerlink" title="遵从惯例、标准"></a>遵从惯例、标准</h3><p>习惯使用业界习惯的命名标识，或者是约定俗成的书写习惯。</p>
<ul>
<li>用 <code>id</code> 当做数据标识命名，而不是 <code>identifier</code></li>
<li>例如布尔值命名类型，通常只有两个值类型：真，假，根据不同的使用场景，也可以有一些常用的命名方式</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 可见、状态等，可用 is+动词/形容词的方式</span></span><br><span class="line"><span class="keyword">const</span> isVisible;</span><br><span class="line"><span class="keyword">const</span> isLoading;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置，选项等类型，可以用 withXxx、hasXxx 来标识是否有某个属性等,enableXxx 来表示是否开启配置</span></span><br><span class="line"><span class="keyword">const</span> withTab;</span><br><span class="line"><span class="keyword">const</span> hasPlan;</span><br><span class="line"><span class="keyword">const</span> enableFilter;</span><br></pre></td></tr></table></figure>

<ul>
<li>例如方法命名，也可以使用动词 + 名次类的组合命名方式，操作类方法 fetchXxx，getXxx，当需要根据某些属性获取数据时可用 ，getXxxByYxx 这类的命名，删除类方法 deleteXxx，格式化数据 formatXxx</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 数据获取方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserInfo</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchSearchList</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要根据一些属性去获取数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getGoodsById</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">queryUserByName</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deleteUser</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeGoodsItem</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 格式化数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatDate</span>(<span class="params"></span>)</span>&#123;&#125;；</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sortByDesc</span>(<span class="params"></span>)</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="规范约束"><a href="#规范约束" class="headerlink" title="规范约束"></a>规范约束</h3><p>团队如果用统一的命名规范，那就一定要遵守，例如文件名的命名是大写字母开头的驼峰写法，那你的命名就不能再修改为其他方式，在规范创建之初或者修订时可以提出修改意见并进行讨论，但如果已经确立的，就不要再。去自由的破坏规范。</p>
<p>当然也可以使用一些辅助手段帮助约束代码中的命名校验，例如在 Eslint 配置中加入 <code>id-match</code> 或者 <code>camelcase</code>，前者可以直接通过正则配置自己需要的命名规范，后者则是直接采用了驼峰命名的规范约束。</p>
<p>这里也举例介绍一下在 <code>VsCode</code> 中 <code>Eslint</code> 的使用</p>
<ul>
<li>首选电脑全局安装 eslint</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install eslint -g</span><br></pre></td></tr></table></figure>

<ul>
<li><code>VsCode</code> 中安装 <code>ESlint</code> 插件并且启用</li>
</ul>
<img src="/posts/55714/eslint.jpg" class="" title="eslint">

<ul>
<li>在自己项目中，执行 <code>eslint --init</code> 命令来创建项目的 <code>.eslintrc.js</code> 文件，之后可以在 <code>.eslintrc.js</code> 文件中的 <code>rules</code> 规则添加上规范的约束条件来使用这个规则</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="string">&#x27;id-match&#x27;</span>: [<span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;^[a-z]+([A-Z][a-z]+)*$&#x27;</span>],</span><br><span class="line">    camelcase: [<span class="string">&#x27;error&#x27;</span>, &#123; <span class="attr">properties</span>: <span class="string">&#x27;always&#x27;</span> &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>项目中如果碰到不符合规范的就会直接报错提示</li>
</ul>
<img src="/posts/55714/error.png" class="" title="error">

<h2 id="命名规范推荐"><a href="#命名规范推荐" class="headerlink" title="命名规范推荐"></a>命名规范推荐</h2><p>上面简单介绍了一些命名的规则，那么具体到实际操作中，我们又有哪些较好的命名规范可以选择呢？下面根据不同的使用场景，也简单给大家介绍一些经常推荐使用的命名规范。</p>
<h3 id="项目名称、文件名称"><a href="#项目名称、文件名称" class="headerlink" title="项目名称、文件名称"></a>项目名称、文件名称</h3><p>项目或者单文件的命名方面，常见规则：</p>
<ol>
<li><code>kebab-case</code>：横短线命名，也叫串式命名法，小写字母的词组，中间加 <code>-</code> 拼接的方式，这种方式命名便于同类内容快速查找</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; good</span><br><span class="line">news-index;</span><br><span class="line">news-list;</span><br><span class="line">news-detail;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>camelcase</code>：小驼峰命名，第一个单字以小写字母开始，第二个单字的首字母大写</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; good</span><br><span class="line">newsIndex;</span><br><span class="line">newsList;</span><br><span class="line">newsDetail;</span><br></pre></td></tr></table></figure>

<h3 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h3><ul>
<li>变量：常用小驼峰命名</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">const</span> userInfo;</span><br><span class="line"><span class="keyword">const</span> userAddressList;</span><br><span class="line"><span class="keyword">const</span> currentDate;</span><br></pre></td></tr></table></figure>

<ul>
<li>全部使用大写字母，单词之间采用 <code>_</code> 分割</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">const</span> ITEM_LIST;</span><br><span class="line"><span class="keyword">const</span> PAGE_ITEM_LIST;</span><br><span class="line"><span class="keyword">const</span> DEFAULT_CONFIG;</span><br></pre></td></tr></table></figure>

<ul>
<li>方法：小驼峰命名，并且推荐命名时添加一些动词类，可以帮助快速理解方法含义，例如以 handle 开头，中间 xxx 表示操作内容，show 表示具体操作， <code>handlexxxxChange</code>，<code>handlexxxxShow</code>，而比如数据获取可以用 get，fetch 这类</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 小驼峰命名</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserInfo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addSuplierInfo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一些操作类的辅助命名</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleUserInfoChange</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleTitleClick</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchPageData</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>类名：大驼峰命名</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonLogo</span></span>;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">CartCenter</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="css"><a href="#css" class="headerlink" title="css"></a>css</h3><h4 id="BEM-规范"><a href="#BEM-规范" class="headerlink" title="BEM 规范"></a>BEM 规范</h4><p><code>BEM</code> 是一种命名 CSS 样式的命名方法和规范，全称 <code>Block</code>（块）、 <code>Element</code>（元素）、<code>Modifier</code>（修饰符） ，想必很多人都比较熟悉了。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Block：一般可以看做是独立具有实际意义的模块部分，例如 header,container,menu 等</span><br><span class="line">Element：组成 Block 的一部分，没有具体的实际意义，一般也不独立使用，例如 menu item，list item，header title 等</span><br><span class="line">Modifier：一般是块或者元素的修饰状态或者行为，例如 disabled，color，checked 等</span><br></pre></td></tr></table></figure>

<p>而 <code>BEM</code> 的写法一般是 <code>.block-name__element-name--modifier-name</code>，其中 <code>Block</code>与 <code>Element</code> 之间连接是通过 <code>__</code> 双下划线，<code>Block</code>，<code>Element</code> 与 <code>Modifier</code> 之间是通过 <code>--</code> 双中划线进行连接，当使用<code>less</code>或者 <code>sass</code> 语法编写 <code>css</code> 时，通过嵌套语法也能够很简洁的书写这部分样式。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;head&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;head__title&quot;</span>&gt;</span></span><br><span class="line">    标题</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;head__title--disabled&quot;</span>&gt;</span>置灰内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.head</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">    &amp;__title &#123;</span><br><span class="line">      font-size: 14px;</span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#666</span>;</span></span><br><span class="line">      &amp;--disabled: &#123;</span><br><span class="line"><span class="css">        <span class="selector-tag">color</span>: <span class="selector-id">#f00</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>BEM</code> 命名规范可以让样式的命名更加模块化，组件之间结构独立，减少了命名之间的冲突，有着不错的易读性、维护性等等，但可能会让项目中的样式命特别的长。</p>
<p>下面也有一些使用 BEM 命名规范的网站，有兴趣的可以去看看：</p>
<ul>
<li><a href="https://csswizardry.com/">https://csswizardry.com/</a></li>
<li><a href="https://mediatemple.net/">https://mediatemple.net/</a></li>
<li><a href="https://www.udemy.com/">https://www.udemy.com/</a></li>
</ul>
<h4 id="常用-CSS-样式名称"><a href="#常用-CSS-样式名称" class="headerlink" title="常用 CSS 样式名称"></a>常用 CSS 样式名称</h4><p>这里引用一下掘金作者 <code>冷石Boy</code> 的 css 样式名称</p>
<p><strong>包裹类：</strong> container, wrapper, outer, inner, box, header, footer, main, content, aside, page, section, block</p>
<p><strong>状态类：</strong> primary, secondary, success, danger, warning, info, error, Link, light, dark, disabled, active, checked, loading</p>
<p><strong>尺寸类：</strong> large, middle, small, bigger, smaller</p>
<p><strong>组件类：</strong> card, list, picture, carousel, swiper, menu, navs, badge, hint, modal, dialog</p>
<p><strong>位置类：</strong> first, last, current, prev, next, forward, back</p>
<p><strong>文本类：</strong> title, desc, content, date, author, category,label,tag</p>
<p><strong>人物类：</strong> avatar, name, age, post, intro</p>
<h2 id="取名推荐工具"><a href="#取名推荐工具" class="headerlink" title="取名推荐工具"></a>取名推荐工具</h2><p>当然对于命名有困难选择症的朋友来说，可以推荐你们一个意想不到的网站 —— <strong>Codelf</strong>(<a href="https://unbug.github.io/codelf)%EF%BC%8C%E4%B8%80%E4%B8%AA%E5%B8%AE%E4%BD%A0%E6%90%9C%E7%B4%A2">https://unbug.github.io/codelf)，一个帮你搜索</a> <code>Github</code>、<code>GitLab</code> 等网站中，你想查找的内容的不同命名。</p>


<p>并且这个网站支持 <code>JavaScript</code>、<code>CSS</code>、<code>HTML</code>、<code>Java</code> 等多种语言的搜索，可以方便的过滤不需要的搜索类型。</p>


<p>Hover 搜索词后的操作，Search 会再以当前选词进行一次搜索，Repo 可以跳转这个词语的出处项目，Copy 当然就不说了，有兴趣的朋友都可以尝试一下。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>命名其实并不麻烦，遵循一些定好的规则规范，或者自己给自己定义好这个规范，然后进行直白、有意义的命名，那么之后的命名就只会成为你的一种习惯，而不再是困扰你的难题，也希望大家可以分享一些自己的命名规范或者技巧，共同讨论下吧。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>规范</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
        <tag>规范</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-说说原型（prototype）、原型链和原型继承</title>
    <url>/posts/12455/</url>
    <content><![CDATA[<p>转载自：<a href="https://zhuanlan.zhihu.com/p/35790971">https://zhuanlan.zhihu.com/p/35790971</a></p>
<h2 id="一、原型-prototype-和-proto"><a href="#一、原型-prototype-和-proto" class="headerlink" title="一、原型 prototype 和 __proto__"></a>一、原型 <code>prototype</code> 和 <code>__proto__</code></h2><ul>
<li><p>每个对象都有一个<code>__proto__</code>属性，并且指向它的<code>prototype</code>原型对象</p>
</li>
<li><p>每个构造函数都有一个<code>prototype</code>原型对象</p>
</li>
<li><ul>
<li><code>prototype</code>原型对象里的<code>constructor</code>指向构造函数本身</li>
</ul>
</li>
</ul>
<img src="/posts/12455/v2-e722d5325f7d4215169f1d04296e0f89_720w.png" class="" title="v2-e722d5325f7d4215169f1d04296e0f89_720w">

<a id="more"></a>

<p><strong>有的同学可能会问<code>prototype</code> 和 <code>__proto__</code>有什么用呢？</strong></p>
<p>实例对象的<code>__proto__</code>指向构造函数的<code>prototype</code>，从而实现继承。</p>
<p><code>prototype</code>对象相当于特定类型所有实例对象都可以访问的公共容器</p>
<img src="/posts/12455/v2-1ae63b09f2f38aee29efc79f1400b8d3_720w.jpg" class="" title="v2-1ae63b09f2f38aee29efc79f1400b8d3_720w">

<p><strong>看一下代码就清楚了</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">nick, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.nick = nick;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.nick);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> Person(<span class="string">&#x27;Byron&#x27;</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> Person(<span class="string">&#x27;Casper&#x27;</span>, <span class="number">25</span>);</span><br><span class="line"></span><br><span class="line">p1.sayName(); <span class="comment">// Byron</span></span><br><span class="line"></span><br><span class="line">p2.sayName(); <span class="comment">// Casper</span></span><br><span class="line"></span><br><span class="line">p1.__proto__ === Person.prototype; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">p2.__proto__ === Person.prototype; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">p1.__proto__ === p2.__proto__; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">Person.prototype.constructor === Person; <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意<br>\1. 当<code>Object.prototype.__proto__</code> 已被大多数浏览器厂商所支持的今天，其存在和确切行为仅在 ECMAScript 2015 规范中被标准化为传统功能，以确保 Web 浏览器的兼容性。为了更好的支持，建议只使用 <code>Object.getPrototypeOf()</code>。<br>\2. Object.create(null) 新建的对象是没有<strong>proto</strong>属性的。</p>
</blockquote>
<h2 id="二、原型链"><a href="#二、原型链" class="headerlink" title="二、原型链"></a>二、原型链</h2><p>请看以下代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">arr.valueOf(); <span class="comment">//  [1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<p>我们再来看一张图</p>
<img src="/posts/12455/v2-baca413d5f93e3b7194c13a0b3c4621d_720w.jpg" class="" title="v2-baca413d5f93e3b7194c13a0b3c4621d_720w">

<p>按照之前的理论，如果自身没有该方法，我们应该去<code>Array.prototype</code>对象里去找，但是你会发现<code>arr.__proto__</code>上压根就没有<code>valueOf</code>方法，那它是从哪里来的呢？</p>
<p><strong>各位客官，请看这张图</strong></p>
<img src="/posts/12455/v2-cd7629e47fcb399e5f009c7dbb5149d8_720w.jpg" class="" title="v2-cd7629e47fcb399e5f009c7dbb5149d8_720w">

<p>很奇怪我们在<code>Array.prototype.__proto__</code>里找到了<code>valueOf</code>方法，为什么呢？</p>
<h2 id="查找valueOf方法的过程"><a href="#查找valueOf方法的过程" class="headerlink" title="查找valueOf方法的过程"></a>查找<code>valueOf</code>方法的过程</h2><p>当试图访问一个对象的属性时，它不仅仅在该对象上搜寻，还会搜寻该对象的原型，以及该对象的原型的原型，依次层层向上搜索，直到找到一个名字匹配的属性或到达原型链的末尾。</p>
<p>查找 valueOf 大致流程</p>
<ol>
<li>当前实例对象 obj，查找 obj 的属性或方法，找到后返回</li>
<li>没有找到，通过<code>obj. __proto__</code>，找到 obj 构造函数的<code>prototype</code>并且查找上面的属性和方法，找到后返回</li>
<li>没有找到，把<code>Array.prototype</code>当做 obj，重复以上步骤</li>
</ol>
<p>当然不会一直找下去，原型链是有终点的，最后查找到<code>Object.prototype</code>时<br><code>Object.prototype.__proto__ === null</code>，意味着查找结束</p>
<img src="/posts/12455/v2-78c74eec6cda54f09e10092a5080f739_720w.jpg" class="" title="v2-78c74eec6cda54f09e10092a5080f739_720w">

<p>我们来看看上图的关系</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">arr.__proto__ === <span class="built_in">Array</span>.prototype;</span><br><span class="line"><span class="literal">true</span>;</span><br><span class="line"><span class="built_in">Array</span>.prototype.__proto__ === <span class="built_in">Object</span>.prototype;</span><br><span class="line"><span class="literal">true</span>;</span><br><span class="line">arr.__proto__.__proto__ === <span class="built_in">Object</span>.prototype;</span><br><span class="line"><span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型链的终点</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.__proto__ === <span class="literal">null</span>;</span><br><span class="line"><span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<p><strong>原型链如下：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">arr ---&gt; Array.prototype ---&gt; Object.prototype ---&gt; null</span><br></pre></td></tr></table></figure>

<p><strong>这就是传说中的原型链，层层向上查找，最后还没有就返回 undefined</strong></p>
<h2 id="三、JavaScript-中的继承"><a href="#三、JavaScript-中的继承" class="headerlink" title="三、JavaScript 中的继承"></a>三、JavaScript 中的继承</h2><h2 id="3-1-什么是继承？"><a href="#3-1-什么是继承？" class="headerlink" title="3.1 什么是继承？"></a>3.1 什么是继承？</h2><blockquote>
<p>继承是指一个对象直接使用另外一个对象的属性和方法</p>
</blockquote>
<p>由此可见只要实现属性和方法的继承，就达到继承的效果</p>
<ul>
<li>得到一个对象的属性</li>
<li>得到一个对象的方法</li>
</ul>
<h2 id="3-2-属性如何继承？"><a href="#3-2-属性如何继承？" class="headerlink" title="3.2 属性如何继承？"></a>3.2 属性如何继承？</h2><p>我们先创建一个<code>Person</code>类</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法定义在构造函数的原型上</span></span><br><span class="line">Person.prototype.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>此时我想创建一个<code>Teacher</code>类，我希望它可以继承<code>Person</code>所有的属性，并且额外添加属于自己特定的属性；</p>
<ul>
<li>一个新的属性，subject——这个属性包含了教师教授的学科。</li>
</ul>
<p>定义<code>Teacher</code>的构造函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Teacher</span>(<span class="params">name, age, subject</span>) </span>&#123;</span><br><span class="line">  Person.call(<span class="built_in">this</span>, name, age);</span><br><span class="line">  <span class="built_in">this</span>.subject = subject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>属性的继承是通过在一个类内执行另外一个类的构造函数，通过<code>call</code>指定<code>this</code>为当前执行环境，这样就可以得到另外一个类的所有属性。</strong></p>
<blockquote>
<p>Person.call(this, name, age)</p>
</blockquote>
<p>我们实例化一下看看</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> teacher = <span class="keyword">new</span> Teacher(<span class="string">&#x27;jack&#x27;</span>, <span class="number">25</span>, <span class="built_in">Math</span>);</span><br><span class="line"></span><br><span class="line">teacher.age;</span><br><span class="line"><span class="number">25</span>;</span><br><span class="line">teacher.name;</span><br><span class="line">(<span class="string">&#x27;jack&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>很明显<code>Teacher</code>成功继承了<code>Person</code>的属性</p>
<h2 id="3-3-方法如何继承？"><a href="#3-3-方法如何继承？" class="headerlink" title="3.3 方法如何继承？"></a>3.3 方法如何继承？</h2><p>我们需要让<code>Teacher</code>从<code>Person</code>的原型对象里继承方法。我们要怎么做呢？</p>
<p>我们都知道类的方法都定义在<code>prototype</code>里，那其实我们只需要把<code>Person.prototype</code>的备份赋值给<code>Teacher.prototype</code>即可</p>
<blockquote>
<p>Teacher.prototype = Object.create(Person.prototype)</p>
</blockquote>
<p><a href="https://link.zhihu.com/?target=https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create">Object.create</a>简单说就是新建一个对象，使用现有的对象赋值给新建对象的<code>__proto__</code></p>
<p>可能有人会问为什么是备份呢？</p>
<p>因为如果直接赋值，那会是引用关系，意味着修改<code>Teacher. prototype</code>，也会同时修改<code>Person.prototype</code>，这是不合理的。</p>
<p>另外注意一点就是，在给<code>Teacher</code>类添加方法时，应该在修改<code>prototype</code>以后，否则会被覆盖掉，原因是赋值前后的属性值是不同的对象。</p>
<p>最后还有一个问题，我们都知道<code>prototype</code>里有个属性<code>constructor</code>指向构造函数本身，但是因为我们是复制其他类的<code>prototype</code>，所以这个指向是不对的，需要更正一下。<br>如果不修改，会导致我们类型判断出错</p>
<blockquote>
<p>Teacher.prototype.constructor = Teacher</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Teacher.prototype = <span class="built_in">Object</span>.create(Person.prototype)</span><br><span class="line"></span><br><span class="line">Teacher.prototype.constructor</span><br><span class="line">ƒ <span class="function"><span class="title">Person</span>(<span class="params">name, age</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">    <span class="built_in">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Teacher.prototype.constructor = Teacher</span><br><span class="line">ƒ <span class="function"><span class="title">Teacher</span>(<span class="params">name, age, subject</span>)</span> &#123;</span><br><span class="line">    Person.call(<span class="built_in">this</span>, name, age)</span><br><span class="line">    <span class="built_in">this</span>.subject = subject</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>继承方法的最终方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Teacher.prototype = <span class="built_in">Object</span>.create(Person.prototype);</span><br><span class="line">Teacher.prototype.constructor = Teacher;</span><br></pre></td></tr></table></figure>

<h2 id="3-4-hasOwnProperty"><a href="#3-4-hasOwnProperty" class="headerlink" title="3.4 hasOwnProperty"></a>3.4 hasOwnProperty</h2><p>在原型链上查询属性比较耗时，对性能有影响，试图访问不存在的属性时会遍历整个原型链。</p>
<p>遍历对象属性时，每个可枚举的属性都会被枚举出来。 要检查是否具有自己定义的属性，而不是原型链上的属性，必须使用<code>hasOwnProperty</code>方法。</p>
<p><a href="https://link.zhihu.com/?target=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty">hasOwnProperty</a> 是 JavaScript 中唯一处理属性并且不会遍历原型链的方法。</p>
<h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><h2 id="prototype-和-proto"><a href="#prototype-和-proto" class="headerlink" title="prototype 和 __proto__"></a><code>prototype</code> 和 <code>__proto__</code></h2><ul>
<li><p>每个对象都有一个<code>__proto__</code>属性，并且指向它的<code>prototype</code>原型对象</p>
</li>
<li><p>每个构造函数都有一个<code>prototype</code>原型对象</p>
</li>
<li><ul>
<li><code>prototype</code>原型对象里的<code>constructor</code>指向构造函数本身</li>
</ul>
</li>
</ul>
<h2 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h2><p>每个对象都有一个<code>__proto__</code>，它指向它的<code>prototype</code>原型对象，而<code>prototype</code>原型对象又具有一个自己的<code>prototype</code>原型对象，就这样层层往上直到一个对象的原型<code>prototype</code>为<code>null</code></p>
<p>这个查询的路径就是<code>原型链</code></p>
<h2 id="JavaScript-中的继承"><a href="#JavaScript-中的继承" class="headerlink" title="JavaScript 中的继承"></a>JavaScript 中的继承</h2><ul>
<li>属性继承</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法定义在构造函数的原型上</span></span><br><span class="line">Person.prototype.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Teacher</span>(<span class="params">name, age, subject</span>) </span>&#123;</span><br><span class="line">  Person.call(<span class="built_in">this</span>, name, age);</span><br><span class="line">  <span class="built_in">this</span>.subject = subject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>方法继承</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Teacher.prototype = <span class="built_in">Object</span>.create(Person.prototype);</span><br><span class="line">Teacher.prototype.constructor = Teacher;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
        <category>原型</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>原型</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-这一次，彻底弄懂JavaScript执行机制</title>
    <url>/posts/37082/</url>
    <content><![CDATA[<p>转载自：<a href="https://juejin.cn/post/6844903512845860872">https://juejin.cn/post/6844903512845860872</a></p>
<p>本文的目的就是要保证你彻底弄懂 javascript 的执行机制，如果读完本文还不懂，可以揍我。</p>
<p>不论你是 javascript 新手还是老鸟，不论是面试求职，还是日常开发工作，我们经常会遇到这样的情况：给定的几行代码，我们需要知道其输出内容和顺序。因为 javascript 是一门单线程语言，所以我们可以得出结论：</p>
<ul>
<li>javascript 是按照语句出现的顺序执行的</li>
</ul>
<a id="more"></a>

<p>看到这里读者要打人了：我难道不知道 js 是一行一行执行的？还用你说？稍安勿躁，正因为 js 是一行一行执行的，所以我们以为 js 都是这样的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br></pre></td></tr></table></figure>

<p>然而实际上 js 是这样的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;定时器开始啦&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;马上执行for循环啦&#x27;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">    i == <span class="number">99</span> &amp;&amp; resolve();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;执行then函数啦&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;代码执行结束&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>依照<strong>js 是按照语句出现的顺序执行</strong>这个理念，我自信的写下输出结果：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//&quot;定时器开始啦&quot;</span></span><br><span class="line"><span class="comment">//&quot;马上执行for循环啦&quot;</span></span><br><span class="line"><span class="comment">//&quot;执行then函数啦&quot;</span></span><br><span class="line"><span class="comment">//&quot;代码执行结束&quot;</span></span><br></pre></td></tr></table></figure>

<p>去 chrome 上验证下，结果完全不对，瞬间懵了，说好的一行一行执行的呢？</p>
<p>我们真的要彻底弄明白 javascript 的执行机制了。</p>
<h3 id="1-关于-javascript"><a href="#1-关于-javascript" class="headerlink" title="1.关于 javascript"></a>1.关于 javascript</h3><p>javascript 是一门<strong>单线程</strong>语言，在最新的 HTML5 中提出了 Web-Worker，但 javascript 是单线程这一核心仍未改变。所以一切 javascript 版的”多线程”都是用单线程模拟出来的，一切 javascript 多线程都是纸老虎！</p>
<h3 id="2-javascript-事件循环"><a href="#2-javascript-事件循环" class="headerlink" title="2.javascript 事件循环"></a>2.javascript 事件循环</h3><p>既然 js 是单线程，那就像只有一个窗口的银行，客户需要排队一个一个办理业务，同理 js 任务也要一个一个顺序执行。如果一个任务耗时过长，那么后一个任务也必须等着。那么问题来了，假如我们想浏览新闻，但是新闻包含的超清图片加载很慢，难道我们的网页要一直卡着直到图片完全显示出来？因此聪明的程序员将任务分为两类：</p>
<ul>
<li>同步任务</li>
<li>异步任务</li>
</ul>
<p>当我们打开网站时，网页的渲染过程就是一大堆同步任务，比如页面骨架和页面元素的渲染。而像加载图片音乐之类占用资源大耗时久的任务，就是异步任务。关于这部分有严格的文字定义，但本文的目的是用最小的学习成本彻底弄懂执行机制，所以我们用导图来说明：</p>
<img src="/posts/37082/15fdd88994142347.png" class="" title="15fdd88994142347">

<p>导图要表达的内容用文字来表述的话：</p>
<ul>
<li>同步和异步任务分别进入不同的执行”场所”，同步的进入主线程，异步的进入 Event Table 并注册函数。</li>
<li>当指定的事情完成时，Event Table 会将这个函数移入 Event Queue。</li>
<li>主线程内的任务执行完毕为空，会去 Event Queue 读取对应的函数，进入主线程执行。</li>
<li>上述过程会不断重复，也就是常说的 Event Loop(事件循环)。</li>
</ul>
<p>我们不禁要问了，那怎么知道主线程执行栈为空啊？js 引擎存在 monitoring process 进程，会持续不断的检查主线程执行栈是否为空，一旦为空，就会去 Event Queue 那里检查是否有等待被调用的函数。</p>
<p>说了这么多文字，不如直接一段代码更直白：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> data = [];</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">  url: www.javascript.com,</span><br><span class="line">  data: data,</span><br><span class="line">  success: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;发送成功!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;代码执行结束&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>上面是一段简易的<code>ajax</code>请求代码：</p>
<ul>
<li>ajax 进入 Event Table，注册回调函数<code>success</code>。</li>
<li>执行<code>console.log(&#39;代码执行结束&#39;)</code>。</li>
<li>ajax 事件完成，回调函数<code>success</code>进入 Event Queue。</li>
<li>主线程从 Event Queue 读取回调函数<code>success</code>并执行。</li>
</ul>
<p>相信通过上面的文字和代码，你已经对 js 的执行顺序有了初步了解。接下来我们来研究进阶话题：setTimeout。</p>
<h3 id="3-又爱又恨的-setTimeout"><a href="#3-又爱又恨的-setTimeout" class="headerlink" title="3.又爱又恨的 setTimeout"></a>3.又爱又恨的 setTimeout</h3><p>大名鼎鼎的<code>setTimeout</code>无需再多言，大家对他的第一印象就是异步可以延时执行，我们经常这么实现延时 3 秒执行：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;延时3秒&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<p>渐渐的<code>setTimeout</code>用的地方多了，问题也出现了，有时候明明写的延时 3 秒，实际却 5，6 秒才执行函数，这又咋回事啊？</p>
<p>先看一个例子：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  task();</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;执行console&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>根据前面我们的结论，<code>setTimeout</code>是异步的，应该先执行<code>console.log</code>这个同步任务，所以我们的结论是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//执行console</span></span><br><span class="line"><span class="comment">//task()</span></span><br></pre></td></tr></table></figure>

<p>去验证一下，结果正确！ 然后我们修改一下前面的代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  task();</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">10000000</span>);</span><br></pre></td></tr></table></figure>

<p>乍一看其实差不多嘛，但我们把这段代码在 chrome 执行一下，却发现控制台执行<code>task()</code>需要的时间远远超过 3 秒，说好的延时三秒，为啥现在需要这么长时间啊？</p>
<p>这时候我们需要重新理解<code>setTimeout</code>的定义。我们先说上述代码是怎么执行的：</p>
<ul>
<li><code>task()</code>进入 Event Table 并注册,计时开始。</li>
<li>执行<code>sleep</code>函数，很慢，非常慢，计时仍在继续。</li>
<li>3 秒到了，计时事件<code>timeout</code>完成，<code>task()</code>进入 Event Queue，但是<code>sleep</code>也太慢了吧，还没执行完，只好等着。</li>
<li><code>sleep</code>终于执行完了，<code>task()</code>终于从 Event Queue 进入了主线程执行。</li>
</ul>
<p>上述的流程走完，我们知道<code>setTimeout</code>这个函数，是经过指定时间后，把要执行的任务(本例中为<code>task()</code>)加入到 Event Queue 中，又因为是单线程任务要一个一个执行，如果前面的任务需要的时间太久，那么只能等着，导致真正的延迟时间远远大于 3 秒。</p>
<p>我们还经常遇到<code>setTimeout(fn,0)</code>这样的代码，0 秒后执行又是什么意思呢？是不是可以立即执行呢？</p>
<p>答案是不会的，<code>setTimeout(fn,0)</code>的含义是，指定某个任务在主线程最早可得的空闲时间执行，意思就是不用再等多少秒了，只要主线程执行栈内的同步任务全部执行完成，栈为空就马上执行。举例说明：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//代码1</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;先执行这里&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;执行啦&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line">复制代码;</span><br><span class="line"><span class="comment">//代码2</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;先执行这里&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;执行啦&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<p>代码 1 的输出结果是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//先执行这里</span></span><br><span class="line"><span class="comment">//执行啦</span></span><br></pre></td></tr></table></figure>

<p>代码 2 的输出结果是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//先执行这里</span></span><br><span class="line"><span class="comment">// ... 3s later</span></span><br><span class="line"><span class="comment">// 执行啦</span></span><br></pre></td></tr></table></figure>

<p>关于<code>setTimeout</code>要补充的是，即便主线程为空，0 毫秒实际上也是达不到的。根据 HTML 的标准，最低是 4 毫秒。有兴趣的同学可以自行了解。</p>
<h3 id="4-又恨又爱的-setInterval"><a href="#4-又恨又爱的-setInterval" class="headerlink" title="4.又恨又爱的 setInterval"></a>4.又恨又爱的 setInterval</h3><p>上面说完了<code>setTimeout</code>，当然不能错过它的孪生兄弟<code>setInterval</code>。他俩差不多，只不过后者是循环的执行。对于执行顺序来说，<code>setInterval</code>会每隔指定的时间将注册的函数置入 Event Queue，如果前面的任务耗时太久，那么同样需要等待。</p>
<p>唯一需要注意的一点是，对于<code>setInterval(fn,ms)</code>来说，我们已经知道不是每过<code>ms</code>秒会执行一次<code>fn</code>，而是每过<code>ms</code>秒，会有<code>fn</code>进入 Event Queue。一旦**<code>setInterval</code>的回调函数<code>fn</code>执行时间超过了延迟时间<code>ms</code>，那么就完全看不出来有时间间隔了**。这句话请读者仔细品味。</p>
<h3 id="5-Promise-与-process-nextTick-callback"><a href="#5-Promise-与-process-nextTick-callback" class="headerlink" title="5.Promise 与 process.nextTick(callback)"></a>5.Promise 与 process.nextTick(callback)</h3><p>传统的定时器我们已经研究过了，接着我们探究<code>Promise</code>与<code>process.nextTick(callback)</code>的表现。</p>
<p><code>Promise</code>的定义和功能本文不再赘述，不了解的读者可以学习一下阮一峰老师的<a href="http://es6.ruanyifeng.com/#docs/promise">Promise</a>。而<code>process.nextTick(callback)</code>类似 node.js 版的”setTimeout”，在事件循环的下一次循环中调用 callback 回调函数。</p>
<p>我们进入正题，除了广义的同步任务和异步任务，我们对任务有更精细的定义：</p>
<ul>
<li>macro-task(宏任务)：包括整体代码 script，setTimeout，setInterval</li>
<li>micro-task(微任务)：Promise，process.nextTick</li>
</ul>
<p>不同类型的任务会进入对应的 Event Queue，比如<code>setTimeout</code>和<code>setInterval</code>会进入相同的 Event Queue。</p>
<p>事件循环的顺序，决定 js 代码的执行顺序。进入整体代码(宏任务)后，开始第一次循环。接着执行所有的微任务。然后再次从宏任务开始，找到<strong>其中一个任务队列</strong>执行完毕，再执行所有的微任务。听起来有点绕，我们用文章最开始的一段代码说明：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise&#x27;</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;then&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;console&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>这段代码作为宏任务，进入主线程。</li>
<li>先遇到<code>setTimeout</code>，那么将其回调函数注册后分发到宏任务 Event Queue。(注册过程与上同，下文不再描述)</li>
<li>接下来遇到了<code>Promise</code>，<code>new Promise</code>立即执行，<code>then</code>函数分发到微任务 Event Queue。</li>
<li>遇到<code>console.log()</code>，立即执行。</li>
<li>好啦，整体代码 script 作为第一个宏任务执行结束，看看有哪些微任务？我们发现了<code>then</code>在微任务 Event Queue 里面，执行。</li>
<li>ok，第一轮事件循环结束了，我们开始第二轮循环，当然要从宏任务 Event Queue 开始。我们发现了宏任务 Event Queue 中<code>setTimeout</code>对应的回调函数，立即执行。</li>
<li>结束。</li>
</ul>
<p>事件循环，宏任务，微任务的关系如图所示：</p>
<img src="/posts/37082/15fdcea13361a1ec.png" class="" title="15fdcea13361a1ec">

<p>我们来分析一段较复杂的代码，看看你是否真的掌握了 js 的执行机制：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">  process.nextTick(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;4&#x27;</span>);</span><br><span class="line">    resolve();</span><br><span class="line">  &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;5&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">process.nextTick(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;6&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;7&#x27;</span>);</span><br><span class="line">  resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;8&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;9&#x27;</span>);</span><br><span class="line">  process.nextTick(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;10&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;11&#x27;</span>);</span><br><span class="line">    resolve();</span><br><span class="line">  &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;12&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>第一轮事件循环流程分析如下：</p>
<ul>
<li>整体 script 作为第一个宏任务进入主线程，遇到<code>console.log</code>，输出 1。</li>
<li>遇到<code>setTimeout</code>，其回调函数被分发到宏任务 Event Queue 中。我们暂且记为<code>setTimeout1</code>。</li>
<li>遇到<code>process.nextTick()</code>，其回调函数被分发到微任务 Event Queue 中。我们记为<code>process1</code>。</li>
<li>遇到<code>Promise</code>，<code>new Promise</code>直接执行，输出 7。<code>then</code>被分发到微任务 Event Queue 中。我们记为<code>then1</code>。</li>
<li>又遇到了<code>setTimeout</code>，其回调函数被分发到宏任务 Event Queue 中，我们记为<code>setTimeout2</code>。</li>
</ul>
<table>
<thead>
<tr>
<th>宏任务 Event Queue</th>
<th>微任务 Event Queue</th>
</tr>
</thead>
<tbody><tr>
<td>setTimeout1</td>
<td>process1</td>
</tr>
<tr>
<td>setTimeout2</td>
<td>then1</td>
</tr>
</tbody></table>
<ul>
<li>上表是第一轮事件循环宏任务结束时各 Event Queue 的情况，此时已经输出了 1 和 7。</li>
<li>我们发现了<code>process1</code>和<code>then1</code>两个微任务。</li>
<li>执行<code>process1</code>,输出 6。</li>
<li>执行<code>then1</code>，输出 8。</li>
</ul>
<p>好了，第一轮事件循环正式结束，这一轮的结果是输出 1，7，6，8。那么第二轮时间循环从<code>setTimeout1</code>宏任务开始：</p>
<ul>
<li>首先输出 2。接下来遇到了<code>process.nextTick()</code>，同样将其分发到微任务 Event Queue 中，记为<code>process2</code>。<code>new Promise</code>立即执行输出 4，<code>then</code>也分发到微任务 Event Queue 中，记为<code>then2</code>。</li>
</ul>
<table>
<thead>
<tr>
<th>宏任务 Event Queue</th>
<th>微任务 Event Queue</th>
</tr>
</thead>
<tbody><tr>
<td>setTimeout2</td>
<td>process2</td>
</tr>
<tr>
<td></td>
<td>then2</td>
</tr>
</tbody></table>
<ul>
<li>第二轮事件循环宏任务结束，我们发现有<code>process2</code>和<code>then2</code>两个微任务可以执行。</li>
<li>输出 3。</li>
<li>输出 5。</li>
<li>第二轮事件循环结束，第二轮输出 2，4，3，5。</li>
<li>第三轮事件循环开始，此时只剩 setTimeout2 了，执行。</li>
<li>直接输出 9。</li>
<li>将<code>process.nextTick()</code>分发到微任务 Event Queue 中。记为<code>process3</code>。</li>
<li>直接执行<code>new Promise</code>，输出 11。</li>
<li>将<code>then</code>分发到微任务 Event Queue 中，记为<code>then3</code>。</li>
</ul>
<table>
<thead>
<tr>
<th>宏任务 Event Queue</th>
<th>微任务 Event Queue</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>process3</td>
</tr>
<tr>
<td></td>
<td>then3</td>
</tr>
</tbody></table>
<ul>
<li>第三轮事件循环宏任务执行结束，执行两个微任务<code>process3</code>和<code>then3</code>。</li>
<li>输出 10。</li>
<li>输出 12。</li>
<li>第三轮事件循环结束，第三轮输出 9，11，10，12。</li>
</ul>
<p>整段代码，共进行了三次事件循环，完整的输出为 1，7，6，8，2，4，3，5，9，11，10，12。 (请注意，node 环境下的事件监听依赖 libuv 与前端环境不完全相同，输出顺序可能会有误差)</p>
<h4 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h4><p>在 node 环境下，process.nextTick 的优先级高于 Promise；在宏任务结束后会先执行微任务队列中的 nextTickQueue 部分，然后才会执行微任务中的 Promise 部分。</p>
<blockquote>
<p>从技术上来讲 process.nextTick() 并不是 event loop 的一部分。实际上，不管 event loop 当前处于哪个阶段，nextTick 队列都是在<strong>当前阶段</strong>后就被执行了。<br>——&gt; <a href="https://juejin.cn/post/6844903582538399752#comment">https://juejin.cn/post/6844903582538399752#comment</a></p>
</blockquote>
<h3 id="6-写在最后"><a href="#6-写在最后" class="headerlink" title="6.写在最后"></a>6.写在最后</h3><h4 id="1-js-的异步"><a href="#1-js-的异步" class="headerlink" title="(1)js 的异步"></a>(1)js 的异步</h4><p>我们从最开头就说 javascript 是一门单线程语言，不管是什么新框架新语法糖实现的所谓异步，其实都是用同步的方法去模拟的，牢牢把握住单线程这点非常重要。</p>
<h4 id="2-事件循环-Event-Loop"><a href="#2-事件循环-Event-Loop" class="headerlink" title="(2)事件循环 Event Loop"></a>(2)事件循环 Event Loop</h4><p>事件循环是 js 实现异步的一种方法，也是 js 的执行机制。</p>
<h4 id="3-javascript-的执行和运行"><a href="#3-javascript-的执行和运行" class="headerlink" title="(3)javascript 的执行和运行"></a>(3)javascript 的执行和运行</h4><p>执行和运行有很大的区别，javascript 在不同的环境下，比如 node，浏览器，Ringo 等等，执行方式是不同的。而运行大多指 javascript 解析引擎，是统一的。</p>
<h4 id="4-setImmediate"><a href="#4-setImmediate" class="headerlink" title="(4)setImmediate"></a>(4)setImmediate</h4><p>微任务和宏任务还有很多种类，比如<code>setImmediate</code>等等，执行都是有共同点的，有兴趣的同学可以自行了解。</p>
<h4 id="5-最后的最后"><a href="#5-最后的最后" class="headerlink" title="(5)最后的最后"></a>(5)最后的最后</h4><ul>
<li>javascript 是一门单线程语言</li>
<li>Event Loop 是 javascript 的执行机制</li>
</ul>
<p>牢牢把握两个基本点，以认真学习 javascript 为中心，早日实现成为前端高手的伟大梦想！</p>
<h2 id="其他资源"><a href="#其他资源" class="headerlink" title="其他资源"></a>其他资源</h2><p><a href="https://mp.weixin.qq.com/s/Of8gGz-EYuOkVSLqV8W2ow">前端基础进阶（12）：深入核心，详解事件循环机制</a></p>
]]></content>
      <categories>
        <category>后端</category>
        <category>Node</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>EventLoop</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-高性能前端架构解决方案</title>
    <url>/posts/10518/</url>
    <content><![CDATA[<p>来源：<a href="https://mp.weixin.qq.com/s/C4izhX-vMnw_dpUZ1uDM0A">高性能前端架构解决方案</a></p>
<p>这篇文章介绍了一些使前端应用程序加载更快并提供良好用户体验的技术。</p>
<p>我们将研究前端的总体架构，如何首先加载必需的资源，并最大化资源缓存的概率。</p>
<p>无论你的页面是否需要成为客户端应用程序，还是如何优化应用程序的渲染时间，我都不会说太多后端如何传递资源。</p>
<a id="more"></a>

<h2 id="总览"><a href="#总览" class="headerlink" title="总览"></a>总览</h2><p>我将把应用程序加载分为三个不同的阶段：</p>
<ul>
<li>初始渲染 – 用户看到任何东西之前需要多长时间？</li>
<li>应用程序加载 – 用户可以使用该应用程序需要多长时间？</li>
<li>下一页 – 导航到下一页需要多长时间？</li>
</ul>
<img src="/posts/10518/640-20200322202223114.png" class="" title="640-20200322202223114">

<h2 id="初始渲染"><a href="#初始渲染" class="headerlink" title="初始渲染"></a>初始渲染</h2><p>在浏览器的初始渲染之前，用户看不到任何东西。渲染页面至少需要加载 <code>HTML</code> 文件，但是大多数时候需要加载其他资源，例如 <code>CSS</code> 和 <code>JavaScript</code> 文件。一旦这些都加载完毕，浏览器就可以开始在屏幕上渲染。</p>
<p>在本文中，我将使用 <code>WebPageTest</code> 瀑布图。你网站的请求瀑布可能看起来像这样。</p>
<img src="/posts/10518/640-20200322202223159.png" class="" title="640-20200322202223159">

<p><code>HTML</code> 文档将加载一堆其他文件，并在这些文件加载后渲染页面。请注意， <code>CSS</code> 文件是并行加载的，因此每个其他请求不会增加明显的延迟。</p>
<p>（备注：<code>gov.uk</code> 启用了 <code>HTTP/2</code>，因此资产域可以重新使用与 <code>www.gov.uk</code> 的现有连接！我将在下面详细讨论服务器连接。）</p>
<h3 id="减少渲染阻塞的请求"><a href="#减少渲染阻塞的请求" class="headerlink" title="减少渲染阻塞的请求"></a>减少渲染阻塞的请求</h3><p><code>css</code> 和（默认情况下） <code>script</code> 文件会阻止其下方的任何内容渲染。</p>
<p>你可以通过以下几种方法来解决此问题：</p>
<ul>
<li>将脚本标签放在 <code>body</code> 标签的底部</li>
<li>使用 <code>async</code> 异步加载 <code>script</code></li>
<li>内联使用小型的 <code>JS</code> 或 <code>CSS</code> 代码段（如果需要同步加载）</li>
</ul>
<h3 id="避免顺序渲染阻塞请求链"><a href="#避免顺序渲染阻塞请求链" class="headerlink" title="避免顺序渲染阻塞请求链"></a>避免顺序渲染阻塞请求链</h3><p>让你的网站变慢的不一定是阻止渲染的请求数量。更重要的是每种资源的下载大小，以及浏览器发现需要加载资源的时间。</p>
<p>如果浏览器仅在另一个请求完成后才发现需要加载文件，则可以获取同步请求链。发生这种情况可能有多种原因：</p>
<ul>
<li><code>CSS</code> 中的 <code>@import</code> 规则</li>
<li><code>CSS</code> 文件中引用的 <code>Webfonts</code></li>
<li><code>JavaScript</code> 注入链接或脚本标签</li>
</ul>
<p>看一下这个例子：</p>
<img src="/posts/10518/640-20200322202223158.png" class="" title="640-20200322202223158">

<p>这个网站在它的某个 <code>CSS</code> 文件中使用 <code>@import</code> 加载 <code>Google Fonts</code>。这意味着浏览器需要一个接一个地发出这些请求：</p>
<ul>
<li>文件 <code>HTML</code></li>
<li>应用程序的 <code>CSS</code></li>
<li><code>Google</code> 字体 <code>CSS</code></li>
<li><code>Google Font Woff</code>文件（在瀑布图中未显示）</li>
</ul>
<p>要解决这个问题，首先需要将 <code>Google Fonts</code> 的 <code>CSS</code> 请求从 <code>@import</code> 移动到 <code>HTML</code> 中的 <code>link</code> 标记，这就切断了请求链条上的一个环节。</p>
<p>为了进一步加快速度，建议直接在 <code>HTML</code> 或 <code>CSS</code> 文件中内联 <code>Google Fonts CSS</code> 文件。</p>
<p>(记住，来自 <code>Google Fonts</code> 的 <code>CSS</code> 响应取决于用户代理。如果你用 <code>IE8</code> 发出请求，CSS 会引用一个 <code>EOT</code> 文件，<code>IE11</code> 会得到一个 <code>woff</code> 文件，而现在的浏览器会得到一个 <code>woff2</code> 文件。但是如果你不介意旧的浏览器使用系统字体，那么你可以复制粘贴 <code>CSS</code> 文件的内容。)</p>
<p>即使页面开始呈现后，用户仍可能无法对该页面执行任何操作，因为在加载字体之前，不会显示任何文本。可以通过 <code>font-display swap</code> 来避免这种情况，现在 <code>Google Fonts</code> 默认情况下已经开始支持。</p>
<p>有时，消除请求链是不可行的。在这些情况下，可以考虑使用 <code>preload</code> 或 <code>preconnect</code> 标记。例如，在实际的 <code>CSS</code> 请求发出之前，上面的网站可以连接到 <code>fonts.googleapis.com</code>。</p>
<h3 id="重复使用服务器连接以加快请求"><a href="#重复使用服务器连接以加快请求" class="headerlink" title="重复使用服务器连接以加快请求"></a>重复使用服务器连接以加快请求</h3><p>建立新的服务器连接通常需要在服务器的浏览器之间进行 3 次往返：</p>
<ul>
<li><code>DNS</code> 查询</li>
<li>建立 <code>TCP</code> 连接</li>
<li>建立 <code>SSL</code> 连接</li>
</ul>
<p>连接就绪后，至少需要再进行一次往返来发送请求并下载响应。</p>
<p>下面的瀑布显示连接已启动到四个不同的服务器：<code>hostgator.com，optimize.com，googletagmanager.com 和 googelapis.com</code>。</p>
<p>但是，对同一服务器的后续请求可以重新使用现有连接。因此，加载 <code>base.css</code>或 <code>index1.css</code> 的速度很快，因为它们也托管在 <code>hostgator.com</code> 上。</p>
<img src="/posts/10518/640-20200322202223164.png" class="" title="640-20200322202223164">

<h3 id="减小文件大小并使用-CDN"><a href="#减小文件大小并使用-CDN" class="headerlink" title="减小文件大小并使用 CDN"></a>减小文件大小并使用 CDN</h3><p>除了文件大小之外，还有两个其他因素会影响请求时间，这些因素都在你的控制范围内：资源大小和服务器位置。</p>
<p>向用户发送尽可能少的数据，并确保将其压缩（例如，使用 <code>brotli</code> 或 <code>gzip</code> ）。</p>
<p>内容交付网络在大量位置提供服务器，因此其中之一可能位于你的用户附近。用户可以连接到与其附近的 <code>CDN</code> 服务器，而不必连接到中央应用程序服务器。这意味着服务器的往返时间将大大缩短。这对于诸如 <code>CSS</code>，<code>JavaScript</code>和 <code>Image</code> 之类的静态资产特别方便，因为它们易于分发。</p>
<h3 id="使用-service-workers-跳过网络"><a href="#使用-service-workers-跳过网络" class="headerlink" title="使用 service workers 跳过网络"></a>使用 service workers 跳过网络</h3><p><code>service workers</code> 允许你在请求进入网络之前拦截它们。这意味着你可以实现瞬时首屏渲染!</p>
<p>当然，这只在你不需要网络发送响应时才有效。你需要已经缓存了响应，所以用户只有在第二次加载你的应用时才会受益。</p>
<p>下面的 <code>service workers</code> 缓存呈现页面所需的 HTML 和 CSS。当再次加载应用程序时，它会尝试为缓存的资源提供服务，如果资源不可用，则会返回到网络。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">self.addEventListener(<span class="string">&#x27;install&#x27;</span>, <span class="keyword">async</span> e =&gt; &#123;</span><br><span class="line">  caches.open(<span class="string">&#x27;v1&#x27;</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">cache</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> cache.addAll([<span class="string">&#x27;/app&#x27;</span>, <span class="string">&#x27;/app.css&#x27;</span>]);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">self.addEventListener(<span class="string">&#x27;fetch&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  event.respondWith(</span><br><span class="line">    caches.match(event.request).then(<span class="function"><span class="params">cachedResponse</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> cachedResponse || fetch(event.request);</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="应用加载"><a href="#应用加载" class="headerlink" title="应用加载"></a>应用加载</h2><p>好的，现在用户已经可以看到一些东西，然后他们在可以使用你的应用程序之前还需要什么？</p>
<ul>
<li>加载应用程序代码（JS 和 CSS）</li>
<li>加载页面的基本数据</li>
<li>加载其他数据和图像</li>
</ul>
<img src="/posts/10518/640-20200322202223220.png" class="" title="640-20200322202223220">

<p>请注意，不仅仅是延迟从网络加载数据会延迟渲染。加载代码后，浏览器将需要解析，编译和执行它。</p>
<h3 id="Bundle-split：仅加载必要的代码，并最大化缓存命中率"><a href="#Bundle-split：仅加载必要的代码，并最大化缓存命中率" class="headerlink" title="Bundle split：仅加载必要的代码，并最大化缓存命中率"></a>Bundle split：仅加载必要的代码，并最大化缓存命中率</h3><p><code>Bundle split</code> 允许只加载当前页面所需的代码，而不是加载整个应用程序。<code>Bundle split</code> 还意味着可以缓存其中的一部分，即使其他部分已经更改，需要重新加载。</p>
<p>通常，代码被分成三种不同类型的文件:</p>
<ul>
<li>网页本身专用代码</li>
<li>共享应用程序代码</li>
<li>很少更改的第三方模块（非常适合缓存！）</li>
</ul>
<p><code>Webpack</code> 可以使用 <code>optimization.splitChunks</code> 自动拆分共享代码以减少总下载量。确保启用运行时块，以使 <code>chunk</code> 哈希稳定，并从长期缓存中受益。</p>
<p>分离页面特定的代码不能自动完成，你需要识别可以单独加载的位。通常这是一个特定的路径或一组页面。使用动态导入来延迟加载代码。</p>
<p><code>Bundle split</code> 会导致更多的请求被发送来加载你的应用程序。但是只要请求是并行发送的，这就不是什么大问题，特别是当你的站点开启了 <code>HTTP/2</code> 服务的时候。你可以看到在这个瀑布的前三个请求:</p>
<img src="/posts/10518/640-20200322202223167.png" class="" title="640-20200322202223167">

<p>然而，这个瀑布图还显示了两个按顺序发出的请求。这些块只在这个页面中需要，并通过 <code>import()</code> 调用动态加载。</p>
<p>如果你知道需要这些块，你可以通过插入预加载链接标记来解决这个问题。</p>
<img src="/posts/10518/640-20200322203628249.png" class="" title="640-20200322203628249">

<p>但是，你会看到，与总页面加载时间相比，这样做的好处可能很小。</p>
<p>另外，使用预加载有时会适得其反，因为加载其他更重要的文件时可能会延迟。</p>
<h3 id="加载页面数据"><a href="#加载页面数据" class="headerlink" title="加载页面数据"></a>加载页面数据</h3><p>你的应用程序可能是用来显示一些数据的。下面是一些提示，你可以使用这些提示尽早加载数据并避免呈现延迟。</p>
<h4 id="在开始加载数据之前不要等待包"><a href="#在开始加载数据之前不要等待包" class="headerlink" title="在开始加载数据之前不要等待包"></a>在开始加载数据之前不要等待包</h4><p>这是一个顺序请求链的特殊情况:你加载应用程序包，然后代码请求页面数据。</p>
<p>有两种方法可以避免这种情况：</p>
<ul>
<li>将页面数据嵌入 HTML 文档中</li>
<li>通过文档中的内联脚本启动数据请求</li>
</ul>
<p>将数据嵌入 HTML 可以确保你的应用程序不必等待数据加载。这也降低了应用程序的复杂性，因为你不必处理加载状态。</p>
<p>但是，如果获取数据会大大延迟你的文档响应，那将不是一个好主意，因为这会延迟你的初始渲染。</p>
<p>在这种情况下，或者如果你通过服务工作者提供缓存的 HTML 文档，则可以将内联脚本嵌入到 HTML 中以加载此数据。你可以将其作为全局 <code>promise</code> 提供，如下所示：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.userDataPromise = fetch(<span class="string">&#x27;/me&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>然后，如果数据准备就绪，你的应用程序可以立即开始渲染，或者等到准备就绪。</p>
<p>对于这两种技术，你都需要知道在应用开始呈现之前页面必须加载哪些数据。对于与用户相关的数据（用户名，通知 …），这往往很容易，但是对于特定于页面的内容，则比较棘手。考虑确定最重要的页面并为这些页面编写自定义逻辑。</p>
<h4 id="等待非必需数据时不要阻塞渲染"><a href="#等待非必需数据时不要阻塞渲染" class="headerlink" title="等待非必需数据时不要阻塞渲染"></a>等待非必需数据时不要阻塞渲染</h4><p>有时生成页面数据需要缓慢的复杂后端逻辑。在这些情况下，如果足以使你的应用程序具有功能性和交互性，则可以首先加载较简单的数据版本。</p>
<p>例如，分析工具可以在加载图表数据之前首先加载所有图表的列表。这使用户可以立即查找他们感兴趣的图表，还可以帮助将后端请求分散到不同的服务器上。</p>
<img src="/posts/10518/640-20200322202223217.png" class="" title="640-20200322202223217">

<h4 id="避免顺序数据请求链"><a href="#避免顺序数据请求链" class="headerlink" title="避免顺序数据请求链"></a>避免顺序数据请求链</h4><p>这可能与我先前关于在第二个请求中加载非必需数据的观点相冲突，但是如果每个完成的请求都不会导致向用户显示更多信息，则避免顺序请求链。</p>
<p>与其先发出关于用户登录身份的请求，然后再请求其所属团队的列表，不如在用户信息旁边返回团队列表。你可以使用 <code>GraphQL</code> ，但自定义用户呢? <code>includeTeams=true endpoint</code> 也很有用。</p>
<p>与其首先请求用户登录为谁，然后请求他们所属的团队列表，</p>
<h3 id="服务端端渲染"><a href="#服务端端渲染" class="headerlink" title="服务端端渲染"></a>服务端端渲染</h3><p>服务端端渲染意味着在服务器上预渲染你的应用程序，并使用整页 HTML 响应文档请求。这意味着客户端可以看到完全呈现的页面，而不必等待加载其他代码或数据！</p>
<p>由于服务器只是将静态 HTML 发送给客户端，因此你的应用尚无法进行交互。需要加载应用程序，它需要重新运行呈现逻辑，然后将必要的事件侦听器附加到 DOM。</p>
<p>如果看到非交互式内容很有价值，请使用服务器呈现。如果你能够将呈现的 HTML 缓存在服务器上并将其提供给所有用户而又不会延迟初始文档请求，那么它也将有所帮助。例如，如果你使用 <code>React</code> 来渲染博客文章，则服务器渲染非常合适。</p>
<h2 id="下一页"><a href="#下一页" class="headerlink" title="下一页"></a>下一页</h2><p>在某个时候，用户将与你的应用进行交互并转到下一页。打开初始页面后，你可以控制浏览器中发生的事情，因此你可以准备进行下一次交互。</p>
<h3 id="预取资源"><a href="#预取资源" class="headerlink" title="预取资源"></a>预取资源</h3><p>如果你预加载了下一页所需的代码，则可以消除用户启动导航时的延迟。使用 <code>prefetch</code> 标记，或 <code>webpackPrefetch</code> 用于动态导入：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackPrefetch: true, webpackChunkName: &quot;todo-list&quot; */</span> <span class="string">&#x27;./TodoList&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>注意你使用了多少用户数据和带宽，特别是当他们使用移动连接时。如果他们使用的是你网站的移动版本，或者他们启用了保存数据模式，你可以减少预加载。</p>
<p>对于用户最可能需要的应用程序部分，要有策略。</p>
<h3 id="重用已经加载的数据"><a href="#重用已经加载的数据" class="headerlink" title="重用已经加载的数据"></a>重用已经加载的数据</h3><p>在应用程序中本地缓存 <code>Ajax</code> 数据，并使用它来避免未来的请求。如果用户从团队列表导航到“编辑团队”页面，你可以通过重用已经获取的数据来立即进行转换。</p>
<p>请注意，如果你的实体经常被其他用户编辑，并且你下载的数据可能已经过期，那么这种方法将不起作用。在这些情况下，在获取最新数据时，请首先考虑以只读方式显示现有数据。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>本文介绍了许多因素，这些因素可能会在加载过程的不同时刻使你的页面速度减慢。使用 <code>Chrome DevTools</code>，<code>WebPageTest</code>和<code>Lighthouse</code>之类的工具来确定其中哪些适用于你的应用程序。</p>
<p>实际上，你几乎不可能在所有方面进行优化。找出对用户有最大影响的因素，并专注于此。</p>
<p>我在写这篇文章时意识到的一件事是，我根深蒂固地相信，发出许多单独的请求对性能不利。过去，当每个请求都需要一个单独的连接时，Thas 就是这样，而浏览器每个域只允许几个连接。但是，使用 <code>HTTP/2</code> 和现代浏览器已不再是这种情况。</p>
<p>并且有强烈的理由支持拆分请求。它允许仅加载必要的资源，并可以更好地利用缓存的内容，因为仅需要重新加载已更改的文件。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>性能优化</category>
      </categories>
      <tags>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>配置EditorConfig</title>
    <url>/posts/30080/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>EditorConfig 有助于 <code>一个项目</code> 且 <code>多个开发者</code> 所用编辑器各不相同的团队维护编码风格。</p>
<h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h2><p><a href="https://editorconfig.org/">https://editorconfig.org/</a></p>
<h3 id="不需要下载插件的编辑器"><a href="#不需要下载插件的编辑器" class="headerlink" title="不需要下载插件的编辑器"></a>不需要下载插件的编辑器</h3><p><a href="https://editorconfig.org/#pre-installed">https://editorconfig.org/#pre-installed</a></p>
<h3 id="需要下载插件的编辑器"><a href="#需要下载插件的编辑器" class="headerlink" title="需要下载插件的编辑器"></a>需要下载插件的编辑器</h3><p><a href="https://editorconfig.org/#download">https://editorconfig.org/#download</a></p>
<a id="more"></a>

<blockquote>
<p>提示：</p>
<p>点击图标就能跳转到对应编辑器的插件安装地址</p>
</blockquote>
<p>另外，VSCode 插件下载地址为<a href="https://marketplace.visualstudio.com/items?itemName=EditorConfig.EditorConfig">EditorConfig for VS Code</a>。在 VSCode 中，创建好文件和安装好插件后，需要重启编辑器，但是此时只是修改编辑器的编辑设置，并不会将你已经存在的代码进行规范，可以通过快捷键格式化：<code>shift + alt + F</code></p>
<h2 id="editorconfig-文件示例"><a href="#editorconfig-文件示例" class="headerlink" title=".editorconfig 文件示例"></a>.editorconfig 文件示例</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> EditorConfig is awesome: https://EditorConfig.org</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> top-most EditorConfig file 表示是最顶层的配置文件，发现设为<span class="literal">true</span>时，才会停止查找.editorconfig文件</span></span><br><span class="line">root = true</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Unix-style newlines with a newline ending every file 对于所有的文件  始终在文件末尾插入一个新行</span></span><br><span class="line">[*]</span><br><span class="line">end_of_line = lf</span><br><span class="line">insert_final_newline = true</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Matches multiple files with brace expansion notation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set default charset  对于所有的js,py文件，设置文件字符集为utf-8</span></span><br><span class="line">[*.&#123;js,py&#125;]</span><br><span class="line">charset = utf-8</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4 space indentation 控制py文件类型的缩进大小</span></span><br><span class="line">[*.py]</span><br><span class="line">indent_style = space</span><br><span class="line">indent_size = 4</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Tab indentation (no size specified) 设置某中文件的缩进风格为tab Makefile未指明</span></span><br><span class="line">[Makefile]</span><br><span class="line">indent_style = tab</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Indentation override <span class="keyword">for</span> all JS under lib directory  设置在lib目录下所有JS的缩进为</span></span><br><span class="line">[lib/**.js]</span><br><span class="line">indent_style = space</span><br><span class="line">indent_size = 2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Matches the exact files either package.json or .travis.yml 设置确切文件 package.json/.travis/.yml的缩进类型</span></span><br><span class="line">[&#123;package.json,.travis.yml&#125;]</span><br><span class="line">indent_style = space</span><br><span class="line">indent_size = 2</span><br></pre></td></tr></table></figure>

<h2 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">*                匹配除/之外的任意字符串</span><br><span class="line">**               匹配任意字符串</span><br><span class="line">?                匹配任意单个字符</span><br><span class="line">[name]           匹配name中的任意一个单一字符</span><br><span class="line">[!name]          匹配不存在name中的任意一个单一字符</span><br><span class="line">&#123;s1,s2,s3&#125;       匹配给定的字符串中的任意一个(用逗号分隔)</span><br><span class="line">&#123;num1..num2&#125;    匹配num1到num2之间的任意一个整数, 这里的num1和num2可以为正整数也可以为负整数</span><br></pre></td></tr></table></figure>

<h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">indent_style    设置缩进风格(tab是硬缩进，space为软缩进)</span><br><span class="line">indent_size     用一个整数定义的列数来设置缩进的宽度，如果indent_style为tab，则此属性默认为tab_width</span><br><span class="line">tab_width       用一个整数来设置tab缩进的列数。默认是indent_size</span><br><span class="line">end_of_line     设置换行符，值为lf、cr和crlf</span><br><span class="line">charset         设置编码，值为latin1、utf-8、utf-8-bom、utf-16be和utf-16le，不建议使用utf-8-bom</span><br><span class="line">trim_trailing_whitespace  设为true表示会去除换行行首的任意空白字符。</span><br><span class="line">insert_final_newline      设为true表示使文件以一个空白行结尾</span><br><span class="line">root           表示是最顶层的配置文件，发现设为true时，才会停止查找.editorconfig文件</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://mp.weixin.qq.com/s/_Xu2GlgDJm-dgzjcXQlC4w">一套非常标准的前端代码工作流</a></li>
</ul>
]]></content>
      <categories>
        <category>工具</category>
        <category>IDE</category>
      </categories>
      <tags>
        <tag>工具</tag>
        <tag>EditorConfig</tag>
      </tags>
  </entry>
  <entry>
    <title>阻止安卓物理返回键事件</title>
    <url>/posts/32404/</url>
    <content><![CDATA[<h2 id="uni-app-app-非-h5-嵌套-app"><a href="#uni-app-app-非-h5-嵌套-app" class="headerlink" title="uni-app app(非 h5 嵌套 app)"></a>uni-app app(非 h5 嵌套 app)</h2><p><strong>生命周期函数：onBackPress</strong></p>
<p><a href="https://ask.dcloud.net.cn/article/35120">https://ask.dcloud.net.cn/article/35120</a></p>
<p>注意：<strong>H5 平台，顶部导航栏返回按钮支持 <code>onBackPress()</code>，浏览器默认返回按键及 Android 手机实体返回键不支持 <code>onBackPress()</code></strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">onBackPress</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="H5-浏览器端"><a href="#H5-浏览器端" class="headerlink" title="H5 浏览器端"></a>H5 浏览器端</h2><p><strong>利用 Web api: popstate</strong></p>
<p><a href="https://www.cnblogs.com/linx/p/7018697.html">https://www.cnblogs.com/linx/p/7018697.html</a></p>
<p>仅能阻止一次，按两次或多次依然返回</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">history.pushState(<span class="literal">null</span>, <span class="literal">null</span>, <span class="built_in">window</span>.location.href);</span><br><span class="line"><span class="built_in">window</span>.onpopstate = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  history.go(<span class="number">1</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="uni-app-h5-嵌套-app-用于单页应用退出登陆-点击实体按钮返回会返回之前页面闪一下又跳转回登录页"><a href="#uni-app-h5-嵌套-app-用于单页应用退出登陆-点击实体按钮返回会返回之前页面闪一下又跳转回登录页" class="headerlink" title="uni-app h5 嵌套 app(用于单页应用退出登陆,点击实体按钮返回会返回之前页面闪一下又跳转回登录页)"></a>uni-app h5 嵌套 app(用于单页应用退出登陆,点击实体按钮返回会返回之前页面闪一下又跳转回登录页)</h2><p>（销毁掉之前的浏览记录页面 ）更改退出登录跳转方式为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">uni.reLaunch(&#123;</span><br><span class="line">  url: <span class="string">&#x27;/pages/homePageSub/login/login&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>移动端</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS布局面试题（面试系列）</title>
    <url>/posts/51111/</url>
    <content><![CDATA[<h2 id="如何居中-div？"><a href="#如何居中-div？" class="headerlink" title="如何居中 div？"></a>如何居中 div？</h2><h3 id="行内元素水平居中"><a href="#行内元素水平居中" class="headerlink" title="行内元素水平居中"></a>行内元素水平居中</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#container</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="单个-div（块级元素）水平居中"><a href="#单个-div（块级元素）水平居中" class="headerlink" title="单个 div（块级元素）水平居中"></a>单个 div（块级元素）水平居中</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="多个-div-水平居中"><a href="#多个-div-水平居中" class="headerlink" title="多个 div 水平居中"></a>多个 div 水平居中</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 传统方案 */</span></span><br><span class="line"><span class="selector-id">#container</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* flex 布局方案 */</span></span><br><span class="line"><span class="selector-id">#container</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="绝对定位的-div-居中（已知宽高）"><a href="#绝对定位的-div-居中（已知宽高）" class="headerlink" title="绝对定位的 div 居中（已知宽高）"></a>绝对定位的 div 居中（已知宽高）</h3><h4 id="子绝父相-margin"><a href="#子绝父相-margin" class="headerlink" title="子绝父相 + margin"></a>子绝父相 + margin</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: auto; <span class="comment">/* 0 auto 水平居中；auto 水平垂直居中 */</span></span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: pink; <span class="comment">/* 方便看效果 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="子绝父相-负边距"><a href="#子绝父相-负边距" class="headerlink" title="子绝父相 + 负边距"></a>子绝父相 + 负边距</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: -<span class="number">150px</span> <span class="number">0</span> <span class="number">0</span> -<span class="number">250px</span>; <span class="comment">/* 外边距为自身宽高的一半 */</span></span><br><span class="line">  <span class="attribute">background-color</span>: pink; <span class="comment">/* 方便看效果 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="当被居中的元素是-inline-or-inline-block-元素"><a href="#当被居中的元素是-inline-or-inline-block-元素" class="headerlink" title="当被居中的元素是 inline or inline-block 元素"></a>当被居中的元素是 inline or inline-block 元素</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="任意元素（未知宽高）"><a href="#任意元素（未知宽高）" class="headerlink" title="任意元素（未知宽高）"></a>任意元素（未知宽高）</h3><h4 id="子绝父相-translate"><a href="#子绝父相-translate" class="headerlink" title="子绝父相 + translate"></a>子绝父相 + translate</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#container</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 利用transform */</span></span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="flex（需考虑兼容性）"><a href="#flex（需考虑兼容性）" class="headerlink" title="flex（需考虑兼容性）"></a>flex（需考虑兼容性）</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-flex; <span class="comment">/* Safari仍旧需要使用特定的浏览器前缀 */</span></span><br><span class="line">  <span class="attribute">align-items</span>: center; <span class="comment">/* 垂直居中 */</span></span><br><span class="line">  <span class="attribute">justify-content</span>: center; <span class="comment">/* 水平居中 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: pink; <span class="comment">/* 方便看效果 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="用纯-CSS-创建一个三角形的原理是什么？"><a href="#用纯-CSS-创建一个三角形的原理是什么？" class="headerlink" title="用纯 CSS 创建一个三角形的原理是什么？"></a>用纯 CSS 创建一个三角形的原理是什么？</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 把上、左、右三条边隐藏掉（颜色设为 transparent）*/</span></span><br><span class="line"><span class="selector-id">#demo</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">border-style</span>: solid;</span><br><span class="line">  <span class="attribute">border-color</span>: transparent transparent red transparent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="css-多列等高如何实现？"><a href="#css-多列等高如何实现？" class="headerlink" title="css 多列等高如何实现？"></a>css 多列等高如何实现？</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>利用 <code>padding-bottom|margin-bottom</code> 正负值相抵；</p>
<p>设置父容器设置超出隐藏（overflow:hidden），这样子父容器的高度就还是它里面的列没有设定 padding-bottom 时的高度， 当它里面的任一列高度增加了，则父容器的高度被撑到里面最高那列的高度， 其他比这列矮的列则会用它们的 padding-bottom 来补偿这部分高度差。</p>
<p>因为背景是可以用在 padding 占用的空间里的，而且边框也是跟随 padding 变化的，所以就成功的完成了一个障眼法。</p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;Article&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;js-equalheight&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      一家将客户利益置于首位的经纪商，</span><br><span class="line">      为客户提供专业的交易工具一家将客户利益置于首位的经纪商</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;js-equalheight&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>一家将客户利益置于首位的经纪商，为客户提供专业的交易工具<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;js-equalheight&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>一家将客户利益置于首位的经纪商<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.Article</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.Article</span> &gt; <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">10px</span> -<span class="number">9999px</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">9999px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#4577dc</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.Article</span> &gt; <span class="selector-tag">li</span> &gt; <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="css-div-垂直水平居中，并完成-div-高度永远是宽度的一半（宽度可以不指定）"><a href="#css-div-垂直水平居中，并完成-div-高度永远是宽度的一半（宽度可以不指定）" class="headerlink" title="css div 垂直水平居中，并完成 div 高度永远是宽度的一半（宽度可以不指定）"></a>css div 垂直水平居中，并完成 div 高度永远是宽度的一半（宽度可以不指定）</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      * &#123;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      html,</span><br><span class="line">      body &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        height: 100%;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.outer</span> &#123;</span></span><br><span class="line">        width: 400px;</span><br><span class="line">        height: 100%;</span><br><span class="line">        background: blue;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line"></span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.inner</span> &#123;</span></span><br><span class="line">        position: relative;</span><br><span class="line">        width: 100%;</span><br><span class="line">        height: 0;</span><br><span class="line">        padding-bottom: 50%;</span><br><span class="line">        background: red;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.box</span> &#123;</span></span><br><span class="line">        position: absolute;</span><br><span class="line">        width: 100%;</span><br><span class="line">        height: 100%;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        align-items: center;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;outer&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inner&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<iframe height="486" style="width: 100%;" scrolling="no" title="高度是宽度一半" src="https://codepen.io/JingW/embed/oNYJovB?height=486&theme-id=light&default-tab=html,result" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/JingW/pen/oNYJovB'>高度是宽度一半</a> by JingW
  (<a href='https://codepen.io/JingW'>@JingW</a>) on <a href='https://codepen.io'>CodePen</a>.
</iframe>

<p>来源：<a href="https://github.com/cttin/cttin.github.io/issues/2">https://github.com/cttin/cttin.github.io/issues/2</a></p>
<h2 id="有一个高度自适应的-div-，里面有两个-div-，一个高度-100px-，希望另一个填满剩下的高度。"><a href="#有一个高度自适应的-div-，里面有两个-div-，一个高度-100px-，希望另一个填满剩下的高度。" class="headerlink" title="有一个高度自适应的 div ，里面有两个 div ，一个高度 100px ，希望另一个填满剩下的高度。"></a>有一个高度自适应的 div ，里面有两个 div ，一个高度 100px ，希望另一个填满剩下的高度。</h2><blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;outer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;A&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;B&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<h3 id="方案-1"><a href="#方案-1" class="headerlink" title="方案 1"></a>方案 1</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.A</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.B</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: blue;</span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">calc</span>(<span class="number">100vh</span> - <span class="number">100px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方案-2"><a href="#方案-2" class="headerlink" title="方案 2"></a>方案 2</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  利用border-box将padding包含在高度内；</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-class">.outer</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">100px</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  用负margin值将A子容器顶到页面顶部</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-class">.A</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: -<span class="number">100px</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#bbe8f2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  剩下的高度100%-100px就是B容器所谓的100%高了</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-class">.B</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#d9c666</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方案-3"><a href="#方案-3" class="headerlink" title="方案 3"></a>方案 3</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.outer</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">100px</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  绝对定</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-class">.A</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#bbe8f2</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.B</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#d9c666</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方案-4"><a href="#方案-4" class="headerlink" title="方案 4"></a>方案 4</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.outer</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.A</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#bbe8f2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.B</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#d9c666</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方案-5"><a href="#方案-5" class="headerlink" title="方案 5"></a>方案 5</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.outer</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="attribute">background</span>: red;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">-webkit-flex-direction</span>: row;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.A</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.B</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: blue;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="rem-布局知道吗？原理是什么？"><a href="#rem-布局知道吗？原理是什么？" class="headerlink" title="rem 布局知道吗？原理是什么？"></a>rem 布局知道吗？原理是什么？</h2><p>rem 是个相对单位，相对的是 html 根元素的 font-size 大小。这样一来我们就可以通过 html 上的字体大小来控制页面上所有以 rem 为单位的元素尺寸。</p>
<p><strong>示例代码</strong></p>
<p>例如在 vue 项目的 index.html 页中动态计算根元素字体大小</p>
<blockquote>
<p>index.html</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    &lt;meta</span><br><span class="line">      name=&quot;viewport&quot;</span><br><span class="line">      content=&quot;width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span>...<span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      (<span class="function"><span class="keyword">function</span> (<span class="params">doc, win</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> docEl = doc.documentElement;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> resizeEvt =</span></span><br><span class="line"><span class="javascript">          <span class="string">&#x27;orientationchange&#x27;</span> <span class="keyword">in</span> <span class="built_in">window</span> ? <span class="string">&#x27;orientationchange&#x27;</span> : <span class="string">&#x27;resize&#x27;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> recalc = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> clientWidth = docEl.clientWidth;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 把屏幕宽度划分成10份，那么每一份的宽度就等于1rem</span></span></span><br><span class="line"><span class="javascript">          docEl.style.fontSize = clientWidth / <span class="number">10</span> + <span class="string">&#x27;px&#x27;</span>;</span></span><br><span class="line">        &#125;;</span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (!doc.addEventListener) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">        win.addEventListener(resizeEvt, recalc, <span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">        doc.addEventListener(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, recalc, <span class="literal">false</span>);</span></span><br><span class="line">        recalc();</span><br><span class="line"><span class="javascript">      &#125;)(<span class="built_in">document</span>, <span class="built_in">window</span>);</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后利用 css 预处理器定义一个 mixin 函数（下方用的 stylus），用来将设计稿上的 px 转为对应的 rem 值</p>
<p>计算公式为：</p>
<p>页面元素的 rem 值 = 设计稿元素值（px）/（屏幕宽度 / 划分的份数）</p>
<blockquote>
<p>mixin.stylus</p>
</blockquote>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 把px转为rem */</span></span><br><span class="line"><span class="selector-tag">px2rem</span>(<span class="selector-tag">designpx</span>)</span><br><span class="line">  $rem = 750 / 10;</span><br><span class="line">  return (designpx / $rem)rem</span><br></pre></td></tr></table></figure>

<p>最后在 css 中使用</p>
<blockquote>
<p>某 vue 组件的 style 标签中</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 375设计稿上100%宽以及50高的导航条（iPhone6的dpr为2，所以px值得都乘以2） */</span></span><br><span class="line"><span class="selector-tag">header</span></span><br><span class="line">  <span class="selector-tag">width</span> <span class="selector-tag">px2rem</span>(750)</span><br><span class="line">  <span class="selector-tag">height</span> <span class="selector-tag">px2rem</span>(100)</span><br></pre></td></tr></table></figure>

<h3 id="rem-布局的优缺点"><a href="#rem-布局的优缺点" class="headerlink" title="rem 布局的优缺点"></a>rem 布局的优缺点</h3><p>优点：</p>
<p>能维持能整体的布局效果，移动端兼容性好，不用写多个 css 代码，而且还可以利用@media 进行优化。</p>
<p>缺点：</p>
<p>开头要引入一段 js 代码，单位都要改成 rem（ font-size 可以用 px ），计算 rem 比较麻烦(可以引用预处理器，但是增加了编译过程，相对麻烦了点)。PC 和 Mobile 要分开。</p>
<p>参考：</p>
<ul>
<li><a href="https://www.cnblogs.com/qieguo/p/5386565.html">用 rem 实现 WebApp 自适应的优劣分析</a></li>
<li>[CSS3 的字体大小单位<a href="https://www.zhihu.com/question/21504656">rem]到底好在哪？</a></li>
<li><a href="https://segmentfault.com/a/1190000010211016">总结个人使用过的移动端布局方法</a></li>
</ul>
<h2 id="慎用-em-的原因"><a href="#慎用-em-的原因" class="headerlink" title="慎用 em 的原因"></a>慎用 em 的原因</h2><p><strong>em 会叠加计算。</strong>在这个机制下太容易犯错了，因为你不知道这段<code>css</code>指定的字号具体是多少。</p>
<blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">  abc</span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>def<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  abc</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.5em</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际效果：</p>
<img src="/posts/51111/1549344767634-006a0ce5-2c0c-4087-97c3-c8e77933009d.png" class="" title="abc">

<p>先要搞清楚 <code>em</code> 的计算原理，它是根据<strong>当前元素的字号</strong>按比例计算的。</p>
<p>外层 <code>span</code> 的字号是 <code>16px</code>（浏览器默认值），所以 <code>1.5em</code> 之后是 <code>24px</code> 。由于字号是继承的，导致内层 <code>span</code> 的字号继承过来是 <code>24px</code> ，再经过 <code>1.5em</code> 之后就成了 <code>36px</code> 。</p>
<p>所以，就算要用 <code>em</code> 的话，尽量不要用在继承属性（<code>font-size</code>）上，除非你真的清楚你在做什么！</p>
<h2 id="两列布局（左列定宽，右列自适应）"><a href="#两列布局（左列定宽，右列自适应）" class="headerlink" title="两列布局（左列定宽，右列自适应）"></a>两列布局（左列定宽，右列自适应）</h2><blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;left&quot;</span>&gt;</span>左列定宽<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;right&quot;</span>&gt;</span>右列自适应<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-利用-float-margin"><a href="#1-利用-float-margin" class="headerlink" title="1. 利用 float + margin"></a>1. 利用 float + margin</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f00</span>;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#0f0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">100px</span>; <span class="comment">/*设置间隔，大于等于#left的宽度*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">原理：<span class="selector-id">#left</span>左浮动，脱离文档流，<span class="selector-id">#right</span>为了不被<span class="selector-id">#left</span>挡住，</span><br><span class="line">设置<span class="selector-tag">margin-left</span>大于等于<span class="selector-id">#left</span>的宽度达到视觉上的两栏布局</span><br></pre></td></tr></table></figure>

<h3 id="2-使用-float-overflow（触发-bfc）"><a href="#2-使用-float-overflow（触发-bfc）" class="headerlink" title="2. 使用 float + overflow（触发 bfc）"></a>2. 使用 float + overflow（触发 bfc）</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f00</span>;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#0f0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden; <span class="comment">/*触发bfc达到自适应*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">原理：<span class="selector-id">#left</span>左浮动，<span class="selector-id">#right</span>触发<span class="selector-tag">bfc</span>达到自适应</span><br></pre></td></tr></table></figure>

<h3 id="3-使用-table-实现"><a href="#3-使用-table-实现" class="headerlink" title="3. 使用 table 实现"></a>3. 使用 table 实现</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: table;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f00</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#0f0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*利用单元格自动分配宽度*/</span></span><br><span class="line"><span class="selector-id">#left</span>,</span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-使用-position-实现"><a href="#4-使用-position-实现" class="headerlink" title="4. 使用 position 实现"></a>4. 使用 position 实现</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125; <span class="comment">/*父相*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute; <span class="comment">/*子绝*/</span></span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f00</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute; <span class="comment">/*子绝*/</span></span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">100px</span>; <span class="comment">/*值大于等于#left的宽度*/</span></span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#0f0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-使用-flex-实现"><a href="#5-使用-flex-实现" class="headerlink" title="5. 使用 flex 实现"></a>5. 使用 flex 实现</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f00</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>; <span class="comment">/*均分了父元素剩余空间*/</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#0f0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="两列布局（一列不定宽，一列自适应）"><a href="#两列布局（一列不定宽，一列自适应）" class="headerlink" title="两列布局（一列不定宽，一列自适应）"></a>两列布局（一列不定宽，一列自适应）</h2><h3 id="1-float-overflow"><a href="#1-float-overflow" class="headerlink" title="1. float + overflow"></a>1. float + overflow</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">float</span>: left;  <span class="comment">/*只设置浮动,不设宽度*/</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f00</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;  <span class="comment">/*触发bfc*/</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#0f0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">原理：<span class="selector-id">#left</span>不设宽度左浮动，<span class="selector-id">#right</span>触发 <span class="selector-tag">bfc</span> 达到自适应</span><br></pre></td></tr></table></figure>

<h3 id="2-flex-布局"><a href="#2-flex-布局" class="headerlink" title="2. flex 布局"></a>2. flex 布局</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="comment">/*不设宽度*/</span></span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f00</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#0f0</span>;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>; <span class="comment">/*均分#parent剩余的部分*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三列布局（左中定宽，右侧自适应）"><a href="#三列布局（左中定宽，右侧自适应）" class="headerlink" title="三列布局（左中定宽，右侧自适应）"></a>三列布局（左中定宽，右侧自适应）</h2><blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;left&quot;</span>&gt;</span>左列定宽<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;center&quot;</span>&gt;</span>中间定宽<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;right&quot;</span>&gt;</span>右列自适应<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-float-margin"><a href="#1-float-margin" class="headerlink" title="1. float + margin"></a>1. float + margin</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">310px</span>;</span><br><span class="line">&#125; <span class="comment">/*100+10+200,防止宽度不够,子元素换行*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">10px</span>; <span class="comment">/*#left和#center间隔*/</span></span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f00</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#eeff2b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">320px</span>; <span class="comment">/*等于#left和#center的宽度之和加上间隔,多出来的就是#right和#center的间隔*/</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#0f0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-float-overflow"><a href="#2-float-overflow" class="headerlink" title="2. float + overflow"></a>2. float + overflow</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">320px</span>;</span><br><span class="line">&#125; <span class="comment">/*100+10+200+20,防止宽度不够,子元素换行*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">10px</span>; <span class="comment">/*间隔*/</span></span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f00</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">10px</span>; <span class="comment">/*在此定义和#right的间隔*/</span></span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#eeff2b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden; <span class="comment">/*触发bfc*/</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#0f0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-利用-position"><a href="#3-利用-position" class="headerlink" title="3. 利用 position"></a>3. 利用 position</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125; <span class="comment">/*父相*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute; <span class="comment">/*子绝*/</span></span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f00</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute; <span class="comment">/*子绝*/</span></span><br><span class="line">  <span class="attribute">left</span>: <span class="number">100px</span>; <span class="comment">/*对应#left的width值*/</span></span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#eeff2b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute; <span class="comment">/*子绝*/</span></span><br><span class="line">  <span class="attribute">left</span>: <span class="number">300px</span>; <span class="comment">/*对应#left和#center的width值之和*/</span></span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#0f0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-利用-table"><a href="#4-利用-table" class="headerlink" title="4. 利用 table"></a>4. 利用 table</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">520px</span>; <span class="comment">/*抵消上下间距10*2的高度影响*/</span></span><br><span class="line">  <span class="attribute">margin</span>: -<span class="number">10px</span> <span class="number">0</span>; <span class="comment">/*抵消上下边间距10的位置影响*/</span></span><br><span class="line">  <span class="attribute">display</span>: table;</span><br><span class="line">  <span class="comment">/*左右两边间距无法消除,子元素改用padding设置盒子间距就没有这个问题*/</span></span><br><span class="line">  <span class="attribute">border-spacing</span>: <span class="number">10px</span>; <span class="comment">/*关键!!!设置间距*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f00</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#eeff2b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#0f0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-利用-flex"><a href="#5-利用-flex" class="headerlink" title="5. 利用 flex"></a>5. 利用 flex</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#parent</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#left</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">10px</span>; <span class="comment">/*间距*/</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f00</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#center</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">10px</span>; <span class="comment">/*间距*/</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#eeff2b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#right</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>; <span class="comment">/*均分#parent剩余的部分达到自适应*/</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#0f0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三列布局（两侧定宽，中间自适应）"><a href="#三列布局（两侧定宽，中间自适应）" class="headerlink" title="三列布局（两侧定宽，中间自适应）"></a>三列布局（两侧定宽，中间自适应）</h2><h3 id="圣杯布局-详解"><a href="#圣杯布局-详解" class="headerlink" title="圣杯布局 详解"></a>圣杯布局 <a href="https://blog.csdn.net/konglei1996/article/details/50881391?utm_source=blogxgwz4">详解</a></h3><blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span>中间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 让中间第一，这样浮动的时候它会先占据100%宽 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>左边<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>右边<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">400px</span>; <span class="comment">/* 左边w*2+右边w */</span></span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">100px</span> <span class="number">0</span> <span class="number">150px</span>; <span class="comment">/* 1. 父容器左右留出固定padding */</span></span><br><span class="line">  <span class="attribute">background-color</span>: gray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">100%</span>; <span class="comment">/* 4.1 让被挤到center下方的left左移整个容器的宽度，此时左上角与center重叠 */</span></span><br><span class="line">  <span class="attribute">position</span>: relative; <span class="comment">/* 4.2 为了让left移到最左边,设置相对定位 */</span></span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">150px</span>; <span class="comment">/* 4.3 然后相对自己左移自已宽度的单位，使自己移动到最左边 */</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">float</span>: left; <span class="comment">/* 2.1 左浮动 */</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">233</span>, <span class="number">233</span>, <span class="number">0</span>, <span class="number">0.2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 3. 让center占据剩下父容器的100%宽 */</span></span><br><span class="line">  <span class="attribute">float</span>: left; <span class="comment">/* 2.1 左浮动 */</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">165</span>, <span class="number">12</span>, <span class="number">23</span>, <span class="number">0.4</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: -<span class="number">100px</span>; <span class="comment">/* 5. 给在第二行的right设置一个负自己宽度的margin-right。让其最右边 */</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">float</span>: left; <span class="comment">/* 2.1 左浮动 */</span></span><br><span class="line">  <span class="attribute">background-color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="双飞翼布局方法-详情"><a href="#双飞翼布局方法-详情" class="headerlink" title="双飞翼布局方法 详情"></a>双飞翼布局方法 <a href="http://m.10qianwan.com/web/350789.html">详情</a></h3><blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>中间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>左边<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>右边<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 1. 整个容器宽100%自适应 */</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: gray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>; <span class="comment">/* 3.1 设置定宽 */</span></span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">100%</span>; <span class="comment">/* 5. 左移容器宽度100%个单位，就把自己排在了center前面 */</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">233</span>, <span class="number">233</span>, <span class="number">0</span>, <span class="number">0.2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 4. 中间容器100%，此时会把左右挤到第二行 */</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">165</span>, <span class="number">12</span>, <span class="number">23</span>, <span class="number">0.4</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.center</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">150px</span> <span class="number">0</span> <span class="number">100px</span>;</span><br><span class="line">  <span class="comment">/* 7. 此时center的左右分别有100和150宽与left，right重叠。所以让center子容器左右margin抵消 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150px</span>; <span class="comment">/* 3.2 设置定宽 */</span></span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">150px</span>; <span class="comment">/* 6. 同样左移自身宽度的单位，让right也回到第一行 */</span></span><br><span class="line">  <span class="attribute">background-color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.left</span>,</span><br><span class="line"><span class="selector-class">.center</span>,</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">float</span>: left; <span class="comment">/*2. 子容器全部左浮动 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="布局的几种方式"><a href="#布局的几种方式" class="headerlink" title="布局的几种方式"></a>布局的几种方式</h2><ol>
<li>伸缩布局 flex</li>
<li>流式布局 百分比</li>
<li>响应式布局 媒体查询（超小屏设备时：流式布局）<br>&lt;!- 以上布局共同点：元素只能做到宽度的适配（排除图片）-&gt;</li>
<li>rem 布局 宽度和高度都能做到适配（等比适配）</li>
</ol>
<h2 id="Flex"><a href="#Flex" class="headerlink" title="Flex"></a>Flex</h2><h3 id="flex-布局和传统布局的优势？"><a href="#flex-布局和传统布局的优势？" class="headerlink" title="flex 布局和传统布局的优势？"></a>flex 布局和传统布局的优势？</h3><p>该布局模型的目的是提供一种更加高效的方式来对容器中的条目进行布局、对齐和分配空间。</p>
<p>在传统的布局方式中:</p>
<ul>
<li>block 布局是把块在垂直方向从上到下依次排列的</li>
<li>inline 布局则是在水平方向来排列</li>
<li>flex 弹性盒布局并没有这样内在的方向限制，可以由开发人员自由操作</li>
</ul>
<h3 id="请解释一下-CSS3-的-Flexbox（弹性盒布局模型）-以及适用场景？"><a href="#请解释一下-CSS3-的-Flexbox（弹性盒布局模型）-以及适用场景？" class="headerlink" title="请解释一下 CSS3 的 Flexbox（弹性盒布局模型）,以及适用场景？"></a>请解释一下 CSS3 的 Flexbox（弹性盒布局模型）,以及适用场景？</h3><p>该布局模型的目的是提供一种更加高效的方式来对容器中的条目进行布局、对齐和分配空间。</p>
<p>在传统的布局方式中:</p>
<ul>
<li>block 布局是把块在垂直方向从上到下依次排列的；</li>
<li>inline 布局则是在水平方向来排列。</li>
<li>flex 弹性盒布局并没有这样内在的方向限制，可以由开发人员自由操作。</li>
</ul>
<p>适用场景：弹性布局适合于移动前端开发，在 Android 和 iOS 上也完美支持。</p>
<p>参考：<a href="http://www.w3cplus.com/css3/flexbox-basics.html">http://www.w3cplus.com/css3/flexbox-basics.html</a></p>
<h3 id="flex-是什么属性的缩写"><a href="#flex-是什么属性的缩写" class="headerlink" title="flex 是什么属性的缩写"></a>flex 是什么属性的缩写</h3><p>flex 属性是 <code>flex-grow</code>、<code>flex-shrink</code> 和 <code>flex-basis</code> 的简写</p>
<h3 id="如何使用-flex-实现三列等宽布局"><a href="#如何使用-flex-实现三列等宽布局" class="headerlink" title="如何使用 flex 实现三列等宽布局"></a>如何使用 flex 实现三列等宽布局</h3><p>父元素 display: flex，子元素 flex: 1</p>
<h4 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h4><p>子元素的设置等同于：flex: 1 1 auto</p>
<p>flex 的默认值是：0 1 auto</p>
<p>意思是项目默认有剩余空间也不放大（0），但空间不足会缩小（1）</p>
<p>现在改为了值 1 ，就可以放大了，所以三栏可以平分宽度</p>
<p>阅读：<a href="https://segmentfault.com/q/1010000004080910">flex 设置成 1 和 auto 有什么区别</a></p>
<h3 id="如何使用-flex-实现下列布局"><a href="#如何使用-flex-实现下列布局" class="headerlink" title="如何使用 flex 实现下列布局"></a>如何使用 flex 实现下列布局</h3><img src="/posts/51111/flex-left.png" class="" title="flex">

<blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box box1&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box box2&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box box3&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box box4&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box box5&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>margin-right: auto<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-end;</span><br><span class="line">  <span class="attribute">background-color</span>: lightyellow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">75px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: springgreen;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box1</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>摘自：<a href="https://juejin.im/post/5bde54ce51882516e840a8af">css flex 布局中妙用 margin: auto</a></p>
<h2 id="如何解决移动端-Retina-屏-1px-像素问题"><a href="#如何解决移动端-Retina-屏-1px-像素问题" class="headerlink" title="如何解决移动端 Retina 屏 1px 像素问题"></a>如何解决移动端 Retina 屏 1px 像素问题</h2><h3 id="原理：媒体查询-变换缩放"><a href="#原理：媒体查询-变换缩放" class="headerlink" title="原理：媒体查询 + 变换缩放"></a>原理：媒体查询 + 变换缩放</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">      * &#123;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-id">#test</span> &#123;</span></span><br><span class="line">        width: 100%;</span><br><span class="line">        height: 1px;</span><br><span class="line">        margin-top: 50px;</span><br><span class="line">        background: black;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">-webkit-device-pixel-ratio:</span> <span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-id">#test</span> &#123;</span></span><br><span class="line">          transform: scaleY(0.5);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">-webkit-device-pixel-ratio:</span> <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-id">#test</span> &#123;</span></span><br><span class="line">          transform: scaleY(0.333333333333333333);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="stylus-实现方案"><a href="#stylus-实现方案" class="headerlink" title="stylus 实现方案"></a>stylus 实现方案</h3><blockquote>
<p>stylus</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">copy&#x2F;* 给 dpr 1.5 的设备设置 0.7 的缩放 *&#x2F;</span><br><span class="line">@media (-webkit-min-device-pixel-ratio: 1.5), (min-device-pixel-ratio: 1.5)</span><br><span class="line">.border1px</span><br><span class="line"> &amp;::after</span><br><span class="line">   -webkit-transform: scaleY(.7)</span><br><span class="line">   transform: scaleY(.7)</span><br><span class="line">&#x2F;* 给 dpr 2.0 的设备设置 0.5 的缩放 *&#x2F;</span><br><span class="line">@media (-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2)</span><br><span class="line">.border1px</span><br><span class="line"> &amp;::after</span><br><span class="line">   -webkit-transform: scaleY(.5)</span><br><span class="line">   transform: scaleY(.5)</span><br><span class="line"></span><br><span class="line">&#x2F;* 给需要1px下边框的元素添加一个伪元素，</span><br><span class="line">使其宽100%；高为用户自定义 *&#x2F;</span><br><span class="line">border1px($color)</span><br><span class="line">position: relative</span><br><span class="line">&amp;:after</span><br><span class="line"> display: block</span><br><span class="line"> position: absolute</span><br><span class="line"> left: 0</span><br><span class="line"> bottom: 0</span><br><span class="line"> width: 100%</span><br><span class="line"> border-top: 1px solid $color</span><br><span class="line"> content: &#39; &#39;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>html</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1. 给需要添加1像素边框的元素设置一个类作为标识，让媒体查询能够识别 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;border1px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;stylus&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line">  header</span><br><span class="line">    ...</span><br><span class="line"><span class="css">    <span class="selector-tag">border1px</span>(<span class="selector-tag">black</span>) <span class="comment">/* 2. 通过border1px设置边框 */</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="CSS-实现宽度自适应-100-，宽高-16-9-比例的矩形"><a href="#CSS-实现宽度自适应-100-，宽高-16-9-比例的矩形" class="headerlink" title="CSS 实现宽度自适应 100%，宽高 16:9 比例的矩形"></a>CSS 实现宽度自适应 100%，宽高 16:9 比例的矩形</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="comment">/* box 用来控制宽度 */</span></span></span><br><span class="line"><span class="css">  <span class="selector-class">.box</span> &#123;</span></span><br><span class="line">    width: 100%;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="comment">/* scale 用来实现宽高等比例 1:1 padding-bottom:100%; 4:3 padding-bottom:75%; 16:9 padding-bottom:56.25%; */</span></span></span><br><span class="line"><span class="css">  <span class="selector-class">.scale</span> &#123;</span></span><br><span class="line">    width: 100%;</span><br><span class="line">    padding-bottom: 56.25%;</span><br><span class="line">    height: 0;</span><br><span class="line">    position: relative;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="comment">/* item 用来放置全部的子元素 */</span></span></span><br><span class="line"><span class="css">  <span class="selector-class">.item</span> &#123;</span></span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#e1e1e1</span>;</span></span><br><span class="line">    position: absolute;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;scale&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="实现不使用-border-画出-1px-高的线，在不同浏览器的标准模式与怪异模式下都能保持一致的效果。"><a href="#实现不使用-border-画出-1px-高的线，在不同浏览器的标准模式与怪异模式下都能保持一致的效果。" class="headerlink" title="实现不使用 border 画出 1px 高的线，在不同浏览器的标准模式与怪异模式下都能保持一致的效果。"></a>实现不使用 border 画出 1px 高的线，在不同浏览器的标准模式与怪异模式下都能保持一致的效果。</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height:1px;overflow:hidden;background:red&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="已知如下代码，如何修改才能让图片宽度为-300px-？注意下面代码不可修改"><a href="#已知如下代码，如何修改才能让图片宽度为-300px-？注意下面代码不可修改" class="headerlink" title="已知如下代码，如何修改才能让图片宽度为 300px ？注意下面代码不可修改"></a>已知如下代码，如何修改才能让图片宽度为 300px ？注意下面代码不可修改</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:480px!important;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>答案：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 方法一：max-width覆盖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:480px!important; max-width: 300px&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 方法二：scale按比例缩放 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:480px!important; transform: scale(0.625, 1);&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 方法三：相同属性直接覆盖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:480px!important; width:300px!important;&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 方法四：css动画样式优先级高于important特性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">  img &#123;</span><br><span class="line">    animation: test 0s forwards;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="keyword">@keyframes</span> test &#123;</span></span><br><span class="line">    from &#123;</span><br><span class="line">      width: 300px;</span><br><span class="line">    &#125;</span><br><span class="line">    to &#123;</span><br><span class="line">      width: 300px;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>题目来源：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/105">Daily-Interview-Question 第 60 题</a></p>
<h3 id="了解-box-sizing-吗？"><a href="#了解-box-sizing-吗？" class="headerlink" title="了解 box-sizing 吗？"></a>了解 box-sizing 吗？</h3><p>box-sizing 属性可以被用来调整这些表现:</p>
<ul>
<li><code>content-box</code> 是默认值。如果你设置一个元素的宽为 100px，那么这个元素的内容区会有 100px 宽，并且任何边框和内边距的宽度都会被增加到最后绘制出来的元素宽度中。</li>
<li><code>border-box</code> 告诉浏览器：你想要设置的边框和内边距的值是包含在 width 内的。也就是说，如果你将一个元素的 width 设为 100px，那么这 100px 会包含它的 border 和 padding，内容区的实际宽度是 width 减去(border + padding)的值。大多数情况下，这使得我们更容易地设定一个元素的宽高。</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS知识点（面试系列）</title>
    <url>/posts/40707/</url>
    <content><![CDATA[<h2 id="盒模型"><a href="#盒模型" class="headerlink" title="盒模型"></a>盒模型</h2><p>标准盒模型（W3C 标准）：</p>
<p>一个块的总宽度 = <strong>内容宽度</strong> + margin(左右) + padding(左右) + border(左右)</p>
<p>怪异盒模型（IE 标准）：</p>
<p>一个块的总宽度 = <strong>width（包含 padding 和 border）</strong> + margin(左右)</p>
<a id="more"></a>

<h3 id="怪异盒模型触发条件"><a href="#怪异盒模型触发条件" class="headerlink" title="怪异盒模型触发条件"></a>怪异盒模型触发条件</h3><p>如果 html 文件最顶部 doctype 缺失，则在 ie6、7、8 将会触发怪异模式(quirks);</p>
<h3 id="通过-css-来设置盒模型"><a href="#通过-css-来设置盒模型" class="headerlink" title="通过 css 来设置盒模型"></a>通过 css 来设置盒模型</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">box-sizing</span>: <span class="selector-tag">content-box</span>; <span class="comment">/* 标准模型 */</span></span><br><span class="line">            <span class="selector-tag">border-box</span>;  <span class="comment">/* IE模型 */</span></span><br><span class="line">            <span class="selector-tag">inherit</span>;     <span class="comment">/* 从父元素继承 */</span></span><br></pre></td></tr></table></figure>

<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li>怪异盒模型（border-box）</li>
</ul>
<blockquote>
<p>比如我们想做一个内边距 10px ，边框为 2px ，最终包括边框宽度为 100px 的 div ，之前的做法是先算出内容宽 <code>width</code> 。但有点繁琐，需要人算。此时我们可以把 div 的 box-sizing 设置为 border-box ，我们就可以直接把 width 设置为 100px ，其余的 padding 和 border 按照给定好的值一一填入，就可以完成这一切工作，省去了人为的计算内容宽 content 的过程，减少计算量的同时减少了错误率。</p>
</blockquote>
<h2 id="CSS-选择符有哪些？哪些属性可以继承？"><a href="#CSS-选择符有哪些？哪些属性可以继承？" class="headerlink" title="CSS 选择符有哪些？哪些属性可以继承？"></a>CSS 选择符有哪些？哪些属性可以继承？</h2><ol>
<li>id 选择器（ #my-id ）</li>
<li>类选择器（ .my-class-name ）</li>
<li>标签选择器（ div, h1, p ）</li>
<li>相邻选择器（ h1 + p 紧贴在 h1 后面的第一个 p 标签。同级标签，之间不能有其他标签 ）</li>
<li>子代选择器（ ul &gt; li ul 标签下的下一个层级的 li ，并不是所有 ）</li>
<li>后代选择器（ li a ）</li>
<li>通配符选择器（ * ）</li>
<li>属性选择器（ a[rel = “external”] ）</li>
<li>伪类选择器（ a:hover, li:nth-child ）</li>
</ol>
<h3 id="可继承属性"><a href="#可继承属性" class="headerlink" title="可继承属性"></a>可继承属性</h3><p>font-size font-family color, UL LI DL DD DT;</p>
<h3 id="不可继承属性"><a href="#不可继承属性" class="headerlink" title="不可继承属性"></a>不可继承属性</h3><p>border padding margin width height</p>
<h2 id="CSS-优先级算法如何计算？"><a href="#CSS-优先级算法如何计算？" class="headerlink" title="CSS 优先级算法如何计算？"></a>CSS 优先级算法如何计算？</h2><ul>
<li>写在后面的覆盖写在前面的</li>
<li>描述越具体优先级越高 (div , div[class=’restart’])</li>
<li>同权重 行内样式 &gt; 内嵌样式 &gt; 外部样式</li>
<li>!important 优先级最高</li>
</ul>
<h2 id="CSS3-新增伪类有那些？"><a href="#CSS3-新增伪类有那些？" class="headerlink" title="CSS3 新增伪类有那些？"></a>CSS3 新增伪类有那些？</h2><ul>
<li><code>p:first-of-type</code> 属于其父元素的特定类型首个子元素 等同于 <code>:nth-of-type(1)</code></li>
<li><code>p:last-of-type</code> 属于其父元素的特定类型的最后一个子元素 等同于 <code>:nth-last-of-type(1)</code></li>
<li><code>::after</code> 在元素之前添加内容,也可以用来做清除浮动。</li>
<li><code>::before</code> 在元素之后添加内容</li>
<li><code>:enabled/:disabled</code> 控制表单控件的禁用状态。</li>
<li><code>:checked</code> 单选框或复选框被选中。</li>
</ul>
<h2 id="display-none、visibility：hidden-和-opacity-0-的区别？"><a href="#display-none、visibility：hidden-和-opacity-0-的区别？" class="headerlink" title="display:none、visibility：hidden 和 opacity: 0 的区别？"></a>display:none、visibility：hidden 和 opacity: 0 的区别？</h2><ul>
<li>display：none （不占空间，不能点击）（回流+重绘）</li>
<li>visibility：hidden （占据空间，不可点击）（重绘）</li>
<li>opacity: 0（占据空间，可以点击）（重建图层，性能较高）</li>
</ul>
<p>更多：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/100">分析比较 opacity: 0、visibility: hidden、display: none 优劣和适用场景</a></p>
<h2 id="position-跟-display-、float-这些特性相互叠加后会怎么样？"><a href="#position-跟-display-、float-这些特性相互叠加后会怎么样？" class="headerlink" title="position 跟 display 、float 这些特性相互叠加后会怎么样？"></a>position 跟 display 、float 这些特性相互叠加后会怎么样？</h2><ul>
<li>position 属性规定元素的定位类型</li>
<li>display 属性规定元素应该生成的框的类型</li>
<li>float 属性是一种布局方式，定义元素在哪个方向浮动。</li>
</ul>
<p>优先级机制：position：absolute/fixed 优先级最高，有他们在时，float 不起作用，display 值需要调整。float 或者 absolute 定位的元素，只能是块元素或表格。</p>
<h2 id="讲一讲-position-属性中的各种值"><a href="#讲一讲-position-属性中的各种值" class="headerlink" title="讲一讲 position 属性中的各种值"></a>讲一讲 position 属性中的各种值</h2><table>
<thead>
<tr>
<th align="left"><strong>值</strong></th>
<th align="left"><strong>是否脱标占有位置</strong></th>
<th align="left"><strong>可使用边偏移</strong></th>
<th align="left"><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">static</td>
<td align="left">不脱标，正常模式</td>
<td align="left">不可以</td>
<td align="left">自动（没有）定位（默认定位方式）</td>
</tr>
<tr>
<td align="left">relative(自恋)</td>
<td align="left">不脱标，占有位置</td>
<td align="left">可以</td>
<td align="left">相对定位，相对于其原文档流的位置进行定位</td>
</tr>
<tr>
<td align="left">absolute(拼爹)</td>
<td align="left">完全脱标，不占位置</td>
<td align="left">可以</td>
<td align="left">绝对定位，相对于其上一个已经定位（不为 static）的父元素进行定位</td>
</tr>
<tr>
<td align="left">fixed(浏览器)</td>
<td align="left">完全脱标，不占位置</td>
<td align="left">可以</td>
<td align="left">固定定位，相对于浏览器窗口进行定位（老 IE 不支持）</td>
</tr>
<tr>
<td align="left">inherit</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">规定从父元素继承 position 属性的值</td>
</tr>
</tbody></table>
<h2 id="CSS3-有哪些新特性？"><a href="#CSS3-有哪些新特性？" class="headerlink" title="CSS3 有哪些新特性？"></a>CSS3 有哪些新特性？</h2><h3 id="过渡"><a href="#过渡" class="headerlink" title="过渡"></a>过渡</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 语法 */</span></span><br><span class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">CSS</span>属性，过渡时间，效果曲线（默认<span class="selector-tag">ease</span>），延迟时间（默认0）</span><br><span class="line"></span><br><span class="line"><span class="comment">/* demo1 */</span></span><br><span class="line"><span class="comment">/*宽度从原始值到制定值的一个过渡，运动曲线ease,运动时间0.5秒，0.2秒后执行过渡*/</span></span><br><span class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">width</span> .5<span class="selector-tag">s</span> <span class="selector-tag">ease</span> .2<span class="selector-tag">s</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* demo2 */</span></span><br><span class="line"><span class="comment">/* 分开写 */</span></span><br><span class="line"><span class="selector-tag">transition-property</span>: <span class="selector-tag">width</span>;</span><br><span class="line"><span class="selector-tag">transition-duration</span>: 1<span class="selector-tag">s</span>;</span><br><span class="line"><span class="selector-tag">transition-timing-function</span>: <span class="selector-tag">linear</span>;</span><br><span class="line"><span class="selector-tag">transition-delay</span>: 2<span class="selector-tag">s</span>;</span><br></pre></td></tr></table></figure>

<h3 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 语法 */</span></span><br><span class="line"><span class="selector-tag">animation</span>：动画名称，动画时间，运动曲线（默认<span class="selector-tag">ease</span>），动画延迟（默认0），播放次数（默认1），</span><br><span class="line">是否反向播放动画（默认<span class="selector-tag">normal</span>），是否暂停动画（默认<span class="selector-tag">running</span>）</span><br><span class="line"></span><br><span class="line"><span class="comment">/* demo1 */</span></span><br><span class="line"><span class="comment">/* 执行一次logo2-line动画，运动时间2秒，运动曲线为 linear */</span></span><br><span class="line"><span class="selector-tag">animation</span>: <span class="selector-tag">logo2-line</span> 2<span class="selector-tag">s</span> <span class="selector-tag">linear</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* demo2 */</span></span><br><span class="line"><span class="comment">/* 2秒后开始执行一次 logo2-line 动画，运动时间2秒，运动曲线为 linear */</span></span><br><span class="line"><span class="selector-tag">animation</span>: <span class="selector-tag">logo2-line</span> 2<span class="selector-tag">s</span> <span class="selector-tag">linear</span> 2<span class="selector-tag">s</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* demo3 */</span></span><br><span class="line"><span class="comment">/*无限执行 logo2-line 动画，每次运动时间2秒，运动曲线为 linear，并且执行反向动画*/</span></span><br><span class="line"><span class="selector-tag">animation</span>: <span class="selector-tag">logo2-line</span> 2<span class="selector-tag">s</span> <span class="selector-tag">linear</span> <span class="selector-tag">alternate</span> <span class="selector-tag">infinite</span>;</span><br><span class="line"></span><br><span class="line">还有一个重要属性：用来指定在动画执行之前和之后如何给动画的目标应用样式。</span><br><span class="line">animation-fill-mode: none | forwards | backwards | both;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">动画分为 初始状态 等待期 动画执行期 完成期 四个阶段。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">- none 表示 等待期和完成期，元素样式都为初始状态样式，不受动画定义（@keyframes）的影响</span></span><br><span class="line"><span class="comment">- forwards 表示等待期保持初始样式，完成期间保持最后一帧样式</span></span><br><span class="line"><span class="comment">- backwards 表示等待期为第一帧样式，完成期跳转为初始样式</span></span><br><span class="line"><span class="comment">- both 表示 等待期样式为第一帧样式，完成期保持最后一帧样式</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://segmentfault.com/q/1010000003867335">如何理解 animation-fill-mode 及其使用？</a></p>
<h3 id="形状转换"><a href="#形状转换" class="headerlink" title="形状转换"></a>形状转换</h3><p>transform: 适用于 2D 或 3D 转换的元素 <a href="https://www.zhangxinxu.com/wordpress/2012/09/css3-3d-transform-perspective-animate-transition/">(3d 看这里)</a><br>transform-origin: 转换元素的位置（围绕那个点进行转换,默认中心）。默认 x, y, z ： 50%, 50%, 0 对应 left, top</p>
<ul>
<li>缩放 scale</li>
<li>位移 translate</li>
<li>旋转 rotate</li>
<li>倾斜 skew</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">transform</span>: <span class="selector-tag">rotate</span>(30<span class="selector-tag">deg</span>);</span><br><span class="line"><span class="selector-tag">transform</span>: <span class="selector-tag">translate</span>(30<span class="selector-tag">px</span>, 30<span class="selector-tag">px</span>);</span><br><span class="line"><span class="selector-tag">transform</span>: <span class="selector-tag">scale</span>(0.8);</span><br><span class="line"><span class="selector-tag">transform</span>: <span class="selector-tag">skew</span>(10<span class="selector-tag">deg</span>, 10<span class="selector-tag">deg</span>);</span><br><span class="line"><span class="selector-tag">transform-origin</span>: <span class="selector-tag">left</span> <span class="selector-tag">top</span>; <span class="comment">/* 左上（默认中心）【改变元素变形的原点】 */</span></span><br></pre></td></tr></table></figure>

<h4 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h4><p>对 transition 、animation 和 transform 这块儿内容不熟的同学可以参考我的博客简单上手教程，基本上每个属性都有相应的 demo 展示：<a href="https://evestorm.github.io/categories/%E5%89%8D%E7%AB%AF/CSS/">Lance 的个人博客-css 分类</a></p>
<p>另外，上面的知识点参考于下方资源，可自取：</p>
<ul>
<li><a href="https://segmentfault.com/a/1190000010780991">个人总结（css3 新特性）</a></li>
<li><a href="http://cubic-bezier.com/#.42,0,.58,1">cubic-bezier 贝塞尔在线预览</a></li>
<li><a href="https://cssreference.io/property/transition-timing-function/">transition-timing-function | cssreference</a></li>
<li><a href="https://www.smashingmagazine.com/2014/04/understanding-css-timing-functions/">Understanding The CSS3 transition-timing-function Property</a></li>
<li><a href="https://segmentfault.com/a/1190000011019534">翻译 | 深入理解 CSS 时序函数</a></li>
<li><a href="http://koala.ink/posts/86be452a/">css3 动画详解【推荐】</a></li>
</ul>
<h3 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h3><h4 id="属性选择器"><a href="#属性选择器" class="headerlink" title="属性选择器"></a>属性选择器</h4><ul>
<li>div[index] { background: red } 表示 div 下面带 index 属性的背景为红色</li>
<li>div[index=a] { background: red } 表示 div 下面的自定义属性 index=a 的 div 的颜色变成红色。</li>
<li>div[index~=a] { background: red } 只要 div 中 index 属性带 a 这个单词的就生效。[a 这个单词必须独立存在]<ul>
<li>p[class~=’lance’] 只会匹配到 class=”xxx lance”，而不会匹配 class=”xxlancexx”</li>
</ul>
</li>
<li>div[index*=a] { background: red } 只要 div 里面的 index 属性带 a 字母的就生效。</li>
<li>div[index^=a] { background: red } 以 a 开头的</li>
<li>div[index$=a] { background: red } 以 a 结尾</li>
<li>div[index|=a] { background:red } 只要以 a- 开头的</li>
</ul>
<p>当需要多个的时候： div[key1=value1][key2=value2][key3=value3]…. { background:red }</p>
<h4 id="结构性伪类选择器"><a href="#结构性伪类选择器" class="headerlink" title="结构性伪类选择器"></a>结构性伪类选择器</h4><p>前提：假如 div 是下面 p 标签的父元素</p>
<ul>
<li><pre><code>p:nth-child(n)
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  div 下类型为 p 的第 n 个子元素，下标从 1 开始！！</span><br><span class="line"></span><br><span class="line">  - &#96;:nth-child(odd)&#96; 奇数</span><br><span class="line">  - &#96;:nth-child(even)&#96; 偶数</span><br><span class="line"></span><br><span class="line">- &#96;p:nth-last-child(n)&#96; 从倒数，div 下类型为 p 的第 n 个子元素</span><br><span class="line"></span><br><span class="line">- &#96;p:last-child&#96; div 下最后一个子元素如果是 p ，则生效，否则不生效</span><br><span class="line"></span><br><span class="line">- &#96;p:first-child&#96; div 下第一个子元素如果是 p ，则生效，否则不生效【css2 的】</span><br><span class="line"></span><br><span class="line">- &#96;p:first-of-type&#96; div 下第一个类型为 p 的子元素【不需要 p 是这个 div 下的第一个子元素】</span><br><span class="line"></span><br><span class="line">- &#96;p:last-of-type&#96; div 下最后一个类型为 p 的子元素</span><br><span class="line"></span><br><span class="line">参考：[css 选择器中:first-child 与:first-of-type 的区别](https:&#x2F;&#x2F;www.cnblogs.com&#x2F;2050&#x2F;p&#x2F;3569509.html)</span><br><span class="line"></span><br><span class="line">#### 伪元素选择器</span><br><span class="line"></span><br><span class="line">1. &#96;::first-letter&#96; 文本的第一个单词或字（如中文、日文、韩文等）</span><br><span class="line">2. &#96;::first-line&#96; 文本第一行；</span><br><span class="line">3. &#96;::selection&#96; 可改变选中文本的样式；</span><br><span class="line">4. &#96;::before&#96; 和 &#96;::after&#96; 在元素内部的开始火结束为止创建一个元素，该元素为行内元素，必须结合 content 属性使用 div::before &#123; content: ‘开始’ &#125;</span><br><span class="line"></span><br><span class="line">#### 目标伪类选择器</span><br><span class="line"></span><br><span class="line">&#96;:target&#96; 目标伪类选择器， &#96;:&#96; 选择器可用于选取当前活动的目标元素</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;css</span><br><span class="line">:target &#123;</span><br><span class="line">  color: red;</span><br><span class="line">  font-size: 30px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h3 id="阴影"><a href="#阴影" class="headerlink" title="阴影"></a>阴影</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* x偏移量 | y偏移量 | 阴影模糊半径 | 阴影扩散半径 | 阴影颜色 */</span></span><br><span class="line"><span class="selector-tag">box-shadow</span>: 2<span class="selector-tag">px</span> 2<span class="selector-tag">px</span> 2<span class="selector-tag">px</span> 1<span class="selector-tag">px</span> <span class="selector-tag">rgba</span>(0, 0, 0, 0.2);</span><br></pre></td></tr></table></figure>

<h3 id="边框"><a href="#边框" class="headerlink" title="边框"></a>边框</h3><ul>
<li><p>边框图片 border-image</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">border-image</span>: <span class="selector-tag">image-source</span> <span class="selector-tag">image-height</span> <span class="selector-tag">image-width</span> <span class="selector-tag">image-repeat</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>圆角边框 border-radius</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">border-radius</span>: 左上角，右上角，右下角，左下角;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="CSS-弹性布局（flex）"><a href="#CSS-弹性布局（flex）" class="headerlink" title="CSS 弹性布局（flex）"></a>CSS 弹性布局（flex）</h3><h4 id="Flex-容器属性"><a href="#Flex-容器属性" class="headerlink" title="Flex 容器属性"></a>Flex 容器属性</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">copy主轴方向：水平排列（默认） | 水平反向排列 | 垂直排列 | 垂直反向排列</span><br><span class="line">flex-direction: row | row-reverse | column | column-reverse;</span><br><span class="line"></span><br><span class="line">换行：不换行（默认） | 换行 | 反向换行(第一行在最后面)</span><br><span class="line">flex-wrap: nowrap | wrap | wrap-reverse;</span><br><span class="line"></span><br><span class="line">flex-direction属性和flex-wrap属性的简写形式，默认值为row nowrap</span><br><span class="line">flex-flow: &lt;flex-direction&gt; || &lt;flex-wrap&gt;;</span><br><span class="line"></span><br><span class="line">主轴对齐方式：起点对齐（默认） | 终点对齐 | 居中对齐 | 两端对齐 | 分散对齐</span><br><span class="line">justify-content: flex-start | flex-end | center | space-between | space-around;</span><br><span class="line"></span><br><span class="line">交叉轴对齐方式：拉伸对齐（默认） | 起点对齐 | 终点对齐 | 居中对齐 | 第一行文字的基线对齐</span><br><span class="line">align-items: stretch | flex-start | flex-end | center | baseline;</span><br><span class="line"></span><br><span class="line">多根轴线对齐方式：拉伸对齐（默认） | 起点对齐 | 终点对齐 | 居中对齐 | 两端对齐 | 分散对齐</span><br><span class="line">align-content: stretch | flex-start | flex-end | center | space-between | space-around;</span><br></pre></td></tr></table></figure>

<h4 id="Flex-项目属性"><a href="#Flex-项目属性" class="headerlink" title="Flex 项目属性"></a>Flex 项目属性</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">顺序：数值越小越靠前，默认为0</span><br><span class="line"><span class="selector-tag">order</span>: &lt;<span class="selector-tag">number</span>&gt;;</span><br><span class="line"></span><br><span class="line">放大比例：默认为0，如果有剩余空间也不放大，值为1则放大，2是1的双倍大小，以此类推</span><br><span class="line"><span class="selector-tag">flex-grow</span>: &lt;<span class="selector-tag">number</span>&gt;;</span><br><span class="line"></span><br><span class="line">缩小比例：默认为1，如果空间不足则会缩小，值为0不缩小</span><br><span class="line"><span class="selector-tag">flex-shrink</span>: &lt;<span class="selector-tag">number</span>&gt;;</span><br><span class="line"></span><br><span class="line">项目自身大小：默认<span class="selector-tag">auto</span>，为原来的大小，可设置固定值 50<span class="selector-tag">px</span>/50%</span><br><span class="line">flex-basis: &lt;length&gt; | auto;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">flex-grow</span>, <span class="selector-tag">flex-shrink</span> 和 <span class="selector-tag">flex-basis</span> 的简写，默认值为0 1 <span class="selector-tag">auto</span></span><br><span class="line">两个快捷值：<span class="selector-tag">auto</span> (1 1 <span class="selector-tag">auto</span>) 和 <span class="selector-tag">none</span> (0 0 <span class="selector-tag">auto</span>)</span><br><span class="line">flex:none | [ &lt;&#x27;flex-grow&#x27;&gt; &lt;&#x27;flex-shrink&#x27;&gt;? || &lt;&#x27;flex-basis&#x27;&gt; ]</span><br><span class="line"></span><br><span class="line">项目自身对齐：继承父元素（默认） | 起点对齐 | 终点对齐 | 居中对齐 | 基线对齐 | 拉伸对齐</span><br><span class="line">align-self: auto | flex-start | flex-end | center | baseline | stretch;</span><br></pre></td></tr></table></figure>

<h4 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h4><p>左右分栏、上下分栏。（检验下自己如何完成下列布局）</p>
<img src="/posts/40707/%E4%B8%8A%E4%B8%8B%E5%88%86%E6%A0%8F.png" class="" title="上下分栏">

<img src="/posts/40707/%E5%B7%A6%E5%8F%B3%E5%88%86%E6%A0%8F.png" class="" title="左右分栏">

<img src="/posts/40707/%E5%86%85%E5%AE%B9%E7%BB%93%E6%9E%84%E6%9D%BF%E5%9D%97.png" class="" title="内容结构板块">

<p>对 flex 不熟悉的同学可以参考下面网站进行学习：</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/25303493">30 分钟学会 Flex 布局</a></li>
<li><a href="http://www.deathghost.cn/article/css/38">flex 网页布局首选方案 灵活应用 flex 弹性布局快速构建 web 结构</a></li>
</ul>
<p>不愿意看长篇大论的可以通过这个塔防游戏来学习：<a href="http://www.flexboxdefense.com/">Flexbox Defense</a></p>
<h2 id="li-与-li-之间有看不见的空白间隔是什么原因引起的？有什么解决办法？"><a href="#li-与-li-之间有看不见的空白间隔是什么原因引起的？有什么解决办法？" class="headerlink" title="li 与 li 之间有看不见的空白间隔是什么原因引起的？有什么解决办法？"></a>li 与 li 之间有看不见的空白间隔是什么原因引起的？有什么解决办法？</h2><h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><blockquote>
<p>有时，在写页面的时候，会需要将</p>
<p>这个块状元素横排显示，此时就需要将 display 属性设置为 inline-block ，此时问题出现了，在两个</p>
<p>元素之间会出现大约 8px 左右的空白间隙</p>
</blockquote>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>浏览器的默认行为是把 inline 元素间的空白字符（空格换行 tab ）渲染成一个空格，也就是我们上面的代码</p>
<p>换行后会产生换行字符，而它会变成一个空格，当然空格就占用一个字符的宽度。</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>给 ul 标签设置 <code>font-size: 0;</code> 并为 li 元素重新设置 <code>font-size: xxpx;</code></p>
<h2 id="BFC-块级格式化上下文：block-formatting-context"><a href="#BFC-块级格式化上下文：block-formatting-context" class="headerlink" title="BFC(块级格式化上下文：block formatting context)"></a>BFC(块级格式化上下文：block formatting context)</h2><h3 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h3><p>BFC 就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。反之也如此。我们可以利用这些特性解决特定环境下的布局问题。</p>
<h3 id="常见-BFC-应用"><a href="#常见-BFC-应用" class="headerlink" title="常见 BFC 应用"></a>常见 BFC 应用</h3><h4 id="清除元素内部浮动"><a href="#清除元素内部浮动" class="headerlink" title="清除元素内部浮动"></a>清除元素内部浮动</h4><blockquote>
<p>计算 BFC 的高度时，自然也会检测浮动或者定位的盒子高度。</p>
</blockquote>
<p>只要把父元素设为 BFC 就可以清理子元素的浮动了，最常见的用法就是在父元素上设置 <code>overflow: hidden</code> 样式，对于 IE6 加上 <code>zoom: 1</code> 就可以了。</p>
<img src="/posts/40707/float.png" class="" title="float">

<h4 id="解决外边距合并问题"><a href="#解决外边距合并问题" class="headerlink" title="解决外边距合并问题"></a>解决外边距合并问题</h4><blockquote>
<p>盒子垂直方向的距离由 margin 决定。属于同一个 BFC 的两个相邻盒子的 margin 会发生重叠</p>
</blockquote>
<p>属于同一个 BFC 的两个相邻盒子的 margin 会发生重叠，那么我们创建不属于同一个 BFC ，就不会发生 margin 重叠了。</p>
<img src="/posts/40707/margin.png" class="" title="margin">

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container4 green&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 500px;&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 给其中一个 div 外面包一个 div ，然后通过触发外面这个 div 的 BFC ，就可以阻止这两个 div 的 margin 重叠 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;overflow: hidden;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;blue w100 h100&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom: 20px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;red w200 h200&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 20px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="两栏布局，实现左定宽-右宽自适应"><a href="#两栏布局，实现左定宽-右宽自适应" class="headerlink" title="两栏布局，实现左定宽+右宽自适应"></a>两栏布局，实现左定宽+右宽自适应</h4><blockquote>
<p>普通流体元素 BFC 后，为了和浮动元素不产生任何交集，顺着浮动边缘形成自己的封闭上下文</p>
</blockquote>
<img src="/posts/40707/%E5%8F%B3%E6%B5%AE%E5%8A%A8.png" class="" title="右浮动">

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 300px; background-color: red;&quot;</span>&gt;</span></span><br><span class="line">  &lt;div</span><br><span class="line">    style=&quot;width: 100px; height: 100px; float: left; background-color: blue;&quot;</span><br><span class="line">  &gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;overflow: hidden; background-color: green;&quot;</span>&gt;</span></span><br><span class="line">    我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容我是右边内容</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 给右侧div添加 overflow: hidden即可 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：设置浮动后，<strong>div 会被 float 覆盖，而文本却不会被 float 覆盖</strong>，是因为 <strong>float 当初设计的时候</strong>就是为了<strong>使文本围绕在浮动对象的周围</strong>。</p>
</blockquote>
<p>参考: [<a href="https://juejin.im/post/5909db2fda2f60005d2093db">布局概念] 关于 CSS-BFC 深入理解</a></p>
<h2 id="请解释一下为什么需要清除浮动？清除浮动的方式"><a href="#请解释一下为什么需要清除浮动？清除浮动的方式" class="headerlink" title="请解释一下为什么需要清除浮动？清除浮动的方式"></a>请解释一下为什么需要清除浮动？清除浮动的方式</h2><p>浮动本质是用来做一些文字混排效果的，但是被我们拿来做布局用，则会有很多的问题出现。</p>
<p>由于浮动元素不再占用原文档流的位置，所以它会对后面的元素排版产生影响，为了解决这些问题，此时就需要在该元素中清除浮动。准确地说，并不是清除浮动，而是<strong>清除浮动后造成的影响</strong></p>
<h3 id="本质"><a href="#本质" class="headerlink" title="本质"></a>本质</h3><p>清除浮动主要为了解决父级元素因为子级浮动引起内部高度为 0 的问题。</p>
<h3 id="如何清除"><a href="#如何清除" class="headerlink" title="如何清除"></a>如何清除</h3><p>设置一个 clearfix 类，在出现浮动问题的父元素上添加此类即可：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">clear</span>: both;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">  <span class="attribute">*zoom</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="什么是外边距合并？"><a href="#什么是外边距合并？" class="headerlink" title="什么是外边距合并？"></a>什么是外边距合并？</h2><p>外边距合并指的是，当两个垂直外边距相遇时，它们将形成一个外边距。 合并后的外边距的高度等于两个发生合并的外边距的高度中的较大者。</p>
<blockquote>
<p>当一个元素出现在另一个元素上面时，第一个元素的下外边距与第二个元素的上外边距会发生合并：</p>
</blockquote>
<img src="/posts/40707/%E5%90%88%E5%B9%B6margin.png" class="" title="合并margin">

<blockquote>
<p>当一个元素包含在另一个元素中时（假设没有内边距或边框把外边距分隔开），它们的上和/或下外边距也会发生合并：</p>
</blockquote>
<img src="/posts/40707/%E5%90%88%E5%B9%B6margin2.png" class="" title="合并margin2">

<blockquote>
<p>尽管看上去有些奇怪，但是外边距甚至可以与自身发生合并。</p>
<p>假设有一个空元素，它有外边距，但是</p>
<p>没有边框或填充</p>
<p>。在这种情况下，上外边距与下外边距就碰到了一起，它们会发生合并：</p>
</blockquote>
<img src="/posts/40707/hebing.png" class="" title="hebing">

<blockquote>
<p>如果这个外边距遇到另一个元素的外边距，它还会发生合并：</p>
</blockquote>
<img src="/posts/40707/hebing2.png" class="" title="hebing2">

<p><strong>注释：</strong>只有普通文档流中块框的垂直外边距才会发生外边距合并。<strong>行内框、浮动框或绝对定位</strong>之间的外边距不会合并。</p>
<h2 id="浏览器是怎样解析-CSS-选择器的？"><a href="#浏览器是怎样解析-CSS-选择器的？" class="headerlink" title="浏览器是怎样解析 CSS 选择器的？"></a>浏览器是怎样解析 CSS 选择器的？</h2><p>从右向左的，这样会提高查找选择器所对应的元素的效率</p>
<ol>
<li>样式系统从关键选择器开始匹配，然后左移查找规则选择器的祖先元素。</li>
<li>只要选择器的子树一直在工作，样式系统就会持续左移，直到和规则匹配，或者是因为不匹配而放弃该规则。</li>
</ol>
<h2 id="抽离样式模块怎么写，说出思路，有无实践经验？"><a href="#抽离样式模块怎么写，说出思路，有无实践经验？" class="headerlink" title="抽离样式模块怎么写，说出思路，有无实践经验？"></a>抽离样式模块怎么写，说出思路，有无实践经验？</h2><p>我们按照 CSS 的性质和用途，将 CSS 文件分成 「公共型样式」、「特殊型样式」、「皮肤型样式」，并以此顺序引用（按需求决定是否添加版本号）。</p>
<ol>
<li>公共型样式：包括了以下几个部分：“标签的重置和设置默认值”、“统一调用背景图和清除浮动或其他需统一处理的长样式”、“网站通用布局”、“通用模块和其扩展”、“元件和其扩展”、“功能类样式”、“皮肤类样式”。</li>
<li>特殊型样式：当某个栏目或页面的样式与网站整体差异较大或者维护率较高时，可以独立引用一个样式：“特殊的布局、模块和元件及扩展”、“特殊的功能、颜色和背景”，也可以是某个大型控件或模块的独立样式。</li>
<li>皮肤型样式：如果产品需要换肤功能，那么我们需要将颜色、背景等抽离出来放在这里。</li>
</ol>
<p>参考：<a href="http://nec.netease.com/standard/css-sort.html">CSS 规范 - 分类方法</a></p>
<h2 id="元素竖向的百分比设定是相对于父容器的高度吗？"><a href="#元素竖向的百分比设定是相对于父容器的高度吗？" class="headerlink" title="元素竖向的百分比设定是相对于父容器的高度吗？"></a>元素竖向的百分比设定是相对于父容器的高度吗？</h2><ul>
<li>对于 height 属性来说是的。</li>
<li>对于 margin-top/bottom(padding-top/bottom) 来讲不是，而是相对于容器的宽度计算的</li>
</ul>
<h2 id="什么是响应式设计？响应式设计的基本原理是什么？如何兼容低版本的-IE？"><a href="#什么是响应式设计？响应式设计的基本原理是什么？如何兼容低版本的-IE？" class="headerlink" title="什么是响应式设计？响应式设计的基本原理是什么？如何兼容低版本的 IE？"></a>什么是响应式设计？响应式设计的基本原理是什么？如何兼容低版本的 IE？</h2><p>响应式网站设计（Responsive Web design）是一个网站能够兼容多个终端，而不是为每一个终端做一个特定的版本。<br>基本原理是通过媒体查询检测不同的设备屏幕尺寸做处理。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width:</span> <span class="number">990px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: orange;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* &lt;head&gt;里边 &lt;link rel=”stylesheet” href=”xxx.css” media=”only screen and (max-width:480px)”&gt; */</span></span><br></pre></td></tr></table></figure>

<p>页面头部必须有 meta 声明的 viewport ：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;meta</span><br><span class="line">  name=&quot;viewport&quot;</span><br><span class="line">  content=&quot;width=device-width, initial-scale=1.0, user-scalable=no&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>兼容 ie6-8 方案：使用 respond.js 插件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--[if lte IE 8]&gt;</span></span><br><span class="line"><span class="comment">  &lt;script src=&quot;https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">&lt;![endif]--&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="响应式和自适应设计的区别"><a href="#响应式和自适应设计的区别" class="headerlink" title="响应式和自适应设计的区别"></a>响应式和自适应设计的区别</h2><p>其实 RWD 和 AWD 都是响应式设计，从外观上很难分辨，但他们自己运行机理不同，</p>
<p>RWD 是主动式的响应设计，AWD 是被动式的响应式设计。</p>
<ul>
<li>RWD 不管用户使用的是什么设备都是在服务器把数据推送到浏览器后，脚本或 CSS 自行侦测屏幕大小后执行对应的样式表内容，并且一直通过本地脚本在监听屏幕大小的变化，随时做出样式响应的变化，所以是主动的。</li>
<li>AWD 是用户通过浏览器发送请求后，服务器根据请求中用户设备信息（request headers 的 user-agent）做出判断，调用已经在服务器里准备好的，适应对应设备样式文件+HTML 内容+JS，返回给浏览器以这种方式响应不同设备。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> deviceAgent = request.headers[<span class="string">&#x27;user-agent&#x27;</span>].toLowerCase();</span><br><span class="line"><span class="keyword">var</span> agentID = deviceAgent.match(<span class="regexp">/(iphone|ipod|ipad|android)/</span>);</span><br><span class="line"><span class="keyword">if</span> (agentID) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;手机访问&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;电脑访问&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/40707/rwdawd.png" class="" title="rwdawd">

<h2 id="你对-line-height-是如何理解的？如何单行文本垂直居中？多行文本呢？"><a href="#你对-line-height-是如何理解的？如何单行文本垂直居中？多行文本呢？" class="headerlink" title="你对 line-height 是如何理解的？如何单行文本垂直居中？多行文本呢？"></a>你对 line-height 是如何理解的？如何单行文本垂直居中？多行文本呢？</h2><p>行高是指一行文字的高度，具体说是两行文字间基线的距离。CSS 中起高度作用的是 height 和 line-height ，没有定义 height 属性，最终其表现作用一定是 line-height 。</p>
<h3 id="单行文本垂直居中：（行高-元素高度）"><a href="#单行文本垂直居中：（行高-元素高度）" class="headerlink" title="单行文本垂直居中：（行高 == 元素高度）"></a>单行文本垂直居中：（行高 == 元素高度）</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">height</span>: 40<span class="selector-tag">px</span>;</span><br><span class="line"><span class="selector-tag">line-height</span>: 40<span class="selector-tag">px</span>; <span class="comment">/* 行高==高 */</span></span><br></pre></td></tr></table></figure>

<h3 id="多行文本垂直居中：（父容器-table，子容器-table-cell-vertical-align-middle）"><a href="#多行文本垂直居中：（父容器-table，子容器-table-cell-vertical-align-middle）" class="headerlink" title="多行文本垂直居中：（父容器 table，子容器 table-cell+vertical-align:middle）"></a>多行文本垂直居中：（父容器 table，子容器 table-cell+vertical-align:middle）</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>啊实打实大苏打啊实打实大师大师的啊实打实大苏打<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">div &#123; width: 300px; height: 200px; display: table; background-color: pink; &#125;</span><br><span class="line">span &#123; display: table-cell; vertical-align: middle; &#125;</span><br></pre></td></tr></table></figure>

<h2 id="设置元素浮动后，该元素的-display-值是多少？"><a href="#设置元素浮动后，该元素的-display-值是多少？" class="headerlink" title="设置元素浮动后，该元素的 display 值是多少？"></a>设置元素浮动后，该元素的 display 值是多少？</h2><p>自动变成了 display: block</p>
<h2 id="让页面里的字体变清晰，变细用-CSS-怎么做？"><a href="#让页面里的字体变清晰，变细用-CSS-怎么做？" class="headerlink" title="让页面里的字体变清晰，变细用 CSS 怎么做？"></a>让页面里的字体变清晰，变细用 CSS 怎么做？</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">-webkit-font-smoothing</span>: <span class="selector-tag">antialiased</span>;</span><br></pre></td></tr></table></figure>

<h2 id="overflow-scroll-时不能平滑滚动的问题怎么处理？"><a href="#overflow-scroll-时不能平滑滚动的问题怎么处理？" class="headerlink" title="overflow: scroll 时不能平滑滚动的问题怎么处理？"></a>overflow: scroll 时不能平滑滚动的问题怎么处理？</h2><p>一个 div 使用了 <code>overflow:scroll;</code> ，在移动端可以滚动，但是无法平滑滚动（就像浏览网页那样）</p>
<p>开启滚动硬件加速：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">-webkit-overflow-scrolling</span>: <span class="selector-tag">touch</span>;</span><br></pre></td></tr></table></figure>

<h2 id="什么是-CSS-预处理器-后处理器？"><a href="#什么是-CSS-预处理器-后处理器？" class="headerlink" title="什么是 CSS 预处理器 / 后处理器？"></a>什么是 CSS 预处理器 / 后处理器？</h2><h3 id="CSS-预处理器"><a href="#CSS-预处理器" class="headerlink" title="CSS 预处理器"></a>CSS 预处理器</h3><p>CSS 预处理器定义了一种新的语言，其基本思想是，用一种专门的编程语言，为 CSS 增加了一些编程的特性，将 CSS 作为目标生成文件，然后开发者就只要使用这种语言进行编码工作。通俗的说，CSS 预处理器用一种专门的编程语言，进行 Web 页面样式设计，然后再编译成正常的 CSS 文件</p>
<blockquote>
<p>Sass（SCSS）、LESS</p>
</blockquote>
<h3 id="CSS-后处理器"><a href="#CSS-后处理器" class="headerlink" title="CSS 后处理器"></a>CSS 后处理器</h3><p>CSS 后处理器 是对 CSS 进行处理，并最终生成 CSS 的 预处理器，它属于广义上的 CSS 预处理器。</p>
<p>我们很久以前就在用 CSS 后处理器 了，最典型的例子是 CSS 压缩工具（如 clean-css），只不过以前没单独拿出来说过。还有最近比较火的 Autoprefixer，以 Can I Use 上的 浏览器支持数据 为基础，自动处理兼容性问题。</p>
<blockquote>
<p>Rework、PostCSS</p>
</blockquote>
<p>参考：<a href="https://blog.csdn.net/yushuangyushuang/article/details/79209752">CSS 预处理器和后处理器</a></p>
<h2 id="图片为什么有左右上下间隙-怎么去除："><a href="#图片为什么有左右上下间隙-怎么去除：" class="headerlink" title="图片为什么有左右上下间隙,怎么去除："></a>图片为什么有左右上下间隙,怎么去除：</h2><p>原因：</p>
<ul>
<li>左右：因为 img 是 inline-block 行内元素，行内元素之间有『换行（回车），空格，tab』时会产生左右间隙</li>
<li>上下：行内元素默认与父容器基线对齐，而基线与父容器底部有一定间隙，所以上下图片间有间隙</li>
</ul>
<p>解决办法：</p>
<ul>
<li>移除上下间隙：<ul>
<li>img 本身设置 display: block;</li>
<li>父元素设置 font-size: 0; （基线与字体大小有关，字体为零，基线间就没距离了）</li>
<li>img 本身设置 vertical-align: bottom;（让 inline-block 的 img 与每行的底部对齐）</li>
</ul>
</li>
<li>移除左右间距：<ul>
<li>行内元素间不要有换行，连成一行写消除间隙</li>
<li>第一行结尾写上 <code>&lt;!-- ，第二行开头跟上 --&gt;</code> 。即利用注释消除间距</li>
<li>父元素 font-size 设置 0</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-Event Loop、计时器、nextTick</title>
    <url>/posts/61492/</url>
    <content><![CDATA[<p>这是一篇转载文章，源地址是方应杭在掘金上发表的一篇译文：<a href="https://juejin.im/post/5ab7677f6fb9a028d56711d0">Event Loop、计时器、nextTick</a></p>
<p>原文：<a href="https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/">https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/</a></p>
<p>以下是译文：</p>
<h2 id="什么是事件循环（Event-Loop，注意空格）"><a href="#什么是事件循环（Event-Loop，注意空格）" class="headerlink" title="什么是事件循环（Event Loop，注意空格）"></a>什么是事件循环（Event Loop，注意空格）</h2><p>JavaScript 是单线程的，有了 event loop 的加持，Node.js 才可以非阻塞地执行 I/O 操作，把这些操作尽量转移给操作系统来执行。</p>
<p>我们知道大部分现代操作系统都是多线程的，这些操作系统可以在后台执行多个操作。当某个操作结束了，操作系统就会通知 Node.js，然后 Node.js 就（可能）会把对应的回调函数添加到 poll（轮询）队列，最终这些回调函数会被执行。下文中我们会阐述其细节。</p>
<a id="more"></a>

<h2 id="Event-Loop-详解"><a href="#Event-Loop-详解" class="headerlink" title="Event Loop 详解"></a>Event Loop 详解</h2><p>当 Node.js 启动时，会做这几件事</p>
<ol>
<li>初始化 event loop</li>
<li>开始执行脚本（或者进入 REPL，本文不涉及 REPL）。这些脚本有可能会调用一些异步 API、设定计时器或者调用 process.nextTick()</li>
<li>开始处理 event loop</li>
</ol>
<p>如何处理 event loop 呢？下图给出了一个简单的概览：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">   ┌───────────────────────┐</span><br><span class="line">┌─&gt;│        timers         │</span><br><span class="line">│  └──────────┬────────────┘</span><br><span class="line">│  ┌──────────┴────────────┐</span><br><span class="line">│  │     I&#x2F;O callbacks     │</span><br><span class="line">│  └──────────┬────────────┘</span><br><span class="line">│  ┌──────────┴────────────┐</span><br><span class="line">│  │     idle, prepare     │</span><br><span class="line">│  └──────────┬────────────┘      ┌───────────────┐</span><br><span class="line">│  ┌──────────┴────────────┐      │   incoming:   │</span><br><span class="line">│  │         poll          │&lt;─────┤  connections, │</span><br><span class="line">│  └──────────┬────────────┘      │   data, etc.  │</span><br><span class="line">│  ┌──────────┴────────────┐      └───────────────┘</span><br><span class="line">│  │        check          │</span><br><span class="line">│  └──────────┬────────────┘</span><br><span class="line">│  ┌──────────┴────────────┐</span><br><span class="line">└──┤    close callbacks    │</span><br><span class="line">   └───────────────────────┘</span><br></pre></td></tr></table></figure>

<p>其中每个方框都是 event loop 中的一个阶段。</p>
<p>每个阶段都有一个「先入先出队列」，这个队列存有要执行的回调函数（译注：存的是函数地址）。不过每个阶段都有其特有的使命。一般来说，当 event loop 达到某个阶段时，会在这个阶段进行一些特殊的操作，然后执行这个阶段的队列里的所有回调。 什么时候停止执行这些回调呢？下列两种情况之一会停止：</p>
<ol>
<li>队列的操作全被执行完了</li>
<li>执行的回调数目到达指定的最大值 然后，event loop 进入下一个阶段，然后再下一个阶段。</li>
</ol>
<p>一方面，上面这些操作都有可能添加计时器；另一方面，操作系统会向 poll 队列中添加新的事件，当 poll 队列中的事件被处理时可能会有新的 poll 事件进入 poll 队列。结果，耗时较长的回调函数可以让 event loop 在 poll 阶段停留很久，久到错过了计时器的触发时机。你可以在下文的 timers 章节和 poll 章节详细了解这其中的细节。</p>
<p>注意，Windows 的实现和 Unix/Linux 的实现稍有不同，不过对本文内容影响不大。本文囊括了 event loop 最重要的部分，不同平台可能有七个或八个阶段，但是上面的几个阶段是我们真正关心的阶段，而且是 Node.js 真正用到的阶段。</p>
<h2 id="各阶段概览"><a href="#各阶段概览" class="headerlink" title="各阶段概览"></a>各阶段概览</h2><ul>
<li>timers 阶段：这个阶段执行 setTimeout 和 setInterval 的回调函数。</li>
<li>I/O callbacks 阶段：不在 timers 阶段、close callbacks 阶段和 check 阶段这三个阶段执行的回调，都由此阶段负责，这几乎包含了所有回调函数。</li>
<li>idle, prepare 阶段（译注：看起来是两个阶段，不过这不重要）：event loop 内部使用的阶段（译注：我们不用关心这个阶段）</li>
<li>poll 阶段：获取新的 I/O 事件。在某些场景下 Node.js 会阻塞在这个阶段。</li>
<li>check 阶段：执行 setImmediate() 的回调函数。</li>
<li>close callbacks 阶段：执行关闭事件的回调函数，如 socket.on(‘close’, fn) 里的 fn。</li>
</ul>
<p>一个 Node.js 程序结束时，Node.js 会检查 event loop 是否在等待异步 I/O 操作结束，是否在等待计时器触发，如果没有，就会关掉 event loop。</p>
<h2 id="各阶段详解"><a href="#各阶段详解" class="headerlink" title="各阶段详解"></a>各阶段详解</h2><h3 id="timers-阶段"><a href="#timers-阶段" class="headerlink" title="timers 阶段"></a>timers 阶段</h3><p>计时器实际上是在指定多久以后可以执行某个回调函数，而不是指定某个函数的确切执行时间。当指定的时间达到后，计时器的回调函数会尽早被执行。如果操作系统很忙，或者 Node.js 正在执行一个耗时的函数，那么计时器的回调函数就会被推迟执行。</p>
<p>注意，从原理上来说，poll 阶段能控制计时器的回调函数什么时候被执行。</p>
<p>举例来说，你设置了一个计时器在 100 毫秒后执行，然后你的脚本用了 95 毫秒来异步读取了一个文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">someAsyncOperation</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 假设读取这个文件一共花费 95 毫秒</span></span><br><span class="line">  fs.readFile(<span class="string">&#x27;/path/to/file&#x27;</span>, callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> timeoutScheduled = <span class="built_in">Date</span>.now();</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> delay = <span class="built_in">Date</span>.now() - timeoutScheduled;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;delay&#125;</span>毫秒后执行了 setTimeout 的回调`</span>);</span><br><span class="line">&#125;, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行一个耗时 95 毫秒的异步操作</span></span><br><span class="line">someAsyncOperation(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> startCallback = <span class="built_in">Date</span>.now();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行一个耗时 10 毫秒的同步操作</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">Date</span>.now() - startCallback &lt; <span class="number">10</span>) &#123;</span><br><span class="line">    <span class="comment">// 什么也不做</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当 event loop 进入 poll 阶段，发现 poll 队列为空（因为文件还没读完），event loop 检查了一下最近的计时器，大概还有 100 毫秒时间，于是 event loop 决定这段时间就停在 poll 阶段。在 poll 阶段停了 95 毫秒之后，fs.readFile 操作完成，一个耗时 10 毫秒的回调函数被系统放入 poll 队列，于是 event loop 执行了这个回调函数。执行完毕后，poll 队列为空，于是 event loop 去看了一眼最近的计时器（译注：event loop 发现卧槽，已经超时 95 + 10 - 100 = 5 毫秒了），于是经由 check 阶段、close callbacks 阶段绕回到 timers 阶段，执行 timers 队列里的那个回调函数。这个例子中，100 毫秒的计时器实际上是在 105 毫秒后才执行的。</p>
<p>注意：为了防止 poll 阶段占用了 event loop 的所有时间，libuv（Node.js 用来实现 event loop 和所有异步行为的 C 语言写成的库）对 poll 阶段的最长停留时间做出了限制，具体时间因操作系统而异。</p>
<h3 id="I-O-callbacks-阶段"><a href="#I-O-callbacks-阶段" class="headerlink" title="I/O callbacks 阶段"></a>I/O callbacks 阶段</h3><p>这个阶段会执行一些系统操作的回调函数，比如 TCP 报错，如果一个 TCP socket 开始连接时出现了 ECONNREFUSED 错误，一些 *nix 系统就会（向 Node.js）通知这个错误。这个通知就会被放入 I/O callbacks 队列。</p>
<h3 id="poll-阶段（轮询阶段）"><a href="#poll-阶段（轮询阶段）" class="headerlink" title="poll 阶段（轮询阶段）"></a>poll 阶段（轮询阶段）</h3><p>poll 阶段有两个功能：</p>
<ol>
<li>如果发现计时器的时间到了，就绕回到 timers 阶段执行计时器的回调。</li>
<li>然后再，执行 poll 队列里的回调。</li>
</ol>
<p>当 event loop 进入 poll 阶段，如果发现没有计时器，就会：</p>
<ol>
<li>如果 poll 队列不是空的，event loop 就会依次执行队列里的回调函数，直到队列被清空或者到达 poll 阶段的时间上限。</li>
<li>如果 poll 队列是空的，就会：<ol>
<li>如果有 setImmediate() 任务，event loop 就结束 poll 阶段去往 check 阶段。</li>
<li>如果没有 setImmediate() 任务，event loop 就会等待新的回调函数进入 poll 队列，并立即执行它。</li>
</ol>
</li>
</ol>
<p>一旦 poll 队列为空，event loop 就会检查计时器有没有到期，如果有计时器到期了，event loop 就会回到 timers 阶段执行计时器的回调。</p>
<h3 id="check-阶段"><a href="#check-阶段" class="headerlink" title="check 阶段"></a>check 阶段</h3><p>这个阶段允许开发者在 poll 阶段结束后立即执行一些函数。如果 poll 阶段空闲了，同时存在 setImmediate() 任务，event loop 就会进入 check 阶段。</p>
<p>setImmediate() 实际上是一种特殊的计时器，有自己特有的阶段。它是通过 libuv 里一个能将回调安排在 poll 阶段之后执行的 API 实现的。</p>
<p>一般来说，当代码执行后，event loop 最终会达到 poll 阶段，等待新的连接、新的请求等。但是如果一个回调是由 setImmediate() 发出的，同时 poll 阶段空闲下来了，event loop 就会结束 poll 阶段进入 check 阶段，不再等待新的 poll 事件。</p>
<p>（译注：感觉同样的话说了三遍）</p>
<h3 id="close-callbacks-阶段"><a href="#close-callbacks-阶段" class="headerlink" title="close callbacks 阶段"></a>close callbacks 阶段</h3><p>如果一个 socket 或者 handle 被突然关闭（比如 socket.destroy()），那么就会有一个 close 事件进入这个阶段。否则（译注：我没看到这个否则在否定什么，是在否定「突然」吗？），这个 close 事件就会进入 process.nextTick()。</p>
<h2 id="setImmediate-vs-setTimeout"><a href="#setImmediate-vs-setTimeout" class="headerlink" title="setImmediate() vs setTimeout()"></a>setImmediate() vs setTimeout()</h2><p>setImmediate 和 setTimeout 很相似，但是其回调函数的调用时机却不一样。</p>
<p>setImmediate() 的作用是在当前 poll 阶段结束后调用一个函数。 setTimeout() 的作用是在一段时间后调用一个函数。 这两者的回调的执行顺序取决于 setTimeout 和 setImmediate 被调用时的环境。</p>
<p>如果 setTimeout 和 setImmediate 都是在主模块（main module）中被调用的，那么回调的执行顺序取决于当前进程的性能，这个性能受其他应用程序进程的影响。</p>
<p>举例来说，如果在主模块中运行下面的脚本，那么两个回调的执行顺序是无法判断的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// timeout_vs_immediate.js</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;timeout&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">setImmediate(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;immediate&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行结果如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$ node timeout_vs_immediate.js</span><br><span class="line">timeout</span><br><span class="line">immediate</span><br><span class="line"></span><br><span class="line">$ node timeout_vs_immediate.js</span><br><span class="line">immediate</span><br><span class="line">timeout</span><br></pre></td></tr></table></figure>

<p>但是，如果把上面代码放到 I/O 操作的回调里，setImmediate 的回调就总是优先于 setTimeout 的回调：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// timeout_vs_immediate.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">fs.readFile(__filename, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;timeout&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  setImmediate(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;immediate&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行结果如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$ node timeout_vs_immediate.js</span><br><span class="line">immediate</span><br><span class="line">timeout</span><br><span class="line"></span><br><span class="line">$ node timeout_vs_immediate.js</span><br><span class="line">immediate</span><br><span class="line">timeout</span><br></pre></td></tr></table></figure>

<p>setImmediate 的主要优势就是，如果在 I/O 操作的回调里，setImmediate 的回调总是比 setTimeout 的回调先执行。（译者注：怎么总是把一个道理翻来覆去地说）</p>
<h2 id="process-nextTick"><a href="#process-nextTick" class="headerlink" title="process.nextTick()"></a>process.nextTick()</h2><p>你可能发现 process.nextTick() 这个重要的异步 API 没有出现在任何一个阶段里，那是因为从技术上来讲 process.nextTick() 并不是 event loop 的一部分。实际上，不管 event loop 当前处于哪个阶段，nextTick 队列都是在当前阶段后就被执行了。</p>
<p>回过头来看我们的阶段图，你在任何一个阶段调用 process.nextTick(回调)，回调都会在当前阶段继续运行前被调用。这种行为有的时候会造成不好的结果，因为你可以递归地调用 process.nextTick()，这样 event loop 就会一直停在当前阶段不走……无法进入 poll 阶段。</p>
<p>为什么 Node.js 要这样设计 process.nextTick 呢？</p>
<p>因为有些异步 API 需要保证一致性，即使可以同步完成，也要保证异步操作的顺序，看下面代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">apiCall</span>(<span class="params">arg, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> arg !== <span class="string">&#x27;string&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> process.nextTick(</span><br><span class="line">      callback,</span><br><span class="line">      <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;argument should be string&#x27;</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码检查了参数的类型，如果类型不是 string，就会将 error 传递给 callback。</p>
<p>这段代码保证 apiCall 调用之后的同步代码能在 callback 之前运行。用于用到了 process.nextTick()，所以 callback 会在 event loop 进入下一个阶段前执行。为了做到这一点，JS 的调用栈可以先 unwind 再执行 nextTick 的回调，这样无论你递归调用多少次 process.nextTick() 都不会造成调用栈溢出（V8 里对应 RangeError: Maximum call stack size exceeded）。</p>
<p>如果不这样设计，会造成一些潜在的问题，比如下面的代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> bar;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是一个异步 API，但是却同步地调用了 callback</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">someAsyncApiCall</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  callback();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//`someAsyncApiCall` 在执行过程中就调用了回调</span></span><br><span class="line">someAsyncApiCall(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 此时 bar 还没有被赋值为 1</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;bar&#x27;</span>, bar); <span class="comment">// undefined</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">bar = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>开发者虽然把 someAsyncApiCall 命名得像一个异步函数，但是实际上这个函数是同步执行的。当 someAsyncApiCall 被调用时，回调也在同一个 event loop 阶段被调用了。结果回调中就无法得到 bar 的值。因为赋值语句还没被执行。</p>
<p>如果把回调放在 process.nextTick() 中执行，后面的赋值语句就可以先执行了。而且 process.nextTick() 的回调会在 eventLoop 进入下一个阶段前调用。（译注：又是把一个道理翻来覆去地讲）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> bar;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">someAsyncApiCall</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  process.nextTick(callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">someAsyncApiCall(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;bar&#x27;</span>, bar); <span class="comment">// 1</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">bar = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>一个更符合现实的例子是这样的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> server = net.createServer(<span class="function">() =&gt;</span> &#123;&#125;).listen(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;listening&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>.listen(8080) 这句话是同步执行的。问题在于 listening 回调无法被触发，因为 listening 的监听代码在 .listen(8080) 的后面。</p>
<p>为了解决这个问题，.listen() 函数可以使用 process.nextTick() 来执行 listening 事件的回调。</p>
<h2 id="process-nextTick-vs-setImmediate"><a href="#process-nextTick-vs-setImmediate" class="headerlink" title="process.nextTick() vs setImmediate()"></a>process.nextTick() vs setImmediate()</h2><p>这两个函数功能很像，而且名字也很令人疑惑。</p>
<p>process.nextTick() 的回调会在当前 event loop 阶段「立即」执行。 setImmediate() 的回调会在后续的 event loop 周期（tick）执行。</p>
<p>（译注：看起来名字叫反了）</p>
<p>二者的名字应该互换才对。process.nextTick() 比 setImmediate() 更 immediate（立即）一些。</p>
<p>这是一个历史遗留问题，而且为了保证向后兼容性，也不太可能得到改善。所以就算这两个名字听起来让人很疑惑，也不会在未来有任何变化。</p>
<p>我们推荐开发者在任何情况下都使用 setImmediate()，因为它的兼容性更好，而且它更容易理解。</p>
<h2 id="什么时候用-process-nextTick-？"><a href="#什么时候用-process-nextTick-？" class="headerlink" title="什么时候用 process.nextTick()？"></a>什么时候用 process.nextTick()？</h2><p>There are two main reasons: 使用的理由有两个：</p>
<ol>
<li>让开发者处理错误、清除无用的资源，或者在 event loop 当前阶段结束前尝试重新请求资源</li>
<li>有时候有必要让一个回调在调用栈 unwind 之后，event loop 进入下阶段之前执行</li>
</ol>
<p>为了让代码更合理，我们可能会写这样的代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> server = net.createServer();</span><br><span class="line">server.on(<span class="string">&#x27;connection&#x27;</span>, <span class="function"><span class="params">conn</span> =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8080</span>);</span><br><span class="line">server.on(<span class="string">&#x27;listening&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>假设 listen() 在 event loop 一启动的时候就执行了，而 listening 事件的回调被放在了 setImmediate() 里，listen 动作是立即发生的，如果想要 event loop 执行 listening 回调，就必须先经过 poll 阶段，当时 poll 阶段有可能会停留，以等待连接，这样一来就有可能出现 connect 事件的回调比 listening 事件的回调先执行。（译注：这显然不合理，所以我们需要用 process.nextTick）</p>
<p>再举一个例子，一个类继承了 EventEmitter，而且想在实例化的时候触发一个事件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyEmitter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  EventEmitter.call(<span class="built_in">this</span>);</span><br><span class="line">  <span class="built_in">this</span>.emit(<span class="string">&#x27;event&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">util.inherits(MyEmitter, EventEmitter);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myEmitter = <span class="keyword">new</span> MyEmitter();</span><br><span class="line">myEmitter.on(<span class="string">&#x27;event&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;an event occurred!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>你不能直接在构造函数里执行 this.emit(‘event’)，因为这样的话后面的回调就永远无法执行。把 this.emit(‘event’) 放在 process.nextTick() 里，后面的回调就可以执行，这才是我们预期的行为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyEmitter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  EventEmitter.call(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// use nextTick to emit the event once a handler is assigned</span></span><br><span class="line">  process.nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.emit(<span class="string">&#x27;event&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">util.inherits(MyEmitter, EventEmitter);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myEmitter = <span class="keyword">new</span> MyEmitter();</span><br><span class="line">myEmitter.on(<span class="string">&#x27;event&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;an event occurred!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>后端</category>
        <category>Node</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>Node</tag>
        <tag>EventLoop</tag>
      </tags>
  </entry>
  <entry>
    <title>JS面试题（面试系列）</title>
    <url>/posts/24235/</url>
    <content><![CDATA[<h2 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h2><h3 id="let-const"><a href="#let-const" class="headerlink" title="let / const"></a>let / const</h3><h4 id="全局作用域中，用-const-和-let-声明的变量不在-window-上，那到底在哪里？如何去获取？"><a href="#全局作用域中，用-const-和-let-声明的变量不在-window-上，那到底在哪里？如何去获取？" class="headerlink" title="全局作用域中，用 const 和 let 声明的变量不在 window 上，那到底在哪里？如何去获取？"></a>全局作用域中，用 const 和 let 声明的变量不在 window 上，那到底在哪里？如何去获取？</h4><p>ES6 规定，var 命令和 function 命令声明的全局变量，依旧是顶层对象的属性，但 let、const、class 命令声明的全局变量，不属于顶层对象的属性。只在一个块级作用域（Script）中，获取时不加 <code>window/global</code> 就好：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> aa = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> bb = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(aa); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(bb); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>答案链接：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/30">关于 const 和 let 声明的变量不在 window 上</a></p>
<h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><h4 id="箭头函数与普通函数（function）的区别是什么？构造函数（function）可以使用-new-生成实例，那么箭头函数可以吗？为什么？"><a href="#箭头函数与普通函数（function）的区别是什么？构造函数（function）可以使用-new-生成实例，那么箭头函数可以吗？为什么？" class="headerlink" title="箭头函数与普通函数（function）的区别是什么？构造函数（function）可以使用 new 生成实例，那么箭头函数可以吗？为什么？"></a>箭头函数与普通函数（function）的区别是什么？构造函数（function）可以使用 new 生成实例，那么箭头函数可以吗？为什么？</h4><p>箭头函数是普通函数的简写，可以更优雅的定义一个函数，和普通函数相比，有以下几点差异：</p>
<p>1、函数体内的 this 对象，就是定义时所在的对象，而不是使用时所在的对象。</p>
<p>2、不可以使用 arguments 对象，该对象在函数体内不存在。如果要用，可以用 rest 参数代替。</p>
<p>3、不可以使用 yield 命令，因此箭头函数不能用作 Generator 函数。</p>
<p>4、不可以使用 new 命令，因为：</p>
<ul>
<li>没有自己的 this，无法调用 call，apply。</li>
<li>没有 prototype 属性 ，而 new 命令在执行时需要将构造函数的 prototype 赋值给新的对象的 <strong>proto</strong></li>
</ul>
<p>new 过程大致是这样的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newFunc</span>(<span class="params">father, ...rest</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = &#123;&#125;;</span><br><span class="line">  result.__proto__ = father.prototype;</span><br><span class="line">  <span class="keyword">var</span> result2 = father.apply(result, rest);</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    (<span class="keyword">typeof</span> result2 === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> result2 === <span class="string">&#x27;function&#x27;</span>) &amp;&amp;</span><br><span class="line">    result2 !== <span class="literal">null</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> result2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>题目来源：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/101">Daily-Interview-Question 第 58 题</a></p>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><h4 id="10-个-Ajax-同时发起请求，全部返回展示结果，并且至多允许三次失败，说出设计思路"><a href="#10-个-Ajax-同时发起请求，全部返回展示结果，并且至多允许三次失败，说出设计思路" class="headerlink" title="10 个 Ajax 同时发起请求，全部返回展示结果，并且至多允许三次失败，说出设计思路"></a>10 个 Ajax 同时发起请求，全部返回展示结果，并且至多允许三次失败，说出设计思路</h4><p>这个问题相信很多人会第一时间想到 <code>Promise.all</code> ，但是这个函数有一个局限在于如果失败一次就返回了，直接这样实现会有点问题，需要变通下。以下是两种实现思路</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 以下是不完整代码，着重于思路 非 Promise 写法</span></span><br><span class="line"><span class="keyword">let</span> successCount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> errorCount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> datas = [];</span><br><span class="line">ajax(url, <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (success) &#123;</span><br><span class="line">    success++;</span><br><span class="line">    <span class="keyword">if</span> (success + errorCount === <span class="number">10</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(datas);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      datas.push(res.data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    errorCount++;</span><br><span class="line">    <span class="keyword">if</span> (errorCount &gt; <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="comment">// 失败次数大于3次就应该报错了</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">&#x27;失败三次&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Promise 写法</span></span><br><span class="line"><span class="keyword">let</span> errorCount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (success) &#123;</span><br><span class="line">    resolve(res.data);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    errorCount++;</span><br><span class="line">    <span class="keyword">if</span> (errorCount &gt; <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="comment">// 失败次数大于3次就应该报错了</span></span><br><span class="line">      reject(error);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resolve(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Promise</span>.all([p]).then(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="ES6-中，promise-能实现异步的原理是什么？我-new-一个-promise-然后对这个-promise-实例使用-typeof，结果是什么？promise-实例接收的参数是一个函数，函数接收两个参数一个-resolve-一个-reject-为什么-resolve-后可以实现继续执行后续代码？（TODO）"><a href="#ES6-中，promise-能实现异步的原理是什么？我-new-一个-promise-然后对这个-promise-实例使用-typeof，结果是什么？promise-实例接收的参数是一个函数，函数接收两个参数一个-resolve-一个-reject-为什么-resolve-后可以实现继续执行后续代码？（TODO）" class="headerlink" title="ES6 中，promise 能实现异步的原理是什么？我 new 一个 promise,然后对这个 promise 实例使用 typeof，结果是什么？promise 实例接收的参数是一个函数，函数接收两个参数一个 resolve,一个 reject,为什么 resolve 后可以实现继续执行后续代码？（TODO）"></a>ES6 中，promise 能实现异步的原理是什么？我 new 一个 promise,然后对这个 promise 实例使用 typeof，结果是什么？promise 实例接收的参数是一个函数，函数接收两个参数一个 resolve,一个 reject,为什么 resolve 后可以实现继续执行后续代码？（TODO）</h4><p>待续…</p>
<h2 id="面向对象相关"><a href="#面向对象相关" class="headerlink" title="面向对象相关"></a>面向对象相关</h2><h3 id="JS-是一门面向对象的语言，说说面向对象语言的三大特征？"><a href="#JS-是一门面向对象的语言，说说面向对象语言的三大特征？" class="headerlink" title="JS 是一门面向对象的语言，说说面向对象语言的三大特征？"></a>JS 是一门面向对象的语言，说说面向对象语言的三大特征？</h3><p>封装、继承、多态</p>
<h3 id="说说你是如何理解-JS-中封装、继承这两个特点的？"><a href="#说说你是如何理解-JS-中封装、继承这两个特点的？" class="headerlink" title="说说你是如何理解 JS 中封装、继承这两个特点的？"></a>说说你是如何理解 JS 中封装、继承这两个特点的？</h3><p>封装指的是<strong>隐藏逻辑实现过程</strong>，只对外<strong>暴露属性和方法</strong>，使用者只需要知道如何使用即可，而不需要关心内部如何实现的，目的在于简化实现过程，做到<strong>多处复用</strong>，<strong>提高开发效率</strong>，当需要维护的时候，业务逻辑和工具功能是分开的，降低迭代成本。</p>
<p>继承指的是建立一个对象与另一个对象之间的父子关系，使得子对象可以拥有父级对象的属性和方法。继承的目的在于<strong>实现功能共享</strong>，通过“借用”父对象的特性，从而<strong>避免重复写功能模块</strong>，<strong>避免多余内存空间的占用</strong>。</p>
<h3 id="声明一个函数-fn-对其使用-typeof-结果返回什么？然后我给-fn-添加一个属性，请问会报错吗？为什么？"><a href="#声明一个函数-fn-对其使用-typeof-结果返回什么？然后我给-fn-添加一个属性，请问会报错吗？为什么？" class="headerlink" title="声明一个函数 fn,对其使用 typeof,结果返回什么？然后我给 fn 添加一个属性，请问会报错吗？为什么？"></a>声明一个函数 fn,对其使用 typeof,结果返回什么？然后我给 fn 添加一个属性，请问会报错吗？为什么？</h3><p>结果返回是 function 字符串。添加属性不会报错，因为在 js 中，函数并不是真正的函数， function 本身是一个 object 对象，而对象是可以添加属性和方法的，所以不会报错。</p>
<h3 id="定义一个字符串，对这个字符串使用-typeof，结果返回什么？既然返回结果是-string，而属性和方法是对象才有的，那为什么会在我定义的字符串上可以使用-split，join-，length-等方法和属性？"><a href="#定义一个字符串，对这个字符串使用-typeof，结果返回什么？既然返回结果是-string，而属性和方法是对象才有的，那为什么会在我定义的字符串上可以使用-split，join-，length-等方法和属性？" class="headerlink" title="定义一个字符串，对这个字符串使用 typeof，结果返回什么？既然返回结果是 string，而属性和方法是对象才有的，那为什么会在我定义的字符串上可以使用 split，join()，length 等方法和属性？"></a>定义一个字符串，对这个字符串使用 typeof，结果返回什么？既然返回结果是 string，而属性和方法是对象才有的，那为什么会在我定义的字符串上可以使用 split，join()，length 等方法和属性？</h3><p>字符串形式的 string 。</p>
<p>所有的字符串都是大写字母开头的 String 对象的实例，当我们对字符串使用方法和属性时，其实字符串本身并没有对应的方法，这个时候，JavaScript 会<strong>沿着原型链往上寻找</strong>，最终在对象 String 上找到了对应的方法和属性，而这个过程对于开发者是无感的，所以看上去像是调用了字符串本身的方法。</p>
<h3 id="new-一个构造函数，如果函数返回-return-、-return-null-，-return-1-，-return-true-会发生什么情况？"><a href="#new-一个构造函数，如果函数返回-return-、-return-null-，-return-1-，-return-true-会发生什么情况？" class="headerlink" title="new 一个构造函数，如果函数返回 return {} 、 return null ， return 1 ， return true 会发生什么情况？"></a>new 一个构造函数，如果函数返回 <code>return &#123;&#125;</code> 、 <code>return null</code> ， <code>return 1</code> ， <code>return true</code> 会发生什么情况？</h3><p>如果函数返回一个对象，那么 new 这个函数调用返回这个函数的返回对象，否则返回 new 创建的新对象</p>
<h3 id="如果一个构造函数，bind-了一个对象，用这个构造函数创建出的实例会继承这个对象的属性吗？为什么？"><a href="#如果一个构造函数，bind-了一个对象，用这个构造函数创建出的实例会继承这个对象的属性吗？为什么？" class="headerlink" title="如果一个构造函数，bind 了一个对象，用这个构造函数创建出的实例会继承这个对象的属性吗？为什么？"></a>如果一个构造函数，bind 了一个对象，用这个构造函数创建出的实例会继承这个对象的属性吗？为什么？</h3><p>不会继承，因为根据 this 绑定四大规则，new 绑定的优先级高于 bind 显示绑定，通过 new 进行构造函数调用时，会创建一个新对象，这个新对象会代替 bind 的对象绑定，作为此函数的 this，并且在此函数没有返回对象的情况下，返回这个新建的对象</p>
<h2 id="JS-垃圾回收机制"><a href="#JS-垃圾回收机制" class="headerlink" title="JS 垃圾回收机制"></a>JS 垃圾回收机制</h2><h3 id="谈谈垃圾回收机制的方式及内存管理？"><a href="#谈谈垃圾回收机制的方式及内存管理？" class="headerlink" title="谈谈垃圾回收机制的方式及内存管理？"></a>谈谈垃圾回收机制的方式及内存管理？</h3><p><strong>题目及答案来源：</strong> <a href="https://juejin.im/post/5ce4171ff265da1bd04eb4f3#heading-5">2019 前端面试 | “HTML + CSS + JS”专题</a> JavaScript 基础部分，编号为 [js_11]</p>
<p><strong>一、垃圾回收机制——GC</strong></p>
<p>Javascript 具有自动垃圾回收机制（GC：Garbage Collecation），也就是说，执行环境会负责管理代码执行过程中使用的内存。</p>
<p>原理：垃圾收集器会定期（周期性）找出那些不在继续使用的变量，然后释放其内存。</p>
<p>通常情况下有两种实现方式：</p>
<ul>
<li>标记清除</li>
<li>引用计数</li>
</ul>
<p><strong>标记清除</strong>： js 中最常用的垃圾回收方式就是标记清除。</p>
<p>当变量进入环境时，例如，在函数中声明一个变量，就将这个变量标记为“进入环境”。从逻辑上讲，永远不能释放进入环境的变量所占用的内存，因为只要执行流进入相应的环境，就可能会用到它们。而当变量离开环境时，则将其标记为“离开环境”。</p>
<p><strong>引用计数</strong>的含义是跟踪记录每个值被引用的次数。</p>
<p>当声明了一个变量并将一个引用类型值赋给该变量时，则这个值的引用次数就是 1。如果同一个值又被赋给另一个变量，则该值的引用次数加 1。相反，如果包含对这个值引用的变量又取得了另外一个值，则这个值的引用次数减 1。当这个值的引用次数变成 0 时，则说明没有办法再访问这个值了，因而就可以将其占用的内存空间回收回来。这样，当垃圾回收器下次再运行时，它就会释放那些引用次数为 0 的值所占用的内存。</p>
<p><strong>二、内存管理</strong></p>
<ol>
<li><p>Javascript 引擎基础 GC 方案是</p>
<p>（simple GC）：mark and sweep（标记清除），即：</p>
<p>1）遍历所有可访问的对象；</p>
<p>2）回收已不可访问的对象。</p>
</li>
<li><p>GC 的缺陷</p>
<p>和其他语言一样，JavaScript 的 GC 策略也无法避免一个问题：GC 时，停止响应其他操作，这是为了安全考虑。而 Javascript 的 GC 在 100ms 甚至以上，对一般的应用还好，但对于 JS 游戏，动画对连贯性要求比较高的应用，就麻烦了。这就是新引擎需要优化的点：避免 GC 造成的长时间停止响应。</p>
</li>
<li><p>GC 优化策略</p>
<ul>
<li><p>1）分代回收（Generation GC）</p>
<p>这个和 Java 回收策略思想是一致的。目的是通过区分“临时”与“持久”对象；多回收“临时对象”区（young generation），少回收“持久对象”区（tenured generation），减少每次需遍历的对象，从而减少每次 GC 的耗时。</p>
</li>
<li><p>2）增量 GC</p>
<p>这个方案的思想很简单，就是“每次处理一点，下次再处理一点”，如此类推。</p>
</li>
</ul>
</li>
</ol>
<p><strong>更多阅读：</strong></p>
<ul>
<li><a href="https://evestorm.github.io/posts/20229/">JS 垃圾回收机制</a></li>
</ul>
<h3 id="哪些操作会造成内存泄漏？"><a href="#哪些操作会造成内存泄漏？" class="headerlink" title="哪些操作会造成内存泄漏？"></a>哪些操作会造成内存泄漏？</h3><h4 id="意外的全局变量引起的内存泄漏"><a href="#意外的全局变量引起的内存泄漏" class="headerlink" title="意外的全局变量引起的内存泄漏"></a>意外的全局变量引起的内存泄漏</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">  bar = <span class="string">&#x27;全局变量&#x27;</span>; <span class="comment">// 没有声明变量 实际上是全局变量=&gt;window.bar</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原因：全局变量，不会被回收。</p>
<p>为什么不能泄漏到全局？平时不都会定义一些全局变量么：<br>全局变量根据定义无法被垃圾回收机制收集。需要特别注意用于临时存储和处理大量信息的全局变量。如果必须使用全局变量来存储数据，请确保将其指定为 null 或在完成后重新分配它。</p>
<p>解决：使用严格模式避免，函数内使用 var 定义，块内使用 let、const。</p>
<h4 id="闭包引起的内存泄漏"><a href="#闭包引起的内存泄漏" class="headerlink" title="闭包引起的内存泄漏"></a>闭包引起的内存泄漏</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindEvent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> obj = <span class="built_in">document</span>.createElement(<span class="string">&#x27;XXX&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> unused = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(obj, <span class="string">&#x27;闭包内引用obj obj不会被释放&#x27;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// obj = null;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原因：闭包可以维持函数内局部变量，使其得不到释放，造成内存泄漏。</p>
<p>解决：将事件处理函数定义在外部，解除闭包，或者在定义事件处理函数的外部函数中，删除对 dom 的引用。例如上述案例，手动解除引用 <code>obj = null</code><br>。</p>
<h4 id="被遗忘的定时器和回调函数"><a href="#被遗忘的定时器和回调函数" class="headerlink" title="被遗忘的定时器和回调函数"></a>被遗忘的定时器和回调函数</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> someResource = getData();</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> node = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;Node&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(node) &#123;</span><br><span class="line">        node.innerHTML = <span class="built_in">JSON</span>.stringify(someResource));</span><br><span class="line">        <span class="comment">// 定时器也没有清除</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// node、someResource 存储了大量数据 无法回收</span></span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>原因：当<strong>不需要</strong> <code>setInterval</code> 或者 <code>setTimeout</code> 时，<strong>定时器没有被 clear</strong>，定时器的<strong>回调函数以及内部依赖的变量都不能被回收</strong>，造成内存泄漏。</p>
<p>解决：在定时器完成工作的时候，手动清除定时器</p>
<h4 id="没有清理-DOM-元素引用"><a href="#没有清理-DOM-元素引用" class="headerlink" title="没有清理 DOM 元素引用"></a>没有清理 DOM 元素引用</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> refA = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;refA&#x27;</span>);</span><br><span class="line"><span class="built_in">document</span>.body.removeChild(refA); <span class="comment">// dom删除了</span></span><br><span class="line"><span class="built_in">console</span>.log(refA, <span class="string">&#x27;refA&#x27;</span>); <span class="comment">// 但是还存在引用能console出整个div 没有被回收</span></span><br><span class="line">refA = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(refA, <span class="string">&#x27;refA&#x27;</span>); <span class="comment">// 解除引用</span></span><br></pre></td></tr></table></figure>

<p>原因: 保留了 DOM 节点的引用,导致 GC 没有回收</p>
<p>解决：refA = null</p>
<h4 id="IE9-以下浏览器环境导致的循环引用"><a href="#IE9-以下浏览器环境导致的循环引用" class="headerlink" title="IE9 以下浏览器环境导致的循环引用"></a>IE9 以下浏览器环境导致的循环引用</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;something&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> myObject = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">myObject.element = element; <span class="comment">// element属性指向dom</span></span><br><span class="line">element.someThing = myObject; <span class="comment">// someThing回指myObject 出现循环引用(两个对象一直互相包含 一直存在计数)。</span></span><br></pre></td></tr></table></figure>

<p>原因：IE9 以下 BOM 和 DOM 对象使用 C++ 以 COM 对象的形式实现的。COM 的垃圾收集机制采用的是引用计数策略，这种机制在出现循环引用的时候永远都释放不掉内存。</p>
<p>解决：不使用它们的时候，手动切断链接：<code>myObject.element = null; element.someThing = null;</code></p>
<h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><h3 id="能讲下-JavaScript-的闭包么？"><a href="#能讲下-JavaScript-的闭包么？" class="headerlink" title="能讲下 JavaScript 的闭包么？"></a>能讲下 JavaScript 的闭包么？</h3><p>一个函数包含了另一个函数或另一个对象，里面这个对象或函数都可以使用外部函数的变量或参数，此时就形成了闭包。</p>
<h3 id="你平常怎么用闭包的？"><a href="#你平常怎么用闭包的？" class="headerlink" title="你平常怎么用闭包的？"></a>你平常怎么用闭包的？</h3><h4 id="匿名自执行函数避免全局污染（模块化开发）"><a href="#匿名自执行函数避免全局污染（模块化开发）" class="headerlink" title="匿名自执行函数避免全局污染（模块化开发）"></a>匿名自执行函数避免全局污染（模块化开发）</h4><p>创建了一个匿名立即执行函数，由于外部无法引用它内部的变量，因此在函数执行完后会立刻释放资源，不污染全局对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> msg = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> days = [<span class="string">&#x27;Sun&#x27;</span>, <span class="string">&#x27;Mon&#x27;</span>, <span class="string">&#x27;Tue&#x27;</span>, <span class="string">&#x27;Wed&#x27;</span>, <span class="string">&#x27;Thu&#x27;</span>, <span class="string">&#x27;Fri&#x27;</span>, <span class="string">&#x27;Sat&#x27;</span>];</span><br><span class="line">  <span class="keyword">const</span> today = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">const</span> msg = <span class="string">&#x27;Today is &#x27;</span> + days[today.getDay()] + <span class="string">&#x27;, &#x27;</span> + today.getDate();</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">getMsg</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(msg.getMsg());</span><br></pre></td></tr></table></figure>

<h4 id="缓存数据"><a href="#缓存数据" class="headerlink" title="缓存数据"></a>缓存数据</h4><p>有时候我们需要获取一个处理过程很耗时的对象，并且往往会把这个复杂的处理过程封装成一个方法。但每次需要用到它时都需要调用它从而花费很长时间，那么我们就需要将计算出来的值存储起来，当调用这个函数的时候，首先在缓存中查找，如果找不到，则进行计算，然后更新缓存并返回值，如果找到了，直接返回查找到的值即可。闭包就可以做到这一点，因为它不会释放外部的引用，从而函数内部的值可以得以保留。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> CachedSearchBox = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cache = &#123;&#125;,</span><br><span class="line">    count = [];</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    attachSearchBox: <span class="function"><span class="keyword">function</span> (<span class="params">dsid</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (dsid <span class="keyword">in</span> cache) &#123;</span><br><span class="line">        <span class="comment">//如果结果在缓存中</span></span><br><span class="line">        <span class="keyword">return</span> cache[dsid]; <span class="comment">//直接返回缓存中的对象</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> fsb = <span class="keyword">new</span> uikit.webctrl.SearchBox(dsid); <span class="comment">//新建</span></span><br><span class="line">      cache[dsid] = fsb; <span class="comment">//更新缓存</span></span><br><span class="line">      <span class="keyword">if</span> (count.length &gt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="comment">//保正缓存的大小&lt;=100</span></span><br><span class="line">        <span class="keyword">delete</span> cache[count.shift()];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> fsb;</span><br><span class="line">    &#125;,</span><br><span class="line">    clearSearchBox: <span class="function"><span class="keyword">function</span> (<span class="params">dsid</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (dsid <span class="keyword">in</span> cache) &#123;</span><br><span class="line">        cache[dsid].clearSelection();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h4 id="拿到正确的值"><a href="#拿到正确的值" class="headerlink" title="拿到正确的值"></a>拿到正确的值</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i); <span class="comment">//10个10</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决方案：for 循环中声明 10 个自执行函数，保存当时的值到内部</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params">j</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(j);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="高级排他"><a href="#高级排他" class="headerlink" title="高级排他"></a>高级排他</h4><p>场景：一个 ul li 列表，鼠标移入时高亮当前 li 标签，移除之前 li 标签的高亮状态。</p>
<p>常规写法：两层 for 循环，外层遍历 li 标签，给每个 li 添加 onmouseover 事件；里层 for 循环用来在高亮当前 li 标签之前，移除所有 li 标签高亮状态。</p>
<p>闭包写法：定义一个 preIndex 变量存储上次高亮 li 标签的索引，for 循环内部使用立即执行函数+闭包保存 index 索引，这样就使 li 标签与 index 索引一一对应，然后在 onmouseover 事件触发后，根据 preIndex 找到之前高亮标签并移除高亮状态，并设置当前标签高亮，最后将 preIndex 设置为当前高亮标签的 index 索引。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      * &#123;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">        list-style: none;</span><br><span class="line">      &#125;</span><br><span class="line">      ul li &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        height: 20px;</span><br><span class="line">        margin-bottom: 5px;</span><br><span class="line">        background-color: grey;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-tag">li</span><span class="selector-class">.active</span> &#123;</span></span><br><span class="line">        background-color: yellow;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> list = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;li&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 记录移动前选中li的对应索引</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> preActiveIndex = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">          (<span class="function"><span class="keyword">function</span> (<span class="params">j</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> li = list[i];</span></span><br><span class="line"><span class="javascript">            li.onmouseover = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 清除</span></span></span><br><span class="line"><span class="javascript">              list[preActiveIndex].className = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 设置</span></span></span><br><span class="line"><span class="javascript">              <span class="built_in">this</span>.className = <span class="string">&#x27;active&#x27;</span>;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 赋值</span></span></span><br><span class="line">              preActiveIndex = j;</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125;)(i);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"><span class="javascript">      <span class="comment">// 常规写法</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// window.onload = function() &#123;</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//   let list = document.querySelectorAll(&#x27;li&#x27;)</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//   for (let i = 0; i &lt; list.length; i++) &#123;</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//     const li = list[i]</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//     li.onmouseover = function() &#123;</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//       for (let j = 0; j &lt; list.length; j++) &#123;</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//         list[j].className = &#x27;&#x27;</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//       &#125;</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//       this.className = &#x27;active&#x27;</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//     &#125;</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//   &#125;</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// &#125;</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="闭包会产生哪些问题？"><a href="#闭包会产生哪些问题？" class="headerlink" title="闭包会产生哪些问题？"></a>闭包会产生哪些问题？</h3><p>闭包会使函数中的变量不能及时释放，造成内存消耗过大，从而导致网页的性能问题。不过目前浏览器引擎都基于 V8，而 V8 引擎有个 gc 回收机制，不用太过担心变量不会被回收。</p>
<h2 id="Event-Loop"><a href="#Event-Loop" class="headerlink" title="Event Loop"></a>Event Loop</h2><h3 id="setTimeout、Promise、Async-Await-的区别"><a href="#setTimeout、Promise、Async-Await-的区别" class="headerlink" title="setTimeout、Promise、Async/Await 的区别"></a>setTimeout、Promise、Async/Await 的区别</h3><p>这题主要是考察这三者在事件循环中的区别，事件循环中分为宏任务队列和微任务队列。<br>其中 setTimeout 的回调函数放到宏任务队列里，等到执行栈清空以后执行；<br>promise.then 里的回调函数会放到相应宏任务的微任务队列里，等宏任务里面的同步代码执行完再执行；async 函数表示函数里面可能会有异步方法，await 后面跟一个表达式，async 方法执行时，遇到 await 会立即执行表达式，然后把表达式后面的代码放到微任务队列里，让出执行栈让同步代码先执行。</p>
<p><strong>题目来源</strong>：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/33">https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/33</a></p>
<h3 id="你知道-Event-Loop-（事件循环）的机制吗？"><a href="#你知道-Event-Loop-（事件循环）的机制吗？" class="headerlink" title="你知道 Event Loop （事件循环）的机制吗？"></a>你知道 Event Loop （事件循环）的机制吗？</h3><p>事件循环机制从整体上告诉了我们 JavaScript 代码的执行顺序<code>Event Loop</code>即事件循环，是指浏览器或<code>Node</code>的一种解决<code>javaScript</code>单线程运行时不会阻塞的一种机制，也就是我们经常使用<strong>异步</strong>的原理。</p>
<p>先执行宏任务队列，然后执行微任务队列，然后开始下一轮事件循环，继续先执行宏任务队列，再执行微任务队列。</p>
<ul>
<li>宏任务：script/setTimeout/setInterval/setImmediate/ I/O / UI Rendering</li>
<li>微任务：process.nextTick()/Promise</li>
</ul>
<p>上诉的 setTimeout 和 setInterval 等都是任务源，真正进入任务队列的是他们分发的任务。</p>
<h3 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h3><ul>
<li>setTimeout = setInterval 一个队列</li>
<li>setTimeout &gt; setImmediate</li>
<li>process.nextTick &gt; Promise</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> macroTask <span class="keyword">of</span> macroTaskQueue) &#123;</span><br><span class="line">  handleMacroTask();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> microTask <span class="keyword">of</span> microTaskQueue) &#123;</span><br><span class="line">    handleMicroTask(microTask);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><ul>
<li><a href="https://juejin.im/post/59e85eebf265da430d571f89">https://juejin.im/post/59e85eebf265da430d571f89</a></li>
</ul>
<h2 id="概念性问题"><a href="#概念性问题" class="headerlink" title="概念性问题"></a>概念性问题</h2><h3 id="观察者模式与发布订阅模式有什么区别"><a href="#观察者模式与发布订阅模式有什么区别" class="headerlink" title="观察者模式与发布订阅模式有什么区别"></a>观察者模式与发布订阅模式有什么区别</h3><p>可以把观察者模式想象成顾客与微商的关系。顾客关注了微商的商品，微商就会记住顾客，每当微商有新产品时，就会直接<strong>私聊</strong>来通知所有关注了自己的顾客。这里的顾客就相当于观察者，微商就是被观察者。</p>
<p>而发布订阅模式可以看做是顾客通过「商城平台」关注了商家的商品，商家一旦上新就通过「商城平台」向关注了自己的顾客<strong>群发</strong>消息，这里的顾客就是订阅者，「商城平台」就是事件总线，商家就是发布者。</p>
<p>通过上面两个例子就能看出，观察者模式的模型跟发布/订阅者模型里，差距就差在有没有一个<strong>中央的事件总线</strong>。如果有这个事件总线，我们就可以认为是个发布订阅模型。如果没有，那么就可以认为是个观察者模型。因为其实它们都实现了一个关键的功能：发布事件-订阅事件并触发事件。</p>
<h3 id="讲一下面向对象的三大特征？"><a href="#讲一下面向对象的三大特征？" class="headerlink" title="讲一下面向对象的三大特征？"></a>讲一下面向对象的三大特征？</h3><p>封装继承和多态</p>
<p>不过这个回答到以后，肯定会问你具体啥意思的，不了解的同学可点击 <a href="https://mp.weixin.qq.com/s/tWg-Jf30i9ZK7o1mMYLe7w">这个</a> 链接查看。</p>
<h3 id="什么是重写，什么是重载？"><a href="#什么是重写，什么是重载？" class="headerlink" title="什么是重写，什么是重载？"></a>什么是重写，什么是重载？</h3><p>重写就是子类覆盖掉父类的方法<br>重载就是在一个类里面，方法名字相同，而参数不同。返回类型可以相同也可以不同。</p>
<h2 id="开放性提问"><a href="#开放性提问" class="headerlink" title="开放性提问"></a>开放性提问</h2><p>这部分就只放题目不给参考答案了，毕竟每个人经历不同，放这儿让你们有个准备吧。</p>
<ul>
<li>你在平时写项目中遇到的最大的困难在哪，又是如何解决掉的？</li>
<li>你简历上的项目作品中，挑一个讲一下存在哪些技术难点？</li>
<li>在使用 Vue 过程中遇到过哪些印象深刻的问题，如何解决的？</li>
<li>未来 3-5 年对自己的计划？</li>
<li>为什么喜欢前端？</li>
<li>对自己做一个自我评价吧</li>
<li>谈谈你自己的不足，或者想提升的？</li>
<li>做的最成功的一件事？</li>
<li>有没有什么主动争取的东西？</li>
<li>你是怎么学前端的？</li>
<li>平时有关注一些博客什么的吗，讲一个最近看的？</li>
<li>你还有什么想问我的嘛？</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>Sequelize框架入门</title>
    <url>/posts/1183/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>平常写前端项目时，为了更方便的获取“真实”的动态数据，也会新建几个数据库表来作支撑。但每每需要用Node搭建后端服务时，数据库的查询真的让人头疼，难倒不难，就是特别繁琐，即使封装了个查询sql用工具模块，在遇到稍复杂的查询语句时还是得写完整SQL。</p>
<p>我又是个比较懒的人，在经历了几次痛苦折磨后，我开始google有没有谁帮我们解决了数据库表字段与对象之间的关系映射。也就是我们通常所说的 <a href="https://baike.baidu.com/item/ORM/3583252?fr=aladdin">ORM</a> 。经过几番搜索，我找到了 <a href="http://docs.sequelizejs.com/">Sequelize</a> 框架。在了解它之前，我们先简单介绍下什么是 <code>ORM</code> ：（我知道不少人是不会点击上面链接查看详情的 :)）</p>
<a id="more"></a>

<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><h3 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h3><p>ORM 全称 Object Relational Mapping，翻译成中文就是 <code>对象关系映射</code> 。是对 SQL 查询语句的封装，让我们可以用面向对象的方式操作数据库，来更加优雅的生成安全、可维护的 SQL 代码。说白了，就是通过对象来映射和操作数据库。</p>
<h3 id="Sequelize"><a href="#Sequelize" class="headerlink" title="Sequelize"></a>Sequelize</h3><p>而今天的主角 <code>Sequelize</code> 则是一个基于 promise 的 Node.js 异步ORM框架。它能够支持多种数据库，包含但不限于 PostgreSQL, MySQL 和 MSSQL 。</p>
<blockquote>
<p>官网地址：<a href="http://docs.sequelizejs.com/">http://docs.sequelizejs.com/</a><br>github：<a href="https://github.com/sequelize/sequelize">https://github.com/sequelize/sequelize</a></p>
</blockquote>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h3><p>在本地新建文件夹，例如 <code>sequelize-demo</code> ，然后在项目根目录下运行命令行命名 <code>npm init -y</code>。运行完该命令后项目tree如下：</p>
<img src="/posts/1183/npminit-y.png" class="" title="npminit-y">

<p>接着使用 npm 安装 <code>sequelize</code>：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i sequelize</span><br></pre></td></tr></table></figure>



<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p>完成上述步骤以后，我们在根目录下新建一个 <code>app.js</code> 文件来使用 <code>sequelize</code> ，代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 sequelize</span></span><br><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建 sequelize 实例</span></span><br><span class="line"><span class="keyword">const</span> sequelize = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;数据库名称&#x27;</span>, <span class="string">&#x27;数据库用户名&#x27;</span>, <span class="string">&#x27;数据库密码&#x27;</span>, &#123;</span><br><span class="line">    <span class="comment">// 其他的数据库连接配置</span></span><br><span class="line">    host: <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="comment">// 主机，默认 localhost</span></span><br><span class="line">    port: <span class="number">8889</span>,        <span class="comment">// 端口，默认 3306</span></span><br><span class="line">    dialect: <span class="string">&#x27;mysql&#x27;</span>,  <span class="comment">// 数据库类型， 默认 mysql 【必填】</span></span><br><span class="line">    timezone: <span class="string">&#x27;+08:00&#x27;</span> <span class="comment">// 时区，默认会根据系统当前所在时区进行设置，格式：&#x27;+08:00&#x27; 或字符串格式 &#x27;Asia/Shanghai&#x27; 参考：http://php.net/manual/zh/timezones.php 【使用场景：一般情况下默认配置就好，但如果服务器在美国，但想存储中国时区，就需要明确指定 &#x27;+08:00&#x27; 了】</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试数据库的连接（返回的是一个Promise，记得 catch 捕获错误）</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    sequelize.authenticate();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接成功!&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;连接失败&#x27;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时你可以尝试运行 <code>app.js</code> 文件，即在根目录下运行 <code>node app.js</code> 命令。正常情况下你会收到报错信息，类似这样：</p>
<img src="/posts/1183/error-mysql2.png" class="" title="mysql2">

<p>意思是你需要安装 <code>mysql2</code> ，这是因为 <code>sequelize</code> 虽然依赖了 <code>mysql2</code> ，但却没有内置安装。所以接下来你得在项目根目录下运行如下代码来安装 <code>mysql2</code>：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i mysql2</span><br></pre></td></tr></table></figure>



<p>安装完毕后再次运行 <code>app.js</code> ，就能连接数据库成功了：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">node app.js</span><br><span class="line">Executing (default): SELECT 1+1 AS result</span><br><span class="line">数据库连接成功!</span><br></pre></td></tr></table></figure>



<h3 id="定义模型（Model）"><a href="#定义模型（Model）" class="headerlink" title="定义模型（Model）"></a>定义模型（Model）</h3><blockquote>
<p>所谓模型，就是用来描述数据库表字段信息的对象，每一个模型对象表示数据库中的一个表，后续对数据库的操作都是用过对应的模型对象来完成的。</p>
</blockquote>
<p>接下来我们就要定义数据的模型了。在此之前，你还需要做一些准备工作。以我为例，我在数据库中新建了一个 <code>users</code> 表，表字段和类型如下：</p>
<img src="/posts/1183/table-property.png" class="" title="表字段">

<p>然后定义出对应此表的数据模型：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义模型（用对象的方式来描述数据库中的表）</span></span><br><span class="line"><span class="keyword">const</span> UserModel = sequelize.define(<span class="string">&#x27;User&#x27;</span>, &#123;</span><br><span class="line">    <span class="comment">// 描述表中对应的字段信息</span></span><br><span class="line">    id: &#123; <span class="comment">// 每一个字段的信息</span></span><br><span class="line">        type: Sequelize.INTEGER(<span class="number">11</span>), <span class="comment">// 字段类型</span></span><br><span class="line">        allowNull: <span class="literal">false</span>,            <span class="comment">// 不允许为空</span></span><br><span class="line">        autoIncrement: <span class="literal">true</span>,         <span class="comment">// id自增长</span></span><br><span class="line">        primaryKey: <span class="literal">true</span>,            <span class="comment">// 设为主键</span></span><br><span class="line">    &#125;,</span><br><span class="line">    username: &#123;</span><br><span class="line">        type: Sequelize.STRING(<span class="number">50</span>),</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        defaultValue: <span class="string">&#x27;&#x27;</span>,            <span class="comment">// 设置字段默认值</span></span><br><span class="line">    &#125;,</span><br><span class="line">    age: &#123;</span><br><span class="line">        type: Sequelize.TINYINT(<span class="number">3</span>),</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    gender: &#123;</span><br><span class="line">        type: Sequelize.ENUM([<span class="string">&#x27;men&#x27;</span>, <span class="string">&#x27;women&#x27;</span>, <span class="string">&#x27;other&#x27;</span>]), <span class="comment">// 这是个枚举类型字段，表示性别只能为“男”，“女”，“保密”中的其中一个，传入 ENUM 中的可以是逗号隔开的字符串，也可以是个数组：ENUM([&#x27;men&#x27;, &#x27;women&#x27;]) or ENUM(&#x27;men&#x27;, &#x27;women&#x27;, &#x27;other&#x27;)</span></span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        defaultValue: <span class="string">&#x27;men&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;, &#123; <span class="comment">// 用来设置字段以外的其他信息</span></span><br><span class="line">    timestamps: <span class="literal">false</span>, <span class="comment">// 是否给每条记录添加 createAt 和 updateAt 字段，并在添加新数据和更新数据的时候自动设置这两个字段的值，默认为 true</span></span><br><span class="line">    tableName: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// 该模型映射的真实表名</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><strong>注意：</strong>在定义模型时，字段名称可以和数据库表中的字段名称不相同，但如果你想另起一个别名，则需要在字段信息设置中加入 <code>field</code> 来关联真正的表字段名称。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">userName: &#123; <span class="comment">// &lt;-- 你起的别名</span></span><br><span class="line">    type: Sequelize.STRING(<span class="number">50</span>),</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">    field: <span class="string">&#x27;username&#x27;</span>, <span class="comment">// 关联数据库表中真正的字段名</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<h3 id="数据查询"><a href="#数据查询" class="headerlink" title="数据查询"></a>数据查询</h3><h4 id="查询所有"><a href="#查询所有" class="headerlink" title="查询所有"></a>查询所有</h4><p>完成表模型的定义以后，我们就可以通过 <code>findAll</code> 来查询表数据了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 查询 users 表中所有数据</span></span><br><span class="line">UserModel.findAll().then(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 返回的 users 是个数组</span></span><br><span class="line">    users.forEach(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 循环的每个 user 都是个 Model 实例</span></span><br><span class="line">        <span class="comment">// 该 Model 实例包含 get 方法，我们能通过它获取 username</span></span><br><span class="line">        <span class="built_in">console</span>.log(user.get(<span class="string">&#x27;username&#x27;</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>写完上面代码后，再次运行 <code>app.js</code> ，你就应该能够查询到数据了~<br>p.s. 查询之前别忘了在数据库中插入一些数据。</p>
<h4 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h4><p>除了查询全部数据，我们还可以使用 <code>where</code> 查询指定的数据：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这次不用 .then 形式，而采用 async + await</span></span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 查找 username 为 &#x27;李元芳&#x27; 的唯一数据</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findOne(&#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">            username: <span class="string">&#x27;李元芳&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.dir(res);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>



<p>而类似大于小于这样的查询会稍显麻烦一点。例如我们来编写查询 users 表中年龄大于某个值的代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 查找满足 age &gt; 24 的所有数据</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAll(&#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">            age: &#123;</span><br><span class="line">                [Sequelize.Op.gt]: <span class="number">24</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 打印出符合条件的用户的 username</span></span><br><span class="line">    <span class="built_in">console</span>.dir(res.map(<span class="function"><span class="params">r</span> =&gt;</span> r.get(<span class="string">&#x27;username&#x27;</span>)));</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>



<h4 id="多条件查询"><a href="#多条件查询" class="headerlink" title="多条件查询"></a>多条件查询</h4><p>除了单一条件查询，我们还可以通过嵌套 or 或 and 运算符的集合来生成复杂条件语句。例如我们来查询 <code>年龄小于25 或者 性别为男</code> 的所有数据：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; Op &#125; = Sequelize;</span><br><span class="line">    <span class="comment">// 查找满足 age &lt; 25 或 gender = &#x27;men&#x27; 的所有数据</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAll(&#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">            [Op.or]: [</span><br><span class="line">                &#123;</span><br><span class="line">                    age: &#123;</span><br><span class="line">                        [Sequelize.Op.lt]: <span class="number">25</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    gender: <span class="string">&#x27;men&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 打印出符合条件的用户的 username</span></span><br><span class="line">    <span class="built_in">console</span>.dir(res.map(<span class="function"><span class="params">r</span> =&gt;</span> r.get(<span class="string">&#x27;username&#x27;</span>)));</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>



<p>从上面几组查询语句我们可以看出，<code>where</code> 通常用 <code>attribute: value</code> 键值对获取一个对象，其中 <code>value</code> 可以是匹配等式的<strong>数据</strong>或其他运算符的<strong>键值对象</strong>。更多查询语法可在下方链接查询：</p>
<ul>
<li><a href="http://docs.sequelizejs.com/manual/querying.html">Sequelize - Querying</a></li>
<li><a href="https://demopark.github.io/sequelize-docs-Zh-CN/querying.html">Sequelize - Querying（中文文档）</a></li>
</ul>
<h4 id="查询限制-limit-offset"><a href="#查询限制-limit-offset" class="headerlink" title="查询限制 limit, offset"></a>查询限制 limit, offset</h4><p>我们还能限制查询的数量：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 只从表中查询两条数据</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAll(&#123;</span><br><span class="line">        limit: <span class="number">2</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(res.map(<span class="function"><span class="params">r</span> =&gt;</span> r.get(<span class="string">&#x27;username&#x27;</span>)));</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>



<p>跳过前2条数据：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAll(&#123;</span><br><span class="line">        offset: <span class="number">2</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(res.map(<span class="function"><span class="params">r</span> =&gt;</span> r.get(<span class="string">&#x27;username&#x27;</span>)));</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>



<p>跳过前2条数据并获取3条：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAll(&#123;</span><br><span class="line">        offset: <span class="number">2</span>,</span><br><span class="line">        limit: <span class="number">3</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(res.map(<span class="function"><span class="params">r</span> =&gt;</span> r.get(<span class="string">&#x27;username&#x27;</span>)));</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>



<h4 id="查询排序"><a href="#查询排序" class="headerlink" title="查询排序"></a>查询排序</h4><p>我们还可以将查询数据进行排序：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 查询的结果按年龄高到低排序</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAll(&#123;</span><br><span class="line">        order: [</span><br><span class="line">            [<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>]</span><br><span class="line">        ]</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(res.map(<span class="function"><span class="params">r</span> =&gt;</span> r.get(<span class="string">&#x27;username&#x27;</span>)));</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>



<h4 id="查询记录"><a href="#查询记录" class="headerlink" title="查询记录"></a>查询记录</h4><p>有些时候我们可能只是想单纯的查询数据表中有多少条数据，这时可以用 <code>count()</code> 方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 查询 users 表中有多少条数据</span></span><br><span class="line">  <span class="keyword">let</span> count = <span class="keyword">await</span> UserModel.count();</span><br><span class="line">  <span class="built_in">console</span>.log(count);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者使用 `findAndCountAll()` 方法在数据库中搜索多条记录，它能返回给我们**数据和总计数**：</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 查询 users 表中的前两条数据，并返回 users 表中总记录数</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAndCountAll(&#123;</span><br><span class="line">        limit: <span class="number">2</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>



<p>查询结果的格式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123; </span><br><span class="line">    count: 总记录数,</span><br><span class="line">    rows: [ </span><br><span class="line">        &#123;第一条记录&#125;, &#123;第二条记录&#125;, ...</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>这个方法对我们为前端提供分页功能很方便，count是符合条件的总记录数，而rows中可以是当前页数下的记录数。</p>
<h3 id="数据增加"><a href="#数据增加" class="headerlink" title="数据增加"></a>数据增加</h3><p>既然能查，当然就能往数据库插入数据，在 <code>sequelize</code> 中，插入数据可以用 <code>build</code> 方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 新建一条数据（除了build外，还可以通过 new UserModel(&#123;&#125;) 的形式创建一条记录）</span></span><br><span class="line"><span class="keyword">let</span> wangwu = UserModel.build(&#123;</span><br><span class="line">    username: <span class="string">&#x27;王五&#x27;</span>,</span><br><span class="line">    age: <span class="number">22</span>,</span><br><span class="line">    gender: <span class="string">&#x27;men&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// **注意：** 通过 new 或 build 出来的对象不会立即同步到数据库中，</span></span><br><span class="line"><span class="comment">// 需要使用后续的一些方法（例如 save ）来同步</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 你还可以修改这条数据</span></span><br><span class="line">wangwu.set(<span class="string">&#x27;age&#x27;</span>, <span class="number">25</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最后别忘了保存才能成功插入数据</span></span><br><span class="line">wangwu.save();</span><br></pre></td></tr></table></figure>


<p>如果运行后没报错，去数据库刷新表吧，数据已经成功的插入到 <code>users</code> 表了~</p>
<h3 id="数据修改"><a href="#数据修改" class="headerlink" title="数据修改"></a>数据修改</h3><p>实际开发中修改数据是再平常不过的了，比如修改一篇博客，更新自己的个人信息… 在 <code>sequelize</code> 中，我们这样修改数据：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 查询id为2的用户数据</span></span><br><span class="line">UserModel.findByPk(<span class="number">2</span>).then(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 查询到以后修改其 age 字段为 99</span></span><br><span class="line">    user.set(<span class="string">&#x27;age&#x27;</span>, <span class="number">99</span>);</span><br><span class="line">    <span class="comment">// 修改后别忘了保存</span></span><br><span class="line">    user.save();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><strong>注意：</strong> 在 Sequelize v5 版本以前，通过id查询数据的方法名为 <code>findById</code> ，从 v5 版本开始，更改为 <code>findByPk</code> 。其实想一下这样非常合理，以前的 <code>findById</code> 太主观了，要知道不一定每个表的主键都为 id ，所以更改为 <code>findByPk</code> 后，表示通过<strong>主键（Pk -&gt; PrimaryKey）</strong>查找，<code>sequelize</code> 会自动通过你在创建表模型时定义的主键字段查找。例如我们一开始在定义 <code>User</code> 模型时，就给 <code>id</code> 字段添加了 <code>primaryKey: true,</code> 属性。</p>
<p>除了 set + update 来更新数据以外，还可以使用 <code>update()</code> 方法做相同的事情：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 先查询</span></span><br><span class="line">    <span class="keyword">let</span> xiaohong = <span class="keyword">await</span> UserModel.findByPk(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">// update方法相当于 set + save</span></span><br><span class="line">    <span class="keyword">await</span> xiaohong.update(&#123;</span><br><span class="line">        age: <span class="number">22</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>



<h3 id="数据删除"><a href="#数据删除" class="headerlink" title="数据删除"></a>数据删除</h3><p>如果想要删除一条数据，可以使用 <code>destroy</code> 方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 先查询</span></span><br><span class="line">    <span class="keyword">let</span> wangwu = <span class="keyword">await</span> UserModel.findByPk(<span class="number">4</span>);</span><br><span class="line">    <span class="comment">// 对查询到的数据进行删除</span></span><br><span class="line">    wangwu.destroy();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>



<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sequelize = <span class="keyword">new</span> Sequelize(<span class="string">&quot;miaov&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>, &#123;</span><br><span class="line">  <span class="comment">// 其他的数据库连接配置</span></span><br><span class="line">  host: <span class="string">&quot;127.0.0.1&quot;</span>, <span class="comment">// 主机</span></span><br><span class="line">  port: <span class="number">8889</span>, <span class="comment">// 端口</span></span><br><span class="line">  dialect: <span class="string">&quot;mysql&quot;</span> <span class="comment">// 数据库类型</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试连接</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    sequelize.authenticate();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接成功!&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;连接失败&#x27;</span>);    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义模型（用对象的方式来描述数据库中的表）</span></span><br><span class="line"><span class="keyword">const</span> UserModel = sequelize.define(<span class="string">&#x27;User&#x27;</span>, &#123;</span><br><span class="line">    <span class="comment">// 定义字段</span></span><br><span class="line">    id: &#123; <span class="comment">// 对字段属性的定义</span></span><br><span class="line">        type: Sequelize.INTEGER(<span class="number">11</span>), <span class="comment">// 字段类型</span></span><br><span class="line">        allowNull: <span class="literal">false</span>,            <span class="comment">// 不允许为空</span></span><br><span class="line">        autoIncrement: <span class="literal">true</span>,         <span class="comment">// id自增长</span></span><br><span class="line">        primaryKey: <span class="literal">true</span>,            <span class="comment">// 设为主键</span></span><br><span class="line">    &#125;,</span><br><span class="line">    username: &#123;</span><br><span class="line">        type: Sequelize.STRING(<span class="number">50</span>),</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        defaultValue: <span class="string">&#x27;&#x27;</span>,            <span class="comment">// 设置字段默认值</span></span><br><span class="line">    &#125;,</span><br><span class="line">    age: &#123;</span><br><span class="line">        type: Sequelize.TINYINT(<span class="number">3</span>),</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    gender: &#123;</span><br><span class="line">        type: Sequelize.ENUM([<span class="string">&#x27;men&#x27;</span>, <span class="string">&#x27;women&#x27;</span>, <span class="string">&#x27;other&#x27;</span>]),</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        defaultValue: <span class="string">&#x27;men&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;, &#123; <span class="comment">// 用来设置字段以外的其他信息</span></span><br><span class="line">    timestamps: <span class="literal">false</span>,  <span class="comment">// 是否给每条记录添加 createAt 和 updateAt 字段，并在添加新数据和更新数据的时候自动设置这两个字段的值，默认为 true</span></span><br><span class="line">    tableName: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// 该模型映射的真实表名</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为了方便学习，使用一个函数包裹一组代码</span></span><br><span class="line"><span class="comment">// 这样代码就不会运行了，从而避免干扰其他代码的执行</span></span><br><span class="line"><span class="comment">// 如果想要此函数中代码执行，添加 `()` 就好</span></span><br><span class="line"><span class="comment">// (function()&#123;...&#125;)();  &lt;-- 加上括号</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 查询 users 表中所有数据</span></span><br><span class="line">    UserModel.findAll().then(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 返回的 users 是个数组</span></span><br><span class="line">        users.forEach(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 循环的每个 user 都是个 Model 实例</span></span><br><span class="line">            <span class="comment">// 该 Model 实例包含 get 方法，我们能通过它获取 username</span></span><br><span class="line">            <span class="built_in">console</span>.log(user.get(<span class="string">&#x27;username&#x27;</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 新建一条数据（除了build外，还可以通过 new UserModel() 的形式创建一条记录）</span></span><br><span class="line">    <span class="keyword">let</span> liyuanfang = UserModel.build(&#123;</span><br><span class="line">        username: <span class="string">&#x27;李元芳&#x27;</span>,</span><br><span class="line">        age: <span class="number">09</span>,</span><br><span class="line">        gender: <span class="string">&#x27;men&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 修改数据</span></span><br><span class="line">    liyuanfang.set(<span class="string">&#x27;age&#x27;</span>, <span class="number">25</span>);</span><br><span class="line">    <span class="comment">// 别忘了保存</span></span><br><span class="line">    <span class="keyword">await</span> liyuanfang.save();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 查询id为2的用户数据</span></span><br><span class="line">    UserModel.findByPk(<span class="number">2</span>).then(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 查询到以后修改其 age 字段为 99</span></span><br><span class="line">        user.set(<span class="string">&#x27;age&#x27;</span>, <span class="number">99</span>);</span><br><span class="line">        <span class="comment">// 修改后别忘了保存</span></span><br><span class="line">        user.save();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 先查询</span></span><br><span class="line">    <span class="keyword">let</span> xiaohong = <span class="keyword">await</span> UserModel.findByPk(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">// update方法相当于 set + save</span></span><br><span class="line">    <span class="keyword">await</span> xiaohong.update(&#123;</span><br><span class="line">        age: <span class="number">18</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 先查询</span></span><br><span class="line">    <span class="keyword">let</span> wangwu = <span class="keyword">await</span> UserModel.findByPk(<span class="number">4</span>);</span><br><span class="line">    <span class="comment">// 对查询到的数据进行删除</span></span><br><span class="line">    wangwu.destroy();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 查找 username 为 &#x27;李元芳&#x27; 的唯一数据</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findOne(&#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">            username: <span class="string">&#x27;李元芳&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.dir(res);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 查找满足 age &gt; 24 的所有数据</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAll(&#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">            age: &#123;</span><br><span class="line">                [Sequelize.Op.gt]: <span class="number">24</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 打印出符合条件的用户的 username</span></span><br><span class="line">    <span class="built_in">console</span>.dir(res.map(<span class="function"><span class="params">r</span> =&gt;</span> r.get(<span class="string">&#x27;username&#x27;</span>)));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; Op &#125; = Sequelize;</span><br><span class="line">    <span class="comment">// 查找满足 age &lt; 25 或 gender = &#x27;men&#x27; 的所有数据</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAll(&#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">            [Op.or]: [</span><br><span class="line">                &#123;</span><br><span class="line">                    age: &#123;</span><br><span class="line">                        [Sequelize.Op.lt]: <span class="number">25</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    gender: <span class="string">&#x27;men&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 打印出符合条件的用户的 username</span></span><br><span class="line">    <span class="built_in">console</span>.dir(res.map(<span class="function"><span class="params">r</span> =&gt;</span> r.get(<span class="string">&#x27;username&#x27;</span>)));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 只从表中查询两条数据</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAll(&#123;</span><br><span class="line">        limit: <span class="number">2</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(res.map(<span class="function"><span class="params">r</span> =&gt;</span> r.get(<span class="string">&#x27;username&#x27;</span>)));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 跳过前2条数据</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAll(&#123;</span><br><span class="line">        offset: <span class="number">2</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(res.map(<span class="function"><span class="params">r</span> =&gt;</span> r.get(<span class="string">&#x27;username&#x27;</span>)));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 跳过前2条数据并获取3条</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAll(&#123;</span><br><span class="line">        offset: <span class="number">2</span>,</span><br><span class="line">        limit: <span class="number">3</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(res.map(<span class="function"><span class="params">r</span> =&gt;</span> r.get(<span class="string">&#x27;username&#x27;</span>)));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 查询的结果按年龄高到低排序</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAll(&#123;</span><br><span class="line">        order: [</span><br><span class="line">            [<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>]</span><br><span class="line">        ]</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(res.map(<span class="function"><span class="params">r</span> =&gt;</span> r.get(<span class="string">&#x27;username&#x27;</span>)));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 查询的结果按年龄高到低排序</span></span><br><span class="line">    <span class="keyword">let</span> count = <span class="keyword">await</span> UserModel.count();</span><br><span class="line">    <span class="built_in">console</span>.log(count);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 查询 users 表中的前两条数据，并返回 users 表中总记录数</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> UserModel.findAndCountAll(&#123;</span><br><span class="line">        limit: <span class="number">2</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h2 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h2><p>安装的 sequelize 和 mysql2 的版本为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;mysql2&quot;</span>: <span class="string">&quot;^1.6.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sequelize&quot;</span>: <span class="string">&quot;^5.3.1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><ul>
<li><a href="http://docs.sequelizejs.com/">Sequelize Docs</a></li>
<li><a href="https://demopark.github.io/sequelize-docs-Zh-CN/">Sequelize Docs 中文版</a></li>
</ul>
]]></content>
      <categories>
        <category>后端</category>
        <category>SQL</category>
      </categories>
      <tags>
        <tag>Sequelize</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue自定义表单校验组件(仿element-ui)</title>
    <url>/posts/21485/</url>
    <content><![CDATA[<p>相关代码见<a href="https://github.com/evestorm/front-end-playground/tree/master/vue/vue-element-form">github</a></p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="项目创建"><a href="#项目创建" class="headerlink" title="项目创建"></a>项目创建</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vue create vue-element-form</span><br></pre></td></tr></table></figure>

<h3 id="按需引入-element-ui"><a href="#按需引入-element-ui" class="headerlink" title="按需引入 element-ui"></a>按需引入 element-ui</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i element-ui -S # 安装 element-ui</span><br><span class="line">npm i babel-plugin-component -D # 准备按需引入</span><br><span class="line">npm i async-validator -S # Form 表单校验</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h4 id="修改-babel-config-js"><a href="#修改-babel-config-js" class="headerlink" title="修改 babel.config.js"></a>修改 <code>babel.config.js</code></h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  presets: [</span><br><span class="line">    <span class="string">&#x27;@vue/app&#x27;</span>,</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&#x27;@babel/preset-env&#x27;</span>, <span class="comment">//添加 babel-preset-env 配置</span></span><br><span class="line">      &#123;</span><br><span class="line">        modules: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// element官方教程</span></span><br><span class="line">    [</span><br><span class="line">      <span class="string">&#x27;component&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        libraryName: <span class="string">&#x27;element-ui&#x27;</span>,</span><br><span class="line">        styleLibraryName: <span class="string">&#x27;theme-chalk&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="main-js-按需引入"><a href="#main-js-按需引入" class="headerlink" title="main.js 按需引入"></a>main.js 按需引入</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  Form,</span><br><span class="line">  FormItem,</span><br><span class="line">  Input,</span><br><span class="line">  Select,</span><br><span class="line">  Option,</span><br><span class="line">  Col,</span><br><span class="line">  DatePicker,</span><br><span class="line">  TimePicker,</span><br><span class="line">  Switch,</span><br><span class="line">  CheckboxGroup,</span><br><span class="line">  Checkbox,</span><br><span class="line">  RadioGroup,</span><br><span class="line">  Radio,</span><br><span class="line">  Button</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Form);</span><br><span class="line">Vue.use(FormItem);</span><br><span class="line">Vue.use(Input);</span><br><span class="line">Vue.use(Select);</span><br><span class="line">Vue.use(Option);</span><br><span class="line">Vue.use(Col);</span><br><span class="line">Vue.use(DatePicker);</span><br><span class="line">Vue.use(TimePicker);</span><br><span class="line">Vue.use(Switch);</span><br><span class="line">Vue.use(CheckboxGroup);</span><br><span class="line">Vue.use(Checkbox);</span><br><span class="line">Vue.use(RadioGroup);</span><br><span class="line">Vue.use(Radio);</span><br><span class="line">Vue.use(Button);</span><br></pre></td></tr></table></figure>

<h4 id="Home-vue-添加-Element-示例代码"><a href="#Home-vue-添加-Element-示例代码" class="headerlink" title="Home.vue 添加 Element 示例代码"></a>Home.vue 添加 Element 示例代码</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span><br><span class="line">    &lt;el-form</span><br><span class="line">      :model=&quot;ruleForm&quot;</span><br><span class="line">      :rules=&quot;rules&quot;</span><br><span class="line">      ref=&quot;ruleForm&quot;</span><br><span class="line">      label-width=&quot;100px&quot;</span><br><span class="line">      class=&quot;demo-ruleForm&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动名称&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;ruleForm.name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动区域&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;region&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;ruleForm.region&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择活动区域&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;区域一&quot;</span> <span class="attr">value</span>=<span class="string">&quot;shanghai&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;区域二&quot;</span> <span class="attr">value</span>=<span class="string">&quot;beijing&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动时间&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">prop</span>=<span class="string">&quot;date1&quot;</span>&gt;</span></span><br><span class="line">            &lt;el-date-picker</span><br><span class="line">              type=&quot;date&quot;</span><br><span class="line">              placeholder=&quot;选择日期&quot;</span><br><span class="line">              v-model=&quot;ruleForm.date1&quot;</span><br><span class="line">              style=&quot;width: 100%;&quot;</span><br><span class="line">            &gt;<span class="tag">&lt;/<span class="name">el-date-picker</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">class</span>=<span class="string">&quot;line&quot;</span> <span class="attr">:span</span>=<span class="string">&quot;2&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">prop</span>=<span class="string">&quot;date2&quot;</span>&gt;</span></span><br><span class="line">            &lt;el-time-picker</span><br><span class="line">              placeholder=&quot;选择时间&quot;</span><br><span class="line">              v-model=&quot;ruleForm.date2&quot;</span><br><span class="line">              style=&quot;width: 100%;&quot;</span><br><span class="line">            &gt;<span class="tag">&lt;/<span class="name">el-time-picker</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;即时配送&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;delivery&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-switch</span> <span class="attr">v-model</span>=<span class="string">&quot;ruleForm.delivery&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-switch</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动性质&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;type&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-checkbox-group</span> <span class="attr">v-model</span>=<span class="string">&quot;ruleForm.type&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&quot;美食/餐厅线上活动&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&quot;地推活动&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&quot;线下主题活动&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&quot;单纯品牌曝光&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-checkbox-group</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;特殊资源&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;resource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-radio-group</span> <span class="attr">v-model</span>=<span class="string">&quot;ruleForm.resource&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-radio</span> <span class="attr">label</span>=<span class="string">&quot;线上品牌商赞助&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-radio</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-radio</span> <span class="attr">label</span>=<span class="string">&quot;线下场地免费&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-radio</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-radio-group</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动形式&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;desc&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;ruleForm.desc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;submitForm(&#x27;ruleForm&#x27;)&quot;</span>&gt;</span></span><br><span class="line">          立即创建</span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;resetForm(&#x27;ruleForm&#x27;)&quot;</span>&gt;</span>重置<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        ruleForm: &#123;</span><br><span class="line"><span class="javascript">          name: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          region: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          date1: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          date2: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          delivery: <span class="literal">false</span>,</span></span><br><span class="line">          type: [],</span><br><span class="line"><span class="javascript">          resource: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          desc: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        rules: &#123;</span><br><span class="line">          name: [</span><br><span class="line"><span class="javascript">            &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入活动名称&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;,</span></span><br><span class="line"><span class="javascript">            &#123; <span class="attr">min</span>: <span class="number">3</span>, <span class="attr">max</span>: <span class="number">5</span>, <span class="attr">message</span>: <span class="string">&#x27;长度在 3 到 5 个字符&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span></span><br><span class="line">          ],</span><br><span class="line">          region: [</span><br><span class="line"><span class="javascript">            &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择活动区域&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;change&#x27;</span> &#125;</span></span><br><span class="line">          ],</span><br><span class="line">          date1: [</span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">              type: <span class="string">&#x27;date&#x27;</span>,</span></span><br><span class="line"><span class="javascript">              required: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">              message: <span class="string">&#x27;请选择日期&#x27;</span>,</span></span><br><span class="line"><span class="javascript">              trigger: <span class="string">&#x27;change&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          date2: [</span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">              type: <span class="string">&#x27;date&#x27;</span>,</span></span><br><span class="line"><span class="javascript">              required: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">              message: <span class="string">&#x27;请选择时间&#x27;</span>,</span></span><br><span class="line"><span class="javascript">              trigger: <span class="string">&#x27;change&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          type: [</span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">              type: <span class="string">&#x27;array&#x27;</span>,</span></span><br><span class="line"><span class="javascript">              required: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">              message: <span class="string">&#x27;请至少选择一个活动性质&#x27;</span>,</span></span><br><span class="line"><span class="javascript">              trigger: <span class="string">&#x27;change&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          resource: [</span><br><span class="line"><span class="javascript">            &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择活动资源&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;change&#x27;</span> &#125;</span></span><br><span class="line">          ],</span><br><span class="line"><span class="javascript">          desc: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请填写活动形式&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;]</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">submitForm</span>(<span class="params">formName</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$refs[formName].validate(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (valid) &#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">&#x27;submit!&#x27;</span>);</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&#x27;error submit!!&#x27;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">resetForm</span>(<span class="params">formName</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$refs[formName].resetFields();</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.demo-ruleForm</span> &#123;</span></span><br><span class="line">    margin: 0 auto;</span><br><span class="line">    width: 50%;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="修改路由"><a href="#修改路由" class="headerlink" title="修改路由"></a>修改路由</h3><p>将 <code>view/About.vue</code> 改名为 <code>Custom.vue</code></p>
<blockquote>
<p>index.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span> <span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span> <span class="keyword">import</span> Home <span class="keyword">from</span></span><br><span class="line"><span class="string">&#x27;../views/Home.vue&#x27;</span> Vue.use(VueRouter) <span class="keyword">const</span> routes = [ &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">name</span>:</span><br><span class="line"><span class="string">&quot;home&quot;</span>, <span class="attr">component</span>: Home &#125;, &#123; <span class="attr">path</span>: <span class="string">&quot;/custom&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;custom&quot;</span>, <span class="comment">// route level</span></span><br><span class="line">code-splitting <span class="comment">// this generates a separate chunk (about.[hash].js) for this</span></span><br><span class="line">route <span class="comment">// which is lazy-loaded when the route is visited. component: () =&gt;</span></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;custom&quot; */</span> <span class="string">&quot;../views/Custom.vue&quot;</span>) &#125; ]; <span class="keyword">const</span> router</span><br><span class="line">= <span class="keyword">new</span> VueRouter(&#123; <span class="attr">mode</span>: <span class="string">&#x27;history&#x27;</span>, <span class="attr">base</span>: process.env.BASE_URL, routes &#125;) <span class="keyword">export</span></span><br><span class="line"><span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>

<blockquote>
<p>App.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>ElementUI Form<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">      |</span><br><span class="line">      <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/custom&quot;</span>&gt;</span>Custom Form<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="自定义-Form-组件（带校验）"><a href="#自定义-Form-组件（带校验）" class="headerlink" title="自定义 Form 组件（带校验）"></a>自定义 Form 组件（带校验）</h2><h3 id="组件结构"><a href="#组件结构" class="headerlink" title="组件结构"></a>组件结构</h3><img src="/posts/21485/form%E7%BB%84%E4%BB%B6.png" class="" title="自定义Form表单组件">

<p>在 <code>components</code> 文件夹下新建 <code>swForm</code> 文件夹作为自定义组件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">└── swForm</span><br><span class="line">    ├── SwForm.vue</span><br><span class="line">    ├── SwFormItem.vue</span><br><span class="line">    ├── SwInput.vue</span><br><span class="line">    └── index.vue</span><br></pre></td></tr></table></figure>

<h3 id="最终使用"><a href="#最终使用" class="headerlink" title="最终使用"></a>最终使用</h3><blockquote>
<p>index.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>自定义Form表单组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sw-form</span> <span class="attr">:model</span>=<span class="string">&quot;model&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;rules&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;loginForm&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">sw-form-item</span> <span class="attr">label</span>=<span class="string">&quot;用户名&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">        &lt;sw-input</span><br><span class="line">          v-model=&quot;model.username&quot;</span><br><span class="line">          autocomplete=&quot;off&quot;</span><br><span class="line">          placeholder=&quot;输入用户名&quot;</span><br><span class="line">        &gt;<span class="tag">&lt;/<span class="name">sw-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">sw-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">sw-form-item</span> <span class="attr">label</span>=<span class="string">&quot;确认密码&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">        &lt;sw-input</span><br><span class="line">          type=&quot;password&quot;</span><br><span class="line">          v-model=&quot;model.password&quot;</span><br><span class="line">          autocomplete=&quot;off&quot;</span><br><span class="line">        &gt;<span class="tag">&lt;/<span class="name">sw-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">sw-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">sw-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;submitForm(&#x27;loginForm&#x27;)&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">sw-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sw-form</span>&gt;</span></span><br><span class="line">    &#123;&#123;model&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> SwForm <span class="keyword">from</span> <span class="string">&#x27;./SwForm&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> SwFormItem <span class="keyword">from</span> <span class="string">&#x27;./SwFormItem&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> SwInput <span class="keyword">from</span> <span class="string">&#x27;./SwInput&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    components: &#123;</span><br><span class="line">      SwForm,</span><br><span class="line">      SwFormItem,</span><br><span class="line">      SwInput</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        model: &#123;</span><br><span class="line"><span class="javascript">          username: <span class="string">&#x27;Lance&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          password: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        rules: &#123;</span><br><span class="line">          username: [</span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">              required: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">              message: <span class="string">&#x27;请输入用户名&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          password: [</span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">              required: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">              message: <span class="string">&#x27;请输入密码&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">submitForm</span>(<span class="params">form</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$refs[form].validate(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          alert(valid ? <span class="string">&#x27;开始请求登录!&#x27;</span> : <span class="string">&#x27;校验失败&#x27;</span>);</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="预留插槽-slot"><a href="#预留插槽-slot" class="headerlink" title="预留插槽 slot"></a>预留插槽 slot</h3><p>根据上面的表单组件结构图，可以分别给 <code>SwForm</code>、<code>SwFormItem</code> 设置 slot 插槽：</p>
<blockquote>
<p>SwForm</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>SwFormItem</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="实现自定义-input-的双向数据绑定"><a href="#实现自定义-input-的双向数据绑定" class="headerlink" title="实现自定义 input 的双向数据绑定"></a>实现自定义 input 的双向数据绑定</h3><h4 id="知识点-v-model-本质"><a href="#知识点-v-model-本质" class="headerlink" title="知识点 - v-model 本质"></a>知识点 - v-model 本质</h4><p>Vue 中对于 <code>v-model</code> 的解释： <code>v-model</code> 本质上不过是语法糖。它负责监听用户的输入事件以更新数据，并对一些极端场景进行一些特殊处理。<code>v-model</code> 会忽略所有表单元素的 「value」、「checked」、「selected」 特性的初始值而总是将 Vue 实例的数据作为数据来源。你应该通过 JavaScript 在组件的 data 选项中声明初始值。</p>
<p><strong>所以 <code>v-model</code> 其实只是将值绑定到 <code>value</code> 属性上，同时当组件触发 input 时用参数覆盖 value 属性，从而实现双向绑定。</strong></p>
<p>所以当我们自定义组件要实现双向绑定，只要在自定义组件中引入 value 的 props，同时当需要改变 value 时抛出 input 事件就 OK 了。</p>
<p>所以我们在 <code>SwInput.vue</code> 中的代码实现如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">:value</span>=<span class="string">&quot;value&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;onInput&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    props: &#123;</span><br><span class="line">      value: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">String</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">onInput</span>(<span class="params">e</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;input&#x27;</span>, e.target.value);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="给-input-元素绑定-placeholder-属性-inheritAttrs"><a href="#给-input-元素绑定-placeholder-属性-inheritAttrs" class="headerlink" title="给 input 元素绑定 placeholder 属性 - inheritAttrs"></a>给 input 元素绑定 placeholder 属性 - inheritAttrs</h3><p>如果我们观察 element-ui 提供的 <code>el-input</code> 组件会发现，设置的 <code>placeholder</code> 属性能作用在最终的真正的 input 元素上：</p>
<blockquote>
<p>代码</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-input</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入活动名称&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>页面展示</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;input</span><br><span class="line">  type=&quot;text&quot;</span><br><span class="line">  autocomplete=&quot;off&quot;</span><br><span class="line">  placeholder=&quot;请输入活动名称&quot;</span><br><span class="line">  class=&quot;el-input__inner&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>然而我们的 <code>SwInput</code> 组件目前的 HTML 结构为：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">:value</span>=<span class="string">&quot;value&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;onInput&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果我们在使用 <code>SwInput</code> 组件并设置 <code>placeholder</code> 时，最终的属性会作用在外层的 div 上，而不是 input 上：</p>
<blockquote>
<p>代码</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;sw-input</span><br><span class="line">  v-model=&quot;model.username&quot;</span><br><span class="line">  autocomplete=&quot;off&quot;</span><br><span class="line">  placeholder=&quot;输入用户名&quot;</span><br><span class="line">&gt;<span class="tag">&lt;/<span class="name">sw-input</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>页面效果</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  data-v-a9396722=&quot;&quot;</span><br><span class="line">  autocomplete=&quot;off&quot;</span><br><span class="line">  placeholder=&quot;输入用户名&quot;</span><br><span class="line">  data-v-43522ae2=&quot;&quot;</span><br><span class="line">&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">data-v-a9396722</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>那怎么才能把添加到组件上的 <code>placeholder</code> 属性交给里边的 input 元素呢？</p>
<p>通常情况下，我们会使用 props 传值的方式完成，但这种方案有种缺陷，那就是一旦我们有很多类似 <code>placeholder</code> 这样的自定义的属性需要设置，那 props 就会非常臃肿。</p>
<p>所以我们使用另一种方案：<a href="https://cn.vuejs.org/v2/api/#inheritAttrs">Vue.js - inheritAttrs</a></p>
<p>官方文档上说：</p>
<blockquote>
<p>通过设置 inheritAttrs 到 false，这些默认行为将会被去掉。而通过 (同样是 2.4 新增的) 实例属性 $attrs 可以让这些特性生效，且可以通过 v-bind 显性的绑定到非根元素上。</p>
</blockquote>
<p>一句话总结，我们可以利用 Vue 的 inheritAttrs api，让添加到组件上的属性最终作用于非根元素上。</p>
<p>接下来我们用这种方案改造 <code>SwInput</code> ：</p>
<blockquote>
<p>SwInput</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用 v-bind=&quot;$attrs&quot; 将父组件设置给当前组件的属性，全部移交给子元素 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">:value</span>=<span class="string">&quot;value&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;onInput&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;$attrs&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">     <span class="comment">// 设置继承属性为false</span></span></span><br><span class="line"><span class="javascript">     inheritAttrs: <span class="literal">false</span>,</span></span><br><span class="line">     ...</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样一来我们就把属性设置给了真正的 <code>SwInput</code> 组件中的 input 元素。</p>
<h3 id="Form-表单校验"><a href="#Form-表单校验" class="headerlink" title="Form 表单校验"></a>Form 表单校验</h3><h4 id="给-SwFormItem-添加-label-以及校验信息"><a href="#给-SwFormItem-添加-label-以及校验信息" class="headerlink" title="给 SwFormItem 添加 label 以及校验信息"></a>给 <code>SwFormItem</code> 添加 label 以及校验信息</h4><blockquote>
<p>SwFormItem</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">v-if</span>=<span class="string">&quot;label&quot;</span>&gt;</span>&#123;&#123; label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;errorMessage&quot;</span>&gt;</span>&#123;&#123; errorMessage &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    props: &#123;</span><br><span class="line">      label: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">String</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">      prop: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 如果当前item有校验，则prop必传，与对应model字段名相同</span></span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">String</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        errorMessage: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="使用-provide-inject-传递数据"><a href="#使用-provide-inject-传递数据" class="headerlink" title="使用 provide/inject 传递数据"></a>使用 provide/inject 传递数据</h4><p>由于我们的 <code>model</code> 和 <code>rules</code> 是传给了最外层的 <code>SwForm</code> ，而真正做校验的是 <code>SwFormItem</code> ，并且校验是离不开规则 <code>rules</code> 的，所以我们得把数据传给子组件，这里使用 <a href="https://cn.vuejs.org/v2/api/#provide-inject">provide/inject</a> ，它的作用 Vue 官方有写：</p>
<blockquote>
<p>这对选项需要一起使用，以允许一个祖先组件向其所有子孙后代注入一个依赖，不论组件层次有多深，并在起上下游关系成立的时间里始终生效。如果你熟悉 React，这与 React 的上下文特性很相似。</p>
</blockquote>
<p>所以我们接下来需要在 <code>SwForm</code> 中通过 provide 将数据传给后代子孙，后代子孙（<code>SwFormItem</code>）通过 inject 接收数据。</p>
<blockquote>
<p>SwForm</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">provide</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 将自己传给子孙后代</span></span></span><br><span class="line"><span class="javascript">        form: <span class="built_in">this</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    props: &#123;</span><br><span class="line">      model: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 模型</span></span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">        required: <span class="literal">true</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">      rules: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 规则</span></span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">Object</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>SwFormItem</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Schema <span class="keyword">from</span> <span class="string">&#x27;async-validator&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">     inject: [<span class="string">&quot;form&quot;</span>],</span></span><br><span class="line">     ...</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="派发-input-事件并校验"><a href="#派发-input-事件并校验" class="headerlink" title="派发 input 事件并校验"></a>派发 input 事件并校验</h4><p>我们的校验通常在 input 元素的 input 事件触发以后，所以得在 <code>SwInput</code> 组件中派发事件，然后在它的父组件 <code>SwFormItem</code> 中监听事件：</p>
<blockquote>
<p>SwInput</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">     ...</span><br><span class="line">     methods: &#123;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">onInput</span>(<span class="params">e</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">           <span class="built_in">this</span>.$emit(<span class="string">&quot;input&quot;</span>, e.target.value);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">           <span class="built_in">this</span>.$parent.$emit(<span class="string">&#x27;validate&#x27;</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>SwFormItem</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// npm i async-validator -S</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Schema <span class="keyword">from</span> <span class="string">&#x27;async-validator&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    inject: [<span class="string">&#x27;form&#x27;</span>],</span></span><br><span class="line">    props: &#123;</span><br><span class="line">      label: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">String</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">      prop: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">String</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        errorMessage: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$on(<span class="string">&#x27;validate&#x27;</span>, <span class="built_in">this</span>.validate);</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">validate</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 做校验</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> value = <span class="built_in">this</span>.form.model[<span class="built_in">this</span>.prop];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> rules = <span class="built_in">this</span>.form.rules[<span class="built_in">this</span>.prop];</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 设置校验规则</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> desc = &#123;</span></span><br><span class="line"><span class="javascript">          [<span class="built_in">this</span>.prop]: rules</span></span><br><span class="line">        &#125;;</span><br><span class="line"><span class="javascript">        <span class="comment">// 实例化 Schema</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> schema = <span class="keyword">new</span> Schema(desc);</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 开始校验</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> schema.validate(</span></span><br><span class="line">          &#123;</span><br><span class="line"><span class="javascript">            [<span class="built_in">this</span>.prop]: value</span></span><br><span class="line">          &#125;,</span><br><span class="line">          errors =&gt; &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.errorMessage = errors ? errors[<span class="number">0</span>].message : <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line">          &#125;</span><br><span class="line"><span class="javascript">        ); <span class="comment">// return 的是个 Promise</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>写完上述代码后，当你将表单中的文本框内容清空，就能看到校验提示了。</p>
<h4 id="Form-表单提交校验"><a href="#Form-表单提交校验" class="headerlink" title="Form 表单提交校验"></a>Form 表单提交校验</h4><p>当用户填完所有表单点击提交时，我们还得将整个表单需要校验的地方都校验一遍，然后告知用户是否成功通知校验，所以我们还得在 <code>SwForm</code> 组件中添加一个 <code>validate</code> 方法，用于判断所有需要校验的地方是否都通过了校验：</p>
<blockquote>
<p>SwForm</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">provide</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 将自己传给子孙后代</span></span></span><br><span class="line"><span class="javascript">        form: <span class="built_in">this</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    props: &#123;</span><br><span class="line">      model: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 模型</span></span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">        required: <span class="literal">true</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">      rules: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 规则</span></span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">Object</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">validate</span>(<span class="params">cb</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 找到所有需要校验的 SwFormItem（带有prop的都是），拿到它们中的 validate 校验方法</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> tasks = <span class="built_in">this</span>.$children</span></span><br><span class="line"><span class="javascript">          .filter(<span class="function"><span class="params">item</span> =&gt;</span> item.prop)</span></span><br><span class="line"><span class="javascript">          .map(<span class="function"><span class="params">item</span> =&gt;</span> item.validate());</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(tasks);</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 所有任务都通过才算校验通过</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">Promise</span>.all(tasks)</span></span><br><span class="line"><span class="javascript">          .then(<span class="function">() =&gt;</span> cb(<span class="literal">true</span>))</span></span><br><span class="line"><span class="javascript">          .catch(<span class="function">() =&gt;</span> cb(<span class="literal">false</span>));</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue项目中使用海康威视web插件</title>
    <url>/posts/762/</url>
    <content><![CDATA[<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>物流项目中需要在 web 端接入港口的视频监控，摄像头是海康威视的，数据协议是 rtsp，后端表示希望前端直接解码，而不通过将 rtsp 转为 rtmp 的方式与前端交互。</p>
<h2 id="寻找方案"><a href="#寻找方案" class="headerlink" title="寻找方案"></a>寻找方案</h2><p>找前端的解决方案就找了一下午，各种 google 几乎所有文章都说没法单靠浏览器完成对 rtsp 视频流的渲染。这里列几个我觉得对 rtsp 相关知识有帮助的文章吧：</p>
<ul>
<li><a href="https://flashphoner.com/7-ways-to-stream-rtsp-on-the-page/">7 ways to stream RTSP on the page</a></li>
<li><a href="https://www.cnblogs.com/dreamsqin/p/12557070.html">前端视频直播技术总结及 video.js 在 h5 页面中的应用</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/337712456">在 Chrome、Firefox 等高版本浏览器中实现低延迟播放海康、大华 RTSP</a></li>
<li><a href="https://developer.aliyun.com/article/243466">谷歌浏览器 Chrome 播放 rtsp 视频流解决方案</a></li>
</ul>
<p>其中最后一个用 vlc 插件播放 rtsp 我离成功就差一步。视频能放了，但是播一段时间后画面就不动了，再过一会浏览器就卡死不动了… 尝试了各种办法，wiki 文档看了也无济于事，最后放弃了这个方案。</p>
<a id="more"></a>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>最终，查看了海康威视的官网接口文档，找到了 web 端能够使用的<a href="https://open.hikvision.com/download/5c67f1e2f05948198c909700?type=10">视频插件</a>:</p>
<img src="/posts/762/web-plugin.png" class="" title="web-plugin">

<p>提供了文档和程序包下载。</p>
<p>通过阅读文档和运行 demo，实现了 web 端播放 rtsp 实时监控，demo 我运行的下图中红框圈出的 html 文件：</p>
<img src="/posts/762/demo.png" class="" title="demo">

<p>示例项目中需要填写的参数是：</p>
<img src="/posts/762/par.png" class="" title="params">

<p>这些参数需要后端提供。</p>
<h2 id="Vue-中使用"><a href="#Vue-中使用" class="headerlink" title="Vue 中使用"></a>Vue 中使用</h2><p>这里直接贴代码吧，我写了个组件封装了下：</p>
<blockquote>
<p>components/common/hikvisionGrid/index.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  &lt;div</span><br><span class="line">    id=&quot;hikvision-grid&quot;</span><br><span class="line">    class=&quot;wrapper&quot;</span><br><span class="line">    ref=&quot;wrapper&quot;</span><br><span class="line">    :style=&quot;&#123; width: &#x27;100%&#x27;, height: &#x27;100%&#x27; &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&quot;oWebControl&quot;</span><br><span class="line">      :id=&quot;setting.id&quot;</span><br><span class="line">      :class=&quot;[oWebControl === null ? &#x27;videoNull&#x27; : &#x27;&#x27;]&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-show</span>=<span class="string">&quot;!oWebControl&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-html</span>=<span class="string">&quot;playText&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-show</span>=<span class="string">&quot;playText.includes(&#x27;插件启动失败&#x27;)&quot;</span>&gt;</span></span><br><span class="line">        下载完成？</span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;destroyedAndCreate&quot;</span>&gt;</span></span><br><span class="line">          点击此处</span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        启动插件</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 从父组件传递过来的</span></span></span><br><span class="line">    props: &#123;</span><br><span class="line">      setting: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 设置项，带id</span></span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line">          id: 1</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      sysParams: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 系统参数</span></span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="javascript">          appkey: <span class="string">&#x27;29228660&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          secret: <span class="string">&#x27;eDSkiRPcZ9VTSGt8zT7p&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          ip: <span class="string">&#x27;57.215.7.52&#x27;</span>,</span></span><br><span class="line">          port: 443</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      list: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// cameraCode列表</span></span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">Array</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="function">() =&gt;</span> []</span></span><br><span class="line">      &#125;,</span><br><span class="line">      layout: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 布局</span></span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">String</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="string">&#x27;2x2&#x27;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        videoWidth: 0,</span><br><span class="line">        videoHeight: 0,</span><br><span class="line"><span class="javascript">        left: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        top: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        initCount: <span class="number">0</span>, <span class="comment">// 启动次数</span></span></span><br><span class="line"><span class="javascript">        playMode: <span class="number">0</span>, <span class="comment">// 0 预览 1回放</span></span></span><br><span class="line"><span class="javascript">        playText: <span class="string">&#x27;加载中...&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        cameraIndexCode: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 监控点编号</span></span></span><br><span class="line"><span class="javascript">        oWebControl: <span class="literal">null</span>,</span></span><br><span class="line"><span class="javascript">        href: <span class="string">&#x27;hikvision/VideoWebPlugin.exe&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        selfEle: <span class="literal">null</span> <span class="comment">// 自身原始</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 当前组件</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.selfEle = <span class="built_in">this</span>.$refs.wrapper;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.observeWrapper();</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 监听自身容器大小变化</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">observeWrapper</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 监听 自身容器 元素宽度的变化</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> ro = <span class="keyword">new</span> ResizeObserver(<span class="function"><span class="params">entries</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> entries) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> cr = entry.contentRect;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.videoWidth = cr.width;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.videoHeight = cr.height;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.oWebControl &amp;&amp;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">this</span>.oWebControl.JS_Resize(<span class="built_in">this</span>.videoWidth, <span class="built_in">this</span>.videoHeight);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.oWebControl &amp;&amp; <span class="built_in">this</span>.setWndCover();</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="javascript">        ro.observe(<span class="built_in">document</span>.querySelector(<span class="string">&#x27;#hikvision-grid&#x27;</span>));</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化+预览</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">createdVideo</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.playText = <span class="string">&#x27;启动中...&#x27;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.initPlugin(<span class="built_in">this</span>.setting.id, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.multiPreviewVideo();</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 销毁插件</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">destroyWnd</span>(<span class="params">cb</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="built_in">this</span>.oWebControl) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.oWebControl.JS_HideWnd();</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.oWebControl</span></span><br><span class="line">            .JS_DestroyWnd(&#123;</span><br><span class="line"><span class="javascript">              funcName: <span class="string">&#x27;destroyeWnd&#x27;</span></span></span><br><span class="line">            &#125;)</span><br><span class="line"><span class="javascript">            .then(<span class="function"><span class="keyword">function</span> (<span class="params">oData</span>) </span>&#123;&#125;);</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&#x27;没有实例&#x27;</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 销毁并重启</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">destroyedAndCreate</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.destroyWnd(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.createdVideo();</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">init</span>(<span class="params">callback</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.getPubKey(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">////////////////////////////////// 请自行修改以下变量值   ////////////////////////////////////</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> appkey = <span class="built_in">this</span>.sysParams.appkey; <span class="comment">//综合安防管理平台提供的appkey，必填</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> secret = <span class="built_in">this</span>.setEncrypt(<span class="built_in">this</span>.sysParams.secret); <span class="comment">//综合安防管理平台提供的secret，必填</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> ip = <span class="built_in">this</span>.sysParams.ip; <span class="comment">//综合安防管理平台IP地址，必填</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> playMode = <span class="built_in">this</span>.playMode; <span class="comment">//初始播放模式：0-预览，1-回放</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> port = <span class="built_in">this</span>.sysParams.port; <span class="comment">//综合安防管理平台端口，若启用HTTPS协议，默认443</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> snapDir = <span class="string">&#x27;D:\\SnapDir&#x27;</span>; <span class="comment">//抓图存储路径</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> videoDir = <span class="string">&#x27;D:\\VideoDir&#x27;</span>; <span class="comment">//紧急录像或录像剪辑存储路径</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> layout = <span class="built_in">this</span>.layout; <span class="comment">//playMode指定模式的布局</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> enableHTTPS = <span class="number">1</span>; <span class="comment">//是否启用HTTPS协议与综合安防管理平台交互，是为1，否为0</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> encryptedFields = <span class="string">&#x27;secret&#x27;</span>; <span class="comment">//加密字段，默认加密领域为secret</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> showToolbar = <span class="number">0</span>; <span class="comment">//是否显示工具栏，0-不显示，非0-显示</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> showSmart = <span class="number">0</span>; <span class="comment">//是否显示智能信息（如配置移动侦测后画面上的线框），0-不显示，非0-显示</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> buttonIDs =</span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;0,16,256,257,258,259,260,512,513,514,515,516,517,768,769&#x27;</span>; <span class="comment">//自定义工具条按钮</span></span></span><br><span class="line"><span class="javascript">          <span class="comment">////////////////////////////////// 请自行修改以上变量值   ////////////////////////////////////</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.oWebControl</span></span><br><span class="line">            .JS_RequestInterface(&#123;</span><br><span class="line"><span class="javascript">              funcName: <span class="string">&#x27;init&#x27;</span>,</span></span><br><span class="line"><span class="javascript">              argument: <span class="built_in">JSON</span>.stringify(&#123;</span></span><br><span class="line"><span class="javascript">                appkey: appkey, <span class="comment">//API网关提供的appkey</span></span></span><br><span class="line"><span class="javascript">                secret: secret, <span class="comment">//API网关提供的secret</span></span></span><br><span class="line"><span class="javascript">                ip: ip, <span class="comment">//API网关IP地址</span></span></span><br><span class="line"><span class="javascript">                playMode: playMode, <span class="comment">//播放模式（决定显示预览还是回放界面）</span></span></span><br><span class="line"><span class="javascript">                port: port, <span class="comment">//端口</span></span></span><br><span class="line"><span class="javascript">                snapDir: snapDir, <span class="comment">//抓图存储路径</span></span></span><br><span class="line"><span class="javascript">                videoDir: videoDir, <span class="comment">//紧急录像或录像剪辑存储路径</span></span></span><br><span class="line"><span class="javascript">                layout: layout, <span class="comment">//布局</span></span></span><br><span class="line"><span class="javascript">                enableHTTPS: enableHTTPS, <span class="comment">//是否启用HTTPS协议</span></span></span><br><span class="line"><span class="javascript">                encryptedFields: encryptedFields, <span class="comment">//加密字段</span></span></span><br><span class="line"><span class="javascript">                showToolbar: showToolbar, <span class="comment">//是否显示工具栏</span></span></span><br><span class="line"><span class="javascript">                showSmart: showSmart, <span class="comment">//是否显示智能信息</span></span></span><br><span class="line"><span class="javascript">                buttonIDs: buttonIDs <span class="comment">//自定义工具条按钮</span></span></span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line"><span class="javascript">            .then(<span class="function"><span class="params">oData</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 初始化后resize一次，规避firefox下首次显示窗口后插件窗口未与DIV窗口重合问题</span></span></span><br><span class="line"><span class="javascript">              <span class="built_in">this</span>.oWebControl.JS_Resize(<span class="built_in">this</span>.videoWidth, <span class="built_in">this</span>.videoHeight);</span></span><br><span class="line">              callback &amp;&amp; callback();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 创建播放实例</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">initPlugin</span>(<span class="params">id, callback</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> that = <span class="built_in">this</span>;</span></span><br><span class="line"><span class="javascript">        that.oWebControl = <span class="keyword">new</span> WebControl(&#123;</span></span><br><span class="line"><span class="javascript">          szPluginContainer: id, <span class="comment">// 指定容器id</span></span></span><br><span class="line"><span class="javascript">          iServicePortStart: <span class="number">15900</span>, <span class="comment">// 指定起止端口号，建议使用该值</span></span></span><br><span class="line">          iServicePortEnd: 15909,</span><br><span class="line"><span class="javascript">          szClassId: <span class="string">&#x27;23BF3B0A-2C56-4D97-9C03-0CB103AA8F11&#x27;</span>, <span class="comment">// 用于IE10使用ActiveX的clsid</span></span></span><br><span class="line"><span class="javascript">          cbConnectSuccess: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 创建WebControl实例成功</span></span></span><br><span class="line">            that.oWebControl</span><br><span class="line"><span class="javascript">              .JS_StartService(<span class="string">&#x27;window&#x27;</span>, &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// WebControl实例创建成功后需要启动服务</span></span></span><br><span class="line"><span class="javascript">                dllPath: <span class="string">&#x27;./VideoPluginConnect.dll&#x27;</span> <span class="comment">// 值&quot;./VideoPluginConnect.dll&quot;写死</span></span></span><br><span class="line">              &#125;)</span><br><span class="line">              .then(</span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                  <span class="comment">// 启动插件服务成功</span></span></span><br><span class="line">                  that.oWebControl.JS_SetWindowControlCallback(&#123;</span><br><span class="line"><span class="javascript">                    <span class="comment">// 设置消息回调</span></span></span><br><span class="line">                    cbIntegrationCallBack: that.cbIntegrationCallBack</span><br><span class="line">                  &#125;);</span><br><span class="line"></span><br><span class="line">                  that.oWebControl</span><br><span class="line">                    .JS_CreateWnd(id, that.videoWidth, that.videoHeight)</span><br><span class="line"><span class="javascript">                    .then(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                      <span class="comment">//JS_CreateWnd创建视频播放窗口，宽高可设定</span></span></span><br><span class="line"><span class="javascript">                      that.init(callback); <span class="comment">// 创建播放实例成功后初始化</span></span></span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;,</span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                  <span class="comment">// 启动插件服务失败</span></span></span><br><span class="line">                &#125;</span><br><span class="line">              );</span><br><span class="line">          &#125;,</span><br><span class="line"><span class="javascript">          cbConnectError: <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 创建WebControl实例失败</span></span></span><br><span class="line"><span class="javascript">            that.oWebControl = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">            that.playText = <span class="string">&#x27;插件未启动，正在尝试启动，请稍候...&#x27;</span>;</span></span><br><span class="line"><span class="javascript">            WebControl.JS_WakeUp(<span class="string">&#x27;VideoWebPlugin://&#x27;</span>); <span class="comment">// 程序未启动时执行error函数，采用wakeup来启动程序</span></span></span><br><span class="line">            that.initCount++;</span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (that.initCount &lt; <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">                that.initPlugin();</span><br><span class="line">              &#125;, 3000);</span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">              that.playText = `插件启动失败，请检查插件是否安装！<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">$&#123;this.href&#125;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">download</span>=<span class="string">&quot;VideoWebPlugin.exe&quot;</span> <span class="attr">style</span>=<span class="string">&#x27;color:#4194fc&#x27;</span>&gt;</span>下载地址<span class="tag">&lt;/<span class="name">a</span>&gt;</span>`;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line"><span class="javascript">          cbConnectClose: <span class="function"><span class="params">bNormalClose</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 异常断开：bNormalClose = false</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// JS_Disconnect正常断开：bNormalClose = true</span></span></span><br><span class="line"><span class="javascript">            that.oWebControl = <span class="literal">null</span>;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 关闭</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">handleClose</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="built_in">this</span>.oWebControl) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.oWebControl.JS_RequestInterface(&#123;</span></span><br><span class="line"><span class="javascript">            funcName: <span class="string">&#x27;stopAllPreview&#x27;</span></span></span><br><span class="line">          &#125;);</span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.oWebControl.JS_HideWnd(); <span class="comment">// 先让窗口隐藏，规避可能的插件窗口滞后于浏览器消失问题</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.oWebControl.JS_Disconnect().then(</span></span><br><span class="line">            () =&gt; &#123;</span><br><span class="line"><span class="javascript">              <span class="comment">// 断开与插件服务连接成功</span></span></span><br><span class="line">            &#125;,</span><br><span class="line">            () =&gt; &#123;</span><br><span class="line"><span class="javascript">              <span class="comment">// 断开与插件服务连接失败</span></span></span><br><span class="line">            &#125;</span><br><span class="line">          );</span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.oWebControl = <span class="literal">null</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 消息回调</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">cbIntegrationCallBack</span>(<span class="params">oData</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// console.log(oData);</span></span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 预览</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">previewVideo</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> cameraIndexCode = <span class="built_in">this</span>.cameraIndexCode; <span class="comment">// 获取输入的监控点编号值，必填</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> streamMode = <span class="number">1</span>; <span class="comment">// 主子码流标识：0-主码流，1-子码流</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> transMode = <span class="number">1</span>; <span class="comment">// 传输协议：0-UDP，1-TCP</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> gpuMode = <span class="number">0</span>; <span class="comment">// 是否启用GPU硬解，0-不启用，1-启用</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> wndId = -<span class="number">1</span>; <span class="comment">// 播放窗口序号（在2x2以上布局下可指定播放窗口）</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.oWebControl.JS_RequestInterface(&#123;</span></span><br><span class="line"><span class="javascript">          funcName: <span class="string">&#x27;startPreview&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          argument: <span class="built_in">JSON</span>.stringify(&#123;</span></span><br><span class="line"><span class="javascript">            cameraIndexCode: cameraIndexCode.trim(), <span class="comment">// 监控点编号</span></span></span><br><span class="line"><span class="javascript">            streamMode: streamMode, <span class="comment">// 主子码流标识</span></span></span><br><span class="line"><span class="javascript">            transMode: transMode, <span class="comment">// 传输协议</span></span></span><br><span class="line"><span class="javascript">            gpuMode: gpuMode, <span class="comment">// 是否开启GPU硬解</span></span></span><br><span class="line"><span class="javascript">            wndId: wndId <span class="comment">// 可指定播放窗口</span></span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 批量预览</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">multiPreviewVideo</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> streamMode = <span class="number">1</span>; <span class="comment">// 主子码流标识：0-主码流，1-子码流</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> transMode = <span class="number">1</span>; <span class="comment">// 传输协议：0-UDP，1-TCP</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> gpuMode = <span class="number">0</span>; <span class="comment">// 是否启用GPU硬解，0-不启用，1-启用</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.oWebControl</span></span><br><span class="line">          .JS_RequestInterface(&#123;</span><br><span class="line"><span class="javascript">            funcName: <span class="string">&#x27;startMultiPreviewByCameraIndexCode&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            argument: <span class="built_in">JSON</span>.stringify(&#123;</span></span><br><span class="line"><span class="javascript">              list: <span class="built_in">this</span>.list.map(<span class="function">(<span class="params">camera, idx</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                  cameraIndexCode: camera, <span class="comment">//监控点编号</span></span></span><br><span class="line"><span class="javascript">                  streamMode, <span class="comment">//主子码流标识</span></span></span><br><span class="line"><span class="javascript">                  transMode, <span class="comment">//传输协议</span></span></span><br><span class="line"><span class="javascript">                  gpuMode, <span class="comment">//是否开启GPU硬解</span></span></span><br><span class="line"><span class="javascript">                  wndId: idx + <span class="number">1</span> <span class="comment">// 播放窗口序号（在2x2以上布局下可指定播放窗口）</span></span></span><br><span class="line">                &#125;;</span><br><span class="line"><span class="javascript">              &#125;) <span class="comment">// 监控点编号集合</span></span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line"><span class="javascript">          .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (res.errorCode === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">console</span>.log(<span class="string">&#x27;预览成功&#x27;</span>);</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">//获取公钥</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">getPubKey</span>(<span class="params">callback</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.oWebControl</span></span><br><span class="line">          .JS_RequestInterface(&#123;</span><br><span class="line"><span class="javascript">            funcName: <span class="string">&#x27;getRSAPubKey&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            argument: <span class="built_in">JSON</span>.stringify(&#123;</span></span><br><span class="line">              keyLength: 1024</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line"><span class="javascript">          .then(<span class="function"><span class="params">oData</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (oData.responseMsg.data) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">this</span>.pubKey = oData.responseMsg.data;</span></span><br><span class="line">              callback();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">//RSA加密</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">setEncrypt</span>(<span class="params">value</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> encrypt = <span class="keyword">new</span> JSEncrypt();</span></span><br><span class="line"><span class="javascript">        encrypt.setPublicKey(<span class="built_in">this</span>.pubKey);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> encrypt.encrypt(value);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 设置窗口裁剪，当因滚动条滚动导致窗口需要被遮住的情况下需要JS_CuttingPartWindow部分窗口</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">setWndCover</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> iWidth = $(<span class="built_in">window</span>).width(); <span class="comment">// 获取浏览器宽度 不含滚动条</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> iHeight = $(<span class="built_in">window</span>).height();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> oDivRect = $(<span class="string">&#x27;#&#x27;</span> + <span class="built_in">this</span>.setting.id)</span></span><br><span class="line">          .get(0)</span><br><span class="line">          .getBoundingClientRect();</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> iCoverLeft = oDivRect.left &lt; <span class="number">0</span> ? <span class="built_in">Math</span>.abs(oDivRect.left) : <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> iCoverTop = oDivRect.top &lt; <span class="number">0</span> ? <span class="built_in">Math</span>.abs(oDivRect.top) : <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> iCoverRight =</span></span><br><span class="line"><span class="javascript">          oDivRect.right - iWidth &gt; <span class="number">0</span> ? <span class="built_in">Math</span>.round(oDivRect.right - iWidth) : <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> iCoverBottom =</span></span><br><span class="line">          oDivRect.bottom - iHeight &gt; 0</span><br><span class="line"><span class="javascript">            ? <span class="built_in">Math</span>.round(oDivRect.bottom - iHeight)</span></span><br><span class="line">            : 0;</span><br><span class="line"></span><br><span class="line">        iCoverLeft =</span><br><span class="line"><span class="javascript">          iCoverLeft &gt; <span class="built_in">this</span>.videoWidth ? <span class="built_in">this</span>.videoWidth : iCoverLeft;</span></span><br><span class="line"><span class="javascript">        iCoverTop = iCoverTop &gt; <span class="built_in">this</span>.videoHeight ? <span class="built_in">this</span>.videoHeight : iCoverTop;</span></span><br><span class="line">        iCoverRight =</span><br><span class="line"><span class="javascript">          iCoverRight &gt; <span class="built_in">this</span>.videoWidth ? <span class="built_in">this</span>.videoWidth : iCoverRight;</span></span><br><span class="line">        iCoverBottom =</span><br><span class="line"><span class="javascript">          iCoverBottom &gt; <span class="built_in">this</span>.videoHeight ? <span class="built_in">this</span>.videoHeight : iCoverBottom;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 多1个像素点防止还原后边界缺失一个像素条</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.oWebControl.JS_RepairPartWindow(</span></span><br><span class="line">          0,</span><br><span class="line">          0,</span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.videoWidth + <span class="number">1</span>,</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.videoHeight</span></span><br><span class="line">        );</span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (iCoverLeft != <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.oWebControl.JS_CuttingPartWindow(</span></span><br><span class="line">            0,</span><br><span class="line">            0,</span><br><span class="line">            iCoverLeft,</span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.videoHeight</span></span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (iCoverTop != <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 多剪掉一个像素条，防止出现剪掉一部分窗口后出现一个像素条</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.oWebControl.JS_CuttingPartWindow(</span></span><br><span class="line">            0,</span><br><span class="line">            0,</span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.videoWidth + <span class="number">1</span>,</span></span><br><span class="line">            iCoverTop</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (iCoverRight != <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.oWebControl.JS_CuttingPartWindow(</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.videoWidth - iCoverRight,</span></span><br><span class="line">            0,</span><br><span class="line">            iCoverRight,</span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.videoHeight</span></span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (iCoverBottom != <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.oWebControl.JS_CuttingPartWindow(</span></span><br><span class="line">            0,</span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.videoHeight - iCoverBottom,</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.videoWidth,</span></span><br><span class="line">            iCoverBottom</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">destroyed</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.destroyWnd();</span></span><br><span class="line">    &#125;,</span><br><span class="line">    watch: &#123;</span><br><span class="line">      list: &#123;</span><br><span class="line"><span class="javascript">        immediate: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">        deep: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">handler</span>(<span class="params">value</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (value.length &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&#x27;watch海康威视组件的列表list:&#x27;</span>, value);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.destroyedAndCreate();</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.destroyWnd(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">this</span>.oWebControl = <span class="literal">null</span>;</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.playText = <span class="string">&#x27;请选择要播放的监控&#x27;</span>;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.playWnd</span> &#123;</span></span><br><span class="line">    // margin: 30px 0 0 400px;</span><br><span class="line"><span class="css">    <span class="selector-tag">width</span>: 1000<span class="selector-tag">px</span>; <span class="comment">/*播放容器的宽和高设定*/</span></span></span><br><span class="line">    height: 600px;</span><br><span class="line">    border: 1px solid red;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.operate</span> &#123;</span></span><br><span class="line">    margin-top: 24px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.operate</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line">    content: &#x27;&#x27;;</span><br><span class="line">    display: block;</span><br><span class="line">    clear: both;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.module</span> &#123;</span></span><br><span class="line">    float: left;</span><br><span class="line">    width: 340px;</span><br><span class="line"><span class="css">    <span class="comment">/*min-height: 320px;*/</span></span></span><br><span class="line">    margin-left: 16px;</span><br><span class="line">    padding: 16px 8px;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line"><span class="css">    <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#e5e5e5</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.module</span> <span class="selector-class">.item</span> &#123;</span></span><br><span class="line">    margin-bottom: 4px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.module</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&#x27;text&#x27;</span>]</span> &#123;</span></span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    vertical-align: middle;</span><br><span class="line">    margin-left: 0;</span><br><span class="line">    width: 150px;</span><br><span class="line">    min-height: 20px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.module</span> <span class="selector-class">.btn</span> &#123;</span></span><br><span class="line">    min-width: 80px;</span><br><span class="line">    min-height: 24px;</span><br><span class="line">    margin-top: 100px;</span><br><span class="line">    margin-left: 80px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>parent.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;monitor-port d-flex flex-column&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">&lt;!-- 监控组件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hikvision-grid</span> <span class="attr">:list</span>=<span class="string">&quot;curShowList&quot;</span> <span class="attr">:layout</span>=<span class="string">&quot;layout&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">hikvision-grid</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 组件</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> HikvisionGrid <span class="keyword">from</span> <span class="string">&#x27;@/components/common/hikvisionGrid&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        curShowList: [] <span class="comment">// 当前能显示的摄像头</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      HikvisionGrid</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="keyword">async</span> <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.curShowList = [</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;88b1264462b24d47b71d34b042dda16f&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;922c23133fb54cef8810f0b418906bcd&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;674d5788aba44969b63ffef24848d82d&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;2ead926168614d33aa2cbcae5946e621&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;a6dbe5c74a884405903c19ee32d1ea1a&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;c509cdb1a6e6437a9b96a90dcc121369&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;18e892d96fd7498c8f899c9a4d6ee591&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;5be592372de947c696ec2e3aaa5bf020&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;e5a02704013e4a408a3d75fd1e2302fd&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;6f2ba113a09341fd8e92374c85e96071&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;a80494c0509d4992baebf76ca537c9bc&#x27;</span></span></span><br><span class="line">      ];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="查询过的相关资源"><a href="#查询过的相关资源" class="headerlink" title="查询过的相关资源"></a>查询过的相关资源</h2><ul>
<li><a href="https://zhuanlan.zhihu.com/p/94440420">使用 flv.js 快速搭建 html5 网页直播</a></li>
<li><a href="https://segmentfault.com/a/1190000023949105">无插件 web 直播解决方案(不使用 Flash) ，flv.js+ffmpeg+nginx-http-flv-module</a></li>
<li><a href="https://blog.csdn.net/qq_34239851/article/details/107078336">使用 java+ffmpeg+nginx-http-flv 将海康 rtsp 视频流转 http-flv，使 Web 可以无插件播放</a></li>
<li><a href="https://blog.csdn.net/qq_22633333/article/details/96288603">记录 RTSP 通过 FFmpeg+nginx 发布成 rtmp 和 http-flv</a></li>
<li><a href="https://www.cnblogs.com/kawhileonardfans/p/13044468.html">Java + Nginx-http-flv-module + FFmpeg + Flv.js 推 Rtsp 流 H5 播放</a></li>
<li><a href="https://github.com/Bilibili/flv.js/">flv.js</a></li>
<li><a href="https://wiki.videolan.org/Documentation:WebPlugin/">VLC Documentation:WebPlugin</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>海康威视</tag>
        <tag>视频监控</tag>
        <tag>RTSP</tag>
      </tags>
  </entry>
  <entry>
    <title>element-ui的form表单验证</title>
    <url>/posts/38065/</url>
    <content><![CDATA[<p>转载自：<a href="https://my.oschina.net/u/4374872/blog/3701890">https://my.oschina.net/u/4374872/blog/3701890</a></p>
<h2 id="普通输入验证"><a href="#普通输入验证" class="headerlink" title="普通输入验证"></a>普通输入验证</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动名称&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- validate-event属性的作用是: 输入时不触发表单验证.提交时再验证,你也可以设置成动态验证 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;registerData.name&quot;</span> <span class="attr">:validate-event</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    rules: &#123;</span><br><span class="line">      <span class="comment">// 表单验证规则</span></span><br><span class="line">      name: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入活动名称&#x27;</span> &#125;, <span class="comment">// &#x27;blur&#x27;是鼠标失去焦点的时候会触发验证</span></span><br><span class="line">        &#123; <span class="attr">min</span>: <span class="number">3</span>, <span class="attr">max</span>: <span class="number">5</span>, <span class="attr">message</span>: <span class="string">&#x27;长度在 3 到 5 个字符&#x27;</span> &#125;</span><br><span class="line">      ];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="数字类型验证"><a href="#数字类型验证" class="headerlink" title="数字类型验证"></a>数字类型验证</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;区域面积&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;area&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 输入的类型为Number时,需要加一个数字转换的修饰符,输入框默认的类型是String类型,但是我试了一下,发现并不能做验证,所以自己写了函数方法验证 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;el-input v-model.number=&quot;registData.area&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt; --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- keyup是鼠标弹起事件, autocomplete是input自带的原生属性,自动补全功能,on为开启,off为关闭 --&gt;</span></span><br><span class="line">  &lt;el-input</span><br><span class="line">    v-model=&quot;registData.area&quot;</span><br><span class="line">    @keyup.native=&quot;InputNumber(&#x27;area&#x27;)&quot;</span><br><span class="line">    autocomplete=&quot;off&quot;</span><br><span class="line">  &gt;<span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      area: [</span><br><span class="line">        <span class="comment">// 数字类型 &#x27;number&#x27;, 整数: &#x27;integer&#x27;, 浮点数: &#x27;float&#x27;</span></span><br><span class="line">        <span class="comment">// &#123;type: &#x27;number&#x27;, message: &#x27;请输入数字类型&#x27;, trigger: &#x27;blur&#x27;&#125;,</span></span><br><span class="line">        <span class="comment">// &#123;type: &#x27;integer&#x27;, message: &#x27;请输入数字类型&#x27;, trigger: &#x27;change&#x27;&#125;, // &#x27;change&#x27;是表单的值改变的时候会触发验证</span></span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入区域面积&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 自己写的正则验证,限制用户输入数字以外的字符</span></span><br><span class="line">    <span class="comment">// 过滤输入的金额</span></span><br><span class="line">    <span class="function"><span class="title">InputNumber</span>(<span class="params">property</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.registData[property] = <span class="built_in">this</span>.limitInputPointNumber(</span><br><span class="line">        <span class="built_in">this</span>.registData[property]</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证只能输入数字</span></span><br><span class="line">    <span class="function"><span class="title">limitInputNumber</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (val) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">String</span>(val).replace(<span class="regexp">/\D/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> val;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 限制只能输入数字(可以输入两位小数)</span></span><br><span class="line">    <span class="function"><span class="title">limitInputPointNumber</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (val === <span class="number">0</span> || val === <span class="string">&#x27;0&#x27;</span> || val === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> value = <span class="literal">null</span>;</span><br><span class="line">        value = <span class="built_in">String</span>(val).replace(<span class="regexp">/[^\d.]/g</span>, <span class="string">&#x27;&#x27;</span>); <span class="comment">// 清除“数字”和“.”以外的字符</span></span><br><span class="line">        value = value.replace(<span class="regexp">/\.&#123;2,&#125;/g</span>, <span class="string">&#x27;.&#x27;</span>); <span class="comment">// 只保留第一个. 清除多余的</span></span><br><span class="line">        value = value</span><br><span class="line">          .replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;$#$&#x27;</span>)</span><br><span class="line">          .replace(<span class="regexp">/\./g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">          .replace(<span class="string">&#x27;$#$&#x27;</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        value = value.replace(<span class="regexp">/^(-)*(\d+)\.(\d\d).*$/</span>, <span class="string">&#x27;$1$2.$3&#x27;</span>); <span class="comment">// 只能输入两个小数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Number</span>(value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="嵌套验证（独立验证）"><a href="#嵌套验证（独立验证）" class="headerlink" title="嵌套验证（独立验证）"></a>嵌套验证（独立验证）</h2><p>这种情况是一行里有多个输入框或选择的情况,这里有两种方法,第一种是 el-form 嵌套写法,验证是独立的</p>
<img src="/posts/38065/nest-form.png" class="" title="嵌套验证">

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动时间&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">prop</span>=<span class="string">&quot;date1&quot;</span>&gt;</span></span><br><span class="line">      &lt;el-date-picker</span><br><span class="line">        type=&quot;date&quot;</span><br><span class="line">        placeholder=&quot;选择日期&quot;</span><br><span class="line">        v-model=&quot;registData.date1&quot;</span><br><span class="line">        style=&quot;width: 100%;&quot;</span><br><span class="line">      &gt;<span class="tag">&lt;/<span class="name">el-date-picker</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">class</span>=<span class="string">&quot;line&quot;</span> <span class="attr">:span</span>=<span class="string">&quot;2&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">prop</span>=<span class="string">&quot;date2&quot;</span>&gt;</span></span><br><span class="line">      &lt;el-time-picker</span><br><span class="line">        type=&quot;fixed-time&quot;</span><br><span class="line">        placeholder=&quot;选择时间&quot;</span><br><span class="line">        v-model=&quot;registData.date2&quot;</span><br><span class="line">        style=&quot;width: 100%;&quot;</span><br><span class="line">      &gt;<span class="tag">&lt;/<span class="name">el-time-picker</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      date1: [</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">&#x27;date&#x27;</span>,</span><br><span class="line">          required: <span class="literal">true</span>,</span><br><span class="line">          message: <span class="string">&#x27;请选择日期&#x27;</span>,</span><br><span class="line">          trigger: <span class="string">&#x27;change&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      date2: [</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">&#x27;date&#x27;</span>,</span><br><span class="line">          required: <span class="literal">true</span>,</span><br><span class="line">          message: <span class="string">&#x27;请选择时间&#x27;</span>,</span><br><span class="line">          trigger: <span class="string">&#x27;change&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="嵌套验证（联动验证）"><a href="#嵌套验证（联动验证）" class="headerlink" title="嵌套验证（联动验证）"></a>嵌套验证（联动验证）</h2><p>这种是联动验证,适用省级联动场景,先选国家后触发城市验证</p>
<img src="/posts/38065/nest-form-linkage.png" class="" title="嵌套联动验证">

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- region是一个对象,国家和城市是它的属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动区域&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;region&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.region.country&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择国家&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;国家一&quot;</span> <span class="attr">value</span>=<span class="string">&quot;USA&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;国家二&quot;</span> <span class="attr">value</span>=<span class="string">&quot;China&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.region.city&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择城市&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;城市一&quot;</span> <span class="attr">value</span>=<span class="string">&quot;shanghai&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;城市二&quot;</span> <span class="attr">value</span>=<span class="string">&quot;beijing&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      region: [</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">          required: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 这里有两种处理,一种是自定义验证,拿到值后自己对属性进行验证,比较麻烦</span></span><br><span class="line">          <span class="comment">// validator: (rule, value, callback) =&gt; &#123;</span></span><br><span class="line">          <span class="comment">//   console.log(55, value)</span></span><br><span class="line">          <span class="comment">//   if (!value.country) &#123;</span></span><br><span class="line">          <span class="comment">//     callback(new Error(&#x27;请选择国家&#x27;))</span></span><br><span class="line">          <span class="comment">//   &#125; else if (!value.city) &#123;</span></span><br><span class="line">          <span class="comment">//     callback(new Error(&#x27;请选择城市&#x27;))</span></span><br><span class="line">          <span class="comment">//   &#125; else &#123;</span></span><br><span class="line">          <span class="comment">//     callback()</span></span><br><span class="line">          <span class="comment">//   &#125;</span></span><br><span class="line">          <span class="comment">// &#125;,</span></span><br><span class="line">          trigger: <span class="string">&#x27;change&#x27;</span>,</span><br><span class="line">          <span class="comment">// 官网提供了对象的嵌套验证,只需要把需要验证的属性,放在fields对象里,就会按顺序进行验证</span></span><br><span class="line">          fields: &#123;</span><br><span class="line">            country: &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择国家&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;,</span><br><span class="line">            city: &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择城市&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="表单验证-model-绑定的是一个对象下的某个子对象属性的时候无法验证"><a href="#表单验证-model-绑定的是一个对象下的某个子对象属性的时候无法验证" class="headerlink" title="表单验证 model 绑定的是一个对象下的某个子对象属性的时候无法验证"></a>表单验证 model 绑定的是一个对象下的某个子对象属性的时候无法验证</h2><p>如果 data 中定义的数据结构是这样的(组件上最终绑定的是 dataForm.name.value)：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">dataForm: &#123;</span><br><span class="line">  name: &#123;</span><br><span class="line">    value: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么 rules 中需要这样写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">rules: &#123;</span><br><span class="line">  <span class="string">&#x27;name.value&#x27;</span>: &#123;</span><br><span class="line">    &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入项目名称&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>template 需要这么写：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">prop</span>=<span class="string">&quot;name.value&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;dataForm.name.value&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">来自：https://github.com/ElemeFE/element/issues/1655#issuecomment-388538296</span><br><span class="line"></span><br><span class="line">## 图片上传验证（手动触发部分验证方法）</span><br><span class="line"></span><br><span class="line">有时候会需要在表单里上传图片,但是图片上传是一个异步过程,属性值改变后不会去触发验证规则</span><br><span class="line"></span><br><span class="line">&#123;% asset_img img-form.png 图片验证 %&#125;</span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">el-form-item label=&quot;活动图片&quot; prop=&quot;fileUrl&quot;&gt;</span><br><span class="line">    &lt;el-upload</span><br><span class="line">      :action=&quot;action&quot;</span><br><span class="line">      :on-success=&quot;handleSuccess&quot;</span><br><span class="line">      :data=&quot;uploadData&quot;</span><br><span class="line">      :limit=&quot;20&quot;</span><br><span class="line">      list-type=&quot;picture-card&quot;</span><br><span class="line">      :on-preview=&quot;handlePreview&quot;</span><br><span class="line">      :on-remove=&quot;handleRemove&quot;&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-plus&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      fileUrl: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请上传图片&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;change&#x27;</span> &#125;]</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 删除图片</span></span><br><span class="line">    <span class="function"><span class="title">handleRemove</span>(<span class="params">file, fileList</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.registData.fileUrl = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="comment">// 文件删除后也要触发验证,validateField是触发部分验证的方法,参数是prop设置的值</span></span><br><span class="line">      <span class="built_in">this</span>.$refs.registerRef.validateField(<span class="string">&#x27;fileUrl&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 图片上传</span></span><br><span class="line">    <span class="function"><span class="title">handleSuccess</span>(<span class="params">res, file, fileList</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 这里可以写文件上传成功后的处理,但是一定要记得给fileUrl赋值</span></span><br><span class="line">      <span class="built_in">this</span>.registData.fileUrl = <span class="string">&#x27;fileUrl&#x27;</span>;</span><br><span class="line">      <span class="comment">// 文件上传后不会触发form表单的验证,要手动添加验证</span></span><br><span class="line">      <span class="built_in">this</span>.$refs.registerRef.validateField(<span class="string">&#x27;fileUrl&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>shopInfo<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;company&quot;</span> <span class="attr">id</span>=<span class="string">&quot;company&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- model是验证的数据来源 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">&quot;registData&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;rules&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;registerRef&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;100px&quot;</span> <span class="attr">class</span>=<span class="string">&quot;demo-ruleForm&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动名称&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- validate-event输入时不触发表单验证,提交时再验证,也可以设置成动态验证 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.name&quot;</span> <span class="attr">:validate-event</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;区域面积&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;area&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 输入的类型为Number时,需要加一个数字转换的修饰符,输入框默认的类型是String类型,但是我试了一下,发现并不能做验证,所以自己写了函数方法验证 --&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- &lt;el-input v-model.number=&quot;registData.area&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt; --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.area&quot;</span> @<span class="attr">keyup.native</span>=<span class="string">&quot;InputNumber(&#x27;area&#x27;)&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动区域&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;region&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.region.country&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择国家&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;国家一&quot;</span> <span class="attr">value</span>=<span class="string">&quot;USA&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;国家二&quot;</span> <span class="attr">value</span>=<span class="string">&quot;China&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.region.city&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择城市&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;城市一&quot;</span> <span class="attr">value</span>=<span class="string">&quot;shanghai&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;城市二&quot;</span> <span class="attr">value</span>=<span class="string">&quot;beijing&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动时间&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">prop</span>=<span class="string">&quot;date1&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">el-date-picker</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;选择日期&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.date1&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-date-picker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">class</span>=<span class="string">&quot;line&quot;</span> <span class="attr">:span</span>=<span class="string">&quot;2&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">prop</span>=<span class="string">&quot;date2&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">el-time-picker</span> <span class="attr">type</span>=<span class="string">&quot;fixed-time&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;选择时间&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.date2&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-time-picker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;即时配送&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;delivery&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-switch</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.delivery&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-switch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动性质&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;type&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-checkbox-group</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.type&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&quot;美食/餐厅线上活动&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&quot;地推活动&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&quot;线下主题活动&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&quot;单纯品牌曝光&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-checkbox-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;特殊资源&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;resource&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-radio-group</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.resource&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-radio</span> <span class="attr">label</span>=<span class="string">&quot;线上品牌商赞助&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-radio</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-radio</span> <span class="attr">label</span>=<span class="string">&quot;线下场地免费&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-radio</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-radio-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动图片&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;fileUrl&quot;</span>&gt;</span></span><br><span class="line">          &lt;el-upload</span><br><span class="line">            :action=&quot;action&quot;</span><br><span class="line">            :on-success=&quot;handleSuccess&quot;</span><br><span class="line">            :data=&quot;uploadData&quot;</span><br><span class="line">            :limit=&quot;20&quot;</span><br><span class="line">            list-type=&quot;picture-card&quot;</span><br><span class="line">            :on-preview=&quot;handlePreview&quot;</span><br><span class="line">            :on-remove=&quot;handleRemove&quot;&gt;</span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-plus&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动形式&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;desc&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.desc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 提交的时候传入的是表单的ref --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;submitForm(&#x27;registerRef&#x27;)&quot;</span>&gt;</span>立即创建<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;resetForm(&#x27;registerRef&#x27;)&quot;</span>&gt;</span>重置<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.company</span> &#123;</span></span><br><span class="line">    padding: 30px;</span><br><span class="line">    text-align: left;</span><br><span class="line">    width: 600px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;shopInfo&#x27;</span>,</span></span><br><span class="line"></span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      registData: &#123;</span><br><span class="line"><span class="javascript">        name: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 名称</span></span></span><br><span class="line"><span class="javascript">        area: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 面积</span></span></span><br><span class="line"><span class="javascript">        region: &#123;&#125;, <span class="comment">// 地区</span></span></span><br><span class="line"><span class="javascript">        date1: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 日期</span></span></span><br><span class="line"><span class="javascript">        date2: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 时间</span></span></span><br><span class="line"><span class="javascript">        delivery: <span class="literal">false</span>, <span class="comment">// 即时配送</span></span></span><br><span class="line"><span class="javascript">        type: [], <span class="comment">// 活动性质</span></span></span><br><span class="line"><span class="javascript">        resource: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 特殊资源</span></span></span><br><span class="line"><span class="javascript">        fileUrl: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 活动图片</span></span></span><br><span class="line"><span class="javascript">        desc: <span class="string">&#x27;&#x27;</span> <span class="comment">// 活动形式</span></span></span><br><span class="line"><span class="javascript">      &#125;, <span class="comment">// 需要验证的表单属性,必须在data中定义</span></span></span><br><span class="line"><span class="javascript">      rules: &#123; <span class="comment">// 表单验证规则</span></span></span><br><span class="line">        name: [</span><br><span class="line"><span class="javascript">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入活动名称&#x27;</span> &#125;, <span class="comment">// &#x27;blur&#x27;是鼠标失去焦点的时候会触发验证</span></span></span><br><span class="line"><span class="javascript">          &#123; <span class="attr">min</span>: <span class="number">3</span>, <span class="attr">max</span>: <span class="number">5</span>, <span class="attr">message</span>: <span class="string">&#x27;长度在 3 到 5 个字符&#x27;</span> &#125;</span></span><br><span class="line">        ],</span><br><span class="line">        area: [</span><br><span class="line"><span class="javascript">          <span class="comment">// 数字类型</span></span></span><br><span class="line"><span class="javascript">          <span class="comment">// &#123;type: &#x27;number&#x27;, message: &#x27;请输入数字类型&#x27;, trigger: &#x27;blur&#x27;&#125;,</span></span></span><br><span class="line"><span class="javascript">          <span class="comment">// &#123;type: &#x27;integer&#x27;, message: &#x27;请输入数字类型&#x27;, trigger: &#x27;change&#x27;&#125;, // &#x27;change&#x27;是表单的值改变的时候会触发验证</span></span></span><br><span class="line"><span class="javascript">          &#123;<span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入区域面积&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;</span></span><br><span class="line">        ],</span><br><span class="line">        region: [</span><br><span class="line">          &#123;</span><br><span class="line"><span class="javascript">            type: <span class="string">&#x27;object&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            required: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            <span class="comment">// validator: (rule, value, callback) =&gt; &#123;</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//   console.log(55, value)</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//   if (!value.country) &#123;</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//     callback(new Error(&#x27;请选择国家&#x27;))</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//   &#125; else if (!value.city) &#123;</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//     callback(new Error(&#x27;请选择城市&#x27;))</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//   &#125; else &#123;</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//     callback()</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//   &#125;</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// &#125;,</span></span></span><br><span class="line"><span class="javascript">            trigger: <span class="string">&#x27;change&#x27;</span>,</span></span><br><span class="line">            fields: &#123;</span><br><span class="line"><span class="javascript">              country: &#123;<span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择国家&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;,</span></span><br><span class="line"><span class="javascript">              city: &#123;<span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择城市&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        date1: [</span><br><span class="line"><span class="javascript">          &#123; <span class="attr">type</span>: <span class="string">&#x27;date&#x27;</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择日期&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;change&#x27;</span> &#125;</span></span><br><span class="line">        ],</span><br><span class="line">        date2: [</span><br><span class="line"><span class="javascript">          &#123; <span class="attr">type</span>: <span class="string">&#x27;date&#x27;</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择时间&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;change&#x27;</span> &#125;</span></span><br><span class="line">        ],</span><br><span class="line">        type: [</span><br><span class="line"><span class="javascript">          &#123; <span class="attr">type</span>: <span class="string">&#x27;array&#x27;</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请至少选择一个活动性质&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;change&#x27;</span> &#125;</span></span><br><span class="line">        ],</span><br><span class="line">        resource: [</span><br><span class="line"><span class="javascript">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择活动资源&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;change&#x27;</span> &#125;</span></span><br><span class="line">        ],</span><br><span class="line">        fileUrl: [</span><br><span class="line"><span class="javascript">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请上传图片&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;change&#x27;</span> &#125;</span></span><br><span class="line">        ],</span><br><span class="line">        desc: [</span><br><span class="line"><span class="javascript">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请填写活动形式&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      action: <span class="string">`https://jsonplaceholder.typicode.com/posts/`</span>,</span></span><br><span class="line"><span class="javascript">      uploadData: &#123;<span class="attr">userId</span>: <span class="number">1304</span>, <span class="attr">pathName</span>: <span class="string">&#x27;company&#x27;</span>&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  created () &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="comment">// 过滤输入的金额</span></span></span><br><span class="line">    InputNumber (property) &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.registData[property] = <span class="built_in">this</span>.limitInputPointNumber(<span class="built_in">this</span>.registData[property])</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 验证只能输入数字</span></span></span><br><span class="line">    limitInputNumber (val) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (val) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">String</span>(val).replace(<span class="regexp">/\D/g</span>, <span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> val</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 限制只能输入数字(可以输入两位小数)</span></span></span><br><span class="line">    limitInputPointNumber (val) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (val === <span class="number">0</span> || val === <span class="string">&#x27;0&#x27;</span> || val === <span class="string">&#x27;&#x27;</span>) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> value = <span class="literal">null</span></span></span><br><span class="line"><span class="javascript">        value = <span class="built_in">String</span>(val).replace(<span class="regexp">/[^\d.]/g</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">// 清除“数字”和“.”以外的字符</span></span></span><br><span class="line"><span class="javascript">        value = value.replace(<span class="regexp">/\.&#123;2,&#125;/g</span>, <span class="string">&#x27;.&#x27;</span>) <span class="comment">// 只保留第一个. 清除多余的</span></span></span><br><span class="line"><span class="javascript">        value = value.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;$#$&#x27;</span>).replace(<span class="regexp">/\./g</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;$#$&#x27;</span>, <span class="string">&#x27;.&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        value = value.replace(<span class="regexp">/^(-)*(\d+)\.(\d\d).*$/</span>, <span class="string">&#x27;$1$2.$3&#x27;</span>) <span class="comment">// 只能输入两个小数</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">Number</span>(value)</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 预览图片</span></span></span><br><span class="line">    handlePreview (file) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 删除图片</span></span></span><br><span class="line">    handleRemove (file, fileList) &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.registData.fileUrl = <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 文件删除后也要触发验证,validateField是触发部分验证的方法,参数是prop设置的值</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$refs.registerRef.validateField(<span class="string">&#x27;fileUrl&#x27;</span>)</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 图片上传</span></span></span><br><span class="line">    handleSuccess (res, file, fileList) &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 这里可以写文件上传成功后的处理,但是一定要记得给fileUrl赋值</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.registData.fileUrl = <span class="string">&#x27;fileUrl&#x27;</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 文件上传后不会触发form表单的验证,要手动添加验证</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$refs.registerRef.validateField(<span class="string">&#x27;fileUrl&#x27;</span>)</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    submitForm (formName) &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.registData)</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$refs[formName].validate(<span class="function">(<span class="params">valid</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (valid) &#123;</span></span><br><span class="line"><span class="javascript">          alert(<span class="string">&#x27;submit!&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&#x27;error submit!!&#x27;</span>)</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    resetForm (formName) &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$refs[formName].resetFields()</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">再补充两个错误显示的方法</span><br><span class="line">有时候我们的数据在修改页面中,赋值为空会触发验证错误,这种在一个prop控制多个form-item时会出现.这时候希望页面加载时不验证,在特定时候验证,可以使用error这个属性</span><br><span class="line">error初始值为空时不会展示错误信息,一旦有值就会在页面展示错误信息</span><br><span class="line"><span class="javascript">&lt;el-form-item <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;region&quot;</span> label=<span class="string">&quot;&quot;</span> :error=<span class="string">&quot;nameError&quot;</span>&gt;</span></span><br><span class="line"><span class="handlebars"><span class="xml">  <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;registData.name&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;changeName&quot;</span> <span class="attr">:validate-event</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span></span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line">  data: &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> () &#123;</span></span><br><span class="line"><span class="javascript">      nameError: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  changeName () &#123;</span><br><span class="line"><span class="javascript">    <span class="comment">// 设置了单独的error时,不会触发el-form的验证,它只根据error是否有值来展示错误</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (<span class="built_in">this</span>.registData.name) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.nameError = <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.nameError = <span class="string">&#x27;请输入名称&#x27;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="再补充两个错误显示的方法"><a href="#再补充两个错误显示的方法" class="headerlink" title="再补充两个错误显示的方法"></a>再补充两个错误显示的方法</h2><p>有时候我们的数据在修改页面中,赋值为空会触发验证错误,这种在一个 prop 控制多个 form-item 时会出现.这时候希望页面加载时不验证,在特定时候验证,可以使用 error 这个属性<br>error 初始值为空时不会展示错误信息,一旦有值就会在页面展示错误信息</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">class</span>=<span class="string">&quot;region&quot;</span> <span class="attr">label</span>=<span class="string">&quot;&quot;</span> <span class="attr">:error</span>=<span class="string">&quot;nameError&quot;</span>&gt;</span></span><br><span class="line">  &lt;el-input</span><br><span class="line">    v-model=&quot;registData.name&quot;</span><br><span class="line">    @change=&quot;changeName&quot;</span><br><span class="line">    :validate-event=&quot;false&quot;</span><br><span class="line">  &gt;<span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    <span class="keyword">return</span>() &#123;</span><br><span class="line">      nameError: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">changeName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 设置了单独的error时,不会触发el-form的验证,它只根据error是否有值来展示错误</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.registData.name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.nameError = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nameError = <span class="string">&#x27;请输入名称&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="另一种场景-自定义错误样式"><a href="#另一种场景-自定义错误样式" class="headerlink" title="另一种场景: 自定义错误样式"></a>另一种场景: 自定义错误样式</h3><p>el-form 的错误信息默认是在输入框底部一行展示,如果需要特地的样式,可以使用 slot</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">  &lt;el-input</span><br><span class="line">    v-model=&quot;perfectInfo.password&quot;</span><br><span class="line">    :placeholder=&quot;pwdPlaceholder&quot;</span><br><span class="line">    :maxlength=&quot;24&quot;</span><br><span class="line">    auto-complete=&quot;new-password&quot;</span><br><span class="line">  &gt;<span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;error&quot;</span> <span class="attr">slot-scope</span>=<span class="string">&quot;slot&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;el-form_tip tt&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item_tip&quot;</span>&gt;</span>&#123;&#123;pwdFormatTips1&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item_tip&quot;</span>&gt;</span>&#123;&#123;pwdFormatTips2&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item_tip&quot;</span>&gt;</span>&#123;&#123;pwdFormatTips3&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item_tip&quot;</span>&gt;</span>&#123;&#123;pwdFormatTips4&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>UI</category>
        <category>element-ui</category>
      </categories>
      <tags>
        <tag>element-ui</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS调用微信分享</title>
    <url>/posts/19541/</url>
    <content><![CDATA[<h1 id="iOS-唤起-APP-之-Universal-Link-通用链接"><a href="#iOS-唤起-APP-之-Universal-Link-通用链接" class="headerlink" title="iOS 唤起 APP 之 Universal Link(通用链接)"></a>iOS 唤起 APP 之 Universal Link(通用链接)</h1><h2 id="什么是Universal-Link-通用链接"><a href="#什么是Universal-Link-通用链接" class="headerlink" title="什么是Universal Link(通用链接)"></a>什么是<code>Universal Link</code>(通用链接)</h2><p><code>Universal Link</code>(通用链接)是 Apple 在 iOS9 推出的一种能够方便的通过传统<code>HTTPS</code>链接来启动 APP 的功能，可以使用相同的网址打开网址和 APP。当你的应用支持<code>Universal Link</code>(通用链接)，当用户点击一个链接是可以跳转到你的网站并获得无缝重定向到对应的 APP，且不需要通过<code>Safari</code>浏览器。如果你的应用不支持的话，则会在<code>Safari</code>中打开该链接。在苹果开发者中可以看到对它的介绍是：</p>
<blockquote>
<p>Seamlessly link to content inside your app, or on your website in iOS 9 or later. With universal links, you can always give users the most integrated mobile experience, even when your app isn’t installed on their device.</p>
</blockquote>
<a id="more"></a>

<h3 id="如何理解Universal-Link-通用链接"><a href="#如何理解Universal-Link-通用链接" class="headerlink" title="如何理解Universal Link(通用链接)"></a>如何理解<code>Universal Link</code>(通用链接)</h3><p><code>Universal Link</code>(通用链接)：看起来就是一条普通的<code>https</code>链接，当然是我们在该链接域名根目录配置过的一个链接，也可以在该链接中放置对应的 H5 页面。当用户的点击该链接，只要手机中安装了支持该链接的 APP 就会直接进入到 APP 中。如果没有安装 APP 则会跳转到<code>Safari</code>浏览器中，展示 H5 页面。对用户来说则是一个无缝跳转的过程。</p>
<h3 id="Universal-Link-通用链接-的应用场景"><a href="#Universal-Link-通用链接-的应用场景" class="headerlink" title="Universal Link(通用链接)的应用场景"></a><code>Universal Link</code>(通用链接)的应用场景</h3><p>使用<code>Universal Link</code>(通用链接)可以让用户在<code>Safari</code>浏览器或者其他 APP 的<code>webview</code>中拉起相应的 APP，也可以在 APP 中使用相应的功能，从而来把用户引流到 APP 中。比如淘宝当在<code>Safari</code>浏览器中进入淘宝网页点击打开 APP 则会使用<code>Universal Link</code>(通用链接)来拉起淘宝 APP。</p>
<h3 id="使用Universal-Link-通用链接-跳转的好处"><a href="#使用Universal-Link-通用链接-跳转的好处" class="headerlink" title="使用Universal Link(通用链接)跳转的好处"></a>使用<code>Universal Link</code>(通用链接)跳转的好处</h3><ul>
<li><strong>唯一性</strong>: 不像自定义的<code>URL Scheme</code>，因为它使用标准的<code>HTTPS</code>协议链接到你的 web 站点，所以一般不会被其它的 APP 所声明。另外，<code>URL scheme</code>因为是自定义的协议，所以在没有安装 app 的情况下是无法直接打开的(在<code>Safari</code>中还会出现一个不可打开的弹窗)，而<code>Universal Link</code>(通用链接)本身是一个<code>HTTPS</code>链接，所以有更好的兼容性；</li>
<li><strong>安全</strong>:当用户的手机上安装了你的 APP，那么系统会去你配置的网站上去下载你上传上去的说明文件(这个说明文件声明了当前该<code>HTTPS</code>链接可以打开那些 APP)。因为只有你自己才能上传文件到你网站的根目录，所以你的网站和你的 APP 之间的关联是安全的；</li>
<li><strong>可变</strong>:当用户手机上没有安装你的 APP 的时候，<code>Universal Link</code>(通用链接)也能够工作。如果你愿意，在没有安装你的 app 的时候，用户点击链接，会在 safari 中展示你网站的内容；</li>
<li><strong>简单</strong>:一个<code>HTTPS</code>的链接，可以同时作用于网站和 APP；</li>
<li><strong>私有</strong>: 其它 APP 可以在不需要知道你的 APP 是否安装了的情况下和你的 APP 相互通信。</li>
</ul>
<h2 id="支持Universal-Link-通用链接"><a href="#支持Universal-Link-通用链接" class="headerlink" title="支持Universal Link(通用链接)"></a>支持<code>Universal Link</code>(通用链接)</h2><ol>
<li>先决条件:必须有一个支持<code>HTTPS</code>的域名，并且拥有该域名下的上传到根目录的权限（为了上传 Apple 指定文件）。</li>
<li>开发者中心配置：找到对应的 App ID，在 Application Services 列表里有 Associated Domains 一条，把它变为 Enabled 就可以了。</li>
</ol>
<img src="/posts/19541/configappid.png" class="" title="配置config">

<p>添加能力后，记得重新生成下描述文件，然后下载双击在 Xcode 中打开就好了。</p>
<ol>
<li>Xcode 工程配置：</li>
</ol>
<img src="/posts/19541/sigin2.png" class="" title="配置1">

<img src="/posts/19541/sigin3.png" class="" title="配置3">

<ol>
<li>配置指定文件：创建一个内容为 json 格式的文件，苹果将会在合适的时候，从我们在项目中填入的域名请求这个文件。这个文件名必须为 apple-app-site-association，<strong>切记没有后缀名</strong>，文件内容大概是这样子：</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;applinks&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;apps&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;details&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;appID&quot;</span>: <span class="string">&quot;9JA89QQLNQ.com.apple.wwdc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;paths&quot;</span>: [<span class="string">&quot;/wwdc/news/&quot;</span>, <span class="string">&quot;/videos/wwdc/2015/*&quot;</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;appID&quot;</span>: <span class="string">&quot;ABCD1234.com.apple.wwdc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;paths&quot;</span>: [<span class="string">&quot;*&quot;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<blockquote>
<p>appID：组成方式是 <code>teamId.yourapp’s bundle identifier</code>。如上面的 9JA89QQLNQ 就是 teamId。登陆开发者中心，在 Account -&gt; Membership 里面可以找到 Team ID。</p>
<p>paths：设定你的 app 支持的路径列表，只有这些指定的路径的链接，才能被 app 所处理。星号的写法代表了可识 别域名下所有链接。</p>
</blockquote>
<ol>
<li>上传指定文件:上传该文件到你的域名所对应的根目录或者.well-known 目录下，这是为了苹果能获取到你上传的文件。上传完后,自己先访问一下,看看是否能够获取到，当你在浏览器中输入这个文件链接后，应该是直接下载 apple-app-site-association 文件。</li>
</ol>
<h2 id="微信开放平台设置"><a href="#微信开放平台设置" class="headerlink" title="微信开放平台设置"></a>微信开放平台设置</h2><p>开放平台创建自己的移动应用：</p>
<img src="/posts/19541/create-app.png" class="" title="创建应用">

<p>填写 iOS 相关信息：</p>
<img src="/posts/19541/config-ios.png" class="" title="ios相关">

<p>上面 universal links 填写外界能访问到你 <code>apple-app-site-association</code> 文件的网址。</p>
<h2 id="Xcode-设置"><a href="#Xcode-设置" class="headerlink" title="Xcode 设置"></a>Xcode 设置</h2><h3 id="通过-CocoaPods-集成-SDK"><a href="#通过-CocoaPods-集成-SDK" class="headerlink" title="通过 CocoaPods 集成 SDK"></a>通过 CocoaPods 集成 SDK</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pod &#x27;WechatOpenSDK&#x27;</span><br></pre></td></tr></table></figure>

<p>pod install 后重新打开 Xcode。</p>
<h4 id="Xcode-设置-URL-scheme"><a href="#Xcode-设置-URL-scheme" class="headerlink" title="Xcode 设置 URL scheme"></a>Xcode 设置 URL scheme</h4><p>在 Xcode 中，选择你的工程设置项，选中“TARGETS”一栏，在“info”标签栏的“URL type“添加“URL scheme”为你所注册的应用程序 id（如下图所示）。</p>
<p>在 Xcode 中，选择你的工程设置项，选中“TARGETS”一栏，在 “info”标签栏的“LSApplicationQueriesSchemes“添加 weixin 和 weixinULAPI（如下图所示）。</p>
<img src="/posts/19541/weixinulapi.png" class="" title="weixinulapi">

<img src="/posts/19541/plist-wechat.png" class="" title="plist-wechat">

<p>新增 wechat</p>
<h2 id="具体代码实现"><a href="#具体代码实现" class="headerlink" title="具体代码实现"></a>具体代码实现</h2><h3 id="桥接文件"><a href="#桥接文件" class="headerlink" title="桥接文件"></a>桥接文件</h3><p>新建桥接文件 <code>WX_Bridging-Header.h</code>：</p>
<img src="/posts/19541/bridging-file.png" class="" title="bridging-file">

<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  WX_Bridging-Header.h</span></span><br><span class="line"><span class="comment">//  Created by lance on 2020/8/3.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">#ifndef <span class="type">WX_Bridging_Header_h</span></span><br><span class="line">#define <span class="type">WX_Bridging_Header_h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 微信</span></span><br><span class="line">#define <span class="type">WX_AppID</span> @<span class="string">&quot;appid&quot;</span></span><br><span class="line">#define <span class="type">WX_AppSecret</span> @<span class="string">&quot;appsecret&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 微信-通用链接 Universal Link</span></span><br><span class="line">#define <span class="type">WX_UNIVERSAL_LINK</span> @<span class="string">&quot;Universal Link&quot;</span></span><br><span class="line"></span><br><span class="line">#ifdef __OBJC__</span><br><span class="line"></span><br><span class="line"><span class="comment">// 微信授权登录</span></span><br><span class="line">#<span class="keyword">import</span> &quot;WXApi.h&quot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">#endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">#endif</span> <span class="comment">/* WX_Bridging_Header_h */</span></span><br></pre></td></tr></table></figure>

<p>Build Setting -&gt; 搜索 “bridging” 找到 Objective-C Bridging Header 设置引用路径:<code>$(SRCROOT)/$(PROJECT_NAME)/WX_Bridging-Header.h</code></p>
<img src="/posts/19541/settings-bridging.png" class="" title="设置桥接">

<h3 id="配置-AppDelegate"><a href="#配置-AppDelegate" class="headerlink" title="配置 AppDelegate"></a>配置 AppDelegate</h3><p>在 <code>AppDelegate.swift</code> or <code>SceneDelegate.swift</code> 中继承代理：</p>
<ul>
<li>WXApiDelegate(必须)</li>
<li>WXApiLogDelegate(可选)</li>
</ul>
<p>新增 block，用于回到微信授权登录成功获取的 code，后续利用该 code 获取微信用户信息。</p>
<p>实现代理方法：onReq、onResp、onLog(可选)</p>
<p>初始化微信 SDK：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  AppDelegate.swift</span></span><br><span class="line"><span class="comment">//  YYT_iOS</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by evestorm on 2020/7/15.</span></span><br><span class="line"><span class="comment">//  Copyright © 2020 YYT. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span>, <span class="title">WXApiDelegate</span>, <span class="title">WXApiLogDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> window: <span class="type">UIWindow?</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// block，用于回到微信授权登录成功获取的code，后续利用该code获取微信用户信息</span></span><br><span class="line">    <span class="keyword">var</span> wechatLoginCallback: ((<span class="keyword">_</span> code: <span class="type">String</span>) -&gt; <span class="type">Void</span>)?</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="keyword">_</span>: UIApplication, didFinishLaunchingWithOptions <span class="keyword">_</span>: [UIApplication.LaunchOptionsKey: <span class="keyword">Any</span>]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="comment">// Override point for customization after application launch.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化微信SDK</span></span><br><span class="line">        registerWeChat()</span><br><span class="line"></span><br><span class="line">        window = <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">        window?.rootViewController = <span class="type">ViewController</span>()</span><br><span class="line">        window?.makeKeyAndVisible()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">applicationDidFinishLaunching</span><span class="params">(<span class="keyword">_</span>: UIApplication)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化微信SDK</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">registerWeChat</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">WXApi</span>.startLog(by: .detail, logDelegate: <span class="keyword">self</span>)</span><br><span class="line">        <span class="type">WXApi</span>.registerApp(<span class="type">WX_AppID</span>, universalLink: <span class="type">WX_UNIVERSAL_LINK</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: WXApiDelegate</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">onReq</span><span class="params">(<span class="keyword">_</span>: BaseReq)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=========&gt; onRep&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">onResp</span><span class="params">(<span class="keyword">_</span> resp: BaseResp)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;========&gt; onResp&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> resp.isKind(of: <span class="type">SendAuthResp</span>.<span class="keyword">self</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> _resp = resp <span class="keyword">as</span>! <span class="type">SendAuthResp</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> code = _resp.code &#123;</span><br><span class="line">                <span class="keyword">if</span> wechatLoginCallback != <span class="literal">nil</span> &#123;</span><br><span class="line">                    wechatLoginCallback!(code)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(resp.errStr)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">onLog</span><span class="params">(<span class="keyword">_</span> log: String, logLevel <span class="keyword">_</span>: WXLogLevel)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(log)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="封装微信方法"><a href="#封装微信方法" class="headerlink" title="封装微信方法"></a>封装微信方法</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  WX_Tools.swift</span></span><br><span class="line"><span class="comment">//  YYT_iOS</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by evestorm on 2020/8/3.</span></span><br><span class="line"><span class="comment">//  Copyright © 2020 YYT. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Alamofire</span><br><span class="line"><span class="keyword">import</span> AlamofireImage</span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeChatFunc</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="comment">// MARK: - 微信授权登录</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 发送Auth请求到微信，支持用户没安装微信，等待微信返回onResp</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - wxApiDelegate: WXApiDelegate对象，用来接收微信触发的消息。</span></span><br><span class="line">    <span class="comment">///   - currentVC: viewController 当前界面对象。</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">sendWeChatLogin</span><span class="params">(wxApiDelegate: WXApiDelegate, currentVC: UIViewController)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 构造SendAuthReq结构体</span></span><br><span class="line">        <span class="keyword">let</span> req = <span class="type">SendAuthReq</span>()</span><br><span class="line">        req.openID = <span class="type">WX_AppID</span></span><br><span class="line">        req.scope = <span class="string">&quot;snsapi_userinfo&quot;</span></span><br><span class="line">        req.state = <span class="string">&quot;wx_oauth_authorization_state&quot;</span> <span class="comment">// 用于保持请求和回调的状态，授权请求或原样带回。</span></span><br><span class="line">        <span class="comment">// 第三方向微信终端发送一个SendAuthReq消息结构</span></span><br><span class="line">        <span class="type">WXApi</span>.sendAuthReq(req, viewController: currentVC, delegate: wxApiDelegate, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 微信：获取用户个人信息（UnionID 机制）</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">getWeChatUserInfo</span><span class="params">(code: String, success: @escaping <span class="params">(<span class="keyword">_</span> userInfo: [String: <span class="keyword">Any</span>])</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        getWeChatAccessToken(code: code) &#123; <span class="keyword">_</span>, access_token, openid <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.getWeChatUserInfo(access_token: access_token, openID: openid) &#123; userInfoJson <span class="keyword">in</span></span><br><span class="line">                success(userInfoJson)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 微信：通过 code 获取 access_token、openid</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">getWeChatAccessToken</span><span class="params">(code <span class="keyword">_</span>: String, success: @escaping <span class="params">(<span class="keyword">_</span> result: [String: <span class="keyword">Any</span>], <span class="keyword">_</span> access_token: String, <span class="keyword">_</span> openid: String)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> urlString = <span class="string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token?appid=(WX_AppID)&amp;secret=(WX_AppSecret)&amp;code=(code)&amp;grant_type=authorization_code&quot;</span></span><br><span class="line">        <span class="keyword">var</span> request = <span class="type">URLRequest</span>(url: <span class="type">URL</span>(string: urlString)!)</span><br><span class="line">        request.httpMethod = <span class="string">&quot;GET&quot;</span></span><br><span class="line">        <span class="type">UIApplication</span>.shared.isNetworkActivityIndicatorVisible = <span class="literal">true</span></span><br><span class="line">        <span class="type">URLSession</span>.shared.dataTask(with: request) &#123; data, <span class="keyword">_</span>, error <span class="keyword">in</span></span><br><span class="line">            <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                <span class="type">UIApplication</span>.shared.isNetworkActivityIndicatorVisible = <span class="literal">false</span></span><br><span class="line">                <span class="keyword">if</span> error == <span class="literal">nil</span>, data != <span class="literal">nil</span> &#123;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        <span class="keyword">let</span> dic = <span class="keyword">try</span> <span class="type">JSONSerialization</span>.jsonObject(with: data!, options: []) <span class="keyword">as</span>! [<span class="type">String</span>: <span class="type">Any</span>]</span><br><span class="line">                        <span class="keyword">let</span> access_token = dic[<span class="string">&quot;access_token&quot;</span>] <span class="keyword">as</span>! <span class="type">String</span></span><br><span class="line">                        <span class="keyword">let</span> openID = dic[<span class="string">&quot;openid&quot;</span>] <span class="keyword">as</span>! <span class="type">String</span></span><br><span class="line">                        <span class="comment">//</span></span><br><span class="line">                        success(dic, access_token, openID)</span><br><span class="line">                    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">                        <span class="built_in">print</span>(<span class="keyword">#function</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.resume()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 微信：获取用户个人信息（UnionID 机制）</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">getWeChatUserInfo</span><span class="params">(access_token <span class="keyword">_</span>: String, openID <span class="keyword">_</span>: String, success: @escaping <span class="params">(<span class="keyword">_</span> userInfo: [String: <span class="keyword">Any</span>])</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> urlString = <span class="string">&quot;https://api.weixin.qq.com/sns/userinfo?access_token=(access_token)&amp;openid=(openID)&quot;</span></span><br><span class="line">        <span class="keyword">var</span> request = <span class="type">URLRequest</span>(url: <span class="type">URL</span>(string: urlString)!)</span><br><span class="line">        request.httpMethod = <span class="string">&quot;GET&quot;</span></span><br><span class="line">        <span class="type">UIApplication</span>.shared.isNetworkActivityIndicatorVisible = <span class="literal">true</span></span><br><span class="line">        <span class="type">URLSession</span>.shared.dataTask(with: request) &#123; data, <span class="keyword">_</span>, error <span class="keyword">in</span></span><br><span class="line">            <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                <span class="type">UIApplication</span>.shared.isNetworkActivityIndicatorVisible = <span class="literal">false</span></span><br><span class="line">                <span class="keyword">if</span> error == <span class="literal">nil</span>, data != <span class="literal">nil</span> &#123;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        <span class="keyword">let</span> dic = <span class="keyword">try</span> <span class="type">JSONSerialization</span>.jsonObject(with: data!, options: []) <span class="keyword">as</span>! [<span class="type">String</span>: <span class="type">Any</span>]</span><br><span class="line">                        <span class="comment">// dic当中包含了微信登录的个人信息，用于用户创建、登录、绑定等使用</span></span><br><span class="line">                        success(dic)</span><br><span class="line">                    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">                        <span class="built_in">print</span>(<span class="keyword">#function</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.resume()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: 微信分享</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     @description 微信媒体消息内容 这里以发送图片+文字+链接形式（微信卡片形式）</span></span><br><span class="line"><span class="comment">     @param &#123;UIImage&#125; shareImage 分享图片</span></span><br><span class="line"><span class="comment">     @param &#123;String&#125; shareTitle 分享标题</span></span><br><span class="line"><span class="comment">     @param &#123;String&#125; shareDesc 分享描述文案</span></span><br><span class="line"><span class="comment">     @param &#123;String&#125; shareUrl 跳转链接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">sendWXMediaMessage</span><span class="params">(shareImage: UIImage, shareTitle: String, shareDesc: String, shareUrl: String)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="type">WXApi</span>.isWXAppInstalled(), <span class="type">WXApi</span>.isWXAppSupport() <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果未安装微信或者微信版本过低，提示去安装或升级</span></span><br><span class="line">            <span class="keyword">let</span> ac = <span class="type">UIAlertController</span>(title: <span class="string">&quot;提醒&quot;</span>, message: <span class="string">&quot;您尚未安装微信或微信版本过低，请安装或升级微信&quot;</span>, preferredStyle: .alert)</span><br><span class="line">            ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;确定&quot;</span>, style: .<span class="keyword">default</span>))</span><br><span class="line">            <span class="type">UIApplication</span>.topViewController()?.present(ac, animated: <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> sendMessageToWXReq = <span class="type">SendMessageToWXReq</span>()</span><br><span class="line">        <span class="comment">// 微信好友分享</span></span><br><span class="line">        sendMessageToWXReq.scene = <span class="type">Int32</span>(<span class="type">WXSceneSession</span>.rawValue) <span class="comment">// 朋友圈：WXSceneTimeline.rawValue</span></span><br><span class="line">        sendMessageToWXReq.bText = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">let</span> wxMediaMessage = <span class="type">WXMediaMessage</span>()</span><br><span class="line">        wxMediaMessage.title = shareTitle</span><br><span class="line">        wxMediaMessage.description = shareDesc</span><br><span class="line">        <span class="comment">// 压缩图片，防止图片数据过大导致分享无法成功，这里微信要求大小不能超过64K</span></span><br><span class="line">        <span class="keyword">let</span> thumImageData = <span class="type">UIImage</span>.resetImgSize(sourceImage: shareImage, maxImageLenght: <span class="number">300</span>, maxSizeKB: <span class="number">64</span>)</span><br><span class="line">        wxMediaMessage.thumbData = thumImageData <span class="keyword">as</span> <span class="type">Data</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> wxWebPage = <span class="type">WXWebpageObject</span>()</span><br><span class="line">        wxWebPage.webpageUrl = shareUrl</span><br><span class="line">        wxMediaMessage.mediaObject = wxWebPage</span><br><span class="line">        sendMessageToWXReq.message = wxMediaMessage</span><br><span class="line">        <span class="type">WXApi</span>.send(sendMessageToWXReq)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     @description 文字类型分享示例</span></span><br><span class="line"><span class="comment">     @param &#123;String&#125; 分享文字</span></span><br><span class="line"><span class="comment">     @param &#123;Func&#125; 闭包 版本过低时执行的操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">sendWXTextMessage</span><span class="params">(shareText: String)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="type">WXApi</span>.isWXAppInstalled(), <span class="type">WXApi</span>.isWXAppSupport() <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果未安装微信或者微信版本过低，提示去安装或升级</span></span><br><span class="line">            <span class="keyword">let</span> ac = <span class="type">UIAlertController</span>(title: <span class="string">&quot;提醒&quot;</span>, message: <span class="string">&quot;您尚未安装微信或微信版本过低，请安装或升级微信&quot;</span>, preferredStyle: .alert)</span><br><span class="line">            ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;确定&quot;</span>, style: .<span class="keyword">default</span>))</span><br><span class="line">            <span class="type">UIApplication</span>.topViewController()?.present(ac, animated: <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> sendMessageToWXReq = <span class="type">SendMessageToWXReq</span>()</span><br><span class="line">        sendMessageToWXReq.bText = <span class="literal">true</span></span><br><span class="line">        sendMessageToWXReq.text = shareText</span><br><span class="line">        sendMessageToWXReq.scene = <span class="type">Int32</span>(<span class="type">WXSceneSession</span>.rawValue)</span><br><span class="line">        <span class="type">WXApi</span>.send(sendMessageToWXReq)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     @description 发送到小程序</span></span><br><span class="line"><span class="comment">     @param &#123;String&#125; webpageUrl 网页链接</span></span><br><span class="line"><span class="comment">     @param &#123;String&#125; userName 小程序的userName 小程序原始ID获取方法：登录小程序管理后台-设置-基本设置-帐号信息</span></span><br><span class="line"><span class="comment">     @param &#123;String&#125; path 小程序的页面路径</span></span><br><span class="line"><span class="comment">     @param &#123;String&#125; hdImageData 小程序新版本的预览图二进制数据 限制大小不超过128KB，自定义图片建议长宽比是 5:4。</span></span><br><span class="line"><span class="comment">     @param &#123;String&#125; withShareTicket 是否使用带shareTicket的分享</span></span><br><span class="line"><span class="comment">     @param &#123;String&#125; programType 小程序的类型，默认正式版 release(正式) test(测试) preview(体验)</span></span><br><span class="line"><span class="comment">     @param &#123;String&#125; miniTitle 小程序标题</span></span><br><span class="line"><span class="comment">     @param &#123;String&#125; miniDescription 小程序描述</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">sendWXMiniProgramMessage</span><span class="params">(webpageUrl: String, userName: String, path: String, imageUrl: String, withShareTicket: Bool = <span class="literal">false</span>, programType: Int, miniTitle: String, miniDescription: String)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 这里以发送图片+文字+链接形式（微信卡片形式）</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="type">WXApi</span>.isWXAppInstalled(), <span class="type">WXApi</span>.isWXAppSupport() <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果未安装微信或者微信版本过低，提示去安装或升级</span></span><br><span class="line">            <span class="keyword">let</span> ac = <span class="type">UIAlertController</span>(title: <span class="string">&quot;提醒&quot;</span>, message: <span class="string">&quot;您尚未安装微信或微信版本过低，请安装或升级微信&quot;</span>, preferredStyle: .alert)</span><br><span class="line">            ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;确定&quot;</span>, style: .<span class="keyword">default</span>))</span><br><span class="line">            <span class="type">UIApplication</span>.topViewController()?.present(ac, animated: <span class="literal">true</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> object = <span class="type">WXMiniProgramObject</span>()</span><br><span class="line">        object.webpageUrl = webpageUrl</span><br><span class="line">        object.userName = userName</span><br><span class="line">        object.path = path</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> url = <span class="type">URL</span>(string: imageUrl), <span class="keyword">let</span> data = <span class="keyword">try</span>? <span class="type">Data</span>(contentsOf: url) &#123;</span><br><span class="line"><span class="comment">//            object.hdImageData = try? Data(contentsOf: url)</span></span><br><span class="line">            <span class="keyword">let</span> img = <span class="type">UIImage</span>(data: data)</span><br><span class="line">            <span class="comment">// 压缩图片，防止图片数据过大导致分享无法成功，这里微信要求大小不能超过64K</span></span><br><span class="line">            <span class="keyword">let</span> thumImageData = <span class="type">UIImage</span>.resetImgSize(sourceImage: img ?? <span class="type">UIImage</span>(named: <span class="string">&quot;zzylogo&quot;</span>)!, maxImageLenght: <span class="number">300</span>, maxSizeKB: <span class="number">128</span>)</span><br><span class="line">            object.hdImageData = thumImageData <span class="keyword">as</span> <span class="type">Data</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        object.withShareTicket = withShareTicket</span><br><span class="line">        <span class="comment">// ptype:正式版:0，测试版:1，体验版:2</span></span><br><span class="line">        <span class="keyword">switch</span> programType &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: <span class="comment">// 正式版:0</span></span><br><span class="line">            object.miniProgramType = <span class="type">WXMiniProgramType</span>.release</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// 测试版:1</span></span><br><span class="line">            object.miniProgramType = <span class="type">WXMiniProgramType</span>.test</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: <span class="comment">// 体验版:2</span></span><br><span class="line">            object.miniProgramType = <span class="type">WXMiniProgramType</span>.preview</span><br><span class="line">        <span class="keyword">default</span>: <span class="comment">// 默认正式版</span></span><br><span class="line">            object.miniProgramType = <span class="type">WXMiniProgramType</span>.release</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> message = <span class="type">WXMediaMessage</span>()</span><br><span class="line">        message.title = miniTitle</span><br><span class="line">        message.description = miniDescription</span><br><span class="line">        message.thumbData = <span class="literal">nil</span> <span class="comment">// 兼容旧版本节点的图片，小于32KB，新版本优先</span></span><br><span class="line">        <span class="comment">// 使用WXMiniProgramObject的hdImageData属性</span></span><br><span class="line">        message.mediaObject = object</span><br><span class="line">        <span class="keyword">let</span> req = <span class="type">SendMessageToWXReq</span>()</span><br><span class="line">        req.bText = <span class="literal">false</span></span><br><span class="line">        req.message = message</span><br><span class="line">        req.scene = <span class="type">Int32</span>(<span class="type">WXSceneSession</span>.rawValue) <span class="comment">// 目前只支持会话</span></span><br><span class="line">        <span class="type">WXApi</span>.send(req)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">WeChatFunc</span>.sendWXTextMessage(shareText: message)</span><br></pre></td></tr></table></figure>

<h2 id="资源参考"><a href="#资源参考" class="headerlink" title="资源参考"></a>资源参考</h2><p><a href="https://www.cnblogs.com/guoshaobin/p/11164000.html">iOS 唤起 APP 之 Universal Link(通用链接)</a></p>
<p><a href="https://www.codenong.com/js9ac702b07b94/">APP 接入微信支付或分享完整流程</a></p>
<p><a href="https://developers.weixin.qq.com/doc/oplatform/Mobile_App/Access_Guide/iOS.html">iOS 接入指南</a></p>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>动态路由+路由鉴权</title>
    <url>/posts/48117/</url>
    <content><![CDATA[<h1 id="动态路由-路由鉴权"><a href="#动态路由-路由鉴权" class="headerlink" title="动态路由 + 路由鉴权"></a>动态路由 + 路由鉴权</h1><h2 id="路由鉴权介绍"><a href="#路由鉴权介绍" class="headerlink" title="路由鉴权介绍"></a>路由鉴权介绍</h2><p>一般 Vue 的权限控制有两种方案：</p>
<ul>
<li>路由元信息(meta)</li>
<li>动态加载菜单和路由(addRoutes)</li>
</ul>
<a id="more"></a>

<h3 id="路由元信息-meta"><a href="#路由元信息-meta" class="headerlink" title="路由元信息(meta)"></a>路由元信息(meta)</h3><p>如果一个网站有不同的角色，比如<strong>管理员</strong>和<strong>普通用户</strong>，要求不同的角色能访问的页面是不一样的</p>
<p>这个时候我们就可以<strong>把所有的页面都放在路由表里</strong>，只要<strong>在访问的时候判断一下角色权限</strong>。如果有权限就让访问，没有权限的话就拒绝访问，跳转到 404 页面。</p>
<p><code>vue-router</code> 在构建路由时提供了元信息 <code>meta</code> 配置接口，我们可以在元信息中添加路由对应的权限，然后在路由守卫中检查相关权限，控制其路由跳转。</p>
<p>可以在每一个路由的 <code>meta</code> 属性里，将能访问该路由的角色添加到 <code>roles</code> 里。用户每次登陆后，将用户的角色返回。然后在访问页面时，把路由的 <code>meta</code> 属性和用户的角色进行对比，如果用户的角色在路由的 <code>roles</code> 里，那就是能访问，如果不在就拒绝访问。</p>
<p><strong>代码示例 1：</strong></p>
<p>路由信息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">routes: [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;user&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../components/Login.vue&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      roles: [<span class="string">&#x27;admin&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/Home.vue&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>页面控制：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//假设有两种角色：admin 和 user</span></span><br><span class="line"><span class="comment">//从后台获取的用户角色</span></span><br><span class="line"><span class="keyword">const</span> role = <span class="string">&#x27;user&#x27;</span></span><br><span class="line"><span class="comment">//当进入一个页面是会触发导航守卫 router.beforeEach 事件</span></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to,<span class="keyword">from</span>,next</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(to.meta.roles.includes(role))&#123;</span><br><span class="line">		next()	<span class="comment">//放行</span></span><br><span class="line">	&#125;esle&#123;</span><br><span class="line">		next(&#123;<span class="attr">path</span>:<span class="string">&quot;/404&quot;</span>&#125;)	<span class="comment">//跳到404页面</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>代码示例 2</strong></p>
<p>当然也可以用下面的一种方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// router.js</span></span><br><span class="line"><span class="comment">// 路由表元信息</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    redirect: <span class="string">&#x27;/home&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">      icon: <span class="string">&#x27;home&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/userCenter&#x27;</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">&#x27;个人中心&#x27;</span>,</span><br><span class="line">      requireAuth: <span class="literal">true</span> <span class="comment">// 在需要登录的路由的meta中添加响应的权限标识</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在守卫中访问元信息</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gaurd</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// to.matched.some(record =&gt; record.meta.requireAuth)</span></span><br><span class="line">  <span class="comment">// 可在此处</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以在多个路由下面添加这个权限标识，达到控制的目的</p>
<p>只要一切换页面，就需要看有没有这个权限，所以可以在最大的路由下 <code>main.js</code> 中配置</p>
<p><strong>存储信息</strong></p>
<p>一般的，用户登录后会在本地存储用户的认证信息，可以用 <code>token</code>、<code>cookie</code> 等,这里我们用 <code>token</code>。</p>
<p>将用户的<code>token</code>保存到<code>localStorage</code>里，而用户信息则存在内存<code>store</code>中。这样可以在<code>vuex</code>中存储一个标记用户登录状态的属性 auth，方便权限控制。</p>
<p><strong>代码示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store.js</span></span><br><span class="line">&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    token: <span class="built_in">window</span>.localStorage.getItem(<span class="string">&#x27;token&#x27;</span>),</span><br><span class="line">    auth: <span class="literal">false</span>,</span><br><span class="line">    userInfo: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    setToken (state, token) &#123;</span><br><span class="line">      state.token = token</span><br><span class="line">      <span class="built_in">window</span>.localStorage.setItem(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">    &#125;,</span><br><span class="line">    clearToken (state) &#123;</span><br><span class="line">      state.token = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="built_in">window</span>.localStorage.setItem(<span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    setUserInfo (state, userInfo) &#123;</span><br><span class="line">      state.userInfo = userInfo</span><br><span class="line">      state.auth = <span class="literal">true</span> <span class="comment">// 获取到用户信息的同时将auth标记为true，当然也可以直接判断userInfo</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="keyword">async</span> getUserInfo (ctx, token) &#123;</span><br><span class="line">      <span class="keyword">return</span> fetchUserInfo(token).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (response.code === <span class="number">200</span>) &#123;</span><br><span class="line">          ctx.commit(<span class="string">&#x27;setUserInfo&#x27;</span>, response.data)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> login (ctx, account) &#123;</span><br><span class="line">      <span class="keyword">return</span> login(account).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (response.code === <span class="number">200</span>) &#123;</span><br><span class="line">          ctx.commit(<span class="string">&#x27;setUserInfo&#x27;</span>, response.data.userInfo)</span><br><span class="line">          ctx.commit(<span class="string">&#x27;setToken&#x27;</span>, response.data.token)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写好路由表和 vuex 之后，给所有路由设置一个全局守卫，在进入路由之前进行权限检查，并导航到对应的路由。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// router.js</span></span><br><span class="line">router.beforeEach(<span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.matched.some(<span class="function"><span class="params">record</span> =&gt;</span> record.meta.requireAuth)) &#123;</span><br><span class="line">    <span class="comment">// 检查是否需要登录权限</span></span><br><span class="line">    <span class="keyword">if</span> (!store.state.auth) &#123;</span><br><span class="line">      <span class="comment">// 检查是否已登录</span></span><br><span class="line">      <span class="keyword">if</span> (store.state.token) &#123;</span><br><span class="line">        <span class="comment">// 未登录，但是有token，获取用户信息</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> data = <span class="keyword">await</span> store.dispatch(<span class="string">&#x27;getUserInfo&#x27;</span>, store.state.token);</span><br><span class="line">          <span class="keyword">if</span> (data.code === <span class="number">200</span>) &#123;</span><br><span class="line">            next();</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">window</span>.alert(<span class="string">&#x27;请登录&#x27;</span>);</span><br><span class="line">            store.commit(<span class="string">&#x27;clearToken&#x27;</span>);</span><br><span class="line">            next(&#123; <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span> &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">          <span class="built_in">window</span>.alert(<span class="string">&#x27;请登录&#x27;</span>);</span><br><span class="line">          store.commit(<span class="string">&#x27;clearToken&#x27;</span>);</span><br><span class="line">          next(&#123; <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">window</span>.alert(<span class="string">&#x27;请登录&#x27;</span>);</span><br><span class="line">        next(&#123; <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span> &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      next();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上述的方法是基于<code>jwt</code>认证方式，本地不持久化用户信息，只保存<code>token</code>，当用户刷新或者重新打开网页时，进入需要登录的页面都会尝试去请求用户信息，该操作在整个访问过程中只进行一次，直到刷新或者重新打开，对于应用后期的开发维护和扩展支持都很好。</p>
<h3 id="动态加载菜单和路由-addRoutes"><a href="#动态加载菜单和路由-addRoutes" class="headerlink" title="动态加载菜单和路由(addRoutes)"></a>动态加载菜单和路由(addRoutes)</h3><p>有时候为了安全，我们需要根据用户权限或者是用户属性去动态的添加菜单和路由表，可以实现对用户的功能进行定制。<code>vue-router</code>提供了<code>addRoutes()</code>方法，可以动态注册路由，<strong>需要注意的是，动态添加路由是在路由表中 push 路由，由于路由是按顺序匹配的，因此需要将诸如 404 页面这样的路由放在动态添加的最后。</strong></p>
<p><strong>代码示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store.js</span></span><br><span class="line"><span class="comment">// 将需要动态注册的路由提取到vuex中</span></span><br><span class="line"><span class="keyword">const</span> dynamicRoutes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/manage&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;Manage&#x27;</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      requireAuth: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./views/Manage&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/userCenter&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;UserCenter&#x27;</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      requireAuth: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./views/UserCenter&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>在<code>vuex</code>中添加<code>userRoutes</code>数组用于存储用户的定制菜单。在 setUserInfo 中根据后端返回的菜单生成用户的路由表。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store.js</span></span><br><span class="line">setUserInfo (state, userInfo) &#123;</span><br><span class="line">  state.userInfo = userInfo</span><br><span class="line">  state.auth = <span class="literal">true</span> <span class="comment">// 获取到用户信息的同时将auth标记为true，当然也可以直接判断userInfo</span></span><br><span class="line">  <span class="comment">// 生成用户路由表</span></span><br><span class="line">  state.userRoutes = dynamicRoutes.filter(<span class="function"><span class="params">route</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userInfo.menus.some(<span class="function"><span class="params">menu</span> =&gt;</span> menu.name === route.name)</span><br><span class="line">  &#125;)</span><br><span class="line">  router.addRoutes(state.userRoutes) <span class="comment">// 注册路由</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改菜单渲染</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// App.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>主页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">  |</span><br><span class="line">  <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;(menu, index) of $store.state.userInfo.menus&quot;</span>&gt;</span></span><br><span class="line">    |</span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; name: menu.name &#125;&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123;menu.title&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>前面铺垫了这么多，终于到本篇博客的主题了，下面我们要自己实现一套「动态生成无限菜单+路由」的方案，也就是第二种路由鉴权。</p>
<h2 id="最终实现的菜单列表"><a href="#最终实现的菜单列表" class="headerlink" title="最终实现的菜单列表"></a>最终实现的菜单列表</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">个人中心  Profile.vue</span><br><span class="line">商店     Shop.vue</span><br><span class="line">购物车   Cart.vue</span><br><span class="line">    └── 购物车列表    CartList.vue</span><br><span class="line">       ├── 商品      Product.vue</span><br><span class="line">       └── 彩票      Lottery.vue</span><br></pre></td></tr></table></figure>

<h2 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h2><ol>
<li>后端返回路由权限列表（带权限标识，假定为 auth）</li>
<li>前端进行全局的路由拦截，判断自身有没有获取过后端返回的路由列表</li>
<li>如果没有则获取数据并保存到 vuex 中，动态的生成菜单和路由，然后进行 next 跳转</li>
<li>如果有则不再获取，直接 next 跳转</li>
</ol>
<p>其中第三步是核心点，它还可以细分为下列步骤：</p>
<ol>
<li>菜单栏往往有多级嵌套，所以得根据后端返回的数据进行转换，最终生成无限级菜单；并在转换过程中找到所有可以有权访问的路由名称清单（根据上文提到的 auth 标识寻找）</li>
<li>前端分别保存两种路由列表，第一种是不需要权限就能访问的，例如首页；第二种是需要等级权限才能访问的路由列表，例如新增 admin 管理员</li>
<li>动态生成路由列表（在第二种路由列表中，通过路由名称清单过滤）</li>
</ol>
<h2 id="后台返回的-admin-路由权限"><a href="#后台返回的-admin-路由权限" class="headerlink" title="后台返回的 admin 路由权限"></a>后台返回的 admin 路由权限</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; <span class="attr">pid</span>: -<span class="number">1</span>, <span class="attr">path</span>: <span class="string">&#x27;/cart&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;购物车&#x27;</span>, <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">auth</span>: <span class="string">&#x27;cart&#x27;</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    pid: <span class="number">1</span>,</span><br><span class="line">    path: <span class="string">&#x27;/cart/cart-list&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;购物车列表&#x27;</span>,</span><br><span class="line">    id: <span class="number">4</span>,</span><br><span class="line">    auth: <span class="string">&#x27;cart-list&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    pid: <span class="number">4</span>,</span><br><span class="line">    path: <span class="string">&#x27;/cart/cart-list/lottery&#x27;</span>,</span><br><span class="line">    auth: <span class="string">&#x27;lottery&#x27;</span>,</span><br><span class="line">    id: <span class="number">5</span>,</span><br><span class="line">    name: <span class="string">&#x27;彩票&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    pid: <span class="number">4</span>,</span><br><span class="line">    path: <span class="string">&#x27;/cart/cart-list/product&#x27;</span>,</span><br><span class="line">    auth: <span class="string">&#x27;product&#x27;</span>,</span><br><span class="line">    id: <span class="number">6</span>,</span><br><span class="line">    name: <span class="string">&#x27;商品&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">pid</span>: -<span class="number">1</span>, <span class="attr">path</span>: <span class="string">&#x27;/shop&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;商店&#x27;</span>, <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">auth</span>: <span class="string">&#x27;shop&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">pid</span>: -<span class="number">1</span>, <span class="attr">path</span>: <span class="string">&#x27;/profile&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;个人中心&#x27;</span>, <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">auth</span>: <span class="string">&#x27;store&#x27;</span> &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h2 id="项目生成"><a href="#项目生成" class="headerlink" title="项目生成"></a>项目生成</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vue create menu-auth</span><br><span class="line">? Check the features needed for your project:</span><br><span class="line"> ◉ Babel</span><br><span class="line"> ◉ Router</span><br><span class="line"> ◉ Vuex</span><br><span class="line"> history mode</span><br><span class="line"> In dedicated config files</span><br><span class="line"> Save this as a preset for future projects? (y/N) n</span><br></pre></td></tr></table></figure>

<h3 id="移除不必要的文件及其代码"><a href="#移除不必要的文件及其代码" class="headerlink" title="移除不必要的文件及其代码"></a>移除不必要的文件及其代码</h3><ul>
<li>components/HelloWorld.vue</li>
<li>views/About.vue</li>
<li>views/Home.vue 中 .home 标签下所有内容，有关 HelloWorld.vue 相关代码</li>
<li>App.vue 中 #app 下除 <code>router-view</code> 所有内容</li>
<li>router.js 下有关 About.vue 相关代码</li>
</ul>
<h2 id="后端生成"><a href="#后端生成" class="headerlink" title="后端生成"></a>后端生成</h2><p>根目录下创建 <code>server.js</code> 作为我们的服务端文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line"><span class="comment">// 在后端配置，让所有人都可以访问api接口 跨域问题</span></span><br><span class="line">app.use(<span class="string">&#x27;*&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">  <span class="comment">// Access-Control-Allow-Headers ,可根据浏览器的F12查看,把对应的粘贴在这里就行</span></span><br><span class="line">  res.header(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;Content-Type&#x27;</span>);</span><br><span class="line">  res.header(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">  res.header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 前端请求的路由API路径</span></span><br><span class="line">app.get(<span class="string">&#x27;/role&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.json(&#123;</span><br><span class="line">    <span class="comment">//假如这是后端给我们的JSON数据</span></span><br><span class="line">    menuList: [</span><br><span class="line">      &#123;</span><br><span class="line">        pid: -<span class="number">1</span>,</span><br><span class="line">        path: <span class="string">&#x27;/cart&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;购物车&#x27;</span>,</span><br><span class="line">        id: <span class="number">1</span>,</span><br><span class="line">        auth: <span class="string">&#x27;cart&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        pid: <span class="number">1</span>,</span><br><span class="line">        path: <span class="string">&#x27;/cart/cart-list&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;购物车列表&#x27;</span>,</span><br><span class="line">        id: <span class="number">4</span>,</span><br><span class="line">        auth: <span class="string">&#x27;cart-list&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        pid: <span class="number">4</span>,</span><br><span class="line">        path: <span class="string">&#x27;/cart/cart-list/lottery&#x27;</span>,</span><br><span class="line">        auth: <span class="string">&#x27;lottery&#x27;</span>,</span><br><span class="line">        id: <span class="number">5</span>,</span><br><span class="line">        name: <span class="string">&#x27;彩票&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        pid: <span class="number">4</span>,</span><br><span class="line">        path: <span class="string">&#x27;/cart/cart-list/product&#x27;</span>,</span><br><span class="line">        auth: <span class="string">&#x27;product&#x27;</span>,</span><br><span class="line">        id: <span class="number">6</span>,</span><br><span class="line">        name: <span class="string">&#x27;商品&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        pid: -<span class="number">1</span>,</span><br><span class="line">        path: <span class="string">&#x27;/shop&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;商店&#x27;</span>,</span><br><span class="line">        id: <span class="number">2</span>,</span><br><span class="line">        auth: <span class="string">&#x27;shop&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        pid: -<span class="number">1</span>,</span><br><span class="line">        path: <span class="string">&#x27;/profile&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;个人中心&#x27;</span>,</span><br><span class="line">        id: <span class="number">3</span>,</span><br><span class="line">        auth: <span class="string">&#x27;profile&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    buttonAuth: &#123;</span><br><span class="line">      edit: <span class="literal">true</span> <span class="comment">// 可编辑</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//监听3000端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<p>终端 <code>node server.js</code> 启动，或者使用 <code>nodemon server.js</code> 热启动。</p>
<h2 id="新建路由所需相关文件"><a href="#新建路由所需相关文件" class="headerlink" title="新建路由所需相关文件"></a>新建路由所需相关文件</h2><p>components/menu/ 文件下新建：</p>
<blockquote>
<p>cart-list.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    cart-list</span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>cart.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    cart</span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;cart&#x27;</span></span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>lottery.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>lottery<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>product.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>product<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>profile.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>profile<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>shop.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>shop<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后来一个 404 页面，放在 <code>views/</code> 文件夹下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>404<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a>配置路由</h2><p>来到 <code>router.js</code> 文件配置路由表：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;./views/Home.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Router);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  mode: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">  base: process.env.BASE_URL,</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//访问&#x27;/&#x27;时，重定向到home页面</span></span><br><span class="line">      path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      redirect: <span class="string">&#x27;/home&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">      component: Home</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;/cart&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;cart&#x27;</span>,</span><br><span class="line">      <span class="comment">//使用懒加载，当使用这个组件的时候再加载资源，当组件资源较大时，不建议使用，可能会出现白屏现象</span></span><br><span class="line">      <span class="comment">//而且最好使用绝对路径，@是绝对路径的意思,相当于src下</span></span><br><span class="line">      component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/cart.vue&#x27;</span>),</span><br><span class="line">      <span class="comment">//配置子路由</span></span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">//当配置子路由时，最好不要在前面加&#x27;/&#x27;,比如:&#x27;/cart-list&#x27;</span></span><br><span class="line">          path: <span class="string">&#x27;cart-list&#x27;</span>,</span><br><span class="line">          name: <span class="string">&#x27;cart-list&#x27;</span>,</span><br><span class="line">          component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/cart-list.vue&#x27;</span>),</span><br><span class="line">          <span class="comment">//配置子路由</span></span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&#x27;lottery&#x27;</span>,</span><br><span class="line">              name: <span class="string">&#x27;lottery&#x27;</span>,</span><br><span class="line">              component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/lottery.vue&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&#x27;product&#x27;</span>,</span><br><span class="line">              name: <span class="string">&#x27;product&#x27;</span>,</span><br><span class="line">              component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/product.vue&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;/profile&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;profile&#x27;</span>,</span><br><span class="line">      component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/profile.vue&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;/shop&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;shop&#x27;</span>,</span><br><span class="line">      component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/shop.vue&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">      component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/404.vue&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>配置完成后 <code>npm run serve</code> 跑一下项目，分别进入几个路由路径，看是否能正确打开相应页面。</p>
<h2 id="获取后端-admin-权限数据"><a href="#获取后端-admin-权限数据" class="headerlink" title="获取后端 admin 权限数据"></a>获取后端 admin 权限数据</h2><p>为了拿到后端返回的数据，我们需要利用 axios 发起异步请求，并把响应回来的数据存放到 vuex 中去，并且还需要对后端数据做一个转换，将其转换为下面格式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 后端格式</span></span><br><span class="line">[</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;a&#x27;</span>, <span class="attr">pid</span>: -<span class="number">1</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;b&#x27;</span>, <span class="attr">pid</span>: -<span class="number">1</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&#x27;c&#x27;</span>, <span class="attr">pid</span>: <span class="number">1</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&#x27;d&#x27;</span>, <span class="attr">pid</span>: <span class="number">1</span>&#125;</span><br><span class="line">]</span><br><span class="line">↓↓↓</span><br><span class="line">[</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;a&#x27;</span>, <span class="attr">pid</span>: -<span class="number">1</span>, <span class="attr">children</span>: [</span><br><span class="line">    &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&#x27;c&#x27;</span>, <span class="attr">pid</span>: <span class="number">1</span>, <span class="attr">children</span>: <span class="literal">null</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&#x27;d&#x27;</span>, <span class="attr">pid</span>: <span class="number">1</span>, <span class="attr">children</span>: <span class="literal">null</span>&#125;</span><br><span class="line">  ]&#125;,</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;b&#x27;</span>, <span class="attr">pid</span>: -<span class="number">1</span>, <span class="attr">children</span>: <span class="literal">null</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="安装-axios"><a href="#安装-axios" class="headerlink" title="安装 axios"></a>安装 axios</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install axios</span><br></pre></td></tr></table></figure>

<h3 id="在全局路由守卫中监听是否已获取过路由权限数据"><a href="#在全局路由守卫中监听是否已获取过路由权限数据" class="headerlink" title="在全局路由守卫中监听是否已获取过路由权限数据"></a>在全局路由守卫中监听是否已获取过路由权限数据</h3><p>路由权限的数据，为了安全我们需要页面切换时就再次获取，所以可以用全局路由守卫帮助我们实现，逻辑如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 只要页面切换就执行的钩子</span></span><br><span class="line">router.beforeEach(<span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 判断当前有没有获取过权限，如果获取过了，就不要再获取了</span></span><br><span class="line">  <span class="keyword">if</span> (!store.state.hasRules) &#123;</span><br><span class="line">    <span class="comment">//获取权限，调用获取权限的接口，去action中获取数据</span></span><br><span class="line">    <span class="keyword">await</span> store.dispatch(<span class="string">&#x27;getMenuList&#x27;</span>);</span><br><span class="line">    next();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//如果已经获取了权限就可以访问页面了</span></span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="编写-vuex-数据转化（递归）"><a href="#编写-vuex-数据转化（递归）" class="headerlink" title="编写 vuex + 数据转化（递归）"></a>编写 vuex + 数据转化（递归）</h3><p>根据上面钩子函数中的逻辑，在 vuex 中添加相应内容：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后端数据转化</span></span><br><span class="line"><span class="keyword">let</span> formatMenuList = <span class="function"><span class="params">menuList</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">r</span>(<span class="params">pid</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//filter过滤数组，返回一个满足要求的数组</span></span><br><span class="line">    <span class="keyword">return</span> menuList.filter(<span class="function"><span class="params">menu</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//格式化菜单变成我们需要的结果</span></span><br><span class="line">      <span class="keyword">if</span> (menu.pid === pid) &#123;</span><br><span class="line">        <span class="keyword">let</span> children = r(menu.id);</span><br><span class="line">        menu.children = children.length ? children : <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> r(-<span class="number">1</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    <span class="comment">// 存放菜单权限数据</span></span><br><span class="line">    menuList: [],</span><br><span class="line">    <span class="comment">// 原本只要判断menuList.length是否不为空就能判定是否已经获取过menuList，</span></span><br><span class="line">    <span class="comment">// 但如果后台返回空数组咋办？所以此处还需要一个hasRules变量来标识是否已获取</span></span><br><span class="line">    <span class="comment">// 做法就是，获取完毕后，把hasRules改为true</span></span><br><span class="line">    hasRules: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;&#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getMenuList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123; data &#125; = <span class="keyword">await</span> axios.get(<span class="string">&#x27;http://localhost:3000/role&#x27;</span>);</span><br><span class="line">      <span class="keyword">let</span> menuList = data.menuList;</span><br><span class="line">      menuList = formatMenuList(menuList);</span><br><span class="line">      <span class="built_in">console</span>.log(menuList);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>但目前有个小问题，即我们在 router.js 中配置了所有路由，然后根据后端返回的权限来动态展示相应菜单，从而实现跳转。但如果用户猜出了不允许他访问的路由，直接修改 url 跳转怎么办？那他不是也能访问了吗？</p>
<p>所以我们需要让后端在返回的数据中，给每个路由对象添加一个 最开始提到的 auth 标识：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123; <span class="attr">pid</span>: -<span class="number">1</span>, <span class="attr">path</span>: <span class="string">&#x27;/cart&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;购物车&#x27;</span>, <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">auth</span>: <span class="string">&#x27;cart&#x27;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>如果有 auth 标识，代表当前用户能够访问，如果没有，则表示当前用户不能访问，这样我们前端就能据此动态的删除掉不能访问的路由。</p>
<p>回到 <code>src/store.js</code> ，我们需要把后端这个 <code>auth</code> 属性都保存起来。首先在 <code>state</code> 中加上 <code>authList</code> 属性，用来存储哪些路由能有权限访问：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">state: &#123;</span><br><span class="line">  authList: [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在 <code>formatMenuList</code> 方法中，提取权限：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> formatMenuList = <span class="function"><span class="params">menuList</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> arr = []; <span class="comment">// [cart, cart-list, profile, ...]</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">r</span>(<span class="params">pid</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//filter过滤数组，返回一个满足要求的数组</span></span><br><span class="line">    <span class="keyword">return</span> menuList.filter(<span class="function"><span class="params">menu</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//格式化菜单变成我们需要的结果</span></span><br><span class="line">      <span class="keyword">if</span> (menu.pid === pid) &#123;</span><br><span class="line">        arr.push(menu.auth); <span class="comment">// 把后端返回的所有路径权限都放到数组中</span></span><br><span class="line">        <span class="keyword">let</span> children = r(menu.id);</span><br><span class="line">        menu.children = children.length ? children : <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">menuL</span>: r(-<span class="number">1</span>), <span class="attr">authL</span>: arr &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这样改造后，<code>formatMenuList</code> 方法就返回一个对象了，该对象中包含路由菜单和路由权限两个数组。</p>
<p>相应的，我们还得改造使用了 <code>formatMenuList</code> 方法的 action ——&gt; <code>getMenuList</code> ：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getMenuList</span>(<span class="params">&#123; commit &#125;</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; data &#125; =<span class="keyword">await</span> axios.get(<span class="string">&#x27;http://localhost:3000/role&#x27;</span>)</span><br><span class="line">  <span class="keyword">let</span> &#123; menuL, authL &#125; = formatMenuList(data.menuList)</span><br><span class="line">  <span class="built_in">console</span>.log(menuL, authL)</span><br><span class="line">  commit(<span class="string">&#x27;set_menuList&#x27;</span>, menuL)</span><br><span class="line">  commit(<span class="string">&#x27;set_authList&#x27;</span>, authL)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的，编写两个 mutation ：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">set_menuList</span>(<span class="params">state, m</span>)</span> &#123;</span><br><span class="line">  state.menuList = m</span><br><span class="line">&#125;,</span><br><span class="line"><span class="function"><span class="title">set_authList</span>(<span class="params">state, a</span>)</span> &#123;</span><br><span class="line">  state.authList = a</span><br><span class="line">  state.hasRules = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>保存后 console.log 一下，menuList 和 authList 就出来了。</p>
<h2 id="渲染无限菜单"><a href="#渲染无限菜单" class="headerlink" title="渲染无限菜单"></a>渲染无限菜单</h2><h3 id="配置-element-ui"><a href="#配置-element-ui" class="headerlink" title="配置 element-ui"></a>配置 element-ui</h3><p>安装：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install element-ui</span><br></pre></td></tr></table></figure>

<p><code>main.js</code> 中进行配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ElementUI <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;</span><br><span class="line">Vue.use(ElementUI);</span><br></pre></td></tr></table></figure>

<h3 id="在-Home-vue-页面中引入静态菜单"><a href="#在-Home-vue-页面中引入静态菜单" class="headerlink" title="在 Home.vue 页面中引入静态菜单"></a>在 Home.vue 页面中引入静态菜单</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-menu</span> <span class="attr">default-active</span>=<span class="string">&quot;2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;el-menu-vertical-demo&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-submenu</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>导航一<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-submenu</span> <span class="attr">index</span>=<span class="string">&quot;1-1&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>选项1-1<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-1-1&quot;</span>&gt;</span>选项1-1-1<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-1-2&quot;</span>&gt;</span>选项1-1-2<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-2&quot;</span>&gt;</span>选项1-2<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span>导航二<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;3&quot;</span>&gt;</span>导航三<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;4&quot;</span>&gt;</span>导航四<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-menu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>刷新页面后就能显示静态的 Element 菜单了。但点击某个菜单选项后浏览器无法跳转，所以我们还得给 <code>&lt;el-menu&gt;&lt;/el-menu&gt;</code> 标签设置个 <code>router</code> 属性为 true ，这样就能根据菜单的 <code>index</code> 属性进行路由跳转了：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-menu</span> <span class="attr">default-active</span>=<span class="string">&quot;2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;el-menu-vertical-demo&quot;</span> <span class="attr">:router</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-submenu</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>导航一<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-submenu</span> <span class="attr">index</span>=<span class="string">&quot;1-1&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>选项1-1<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-1-1&quot;</span>&gt;</span>选项1-1-1<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-1-2&quot;</span>&gt;</span>选项1-1-2<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-2&quot;</span>&gt;</span>选项1-2<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span>导航二<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;3&quot;</span>&gt;</span>导航三<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;4&quot;</span>&gt;</span>导航四<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-menu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="静态转动态菜单"><a href="#静态转动态菜单" class="headerlink" title="静态转动态菜单"></a>静态转动态菜单</h3><p>最后利用后端获取的 admin 权限数据将静态菜单改为动态菜单：</p>
<blockquote>
<p>src/views/Home.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-menu</span> <span class="attr">default-active</span>=<span class="string">&quot;2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;el-menu-vertical-demo&quot;</span> <span class="attr">:router</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;m in menuList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-submenu</span> <span class="attr">index</span>=<span class="string">&quot;1-1&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;m.auth&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;m.children&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123;m.name&#125;&#125;<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-1-1&quot;</span>&gt;</span>选项1-1-1<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-1-2&quot;</span>&gt;</span>选项1-1-2<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-2&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;m.auth&quot;</span> <span class="attr">v-else</span>&gt;</span>&#123;&#123;m.name&#125;&#125;<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- &lt;el-submenu index=&quot;1&quot;&gt;</span></span><br><span class="line"><span class="comment">        &lt;template slot=&quot;title&quot;&gt;导航一&lt;/template&gt;</span></span><br><span class="line"><span class="comment">        &lt;el-submenu index=&quot;1-1&quot;&gt;</span></span><br><span class="line"><span class="comment">          &lt;template slot=&quot;title&quot;&gt;选项1-1&lt;/template&gt;</span></span><br><span class="line"><span class="comment">          &lt;el-menu-item index=&quot;1-1-1&quot;&gt;选项1-1-1&lt;/el-menu-item&gt;</span></span><br><span class="line"><span class="comment">          &lt;el-menu-item index=&quot;1-1-2&quot;&gt;选项1-1-2&lt;/el-menu-item&gt;</span></span><br><span class="line"><span class="comment">        &lt;/el-submenu&gt;</span></span><br><span class="line"><span class="comment">        &lt;el-menu-item index=&quot;1-2&quot;&gt;选项1-2&lt;/el-menu-item&gt;</span></span><br><span class="line"><span class="comment">      &lt;/el-submenu&gt;</span></span><br><span class="line"><span class="comment">      &lt;el-menu-item index=&quot;2&quot;&gt;</span></span><br><span class="line"><span class="comment">        导航二</span></span><br><span class="line"><span class="comment">      &lt;/el-menu-item&gt;</span></span><br><span class="line"><span class="comment">      &lt;el-menu-item index=&quot;3&quot;&gt;</span></span><br><span class="line"><span class="comment">        导航三</span></span><br><span class="line"><span class="comment">      &lt;/el-menu-item&gt;</span></span><br><span class="line"><span class="comment">      &lt;el-menu-item index=&quot;4&quot;&gt;</span></span><br><span class="line"><span class="comment">        导航四</span></span><br><span class="line"><span class="comment">      &lt;/el-menu-item&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-menu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;home&#x27;</span>,</span></span><br><span class="line">    computed: &#123;</span><br><span class="line"><span class="javascript">      ...mapState([<span class="string">&#x27;menuList&#x27;</span>])</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="无限菜单"><a href="#无限菜单" class="headerlink" title="无限菜单"></a>无限菜单</h3><p>仔细观察上方的菜单格式，会发现下面这段代码会重复出现：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 带有子菜单的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-submenu</span> <span class="attr">index</span>=<span class="string">&quot;1-1&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;m.auth&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;m.children&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123;m.name&#125;&#125;<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-1-1&quot;</span>&gt;</span>选项1-1-1<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-1-2&quot;</span>&gt;</span>选项1-1-2<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 不带有子菜单的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-2&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;m.auth&quot;</span> <span class="attr">v-else</span>&gt;</span>&#123;&#123;m.name&#125;&#125;<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>所以我们把它提取出去单独渲染，这样就能实现无限菜单了：</p>
<blockquote>
<p>新建 <code>src/views/ReSubMenu.vue</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 封装递归组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-submenu</span> <span class="attr">:index</span>=<span class="string">&quot;data.path&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 子菜单标题 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;data.path&quot;</span>&gt;</span>&#123;&#123;data.name&#125;&#125;<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;c in data.children&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 若子菜单还有children，继续递归自己 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ReSubMenu</span> <span class="attr">:key</span>=<span class="string">&quot;c.auth&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;data.children&quot;</span> <span class="attr">:data</span>=<span class="string">&quot;c&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ReSubMenu</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 没有则直接显示 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">:key</span>=<span class="string">&quot;c.auth&quot;</span> <span class="attr">v-else</span> <span class="attr">:index</span>=<span class="string">&quot;c.path&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;c.name&#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;ReSubMenu&#x27;</span>,</span></span><br><span class="line">    props: &#123;</span><br><span class="line">      data: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="function">() =&gt;</span> (&#123;&#125;)</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在父组件 <code>Home.vue</code> 中使用：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-menu</span> <span class="attr">default-active</span>=<span class="string">&quot;2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;el-menu-vertical-demo&quot;</span> <span class="attr">:router</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;m in menuList&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 递归组件 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 判断条件：有children的就是带有子菜单的，使用递归组件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ReSubMenu</span> <span class="attr">:data</span>=<span class="string">&quot;m&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;m.auth&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;m.children&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ReSubMenu</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 没有children的情况 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">v-else</span> <span class="attr">:key</span>=<span class="string">&quot;m.auth&quot;</span> <span class="attr">:index</span>=<span class="string">&quot;m.path&quot;</span>&gt;</span></span><br><span class="line">          &#123;&#123;m.name&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">//导入vuex中的方法，具体参考我的文章</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> ReSubMenu <span class="keyword">from</span> <span class="string">&#x27;./ReSubMenu&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;home&#x27;</span>,</span></span><br><span class="line">    computed: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">//根据后端传过来的数据来渲染Home</span></span></span><br><span class="line"><span class="javascript">      ...mapState([<span class="string">&#x27;menuList&#x27;</span>])</span></span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      ReSubMenu</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="根据权限动态添加路由"><a href="#根据权限动态添加路由" class="headerlink" title="根据权限动态添加路由"></a>根据权限动态添加路由</h2><p>实现了无限菜单后，我们接下来就要根据之前保存的 <code>authList</code> 实现动态路由了。</p>
<p>第一步就是把 <code>router.js</code> 中的路由列表分成两部分，一部分是不需要权限就能访问的，另一部分是需要根据权限列表动态生成的，我们首先来抽离之前在 routes 中的路由列表，拷贝一份后存到两个变量中，其中 <code>authRoutes</code> 需要 export 导出，等会 <code>store.js</code> 中匹配用户权限时需要使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 默认路由列表：不需要权限就能访问的</span></span><br><span class="line"><span class="keyword">let</span> defaultRoutes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    redirect: <span class="string">&#x27;/home&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">    component: Home</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/404.vue&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要权限才能访问的路由列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> authRoutes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/cart&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;cart&#x27;</span>,</span><br><span class="line">    <span class="comment">//使用懒加载，当使用这个组件的时候再加载资源，当组件资源较大时，不建议使用，可能会出现白屏现象</span></span><br><span class="line">    <span class="comment">//而且最好使用绝对路径，@是绝对路径的意思,相当于src下</span></span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/cart.vue&#x27;</span>),</span><br><span class="line">    <span class="comment">//配置子路由</span></span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//当配置子路由时，最好不要在前面加&#x27;/&#x27;,比如:&#x27;/cart-list&#x27;</span></span><br><span class="line">        path: <span class="string">&#x27;cart-list&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;cart-list&#x27;</span>,</span><br><span class="line">        component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/cart-list.vue&#x27;</span>),</span><br><span class="line">        <span class="comment">//配置子路由</span></span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">&#x27;lottery&#x27;</span>,</span><br><span class="line">            name: <span class="string">&#x27;lottery&#x27;</span>,</span><br><span class="line">            component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/lottery.vue&#x27;</span>)</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">&#x27;product&#x27;</span>,</span><br><span class="line">            name: <span class="string">&#x27;product&#x27;</span>,</span><br><span class="line">            component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/product.vue&#x27;</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/profile&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;profile&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/profile.vue&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/shop&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;shop&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/shop.vue&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>然后把原本 <code>routes</code> 列表中的数组删除，改为 <code>defaultRoutes</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;./views/Home.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Router);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认路由列表：不需要权限就能访问的</span></span><br><span class="line"><span class="keyword">let</span> defaultRoutes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    redirect: <span class="string">&#x27;/home&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">    component: Home</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/404.vue&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要权限才能访问的路由列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> authRoutes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/cart&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;cart&#x27;</span>,</span><br><span class="line">    <span class="comment">//使用懒加载，当使用这个组件的时候再加载资源，当组件资源较大时，不建议使用，可能会出现白屏现象</span></span><br><span class="line">    <span class="comment">//而且最好使用绝对路径，@是绝对路径的意思,相当于src下</span></span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/cart.vue&#x27;</span>),</span><br><span class="line">    <span class="comment">//配置子路由</span></span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//当配置子路由时，最好不要在前面加&#x27;/&#x27;,比如:&#x27;/cart-list&#x27;</span></span><br><span class="line">        path: <span class="string">&#x27;cart-list&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;cart-list&#x27;</span>,</span><br><span class="line">        component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/cart-list.vue&#x27;</span>),</span><br><span class="line">        <span class="comment">//配置子路由</span></span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">&#x27;lottery&#x27;</span>,</span><br><span class="line">            name: <span class="string">&#x27;lottery&#x27;</span>,</span><br><span class="line">            component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/lottery.vue&#x27;</span>)</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">&#x27;product&#x27;</span>,</span><br><span class="line">            name: <span class="string">&#x27;product&#x27;</span>,</span><br><span class="line">            component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/product.vue&#x27;</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/profile&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;profile&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/profile.vue&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/shop&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;shop&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/menu/shop.vue&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要查看当前用户权限来动态添加路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  mode: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">  base: process.env.BASE_URL,</span><br><span class="line">  <span class="comment">// 默认所有用户可访问的路由，其他需要权限的动态在 main.js 中动态装载给当前router对象</span></span><br><span class="line">  routes: defaultRoutes</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>再回到 <code>main.js</code> 中的全局钩子函数，我们需要创建一个 <code>action</code> 来动态生成需要权限才能访问的路由：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 只要页面切换就执行的钩子</span></span><br><span class="line">router.beforeEach(<span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 判断当前有没有获取过权限，如果获取过了，就不要再获取了</span></span><br><span class="line">  <span class="keyword">if</span> (!store.state.hasRules) &#123;</span><br><span class="line">    <span class="comment">//获取权限，调用获取权限的接口，去action中获取数据</span></span><br><span class="line">    <span class="keyword">await</span> store.dispatch(<span class="string">&#x27;getMenuList&#x27;</span>);</span><br><span class="line">    <span class="comment">// 拿到动态生成的路由列表</span></span><br><span class="line">    <span class="keyword">let</span> r = <span class="keyword">await</span> store.dispatch(<span class="string">&#x27;getAuthRoute&#x27;</span>);</span><br><span class="line">    <span class="comment">// 添加到当前路由中</span></span><br><span class="line">    router.addRoutes(r);</span><br><span class="line">    next();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//如果已经获取了权限就可以访问页面了</span></span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>最后在 <code>store.js</code> 中实现 <code>getAuthRoute</code> 这个 action：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 首先导入router中完整的权限路由列表</span></span><br><span class="line"><span class="keyword">import</span> &#123; authRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 然后在router的所有权限列表中，匹配当前用户可以访问的权限列表</span></span><br><span class="line"><span class="comment">// 生成动态路由</span></span><br><span class="line"><span class="keyword">let</span> getNeedRoutes = <span class="function">(<span class="params">auth</span>) =&gt;</span> &#123; <span class="comment">//[&#x27;cart&#x27;,&#x27;cart-list&#x27;....]</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">r</span>(<span class="params">authRoutes</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> authRoutes.filter(<span class="function"><span class="params">route</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (auth.includes(route.name)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (route.children) &#123; <span class="comment">//如果有儿子</span></span><br><span class="line">          <span class="comment">//找到儿子继续看子路由的权限</span></span><br><span class="line">          route.children = r(route.children)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">//有权限就返回</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> r(authRoutes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  ...</span><br><span class="line">  actions: &#123;</span><br><span class="line">    ..</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getAuthRoute</span>(<span class="params">&#123; commit, state &#125;</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 最后把当前需要动态添加的路由返回出去</span></span><br><span class="line">      <span class="keyword">let</span> r = getNeedRoutes(state.authList)</span><br><span class="line">      <span class="keyword">return</span> r</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>到此为止就实现了一套 <code>动态路由 + 路由鉴权</code> 功能。</p>
<h2 id="配套代码"><a href="#配套代码" class="headerlink" title="配套代码"></a>配套代码</h2><p><a href="https://github.com/evestorm/front-end-playground/tree/master/vue/%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%2B%E8%B7%AF%E7%94%B1%E9%89%B4%E6%9D%83/menu-auth">动态路由+路由鉴权</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>框架</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>基于sequelize的数据库迁移</title>
    <url>/posts/16051/</url>
    <content><![CDATA[<h2 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a>数据库迁移</h2><p>有时候我们也希望能够跟踪数据库的更改，像 git 一样在各个不同时期的数据库状态之间进行切换。或者能通过一套工具将数据库迁移到本机，让我们在家也能进行测试开发，而不用依赖公司的测试环境。这些特性，作为今天的主角 <code>sequelize-cli</code> 都能提供给我们。</p>
<blockquote>
<p>npm链接请 <a href="https://www.npmjs.com/package/sequelize-cli">点击这里</a>。</p>
</blockquote>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>首先创建项目，项目名随意，创建完毕后cd到项目根目录，老规矩命令行 <code>npm init -y</code> 创建 <code>package.json</code> ，然后输入安装一步到位：<code>npm i sequelize mysql2 sequelize-cli</code> 。</p>
<a id="more"></a>

<p><strong>注意：</strong> <code>sequelize-cli</code> 依赖 <code>sequelize</code>，<code>sequelize</code> 依赖 <code>mysql2</code></p>
<p>安装完毕后我们可以测试下是否可用，根目录命令行输入：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./node_modules/.bin/sequelize</span><br></pre></td></tr></table></figure>

<p>看见命令行输出类似下方提示代表安装成功：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sequelize [命令]</span><br><span class="line"></span><br><span class="line">命令：</span><br><span class="line">  sequelize db:migrate                        Run pending migrations</span><br><span class="line">  sequelize db:migrate:schema:timestamps:add  Update migration table to have timestamps</span><br><span class="line">  sequelize db:migrate:status                 List the status of all migrations</span><br><span class="line">  sequelize db:migrate:undo                   Reverts a migration</span><br><span class="line">  sequelize db:migrate:undo:all               Revert all migrations ran</span><br><span class="line">  sequelize db:seed                           Run specified seeder</span><br><span class="line">  sequelize db:seed:undo                      Deletes data from the database</span><br><span class="line">  sequelize db:seed:all                       Run every seeder</span><br><span class="line">  sequelize db:seed:undo:all                  Deletes data from the database</span><br><span class="line">  sequelize db:create                         Create database specified by configuration</span><br><span class="line">  sequelize db:drop                           Drop database specified by configuration</span><br><span class="line">  sequelize init                              Initializes project</span><br><span class="line">  sequelize init:config                       Initializes configuration</span><br><span class="line">  sequelize init:migrations                   Initializes migrations</span><br><span class="line">  sequelize init:models                       Initializes models</span><br><span class="line">  sequelize init:seeders                      Initializes seeders</span><br><span class="line">  sequelize migration:generate                Generates a new migration file     [aliases: migration:create]</span><br><span class="line">  sequelize model:generate                    Generates a model and its migration    [aliases: model:create]</span><br><span class="line">  sequelize seed:generate                     Generates a new seed file               [aliases: seed:create]</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">  --help     显示帮助信息                                                                             [布尔]</span><br><span class="line">  --version  显示版本号                                                                               [布尔]</span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>目前我们项目的树形结构为：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── node_modules</span><br><span class="line">├── package-lock.json</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure>

<p>接着根目录命令行输入 <code>./node_modules/.bin/sequelize init</code> 来初始化 sequelize 项目，该命令会帮我们创建如下目录：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── config              # 包含数据库的配置文件</span><br><span class="line">├── migrations          # 包含所有迁移文件（e.g. 数据库、表的创建，字段的增加）跟数据库结构有关的操作都存放在这里</span><br><span class="line">├── models              # 包含项目中的所有模型（e.g. Users, Message）</span><br><span class="line">├── node_modules</span><br><span class="line">├── seeders             # 包含所有种子文件（e.g. 表中的数据）</span><br><span class="line">├── package-lock.json</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure>



<h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><p>首先我们来看下 <code>config</code> 目录下的 <code>config.json</code> 文件。它里面包含了数据库的的基本配置，默认分为 <code>development（开发）</code> 、<code>test（测试）</code> 和 <code>production（生产）</code> 环境。当然你也可以删除或新增环境，比如新增一个在家编写代码所使用的 <code>home</code> 环境。</p>
<h3 id="db-create"><a href="#db-create" class="headerlink" title="db:create"></a>db:create</h3><p><code>sequelize-cli</code> 默认读取 <code>development</code> 模式下的数据库配置来创建数据库，所以接下来就用它来配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;development&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;root&quot;</span>, <span class="comment">// 数据库用户名</span></span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;root&quot;</span>, <span class="comment">// 数据库密码</span></span><br><span class="line">    <span class="string">&quot;database&quot;</span>: <span class="string">&quot;database_development&quot;</span>, <span class="comment">// 需要创建的数据库名</span></span><br><span class="line">    <span class="string">&quot;host&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>, <span class="comment">// 主机</span></span><br><span class="line">    <span class="string">&quot;port&quot;</span>: <span class="number">8889</span>,       <span class="comment">// 端口号</span></span><br><span class="line">    <span class="string">&quot;dialect&quot;</span>: <span class="string">&quot;mysql&quot;</span>  <span class="comment">// 使用的数据库类型</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<p>配置完毕后在根目录下的命令行输入 <code>./node_modules/.bin/sequelize db:create</code><br>。当你看到如下输出就代表创建数据库成功：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Loaded configuration file &quot;config/config.json&quot;.</span><br><span class="line">Using environment &quot;development&quot;.</span><br><span class="line">Database sw_sequelize_development created.</span><br></pre></td></tr></table></figure>



<h3 id="db-drop"><a href="#db-drop" class="headerlink" title="db:drop"></a>db:drop</h3><p>能添加就能删除，我们可以键入 <code>./node_modules/.bin/sequelize db:drop</code> 命令来删除数据库。当你看到命令行输出下面内容就代表删除成功：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Loaded configuration file &quot;config/config.json&quot;.</span><br><span class="line">Using environment &quot;development&quot;.</span><br><span class="line">Database sw_sequelize_development dropped.</span><br></pre></td></tr></table></figure>



<h3 id="模式切换"><a href="#模式切换" class="headerlink" title="模式切换"></a>模式切换</h3><p>前面已经说了，<code>sequelize-cli</code> 默认读取 <code>development</code> 模式下的数据库配置。那如果我现在想切到 <code>test</code> 模式下该怎么办呢？</p>
<h4 id="变更环境变量"><a href="#变更环境变量" class="headerlink" title="变更环境变量"></a>变更环境变量</h4><p>首先得切换服务器环境变量，MacOS下（其他系统切换命令见下方链接）使用 <code>export NODE_ENV=test</code> 来切换到 <code>test</code> 模式，然后使用 <code>echo $NODE_ENV</code> 查看是否已经切换成功，接着就可以再次执行 <code>./node_modules/.bin/sequelize db:create</code> 命令，创建 <code>test</code> 模式下的数据库了：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> NODE_ENV=<span class="built_in">test</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$NODE_ENV</span></span></span><br><span class="line">test</span><br><span class="line"></span><br><span class="line">./node_modules/.bin/sequelize db:create</span><br><span class="line"></span><br><span class="line">Sequelize CLI [Node: 9.0.0, CLI: 5.4.0, ORM: 5.3.3]</span><br><span class="line"></span><br><span class="line">Loaded configuration file &quot;config/config.json&quot;.</span><br><span class="line">Using environment &quot;test&quot;.</span><br><span class="line">Database sw_sequelize_test created.</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="http://sorex.cnblogs.com/p/6200940.html">各系统下NodeJS环境变量修改</a></p>
</blockquote>
<h4 id="还原环境变量"><a href="#还原环境变量" class="headerlink" title="还原环境变量"></a>还原环境变量</h4><p>如果想回到默认的 <code>development</code> 模式，MacOS下直接键入命令 <code>export NODE_ENV=</code> 就OK啦。</p>
<h2 id="models"><a href="#models" class="headerlink" title="models"></a>models</h2><h3 id="创建模型"><a href="#创建模型" class="headerlink" title="创建模型"></a>创建模型</h3><p>我们通过 <code>model:generate</code> 或者 <code>model:create</code> 来创建模型文件，它一共需要两个参数，分别是：</p>
<ul>
<li>–name: 模型名称（必须）</li>
<li>–attributes: 字段列表（必须）</li>
</ul>
<p>回到我们的项目，在根目录执行下面命令来创建一个 User 模型文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./node_modules/.bin/sequelize model:create --name User --attributes username:STRING</span><br></pre></td></tr></table></figure>

<p>执行完毕后命令行会有类似下方输出：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Sequelize CLI [Node: 9.0.0, CLI: 5.4.0, ORM: 5.3.3]</span><br><span class="line"></span><br><span class="line">New model was created at .../你的项目名/models/user.js .</span><br><span class="line">New migration was created at .../你的项目名/migrations/20190316035632-User.js</span><br></pre></td></tr></table></figure>



<p>所以 <code>model:create</code> 命令执行后帮我们创建了两个文件，一个是用来定义 User 模型的文件 user.js :</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">sequelize, DataTypes</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> User = sequelize.define(<span class="string">&#x27;User&#x27;</span>, &#123;</span><br><span class="line">    username: DataTypes.STRING</span><br><span class="line">  &#125;, &#123;&#125;);</span><br><span class="line">  User.associate = <span class="function"><span class="keyword">function</span>(<span class="params">models</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// associations can be defined here</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> User;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>一个是 <code>migrations</code> 迁移文件夹下的 <code>用来创建 User 表</code> 的文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  up: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//   创建名为 Users 的数据表</span></span><br><span class="line">    <span class="keyword">return</span> queryInterface.createTable(<span class="string">&#x27;Users&#x27;</span>, &#123;</span><br><span class="line">      id: &#123;</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        autoIncrement: <span class="literal">true</span>,</span><br><span class="line">        primaryKey: <span class="literal">true</span>,</span><br><span class="line">        type: Sequelize.INTEGER</span><br><span class="line">      &#125;,</span><br><span class="line">      username: &#123;</span><br><span class="line">        type: Sequelize.STRING</span><br><span class="line">      &#125;,</span><br><span class="line">      createdAt: &#123;</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        type: Sequelize.DATE</span><br><span class="line">      &#125;,</span><br><span class="line">      updatedAt: &#123;</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        type: Sequelize.DATE</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  down: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.dropTable(<span class="string">&#x27;Users&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>其中 <code>models</code> 文件夹下文件，例如生成的 <code>user.js</code> 模型文件是给程序用的；<code>migrations</code> 和 <code>seeders</code> 文件夹下的文件是个 <code>cli</code> 用的。</p>
<p>总结下来，<code>model:create</code> 命令帮我们做了两件事情：</p>
<ul>
<li>创建 User 模型</li>
<li>创建跟模型对应的 Users 数据表文件，方便用此文件在数据库中创建 Users 表</li>
</ul>
<h2 id="migrations"><a href="#migrations" class="headerlink" title="migrations"></a>migrations</h2><p>刚刚我们已经创建了一个 User 模型和用来创建 Users 表的脚本执行文件。下面就可以开始执行迁移了。首先我们重温何为执行迁移：</p>
<blockquote>
<p>所谓迁移，就是对数据库进行结构的创建、升级（修改）等操作</p>
</blockquote>
<h3 id="执行迁移"><a href="#执行迁移" class="headerlink" title="执行迁移"></a>执行迁移</h3><h4 id="db-migrate"><a href="#db-migrate" class="headerlink" title="db:migrate"></a>db:migrate</h4><p>执行迁移的命令为 <code>db:migrate</code>，我们直接在项目根目录下运行：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./node_modules/.bin/sequelize db:migrate</span><br></pre></td></tr></table></figure>

<p>（如果在此之前你运行过 db:drop 命令来删除数据库，记得再重新执行一次 db:create，否则会导致创建表失败）。执行成功的输出类似下面文字：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Sequelize CLI [Node: 9.0.0, CLI: 5.4.0, ORM: 5.3.3]</span><br><span class="line"></span><br><span class="line">Loaded configuration file &quot;config/config.json&quot;.</span><br><span class="line">Using environment &quot;development&quot;.</span><br><span class="line">== 20190316035632-create-user: migrating =======</span><br><span class="line">== 20190316035632-create-user: migrated (0.047s)</span><br></pre></td></tr></table></figure>

<p>此时刷新下你的本地数据库，就会发现之前空空如也的数据库中多了个 <code>users</code> 表和 <code>sequelizemeta</code> 表：</p>
<img src="/posts/16051/create-users.png" class="" title="create-users">

<p><code>users</code> 表被创建出来我们能理解，重点说一下这个 <code>sequelizemeta</code> 表，其实它是用来记录已经被执行过的迁移脚本的，避免我们重复执行已经执行过的脚本。</p>
<h4 id="db-migrate-status"><a href="#db-migrate-status" class="headerlink" title="db:migrate:status"></a>db:migrate:status</h4><p>我们可以通过 <code>db:migrate:status</code> 命令来查看当前迁移脚本的执行状态：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./node_modules/.bin/sequelize db:migrate:status</span><br></pre></td></tr></table></figure>

<p>执行完毕后的打印结果为：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Loaded configuration file &quot;config/config.json&quot;.</span><br><span class="line">Using environment &quot;development&quot;.</span><br><span class="line">up 20190316035632-create-user.js</span><br></pre></td></tr></table></figure>

<p>这个 up ，表示我们已经执行该脚本。此时我们可以删掉 <code>sequelizemeta</code> 表中的记录，然后再次执行 <code>db:migrate:status</code> ，会发现输出的 <code>up</code> 已变为 <code>down</code> ，表示我们从未执行过该脚本。由此可知 <code>db:migrate:status</code> 会通过 <code>sequelizemeta</code> 表中的记录来判断脚本是否被执行过。而当我们已经执行过某些脚本后再次执行 <code>db:migrate</code> ，那些已经执行过的脚本就不会再次重复执行了：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Loaded configuration file &quot;config/config.json&quot;.</span><br><span class="line">Using environment &quot;development&quot;.</span><br><span class="line">No migrations were executed, database schema was already up to date.</span><br></pre></td></tr></table></figure>

<h4 id="db-migrate-undo"><a href="#db-migrate-undo" class="headerlink" title="db:migrate:undo"></a>db:migrate:undo</h4><p>除了上面的新增数据表操作，我们还可以进行撤销操作。执行 <code>./node_modules/.bin/sequelize db:migrate:status</code> 命令后 <code>sequelize-cli</code> 会帮我们撤销掉上一次（最近一次）的迁移操作，比如我们的 <code>sequelizemeta</code><br>表中记录了两条迁移操作（假设创建了 user 和 message 表）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">20190316035632</span>-create-user.js</span><br><span class="line"><span class="number">20190316035921</span>-create-message.js</span><br></pre></td></tr></table></figure>

<p>那么执行 <code>undo</code> 后就会把最近的一次迁移，也就是 <code>*-message.js</code> 从表中移除，并且在数据库中删除 <code>message</code> 表。而这个删除操作，其实是执行了迁移文件下对应表的删除代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">down: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.dropTable(<span class="string">&#x27;Messages&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="db-migrate-undo-all"><a href="#db-migrate-undo-all" class="headerlink" title="db:migrate:undo:all"></a>db:migrate:undo:all</h4><p>当执行 <code>./node_modules/.bin/sequelize db:migrate:undo:all</code> 命令后，能帮我们撤销所有的迁移操作。</p>
<h4 id="db-migrate-undo-–name"><a href="#db-migrate-undo-–name" class="headerlink" title="db:migrate:undo: –name"></a>db:migrate:undo: –name</h4><p>此命令能帮我们撤销具体指定的迁移脚本，例如执行下面命令会撤销名称为 <code>20190316035632-create-user</code> 的脚本操作：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./node_modules/.bin/sequelize db:migrate:undo --name 20190316035632-create-user</span><br></pre></td></tr></table></figure>



<p>执行完毕后再来刷新我们的数据库，就会发现 <code>user</code> 表已被删除，只留下了 <code>message</code> 表。</p>
<h3 id="字段添加与删除"><a href="#字段添加与删除" class="headerlink" title="字段添加与删除"></a>字段添加与删除</h3><p>随着业务的增长，我们很有可能需要扩充数据表的字段。例如我们需要给 <code>user</code> 表添加一个 <code>username</code> 字段，那么我们就可以键入以下命令来创建一个 <code>migration</code> :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./node_modules/.bin/sequelize migration:create --name UserAddAge</span><br></pre></td></tr></table></figure>

<p>执行完上述操作后我们能在 <code>migrations</code> 文件夹中看到新创建的 <code>UserAddAge</code> 文件，打开后代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  up: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      Add altering commands here.</span></span><br><span class="line"><span class="comment">      Return a promise to correctly handle asynchronicity.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      Example:</span></span><br><span class="line"><span class="comment">      return queryInterface.createTable(&#x27;users&#x27;, &#123; id: Sequelize.INTEGER &#125;);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  down: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      Add reverting commands here.</span></span><br><span class="line"><span class="comment">      Return a promise to correctly handle asynchronicity.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      Example:</span></span><br><span class="line"><span class="comment">      return queryInterface.dropTable(&#x27;users&#x27;);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>我们要做的，就是在 <code>up</code> 和 <code>down</code> 方法中填入数据库操作逻辑的代码，<code>up</code> 方法中有注释作提示，让我们返回一个类型为 <code>Promise</code> 的对象，还给出了示例。因为我们要给数据表添加字段，所以使用 <code>addColumn</code> 方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> queryInterface.addColumn(</span><br><span class="line">    <span class="string">&#x27;users&#x27;</span>,                        <span class="comment">// 被添加字段的表名称</span></span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>,                          <span class="comment">// 需要添加的字段名称</span></span><br><span class="line">    &#123;</span><br><span class="line">        type: Sequelize.TINYINT,</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        defaultValue: <span class="number">0</span>,</span><br><span class="line">    &#125;,                              <span class="comment">// 字段属性</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>这样我们就可以给 <code>user</code> 表添加上 <code>age</code> 字段了。</p>
<p>p.s. 之所以代码中填写 <code>users</code> ，是因为 <code>sequelize-cli</code> 帮我们创建表是会自动给表名称加 <code>s</code> 。</p>
<hr>
<p>能添加就能删除，删除操作我们在 <code>down</code> 方法中编写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> queryInterface.removeColumn(</span><br><span class="line">    <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><code>UserAddAge.js</code> 文件完整代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  up: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      Add altering commands here.</span></span><br><span class="line"><span class="comment">      Return a promise to correctly handle asynchronicity.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      Example:</span></span><br><span class="line"><span class="comment">      return queryInterface.createTable(&#x27;users&#x27;, &#123; id: Sequelize.INTEGER &#125;);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">return</span> queryInterface.addColumn(</span><br><span class="line">      <span class="string">&#x27;users&#x27;</span>, </span><br><span class="line">      <span class="string">&#x27;age&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        type: Sequelize.TINYINT,</span><br><span class="line">        allowNull: <span class="literal">false</span>,</span><br><span class="line">        defaultValue: <span class="number">0</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  down: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      Add reverting commands here.</span></span><br><span class="line"><span class="comment">      Return a promise to correctly handle asynchronicity.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      Example:</span></span><br><span class="line"><span class="comment">      return queryInterface.dropTable(&#x27;users&#x27;);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">return</span> queryInterface.removeColumn(</span><br><span class="line">      <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;age&#x27;</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>编写完毕后我们运行 <code>./node_modules/.bin/sequelize db:migrate</code> 来重新执行一遍所有迁移，刷新 <code>user</code> 表后就能看见新增字段 <code>age</code> 了。</p>
<p>最后你还可以执行 <code>./node_modules/.bin/sequelize db:migrate:undo</code> 来确认 <code>down</code> 方法正常工作，从而让 <code>user</code> 表删除刚刚添加的 <code>age</code> 字段。</p>
<p>文档参考：<a href="http://docs.sequelizejs.com/class/lib/query-interface.js~QueryInterface.html">更多 QueryInterface 操作</a></p>
<h2 id="seeders"><a href="#seeders" class="headerlink" title="seeders"></a>seeders</h2><p>除了数据库结构的添加修改删除操作以外，我们通常还会给各种表批量添加一些假数据。这个时候就要用到 seeders 里的种子文件了。比方说现在要给 <code>user</code> 表批量添加一些数据，则可以执行下面代码：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./node_modules/.bin/sequelize seed:create --name userTest</span><br></pre></td></tr></table></figure>



<p>执行完毕后你会发现在 <code>seeders</code> 文件夹下多了一个类似 <code>20190316090425-userTest.js</code> 的文件。</p>
<h3 id="批量添加"><a href="#批量添加" class="headerlink" title="批量添加"></a>批量添加</h3><p>我们可以在里面编写代码让 <code>cli</code> 帮助我们批量添加数据：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  up: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      Add altering commands here.</span></span><br><span class="line"><span class="comment">      Return a promise to correctly handle asynchronicity.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      Example:</span></span><br><span class="line"><span class="comment">      return queryInterface.bulkInsert(&#x27;People&#x27;, [&#123;</span></span><br><span class="line"><span class="comment">        name: &#x27;John Doe&#x27;,</span></span><br><span class="line"><span class="comment">        isBetaMember: false</span></span><br><span class="line"><span class="comment">      &#125;], &#123;&#125;);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">      <span class="keyword">return</span> queryInterface.bulkInsert(<span class="string">&#x27;users&#x27;</span>, [</span><br><span class="line">        &#123;</span><br><span class="line">          username: <span class="string">&#x27;狄仁杰&#x27;</span>,</span><br><span class="line">          age: <span class="number">56</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          username: <span class="string">&#x27;李元芳&#x27;</span>,</span><br><span class="line">          age: <span class="number">27</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  down: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      Add reverting commands here.</span></span><br><span class="line"><span class="comment">      Return a promise to correctly handle asynchronicity.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      Example:</span></span><br><span class="line"><span class="comment">      return queryInterface.bulkDelete(&#x27;People&#x27;, null, &#123;&#125;);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">return</span> queryInterface.bulkDelete(<span class="string">&#x27;users&#x27;</span>, <span class="literal">null</span>, &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>种子文件的执行方式有两种：</p>
<ul>
<li><code>db:seed 种子文件名</code> 来运行指定种子文件</li>
<li><code>db:seed:all</code> 来运行所有种子文件</li>
</ul>
<p>知道执行方法后我们来运行下面命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./node_modules/.bin/sequelize db:seed:all</span><br></pre></td></tr></table></figure>

<p>执行成功后刷新我们的 <code>user</code> 表，就会发现数据已经被批量添加进去了。</p>
<h3 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h3><p>命令行输入并执行： <code>./node_modules/.bin/sequelize db:seed:undo:all</code> 便可以批量删除刚刚添加进 <code>user</code> 表中的数据。</p>
<h3 id="记录种子数据的存储"><a href="#记录种子数据的存储" class="headerlink" title="记录种子数据的存储"></a>记录种子数据的存储</h3><p>我们知道 <code>migrations</code> 迁移是会被记录的（数据库的 <code>sequelizemeta</code> 表中），但默认情况下，种子数据的存储不会被记录下来。但官方同样提供了 <a href="http://docs.sequelizejs.com/manual/migrations.html#seed-storage">方法</a> 来记录种子数据的存储。我们可以通过在配置文件中使用 <code>seederStorage</code> 来记录存储：</p>
<h4 id="JSON记录"><a href="#JSON记录" class="headerlink" title="JSON记录"></a>JSON记录</h4><blockquote>
<p>config/config.json</p>
</blockquote>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;development&quot;: &#123;</span><br><span class="line">    ...</span><br><span class="line">    &quot;seederStorage&quot;: &quot;json&quot;, // 存储类型</span><br><span class="line">    &quot;seederStoragePath&quot;: &quot;userTestData.json&quot; // 存储路径（当前项目根目录下）</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>p.s. 上方注释在 copy 到自己项目时需要删除，否则报错。</p>
<p>接着我们执行 <code>./node_modules/.bin/sequelize db:seed:undo:all</code> 先删除数据表中数据，然后再执行 <code>./node_modules/.bin/sequelize db:seed:all</code> 重新添加一次种子数据。你就会发现项目根目录下多出来了一个叫做 <code>userTestData.json</code> 的文件，里面记录了已经执行过的种子文件名：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">&quot;20190316090425-userTest.js&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<h4 id="sequelize记录"><a href="#sequelize记录" class="headerlink" title="sequelize记录"></a>sequelize记录</h4><p>p.s. 如果你已经用上面json记录的方式记录过种子文件的存储，再想要尝试用sequelize玩一遍的话，首先得执行一遍 <code>./node_modules/.bin/sequelize db:seed:undo:all</code> 哦。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;development&quot;: &#123;</span><br><span class="line">    ...</span><br><span class="line">    &quot;seederStorage&quot;: &quot;sequelize&quot;, // 存储类型</span><br><span class="line">    &quot;seederStoragePath&quot;: &quot;userTestData.json&quot;, // 存储路径（当前项目根目录下）</span><br><span class="line">    &quot;seederStorageTableName&quot;: &quot;userTestData&quot; // 存储的表名</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>编写完上述代码后你可以执行下面命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./node_modules/.bin/sequelize db:seed:all</span><br></pre></td></tr></table></figure>

<p>执行完毕后刷新数据库，就能在数据库中发现 <code>userTestData</code> 表，里面记录了已经执行完毕的种子文件 <code>20190316090425-userTest.js</code></p>
<h2 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h2><p>安装的 sequelize 和 mysql2 的版本为：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;sequelize&quot;: &quot;^5.3.3&quot;,</span><br><span class="line">    &quot;sequelize-cli&quot;: &quot;^5.4.0&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><ul>
<li><a href="http://docs.sequelizejs.com/class/lib/query-interface.js~QueryInterface.html">QueryInterface 操作</a></li>
</ul>
]]></content>
      <categories>
        <category>后端</category>
        <category>SQL</category>
      </categories>
      <tags>
        <tag>Sequelize</tag>
      </tags>
  </entry>
  <entry>
    <title>&lt;大话数据结构&gt;笔记</title>
    <url>/posts/51696/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前对算法和数据结构没有一个系统的学习，从今天开始抽空啃啃书吧。就从这本程杰老师的《大话数据结构》起步。</p>
<p>p.s. 原笔记是存放在幕布上的，文字版看着不舒服可以 <a href="https://mubu.com/doc/bnO4e_64Ti">点击这里</a> 看思维导图版。</p>
<a id="more"></a>

<ul>
<li><p>数据结构绪论</p>
<ul>
<li>基本概念和术语<ul>
<li>数据<ul>
<li>定义：是描述客观事物的符号，是计算机中可以操作的对象，是能被计算机识别，并输入给计算机处理的集合符号。</li>
<li>总结：数据即符号，必备条件：<ul>
<li>可以输入到计算机中</li>
<li>能被计算机程序处理</li>
</ul>
</li>
<li>举例：<ul>
<li>MP3是声音数据</li>
<li>图片是图像数据</li>
</ul>
</li>
<li>#数据对象<ul>
<li>定义：是性质相同的数据元素的集合，是数据的子集</li>
<li>举例：<ul>
<li>人（都有姓名、生日等相同的数据项）</li>
</ul>
</li>
<li>#数据元素<ul>
<li>定义：是组成数据的、有一定意义的基本单位，在计算机中通常作为整体处理。也被成为记录。</li>
<li>举例：<ul>
<li>人类中的人</li>
<li>畜类中的牛马羊</li>
</ul>
</li>
<li>#数据项<ul>
<li>定义：一个数据元素可以由若干个数据项组成</li>
<li>举例：<ul>
<li>人的姓名、年龄、性别</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>数据结构<ul>
<li>定义：是相互之间存在一种或多种特定关系的数据元素的集合</li>
<li>#逻辑结构<ul>
<li>定义：指数据对象中数据元素之间的相互关系</li>
<li>类型<ul>
<li>#集合结构<ul>
<li>同属于一个集合的数据元素<ul>
<li><img src="/posts/51696/e754fe1c-d4ec-4359-bb69-876f4ef61bc9-3051986.jpg" class="" title="e754fe1c-d4ec-4359-bb69-876f4ef61bc9-3051986"></li>
</ul>
</li>
</ul>
</li>
<li>#线性结构<ul>
<li>数据元素之间是一对一的关系<ul>
<li><img src="/posts/51696/5a4b6a6e-dff2-4608-96bc-77a924fac8fa-3051986.jpg" class="" title="5a4b6a6e-dff2-4608-96bc-77a924fac8fa-3051986"></li>
</ul>
</li>
</ul>
</li>
<li>#树形结构<ul>
<li>数据元素之间存在一对多的层次关系<ul>
<li><img src="/posts/51696/7f8cad6a-31f2-40e8-9193-47d0e8a52b41-3051986.jpg" class="" title="7f8cad6a-31f2-40e8-9193-47d0e8a52b41-3051986"></li>
</ul>
</li>
</ul>
</li>
<li>#图形结构<ul>
<li>数据元素是多对多的关系<ul>
<li><img src="/posts/51696/c0f99e81-3222-4fe4-8575-04e5e924cd49-3051986.jpg" class="" title="c0f99e81-3222-4fe4-8575-04e5e924cd49-3051986"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>用示意图表示数据逻辑结构时的注意点：<ul>
<li>每个数据元素是一个结点，用圆圈表示</li>
<li>元素之间的逻辑关系用连线表示，如果此关系是有方向的，那么用箭头连线表示</li>
</ul>
</li>
</ul>
</li>
<li>#物理结构<ul>
<li>定义：是指数据的逻辑结构在计算机中的存储形式</li>
<li>#顺序存储结构<ul>
<li>定义：是把数据元素存放在地址连续的存储单元里，其数据间的逻辑关系和物理关系是一致的<ul>
<li><img src="/posts/51696/b9a920bc-1728-4c8c-b0dd-c4b34c11e9e4-3051986.jpg" class="" title="b9a920bc-1728-4c8c-b0dd-c4b34c11e9e4-3051986"></li>
</ul>
</li>
</ul>
</li>
<li>#链式存储结构<ul>
<li>定义：是把数据元素存放在任意的存储单元里，这组存储单元可以使连续的，也可以是不连续的。<ul>
<li><img src="/posts/51696/0987f1e7-fdea-4404-bce6-c377ed05532d-3051986.jpg" class="" title="0987f1e7-fdea-4404-bce6-c377ed05532d-3051986"></li>
</ul>
</li>
<li>注意：数据元素的存储关系并不能反映其逻辑关系，因此需要用一个指针存放数据元素的地址，这样通过地址就可以找到相关联数据元素的位置</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>算法</p>
<ul>
<li>基本特性：输入、输出、有穷性、确定性和可行性</li>
<li>设计要求：正确性、可读性、健壮性、高效和低存储量</li>
<li>度量方法：事后统计（不科学、不准确）、事前分析估算 ✅</li>
<li>时间复杂度<ul>
<li>概念<ul>
<li>计算公式：T(n) = O(f(n))<ul>
<li>T(n)： 语句总的执行次数</li>
<li>n： 问题规模</li>
<li>f(n)： 问题规模 n 的某个函数</li>
</ul>
</li>
<li>表示随问题规模 n 的增大，算法执行时间的增长率和 f(n) 的增长率相同</li>
</ul>
</li>
<li>大O记法<ul>
<li>定义：用大写O()来体现时间复杂度，简称为大O记法</li>
<li>推导大O阶方法：<ul>
<li>\1. 用常数 1 取代运行时间中的所有加法常数</li>
<li>\2. 在修改后的运行次数函数中，只保留最高阶项</li>
<li>\3. 如果最高阶项存在且不是 1，则去除与这个项相乘的常数</li>
<li>\4. 得到的结果就是大 O 阶</li>
</ul>
</li>
</ul>
</li>
<li>常数阶<ul>
<li>举例：高斯算法<ul>
<li><img src="/posts/51696/e2affafd-97aa-4ee5-a37f-07bf1a7150d7-3051986.jpg" class="" title="e2affafd-97aa-4ee5-a37f-07bf1a7150d7-3051986"></li>
<li>此算法运行次数函数是 f(n)=3</li>
<li>推导：把常数项 3 改为 1 =&gt; 它没有最高阶 =&gt; 复杂度：O(1)</li>
</ul>
</li>
</ul>
</li>
<li>线性阶<ul>
<li><img src="/posts/51696/69be2ab0-b14f-4f40-976c-0f3ed54b2ffd-3051986.jpg" class="" title="69be2ab0-b14f-4f40-976c-0f3ed54b2ffd-3051986"></li>
<li>推导：循环体中代码需要执行 n 次 =&gt; 复杂度：O(n)</li>
</ul>
</li>
<li>对数阶<ul>
<li><img src="/posts/51696/972276a7-aeac-4f91-8337-a26f1e93dd8a-3051986.jpg" class="" title="972276a7-aeac-4f91-8337-a26f1e93dd8a-3051986"></li>
<li>推导：每次 count 乘以 2 后，就距离 n 更近一分。换句话说，有多少个 2 相乘后大于 n，则会退出循环。由 2^x=n 得到 x=log(2)n。所以此循环复杂度：O(logn)</li>
</ul>
</li>
<li>平方阶<ul>
<li>举例1<ul>
<li><img src="/posts/51696/7b6c8e16-5c79-4ef3-b066-95eace17bf19-3051986.jpg" class="" title="7b6c8e16-5c79-4ef3-b066-95eace17bf19-3051986"></li>
<li>推导：两层循环，每层循环 n 次 =&gt; 复杂度：O(n^2)</li>
<li>如果把外层 n 改为 m，则复杂度：O(m✘n)</li>
</ul>
</li>
<li>举例2<ul>
<li><img src="/posts/51696/3f60f9ca-4e93-4cf5-b69c-dbc8e189892d-3051986.jpg" class="" title="3f60f9ca-4e93-4cf5-b69c-dbc8e189892d-3051986"></li>
<li>复杂度：O(n^2)</li>
</ul>
</li>
</ul>
</li>
<li>常见时间复杂度<ul>
<li><img src="/posts/51696/f30d6524-ce51-470e-9f30-f624a72b6131-3051986.jpg" class="" title="f30d6524-ce51-470e-9f30-f624a72b6131-3051986"></li>
<li>常见时间复杂度所耗费的时间从小到大：<ul>
<li><img src="/posts/51696/621fb24b-7010-4e37-a761-0f178a4c0091-3051986.jpg" class="" title="621fb24b-7010-4e37-a761-0f178a4c0091-3051986"></li>
</ul>
</li>
<li></li>
</ul>
</li>
</ul>
</li>
<li>空间复杂度<ul>
<li>概念<ul>
<li>计算公式：S(n) = O(f(n))<ul>
<li>S(n)：计算算法所耗的存储空间</li>
<li>n： 问题规模</li>
<li>f(n)： 问题规模 n 所占存储空间的函数</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>当不用限定词地使用“复杂度”时，指的都是时间复杂度</li>
<li>心得<ul>
<li>明白算法的时间复杂度估算很重要，不要以“CPU越来越快，不用考虑算法优劣”为借口。愚公移山固然可敬，但发明炸药和推土机更加实在和聪明</li>
</ul>
</li>
</ul>
</li>
<li><p>线性表</p>
<ul>
<li>定义：零个或多个数据元素的有限序列<ul>
<li>关键点：<ul>
<li>是一个<em>有顺序</em>的序列</li>
<li>若元素存在多个，则第一个无前驱，最后一个无后继，中间部分都有且只有一个前驱和后继</li>
<li>线性表是有限的</li>
</ul>
</li>
</ul>
</li>
<li>举例：<ul>
<li>幼儿园小朋友按次序排队，各自都知道他前面人是谁，方便清点人数，知道谁不在</li>
<li>一年的星座列表</li>
</ul>
</li>
<li>顺序存储结构<ul>
<li>定义：用一段地址连续的存储单元一次存储线性表的数据元素<ul>
<li><img src="/posts/51696/0da7720c-5c75-4a5c-ad5a-1323aa7dc388-3051986.jpg" class="" title="0da7720c-5c75-4a5c-ad5a-1323aa7dc388-3051986"></li>
</ul>
</li>
<li>三个重要属性：<ul>
<li>存储空间的起始位置</li>
<li>线性表的最大存储容量</li>
<li>线性表的当前长度</li>
</ul>
</li>
<li>数据长度与线性表长度区别<ul>
<li>数据长度：（例如一个数组的长度）是存放线性表的存储空间的长度，一般不变</li>
<li>线性表长度：是线性表中数据元素的个数，随着插入与删除，这个量是可变的</li>
<li>在任意时刻，线性表长度应该 小于等于 数据长度</li>
</ul>
</li>
<li>时间复杂度：<ul>
<li>插入或删除最后一个元素为 O(1)</li>
<li>插入或删除第一个元素为O(n)</li>
</ul>
</li>
<li>优缺点<ul>
<li>优点：<ul>
<li>无需为了表示表中元素之间的逻辑关系而增加额外的存储空间</li>
<li>可以快速地存取表中任意位置的元素</li>
</ul>
</li>
<li>缺点：<ul>
<li>插入和删除操作需要移动大量元素</li>
<li>当线性表长度变化较大时，难以确定存储空间的容量</li>
<li>造成存储空间的“碎片”</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>链式存储结构<ul>
<li>定义：是把数据元素存放在任意的存储单元里，这组存储单元可以使连续的，也可以是不连续的。<ul>
<li><img src="/posts/51696/90e595e5-f1a5-4c67-a6e3-d27a59d629b6-3051986.jpg" class="" title="90e595e5-f1a5-4c67-a6e3-d27a59d629b6-3051986"></li>
</ul>
</li>
<li>与顺序结构不同，在链式结构中，除了要存储数据信息外，还要存储它后继元素的存储地址</li>
<li>单链表<ul>
<li>定义：一个链式结构的，每个结点中只包含一个指针域的链表叫做单链表<ul>
<li><img src="/posts/51696/43f9bf59-0141-4902-80b2-1ee623ce6bc9-3051986.jpg" class="" title="43f9bf59-0141-4902-80b2-1ee623ce6bc9-3051986"></li>
</ul>
</li>
<li>单链表结构与顺序存储结构的优缺点<ul>
<li>对比：<ul>
<li>存储分配方式：<ul>
<li>顺序存储结构用一段连续的存储单元依次存储线性表的数据元素</li>
<li>单链表采用链式存储结构，用一组任意的存储单元存放线性表的元素</li>
</ul>
</li>
<li>时间性能：<ul>
<li>查找：<ul>
<li>顺序存储结构 O(1)</li>
<li>单链表 O(n)</li>
</ul>
</li>
<li>插入与删除：<ul>
<li>顺序存储结构需要移动表长一半的元素，时间为 O(n)</li>
<li>单链表在找出某位置的指针后，插入和删除时间仅为 O(1)</li>
</ul>
</li>
<li>空间性能：<ul>
<li>顺序存储结构需要预分配存储空间，分大了浪费，分小了容易溢出</li>
<li>单链表不需要分配存储空间，只要有就可以分配，元素个数也不受限制</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>结论：<ul>
<li>若线性表需要频繁查找，很少进行插入和删除操作，宜采用顺序存储结构</li>
<li>若需要频繁插入和删除，宜采用单链表结构</li>
<li>当线性表中的元素个数变化较大或根本不知道多大时，宜采用单链表结构，这样不用考虑存储空间的大小问题。</li>
<li>若事先知道大致长度，比如一年12个月，一周7天，宜采用顺序存储结构</li>
</ul>
</li>
<li>实际应用：<ul>
<li>用户注册的个人信息，除了注册时插入数据外，绝大多数情况都是读取，所以宜采用顺序存储结构</li>
<li>游戏中玩家的武器装备列表，随着游戏推进，玩家可能随时增加或删除，所以宜采用单链表结构</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>静态链表<ul>
<li>背景：有些编程高级语言（e.g. Basic, Fortran）没有指针，这样链表结构就没法实现。</li>
<li>解决方案：用数组来代替指针，来描述单链表</li>
<li>实现：让数组元素都由两个数据域组成，data和cur。data用来存储数据元素，cur（游标）相当于单链表中的next指针，存放该元素的后继在数组中的下标。</li>
<li>定义：这种用数组描述的链表叫做静态链表。这种描述方法起名为游标实现法。<ul>
<li><img src="/posts/51696/bcbf36b2-6c2b-49a8-a3bc-08ecb8935a01-3051986.jpg" class="" title="bcbf36b2-6c2b-49a8-a3bc-08ecb8935a01-3051986"></li>
</ul>
</li>
<li>举例：<ul>
<li>将 “甲乙丙丁戊己庚”存入静态链表：<ul>
<li><img src="/posts/51696/60412d31-4595-4bee-a252-ccdcac7e333a-3051986.jpg" class="" title="60412d31-4595-4bee-a252-ccdcac7e333a-3051986"></li>
</ul>
</li>
<li>优缺点：<ul>
<li>优点：<ul>
<li>再插入和删除操作时，只需要修改游标，不需要移动元素，从而改进了在顺序存储结构中的插入和删除操作需要移动大量元素的缺点。</li>
</ul>
</li>
<li>缺点：<ul>
<li>没有解决连续存储分配带来的表长难以确定的问题</li>
<li>失去了顺序存储结构随机存储的特性</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>循环链表<ul>
<li>定义：将单链表中终端节点的指针端由空指针改为指向头结点，就使整个单链表形成一个环，这种头尾相接的单链表称为单循环链表，简称循环链表。</li>
</ul>
</li>
<li>双向链表<ul>
<li>定义：双向链表是在单链表的每个结点中，再设置一个指向其前驱结点的指针域。所以在双向链表中的结点都有两个指针域，一个指向直接后继，另一个指向直接前驱。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>栈与队列</p>
<ul>
<li><p>栈</p>
<ul>
<li>定义：栈是限定仅在表尾进行插入和删除操作的线性表</li>
<li>描述：我们把允许插入和删除的一端称为栈顶，另一端称为栈底，不含任何数据元素的栈称为空栈。栈又称为后进先出（Last In First Out）的线性表，简称 LIFO 结构。</li>
<li>举例：浏览器的前进后退，Photoshop 的前进撤销。</li>
<li>栈的顺序存储结构<ul>
<li>操作：<ul>
<li>栈的插入操作（push 压），叫作进栈，也称压栈、入栈。类似子弹入弹夹。<ul>
<li><img src="/posts/51696/8f921c05-7deb-4104-96cb-f293de081246-3051986.jpg" class="" title="8f921c05-7deb-4104-96cb-f293de081246-3051986"></li>
</ul>
</li>
<li>栈的删除操作（pop 弹），叫作出栈，也称弹栈。类似子弹出夹。<ul>
<li><img src="/posts/51696/6e22676a-6c14-446d-b330-2c459da99634-3051986.jpg" class="" title="6e22676a-6c14-446d-b330-2c459da99634-3051986"></li>
</ul>
</li>
</ul>
</li>
<li>两栈共享空间<ul>
<li>理解：两个相同类型的栈，为它们各自开辟了数组空间，极有可能第一个栈满，再进栈就溢出了，而另一个栈还有很多存储空间空闲。所以我们完全可以用一个数组来存储两个栈。<ul>
<li><img src="/posts/51696/55e0d735-25b7-4c18-8a8f-624eaa16cd8d-3051986.jpg" class="" title="55e0d735-25b7-4c18-8a8f-624eaa16cd8d-3051986"></li>
</ul>
</li>
<li>做法：数组的两个端点，让一个栈的栈底为数组的始端（下标0），另一个栈为栈的末端（n-1）。两栈如果增加元素，就是两端向中间延伸。</li>
<li>关键思路：<ul>
<li>\1. 两个top是数组两端的栈顶指针，只要它俩不见面，两个栈就都可以一直使用。</li>
<li>\2. 栈1为空时，就是top1等于-1时；当top2等于n时，即是栈2为空时。</li>
<li>\3. 何时栈满：top1等于n-1时栈1满；top2等于0时，栈2满，所以推导出，top1+1==top2为栈满</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>栈的链式存储结构<ul>
<li>栈顶存放位置：<ul>
<li>由于单链表有头指针，而栈顶指针也是必须的，所以把它俩合二为一，将栈顶放在单链表的头部。</li>
</ul>
</li>
<li>不需要头结点：<ul>
<li>都已经有了栈顶在头部，所以单链表的头结点也失去了意义，所以不需要头结点。</li>
</ul>
</li>
<li>示意图：<ul>
<li><img src="/posts/51696/aa59ece6-46d3-42de-8ccf-302713f41f0a-3051986.jpg" class="" title="aa59ece6-46d3-42de-8ccf-302713f41f0a-3051986"></li>
</ul>
</li>
</ul>
</li>
<li>栈的应用<ul>
<li>#递归</li>
<li>#四则运算表达式求值</li>
</ul>
</li>
</ul>
</li>
<li><p>队列</p>
<ul>
<li><p>定义：队列是只允许在一端进行插入操作、而在另一端进行删除操作的线性表</p>
</li>
<li><p>描述：队列是一种先进先出（First In First Out）的线性表，简称 FIFO。允许插入的一端称为队尾，允许删除的一端称为队头。</p>
</li>
<li><p>举例：键盘的输入，记事本上的输出。</p>
</li>
<li><p>队列的顺序存储结构</p>
<ul>
<li><p>缺点：</p>
<ul>
<li><p>由于从队头出，导致后面元素都得向前移动，时间复杂度 O(n)</p>
<img src="/posts/51696/ce01c75c-c53a-49c7-b4b4-0e2fb3e4bfa6-3051986.jpg" class="" title="ce01c75c-c53a-49c7-b4b4-0e2fb3e4bfa6-3051986">
</li>
</ul>
</li>
<li><p>解决：</p>
<ul>
<li>循环队列<ul>
<li>让头尾相接</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>队列的链式存储结构</p>
</li>
<li><p>顺序存储和链式存储的选择</p>
<ul>
<li>可以确定队列长度最大值时，建议循环队列</li>
<li>无法预估队列长度时，使用链队列</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>串</p>
<ul>
<li>定义：是由零个或多个字符组成的有限序列，又名字符串</li>
<li>算法<ul>
<li>朴素的模式匹配算法<ul>
<li>从头开始依次往后比较【不推荐】</li>
</ul>
</li>
<li>KMP模式匹配算法</li>
</ul>
</li>
</ul>
</li>
<li><p>数</p>
<ul>
<li><p>定义：</p>
<ul>
<li>树是 n(n&gt;=0) 个结点的有限集。n=0 时称为空树。在任意一棵非空树中：<ul>
<li>\1. 有且仅有一个特定的称为根（Root）的结点</li>
<li>\2. 当 n &gt; 1 时，其余结点可分为 m(m &gt; 0) 个互不相交的有限集 T1、T2 … 、Tm，其中每一个集合本身又是一棵树，并且称为根的子树（SubTree）</li>
</ul>
</li>
<li><img src="/posts/51696/aea04c1e-15b7-4692-8504-7d049e7ea05e-3051986.jpg" class="" title="aea04c1e-15b7-4692-8504-7d049e7ea05e-3051986">
</li>
</ul>
</li>
<li><p>结点分类</p>
<ul>
<li>定义：结点拥有的子树数称为结点的度。度为 0 的结点称为叶结点或终端结点；度不为 0 的结点称为非终端结点或分支结点。除根结点外，分支结点也称为内部结点。树的度是树内各结点的度的最大值。下面树结点的度的最大值是结点 D 的度，为 3，所以树的度也为 3 。<ul>
<li><img src="/posts/51696/e31ad7c9-0003-435a-bf98-3c7c03764720-3051986.jpg" class="" title="e31ad7c9-0003-435a-bf98-3c7c03764720-3051986">
</li>
</ul>
</li>
</ul>
</li>
<li><p>结点间关系</p>
<ul>
<li><img src="/posts/51696/63d4fff0-5e45-428e-a32c-14b972b93e2b-3051986.jpg" class="" title="63d4fff0-5e45-428e-a32c-14b972b93e2b-3051986">
</li>
</ul>
</li>
<li><p>树的其他相关概念</p>
<ul>
<li><p>结点的层次</p>
<ul>
<li><p>从根开始定义起，根为第一层。</p>
<ul>
<li><p>树中结点的最大层次称为树的深度或高度，下图树深度为 4</p>
<img src="/posts/51696/5fd0623d-6956-447b-9125-48a3eaf0a977-3051986.jpg" class="" title="5fd0623d-6956-447b-9125-48a3eaf0a977-3051986">
</li>
</ul>
</li>
</ul>
</li>
<li><p>树与线性表结构的对比</p>
<ul>
<li><img src="/posts/51696/a277b277-b5ef-4306-b89b-477e49fa9bf7-3051986.jpg" class="" title="a277b277-b5ef-4306-b89b-477e49fa9bf7-3051986">
</li>
</ul>
</li>
<li><p>阿萨德</p>
</li>
</ul>
</li>
<li><p>二叉树</p>
<ul>
<li><p>定义：二叉树是 n(n&gt;=0)个结点的有限集合，该集合或为空集（称为空二叉树），或由一个根节点和两棵互不相交的、分别称为根节点的左子树和右子树的二叉树组成。</p>
<ul>
<li><img src="/posts/51696/1d2f3500-70e1-4aed-adbb-4007c27125af-3051986.jpg" class="" title="1d2f3500-70e1-4aed-adbb-4007c27125af-3051986">
</li>
</ul>
</li>
<li><p>特点：</p>
<ul>
<li>每个结点最多有两棵子树</li>
<li>左子树和右子树是有顺序的，次序不能任意颠倒</li>
<li>即使树中某结点只有一棵树，也要区分左右子树</li>
</ul>
</li>
<li><p>特殊二叉树</p>
<ul>
<li><p>#斜树</p>
<ul>
<li>定义：<ul>
<li>所有结点都在左子树的二叉树叫左斜树<ul>
<li><img src="/posts/51696/34668592-d9a6-4e01-b13c-1eec6b8fca42-3051986.jpg" class="" title="34668592-d9a6-4e01-b13c-1eec6b8fca42-3051986"></li>
</ul>
</li>
<li>所有结点都在右子树的二叉树叫右斜树<ul>
<li><img src="/posts/51696/3e52b0f5-6d81-43bd-8e35-33b203ccd3af-3051986.jpg" class="" title="3e52b0f5-6d81-43bd-8e35-33b203ccd3af-3051986"></li>
</ul>
</li>
</ul>
</li>
<li>这种特殊树和线性表结构一样，所以线性表结构可以理解为是树的一种特殊形式</li>
</ul>
</li>
<li><p>#满二叉树</p>
<ul>
<li><img src="/posts/51696/e13bdddf-2d7b-4f94-b17f-b539f7200efa-3051986.jpg" class="" title="e13bdddf-2d7b-4f94-b17f-b539f7200efa-3051986">
</li>
</ul>
</li>
<li><p>#完全二叉树</p>
<ul>
<li><p>定义：对一棵具有 n 个结点的二叉树按层序编号，如果编号为 i (i &lt;= i &lt;= n) 的结点与同样深度的满二叉树中编号为 i 的结点在二叉树中的位置完全相同，则这课二叉树称为完全二叉树。</p>
<ul>
<li><img src="/posts/51696/d0842d6b-122e-48c2-91f1-9ce55d73028e-3051986.jpg" class="" title="d0842d6b-122e-48c2-91f1-9ce55d73028e-3051986">
</li>
</ul>
</li>
<li><p>如何判定：在看树时，心中默默给每个结点按照满<em>二叉树</em>的结构<em>逐层顺序</em>编号，如果编号出现空挡，就说明不是完全二叉树，否则就是。</p>
<ul>
<li><p>下面几个都不是：</p>
<ul>
<li><p>9跟11之间有空挡</p>
<img src="/posts/51696/d055bd00-8c52-4da4-983e-baf9c1d65abe-3051986.jpg" class="" title="d055bd00-8c52-4da4-983e-baf9c1d65abe-3051986">
</li>
<li><p>5跟8，9之间有空挡</p>
<img src="/posts/51696/821f0e91-4700-495e-a657-a372965a7027-3051986.jpg" class="" title="821f0e91-4700-495e-a657-a372965a7027-3051986">
</li>
<li><p>9跟12之间有空挡</p>
<img src="/posts/51696/130be6af-5ac2-403e-a196-60a3534664eb-3051986.jpg" class="" title="130be6af-5ac2-403e-a196-60a3534664eb-3051986">
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>存储结构</p>
<ul>
<li>二叉树顺序存储结构（适用于完全二叉树）</li>
<li>二叉链表</li>
</ul>
</li>
<li><p>遍历二叉树</p>
<ul>
<li><p>#二叉树遍历方法</p>
<ul>
<li><p>前序遍历</p>
<ul>
<li><p>遍历顺序：ABDGHCEIF</p>
<img src="/posts/51696/bcef9e8a-1e6a-4f9e-97ac-d0aa5d29d6ce-3051986.jpg" class="" title="bcef9e8a-1e6a-4f9e-97ac-d0aa5d29d6ce-3051986">
</li>
</ul>
</li>
<li><p>中序遍历</p>
<ul>
<li><p>遍历顺序：GDHBAEICF</p>
<img src="/posts/51696/53c8f72e-58fb-4c13-8ee6-110c000a497c-3051986.jpg" class="" title="53c8f72e-58fb-4c13-8ee6-110c000a497c-3051986">
</li>
</ul>
</li>
<li><p>后序遍历</p>
<ul>
<li><p>遍历顺序：GHDBIEFCA</p>
<img src="/posts/51696/76154ad4-d5f9-4db5-a8f7-06c0e36b29de-3051986.jpg" class="" title="76154ad4-d5f9-4db5-a8f7-06c0e36b29de-3051986">
</li>
</ul>
</li>
<li><p>层序遍历</p>
<ul>
<li><p>遍历顺序：ABCDEFGHI</p>
<img src="/posts/51696/ca020d5e-541d-47d2-b72f-fdaf25b5fba1-3051986.jpg" class="" title="ca020d5e-541d-47d2-b72f-fdaf25b5fba1-3051986">
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>图</p>
</li>
</ul>
]]></content>
      <categories>
        <category>后端</category>
        <category>算法</category>
      </categories>
  </entry>
  <entry>
    <title>如何使用webpack4</title>
    <url>/posts/47462/</url>
    <content><![CDATA[<h2 id="为什么要使用-webpack"><a href="#为什么要使用-webpack" class="headerlink" title="为什么要使用 webpack"></a>为什么要使用 webpack</h2><h3 id="网页中引用的常见静态资源"><a href="#网页中引用的常见静态资源" class="headerlink" title="网页中引用的常见静态资源"></a>网页中引用的常见静态资源</h3><table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">静态资源</th>
</tr>
</thead>
<tbody><tr>
<td align="left">JS</td>
<td align="left">.js .jsx .coffee .ts（TypeScript 类 C# 语言）</td>
</tr>
<tr>
<td align="left">CSS</td>
<td align="left">.css .less .sass .scss</td>
</tr>
<tr>
<td align="left">Images</td>
<td align="left">.jpg .png .gif .bmp .svg</td>
</tr>
<tr>
<td align="left">字体文件（Fonts）</td>
<td align="left">.svg .ttf .eot .woff .woff2</td>
</tr>
<tr>
<td align="left">模板文件</td>
<td align="left">.ejs .jade .vue【这是在webpack中定义组件的方式，推荐这么用】</td>
</tr>
</tbody></table>
<a id="more"></a>

<h3 id="引入过多静态资源有什么问题？"><a href="#引入过多静态资源有什么问题？" class="headerlink" title="引入过多静态资源有什么问题？"></a>引入过多静态资源有什么问题？</h3><ol>
<li>网页加载速度慢， 因此我们要发起很多的二次请求</li>
<li>还要处理错综复杂的依赖关系</li>
</ol>
<h3 id="如何解决上述两个问题"><a href="#如何解决上述两个问题" class="headerlink" title="如何解决上述两个问题"></a>如何解决上述两个问题</h3><ol>
<li>合并、压缩、精灵图、图片的 Base64 编码</li>
<li>可以使用 requireJS、也可以使用 webpack 来解决各个包之间的复杂依赖关系</li>
</ol>
<h3 id="如何完美实现上述的2种解决方案"><a href="#如何完美实现上述的2种解决方案" class="headerlink" title="如何完美实现上述的2种解决方案"></a>如何完美实现上述的2种解决方案</h3><ol>
<li>使用 Gulp， 基于 task 任务</li>
<li>使用 webpack， 基于整个项目进行构建<ul>
<li>借助于 webpack 这个前端自动化构建工具，可以完美实现资源的合并、打包、压缩、混淆等诸多功能</li>
</ul>
</li>
</ol>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>webpack 是基于 Node.js 开发出来的一个前端项目打包工具。</p>
<h2 id="安装-amp-初步使用"><a href="#安装-amp-初步使用" class="headerlink" title="安装 &amp; 初步使用"></a>安装 &amp; 初步使用</h2><ol>
<li><p>如果第一次安装，需要全局安装 『 webpack &amp;&amp; webpack-cli 』:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -g webpack webpack-cli</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化项目</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建文件夹</span></span><br><span class="line">mkdir webpack4-demo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入</span></span><br><span class="line">cd webpack4-demo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 初始化</span></span><br><span class="line">npm init -y</span><br></pre></td></tr></table></figure>
</li>
<li><p>以下面的目录结构创建文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">├── package.json</span><br><span class="line">└── src</span><br><span class="line">    ├── css</span><br><span class="line">    │   └── index.css</span><br><span class="line">    ├── images</span><br><span class="line">    │   └── temp.png</span><br><span class="line">    ├── index.html</span><br><span class="line">    ├── js</span><br><span class="line">    │   ├── a.js</span><br><span class="line">    │   ├── b.js</span><br><span class="line">    │   └── index.js</span><br><span class="line">    └── main.js</span><br></pre></td></tr></table></figure>

<blockquote>
<p>index.css</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">   <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">2px</span> <span class="built_in">rgba</span>(<span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">0.05</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>index.html</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">li</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>js/a.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> b <span class="keyword">from</span> <span class="string">&#x27;./b&#x27;</span></span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&#x27;jquery&#x27;</span></span><br><span class="line"><span class="keyword">const</span> a = &#123;</span><br><span class="line">   <span class="function"><span class="title">init</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;我是 a 模块，现在被初始化了&quot;</span>)</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="function"><span class="title">binit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      b.init()</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> a</span><br></pre></td></tr></table></figure>

<blockquote>
<p>js/b.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> b = &#123;</span><br><span class="line">   <span class="function"><span class="title">init</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;我是 b 模块，现在被初始化了&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> b</span><br></pre></td></tr></table></figure>

<blockquote>
<p>js/index.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&#x27;jquery&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> index = &#123;</span><br><span class="line">   <span class="comment">// init后执行隔行变色的代码</span></span><br><span class="line">   <span class="function"><span class="title">init</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 设置偶数行背景色，索引从0开始，0是偶数</span></span><br><span class="line">      $(<span class="string">&#x27;#list li:even&#x27;</span>).css(<span class="string">&#x27;backgroundColor&#x27;</span>, <span class="string">&#x27;lightblue&#x27;</span>)</span><br><span class="line">      <span class="comment">// 设置奇数行背景色</span></span><br><span class="line">      $(<span class="string">&#x27;#list li:odd&#x27;</span>).css(<span class="string">&#x27;backgroundColor&#x27;</span>, <span class="string">&#x27;pink&#x27;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> index</span><br></pre></td></tr></table></figure>

<blockquote>
<p>main.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> a <span class="keyword">from</span> <span class="string">&#x27;./js/a&#x27;</span></span><br><span class="line"><span class="keyword">import</span> b <span class="keyword">from</span> <span class="string">&#x27;./js/b&#x27;</span></span><br><span class="line"><span class="keyword">import</span> index <span class="keyword">from</span> <span class="string">&#x27;./js/index&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./css/index.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> main = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&#x27;入口函数 main 被调用了&#x27;</span>)</span><br><span class="line">   a.init()</span><br><span class="line">   a.binit()</span><br><span class="line">   b.init()</span><br><span class="line">   index.init()</span><br><span class="line">&#125;</span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
</li>
<li><p>项目根文件夹下执行命令 <code>npm i webpack webpack-cli -D</code></p>
</li>
<li><p>使用 <code>npm i jquery</code> 安装 jQuery 类库</p>
</li>
<li><p>直接在页面上引用 <code>main.js</code> 会报错，因为浏览器不认识 <code>import $ from &#39;jquery&#39;</code> 这种JS语法，需要使用 webpack 进行处理，webpack 默认会把这种高级的语法转换为低级的浏览器能识别的语法：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">li</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 直接引入会报错 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>运行 <code>webpack 入口文件路径 模式</code> 运行 <code>main.js</code> 入口文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">webpack src/main.js --mode development # 开发环境</span><br><span class="line">或者</span><br><span class="line">webpack src/main.js --mode production  # 生产环境</span><br></pre></td></tr></table></figure>
</li>
<li><p>不过每次都要输入这个命令，非常麻烦，我们可以在<code>package.json</code>的<code>scripts</code>中加入两个指令成员：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">   &quot;dev&quot;: &quot;webpack src/main.js --mode development&quot;,</span><br><span class="line">   &quot;build&quot;: &quot;webpack src/main.js --mode production&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>以后只需要在命令行执行 <code>npm run dev</code> 便相当于执行 <code>webpack --mode development</code> ，执行 <code>npm run build</code> 便相当于执行 <code>webpack --mode production</code>。</p>
</li>
</ol>
<h2 id="使用配置文件简化打包命令"><a href="#使用配置文件简化打包命令" class="headerlink" title="使用配置文件简化打包命令"></a>使用配置文件简化打包命令</h2><ol>
<li><p>在项目根目录中创建 <code>webpack.config.js</code></p>
</li>
<li><p>由于运行 webpack 命令的时候，webpack 需要指定入口文件和输出文件的路径，所以我们需要在 <code>webpack.config.js</code> 中配置这两个路径：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入处理路径的模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出一个配置对象，将来 webpack 在启动的时候，</span></span><br><span class="line"><span class="comment">// 会默认来查找 webpack.config.js ，</span></span><br><span class="line"><span class="comment">// 并读取这个文件中导出的配置对象，来进行打包处理</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   <span class="comment">// 配置入口文件，表示要使用 webpack 打包哪个文件</span></span><br><span class="line">   <span class="comment">// 若不配置 webpack 将自动查找 src 目录下的 index.js 文件</span></span><br><span class="line">   entry: &#123;</span><br><span class="line">      main: path.join(__dirname, <span class="string">&#x27;./src/main.js&#x27;</span>)</span><br><span class="line">   &#125;,</span><br><span class="line">   output: &#123;</span><br><span class="line">      filename: <span class="string">&quot;[name].bundle.[hash].js&quot;</span>, <span class="comment">//输出文件名，[name]表示入口文件js名，[hash]会在后面生成随机hash值</span></span><br><span class="line">      path: path.join(__dirname, <span class="string">&quot;./dist&quot;</span>) <span class="comment">//输出文件路径</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>由于此时已经配置了入口文件，<code>package.json</code> 中的脚本命令就可简化为：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;dev&quot;: &quot;webpack --mode development&quot;,</span><br><span class="line">&quot;build&quot;: &quot;webpack --mode production&quot;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="实现-webpack-实时打包构建"><a href="#实现-webpack-实时打包构建" class="headerlink" title="实现 webpack 实时打包构建"></a>实现 webpack 实时打包构建</h2><p>webpack 提供了一个可选的本地开发服务器，这个本地服务器基于 node.js 构建，它是一个单独的插件，叫做 <code>webpack-dev-server</code> ，在 webpack 中进行配置之前需要单独安装它作为项目依赖。</p>
<p>devServer 作为 webpack 配置选项中的一项，以下是它的一些配置选项:</p>
<ul>
<li><code>contentBase</code> ：设置服务器所读取文件的目录，当前我们设置为”./dist”</li>
<li><code>port</code> ：设置端口号，如果省略，默认为<code>8080</code></li>
<li><code>inline</code> ：设置为<code>true</code>，当源文件改变时会自动刷新页面</li>
<li><code>historyApiFallback</code> ：设置为<code>true</code>，所有的跳转将指向<code>index.html</code></li>
</ul>
<ol>
<li><p>由于每次重新修改代码之后，都需要手动运行 webpack 打包的命令，比较麻烦，所以使用 <code>webpack-dev-server</code> 来实现代码实时打包编译，当修改代码之后，会自动进行打包构建。</p>
</li>
<li><p>运行 <code>npm i webpack-dev-server -D</code> 安装到开发依赖</p>
</li>
<li><p>安装完成之后，修改之前在 <code>package.json</code> 中添加的 dev 指令：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;dev&quot;: &quot;webpack-dev-server --mode development&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行指令 <code>npm run dev</code> ，发现可以进行实时打包，但是 dist 目录下并没有生成 <code>main.bundle.js</code> 文件，这是因为 <code>webpack-dev-server</code> 将打包好的文件放在了内存中。</p>
<ul>
<li><p>把 <code>bundle.js</code> 放在内存中的好处是：由于需要实时打包编译，所以放在内存中速度会非常快</p>
</li>
<li><p>这个时候访问 webpack-dev-server 启动的 <code>http://localhost:8080/</code> 网站，发现是一个文件夹的面板，需要点击到 src 目录下，才能打开我们的 index 首页，此时引用不到 <code>main.bundle.js</code> 文件，需要修改 index.html 中 script 的 src 属性为:<code>&lt;script src=&quot;../main.bundle.js&quot;&gt;&lt;/script&gt;</code></p>
</li>
<li><p>为了能在访问 <code>http://localhost:8080/</code> 的时候直接访问到 index 首页，可以使用 <code>--contentBase src</code> 指令来修改dev指令，指定启动的根目录：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;dev&quot;: &quot;webpack-dev-server --mode development --contentBase src&quot;,</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<h2 id="插件（Plugins）"><a href="#插件（Plugins）" class="headerlink" title="插件（Plugins）"></a>插件（Plugins）</h2><p>插件（Plugins）是用来拓展 webpack 功能的，它们会在整个构建过程中生效，执行相关的任务。<br>Loaders 和 Plugins 常常被弄混，但是它们其实是完全不同的东西，可以这么来说，loaders 是在打包构建过程中用来处理源文件的（JSX，Scss，Less..），一次处理一个，插件并不直接操作单个文件，它直接对整个构建过程其作用。</p>
<h3 id="使用-html-webpack-plugin-插件配置启动页面"><a href="#使用-html-webpack-plugin-插件配置启动页面" class="headerlink" title="使用 html-webpack-plugin 插件配置启动页面"></a>使用 <code>html-webpack-plugin</code> 插件配置启动页面</h3><p>由于使用 <code>--contentBase</code> 指令的过程比较繁琐，需要指定启动的目录，同时还需要修改 index.html 中 script 标签的 src 属性，所以推荐使用 <code>html-webpack-plugin</code> 插件配置启动页面。</p>
<ol>
<li><p>运行 <code>npm i html-webpack-plugin -D</code> 安装到开发依赖</p>
</li>
<li><p>修改 <code>webpack.config.js</code> 配置文件如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入处理路径的模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="comment">// 导入自动生成HTMl文件的插件</span></span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出一个配置对象，将来 webpack 在启动的时候，</span></span><br><span class="line"><span class="comment">// 会默认来查找 webpack.config.js ，</span></span><br><span class="line"><span class="comment">// 并读取这个文件中导出的配置对象，来进行打包处理</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 配置入口文件，表示要使用 webpack 打包哪个文件</span></span><br><span class="line">    <span class="comment">// 若不配置 webpack 将自动查找 src 目录下的 index.js 文件</span></span><br><span class="line">    entry: &#123;</span><br><span class="line">        main: path.join(__dirname, <span class="string">&#x27;./src/main.js&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">&quot;[name].bundle.js&quot;</span>, <span class="comment">//输出文件名，[name]表示入口文件js名</span></span><br><span class="line">        path: path.join(__dirname, <span class="string">&quot;./dist&quot;</span>) <span class="comment">//输出文件路径</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [ <span class="comment">// 添加plugins节点配置插件</span></span><br><span class="line">        <span class="keyword">new</span> htmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.join(__dirname, <span class="string">&#x27;./src/index.html&#x27;</span>), <span class="comment">//模板路径</span></span><br><span class="line">            filename: <span class="string">&#x27;index.html&#x27;</span>, <span class="comment">//自动生成的HTML文件的名称</span></span><br><span class="line">            minify: &#123; <span class="comment">// 压缩HTML文件</span></span><br><span class="line">               removeComments: <span class="literal">true</span>, <span class="comment">// 移除HTML中的注释</span></span><br><span class="line">               collapseWhitespace: <span class="literal">true</span>, <span class="comment">// 删除空白符与换行符</span></span><br><span class="line">               minifyCSS: <span class="literal">true</span> <span class="comment">// 压缩内联css</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>撤销 <code>package.json</code> 中 <code>script</code> 节点中的 dev 指令为：<br><code>dev&quot;: &quot;webpack-dev-server --mode development&quot;</code></p>
</li>
<li><p>将 index.html 中 script 标签注释掉，因为 <code>html-webpack-plugin</code> 插件会自动把 main.bundle.js 注入到 index.html 页面中。</p>
</li>
</ol>
<h3 id="实现自动打开浏览器、热更新和配置浏览器的默认端口号"><a href="#实现自动打开浏览器、热更新和配置浏览器的默认端口号" class="headerlink" title="实现自动打开浏览器、热更新和配置浏览器的默认端口号"></a>实现自动打开浏览器、热更新和配置浏览器的默认端口号</h3><h4 id="方式1："><a href="#方式1：" class="headerlink" title="方式1："></a>方式1：</h4><p>修改 <code>package.json</code> 的 script 节点如下，其中 <code>--open</code> 表示自动打开浏览器， <code>--port 4321</code> 表示打开的端口号为 4321 ，<code>--hot</code> 表示启用浏览器热更新：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;dev&quot;: &quot;webpack-dev-server --open --port 4321 --hot  --mode development&quot;,</span><br></pre></td></tr></table></figure>

<h4 id="方式2：-个人推荐"><a href="#方式2：-个人推荐" class="headerlink" title="方式2：(个人推荐)"></a>方式2：(个人推荐)</h4><ol>
<li><p>修改 <code>webpack.config.js</code> 文件，新增 <code>devServer</code> 节点如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">     inline: <span class="literal">true</span>, <span class="comment">//打包后加入一个 websocket 客户端</span></span><br><span class="line">     hot: <span class="literal">true</span>, <span class="comment">// 启用热更新 的 第1步</span></span><br><span class="line">     open: <span class="literal">true</span>, <span class="comment">// 自动打开浏览器</span></span><br><span class="line">     contentBase: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>), <span class="comment">// 指定托管的根目录，不注释的话，无法访问 src 以外的资源，比如 node_modules</span></span><br><span class="line">     host: <span class="string">&#x27;localhost&#x27;</span>, <span class="comment">// 主机地址</span></span><br><span class="line">     port: <span class="number">4321</span>, <span class="comment">// 设置启动时候的运行端口</span></span><br><span class="line">     compress: <span class="literal">true</span> <span class="comment">// 开发服务器是否启动gzip等压缩</span></span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>在头部引入 <code>webpack</code> 模块：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 启用热更新的 第2步</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>plugins</code> 节点下新增：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 启用热更新的第 3 步</span></span><br><span class="line"><span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Loaders"><a href="#Loaders" class="headerlink" title="Loaders"></a>Loaders</h2><p>loaders 是 webpack 最强大的功能之一，通过不同的 loader ，webpack 有能力调用外部的脚本或工具，实现对不同格式的文件的处理，例如把 <code>scss</code> 转为 <code>css</code> ，将 ES6 、ES7 等语法转化为当前浏览器能识别的语法，将 JSX 转化为 js 等多项功能。</p>
<p>loaders 需要单独安装并且需要在 <code>webpack.config.js</code> 中的 <code>modules</code> 配置项下进行配置，Loaders的配置包括以下几方面：</p>
<ul>
<li><code>test</code>：一个用以匹配 loaders 所处理文件的拓展名的正则表达式（必须）</li>
<li><code>loader</code>：loader的名称（必须）</li>
<li><code>include/exclude</code>：手动添加必须处理的文件（文件夹）或屏蔽不需要处理的文件（文件夹）（可选）；</li>
<li><code>options</code>：为loaders提供额外的设置选项（可选）</li>
</ul>
<h3 id="打包-css-文件"><a href="#打包-css-文件" class="headerlink" title="打包 css 文件"></a>打包 css 文件</h3><ol>
<li><p>运行<code>npm i style-loader css-loader --D</code></p>
</li>
<li><p>修改 <code>webpack.config.js</code> 这个配置文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123; <span class="comment">// 用来配置第三方loader模块的</span></span><br><span class="line">    rules: [ <span class="comment">// 文件的匹配规则</span></span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            use: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">        &#125; <span class="comment">//处理css文件的规则</span></span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意：<code>use</code> 表示使用哪些模块来处理 <code>test</code> 所匹配到的文件；<code>use</code> 中相关 loader 模块的调用顺序是从后向前调用的。</p>
</li>
</ol>
<h3 id="打包-less-文件"><a href="#打包-less-文件" class="headerlink" title="打包 less 文件"></a>打包 less 文件</h3><ol>
<li><p>如果你习惯使用 less ，可以执行命令 <code>npm i less-loader less -D</code> 来安装 less-loader 。</p>
</li>
<li><p>修改 <code>webpack.config.js</code> 配置文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">    use: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;less-loader&#x27;</span>]</span><br><span class="line">&#125;, <span class="comment">//配置处理 .less 文件的第三方 loader 规则</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="打包-sass-文件"><a href="#打包-sass-文件" class="headerlink" title="打包 sass 文件"></a>打包 sass 文件</h3><ol>
<li><p>例如我平常习惯用 scss，所以会安装 sass-loader ：执行命令 <code>npm i sass-loader node-sass --D</code></p>
</li>
<li><p>在 <code>webpack.config.js</code> 中添加处理 sass 文件的 loader 模块：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">   use: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;sass-loader&#x27;</span>]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 配置处理 .scss 文件的 第三方 loader 规则（npm i sass-loader后还需要 npm i node-sass，否则编译报错）</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="处理-css-中的图片路径"><a href="#处理-css-中的图片路径" class="headerlink" title="处理 css 中的图片路径"></a>处理 css 中的图片路径</h3><blockquote>
<p>预备工作：</p>
<ol>
<li>在 src/css/index.css 文件中给 body 添加：background-image: url(“../images/temp.png”);</li>
<li>此时保存会编译报错，因为 webpack 无法处理 css 中的路径（此案例中为——图片资源）</li>
</ol>
</blockquote>
<ol>
<li><p>运行 <code>npm i url-loader file-loader --D</code></p>
</li>
<li><p>在 <code>webpack.config.js</code> 中添加处理 url 路径的 loader 模块：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.(jpg|png|bmp|gif|jpeg)$/</span>,</span><br><span class="line">    use:[&#123;</span><br><span class="line">       loader:<span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">       options:&#123;</span><br><span class="line">          outputPath:<span class="string">&#x27;images/&#x27;</span>,<span class="comment">//输出到images文件夹</span></span><br><span class="line">          <span class="comment">//是把小于500B的文件打成 Base64 的格式，写入JS</span></span><br><span class="line">          <span class="comment">// 如果不小于，url-loader 就会使用 file-loader 处理图片</span></span><br><span class="line">          <span class="comment">// 所以必须安装file-loader</span></span><br><span class="line">          limit:<span class="number">500</span></span><br><span class="line">       &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;, <span class="comment">// 配置图片路径</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="处理-Bootstrap-字体的加载"><a href="#处理-Bootstrap-字体的加载" class="headerlink" title="处理 Bootstrap 字体的加载"></a>处理 Bootstrap 字体的加载</h3><p>**重要(更新)**：webpack4后的 bootstrap 字体加载已经不能使用下面该方法，如何使用可以参考这篇博客：<a href="https://blog.csdn.net/hyt941026/article/details/82870466">webpack 4.X版本的简单使用(处理js/css/less/scss/url(图片)/字体文件)</a></p>
<blockquote>
<p>预备工作：</p>
<p>index.html 写入</p>
<p>来展示字体图片</p>
<p>main.js 导入 import ‘bootstrap/dist/css/bootstrap.css’</p>
<p>此时报错</p>
</blockquote>
<p>在 <code>webpack.config.js</code> 中添加处理字体文件的 loader 模块：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.(ttf|eot|svg|woff|woff2)$/</span>,</span><br><span class="line">    use: <span class="string">&#x27;url-loader&#x27;</span></span><br><span class="line">&#125;, <span class="comment">// 处理 字体文件的 loader</span></span><br></pre></td></tr></table></figure>

<h3 id="提取css文件（插件！）"><a href="#提取css文件（插件！）" class="headerlink" title="提取css文件（插件！）"></a>提取css文件（插件！）</h3><p>先安装 mini-css-extract-plugin 包：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install mini-css-extract-plugin -D</span><br></pre></td></tr></table></figure>

<p>然后在 <code>webpack.config.js</code> 中修改对css文件处理的配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 提取css</span></span><br><span class="line"><span class="keyword">var</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>)</span><br><span class="line"></span><br><span class="line">rules: [</span><br><span class="line">    &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">            process.env.NODE_ENV === <span class="string">&#x27;development&#x27;</span> ? <span class="string">&#x27;style-loader&#x27;</span> : MiniCssExtractPlugin.loader,</span><br><span class="line">            <span class="string">&#x27;css-loader&#x27;</span>] <span class="comment">//处理css</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">]</span><br><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">        filename: <span class="string">&#x27;style.css&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="添加浏览器css前缀"><a href="#添加浏览器css前缀" class="headerlink" title="添加浏览器css前缀"></a>添加浏览器css前缀</h3><p>首先下载 loader ：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i postcss-loader autoprefixer -D</span><br></pre></td></tr></table></figure>

<p>然后根目录添加 <code>postcss.config.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: &#123;</span><br><span class="line">        <span class="string">&#x27;autoprefixer&#x27;</span>: &#123;</span><br><span class="line">            browsers: <span class="string">&#x27;last 5 version&#x27;</span> <span class="comment">// 代表意思为每个主流浏览器的最后5个版本</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后在 <code>webpack.config.js</code> 中添加配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">rules: [</span><br><span class="line">    &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">            process.env.NODE_ENV === <span class="string">&#x27;development&#x27;</span> ? <span class="string">&#x27;style-loader&#x27;</span> : MiniCssExtractPlugin.loader,</span><br><span class="line">            &#123;</span><br><span class="line">                loader: <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    importLoaders: <span class="number">1</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;postcss-loader&quot;</span></span><br><span class="line">        ] <span class="comment">//处理css</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="使用-babel-处理高级-JS-语法"><a href="#使用-babel-处理高级-JS-语法" class="headerlink" title="使用 babel 处理高级 JS 语法"></a>使用 babel 处理高级 JS 语法</h3><ol>
<li><p>在 main.js 文件中添加 ES6 代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// class 关键字，是ES6中提供的新语法，是用来 实现 ES6 中面向对象编程的方式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用 static 关键字，可以定义静态属性</span></span><br><span class="line">    <span class="comment">// 所谓的静态属性，就是 可以直接通过 类名， 直接访问的属性</span></span><br><span class="line">    <span class="comment">// 实例属性： 只能通过类的实例，来访问的属性，叫做实例属性</span></span><br><span class="line">    <span class="keyword">static</span> info = &#123;</span><br><span class="line">        name: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">        age: <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问 Person 类身上的  info 静态属性</span></span><br><span class="line"><span class="built_in">console</span>.log(Person.info)</span><br><span class="line"><span class="comment">// 在 webpack 中，默认只能处理 一部分 ES6 的新语法，一些更高级的ES6语法或者 ES7 语法，webpack 是处理不了的；这时候，就需要 借助于第三方的 loader，来帮助webpack 处理这些高级的语法，当第三方loader 把 高级语法转为 低级的语法之后，会把结果交给 webpack 去打包到 bundle.js 中</span></span><br><span class="line"><span class="comment">// 通过 Babel ，可以帮我们将 高级的语法转换为 低级的语法</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>运行如下两套命令，安装两套包，去安装 Babel 相关的loader功能：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// 【相当于转换工具】</span><br><span class="line">npm i -D @babel/core babel-loader @babel/plugin-transform-runtime @babel/runtime @babel/plugin-proposal-class-properties</span><br><span class="line">// 【相当于字典】</span><br><span class="line">npm i -D @babel/preset-env</span><br><span class="line"></span><br><span class="line">// =====&gt; 「转换工具」根据「字典」将 es6 转换</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开 webpack 的配置文件，在 module 节点下的 rules 数组中，添加一个新的匹配规则：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    use: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">    exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">&#125; <span class="comment">// 配置 Babel 来转换高级的ES语法</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>2.2</p>
<p>注意： 在配置 babel 的 loader 规则的时候，必须 把 node_modules 目录，通过 exclude 选项排除掉：原因有俩：</p>
<p>2.2.1</p>
<p>如果 不排除 node_modules， 则Babel 会把 node_modules 中所有的 第三方 JS 文件，都打包编译，这样，会非常消耗CPU，同时，打包速度非常慢；</p>
<p>2.2.2</p>
<p>哪怕，最终，Babel 把 所有 node_modules 中的JS转换完毕了，但是，项目也无法正常运行！</p>
</blockquote>
</li>
<li><p>在项目的根目录中，新建一个叫做 <code>.babelrc</code> 的 Babel 配置文件，这个配置文件，属于 JSON 格式，所以，在写 <code>.babelrc</code> 配置的时候，必须符合 JSON 语法规范： 不能写注释，字符串必须用双引号：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">        [<span class="string">&quot;@babel/preset-env&quot;</span>, &#123;</span><br><span class="line">            <span class="string">&quot;modules&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;targets&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;browsers&quot;</span>: [<span class="string">&quot;&gt; 1%&quot;</span>, <span class="string">&quot;last 2 versions&quot;</span>, <span class="string">&quot;not ie &lt;= 8&quot;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;useBuiltIns&quot;</span>: <span class="string">&quot;usage&quot;</span></span><br><span class="line">        &#125;]</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@babel/plugin-proposal-class-properties&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="webpack-config-js配置遇到Error-Cannot-find-module-‘-babel-core’问题"><a href="#webpack-config-js配置遇到Error-Cannot-find-module-‘-babel-core’问题" class="headerlink" title="webpack.config.js配置遇到Error: Cannot find module ‘@babel/core’问题"></a><a href="https://www.cnblogs.com/soyxiaobi/p/9554565.html">webpack.config.js配置遇到Error: Cannot find module ‘@babel/core’问题</a></h4><blockquote>
<p><strong>官方默认babel-loader | babel 对应的版本需要一致: 即babel-loader需要搭配最新版本babel</strong></p>
</blockquote>
<p>两种解决方案:</p>
<ol>
<li>回退低版本</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -D babel-loader@7 babel-core babel-preset-env</span><br></pre></td></tr></table></figure>

<ol>
<li>更新到最高版本:</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -D babel-loader @babel/core @babel/preset-env webpack</span><br></pre></td></tr></table></figure>

<h2 id="压缩和优化css文件"><a href="#压缩和优化css文件" class="headerlink" title="压缩和优化css文件"></a>压缩和优化css文件</h2><p>下载 <code>optimize-css-assets-webpack-plugin</code> 插件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i optimize-css-assets-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<p>在 <code>webpack.config.js</code> 中引入插件并添加配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 压缩css</span></span><br><span class="line"><span class="keyword">const</span> OptimizeCssAssetsPlugin = <span class="built_in">require</span>(<span class="string">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> OptimizeCssAssetsPlugin(&#123;</span><br><span class="line">        assetNameRegExp: <span class="regexp">/\.css$/g</span>, <span class="comment">//一个正则表达式，指示应优化/最小化的资产的名称。提供的正则表达式针对配置中ExtractTextPlugin实例导出的文件的文件名运行，而不是源CSS文件的文件名。默认为/\.css$/g</span></span><br><span class="line">        cssProcessor: <span class="built_in">require</span>(<span class="string">&#x27;cssnano&#x27;</span>), <span class="comment">//用于优化\最小化CSS的CSS处理器，默认为cssnano</span></span><br><span class="line">        cssProcessorOptions: &#123;</span><br><span class="line">            safe: <span class="literal">true</span>,</span><br><span class="line">            discardComments: &#123;</span><br><span class="line">                removeAll: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="comment">//传递给cssProcessor的选项，默认为&#123;&#125;</span></span><br><span class="line">        canPrint: <span class="literal">true</span> <span class="comment">//一个布尔值，指示插件是否可以将消息打印到控制台，默认为true</span></span><br><span class="line">    &#125;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="压缩和优化js文件"><a href="#压缩和优化js文件" class="headerlink" title="压缩和优化js文件"></a>压缩和优化js文件</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">yarn add webpack-parallel-uglify-plugin -D</span><br><span class="line"><span class="keyword">const</span> WebpackParallelUglifyPlugin = <span class="built_in">require</span>(<span class="string">&#x27;webpack-parallel-uglify-plugin&#x27;</span>)</span><br><span class="line">plugins: [</span><br><span class="line"><span class="keyword">new</span> WebpackParallelUglifyPlugin(&#123;</span><br><span class="line">      uglifyJS: &#123;</span><br><span class="line">        output: &#123;</span><br><span class="line">          beautify: <span class="literal">false</span>, <span class="comment">//不需要格式化</span></span><br><span class="line">          comments: <span class="literal">false</span> <span class="comment">//不保留注释</span></span><br><span class="line">        &#125;,</span><br><span class="line">        compress: &#123;</span><br><span class="line">          warnings: <span class="literal">false</span>, <span class="comment">// 在UglifyJs删除没有用到的代码时不输出警告</span></span><br><span class="line">          drop_console: <span class="literal">true</span>, <span class="comment">// 删除所有的 `console` 语句，可以兼容ie浏览器</span></span><br><span class="line">          collapse_vars: <span class="literal">true</span>, <span class="comment">// 内嵌定义了但是只用到一次的变量</span></span><br><span class="line">          reduce_vars: <span class="literal">true</span> <span class="comment">// 提取出出现多次但是没有定义成变量去引用的静态值</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="提取公共文件"><a href="#提取公共文件" class="headerlink" title="提取公共文件"></a>提取公共文件</h2><p>我们可看到 <code>src/js/a.js</code> 和 <code>src/main.js</code> 都引入了 <code>src/js/b.js</code> 文件，为什么要提取公共代码，简单来说，就是减少代码冗余，提高加载速度。和之前的 webpack 配置不一样：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//之前配置</span></span><br><span class="line"><span class="comment">// new webpack.optimize.SplitChunksPlugin(&#123;</span></span><br><span class="line"><span class="comment">//     name: &#x27;common&#x27;, // 如果还要提取公共代码,在新建一个实例</span></span><br><span class="line"><span class="comment">//     minChunks: 2, //重复两次之后就提取出来</span></span><br><span class="line"><span class="comment">//     chunks: [&#x27;index&#x27;, &#x27;a&#x27;] // 指定提取范围</span></span><br><span class="line"><span class="comment">// &#125;),</span></span><br><span class="line"><span class="comment">//现在配置</span></span><br><span class="line">optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">        cacheGroups: &#123;</span><br><span class="line">            commons: &#123;  <span class="comment">// 抽离自己写的公共代码</span></span><br><span class="line">                chunks: <span class="string">&quot;initial&quot;</span>,</span><br><span class="line">                name: <span class="string">&quot;common&quot;</span>, <span class="comment">// 打包后的文件名，任意命名</span></span><br><span class="line">                minChunks: <span class="number">2</span>,<span class="comment">//最小引用2次</span></span><br><span class="line">                minSize: <span class="number">0</span> <span class="comment">// 只要超出0字节就生成一个新包</span></span><br><span class="line">            &#125;,</span><br><span class="line">            vendor: &#123;   <span class="comment">// 抽离第三方插件</span></span><br><span class="line">                test: <span class="regexp">/node_modules/</span>,   <span class="comment">// 指定是node_modules下的第三方包</span></span><br><span class="line">                chunks: <span class="string">&#x27;initial&#x27;</span>,</span><br><span class="line">                name: <span class="string">&#x27;vendor&#x27;</span>,  <span class="comment">// 打包后的文件名，任意命名</span></span><br><span class="line">                <span class="comment">// 设置优先级，防止和自定义的公共代码提取时被覆盖，不进行打包</span></span><br><span class="line">                priority: <span class="number">10</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="Source-Maps-调试配置"><a href="#Source-Maps-调试配置" class="headerlink" title="Source Maps 调试配置"></a>Source Maps 调试配置</h2><p>作为开发，代码调试当然少不了，那么问题来了，经过打包后的文件，你是不容易找到出错的地方的，<code>Source Map</code>就是用来解决这个问题的。</p>
<p>通过如下配置，我们会在打包时生成对应于打包文件的 <code>.map</code> 文件，使得编译后的代码可读性更高，更易于调试。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ...</span><br><span class="line">    devtool: <span class="string">&#x27;source-map&#x27;</span> <span class="comment">// 会生成对于调试的完整的.map文件，但同时也会减慢打包速度</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置好后，我们再次运行 <code>npm run build</code> 进行打包，这时我们会发现在 <code>dist</code> 文件夹中多出了一个 <code>bundle.js.map</code></p>
<p>如果我们的代码有 bug ，在浏览器的调试工具中会提示错误出现的位置，这就是 <code>devtool: &#39;source-map&#39;</code> 配置项的作用。</p>
<h2 id="开发环境-VS-生产环境"><a href="#开发环境-VS-生产环境" class="headerlink" title="开发环境 VS 生产环境"></a>开发环境 VS 生产环境</h2><h3 id="npm-run-dev"><a href="#npm-run-dev" class="headerlink" title="npm run dev"></a>npm run dev</h3><p><strong>npm run dev</strong> 是我们开发环境下打包的文件，当然由于 devServer 帮我们把文件放到内存中了，所以并不会输出打包后的 dist 文件夹。</p>
<h3 id="npm-run-build"><a href="#npm-run-build" class="headerlink" title="npm run build"></a>npm run build</h3><p>通过 <strong>npm run build</strong> 之后会生成一个dist目录文件夹，里面有我们打包后的文件。</p>
<h2 id="清理-dist文件夹-CleanwebpackPlugin"><a href="#清理-dist文件夹-CleanwebpackPlugin" class="headerlink" title="清理/dist文件夹(CleanwebpackPlugin)"></a>清理<code>/dist</code>文件夹(CleanwebpackPlugin)</h2><p>你可能已经注意到，在我们删掉 <code>/dist</code> 文件夹之前，由于前面的代码示例遗留，导致我们的 <code>/dist</code> 文件夹比较杂乱。<code>webpack</code> 会生成文件，然后将这些文件放置在 <code>/dist</code> 文件夹中，但是 <code>webpack</code> 无法追踪到哪些文件是实际在项目中用到的。</p>
<p>通常，在每次构建前清理 <code>/dist</code> 文件夹，是比较推荐的做法，因此只会生成用到的文件，这时候就用到 <code>CleanWebpackPlugin</code> 插件了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i clean-webpack-plugin -D</span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>); <span class="comment">// 引入CleanWebpackPlugin插件</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ...</span><br><span class="line">    plugins: [</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin(),  <span class="comment">// 以前括号里面要传入数组([dist])来指定要删除的目录，新版 CleanWebpackPlugin 不需要传任何参数了</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>插件的使用方法都是一样的，首先引入，然后new一个实例，实例可传入参数。</p>
<p>现在我们运行 <code>npm run build</code> 后就会发现，webpack 会先将 <code>/dist</code> 文件夹删除，然后再生产新的 <code>/dist</code> 文件夹。</p>
<h2 id="webpack4-x-相关资源"><a href="#webpack4-x-相关资源" class="headerlink" title="webpack4.x 相关资源"></a>webpack4.x 相关资源</h2><ul>
<li><strong><a href="https://www.cnblogs.com/BetterMan-/p/9867642.html">webpack4.x最详细入门讲解</a></strong></li>
<li><a href="https://segmentfault.com/a/1190000018866232">从基础到实战 手摸手带你掌握新版Webpack4.0详解 教你看文档</a></li>
</ul>
<h2 id="webpack3-与-webpack4-使用差异"><a href="#webpack3-与-webpack4-使用差异" class="headerlink" title="webpack3 与 webpack4 使用差异"></a>webpack3 与 webpack4 使用差异</h2><ul>
<li><a href="https://blog.csdn.net/u012443286/article/details/79504289">webpack4.x开发环境配置</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>构建工具</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>最强大的CSS布局——Grid布局</title>
    <url>/posts/18030/</url>
    <content><![CDATA[<p>转载自：<a href="https://juejin.cn/post/6854573220306255880">https://juejin.cn/post/6854573220306255880</a></p>
<h1 id="最强大的-CSS-布局-——-Grid-布局"><a href="#最强大的-CSS-布局-——-Grid-布局" class="headerlink" title="最强大的 CSS 布局 —— Grid 布局"></a>最强大的 CSS 布局 —— Grid 布局</h1><h2 id="Grid-布局是什么？"><a href="#Grid-布局是什么？" class="headerlink" title="Grid 布局是什么？"></a>Grid 布局是什么？</h2><p><code>Grid</code> 布局即网格布局，是一种新的 <code>CSS</code> 布局模型，比较擅长将一个页面划分为几个主要区域，以及定义这些区域的大小、位置、层次等关系。号称是最强大的的 <code>CSS</code> 布局方案，是目前唯一一种 <code>CSS</code> 二维布局。利用 <code>Grid</code> 布局，我们可以轻松实现类似下图布局，<a href="https://codepen.io/gpingfeng/pen/qBbveKB?editors=1100">演示地址</a></p>
<img src="/posts/18030/1-20210225170307829" class="" title="1-20210225170307829">

<h2 id="Grid-布局和-flex-布局"><a href="#Grid-布局和-flex-布局" class="headerlink" title="Grid 布局和 flex 布局"></a>Grid 布局和 flex 布局</h2><p>讲到布局，我们就会想到 <code>flex</code> 布局，甚至有人认为竟然有 <code>flex</code> 布局了，似乎没有必要去了解 <code>Grid</code> 布局。但 <code>flex</code> 布局和 <code>Grid</code> 布局有实质的区别，那就是 <strong><code>flex</code> 布局是一维布局，<code>Grid</code> 布局是二维布局</strong>。<code>flex</code> 布局一次只能处理一个维度上的元素布局，一行或者一列。<code>Grid</code> 布局是将容器划分成了“行”和“列”，产生了一个个的网格，我们可以将网格元素放在与这些行和列相关的位置上，从而达到我们布局的目的。</p>
<p><strong><code>Grid</code> 布局远比 <code>flex</code> 布局强大！</strong></p>
<a id="more"></a>

<p>flex 布局示例:</p>
<img src="/posts/18030/1-20210225170307824-4243787." class="" title="1-20210225170307824-4243787">

<p>Grid 布局示例：</p>
<img src="/posts/18030/1-20210225170307821" class="" title="1-20210225170307821">

<h2 id="Grid-的一些基础概念"><a href="#Grid-的一些基础概念" class="headerlink" title="Grid 的一些基础概念"></a>Grid 的一些基础概念</h2><p>我们使用 Grid 实现一个小例子，演示 Grid 的一些基础概念，<a href="https://codepen.io/gpingfeng/pen/QWyoexm?editors=1100">演示地址</a></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;one item&quot;</span>&gt;</span>One<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;two item&quot;</span>&gt;</span>Two<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;three item&quot;</span>&gt;</span>Three<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;four item&quot;</span>&gt;</span>Four<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;five item&quot;</span>&gt;</span>Five<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;six item&quot;</span>&gt;</span>Six<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.wrapper</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">margin</span>: 60<span class="selector-tag">px</span>; <span class="comment">/* 声明一个容器 */</span></span></span><br><span class="line"><span class="css">    <span class="selector-tag">display</span>: <span class="selector-tag">grid</span>; <span class="comment">/* 声明列的宽度 */</span></span></span><br><span class="line"><span class="css">    <span class="selector-tag">grid-template-columns</span>: <span class="selector-tag">repeat</span>(3, 200<span class="selector-tag">px</span>); <span class="comment">/* 声明行间距和列间距 */</span></span></span><br><span class="line"><span class="css">    <span class="selector-tag">grid-gap</span>: 20<span class="selector-tag">px</span>; <span class="comment">/* 声明行的高度 */</span></span></span><br><span class="line">    grid-template-rows: 100px 200px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.one</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#19caad</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.two</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#8cc7b5</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.three</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#d1ba74</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.four</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#bee7e9</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.five</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#e6ceac</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.six</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#ecad9e</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.item</span> &#123;</span></span><br><span class="line">    text-align: center;</span><br><span class="line">    font-size: 200%;</span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/posts/18030/1-20210225170307824" class="" title="1-20210225170307824">

<p>容器和项目：我们通过在元素上声明 <code>display：grid</code> 或 <code>display：inline-grid</code> 来创建一个网格容器。一旦我们这样做，这个元素的所有直系子元素将成为网格项目。比如上面 <code>.wrapper</code> 所在的元素为一个网格容器，其直系子元素将成为网格项目。</p>
<p>网格轨道：<code>grid-template-columns</code> 和 <code>grid-template-rows</code> 属性来定义网格中的行和列。容器内部的水平区域称为行，垂直区域称为列。上图中 <code>One</code>、<code>Two</code>、<code>Three</code> 组成了一行，<code>One</code>、<code>Four</code> 则是一列</p>
<img src="/posts/18030/1-20210225170307837" class="" title="行和列">

<p>网格单元：一个网格单元是在一个网格元素中最小的单位， 从概念上来讲其实它和表格的一个单元格很像。上图中 <code>One</code>、<code>Two</code>、<code>Three</code>、<code>Four</code>…都是一个个的网格单元</p>
<p>网格线：划分网格的线，称为”网格线”。应该注意的是，当我们定义网格时，我们定义的是网格轨道，而不是网格线。Grid 会为我们创建编号的网格线来让我们来定位每一个网格元素。m 列有 m + 1 根垂直的网格线，n 行有 n + 1 跟水平网格线。比如上图示例中就有 4 根垂直网格线。一般而言，是从左到右，从上到下，1，2，3 进行编号排序。当然也可以从右到左，从下到上，按照 -1，-2，-3…顺序进行编号排序</p>
<img src="/posts/18030/1-20210225170307925-4243787." class="" title="网格线">

<h2 id="容器属性介绍"><a href="#容器属性介绍" class="headerlink" title="容器属性介绍"></a>容器属性介绍</h2><p><code>Grid</code> 布局相关的属性以及值众多，需要记忆的不少，建议可以跟 <code>demo</code> 一起结合起来，边敲代码边理解，再利用一些空闲时间记忆一下。笔者会在介绍每个属性的时候，做个小 <code>demo</code> 演示，建议大家可以自己修改看看效果加深记忆</p>
<p><code>Grid</code> 布局属性可以分为两大类，一类是容器属性，一类是项目属性。我们先来看容器属性</p>
<h3 id="display-属性"><a href="#display-属性" class="headerlink" title="display 属性"></a>display 属性</h3><p><a href="https://codepen.io/gpingfeng/pen/wvMZwqY">display 属性演示</a></p>
<p>我们通过在元素上声明 <code>display：grid</code> 或 <code>display：inline-grid</code> 来创建一个网格容器。声明 <code>display：grid</code> 则该容器是一个块级元素，设置成 <code>display: inline-grid</code> 则容器元素为行内元素</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/1-20210225170307837-4243787." class="" title="块级元素">

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper-1</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-grid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/1-20210225170307925" class="" title="行内属性">

<h3 id="grid-template-columns-属性和-grid-template-rows-属性"><a href="#grid-template-columns-属性和-grid-template-rows-属性" class="headerlink" title="grid-template-columns 属性和 grid-template-rows 属性"></a>grid-template-columns 属性和 grid-template-rows 属性</h3><p><a href="https://codepen.io/gpingfeng/pen/BajEBYq?editors=1100">grid-template-columns 和 grid-template-rows 属性演示地址</a></p>
<p><code>grid-template-columns</code> 属性设置列宽，<code>grid-template-rows</code> 属性设置行高，这两个属性在 <code>Grid</code> 布局中尤为重要，它们的值是有多种多样的，而且它们的设置是比较相似的，下面针对 <code>grid-template-columns</code> 属性进行讲解</p>
<p><strong>固定的列宽和行高</strong></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="comment">/*  声明了三列，宽度分别为 200px 100px 200px */</span></span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">200px</span> <span class="number">100px</span> <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="comment">/*  声明了两行，行高分别为 50px 50px  */</span></span><br><span class="line">  <span class="attribute">grid-template-rows</span>: <span class="number">50px</span> <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上表示固定列宽为 200px 100px 200px，行高为 50px 50px</p>
<img src="/posts/18030/1-20210225170307865" class="" title="固定行高和列宽">

<p><strong>repeat() 函数</strong>：可以简化重复的值。该函数接受两个参数，第一个参数是重复的次数，第二个参数是所要重复的值。比如上面行高都是一样的，我们可以这么去实现，实际效果是一模一样的</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper-1</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">200px</span> <span class="number">100px</span> <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="comment">/*  2行，而且行高都为 50px  */</span></span><br><span class="line">  <span class="attribute">grid-template-rows</span>: <span class="built_in">repeat</span>(<span class="number">2</span>, <span class="number">50px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>auto-fill 关键字</strong>：表示自动填充，让一行（或者一列）中尽可能的容纳更多的单元格。<code>grid-template-columns: repeat(auto-fill, 200px)</code> 表示列宽是 200 px，但列的数量是不固定的，只要浏览器能够容纳得下，就可以放置元素，代码以及效果如下图所示：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper-2</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(auto-fill, <span class="number">200px</span>);</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/17389591c300e81a-20210225170307937.gif" class="" title="17389591c300e81a-20210225170307937">

<p><strong>fr 关键字</strong>：<code>Grid</code> 布局还引入了一个另外的长度单位来帮助我们创建灵活的网格轨道。<code>fr</code> 单位代表网格容器中可用空间的一等份。<code>grid-template-columns: 200px 1fr 2fr</code> 表示第一个列宽设置为 200px，后面剩余的宽度分为两部分，宽度分别为剩余宽度的 1/3 和 2/3。代码以及效果如下图所示：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper-3</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">200px</span> <span class="number">1</span>fr <span class="number">2</span>fr;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/17389591ccc256d1-20210225170307921.gif" class="" title="17389591ccc256d1-20210225170307921">

<p><strong>minmax() 函数</strong>：我们有时候想给网格元素一个最小和最大的尺寸，<code>minmax()</code> 函数产生一个长度范围，表示长度就在这个范围之中都可以应用到网格项目中。它接受两个参数，分别为最小值和最大值。<code>grid-template-columns: 1fr 1fr minmax(300px, 2fr)</code> 的意思是，第三个列宽最少也是要 300px，但是最大不能大于第一第二列宽的两倍。代码以及效果如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper-4</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">1</span>fr <span class="number">1</span>fr <span class="built_in">minmax</span>(<span class="number">300px</span>, <span class="number">2</span>fr);</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/17389591dc05edac-20210225170308058.gif" class="" title="17389591dc05edac-20210225170308058">

<p><strong>auto 关键字</strong>：由浏览器决定长度。通过 <code>auto</code> 关键字，我们可以轻易实现三列或者两列布局。<code>grid-template-columns: 100px auto 100px</code> 表示第一第三列为 100px，中间由浏览器决定长度，代码以及效果如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper-5</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">100px</span> auto <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/17389591f2146e1d-20210225170308055.gif" class="" title="17389591f2146e1d-20210225170308055">

<h3 id="grid-row-gap-属性、grid-column-gap-属性以及-grid-gap-属性"><a href="#grid-row-gap-属性、grid-column-gap-属性以及-grid-gap-属性" class="headerlink" title="grid-row-gap 属性、grid-column-gap 属性以及 grid-gap 属性"></a>grid-row-gap 属性、grid-column-gap 属性以及 grid-gap 属性</h3><p><a href="https://codepen.io/gpingfeng/pen/jOWRNeg">grid-row-gap 属性、grid-column-gap 属性以及 grid-gap 属性演示地址</a></p>
<p><code>grid-row-gap</code> 属性、<code>grid-column-gap</code> 属性分别设置行间距和列间距。<code>grid-gap</code> 属性是两者的简写形式。</p>
<p><code>grid-row-gap: 10px</code> 表示行间距是 10px，<code>grid-column-gap: 20px</code> 表示列间距是 20px。<code>grid-gap: 10px 20px</code> 实现的效果是一样的</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">200px</span> <span class="number">100px</span> <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.wrapper-1</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">200px</span> <span class="number">100px</span> <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">grid-row-gap</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">grid-column-gap</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上两种写法效果是一样的。</p>
<img src="/posts/18030/1-20210225170307914" class="" title="1-20210225170307914">

<h3 id="grid-template-areas-属性"><a href="#grid-template-areas-属性" class="headerlink" title="grid-template-areas 属性"></a>grid-template-areas 属性</h3><p><a href="https://codepen.io/gpingfeng/pen/RwrObEJ?editors=1100">grid-area 以及 grid-template-areas 演示地址</a></p>
<p><code>grid-template-areas</code> 属性用于定义区域，一个区域由一个或者多个单元格组成</p>
<p>一般这个属性跟网格元素的 <code>grid-area</code> 一起使用，我们在这里一起介绍。 <code>grid-area</code> 属性指定项目放在哪一个区域</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">120px</span> <span class="number">120px</span> <span class="number">120px</span>;</span><br><span class="line">  <span class="attribute">grid-template-areas</span>:</span><br><span class="line">    <span class="string">&#x27;. header  header&#x27;</span></span><br><span class="line">    <span class="string">&#x27;sidebar content content&#x27;</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码表示划分出 6 个单元格，其中值得注意的是 <code>.</code> 符号代表空的单元格，也就是没有用到该单元格。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: sidebar;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: header;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码表示将类 <code>.sidebar</code> <code>.content</code> <code>.header</code>所在的元素放在上面 <code>grid-template-areas</code> 中定义的 <code>sidebar</code> <code>content</code> <code>header</code> 区域中</p>
<img src="/posts/18030/1-20210225170307936" class="" title="1-20210225170307936">

<h3 id="grid-auto-flow-属性"><a href="#grid-auto-flow-属性" class="headerlink" title="grid-auto-flow 属性"></a>grid-auto-flow 属性</h3><p><a href="https://codepen.io/gpingfeng/pen/MWKRWKj?editors=1100">grid-auto-flow 属性演示地址</a></p>
<p><code>grid-auto-flow</code> 属性控制着自动布局算法怎样运作，精确指定在网格中被自动布局的元素怎样排列。默认的放置顺序是”先行后列”，即先填满第一行，再开始放入第二行，即下图英文数字的顺序 <code>one</code>,<code>two</code>,<code>three</code>…。这个顺序由 <code>grid-auto-flow</code> 属性决定，默认值是 <code>row</code>。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">100px</span> <span class="number">200px</span> <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-flow</span>: row;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/1-20210225170308035" class="" title="1-20210225170308035">

<p>细心的同学可能发现了一个问题，就是第五个项目和第六个项目之间有个空白（如下图所示），这个是由于第六块的长度大于了空白处的长度，被挤到了下一行导致的。在实际应用中，我们可能想让下面长度合适的填满这个空白，这个时候可以设置 <code>grid-auto-flow: row dense</code>，表示尽可能填满表格。代码以及效果如下所示：</p>
<img src="/posts/18030/1-20210225170308019" class="" title="1-20210225170308019">

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper-2</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">100px</span> <span class="number">200px</span> <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-flow</span>: row dense;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/1-20210225170308017" class="" title="1-20210225170308017">

<p>可以设置 <code>grid-auto-flow: column</code>，表示先列后行，代码以及效果如下图所示：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper-1</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-auto-columns</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-flow</span>: column;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">grid-template-rows</span>: <span class="number">50px</span> <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/1-20210225170308011" class="" title="1-20210225170308011">

<h3 id="justify-items-属性、align-items-属性以及-place-items-属性"><a href="#justify-items-属性、align-items-属性以及-place-items-属性" class="headerlink" title="justify-items 属性、align-items 属性以及 place-items 属性"></a>justify-items 属性、align-items 属性以及 place-items 属性</h3><p><a href="https://codepen.io/gpingfeng/pen/zYrXYrz?editors=1100">justify-items 属性、align-items 属性演示地址</a></p>
<p><code>justify-items</code> 属性设置单元格内容的水平位置（左中右），<code>align-items</code> 属性设置单元格的垂直位置（上中下）</p>
<p>下面以 justify-items 属性为例进行讲解，align-items 属性同理，只是方向为垂直方向。它们都有如下属性：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">justify-items</span>: start | end | center | stretch;</span><br><span class="line">  <span class="attribute">align-items</span>: start | end | center | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其代码实现以及效果如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span>,</span><br><span class="line"><span class="selector-class">.wrapper-1</span>,</span><br><span class="line"><span class="selector-class">.wrapper-2</span>,</span><br><span class="line"><span class="selector-class">.wrapper-3</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">100px</span> <span class="number">200px</span> <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">justify-items</span>: start;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper-1</span> &#123;</span><br><span class="line">  <span class="attribute">justify-items</span>: end;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper-2</span> &#123;</span><br><span class="line">  <span class="attribute">justify-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper-3</span> &#123;</span><br><span class="line">  <span class="attribute">justify-items</span>: stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>start：对齐单元格的起始边缘</li>
</ul>
<img src="/posts/18030/1-20210225170308044" class="" title="1-20210225170308044">

<ul>
<li>end：对齐单元格的结束边缘</li>
</ul>
<img src="/posts/18030/1-20210225170308054" class="" title="1-20210225170308054">

<ul>
<li>center：单元格内部居中</li>
</ul>
<img src="/posts/18030/1-20210225170308085" class="" title="1-20210225170308085">

<ul>
<li>stretch：拉伸，占满单元格的整个宽度（默认值）</li>
</ul>
<img src="/posts/18030/1-20210225170308042" class="" title="1-20210225170308042">

<h3 id="justify-content-属性、align-content-属性以及-place-content-属性"><a href="#justify-content-属性、align-content-属性以及-place-content-属性" class="headerlink" title="justify-content 属性、align-content 属性以及 place-content 属性"></a>justify-content 属性、align-content 属性以及 place-content 属性</h3><p><a href="https://codepen.io/gpingfeng/pen/qBbwBZx?editors=1100">justify-content 属性、align-content 属性演示地址</a></p>
<p><code>justify-content</code> 属性是整个内容区域在容器里面的水平位置（左中右），<code>align-content</code> 属性是整个内容区域的垂直位置（上中下）。它们都有如下的属性值。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: start | end | center | stretch | space-around | space-between</span><br><span class="line">    | space-evenly;</span><br><span class="line">  <span class="attribute">align-content</span>: start | end | center | stretch | space-around | space-between |</span><br><span class="line">    space-evenly;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面以 <code>justify-content</code> 属性为例进行讲解，<code>align-content</code> 属性同理，只是方向为垂直方向</p>
<ul>
<li>start - 对齐容器的起始边框</li>
<li>end - 对齐容器的结束边框</li>
<li>center - 容器内部居中</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span>,</span><br><span class="line"><span class="selector-class">.wrapper-1</span>,</span><br><span class="line"><span class="selector-class">.wrapper-2</span>,</span><br><span class="line"><span class="selector-class">.wrapper-3</span>,</span><br><span class="line"><span class="selector-class">.wrapper-4</span>,</span><br><span class="line"><span class="selector-class">.wrapper-5</span>,</span><br><span class="line"><span class="selector-class">.wrapper-6</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">100px</span> <span class="number">200px</span> <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">justify-content</span>: start;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper-1</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: end;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper-2</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/1-20210225170308061" class="" title="1-20210225170308061">

<ul>
<li>space-around - 每个项目两侧的间隔相等。所以，项目之间的间隔比项目与容器边框的间隔大一倍</li>
<li>space-between - 项目与项目的间隔相等，项目与容器边框之间没有间隔</li>
<li>space-evenly - 项目与项目的间隔相等，项目与容器边框之间也是同样长度的间隔</li>
<li>stretch - 项目大小没有指定时，拉伸占据整个网格容器</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper-3</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper-4</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper-5</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-evenly;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper-6</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/1-20210225170308075" class="" title="1-20210225170308075">

<h3 id="grid-auto-columns-属性和-grid-auto-rows-属性"><a href="#grid-auto-columns-属性和-grid-auto-rows-属性" class="headerlink" title="grid-auto-columns 属性和 grid-auto-rows 属性"></a>grid-auto-columns 属性和 grid-auto-rows 属性</h3><p><a href="https://codepen.io/gpingfeng/pen/zYrXvYZ?editors=1100">grid-auto-columns 属性和 grid-auto-rows 属性演示地址</a></p>
<p>在讲 <code>grid-auto-columns</code> 属性和 <code>grid-auto-rows</code> 属性之前，先来看看隐式和显式网格的概念</p>
<p><strong>隐式和显式网格</strong>：显式网格包含了你在 <code>grid-template-columns</code> 和 <code>grid-template-rows</code> 属性中定义的行和列。如果你在网格定义之外又放了一些东西，或者因为内容的数量而需要的更多网格轨道的时候，网格将会在隐式网格中创建行和列</p>
<p>假如有多余的网格（也就是上面提到的隐式网格），那么它的行高和列宽可以根据 <code>grid-auto-columns</code> 属性和 <code>grid-auto-rows</code> 属性设置。它们的写法和<code>grid-template-columns</code> 和 <code>grid-template-rows</code> 完全相同。如果不指定这两个属性，浏览器完全根据单元格内容的大小，决定新增网格的列宽和行高</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">200px</span> <span class="number">100px</span>;</span><br><span class="line">  <span class="comment">/*  只设置了两行，但实际的数量会超出两行，超出的行高会以 grid-auto-rows 算 */</span></span><br><span class="line">  <span class="attribute">grid-template-rows</span>: <span class="number">100px</span> <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>grid-template-columns</code> 属性和 <code>grid-template-rows</code> 属性只是指定了两行两列，但实际有九个元素，就会产生隐式网格。通过 <code>grid-auto-rows</code> 可以指定隐式网格的行高为 50px</p>
<img src="/posts/18030/1-20210225170308068" class="" title="1-20210225170308068">

<h2 id="项目属性介绍"><a href="#项目属性介绍" class="headerlink" title="项目属性介绍"></a>项目属性介绍</h2><h3 id="grid-column-start-属性、grid-column-end-属性、grid-row-start-属性以及-grid-row-end-属性"><a href="#grid-column-start-属性、grid-column-end-属性、grid-row-start-属性以及-grid-row-end-属性" class="headerlink" title="grid-column-start 属性、grid-column-end 属性、grid-row-start 属性以及 grid-row-end 属性"></a>grid-column-start 属性、grid-column-end 属性、grid-row-start 属性以及 grid-row-end 属性</h3><p><a href="https://codepen.io/gpingfeng/pen/PoZgopr">演示地址</a></p>
<p>可以指定网格项目所在的四个边框，分别定位在哪根网格线，从而指定项目的位置</p>
<ul>
<li>grid-column-start 属性：左边框所在的垂直网格线</li>
<li>grid-column-end 属性：右边框所在的垂直网格线</li>
<li>grid-row-start 属性：上边框所在的水平网格线</li>
<li>grid-row-end 属性：下边框所在的水平网格线</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(<span class="number">3</span>, <span class="number">1</span>fr);</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="built_in">minmax</span>(<span class="number">100px</span>, auto);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.one</span> &#123;</span><br><span class="line">  <span class="attribute">grid-column-start</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">grid-column-end</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#19caad</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.two</span> &#123;</span><br><span class="line">  <span class="attribute">grid-column-start</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">grid-column-end</span>: <span class="number">4</span>;</span><br><span class="line">  <span class="attribute">grid-row-start</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">grid-row-end</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="comment">/*   如果有重叠，就使用 z-index */</span></span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#8cc7b5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.three</span> &#123;</span><br><span class="line">  <span class="attribute">grid-column-start</span>: <span class="number">3</span>;</span><br><span class="line">  <span class="attribute">grid-column-end</span>: <span class="number">4</span>;</span><br><span class="line">  <span class="attribute">grid-row-start</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">grid-row-end</span>: <span class="number">4</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#d1ba74</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.four</span> &#123;</span><br><span class="line">  <span class="attribute">grid-column-start</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">grid-column-end</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">grid-row-start</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">grid-row-end</span>: <span class="number">5</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#bee7e9</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.five</span> &#123;</span><br><span class="line">  <span class="attribute">grid-column-start</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">grid-column-end</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">grid-row-start</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">grid-row-end</span>: <span class="number">5</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#e6ceac</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.six</span> &#123;</span><br><span class="line">  <span class="attribute">grid-column</span>: <span class="number">3</span>;</span><br><span class="line">  <span class="attribute">grid-row</span>: <span class="number">4</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ecad9e</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码中，类 <code>.two</code> 所在的网格项目，垂直网格线是从 2 到 4，水平网格线是从 1 到 2。其中它跟 <code>.three</code> （垂直网格线是从 3 到 4，水平网格线是从 1 到 4） 是有冲突的。可以设置 <code>z-index</code> 去决定它们的层级关系</p>
<img src="/posts/18030/1-20210225170308072" class="" title="1-20210225170308072">

<h3 id="grid-area-属性"><a href="#grid-area-属性" class="headerlink" title="grid-area 属性"></a>grid-area 属性</h3><p><code>grid-area</code> 属性指定项目放在哪一个区域，在上面介绍 <code>grid-template-areas</code> 的时候有提到过，这里不再具体展开，具体的使用可以参考演示地址：</p>
<p><a href="https://codepen.io/gpingfeng/pen/RwrObEJ">grid-area 以及 grid-template-areas 属性演示地址</a></p>
<h3 id="justify-self-属性、align-self-属性以及-place-self-属性"><a href="#justify-self-属性、align-self-属性以及-place-self-属性" class="headerlink" title="justify-self 属性、align-self 属性以及 place-self 属性"></a>justify-self 属性、align-self 属性以及 place-self 属性</h3><p><a href="https://codepen.io/gpingfeng/pen/ZEQZEJK?editors=1100">justify-self 属性/ align-self 属性/ place-self 属性演示地址</a></p>
<p><code>justify-self</code> 属性设置单元格内容的水平位置（左中右），跟 <code>justify-items</code> 属性的用法完全一致，但只作用于单个项目</p>
<p><code>align-self</code> 属性设置单元格内容的垂直位置（上中下），跟 align-items 属性的用法完全一致，也是只作用于单个项目</p>
<p>两者很相像，这里只拿 <code>justify-self</code> 属性演示，<code>align-self</code> 属性同理，只是作用于垂直方向。<code>place-self</code> 是设置 <code>align-self</code> 和 <code>justify-self</code> 的简写形式，这里也不重复介绍。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">justify-self</span>: start | end | center | stretch;</span><br><span class="line">  <span class="attribute">align-self</span>: start | end | center | stretch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">justify-self</span>: start;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item-1</span> &#123;</span><br><span class="line">  <span class="attribute">justify-self</span>: end;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item-2</span> &#123;</span><br><span class="line">  <span class="attribute">justify-self</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item-3</span> &#123;</span><br><span class="line">  <span class="attribute">justify-self</span>: stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>start：对齐单元格的起始边缘</li>
</ul>
<img src="/posts/18030/1-20210225170308082" class="" title="1-20210225170308082">

<ul>
<li>end：对齐单元格的结束边缘</li>
</ul>
<img src="/posts/18030/17389592a0d5a3c0" class="" title="17389592a0d5a3c0">

<ul>
<li><p>center：单元格内部居中</p>
<img src="/posts/18030/1-20210225170308078" class="" title="1-20210225170308078">
</li>
<li><p>stretch：拉伸，占满单元格的整个宽度（默认值）</p>
<img src="/posts/18030/1-20210225170308239" class="" title="1-20210225170308239">

</li>
</ul>
<h2 id="Grid-实战——实现响应式布局"><a href="#Grid-实战——实现响应式布局" class="headerlink" title="Grid 实战——实现响应式布局"></a>Grid 实战——实现响应式布局</h2><p>经过上面的介绍，相信大家都可以看出，Grid 是非常强大的。一些常见的 CSS 布局，如居中，两列布局，三列布局等等是很容易实现的。我们接下来看看 Grid 布局是如何实现响应式布局的</p>
<h3 id="fr-实现等分响应式"><a href="#fr-实现等分响应式" class="headerlink" title="fr 实现等分响应式"></a>fr 实现等分响应式</h3><p><a href="https://codepen.io/gpingfeng/pen/wvMZKpB?editors=1100">fr 实现等分响应式</a></p>
<p><code>fr</code> 等分单位，可以将容器的可用空间分成想要的多个等分空间。利用这个特性，我们能够轻易实现一个等分响应式。<code>grid-template-columns: 1fr 1fr 1fr</code> 表示容器分为三等分</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">1</span>fr <span class="number">1</span>fr <span class="number">1</span>fr;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/17389592bf7e44dd-20210225170308496.gif" class="" title="17389592bf7e44dd-20210225170308496.gif">

<h3 id="repeat-auto-fit——固定列宽，改变列数量"><a href="#repeat-auto-fit——固定列宽，改变列数量" class="headerlink" title="repeat + auto-fit——固定列宽，改变列数量"></a>repeat + auto-fit——固定列宽，改变列数量</h3><p>等分布局并不只有 <code>Grid</code> 布局才有，像 <code>flex</code> 布局也能轻松实现，接下来看看更高级的响应式</p>
<p>上面例子的始终都是三列的，但是需求往往希望我们的网格能够固定列宽，并根据容器的宽度来改变列的数量。这个时候，我们可以用到上面提到 <code>repeat()</code> 函数以及 <code>auto-fit</code> 关键字。<code>grid-template-columns: repeat(auto-fit, 200px)</code> 表示固定列宽为 200px，数量是自适应的，只要容纳得下，就会往上排列，代码以及效果实现如下：</p>
<p><a href="https://codepen.io/gpingfeng/pen/eYJopVE?editors=1100">演示地址</a></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(auto-fit, <span class="number">200px</span>);</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/17389592c297495a-20210225170308400.gif" class="" title="17389592c297495a-20210225170308400.gif">

<h3 id="repeat-auto-fit-minmax-去掉右侧空白"><a href="#repeat-auto-fit-minmax-去掉右侧空白" class="headerlink" title="repeat+auto-fit+minmax 去掉右侧空白"></a>repeat+auto-fit+minmax 去掉右侧空白</h3><p>上面看到的效果中，右侧通常会留下空白，这是我们不希望看到的。如果列的宽度也能在某个范围内自适应就好了。<code>minmax()</code> 函数就帮助我们做到了这点。将 <code>grid-template-columns: repeat(auto-fit, 200px)</code> 改成 <code>grid-template-columns: repeat(auto-fit, minmax(200px, 1fr))</code> 表示列宽至少 200px，如果还有空余则一起等分。代码以及效果如下所示：</p>
<p><a href="https://codepen.io/gpingfeng/pen/dyGLYdQ">演示地址</a></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(auto-fit, minmax(<span class="number">200px</span>, <span class="number">1</span>fr));</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/17389592cc3c2bf9-20210225170308310.gif" class="" title="auto-auto-minmax.gif">

<h3 id="repeat-auto-fit-minmax-span-dense-解决空缺问题"><a href="#repeat-auto-fit-minmax-span-dense-解决空缺问题" class="headerlink" title="repeat+auto-fit+minmax-span-dense 解决空缺问题"></a>repeat+auto-fit+minmax-span-dense 解决空缺问题</h3><p>似乎一切进行得很顺利，但是某天 UI 来说，每个网格元素的长度可能不相同，这也简单，通过 <code>span</code> 关键字进行设置网格项目的跨度，<code>grid-column-start: span 3</code>，表示这个网格项目跨度为 3。具体的代码与效果如下所示：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item-3</span> &#123;</span><br><span class="line">  <span class="attribute">grid-column-start</span>: span <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://codepen.io/gpingfeng/pen/BajEoxy?editors=1100">演示地址</a></p>
<img src="/posts/18030/17389592f9da3763-20210225170308517.gif" class="" title="17389592f9da3763-20210225170308517">

<p>不对，怎么右侧又有空白了？原来是有一些长度太长了，放不下，这个时候就到我们的 <code>dense</code> 关键字出场了。<code>grid-auto-flow: row dense</code> 表示尽可能填充，而不留空白，代码以及效果如下所示：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span>,</span><br><span class="line"><span class="selector-class">.wrapper-1</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(auto-fit, minmax(<span class="number">200px</span>, <span class="number">1</span>fr));</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.wrapper-1</span> &#123;</span><br><span class="line">  <span class="attribute">grid-auto-flow</span>: row dense;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/18030/17389593009f7fe7-20210225170308683.gif" class="" title="17389593009f7fe7-20210225170308683.gif">

<h2 id="Grid-布局兼容性"><a href="#Grid-布局兼容性" class="headerlink" title="Grid 布局兼容性"></a>Grid 布局兼容性</h2><p>最后，聊聊 <code>Grid</code> 布局兼容性问题，在 <a href="https://caniuse.com/#search=grid">caniuse</a> 中，我们可以看到的结果如下，总体兼容性还不错，但在 IE 10 以下不支持。个人建议在公司的内部系统运用起来是没有问题的，但 TOC 的话，可能目前还是不太合适</p>
<img src="/posts/18030/1-20210225170308348" class="" title="1-20210225170308348">

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://gridbyexample.com/examples/">常见的 Grid 布局用例</a></p>
<p><a href="https://www.ruanyifeng.com/blog/2019/03/grid-layout-tutorial.html">CSS Grid 网格布局教程</a></p>
<p><a href="https://drafts.csswg.org/css-grid/#intro">Grid 布局草案</a></p>
<p><a href="https://www.html.cn/archives/8706">一行 CSS 代码实现响应式布局 – 使用 Grid 实现的响应式布局</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Grid_Layout/Basic_Concepts_of_Grid_Layout">MDN</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
        <category>Grid</category>
      </categories>
      <tags>
        <tag>Grid</tag>
      </tags>
  </entry>
  <entry>
    <title>浏览器面试题（面试系列）</title>
    <url>/posts/46105/</url>
    <content><![CDATA[<h2 id="cookie-与-本地存储-相关"><a href="#cookie-与-本地存储-相关" class="headerlink" title="cookie 与 本地存储 相关"></a>cookie 与 本地存储 相关</h2><h3 id="cookie、session、localStorage-分别是什么？"><a href="#cookie、session、localStorage-分别是什么？" class="headerlink" title="cookie、session、localStorage 分别是什么？"></a>cookie、session、localStorage 分别是什么？</h3><p>cookie 是存储在浏览器上的一小段数据，用来记录某些当页面关闭或者刷新后仍然需要记录的信息。</p>
<p>用户在输入用户名密码提交给服务端，服务端验证通过后会创建一个 session 用于记录用户的相关信息，这个 session 可保存在服务器内存中，也可保存在数据库中。</p>
<p>localStorage HTML5 本地存储 web storage 特性的 API 之一，用于将大量数据（最大 5M）保存在浏览器中，保存后数据永远存在不会失效过期，除非用 JS 手动清除。</p>
<a id="more"></a>

<h3 id="cookie-的使用"><a href="#cookie-的使用" class="headerlink" title="cookie 的使用"></a>cookie 的使用</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置</span></span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">&#x27;age=16&#x27;</span>; <span class="comment">// 每次只能设置一对cookie</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取</span></span><br><span class="line"><span class="built_in">document</span>.cookie; <span class="comment">// 获取全部cookie值，获取特定用循环</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">&#x27;name=xiaoming; max-age=-1000&#x27;</span>; <span class="comment">// 设置一个当前之前的时间即可</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置过期时间</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;one_name&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> value = <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> exp = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">exp.setTime(exp.getTime() + <span class="number">60</span> * <span class="number">2000</span>); <span class="comment">// 过期时间 2分钟</span></span><br><span class="line"><span class="built_in">document</span>.cookie = name + <span class="string">&#x27;=&#x27;</span> + <span class="built_in">escape</span>(value) + <span class="string">&#x27;;expires=&#x27;</span> + exp.toGMTString();</span><br><span class="line"><span class="built_in">console</span>.log(name + <span class="string">&#x27;=&#x27;</span> + <span class="built_in">escape</span>(value) + <span class="string">&#x27;;expires=&#x27;</span> + exp.toGMTString());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果不在浏览器中设置过期时间，cookie 被保存在内存中，生命周期随浏览器的关闭而结束，</span></span><br><span class="line"><span class="comment">// 这种 cookie 简称会话 cookie。</span></span><br><span class="line"><span class="comment">// 如果在浏览器中设置了 cookie 的过期时间，cookie 被保存在硬盘中，</span></span><br><span class="line"><span class="comment">// 关闭浏览器后，cookie 数据仍然存在，直到过期时间结束才消失。</span></span><br></pre></td></tr></table></figure>

<h3 id="cookie-localStorage-和-sessionStorage-的区别"><a href="#cookie-localStorage-和-sessionStorage-的区别" class="headerlink" title="cookie, localStorage 和 sessionStorage 的区别"></a>cookie, localStorage 和 sessionStorage 的区别</h3><h4 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h4><ul>
<li>cookie：是服务器发给浏览器保存的（字符串）数据，一般用来记录用户信息方便服务端确认用户身份</li>
<li>localStorage、sessionStorage：本地存储，可以保存一些不太重要的数据，例如当前用户坐标，购物车信息等</li>
</ul>
<h4 id="存储大小"><a href="#存储大小" class="headerlink" title="存储大小"></a>存储大小</h4><ul>
<li>cookie：4k</li>
<li>localStorage, sessionStorage：5M</li>
</ul>
<h4 id="有效期"><a href="#有效期" class="headerlink" title="有效期"></a>有效期</h4><ul>
<li>cookie：关闭浏览器失效（默认）</li>
<li>localStorage：永久，除非 js 手动删和清除浏览器缓存</li>
<li>sessionStorage：页面不关闭就不失效，包括重新加载或恢复页面也不失效。但在新标签或窗口打开一个页面，则会重新生成</li>
</ul>
<h3 id="cookie-与-session-区别"><a href="#cookie-与-session-区别" class="headerlink" title="cookie 与 session 区别"></a>cookie 与 session 区别</h3><p>都是用来确认用户身份的，区别在于 cookie 保存在客户端，session 保存在服务端。</p>
<p>另外，session 是基于 cookie 的。服务器端在生成 session 后，会让客户端的 cookie 代为保存 sessionID 。</p>
<img src="/posts/46105/1550245038963-b61378bb-65db-411e-9069-cf7d2b7a2908.png" class="" title="cookie">

<img src="/posts/46105/1550245194054-9e6b0a42-c09e-4a8b-8e7e-93ba715e6e5a.png" class="" title="session">

<p>阅读：</p>
<ul>
<li><a href="https://segmentfault.com/a/1190000017332168">一文带你看懂 cookie，面试前端不用愁</a></li>
<li><a href="https://juejin.im/post/5b18d322e51d4506cf10af7c">聊一聊 cookie</a></li>
<li><a href="https://segmentfault.com/q/1010000007715137">Cookie 禁用了，Session 还能用吗？</a></li>
<li><a href="https://www.jianshu.com/p/cc951b6a75e3">session,cookie,sessionStorage,localStorage 的区别及应用场景</a></li>
</ul>
<h3 id="如何实现同一个浏览器多个标签页之间的通信？"><a href="#如何实现同一个浏览器多个标签页之间的通信？" class="headerlink" title="如何实现同一个浏览器多个标签页之间的通信？"></a>如何实现同一个浏览器多个标签页之间的通信？</h3><p><strong>1. websocket 通讯</strong></p>
<p>全双工（full-duplex）通信自然可以实现多个标签页之间的通信。</p>
<p><strong>2. 定时器 setInterval+cookie</strong></p>
<p>在页面 A 设置一个使用 setInterval 定时器不断刷新，检查 Cookies 的值是否发生变化，如果变化就进行刷新的操作。</p>
<p><strong>3. 使用 localStorage</strong></p>
<p>localStorage 是浏览器多个标签共用的存储空间，所以可以用来实现多标签之间的通信（ps：session 是会话级的存储空间，每个标签页都是单独的）。</p>
<p>直接在 window 对象上添加监听即可：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.onstorage = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者这样</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&#x27;storage&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">console</span>.log(e));</span><br></pre></td></tr></table></figure>

<h3 id="HTML5-的离线储存使用，解释工作原理？"><a href="#HTML5-的离线储存使用，解释工作原理？" class="headerlink" title="HTML5 的离线储存使用，解释工作原理？"></a>HTML5 的离线储存使用，解释工作原理？</h3><blockquote>
<p>在用户没有与因特网连接时，可以正常访问站点或应用，在用户与因特网连接时，更新用户机器上的缓存文件。 原理：HTML5 的离线存储是基于一个新建的 .appcache 文件的缓存机制(不是存储技术)，通过这个文件上的解析清单离线存储资源，这些资源就会像 cookie 一样被存储了下来。之后当网络在处于离线状态下时，浏览器会通过被离线存储的数据进行页面展示。</p>
</blockquote>
<p>如何使用：</p>
<ol>
<li>页面头部像下面一样加入一个 manifest 的属性</li>
<li>在 cache.manifest 文件的编写离线存储的资源</li>
<li>在离线状态时，操作 window.applicationCache 进行需求实现。</li>
</ol>
<p>详细的使用请参考：</p>
<ul>
<li><a href="http://yanhaijing.com/html/2014/12/28/html5-manifest/">HTML5 离线缓存-manifest 简介</a></li>
<li><a href="http://segmentfault.com/a/1190000000732617">有趣的 HTML5：离线存储</a></li>
</ul>
<h3 id="浏览器对-HTML5-离线储存资源的管理和加载？"><a href="#浏览器对-HTML5-离线储存资源的管理和加载？" class="headerlink" title="浏览器对 HTML5 离线储存资源的管理和加载？"></a>浏览器对 HTML5 离线储存资源的管理和加载？</h3><p>在线的情况下:</p>
<p>浏览器发现 html 头部有 manifest 属性，它会请求 manifest 文件，如果是第一次访问 app ，那么浏览器就会根据 manifest 文件的内容下载相应的资源并且进行离线存储。如果已经访问过 app 并且资源已经离线存储了，那么浏览器就会使用离线的资源加载页面，然后浏览器会对比新的 manifest 文件与旧的 manifest 文件，如果文件没有发生改变，就不做任何操作，如果文件改变了，那么就会重新下载文件中的资源并进行离线存储。</p>
<p>离线的情况下:</p>
<p>浏览器就直接使用离线存储的资源。</p>
<h3 id="用户点外卖的份数怎么和后台通信？万一用户中断了再进了怎么获取？为什么不用-cookie？"><a href="#用户点外卖的份数怎么和后台通信？万一用户中断了再进了怎么获取？为什么不用-cookie？" class="headerlink" title="用户点外卖的份数怎么和后台通信？万一用户中断了再进了怎么获取？为什么不用 cookie？"></a>用户点外卖的份数怎么和后台通信？万一用户中断了再进了怎么获取？为什么不用 cookie？</h3><ul>
<li>将购物车信息存在 localStorage</li>
<li>从 localStorage 中获取</li>
<li>用户禁用 cookie 时无法使用</li>
</ul>
<h2 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h2><h3 id="经常遇到的浏览器的兼容性有哪些？"><a href="#经常遇到的浏览器的兼容性有哪些？" class="headerlink" title="经常遇到的浏览器的兼容性有哪些？"></a>经常遇到的浏览器的兼容性有哪些？</h3><ul>
<li>IE 浏览器不支持 Promise<ul>
<li>babel-polyfill → webpack.config.js 的 entry 中设置 [‘babel-polyfill’, ‘./src/main.js’]</li>
</ul>
</li>
<li>各浏览器之间默认样式的差异<ul>
<li>normalize.css<ul>
<li>与 reset 区别 → normalize.css 消除各浏览器之间默认样式的差异、保留有用的默认样式；而 reset 会清除所有的默认样式，过于暴力，例如会让 h 标题标签不再默认加粗，ul li 前面默认的小圆点也没了）</li>
</ul>
</li>
</ul>
</li>
<li>html5 某些新增标签不被识别<ul>
<li>html5shiv.js - 解决 ie9 以下对 html5 某些新增标签不识别的问题（e.g. video 标签不识别不显示）<ul>
<li>用法：<code>[if lt IE 9]&gt;&lt;script&gt; src=&quot;http://html5shim.googlecode.com/svn/trunk/html5.js&quot;&lt;/script&gt;&lt;![endif]</code></li>
</ul>
</li>
<li>通过 document.createElement 方法产生的标签， 可以利用这一特性让这些浏览器支持 HTML5 新标签，浏览器支持新标签后，还需要添加标签默认的样式。</li>
</ul>
</li>
<li>CSS3 媒体查询失效<ul>
<li>respond.js - 能解决 ie9 以下不支持媒体查询问题</li>
</ul>
</li>
<li>自动添加浏览器前缀<ul>
<li>posscss-loader+autoprefixer</li>
</ul>
</li>
<li>ie6 不支持 min-height/width<ul>
<li>添加额外的 <code>_min-height</code> ie6 识别</li>
</ul>
</li>
<li>常见 hack（针对特定 ie 版本的样式控制）<ul>
<li>_color - ie6 识别</li>
<li>*color - ie6/7 识别</li>
<li>color: red\9; ie8 及以下识别</li>
</ul>
</li>
<li>ie 条件注释写法：(lt 小于 | gt 大于 | lte 小于等于 | gte 大于等于 | ! 不等于)</li>
</ul>
<h3 id="移动端兼容性呢？"><a href="#移动端兼容性呢？" class="headerlink" title="移动端兼容性呢？"></a>移动端兼容性呢？</h3><ul>
<li>移动端点透问题<ul>
<li><a href="https://www.cnblogs.com/zhuzhenwei918/p/7588553.html">解决方案</a></li>
</ul>
</li>
<li>ios 滚动卡顿<ul>
<li>使用 better-scroll 插件</li>
</ul>
</li>
<li>ios 顶部输入框 fixed 布局失效（当键盘弹起时）❌</li>
<li>安卓 键盘遮挡输入框 ❌</li>
</ul>
<h4 id="position-fixed-在-android-下无效怎么处理？【❌-待验证】"><a href="#position-fixed-在-android-下无效怎么处理？【❌-待验证】" class="headerlink" title="position:fixed; 在 android 下无效怎么处理？【❌ 待验证】"></a>position:fixed; 在 android 下无效怎么处理？【❌ 待验证】</h4><p>原因：</p>
<p>fixed 的元素是相对整个页面固定位置的，你在屏幕上滑动只是在移动这个所谓的 viewport ，<br>原来的网页还好好的在那，fixed 的内容也没有变过位置。</p>
<p>解决：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;meta</span><br><span class="line">  name=&quot;viewport&quot;</span><br><span class="line">  content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<h4 id="移动端的点击事件的有延迟，时间是多久，为什么会有？-怎么解决这个延时？❌"><a href="#移动端的点击事件的有延迟，时间是多久，为什么会有？-怎么解决这个延时？❌" class="headerlink" title="移动端的点击事件的有延迟，时间是多久，为什么会有？ 怎么解决这个延时？❌"></a>移动端的点击事件的有延迟，时间是多久，为什么会有？ 怎么解决这个延时？❌</h4><p>click 有 300ms 延迟,为了实现 safari 的双击事件的设计，浏览器要知道你是不是要双击操作。</p>
<h4 id="在做移动端项目时遇到过什么问题？"><a href="#在做移动端项目时遇到过什么问题？" class="headerlink" title="在做移动端项目时遇到过什么问题？"></a>在做移动端项目时遇到过什么问题？</h4><p>参考阅读：<a href="https://juejin.im/post/5aa8b00c51882555627cfa0e">H5 与 APP 混合开发遇到的问题总结</a></p>
<h3 id="Polyfill"><a href="#Polyfill" class="headerlink" title="Polyfill"></a>Polyfill</h3><h4 id="什么是-Polyfill"><a href="#什么是-Polyfill" class="headerlink" title="什么是 Polyfill"></a>什么是 Polyfill</h4><p>polyfill 是“在旧版浏览器上复制标准 API 的 JavaScript 补充”,可以动态地加载 JavaScript 代码或库，在不支持这些标准 API 的浏览器中模拟它们。</p>
<p>例如，geolocation（地理位置）polyfill 可以在 navigator 对象上添加全局的 geolocation 对象，还能添加 getCurrentPosition 函数以及“坐标”回调对象，<br>所有这些都是 W3C 地理位置 API 定义的对象和函数。</p>
<p>因为 polyfill 模拟标准 API，所以能够以一种面向所有浏览器未来的方式针对这些 API 进行开发，<br>一旦对这些 API 的支持变成绝对大多数，则可以方便地去掉 polyfill，无需做任何额外工作。</p>
<h4 id="做的项目中，有没有用过或自己实现一些-polyfill-方案（兼容性处理方案）？❌"><a href="#做的项目中，有没有用过或自己实现一些-polyfill-方案（兼容性处理方案）？❌" class="headerlink" title="做的项目中，有没有用过或自己实现一些 polyfill 方案（兼容性处理方案）？❌"></a>做的项目中，有没有用过或自己实现一些 polyfill 方案（兼容性处理方案）？❌</h4><p>比如： html5shiv、Geolocation、Placeholder</p>
<h3 id="列举-IE-与其他浏览器不一样的特性？"><a href="#列举-IE-与其他浏览器不一样的特性？" class="headerlink" title="列举 IE 与其他浏览器不一样的特性？"></a>列举 IE 与其他浏览器不一样的特性？</h3><h4 id="事件目标对象"><a href="#事件目标对象" class="headerlink" title="事件目标对象"></a>事件目标对象</h4><p>触发事件的元素被认为是目标（target）。而在 IE 中，目标包含在 event 对象的 srcElement 属性</p>
<h4 id="获取字符代码"><a href="#获取字符代码" class="headerlink" title="获取字符代码"></a>获取字符代码</h4><p>如果按键代表一个字符（shift、ctrl、alt 除外），IE 的 keyCode 会返回字符代码（Unicode），DOM 中按键的代码和字符是分离的，要获取字符代码，需要使用 charCode 属性</p>
<h4 id="阻止某个事件的默认行为"><a href="#阻止某个事件的默认行为" class="headerlink" title="阻止某个事件的默认行为"></a>阻止某个事件的默认行为</h4><p>IE 中阻止某个事件的默认行为，必须将 returnValue 属性设置为 false，Mozilla 中，需要调用 preventDefault() 方法</p>
<h4 id="停止事件冒泡"><a href="#停止事件冒泡" class="headerlink" title="停止事件冒泡"></a>停止事件冒泡</h4><p>IE 中阻止事件进一步冒泡，需要设置 cancelBubble 为 true，Mozzilla 中，需要调用 stopPropagation()</p>
<h2 id="通信"><a href="#通信" class="headerlink" title="通信"></a>通信</h2><h3 id="如何实现浏览器内多个标签页之间的通信-阿里"><a href="#如何实现浏览器内多个标签页之间的通信-阿里" class="headerlink" title="如何实现浏览器内多个标签页之间的通信? (阿里)"></a>如何实现浏览器内多个标签页之间的通信? (阿里)</h3><p>WebSocket、SharedWorker；</p>
<p>也可以调用 localStorage 、cookies 等本地存储方式；</p>
<p>localStorage 另一个浏览上下文里被添加、修改或删除时，它都会触发一个事件， 我们通过监听事件，控制它的值来进行页面信息通信；</p>
<p>注意：Safari 在无痕模式下设置 localStorage 值时会抛出 QuotaExceededError 的异常；</p>
<h3 id="webSocket-如何兼容低浏览器？-阿里"><a href="#webSocket-如何兼容低浏览器？-阿里" class="headerlink" title="webSocket 如何兼容低浏览器？(阿里)"></a>webSocket 如何兼容低浏览器？(阿里)</h3><p>Adobe Flash Socket 、 ActiveX HTMLFile (IE) 、 基于 multipart 编码发送 XHR 、 基于长轮询的 XHR</p>
<h2 id="页面渲染与缓存"><a href="#页面渲染与缓存" class="headerlink" title="页面渲染与缓存"></a>页面渲染与缓存</h2><h3 id="从输入-URL-到页面展现中间发生了什么？"><a href="#从输入-URL-到页面展现中间发生了什么？" class="headerlink" title="从输入 URL 到页面展现中间发生了什么？"></a>从输入 URL 到页面展现中间发生了什么？</h3><ol>
<li><p>DNS 查询</p>
</li>
<li><p>建立 TCP 连接（三次握手）</p>
</li>
<li><p>发送 HTTP 请求</p>
</li>
<li><p>服务端 web 服务器对请求做处理（监听 80 端口 路由 渲染 HTML 模板 生成响应）</p>
</li>
<li><p>发送 HTTP 响应</p>
</li>
<li><p>关闭 TCP 连接（四次挥手）</p>
</li>
<li><p>浏览器解析 HTML，CSS，图片，JS</p>
<ol>
<li><p>处理 HTML 标记并构建 DOM 树</p>
</li>
<li><p>处理 CSS 标记并构建 CSS 规则树</p>
</li>
<li><p>将 DOM 树 与 CSS 规则树 合并成一个渲染树。</p>
</li>
<li><p>根据渲染树来布局，以计算每个节点的几何信息。</p>
</li>
<li><p>将各个节点绘制到屏幕上</p>
<blockquote>
<p>这五个步骤并不一定一次性顺序完成。如果 DOM 或 CSSOM 被修改，以上过程需要重复执行，这样才能计算出哪些像素需要在屏幕上进行重新渲染。实际页面中，CSS 与 JavaScript 往往会多次修改 DOM 和 CSSOM</p>
</blockquote>
</li>
</ol>
</li>
</ol>
<p>阅读更多：</p>
<ul>
<li><a href="https://juejin.im/entry/59e1d31f51882578c3411c77">浏览器的渲染：过程与原理</a></li>
<li><a href="https://www.xuecaijie.com/it/157.html">细说浏览器输入 URL 后发生了什么</a></li>
</ul>
<h3 id="style-标签写在-body-后与-body-前（head）有什么区别？"><a href="#style-标签写在-body-后与-body-前（head）有什么区别？" class="headerlink" title="style 标签写在 body 后与 body 前（head）有什么区别？"></a>style 标签写在 body 后与 body 前（head）有什么区别？</h3><p>style 标签放在 body 后，会导致当加载到此样式时，页面将停止之前的渲染。此样式表被解析后，将重新渲染页面，也就出现了短暂的花屏现象。</p>
<p>所以不要写在 body 后，要把样式放在 head 中。</p>
<h3 id="缓存策略执行过程"><a href="#缓存策略执行过程" class="headerlink" title="缓存策略执行过程"></a>缓存策略执行过程</h3><img src="/posts/46105/1549091602173-872e7ae7-1532-4933-a7e6-4f53f2e9ceb8.jpeg" class="" title="http缓存策略">

<h4 id="一个-Response-Header-示例"><a href="#一个-Response-Header-示例" class="headerlink" title="一个 Response Header 示例"></a>一个 Response Header 示例</h4><img src="/posts/46105/1549091477928-50957a41-1e84-437f-8f6e-992f430730f4.jpeg" class="" title="res-header">

<h3 id="强缓存与协商缓存的异同"><a href="#强缓存与协商缓存的异同" class="headerlink" title="强缓存与协商缓存的异同"></a>强缓存与协商缓存的异同</h3><ul>
<li>相同点：最终都是走的本地缓存</li>
<li>不同点：强缓存不发请求，直接读本地缓存。协商缓存发请求到服务器</li>
</ul>
<h4 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h4><ul>
<li>1）浏览器在加载资源时，根据请求头的 <code>expires</code> 和 <code>cache-control</code> 判断是否命中强缓存，是则直接从缓存读取资源，不会发请求到服务器。</li>
<li>2）如果没有命中强缓存，浏览器一定会发送一个请求到服务器，通过 <code>last-modified</code> 和 <code>Etag</code> 验证资源是否命中协商缓存，如果命中，服务器会将这个请求返回，但是不会返回这个资源的数据，依然是从缓存中读取资源</li>
<li>3）如果前面两者都没有命中，直接从服务器加载资源</li>
</ul>
<img src="/posts/46105/1550494473608-b1c458fe-f534-4674-ba30-32fc27deffd6.jpeg" class="" title="强缓存vs协商缓存">

<h3 id="如何实现页面每次打开时清除本页缓存？"><a href="#如何实现页面每次打开时清除本页缓存？" class="headerlink" title="如何实现页面每次打开时清除本页缓存？"></a>如何实现页面每次打开时清除本页缓存？</h3><ol>
<li>用 HTML 标签设置 HTTP 头信息：</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Pragma&quot;</span> <span class="attr">content</span>=<span class="string">&quot;no-cache&quot;</span> /&gt;</span></span><br><span class="line">header(&quot;Cache-Control: no-cache, must-revalidate&quot;)</span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Cache-Control&quot;</span> <span class="attr">content</span>=<span class="string">&quot;no-cache&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Expires&quot;</span> <span class="attr">content</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>说明：HTTP 头信息 Expires 和 Cache-Control 为应用程序服务器提供了一个控制浏览器和代理服务器上缓存的机制。</p>
<p>HTTP 头信息 Expires 告诉代理服务器它的缓存页面何时将过期。</p>
<p>HTTP1.1 规范中新定义的头信息 Cache-Control 可以通知浏览器不缓存任何页面。当点击后退按钮时，浏览器重新访问服务器已获取页面。</p>
<p>如下是使用 Cache-Control 的基本方法：</p>
<p>1）no-cache：强制缓存从服务器上获取新的页面；</p>
<p>2）no-store：在任何环境下缓存不保存任何页面。</p>
<p>HTTP1.0 规范中的 Pragma: no-cache 等同于 HTTP1.1 规范中的 Cache-Control: no-cache，同样可以包含在头信息中。</p>
<ol>
<li>在需要打开的 url 后面增加一个随机的参数：<br>增加参数前：url=test/test.jsp<br>增加参数后：url=test/test.jsp?ranparam=random()</li>
</ol>
<h3 id="expires-和-cache-control-的区别"><a href="#expires-和-cache-control-的区别" class="headerlink" title="expires 和 cache-control 的区别"></a>expires 和 cache-control 的区别</h3><p>都是用的本地系统时间，但</p>
<ul>
<li>expires 存的是个服务端绝对时间，修改客户端系统时间会有影响</li>
<li>cache-control 是相对时间，即使客户端时间发生改变，相对时间也不会随之改变。例如设置 max-age = 10s，那么在 10s 以内，使用浏览器缓存的资源</li>
<li>cache-control 的优先级高于 expires</li>
</ul>
<h3 id="http-get-和-post-区别"><a href="#http-get-和-post-区别" class="headerlink" title="http get 和 post 区别"></a>http get 和 post 区别</h3><ol>
<li>语义：GET 用来读数据，POST 用来写数据</li>
<li>参数：GET 放在 url 里，POST 放消息体里</li>
<li>大小：GET 长度有限制，一般 1024 个字符。POST 4~10Mb 限制</li>
<li>缓存：GET 请求可以被浏览器缓存，POST 不能</li>
</ol>
<h3 id="cache-control-和-Etag-的区别"><a href="#cache-control-和-Etag-的区别" class="headerlink" title="cache-control 和 Etag 的区别"></a>cache-control 和 Etag 的区别</h3><p>一个不发请求，一个发请求。超过缓存时间，只要 if-None-Match 和服务器端 etag 相同，仍然缓存。并且 Etag 比 cache-control 的优先级更高。</p>
<h3 id="http-和-https-的区别"><a href="#http-和-https-的区别" class="headerlink" title="http 和 https 的区别"></a>http 和 https 的区别</h3><h4 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h4><blockquote>
<p>是以安全为目标的 HTTP 通道，简单讲是 HTTP 的安全版，即 HTTP 下加入 SSL 层，HTTPS 的安全基础是 SSL，因此加密的详细内容就需要 SSL。</p>
</blockquote>
<h4 id="HTTPS-作用"><a href="#HTTPS-作用" class="headerlink" title="HTTPS 作用"></a>HTTPS 作用</h4><ul>
<li>一种是建立一个信息安全通道，来保证数据传输的安全</li>
<li>另一种就是确认网站的真实性。</li>
</ul>
<h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><ul>
<li>https 协议需要到 ca 申请证书，有免费付费可选</li>
<li>http 是明文传输，https 则是具有安全性的 ssl 加密传输协议。<ul>
<li>非对称加密</li>
</ul>
</li>
<li>性能问题：https 做了加密就意味着客户端服务端也需要附带解密步骤，相比来说，在通讯快捷上，性能有所不如 http 。</li>
</ul>
<h4 id="对非对称性加密的理解"><a href="#对非对称性加密的理解" class="headerlink" title="对非对称性加密的理解"></a>对非对称性加密的理解</h4><blockquote>
<p>不要去硬记。 你只要想：既然是加密，那肯定是不希望别人知道我的消息，所以只有我才能解密，所以可得出<strong>公钥负责加密，私钥负责解密</strong>；同理，既然是签名，那肯定是不希望有人冒充我发消息，只有我才能发布这个签名，所以可得出<strong>私钥负责签名，公钥负责验证</strong>。</p>
</blockquote>
<p>参考：</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/37738632">非对称加密与 HTTPS</a></li>
<li><a href="https://github.com/fi3ework/blog/issues/17">完全理解 HTTPS 如何做到传输安全</a></li>
</ul>
<h4 id="介绍-HTTPS-握手过程"><a href="#介绍-HTTPS-握手过程" class="headerlink" title="介绍 HTTPS 握手过程"></a>介绍 HTTPS 握手过程</h4><ol>
<li>客户端使用 https 的 url 访问 web 服务器,要求与服务器建立 ssl 连接</li>
<li>web 服务器收到客户端请求后, 会将网站的证书(包含公钥)传送一份给客户端</li>
<li>客户端收到网站证书后会检查证书的颁发机构以及过期时间, 如果没有问题就随机产生一个秘钥</li>
<li>客户端利用公钥将会话秘钥加密, 并传送给服务端, 服务端利用自己的私钥解密出会话秘钥</li>
<li>之后服务器与客户端使用秘钥加密传输</li>
</ol>
<p>参考来源：</p>
<ul>
<li><a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/70#issuecomment-478214738">第 44 题：介绍 HTTPS 握手过程</a></li>
</ul>
<p>阅读更多：</p>
<ul>
<li><a href="https://developers.weixin.qq.com/community/develop/article/doc/000046a5fdc7802a15f7508b556413">一次安全可靠的通信——HTTPS 原理</a></li>
</ul>
<h3 id="HTTP1-1-与-HTTP2-的区别"><a href="#HTTP1-1-与-HTTP2-的区别" class="headerlink" title="HTTP1.1 与 HTTP2 的区别"></a>HTTP1.1 与 HTTP2 的区别</h3><ul>
<li>基于 HTTPS 的</li>
<li>多路复用</li>
<li>服务端推送</li>
</ul>
<h4 id="简单讲解一下-http2-的多路复用"><a href="#简单讲解一下-http2-的多路复用" class="headerlink" title="简单讲解一下 http2 的多路复用"></a>简单讲解一下 http2 的多路复用</h4><p>阅读更多：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/14">多路复用</a></p>
<p>HTTP2 采用二进制格式传输，取代了 HTTP1.x 的文本格式，二进制格式解析更高效。</p>
<p>多路复用代替了 HTTP1.x 的序列和阻塞机制，所有的相同域名请求都通过同一个 TCP 连接并发完成。在 HTTP1.x 中，并发多个请求需要多个 TCP 连接，浏览器为了控制资源会有 6-8 个 TCP 连接都限制。</p>
<p>HTTP2 中：</p>
<ul>
<li>同域名下所有通信都在单个连接上完成，消除了因多个 TCP 连接而带来的延时和内存消耗。</li>
<li>单个连接上可以并行交错的请求和响应，之间互不干扰。</li>
</ul>
<p>阅读更多：</p>
<ul>
<li><a href="https://juejin.im/entry/5981c5df518825359a2b9476">HTTP1.0、HTTP1.1 和 HTTP2.0 的区别</a></li>
</ul>
<h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><h3 id="你有用过哪些前端性能优化的方法？"><a href="#你有用过哪些前端性能优化的方法？" class="headerlink" title="你有用过哪些前端性能优化的方法？"></a>你有用过哪些前端性能优化的方法？</h3><h4 id="资源合并压缩"><a href="#资源合并压缩" class="headerlink" title="资源合并压缩"></a>资源合并压缩</h4><ul>
<li>压缩<ul>
<li>html，css，js【html-webpack/optimize-css-assets/webpack-parallel-uglify】-plugin</li>
<li>图片：image-webpack-loader，雪碧图，iconfont 图标字体</li>
</ul>
</li>
<li>合并<ul>
<li>减少 http 请求，每个 http 请求都带来慢启动，三次握手，连接建立，所以资源合并由为重要</li>
</ul>
</li>
<li>服务端启用 gzip（压缩率 80%）<ul>
<li>浏览器请求 header 设置 accept-encoding: gzip</li>
<li>服务器响应 header 返回 content-encoding: gzip【apache 的 httpd.conf】</li>
</ul>
</li>
</ul>
<h4 id="浏览器加载原理优化"><a href="#浏览器加载原理优化" class="headerlink" title="浏览器加载原理优化"></a>浏览器加载原理优化</h4><p>原理：html 在转 DOM 时，节点引用 css/img 不影响继续转化，但 js 会阻塞，因为 js 有可能修改 dom 树</p>
<ul>
<li>css 放 head</li>
<li>js 尽量不放 head，如果放则 js 内嵌，且在所有 css 前面 | 对于会阻塞后续内容的外部 js ，用 defer</li>
<li>首屏优化<ul>
<li>懒加载：列表滚动图片懒加载</li>
<li>按需加载 webpack codespliting</li>
</ul>
</li>
<li>使用 cdn 加速：把静态资源（能被浏览器缓存的 js/css）分发到离用户最近节点就近获取，提高响应速度和成功率</li>
</ul>
<h3 id="缓存优化"><a href="#缓存优化" class="headerlink" title="缓存优化"></a>缓存优化</h3><ul>
<li>http 协议缓存：强缓存/协商缓存</li>
<li>使用浏览器缓存来减少请求数量<ul>
<li>css，js 加 MD5 后缀</li>
<li>本地存储 localStorage （地理位置，购物车）</li>
</ul>
</li>
<li>app cache ❌</li>
<li>service worker ❌</li>
</ul>
<h3 id="渲染优化"><a href="#渲染优化" class="headerlink" title="渲染优化"></a>渲染优化</h3><ul>
<li>减少重绘和重排<ul>
<li>集中改变样式（cssText，类名切换）</li>
<li>批量修改 DOM（display:none，createDocumentFragment）</li>
<li>读写分离（尽量不要一行代码又读又写 div.style.left = div.offsetLeft + 1 + ‘px’; &lt;=重复两次就是两次重排，先存起来就只会导致一次重排）</li>
</ul>
</li>
<li>动画<ul>
<li>css3 动画<ul>
<li>webkit-transform: translateZ(0); / will-change: transform;<ul>
<li>GPU 渲染，浏览器生成 DOM 元素快照，在 GPU 的层上缓存起来做单独做动画</li>
</ul>
</li>
</ul>
</li>
<li>js 动画<ul>
<li>使用 requestAnimationFrame 提升流畅度（确保 js 尽早在每一帧开始时执行）</li>
</ul>
</li>
</ul>
</li>
<li>列表滚动重用（类似 ios cell 复用）❌</li>
<li>使用 SSR（server side rendering）后端渲染，数据直接输出到 HTML ❌</li>
</ul>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="检测浏览器版本版本有哪些方式？"><a href="#检测浏览器版本版本有哪些方式？" class="headerlink" title="检测浏览器版本版本有哪些方式？"></a>检测浏览器版本版本有哪些方式？</h3><p>功能检测、userAgent 特征检测</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">比如：navigator.userAgent</span><br><span class="line"><span class="comment">//&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/537.36</span></span><br><span class="line">(KHTML, like Gecko) Chrome/<span class="number">41.0</span><span class="number">.2272</span><span class="number">.101</span> Safari/<span class="number">537.36</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="判断用户的浏览器类型"><a href="#判断用户的浏览器类型" class="headerlink" title="判断用户的浏览器类型"></a>判断用户的浏览器类型</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAndroid</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/Android/</span>.test(navigator.userAgent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isiPhone</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/iPhone/</span>.test(navigator.userAgent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isiPad</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/iPad/</span>.test(navigator.userAgent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isiOS</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/(iPhone)|(iPad)/i</span>.test(navigator.userAgent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="介绍一下你对浏览器内核的理解"><a href="#介绍一下你对浏览器内核的理解" class="headerlink" title="介绍一下你对浏览器内核的理解"></a>介绍一下你对浏览器内核的理解</h3><p>主要分成两部分：</p>
<p>渲染引擎(Layout engineer 或 Rendering Engine)和 JS 引擎。</p>
<ul>
<li>渲染引擎：负责取得网页的内容（HTML、XML、图像等等）、整理讯息（例如加入 CSS 等），以及计算网页的显示方式，然后会输出至显示器或打印机。浏览器的内核的不同对于网页的语法解释会有不同，所以渲染的效果也不相同。所有网页浏览器、电子邮件客户端以及其它需要编辑、显示网络内容的应用程序都需要内核。</li>
<li>JS 引擎则：解析和执行 javascript 来实现网页的动态效果。 最开始渲染引擎和 JS 引擎并没有区分的很明确，后来 JS 引擎越来越独立，内核就倾向于只指渲染引擎。</li>
</ul>
<blockquote>
<p>详细文章：<a href="http://www.cnblogs.com/fullhouse/archive/2011/12/19/2293455.html">浏览器内核的解析和对比</a></p>
</blockquote>
<h3 id="常见状态码"><a href="#常见状态码" class="headerlink" title="常见状态码"></a>常见状态码</h3><p>形象记忆：<a href="https://http.cat/">https://http.cat/</a></p>
<ul>
<li>200 服务器成功返回请求</li>
<li>301 永久重定向，浏览器会记住 | 302 临时重定向 | 304 请求页面未修改</li>
<li>400 请求错误，服务器不理解 | 401 请求未授权 | 403 服务器拒绝请求 | 404 资源不存在 | 405 方法禁用</li>
<li>500 服务器内部错误 | 503 服务暂时不可用（超载 or 停机维护）</li>
</ul>
<h3 id="谈谈你对-TCP-三次握手和四次挥手的理解"><a href="#谈谈你对-TCP-三次握手和四次挥手的理解" class="headerlink" title="谈谈你对 TCP 三次握手和四次挥手的理解"></a>谈谈你对 TCP 三次握手和四次挥手的理解</h3><img src="/posts/46105/53062591-3d846300-34fc-11e9-8d0f-4063d9ff3398.png" class="" title="answer">

<p><a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/15">答案地址</a></p>
<h3 id="页面可见性-Page-Visibility-API-有哪些用途"><a href="#页面可见性-Page-Visibility-API-有哪些用途" class="headerlink" title="页面可见性(Page Visibility API)有哪些用途"></a>页面可见性(Page Visibility API)有哪些用途</h3><ul>
<li>通过 visibilityState 的值检测页面当前是否可见，以及打开网页的时间等;</li>
<li>在页面被切换到其他后台进程的时候，自动暂停音乐或视频的播放；</li>
</ul>
<h3 id="网页验证码干嘛的-是为了解决什么安全问题"><a href="#网页验证码干嘛的-是为了解决什么安全问题" class="headerlink" title="网页验证码干嘛的,是为了解决什么安全问题"></a>网页验证码干嘛的,是为了解决什么安全问题</h3><p>区分用户是计算机还是人的公共全自动程序。可以防止恶意破解密码、刷票、论坛灌水；<br>有效防止黑客对某一个特定注册用户用特定程序暴力破解方式进行不断的登陆尝试。</p>
<h3 id="如果需要手动写动画，你认为最小时间间隔是多久，为什么？"><a href="#如果需要手动写动画，你认为最小时间间隔是多久，为什么？" class="headerlink" title="如果需要手动写动画，你认为最小时间间隔是多久，为什么？"></a>如果需要手动写动画，你认为最小时间间隔是多久，为什么？</h3><p>多数显示器默认频率是 60Hz，即 1 秒刷新 60 次，所以理论上最小间隔为 1/60＊1000ms ＝ 16.7ms</p>
<h3 id="第一次访问页面中时弹出引导，用户关闭引导，之后再次进入页面时不希望出现引导，如何实现？❌"><a href="#第一次访问页面中时弹出引导，用户关闭引导，之后再次进入页面时不希望出现引导，如何实现？❌" class="headerlink" title="第一次访问页面中时弹出引导，用户关闭引导，之后再次进入页面时不希望出现引导，如何实现？❌"></a>第一次访问页面中时弹出引导，用户关闭引导，之后再次进入页面时不希望出现引导，如何实现？❌</h3><p>localStorage</p>
<h3 id="实现一个页面操作不会整页刷新的网站，并且能在浏览器的前进，后退时正确响应。给出你的技术实现方案？"><a href="#实现一个页面操作不会整页刷新的网站，并且能在浏览器的前进，后退时正确响应。给出你的技术实现方案？" class="headerlink" title="实现一个页面操作不会整页刷新的网站，并且能在浏览器的前进，后退时正确响应。给出你的技术实现方案？"></a>实现一个页面操作不会整页刷新的网站，并且能在浏览器的前进，后退时正确响应。给出你的技术实现方案？</h3><ul>
<li>onhashchange</li>
<li>window.history.pushState（添加新的历史记录）/replaceState(state,title, url)【改掉当前历史记录】<ul>
<li>配合 onpopstate 事件来监听历史记录的改变</li>
</ul>
</li>
</ul>
<h3 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h3><p>实现了客户端与服务端之间的全双工通信，当服务端数据变化时，可以第一时间通知到客户端。</p>
<h4 id="与-HTTP-的区别"><a href="#与-HTTP-的区别" class="headerlink" title="与 HTTP 的区别"></a>与 HTTP 的区别</h4><ul>
<li>http 只能由客户端发起，而 webSocket 是双向的</li>
<li>webSocket 传输的数据包相对于 http 而言很小，很适合移动端使用</li>
<li>没有同源限制，可以跨域共享资源</li>
</ul>
<h3 id="TCP-和-UDP"><a href="#TCP-和-UDP" class="headerlink" title="TCP 和 UDP"></a>TCP 和 UDP</h3><h4 id="TCP（Transmission-Control-Protocol，传输控制协议）"><a href="#TCP（Transmission-Control-Protocol，传输控制协议）" class="headerlink" title="TCP（Transmission Control Protocol，传输控制协议）"></a>TCP（Transmission Control Protocol，传输控制协议）</h4><p>是面向连接的协议，也就是说，在收发数据前，必须和对方建立可靠的连接。 一个 TCP 连接必须要经过三次“对话”才能建立起来</p>
<h5 id="TCP-三次握手过程"><a href="#TCP-三次握手过程" class="headerlink" title="TCP 三次握手过程"></a>TCP 三次握手过程</h5><ul>
<li>第一次握手：主机 A 通过向主机 B 发送一个含有同步序列号的标志位的数据段给主机 B ，向主机 B 请求建立连接，通过这个数据段， 主机 A 告诉主机 B 两件事：我想要和你通信；你可以用哪个序列号作为起始数据段来回应我。</li>
<li>第二次握手：主机 B 收到主机 A 的请求后，用一个带有确认应答（ACK）和同步序列号（SYN）标志位的数据段响应主机 A，也告诉主机 A 两件事：我已经收到你的请求了，你可以传输数据了；你要用那个序列号作为起始数据段来回应我</li>
<li>第三次握手：主机 A 收到这个数据段后，再发送一个确认应答，确认已收到主机 B 的数据段：”我已收到回复，我现在要开始传输实际数据了，这样 3 次握手就完成了，主机 A 和主机 B 就可以传输数据了。</li>
</ul>
<h4 id="TCP-断开连接要进行-4-次"><a href="#TCP-断开连接要进行-4-次" class="headerlink" title="TCP 断开连接要进行 4 次"></a>TCP 断开连接要进行 4 次</h4><ul>
<li>第一次： 当主机 A 完成数据传输后,将控制位 FIN 置 1，提出停止 TCP 连接的请求 ；</li>
<li>第二次： 主机 B 收到 FIN 后对其作出响应，确认这一方向上的 TCP 连接将关闭,将 ACK 置 1；</li>
<li>第三次： 由 B 端再提出反方向的关闭请求，将 FIN 置 1 ；</li>
<li>第四次： 主机 A 对主机 B 的请求进行确认，将 ACK 置 1 ，双方向的关闭结束。</li>
</ul>
<h4 id="UDP（User-Data-Protocol，用户数据报协议）"><a href="#UDP（User-Data-Protocol，用户数据报协议）" class="headerlink" title="UDP（User Data Protocol，用户数据报协议）"></a>UDP（User Data Protocol，用户数据报协议）</h4><p>UDP 是一个非连接的协议，传输数据之前源端和终端不建立连接， 当它想传送时就简单地去抓取来自应用程序的数据，并尽可能快地把它扔到网络上。</p>
<h4 id="TCP-与-UDP-的区别"><a href="#TCP-与-UDP-的区别" class="headerlink" title="TCP 与 UDP 的区别"></a>TCP 与 UDP 的区别</h4><p>1、TCP 面向连接；UDP 不面向连接；</p>
<p>2、TCP 传输可靠（三次握手），UDP 则不可靠，不保证正确性（UDP 传送数据前并不与对方建立连接，对接收到的数据也不发送确认信号，发送端不知道数据是否会正确接收，当然也不用重发）；</p>
<p>3、UDP 开销小，传输快；</p>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>TCP：效率要求相对低，但对准确性要求相对高的场景（文件传输，邮件接收，远程登录）</li>
<li>UDP：效率要求相对高，但对准确性要求相对低的场景（在线视频，语音电话）</li>
</ul>
<p>参考：<a href="https://zhuanlan.zhihu.com/p/24860273">TCP 和 UDP 的区别</a></p>
<h3 id="网络七层协议"><a href="#网络七层协议" class="headerlink" title="网络七层协议"></a>网络七层协议</h3><img src="/posts/46105/1550471555226-f1590db6-b11b-4e76-8eb5-9fed21299719.png" class="" title="七层模型">

<p>参考：<a href="https://blog.csdn.net/taotongning/article/details/81352985">OSI 七层协议大白话解读</a></p>
<h3 id="CDN-是什么"><a href="#CDN-是什么" class="headerlink" title="CDN 是什么"></a>CDN 是什么</h3><p>Content Delivery Network，简称 CDN，翻译成中文是内容分发网络。</p>
<p>CDN 是通过在网络上的各个地方放置一定数量的节点服务器，构成在现有的互联网基础之上的一层智能虚拟网络，这层网络的主要功能是将信息（源站内容）分发至靠近用户的各个节点服务器上，让用户可以就近获取所需信息。</p>
<p>通过 CDN，可以有效降低源站的访问压力，减轻骨干网络的拥塞，提升用户的访问速度，从而提升用户体验。还可在一定程度上保障源站的安全。</p>
<p>CDN 的用途可以说很窄，也可以说很广。说窄是因为 CDN 只是基于互联网之上的一种服务，只是给网络/网站加速的；说广是因为几乎所有的互联网业务（如网页、电商、APP、游戏、下载、影视点播、直播等等）都需要用到 CDN ，而如今互联网又无处不在。</p>
<p>来源：<a href="https://www.zhihu.com/question/282510029/answer/427307826">https://www.zhihu.com/question/282510029/answer/427307826</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>网站性能优化</title>
    <url>/posts/41624/</url>
    <content><![CDATA[<h1 id="关键渲染路径"><a href="#关键渲染路径" class="headerlink" title="关键渲染路径"></a>关键渲染路径</h1><h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><p>关键渲染路径（Critical Rendering Path）指的是：<br>「浏览器所经历的一系列步骤，从而将 HTML、CSS 和 JavaScript 转换为在屏幕上呈现的像素内容」<br>我们要做的，就是<strong>优化关键渲染路径</strong>，这样就能提高网页呈现的速度，从而使用户和老板更满意。</p>
<h2 id="网页生成过程"><a href="#网页生成过程" class="headerlink" title="网页生成过程"></a>网页生成过程</h2><p>说白了，「关键渲染路径」即「网页生成的过程」，简要概述就是：</p>
<ol>
<li>处理 HTML 标记并构建 DOM 树</li>
<li>处理 CSS 标记并构建 CSSOM 树</li>
<li>将 DOM 与 CSSOM 合并成一个渲染树</li>
<li>根据渲染树来布局，以计算每个节点的几何信息</li>
<li>将各个节点绘制到屏幕上</li>
</ol>


<a id="more"></a>

<h3 id="将-HTML-转为-DOM"><a href="#将-HTML-转为-DOM" class="headerlink" title="将 HTML 转为 DOM"></a>将 HTML 转为 DOM</h3><p>文档对象模型（DOM）存储的是「页面内容」及每个节点「属性方面的数据」。DOM 中对象之间的关系展示了父子节点以及兄弟节点。</p>
<p><strong>注意</strong>：<br>DOM 的构建过程是逐步实现的，意味着一旦获得了 HTML 就可以开始构建 DOM 了，<strong>不需要</strong>等待整个 HTML 页面加载完毕后再去构建 DOM 。</p>


<h3 id="将-CSS-转为-CSSOM"><a href="#将-CSS-转为-CSSOM" class="headerlink" title="将 CSS 转为 CSSOM"></a>将 CSS 转为 CSSOM</h3>

<h3 id="合并渲染树"><a href="#合并渲染树" class="headerlink" title="合并渲染树"></a>合并渲染树</h3><p>完成了 DOM 树和 CSSOM 树的构建以后，就要将它们合并成一个渲染树。</p>
<p><strong>注意：</strong><br>某些节点如果通过 CSS 隐藏，那么在渲染树中也会被忽略，例如我们在 HTML 中编写的 span 节点，它就不会出现在渲染树中。因为有一个 CSS 规则在 span 上设置了 <code>display: none</code> 属性。</p>


<h3 id="布局与绘制"><a href="#布局与绘制" class="headerlink" title="布局与绘制"></a>布局与绘制</h3><p>在渲染树构建阶段，我们已经计算了哪些节点应该是可见的以及它们的计算样式，所以在布局阶段，我们就需要计算它们在设备视口内的确切位置和大小。这个过程称为布局，或者叫做重排。</p>
<p>最后，既然我们知道了哪些节点可见、它们的计算样式以及几何信息，我们终于可以将这些信息传递给最后一个阶段：将渲染树中的每个节点转换成屏幕上的实际像素。这一步通常称为“绘制”或“栅格化”。到此，浏览器对网页的第一次生成过程已经结束。</p>
<p>而我们的前端网站性能优化，也就是针对整个「关键渲染路径」而言的。只有<strong>最大限度的缩短上面第 1 至 5 步耗费的总时间，</strong>才能尽快的将内容渲染到屏幕上，此外还能缩短首屏的加载时间。</p>
<h1 id="网页加载的优化"><a href="#网页加载的优化" class="headerlink" title="网页加载的优化"></a>网页加载的优化</h1><h2 id="优化-DOM"><a href="#优化-DOM" class="headerlink" title="优化 DOM"></a>优化 DOM</h2><h3 id="压缩-删除注释"><a href="#压缩-删除注释" class="headerlink" title="压缩+删除注释"></a>压缩+删除注释</h3><p>为了将 HTML 文件尽可能快的传输给浏览器（客户端），我们需要压缩文件的大小，例如下面 html 文件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">      <span class="comment">/* reset */</span></span></span><br><span class="line">      * &#123;</span><br><span class="line">        padding: 0;</span><br><span class="line">        margin: 0;</span><br><span class="line">        list-style: none;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 头部 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span>...<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 正文 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span>...<span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 底部 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span>...<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这段代码包含了非常多的注释，这些注释对开发者来说可能有用，然而浏览器在遇到注释时却会忽略它们的，所以根本没必要展示给浏览器，我们完全可以移除它们。另外空格和换行也是个大问题，它会增加我们文件的体积，所以我们需要利用一些工具去压缩它。</p>


<p>上图是在删除掉所有注释，并使用 <a href="http://tool.chinaz.com/tools/jsformat.aspx">在线 JS 压缩工具</a> 压缩后的文件大小对比。当然，这种策略同样适用于 CSS 文件，你可以使用类似的步骤对 CSS 进行注释的删除与压缩。</p>
<p>如果你使用 webpack 构建你的应用，你可以使用下面插件来优化 html、css 和 js：</p>
<ul>
<li>optimize-css-assets-webpack-plugin（优化 css）</li>
<li>html-webpack-plugin（配置与优化 html）</li>
<li>webpack-parallel-uglify-plugin（优化 js）</li>
</ul>
<h2 id="优化-CSSOM"><a href="#优化-CSSOM" class="headerlink" title="优化 CSSOM"></a>优化 CSSOM</h2><p>CSS 在默认情况下是<strong>阻塞渲染</strong>的一类资源，也就是说浏览器在 CSSOM 构建完成以前是<strong>不会渲染任何已处理</strong>的内容的，所以我们必须对 CSS 进行精简。<br>由于浏览器必须同时具有 DOM 以及 CSSOM 才能构建渲染树，所以 <strong>HTML 和 CSS 都是阻塞渲染的资源。</strong>刚才已经针对 HTML 进行了优化，现在该轮到 CSS 了。</p>
<h3 id="压缩-删除注释-1"><a href="#压缩-删除注释-1" class="headerlink" title="压缩+删除注释"></a>压缩+删除注释</h3><p>这一点不多赘述，参考上面 html 的优化步骤。</p>
<h3 id="内联-CSS"><a href="#内联-CSS" class="headerlink" title="内联 CSS"></a>内联 CSS</h3><p>如果你的 css 文件很小，小到仅有几十甚至几 KB，那么你完全可以将 css 内联进 html ，因为相比使用 link 外链还得发一个请求，内联的代价要小的多得多。</p>
<h3 id="利用-Media-媒体查询"><a href="#利用-Media-媒体查询" class="headerlink" title="利用 Media 媒体查询"></a>利用 Media 媒体查询</h3><p>有时候一些 CSS 样式只在特定条件下使用，比如打印网页或者网页在大型显示器上显示时。这个时候我们的 media 媒体查询就能大显身手了，它能让这些特定的 CSS 资源不去阻塞页面的渲染。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;print.css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;print&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;other.css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;(min-width: 980px)&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面的例子在我们的项目中很常见，第一个样式表适用于所有情况，它始终会阻塞渲染。但第二个样式表则不然，它只在打印内容时适用，因此在网页首次加载时，该样式表不需要阻塞渲染。最后一个样式表声明则只在特定环境下被执行，一旦不符合最小宽度大于 980px，则始终不会被加载，这样我们就又少了一个不阻塞页面渲染的 CSS 资源。</p>
<p><strong>注意：</strong></p>
<ol>
<li>「阻塞渲染」仅是指浏览器是否需要暂停网页的首次渲染，直至该资源准备就绪。无论哪一种情况，浏览器仍会下载 CSS 资源，只不过不阻塞渲染的资源优先级较低罢了。</li>
<li>CSS 会造成阻塞吗？<ol>
<li>css 加载不会阻塞 DOM 树的解析</li>
<li>css 加载会阻塞 DOM 树也就是页面的渲染</li>
<li>css 加载会阻塞后面 js 语句的执行</li>
<li>css 加载不阻塞外部脚本的加载<br>了解更多：<a href="https://www.cnblogs.com/chenjg/p/7126822.html">https://www.cnblogs.com/chenjg/p/7126822.html</a></li>
</ol>
</li>
</ol>
<h2 id="优化-JavaScript"><a href="#优化-JavaScript" class="headerlink" title="优化 JavaScript"></a>优化 JavaScript</h2><p>默认情况下，无论内联还是外联，浏览器遇到文档中的 JavaScript 时都会暂停 DOM 构建，并立即开始执行 JavaScript ，等到脚本执行完毕后，再继续构建 DOM。所以为了提高页面渲染速度，我们可以让 JavaScript 异步执行。</p>
<h3 id="window-onload"><a href="#window-onload" class="headerlink" title="window.onload"></a>window.onload</h3><p>这种解决方案是让脚本在网页加载完毕后再执行。当网页加载完毕后，浏览器会发出 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onload">onload</a> 事件，我们可以将 JavaScript 放进 onload 事件的回调函数中，这样当 onload 事件被触发后，就能执行我们的脚本了，示例如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">load</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line">        init();</span><br><span class="line">        doSomethingElse();</span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onload = load;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="defer-async"><a href="#defer-async" class="headerlink" title="defer / async"></a>defer / async</h3><p>我们还可以向 script 标签添加异步关键字，那样可以让浏览器在等待脚本期间不阻止 DOM 以及 CSSOM 的构建。</p>
<p>而关于 defer 和 async 的区别，一图胜千言：</p>


<p>（出处：<a href="https://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html%EF%BC%89">https://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html）</a></p>
<p>简单来说，当浏览器遇到 script 脚本的时候：</p>
<ol>
<li><code>&lt;script src=&quot;script.js&quot;&gt;&lt;/script&gt;</code><br>没有 <code>defer</code> 或 <code>async</code>，浏览器会立即加载并执行指定的脚本，“立即”指的是在渲染该 <code>script</code> 标签之下的文档元素之前，即不等待后续载入的文档元素，读到就加载并执行。</li>
<li><code>&lt;script async src=&quot;script.js&quot;&gt;&lt;/script&gt;</code><br>有 <code>async</code>，加载和渲染后续文档元素的过程将和 <code>script.js</code> 的加载与执行并行进行（异步）。</li>
<li><code>&lt;script defer src=&quot;myscript.js&quot;&gt;&lt;/script&gt;</code><br>有 <code>defer</code>，加载后续文档元素的过程将和 <code>script.js</code> 的加载并行进行（异步），但是 <code>script.js</code> 的执行要在所有元素解析完成之后，<code>DOMContentLoaded</code> 事件触发之前完成。</li>
</ol>
<p><strong>注意：</strong><br>HTML5 规定，defer 脚本最后的延迟执行应该按照书写顺序来执行，即下面示例脚本，a.js 一定在 b.js 前面执行：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span> <span class="attr">src</span>=<span class="string">&quot;./js/a.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span> <span class="attr">src</span>=<span class="string">&quot;./js/b.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>但在 「JavaScript 高级程序设计（第三版）」中作者表示：</p>
<blockquote>
<p>在现实当中，延迟脚本并不一定会按照顺序执行，也不一定会在 <code>DOMContentLoaded</code> 事件触发前执行，因此最好只包含一个延迟脚本。</p>
</blockquote>
<p>我个人是试验过各种浏览器的，Chrome、Firefox、Safari，没有出现作者所说的情况。所以我猜测作者写上这一句话的原因是：即使在 HTML5 规范中有这么一条，不一定所有的浏览器厂商都会遵照这个规定，可能某些浏览器厂商并没有实现这个规范，所以为了安全起见，在开发中使用一个 defer 是非常有必要的。</p>
<h2 id="HTTP-缓存"><a href="#HTTP-缓存" class="headerlink" title="HTTP 缓存"></a>HTTP 缓存</h2><p>这部分内容可以点击<a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching">此处查看</a></p>
<h1 id="渲染性能的优化"><a href="#渲染性能的优化" class="headerlink" title="渲染性能的优化"></a>渲染性能的优化</h1><p>页面不仅要快速加载，而且要顺畅地运行；例如列表页的滚动应与手指的滑动一样快，侧边栏的弹出隐藏动画应如丝绸般顺滑。<br>所以除了对关键渲染路径的优化以外，我们还得确保自己编写的代码能（包括其他第三方代码）更高效地运行。</p>
<h2 id="像素管道"><a href="#像素管道" class="headerlink" title="像素管道"></a>像素管道</h2><p>首先我们要了解下「像素管道」的概念。像素管道是「网页从像素到屏幕」的一系列关键节点：</p>


<ul>
<li>JavaScript：指的是使用 JavaScript 来实现一些视觉变化的效果。（e.g. 给页面添加 DOM 元素）</li>
<li>样式计算：指的是根据「匹配选择器」计算出元素所应用的 CSS 规则的过程。</li>
<li>布局：指的是浏览器根据元素所应用的规则计算它们要占据的空间大小及其在屏幕的位置。</li>
<li>绘制：指的是填充像素的过程。（e.g. 绘制文本、颜色、边框和阴影，基本上包括元素的每个可视部分）绘制一般是在多个层上完成的。</li>
<li>合成：由于页面的各部分可能被绘制到多层，所以它们需要按正确顺序绘制到屏幕上，以便正确渲染页面。</li>
</ul>
<p>我们在编写代码的时候要时刻注意这五个关键节点，因为其中的每一个部分都可能为我们的应用带来“卡顿”。</p>
<h2 id="使用-requestAnimationFrame"><a href="#使用-requestAnimationFrame" class="headerlink" title="使用 requestAnimationFrame"></a>使用 requestAnimationFrame</h2><p>试想一下，假设现在浏览器正在执行有关样式方面的工作，然后出现了需要处理的 JavaScript 。这个时候浏览器会马上停下手中的活儿，转而执行插进来的 JavaScript ，然而新来的 JavaScript 是有可能导致刚才处理的样式工作重新返工的（配合上面的「管道图」来看，相当于 style 阶段完成后却执行了 JavaScript ，导致丢帧），这样一来浏览器就很有可能丢失了刚才处理完的这一帧，从而导致卡顿现象。所以没错，当你在使用 JavaScript 编写一段动画时，可以使用 RequestAnimationFrame API，该 API 能够提升我们的动画流畅度，因为它会安排 JavaScript 尽早在每一帧的开始执行，这样尽量给浏览器留出足够的时间来运行代码，然后是样式过程——&gt;布局过程——&gt;绘制过程——&gt;渲染层合并过程。示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animationWidth</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;box&#x27;</span>);</span><br><span class="line">  div.style.width = <span class="built_in">parseInt</span>(div.style.width) + <span class="number">1</span> + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">parseInt</span>(div.style.width) &lt; <span class="number">200</span>) &#123;</span><br><span class="line">    requestAnimationFrame(animationWidth);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">requestAnimationFrame(animationWidth);</span><br></pre></td></tr></table></figure>

<h2 id="避免重排与重绘"><a href="#避免重排与重绘" class="headerlink" title="避免重排与重绘"></a>避免重排与重绘</h2><h3 id="What-1"><a href="#What-1" class="headerlink" title="What"></a>What</h3><ul>
<li><strong>重排：</strong>当 DOM 的变化影响了元素的几何信息（DOM 对象的<strong>位置和尺寸大小</strong>），浏览器需要重新计算元素的几何属性，将其安放在界面中的正确位置，这个过程叫做重排。</li>
<li><strong>重绘：</strong>当一个元素更改了<strong>非几何属性</strong>（e.g. 背景、文本或阴影），但没有改变布局，重新把元素外观绘制出来的过程，叫做重绘。</li>
</ul>
<h3 id="浏览器的渲染队列"><a href="#浏览器的渲染队列" class="headerlink" title="浏览器的渲染队列"></a>浏览器的渲染队列</h3><p>思考以下代码将会触发几次渲染？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">div.style.left = <span class="string">&#x27;10px&#x27;</span>;</span><br><span class="line">div.style.top = <span class="string">&#x27;10px&#x27;</span>;</span><br><span class="line">div.style.width = <span class="string">&#x27;20px&#x27;</span>;</span><br><span class="line">div.style.height = <span class="string">&#x27;20px&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>根据我们上文的定义，这段代码理论上会触发 4 次重排+重绘，因为每一次都改变了元素的几何属性。但实际上最后只触发了一次重排，这都得益于浏览器的<strong>渲染队列机制</strong>：<br>当我们修改了元素的几何属性，导致浏览器触发重排或重绘时。它会把该操作放进渲染队列，等到队列中的操作到了<strong>一定的数量或者到了一定的时间间隔</strong>时，浏览器就会批量执行这些操作。</p>
<h4 id="强制刷新队列"><a href="#强制刷新队列" class="headerlink" title="强制刷新队列"></a>强制刷新队列</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">div.style.left = &#x27;10px&#x27;;</span><br><span class="line"><span class="selector-tag">console</span><span class="selector-class">.log</span>(<span class="selector-tag">div</span><span class="selector-class">.offsetLeft</span>);</span><br><span class="line">div.style.top = &#x27;10px&#x27;;</span><br><span class="line"><span class="selector-tag">console</span><span class="selector-class">.log</span>(<span class="selector-tag">div</span><span class="selector-class">.offsetTop</span>);</span><br><span class="line">div.style.width = &#x27;20px&#x27;;</span><br><span class="line"><span class="selector-tag">console</span><span class="selector-class">.log</span>(<span class="selector-tag">div</span><span class="selector-class">.offsetWidth</span>);</span><br><span class="line">div.style.height = &#x27;20px&#x27;;</span><br><span class="line"><span class="selector-tag">console</span><span class="selector-class">.log</span>(<span class="selector-tag">div</span><span class="selector-class">.offsetHeight</span>);</span><br></pre></td></tr></table></figure>

<p>这段代码会触发 4 次重排+重绘，因为在<code>console</code>中你请求的这几个样式信息，无论何时浏览器都会立即执行渲染队列的任务，即使该值与你操作中修改的值没关联。<br><strong>因为队列中，可能会有影响到这些值的操作，为了给我们最精确的值，浏览器会立即重排+重绘</strong>。<br><strong>强制刷新队列的 style 样式请求</strong>：</p>
<ol>
<li>offsetTop, offsetLeft, offsetWidth, offsetHeight</li>
<li>scrollTop, scrollLeft, scrollWidth, scrollHeight</li>
<li>clientTop, clientLeft, clientWidth, clientHeight</li>
<li>getComputedStyle(), 或者 IE 的 currentStyle</li>
</ol>
<p><strong>所以我们在开发中，应该谨慎的使用这些 style 请求，注意上下文关系，避免一行代码一个重排，这对性能是个巨大的消耗。</strong></p>
<h3 id="重排优化建议"><a href="#重排优化建议" class="headerlink" title="重排优化建议"></a>重排优化建议</h3><h4 id="分离读写操作"><a href="#分离读写操作" class="headerlink" title="分离读写操作"></a>分离读写操作</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">div.style.left = &#x27;10px&#x27;;</span><br><span class="line">div.style.top = &#x27;10px&#x27;;</span><br><span class="line">div.style.width = &#x27;20px&#x27;;</span><br><span class="line">div.style.height = &#x27;20px&#x27;;</span><br><span class="line"><span class="selector-tag">console</span><span class="selector-class">.log</span>(<span class="selector-tag">div</span><span class="selector-class">.offsetLeft</span>);</span><br><span class="line"><span class="selector-tag">console</span><span class="selector-class">.log</span>(<span class="selector-tag">div</span><span class="selector-class">.offsetTop</span>);</span><br><span class="line"><span class="selector-tag">console</span><span class="selector-class">.log</span>(<span class="selector-tag">div</span><span class="selector-class">.offsetWidth</span>);</span><br><span class="line"><span class="selector-tag">console</span><span class="selector-class">.log</span>(<span class="selector-tag">div</span><span class="selector-class">.offsetHeight</span>);</span><br></pre></td></tr></table></figure>

<p>还是上面触发 4 次重排+重绘的代码，这次只触发了一次重排：<br>在第一个<code>console</code>的时候，浏览器把之前上面四个写操作的渲染队列都给清空了。剩下的 console，因为渲染队列本来就是空的，所以并没有触发重排，仅仅拿值而已。</p>
<h4 id="样式集中改变"><a href="#样式集中改变" class="headerlink" title="样式集中改变"></a>样式集中改变</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">div.style.left = <span class="string">&#x27;10px&#x27;</span>;</span><br><span class="line">div.style.top = <span class="string">&#x27;10px&#x27;</span>;</span><br><span class="line">div.style.width = <span class="string">&#x27;20px&#x27;</span>;</span><br><span class="line">div.style.height = <span class="string">&#x27;20px&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>虽然现在大部分浏览器有渲染队列优化，不排除有些浏览器以及老版本的浏览器效率仍然低下。</p>
<p>建议通过改变 class 或者 csstext 属性集中改变样式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">var</span> left = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> top = <span class="number">10</span>;</span><br><span class="line">el.style.left = left + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">el.style.top = top + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">el.className += <span class="string">&#x27; theclassname&#x27;</span>;</span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">el.style.cssText += <span class="string">&#x27;; left: &#x27;</span> + left + <span class="string">&#x27;px; top: &#x27;</span> + top + <span class="string">&#x27;px;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="缓存布局信息"><a href="#缓存布局信息" class="headerlink" title="缓存布局信息"></a>缓存布局信息</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad 强制刷新 触发两次重排</span></span><br><span class="line">div.style.left = div.offsetLeft + <span class="number">1</span> + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">div.style.top = div.offsetTop + <span class="number">1</span> + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line"><span class="comment">// good 缓存布局信息 相当于读写分离</span></span><br><span class="line"><span class="keyword">var</span> curLeft = div.offsetLeft;</span><br><span class="line"><span class="keyword">var</span> curTop = div.offsetTop;</span><br><span class="line">div.style.left = curLeft + <span class="number">1</span> + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">div.style.top = curTop + <span class="number">1</span> + <span class="string">&#x27;px&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="离线改变-dom"><a href="#离线改变-dom" class="headerlink" title="离线改变 dom"></a>离线改变 dom</h4><ul>
<li>隐藏要操作的 dom<br>在要操作 dom 之前，通过 display 隐藏 dom ，当操作完成之后，才将元素的 display 属性为可见，因为不可见的元素不会触发重排和重绘。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">dom.display = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line"><span class="comment">// 修改dom样式</span></span><br><span class="line">dom.display = <span class="string">&#x27;block&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>通过使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DocumentFragment">DocumentFragment</a> 创建一个 <code>dom</code> 碎片,在它上面批量操作 dom ，操作完成之后，再添加到文档中，这样只会触发一次重排。</li>
<li>复制节点，在副本上工作，然后替换它！</li>
</ul>
<h4 id="position-属性为-absolute-或-fixed"><a href="#position-属性为-absolute-或-fixed" class="headerlink" title="position 属性为 absolute 或 fixed"></a>position 属性为 absolute 或 fixed</h4><p>position 属性为 absolute 或 fixed 的元素，重排开销比较小，不用考虑它对其他元素的影响</p>
<h4 id="优化动画"><a href="#优化动画" class="headerlink" title="优化动画"></a>优化动画</h4><ul>
<li>可以把动画效果应用到 position 属性为 absolute 或 fixed 的元素上，这样对其他元素影响较小<br>动画效果还应牺牲一些平滑，来换取速度，这中间的度自己衡量：<br>比如实现一个动画，以 1 个像素为单位移动这样最平滑，但是 reflow 就会过于频繁，大量消耗 CPU 资源，如果以 3 个像素为单位移动则会好很多。</li>
<li>启用 GPU 加速<br>此部分来自<a href="http://caibaojian.com/css-reflow-repaint.html">优化 CSS 重排重绘与浏览器性能</a><br><strong>GPU（图像加速器）：</strong><br>GPU 硬件加速是指应用 GPU 的图形性能对浏览器中的一些图形操作交给 GPU 来完成，因为 GPU 是专门为处理图形而设计，所以它在速度和能耗上更有效率。<br>GPU 加速通常包括以下几个部分：Canvas2D，布局合成, CSS3 转换（transitions），CSS3 3D 变换（transforms），WebGL 和视频(video)。</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 根据上面的结论</span></span><br><span class="line"><span class="comment"> * 将 2d transform 换成 3d</span></span><br><span class="line"><span class="comment"> * 就可以强制开启 GPU 加速</span></span><br><span class="line"><span class="comment"> * 提高动画性能</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">10px</span>, <span class="number">10px</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 又或者使用 will-change 属性来创建新层 */</span></span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">will-change</span>: transform;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="参考资源"><a href="#参考资源" class="headerlink" title="参考资源"></a>参考资源</h1><ul>
<li><a href="https://developers.google.com/web/fundamentals/performance/why-performance-matters/">Google Web Fundamentals - Performance</a></li>
<li><a href="https://www.cnblogs.com/chenjg/p/7126822.html">css 加载会造成阻塞吗？</a></li>
<li><a href="https://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html">async vs defer attributes</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>性能优化</category>
      </categories>
      <tags>
        <tag>性能优化</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-Sass/SCSS:让CSS书写更高效</title>
    <url>/posts/47379/</url>
    <content><![CDATA[<p>转载自：<a href="https://blog.csdn.net/qq_41694291/article/details/105529166">https://blog.csdn.net/qq_41694291/article/details/105529166</a></p>
<h1 id="一、Sass-SCSS-使用简介"><a href="#一、Sass-SCSS-使用简介" class="headerlink" title="一、Sass/SCSS 使用简介"></a>一、Sass/SCSS 使用简介</h1><h2 id="1-Sass-和-SCSS-的关系"><a href="#1-Sass-和-SCSS-的关系" class="headerlink" title="1. Sass 和 SCSS 的关系"></a>1. Sass 和 SCSS 的关系</h2><p>没有用过 Sass 的人很可能会有这样一个疑惑，Sass 和 SCSS 是一个东西吗？</p>
<p>其实本文的标题已经给出了暗示，它们本质上是一个东西。具体来说，SCSS 是 Sass 版本 3 使用的语法。Sass 1.xx 和 Sass 2.xx 采用的是基于缩进的语法，如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">body</span><br><span class="line">  color: red;</span><br><span class="line">  font-size: 12px;</span><br></pre></td></tr></table></figure>

<p>显然，这与 CSS 的写法有很大出入，原生 CSS 是下面这种基于大括号的语法：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这也就意味着早期版本的 Sass 是不能直接兼容原生 CSS 的（即 CSS 代码直接粘贴进 Sass 文件无法编译）。很多前端开发者认为这种语法带来了使用上的不便，为此还催生了兼容原生 CSS 语法的 Less，并且抢占了 Sass 相当多的市场份额。</p>
<p>后来到了版本 3，Sass 团队决定改变之前的缩进风格，改为完全兼容 CSS3 语法的风格，同时把之前的文件后缀<code>.sass</code>改成<code>.scss</code>，以表明该版本已经完全兼容了 CSS3 语法。所以 SCSS 指代的是 Sass 从版本 3 之后开始使用的语法规范，本质上仍然是 Sass 框架。</p>
<p>鉴于 Sass 的版本 3 已经成为其主流版本，因此本文所介绍的内容都将基于 SCSS 语法，除了对一些早期项目维护的需求外，已经没有必要学习早期的 Sass 语法。</p>
<a id="more"></a>

<h2 id="2-Sass-简介"><a href="#2-Sass-简介" class="headerlink" title="2. Sass 简介"></a>2. Sass 简介</h2><p>从概念上来说，Sass 是一个 CSS 的预处理器，用于辅助进行 CSS 开发。</p>
<p>Sass 为 CSS 开发引入了变量、嵌套、运算、混入、继承、指令控制等一系列接近常规编程语言的语法特性，使得 CSS 开发变得更加简洁和高效。经过编译，Sass 代码可以被转化为原生的 CSS 代码。比如下面是一个符合 scss 语法的文件：<br>style.scss</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> <span class="selector-class">.main-body</span> &#123;</span><br><span class="line">  div &#123;</span><br><span class="line">    <span class="selector-tag">color</span>: <span class="selector-tag">black</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里<code>div</code>和<code>p</code>位于<code>.container .main-body</code>内表示它们是该选择器的子选择器，它会被编译为以下的 css 文件：<br>style.css</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> <span class="selector-class">.main-body</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-class">.main-body</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种嵌套的写法不仅可以减少代码量，还可以清晰地表明它们的包含关系，使得代码的逻辑性更强，非常有利于提升 css 的开发效率。</p>
<p>Sass 是用 Ruby 语言开发的，因此想要编译<code>.scss</code>文件，一般来说应该首先安装 Ruby。不过 Nodejs 社区提供了一个非常好用的模块：node-sass，同样可以直接编译<code>.scss</code>文件。node-sass 之所以不依赖 Ruby 环境，是因为它将 Nodejs 绑定到了 C 语言版本的 Sass 库：LibSass，而 C 语言环境几乎是各大操作系统的标配。比如：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// 安装node-sass，对于单独的项目也可以局部安装</span><br><span class="line">npm install node-sass -g</span><br><span class="line"></span><br><span class="line">// 切换到style.scss所在路径</span><br><span class="line">// 输入以下命令，将style.scss编译为css文件</span><br><span class="line">node-sass style.scss style.css</span><br></pre></td></tr></table></figure>

<p>如果你使用的编辑器是 vs code，官方还推荐了一个非常好用的实时编译插件：Live Sass Compiler。通过对<code>.scss</code>文件进行监视，它可以在每次保存时自动将其编译为 css 文件。</p>
<p>关于 scss 语法，第二部分会有详细的介绍，因此这里暂不深入讲解。</p>
<h2 id="3-在项目中编译-Sass"><a href="#3-在项目中编译-Sass" class="headerlink" title="3. 在项目中编译 Sass"></a>3. 在项目中编译 Sass</h2><p>前端项目中编译 Sass 文件，本质上还是借助 node-sass 模块，它可以看做是 Sass 代码的解析引擎。我们这里简单介绍一下 webpack 是如何调用 node-sass 模块进行代码编译的。</p>
<p>我们知道，webpack 运行于 Nodejs 环境下，因此它只能直接解析 JavaScript 代码。对于其他类型的文件，webpack 无法读取和识别，于是就需要借助对应的 loader 来加载这些文件。webpack 提供了<code>sass-loader</code>来读取和编译 sass 文件，这个 loader 在读取到<code>.scss</code>文件的内容后，会调用 node-sass 对这些代码进行编译，生成对应的 css 代码。</p>
<p>生成了 css 代码后，本质上 scss 代码的解析任务就完成了。不过现在你只是得到了普通的 css 代码，为了使 webpack 能识别这些 css 代码，你仍然需要使用解析样式时需要的两个 loader：css-loader 和 style-loader。css-loader 可以把 css 代码解析为 js 模块，这样就可以用 import 直接导入到其他模块中。style-loader 的作用是将 css 代码添加到 style 标签内，内嵌到页面中。因此 webpack.config.js 中应该是下面的写法：<br>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">          use:[<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;sass-loader&#x27;</span>]</span><br><span class="line">       &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>webpack 将先调用 sass-loader 将 scss 代码编译为 css 代码（sass-loader 完成该过程依赖的是 node-sass 模块）；然后调用 css-loader 将 css 代码封装成合法的 js 模块（这样才可以通过 require 或者 import 导入）；最后使用 style-loader 将样式内嵌到页面的 style 标签内。</p>
<h2 id="4-Sass-SCSS、Less-还是-stylus？"><a href="#4-Sass-SCSS、Less-还是-stylus？" class="headerlink" title="4. Sass/SCSS、Less 还是 stylus？"></a>4. Sass/SCSS、Less 还是 stylus？</h2><p>相比于 Less 和 stylus，Sass 的历史最为悠久。由于早期的 Sass 语法没有得到广泛接受，社区诞生了更为轻量，兼容原生 css 语法的 Less，并因此被 Twitter 的著名前端框架 Bootstrap 所采用。一时间，Less 名声大噪，甚至有取代 Sass 的趋势。</p>
<p>不过后来，Sass 在其版本 3 中推出了兼容原生 css 语法的 SCSS，Less 最重要的优势已不复存在。另外，Sass 的功能相对 Less 来说更加强大，也更成熟。因此在 Bootstrap 4 中，依赖的框架已经从 Less 切换为 Sass，这几乎标志着 Sass 与 Less 的竞争已经以 Sass 的胜利告终（另外，即将发布&lt;截止到 2020/4/16&gt;的 Bootstrap 5 已经确定将完全移除对 jQuery 的依赖，转而使用原生的 JavaScript，这一举动也基本预示着 jQuery 的退场）。</p>
<p>相比于 Sass 和 Less，stylus 诞生时间相对较短，暂时没有足够的影响力，不过据说其功能已经可以媲美 Sass，所以关于 Sass 和 stylus 孰优孰劣，本文暂不给出评价。不过如果你希望使用一款更加成熟的预处理器，那么推荐 Sass（SCSS 语法）。</p>
<h1 id="二、Sass（基于-SCSS-语法）详解"><a href="#二、Sass（基于-SCSS-语法）详解" class="headerlink" title="二、Sass（基于 SCSS 语法）详解"></a>二、Sass（基于 SCSS 语法）详解</h1><h2 id="1-CSS-功能拓展"><a href="#1-CSS-功能拓展" class="headerlink" title="1. CSS 功能拓展"></a>1. CSS 功能拓展</h2><h3 id="1-嵌套规则"><a href="#1-嵌套规则" class="headerlink" title="(1). 嵌套规则"></a>(1). 嵌套规则</h3><p>这可能是最典型，也最常见的可以体现 sass 是如何提高 css 开发效率的特性之一了。</p>
<p>嵌套规则可以允许你像数学中提取公因式一样，把多个选择器相同的父选择器提取到外部，从而有效地减少选择器的书写量。比如在编写 css 时，我们可能会写出下面的样式：<br>index.css:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.head</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.head</span> <span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.head</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.head</span> <span class="selector-class">.content</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.head</span> <span class="selector-class">.content</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，为了定义<code>.head</code>选择器下面的 h1、a、p、span 等元素，我们需要把<code>.head</code>书写四遍，而且你并不能非常直观地看出这四个元素都是<code>.head</code>的子元素（这需要一定的归纳）。</p>
<p>但是使用 SCSS 语法，你可以写成下面的格式：<br>index.scss</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.head</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  h1 &#123;</span><br><span class="line">    <span class="selector-tag">color</span>: <span class="selector-tag">red</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.content</span> &#123;</span><br><span class="line">    p &#123;</span><br><span class="line">      <span class="selector-tag">color</span>: <span class="selector-id">#333</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">span</span> &#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它经过编译之后，就是之前的 css 代码。但显然，用 scss 语法，你可以避免书写大量重复的父选择器。它的另一个优势是，你可以非常直观地看出各个选择的嵌套关系，这可以有效提高修改样式的效率。所以，嵌套语法不可谓不优雅！</p>
<h3 id="2-父选择器-amp"><a href="#2-父选择器-amp" class="headerlink" title="(2). 父选择器&amp;"></a>(2). 父选择器&amp;</h3><p>在使用嵌套语法的时候可能会遇到这样一个问题，如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.head</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.head</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你可能会想到下面的写法，但它与上述 css 是不等价的：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.head</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">  :hover &#123;</span><br><span class="line">    <span class="selector-tag">color</span>: <span class="selector-tag">red</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 它会被编译成</span><br><span class="line"><span class="selector-class">.head</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.head</span> <span class="selector-tag">a</span> <span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>显然，这时<code>:hover</code>不再是选择器<code>a</code>的伪类了，它会导致 a 标签下的所有元素在鼠标悬停时都变成红色。</p>
<p>因此你只能采用下面的写法：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.head</span> &#123;</span><br><span class="line">  a &#123;</span><br><span class="line">    <span class="selector-tag">color</span>: <span class="selector-id">#555</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们认为这看起来并不优雅，因为这并没有达到最大程度的复用，而父选择器则为我们解决了这个问题：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.head</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    <span class="selector-tag">color</span>: <span class="selector-tag">red</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的<code>&amp;</code>我们称为父选择器，在这里它指代的就是外部选择器<code>.head a</code>。sass 引擎在解析这个代码时，会直接用外部选择器替换这个字符，这样你就得到了<code>.head a:hover</code>这样的选择器。</p>
<p>值得注意的是，sass 引擎是基于字符串来处理 scss 文件的，在解析过程中，只是简单地把<code>&amp;</code>替换成其父选择器对应的字符串。所以你完全可以把&amp;看做普通的占位字符与其他字符串拼接，如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.main</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  &amp;-content &#123;</span><br><span class="line">    <span class="selector-tag">padding</span>: 0;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译为：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.main</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.main-content</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出，引擎是直接把<code>&amp;</code>替换成了字符串<code>.main</code>，因此得到了选择器<code>.main-content</code>。</p>
<p>另外，存在更深层次的嵌套时，&amp;指代的是所有的外部选择器，如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.head</span> &#123;</span><br><span class="line">  a &#123;</span><br><span class="line">    &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的<code>&amp;</code>指代<code>.head a</code>。</p>
<p>需要注意的是，<code>&amp;</code>必须作为第一个字符，而不能被拼接到其他字符后面，如<code>.main-&amp;</code>，这样会报错。</p>
<h3 id="3-属性嵌套"><a href="#3-属性嵌套" class="headerlink" title="(3). 属性嵌套"></a>(3). 属性嵌套</h3><p>这是嵌套语法的变体。我们上面介绍的嵌套语法指的是选择器的嵌套，除此之外，sass 还支持有相同前缀的属性的嵌套，如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">font</span>: &#123;</span><br><span class="line">    family: fantasy;</span><br><span class="line">    <span class="attribute">size</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">weight</span>: bold;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>等价于：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: fantasy;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外，前缀属性也可以有自己的值，如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  // 会在上述css代码中额外生成font: 20px/24px</span><br><span class="line">  <span class="selector-tag">font</span>: 20<span class="selector-tag">px</span>/24<span class="selector-tag">px</span> &#123;</span><br><span class="line">    <span class="attribute">family</span>: fantasy;</span><br><span class="line">    <span class="attribute">size</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">weight</span>: bold;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-占位选择器-foo"><a href="#4-占位选择器-foo" class="headerlink" title="(4). 占位选择器%foo"></a>(4). 占位选择器%foo</h3><p>占位选择器是 sass 提供的一种特殊选择器，以<code>%</code>开头。带有占位选择器的选择器只能被<code>@extend</code>语句（这是 sass 的继承机制，第三节 SassScript 中会讲到）引用，单独使用时不会被编译为原生 css。如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.btn</span>%<span class="selector-tag">extreme</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接编译 scss 文件时，上述样式会被忽略，因为<code>%extreme</code>表明这个样式只能被继承。当使用下面的<code>@extend</code>语句时，这个样式就会被继承下来：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.primary-btn</span> &#123;</span><br><span class="line">  @extend %extreme;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在<code>.primary-btn</code>的文字颜色会被置为蓝色。关于继承的语法，SassScript 部分会有进一步介绍。</p>
<h3 id="5-注释"><a href="#5-注释" class="headerlink" title="(5). 注释"></a>(5). 注释</h3><p>除了原生 css 所支持的多行注释<code>/* */</code>，sass 还支持类似于 js 的单行语法<code>//</code>，但是多行注释会被输出到生成的 css 文件中，而单行注释在编译的过程中会被去除。因此单行注释应该只用于解释 sass 语句，如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 这是符合css的注释，</span></span><br><span class="line"><span class="comment"> * 它会被保留 */</span></span><br><span class="line">// 这行代码会被去除</span><br><span class="line"><span class="selector-class">.head</span> &#123;</span><br><span class="line">  <span class="attribute">a</span>: &#123;</span><br><span class="line">    color: <span class="number">#555</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译后：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 这是符合css的注释，</span></span><br><span class="line"><span class="comment"> * 它会被保留 */</span></span><br><span class="line"><span class="selector-class">.head</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一般来说，压缩模式下会去掉所有注释，但如果多行注释的第一个字符是<code>!</code>，那么即使在压缩模式下它也会被保留，如<code>/*! version: 1.0 */</code>，常用于添加版权信息。</p>
<p>另外，注释中允许插入变量（SassScript 部分会讲到变量）：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">$version: &#x27;1.0&#x27;;</span><br><span class="line"><span class="comment">/* 当前版本为：#&#123;$version&#125; */</span></span><br></pre></td></tr></table></figure>

<h2 id="2-SassScript"><a href="#2-SassScript" class="headerlink" title="2. SassScript"></a>2. SassScript</h2><p>直译为 sass 脚本。</p>
<p>css 的全写是 Cascading Style Sheets（层叠样式表），它只是用声明的方式去定义一组规则，不支持像变量、函数、数据结构定义等编程语法，因此我们一般不把 css 当成一门变成语言看待。</p>
<p>而 SassScript 的设计目的就是将 css 脚本化，使开发者可以像写 js 脚本一样去写样式，从而使 css 代码的编写更加高效和科学。为了使 css 脚本化，sass 提供了以下语法支持：</p>
<h3 id="1-变量"><a href="#1-变量" class="headerlink" title="(1). 变量"></a>(1). 变量</h3><p>变量可谓是编程语言最基础的语法特性之一了。sass 为 css 也引入了变量。</p>
<p>sass 中的变量是以<code>$</code>开头的，如：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">$primary-color: #0066ff;</span><br></pre></td></tr></table></figure>

<p>这里的<code>$primary-color</code>就被 sass 视为一个变量，它的值是<code>#0066ff</code>，现在你可以像下面一样引用这个变量：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">$primary-color: #0066ff;</span><br><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: $primary-color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译为：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#0066ff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你把 sass 引擎看做一个字符串处理函数，那它其实就是把<code>$primary-color</code>替换成<code>#0066ff</code>而已。</p>
<p>此外，变量还可以参与构成其他变量，如：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">$primary-color: #0066ff;</span><br><span class="line">$primary-border: 1px solid $primary-color;</span><br></pre></td></tr></table></figure>

<p>使用变量的好处是，当某个值在多个地方用到时，一旦需要修改这个值，你只需要修改对应变量的值就可以了。如果你编写的是原生 css，那么你需要挨个找到这些值去修改，不仅费时，还容易发生遗漏。</p>
<p>另外，变量还可以用于运算和函数传值，因此它是 css 脚本化的一个很重要的基石。</p>
<h3 id="2-数据类型"><a href="#2-数据类型" class="headerlink" title="(2). 数据类型"></a>(2). 数据类型</h3><p>原生 css 没有数据类型的概念，你可以把所有的值都仅视为字符串。为了将 css 脚本化，sass 为 css 引入了数据类型的概念，包括以下 7 种数据类型：</p>
<ol>
<li><strong>数字</strong>：1，10，5px 等</li>
<li><strong>字符串</strong>：有引号与无引号字符串，如”foo”、‘bar’、solid 等</li>
<li><strong>颜色</strong>：red、#0066ff、rgba(0, 0, 0, 0.5)等</li>
<li><strong>布尔值</strong>：true 和 false</li>
<li><strong>空值</strong>：null</li>
<li><strong>数组</strong>：用空格或逗号隔开的一组数据，如<code>1px 5px</code>、<code>Helvetica, Arial, sans-serif</code>等</li>
<li><strong>maps</strong>：可以理解为 js 的对象，格式为<code>(key1: value1, key2: value2)</code></li>
</ol>
<p>需要特别注意的是，在 sass 中，<code>5px</code>这样的值被视为数字，因此可以直接参与运算，sass 会在必要时对单位进行类型转换。</p>
<p>数据类型是为其他语法服务的，我们后面会讲到这些数据类型的使用。</p>
<h3 id="3-运算"><a href="#3-运算" class="headerlink" title="(3). 运算"></a>(3). 运算</h3><p>sass 支持数字运算、颜色值运算、字符串运算、布尔运算等。</p>
<h4 id="数字运算"><a href="#数字运算" class="headerlink" title="数字运算"></a>数字运算</h4><p>包括加减乘除和取模（<code>+、-、*、/、%</code>）五种，必要时会进行单位转换。如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1in</span> + <span class="number">8pt</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译为：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1.111in</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关系运算符中<code>&lt;、&gt;、&lt;=、&gt;=</code>可以用于数值之间，而<code>==、!=</code>可以用于任何数据类型。</p>
<p>其中除法运算比较特殊，因为它同样是原生 css 支持的标识符，所以在遇到<code>/</code>时，sass 引擎必须区分它是 css 标识符，还是除法运算。当遇到以下情况，sass 引擎会将其视为除法运算：</p>
<ol>
<li>运算符两侧的值包含变量或函数返回值</li>
<li>整个值被一个圆括号包裹</li>
<li>值是某个算术表达式的一部分</li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  font: 10px/8px; // 不符合上述三种情况，是原生css</span><br><span class="line"></span><br><span class="line">  $width: 1000px;</span><br><span class="line">  width: $width/2; // 运算符两侧包含变量</span><br><span class="line">  <span class="selector-tag">width</span>: <span class="selector-tag">round</span>(1.5) / 2; // 包含函数返回值</span><br><span class="line">  <span class="selector-tag">height</span>: (500<span class="selector-tag">px</span>/2); // 值被圆括号包裹</span><br><span class="line">  <span class="selector-tag">margin-left</span>: 5<span class="selector-tag">px</span> + 8<span class="selector-tag">px</span>/2<span class="selector-tag">px</span>; // 是某个表达式的一部分</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译为：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">font</span>: <span class="number">10px</span>/<span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">250px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">9px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果表达式中包含变量，但希望将<code>/</code>当做原生 css 标识符，可以用<code>#&#123;&#125;</code>插值，如：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">font: #&#123;$font-size&#125;/#&#123;$line-height&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="颜色值运算"><a href="#颜色值运算" class="headerlink" title="颜色值运算"></a>颜色值运算</h4><p>颜色值分 red（红）、green（绿）、blue（蓝）三种颜色，在进行颜色运算时，也是对三个颜色分别运算得到最后结果。比如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">color</span>: <span class="selector-tag">rgb</span>(100, 100, 100) + <span class="selector-tag">rgb</span>(100, 100, 100)</span><br><span class="line">=&gt; rgb(200, 200, 200)</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">color</span>: <span class="selector-id">#222222</span> + <span class="selector-id">#333333</span>;</span><br><span class="line">=&gt; #555555;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">color</span>: <span class="selector-tag">rgb</span>(100, 100, 100) + <span class="selector-id">#111111</span>;</span><br><span class="line">=&gt; rgb(117, 117, 117);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到，红、绿、蓝三种颜色的值都是 0-255，分别进行运算即可。假如颜色中包含透明度参数，则只有在透明度相同的情况下才可以直接运算。不同透明度的颜色值需要经过 <code>opacify</code>或 <code>transparentize</code>这两个函数转化才能参与运算。</p>
<p>颜色值的运算还可以使用 sass 提供的<a href="https://sass-lang.com/documentation/modules">颜色函数</a>。</p>
<h4 id="字符串运算"><a href="#字符串运算" class="headerlink" title="字符串运算"></a>字符串运算</h4><p>与 JavaScript 一样，字符串也可以用加号拼接。不过拼接结果是否带引号，取决于等号左边的值是否带引号。如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;Foo &#x27;</span> + Bar;</span><br><span class="line">  <span class="attribute">font-family</span>: sans- + <span class="string">&#x27;serif&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译为</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;Foo Bar&#x27;</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: sans-serif;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="布尔运算"><a href="#布尔运算" class="headerlink" title="布尔运算"></a>布尔运算</h4><p>SassScript 支持<code>and</code>、<code>or</code>和<code>not</code>等布尔运算。布尔运算主要用于流程控制中，与 JavaScript 中的写法是一致的。</p>
<p>不过值得注意的是，在 sass 中没有真正意义上的布尔值。在早期的 sass 语法中，1 表示 true，0 表示 false。而在后来的 SCSS 语法中新增了关键字<code>True</code>和<code>False</code>，不过可以看到，它们被划为数值类，也就是说，它们的值本质上还是 1 和 0，只是有了更明显的语义。</p>
<h3 id="4-函数"><a href="#4-函数" class="headerlink" title="(4). 函数"></a>(4). 函数</h3><p>函数当是大多数编程语言最基本的概念之一了（在函数式编程中，函数是一等公民），sass 为 css 也引入了函数。</p>
<p>首先，sass 内置了相当多的函数，用于各种运算和转换，请参考这份函数列表：<a href="https://sass-lang.com/documentation/modules">Sass::Script::Functions </a>。使用内置函数时，需要首先用<code>@use</code>导入函数对象，如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@use</span> <span class="string">&quot;sass:color&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.button</span> &#123;</span><br><span class="line">  $primary-color: #6b717f;</span><br><span class="line">  color: $primary-color;</span><br><span class="line">  border: 1px solid color.scale($primary-color, $lightness: 20%);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sass 也允许自定义函数，这需要<code>@function</code>和<code>@return</code>这两个特殊指令，格式如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@function</span> column-width($col, $total) &#123;</span><br><span class="line">  <span class="keyword">@return</span> percentage($col/$total);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在你可以像调用普通函数一样调用这个函数。</p>
<h3 id="5-插值"><a href="#5-插值" class="headerlink" title="(5). 插值 #{ }"></a>(5). 插值 #{ }</h3><p>为了解决字符串与变量拼接带来的不变，sass 引入了模板引擎，使用<code>#&#123;&#125;</code>作为插值语法。</p>
<p>选择器、属性名、属性值等都可以使用插值，如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">$name: foo;</span><br><span class="line">$attr: border;</span><br><span class="line">$content: world;</span><br><span class="line">p.#&#123;$name&#125; &#123;</span><br><span class="line">  #&#123;$attr&#125;-color: blue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;hello #&#123;$content&#125;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-导入-import"><a href="#6-导入-import" class="headerlink" title="(6). 导入@import"></a>(6). 导入@import</h3><p>css 中允许使用<code>@import</code>从其他 css 文件中导入样式。但是这个功能在 css 中使用并不多，因为 css 的<code>@import</code>是同步的，也就是说只有在解析到这个语句时，浏览器才会去下载对应的 css 文件。这种同步的方式会影响到前端的使用体验。</p>
<p>而 sass 对@import 语句进行了扩展，在引入 sass/scss 文件时，不再使用同步的方式去下载对应的文件，而是使用异步的方式，也就是会进行静态分析，提前下载和编译好对应的文件：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;foo.scss&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>对于下面四种情况，sass 会将其视为原生的 css，不会进行编译：</p>
<ol>
<li>文件拓展名是 .css；</li>
<li>文件名以 http:// 开头；</li>
<li>文件名是 url()；</li>
<li>@import 包含 media queries。</li>
</ol>
<p>如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;foo.css&#x27;</span>;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;foo&#x27;</span> screen;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;http://foo.com/bar&#x27;</span>;</span><br><span class="line"><span class="keyword">@import</span> url(foo);</span><br></pre></td></tr></table></figure>

<p>它们会被原样输出到 css 代码中。</p>
<p>如果导入的文件与当前文件存在同名变量，一般来说当前文件的变量优先级更高（因为一般导入语句会写在最前面，所以当前文件的变量会将其覆盖）。但是如果你希望优先使用引入文件的变量，但不确定该变量是否存在时，可以使用<code>!default</code>定义变量：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;foo.scss&#x27;</span>;</span><br><span class="line">$width: 100px !default;</span><br></pre></td></tr></table></figure>

<p>这时如果<code>foo.scss</code>定义了<code>$width</code>，则以它优先，如果没有，才使用这里的<code>100px</code>默认值。</p>
<p>另外，sass 的<code>@import</code>是有作用域概念的，也就是说如果你是在某个作用域内导入的 scss 文件，那么它的代码将被插入到这个作用域内。</p>
<p>如果某个 scss 文件不需要单独编译成 css，只需要通过其他 scss 作为公共文件导入，可以在命名前加下划线：<code>_color.scss</code>。这样这个文件就不会被编译了，而你可以在其他 scss 文件中将其导入，注意，导入的时候不需要带下划线：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;color.scss&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-控制指令"><a href="#7-控制指令" class="headerlink" title="(7). 控制指令"></a>(7). 控制指令</h3><p>包括<code>@if</code>(<code>@else if</code>，<code>@else</code>)，<code>@for</code>，<code>@each</code>，<code>@while</code>等。</p>
<p><code>@if</code>与 JavaScript 的<code>if</code>用法类似：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  @if 1 + 1 == 2 &#123;</span><br><span class="line">    <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span>;</span><br><span class="line">  &#125; <span class="keyword">@else</span> if <span class="number">5</span> &lt; <span class="number">3</span> &#123;</span><br><span class="line">    <span class="selector-tag">border</span>: 2<span class="selector-tag">px</span> <span class="selector-tag">dotted</span>;</span><br><span class="line">  &#125; <span class="keyword">@else</span> &#123;</span><br><span class="line">    <span class="selector-tag">border</span>: 3<span class="selector-tag">px</span> <span class="selector-tag">double</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@for</code>包括两种语法格式：<code>@for $var from &lt;start&gt; through &lt;end&gt;</code>和<code>@for $var from &lt;start&gt; to &lt;end&gt;</code>。这里的变量$var 是任意的，只是作为临时变量使用，start 和 end 都必须是整数。两种语法的差异在于，前者的取值区域是<code>start ~ end</code>，而后者的取值区域是<code>start ~ end-1</code>，即<code>to</code>语法不包含<code>end</code>的值。</p>
<p><code>@each</code>用于遍历数组或对象。遍历数组的语法是：<code>@each $var in &lt;list&gt;</code>，如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@each</span> $animal in puma, sea-slug, egret &#123;</span><br><span class="line">  .#&#123;$animal&#125;-icon &#123;</span><br><span class="line">    background-image: url(&#x27;/images/#&#123;$animal&#125;.png&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译为：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.puma-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/images/puma.png&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sea-slug-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/images/sea-slug.png&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.egret-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/images/egret.png&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>遍历对象的语法为：<code>@each $var1, $var2, ... in &lt;maps&gt;</code>，如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@each</span> $animal, $color, $cursor in (puma, black, default), (sea-slug, blue, pointer)</span><br><span class="line">&#123;</span><br><span class="line">  .#&#123;$animal&#125;-icon &#123;</span><br><span class="line">    background-image: url(&#x27;/images/#&#123;$animal&#125;.png&#x27;);</span><br><span class="line">    border: 2px solid $color;</span><br><span class="line">    cursor: $cursor;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译为：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.puma-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/images/puma.png&#x27;</span>);</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid black;</span><br><span class="line">  <span class="attribute">cursor</span>: default;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sea-slug-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/images/sea-slug.png&#x27;</span>);</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid blue;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@while</code>也是很常见的循环指令，当条件为假时退出循环，如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">$i: 6;</span><br><span class="line"><span class="keyword">@while</span> $i &gt; <span class="number">0</span> &#123;</span><br><span class="line">  .item-#&#123;$i&#125; &#123;</span><br><span class="line">    width: 2em * $i;</span><br><span class="line">  &#125;</span><br><span class="line">  $i: $i - 2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-混入-mixin"><a href="#8-混入-mixin" class="headerlink" title="(8). 混入@mixin"></a>(8). 混入@mixin</h3><p>混入的本意是将一组常使用的样式提取出来，然后在使用的时候直接使用<code>@mixin</code>语句导入即可，这样可以避免重复书写这些样式。它最简单的用法如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@mixin</span> large-text &#123;</span><br><span class="line">  <span class="selector-tag">font</span>: &#123;</span><br><span class="line">    <span class="attribute">size</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">weight</span>: bold;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">color</span>: <span class="selector-id">#ff0000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里定义了一组样式，包括<code>font-size</code>，<code>font-weight</code>和<code>color</code>，我们将这样一组样式命名为<code>large-text</code>。现在当我们想在某个元素上应用大文本样式时，就可以导入这段样式：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  @include large-text;</span><br><span class="line">  <span class="selector-tag">display</span>: <span class="selector-tag">inline-block</span>;</span><br><span class="line">  ...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方式可以不用为元素定义大量的类名来应用不同的样式，而是从编程的角度来提取公共样式，从而提升开发效率。</p>
<p>类似于函数，mixin 也可以传入参数，也可以给参数设置默认值，如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@mixin</span> sexy-border($color, $<span class="attribute">width:</span> <span class="number">1in</span>) &#123;</span><br><span class="line">  <span class="selector-tag">border</span>: &#123;</span><br><span class="line">    <span class="attribute">color</span>: $color;</span><br><span class="line">    <span class="attribute">width</span>: $width;</span><br><span class="line">    <span class="attribute">style</span>: dashed;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  @include sexy-border(blue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译为：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: blue;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">1in</span>;</span><br><span class="line">  <span class="attribute">border-style</span>: dashed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>传参时可以指定参数名，这样就不需要严格按照参数顺序了：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  @include special-border($color: blue, $width: 2in);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当传入的参数数量不确定时，可以使用省略号语法来接收：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@mixin</span> box-shadow($shadows...) &#123;</span><br><span class="line">  -moz-box-shadow: $shadows;</span><br><span class="line">  -webkit-box-shadow: $shadows;</span><br><span class="line">  box-shadow: $shadows;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.shadows</span> &#123;</span><br><span class="line">  @include box-shadow(0px 4px 5px #666, 2px 6px 10px #999);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>传参的时候同样可以使用省略号语法：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@mixin</span> colors($text, $background, $border) &#123;</span><br><span class="line">  ...;</span><br><span class="line">&#125;</span><br><span class="line">$values: #ff0000, #00ff00, #0000ff;</span><br><span class="line"><span class="selector-class">.primary</span> &#123;</span><br><span class="line">  @include colors($values...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-继承-extend"><a href="#9-继承-extend" class="headerlink" title="(9). 继承 @extend"></a>(9). 继承 @extend</h3><p>基于<code>Nicole Sullivan</code>面向对象的 css 的理念，选择器继承是说一个选择器可以继承为另一个选择器定义的所有样式。比如 bootstrap 中的<code>btn-primary</code>就可以认为是继承自<code>btn</code>。语法如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">//通过选择器继承继承样式</span><br><span class="line"><span class="selector-class">.error</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fdd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  @extend .error;</span><br><span class="line">  <span class="selector-tag">border-width</span>: 3<span class="selector-tag">px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不同于混入，<code>@extend</code>并不是直接把<code>.error</code>的样式直接复制过来，而是给所有添加了<code>seriousError</code>的标签同时加上<code>error</code>类。这样，所有与<code>error</code>类相关的选择器，现在都与<code>seriousError</code>有关。也就是说，此时 sass 相当于进行了下面的转化：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;seriousError&quot;</span>&gt;</span>error<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;error seriousError&quot;</span>&gt;</span>error<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>因此，像<code>.error a</code>这样的选择器，现在对<code>seriousError</code>内的<code>a</code>元素也是有效的。</p>
<p>关于继承，在实际使用中有很多的细节需要注意，这里暂不详述，有需要的可以参考<a href="https://www.sass.hk/guide/">sass 中文网</a>。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>本文涉及了大部分 sass 的基本用法，但仍然不够全面，如果在使用中遇到了其他问题，建议参考<a href="https://www.sass.hk/guide/">sass 中文网</a>。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
        <category>SCSS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
        <tag>scss</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-iOS中WKWebView和Native交互</title>
    <url>/posts/40701/</url>
    <content><![CDATA[<p>作者：jackyshan_<br>链接：<a href="https://juejin.im/post/5baafa39e51d450e664b53b4">https://juejin.im/post/5baafa39e51d450e664b53b4</a><br>来源：掘金</p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>了解本文之前需要准备 JS 和 WebView 的一些基础知识，需要知道 JS 的基本语法和 WebView 调用 JS 的常用接口。</p>
<p>iOS 实现 JS 和 Native 交互的 WebView 有 UIWebView 和 WKWebView。通过 KVC 拿到 UIWebView 的 JSContext，通过 JSContext 实现交互。 WKWebView 有了新特性 MessageHandler 来实现 JS 调用原生方法。从实现思路是来讲，UIWebView 和 WKWebView 是一样的。 所以，本文只介绍 WKWebView 上 JS 和 Native 的交互思路，UIWebView 有需求的可以模仿实现。</p>
<a id="more"></a>

<h3 id="JS-和-Native-交互常用的场景"><a href="#JS-和-Native-交互常用的场景" class="headerlink" title="JS 和 Native 交互常用的场景"></a>JS 和 Native 交互常用的场景</h3><p>常用的分为下面几种场景：</p>
<ul>
<li>H5 获取 Native 用户信息（这种比较简单，只需要 Native 注入 JS 就行了，思路有三种下面介绍）</li>
<li>H5 传递信息给 Native，调用 Native 分享（这种属于 JS 调用 Native）</li>
<li>Native 告诉 H5 分享结果（这种属于 Native 调用 JS）</li>
</ul>
<p>下面一一介绍，实现如下：</p>
<h4 id="H5-获取-Native-用户信息"><a href="#H5-获取-Native-用户信息" class="headerlink" title="H5 获取 Native 用户信息"></a>H5 获取 Native 用户信息</h4><p>现有用户信息格式如下，需要注入到 JS，供 H5 调用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> userInfo = [(<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;wb&#x27;</span>), (<span class="string">&#x27;sex&#x27;</span>: <span class="string">&#x27;male&#x27;</span>), (<span class="string">&#x27;phone&#x27;</span>: <span class="string">&#x27;12333434&#x27;</span>)];</span><br></pre></td></tr></table></figure>

<h5 id="注入-JS-变量"><a href="#注入-JS-变量" class="headerlink" title="注入 JS 变量"></a>注入 JS 变量</h5><p>Native 注入 JS 变量实现如下</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> userContent = <span class="type">WKUserContentController</span>.<span class="keyword">init</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> userInfo = [<span class="string">&quot;name&quot;</span>: <span class="string">&quot;wb&quot;</span>, <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;male&quot;</span>, <span class="string">&quot;phone&quot;</span>: <span class="string">&quot;12333434&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> userInfo.keys &#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="type">WKUserScript</span>.<span class="keyword">init</span>(source: <span class="string">&quot;var \(key) = \&quot;\(userInfo[key]!)\&quot;&quot;</span>, injectionTime: .atDocumentStart, forMainFrameOnly: <span class="literal">true</span>)</span><br><span class="line">    userContent.addUserScript(script)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> config = <span class="type">WKWebViewConfiguration</span>.<span class="keyword">init</span>()</span><br><span class="line">config.userContentController = userContent</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> wkWebView: <span class="type">WKWebView</span> = <span class="type">WKWebView</span>.<span class="keyword">init</span>(frame: <span class="type">UIScreen</span>.main.bounds, configuration: config)</span><br><span class="line">wkWebView.navigationDelegate = <span class="keyword">self</span></span><br><span class="line">wkWebView.uiDelegate = <span class="keyword">self</span></span><br><span class="line">view.addSubview(wkWebView)</span><br><span class="line">view.insertSubview(wkWebView, at: <span class="number">0</span>)</span><br><span class="line">wkWebView.load(<span class="type">URLRequest</span>.<span class="keyword">init</span>(url: <span class="type">URL</span>.<span class="keyword">init</span>(string: <span class="string">&quot;http://192.168.2.1/js.html&quot;</span>)!))</span><br></pre></td></tr></table></figure>

<p>通过遍历 userInfo 的 keys，把 key 作为变量，value 作为 String 值，注入到 JS 上下文中。</p>
<p>在 H5 中实现调用如下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>js Bridge demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">btnClick</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">try</span> &#123;</span></span><br><span class="line">          alert(name);</span><br><span class="line">          alert(sex);</span><br><span class="line">          alert(phone);</span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">catch</span> (err) &#123;</span></span><br><span class="line">          alert(err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>js demo test<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;btnClick()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 100px;&quot;</span>&gt;</span></span><br><span class="line">        test JS</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="注入-JS-对象"><a href="#注入-JS-对象" class="headerlink" title="注入 JS 对象"></a>注入 JS 对象</h5><p>Native 注入 JS 对象实现如下</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> userContent = <span class="type">WKUserContentController</span>.<span class="keyword">init</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> userInfo = [<span class="string">&quot;name&quot;</span>: <span class="string">&quot;wb&quot;</span>, <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;male&quot;</span>, <span class="string">&quot;phone&quot;</span>: <span class="string">&quot;12333434&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> jsonData = <span class="keyword">try</span>? <span class="type">JSONSerialization</span>.data(withJSONObject: userInfo, options: .prettyPrinted)</span><br><span class="line"><span class="keyword">let</span> jsonText = <span class="type">String</span>.<span class="keyword">init</span>(data: jsonData!, encoding: <span class="type">String</span>.<span class="type">Encoding</span>.utf8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> script = <span class="type">WKUserScript</span>.<span class="keyword">init</span>(source: <span class="string">&quot;var userInfo = \(jsonText!)&quot;</span>, injectionTime: .atDocumentStart, forMainFrameOnly: <span class="literal">true</span>)</span><br><span class="line">userContent.addUserScript(script)</span><br><span class="line"><span class="keyword">let</span> config = <span class="type">WKWebViewConfiguration</span>.<span class="keyword">init</span>()</span><br><span class="line">config.userContentController = userContent</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> wkWebView: <span class="type">WKWebView</span> = <span class="type">WKWebView</span>.<span class="keyword">init</span>(frame: <span class="type">UIScreen</span>.main.bounds, configuration: config)</span><br><span class="line">wkWebView.navigationDelegate = <span class="keyword">self</span></span><br><span class="line">wkWebView.uiDelegate = <span class="keyword">self</span></span><br><span class="line">view.addSubview(wkWebView)</span><br><span class="line">view.insertSubview(wkWebView, at: <span class="number">0</span>)</span><br><span class="line">wkWebView.load(<span class="type">URLRequest</span>.<span class="keyword">init</span>(url: <span class="type">URL</span>.<span class="keyword">init</span>(string: <span class="string">&quot;http://192.168.2.1/js.html&quot;</span>)!))</span><br></pre></td></tr></table></figure>

<p>通过把 userInfo 字典转化成 json，作为对象赋值给 userInfo，注入 JS 上下文中。</p>
<p>在 H5 中实现调用如下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>js Bridge demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">btnClick</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="javascript">          alert(<span class="built_in">JSON</span>.stringify(userInfo));</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">catch</span> (err) &#123;</span></span><br><span class="line">          alert(err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>js demo test<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;btnClick()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 100px;&quot;</span>&gt;</span></span><br><span class="line">        test JS</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="注入-JS-函数"><a href="#注入-JS-函数" class="headerlink" title="注入 JS 函数"></a>注入 JS 函数</h5><p>Native 注入 JS 函数实现如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> userContent = WKUserContentController.init()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> userInfo = [<span class="string">&quot;name&quot;</span>: <span class="string">&quot;wb&quot;</span>, <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;male&quot;</span>, <span class="string">&quot;phone&quot;</span>: <span class="string">&quot;12333434&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> jsonData = <span class="keyword">try</span>? JSONSerialization.data(withJSONObject: userInfo, <span class="attr">options</span>: .prettyPrinted)</span><br><span class="line"><span class="keyword">let</span> jsonText = <span class="built_in">String</span>.init(data: jsonData!, encoding: <span class="built_in">String</span>.Encoding.utf8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> script = WKUserScript.init(source: <span class="string">&quot;var iOSApp = &#123;\&quot;getUserInfo\&quot;:function()&#123;return \(jsonText!)&#125;&#125;&quot;</span>, <span class="attr">injectionTime</span>: .atDocumentStart, <span class="attr">forMainFrameOnly</span>: <span class="literal">true</span>)</span><br><span class="line">userContent.addUserScript(script)</span><br><span class="line"><span class="keyword">let</span> config = WKWebViewConfiguration.init()</span><br><span class="line">config.userContentController = userContent</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> wkWebView: WKWebView = WKWebView.init(frame: UIScreen.main.bounds, <span class="attr">configuration</span>: config)</span><br><span class="line">wkWebView.navigationDelegate = self</span><br><span class="line">wkWebView.uiDelegate = self</span><br><span class="line">view.addSubview(wkWebView)</span><br><span class="line">view.insertSubview(wkWebView, <span class="attr">at</span>: <span class="number">0</span>)</span><br><span class="line">wkWebView.load(URLRequest.init(url: URL.init(string: <span class="string">&quot;http://192.168.2.1/js.html&quot;</span>)!))</span><br></pre></td></tr></table></figure>

<p>通过封装 getUserInfo 匿名函数，执行函数 return 我们的对象，生成全局对象 iOSApp，调用<code>iOSApp.getUserInfo()</code>。 这样写的好处是，我们的 H5 在调用函数的时候，可以很容易知道哪些是原生注入，防止和本地造成冲突，便于理解。</p>
<p>在 H5 中实现调用如下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>js Bridge demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">btnClick</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="javascript">          alert(<span class="built_in">JSON</span>.stringify(iOSApp.getUserInfo()));</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">catch</span> (err) &#123;</span></span><br><span class="line">          alert(err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>js demo test<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;btnClick()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 100px;&quot;</span>&gt;</span></span><br><span class="line">        test JS</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>以上讲了三种方式实现用户信息的传递，都是通过 WKUserContentController 注入 JS 实现的，实际上我也可以通过 WebView 的 evaluateJavaScript 方法实现注入。</p>
<h5 id="evaluateJavaScript-实现注入"><a href="#evaluateJavaScript-实现注入" class="headerlink" title="evaluateJavaScript 实现注入"></a>evaluateJavaScript 实现注入</h5><p>同样的 WebView 的调用 H5，提供了 evaluateJavaScript 接口，此接口既可以执行 JS 函数回调结果，也可以注入 JS。</p>
<p>下面使用接口实现 JS 函数的注入</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> userContent = WKUserContentController.init()</span><br><span class="line"><span class="keyword">let</span> config = WKWebViewConfiguration.init()</span><br><span class="line">config.userContentController = userContent</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> wkWebView: WKWebView = WKWebView.init(frame: UIScreen.main.bounds, <span class="attr">configuration</span>: config)</span><br><span class="line">wkWebView.navigationDelegate = self</span><br><span class="line">wkWebView.uiDelegate = self</span><br><span class="line">view.addSubview(wkWebView)</span><br><span class="line">view.insertSubview(wkWebView, <span class="attr">at</span>: <span class="number">0</span>)</span><br><span class="line">wkWebView.load(URLRequest.init(url: URL.init(string: <span class="string">&quot;http://192.168.2.1/js.html&quot;</span>)!))</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//代理方法加载完成</span></span><br><span class="line">func <span class="function"><span class="title">webView</span>(<span class="params">_ webView: WKWebView, didFinish navigation: WKNavigation!</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> userInfo = [<span class="string">&quot;name&quot;</span>: <span class="string">&quot;wb&quot;</span>, <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;male&quot;</span>, <span class="string">&quot;phone&quot;</span>: <span class="string">&quot;12333434&quot;</span>]</span><br><span class="line">    <span class="keyword">let</span> jsonData = <span class="keyword">try</span>? JSONSerialization.data(withJSONObject: userInfo, <span class="attr">options</span>: .prettyPrinted)</span><br><span class="line">    <span class="keyword">let</span> jsonText = <span class="built_in">String</span>.init(data: jsonData!, encoding: <span class="built_in">String</span>.Encoding.utf8)</span><br><span class="line"></span><br><span class="line">    webView.evaluateJavaScript(<span class="string">&quot;var iOSApp = &#123;\&quot;getUserInfo\&quot;:function()&#123;return \(jsonText!)&#125;&#125;&quot;</span>, <span class="attr">completionHandler</span>: nil)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 WebView 加载完成之后，使用 evaluateJavaScript 实现了 JS 函数的注入，H5 实现调用正常。</p>
<h4 id="H5-传递信息给-Native，调用-Native-分享"><a href="#H5-传递信息给-Native，调用-Native-分享" class="headerlink" title="H5 传递信息给 Native，调用 Native 分享"></a>H5 传递信息给 Native，调用 Native 分享</h4><p>很多时候 H5 需要传递信息给我们的 Native，我们 Native 再执行相应的逻辑。</p>
<p>Native 实现代码如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> userContent = WKUserContentController.init()</span><br><span class="line">userContent.add(self, <span class="attr">name</span>: <span class="string">&quot;shareAction&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> config = WKWebViewConfiguration.init()</span><br><span class="line">config.userContentController = userContent</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> wkWebView: WKWebView = WKWebView.init(frame: UIScreen.main.bounds, <span class="attr">configuration</span>: config)</span><br><span class="line">wkWebView.navigationDelegate = self</span><br><span class="line">wkWebView.uiDelegate = self</span><br><span class="line">view.addSubview(wkWebView)</span><br><span class="line">view.insertSubview(wkWebView, <span class="attr">at</span>: <span class="number">0</span>)</span><br><span class="line">wkWebView.load(URLRequest.init(url: URL.init(string: <span class="string">&quot;http://192.168.2.1/js.html&quot;</span>)!))</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//代理方法，window.webkit.messageHandlers.xxx.postMessage(xxx)实现发送到这里</span></span><br><span class="line">func <span class="function"><span class="title">userContentController</span>(<span class="params">_ userContentController: WKUserContentController, didReceive message: WKScriptMessage</span>)</span> &#123;</span><br><span class="line">    print(message.body)</span><br><span class="line">    print(message.name)</span><br><span class="line">    print(message.frameInfo.request)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> message.name == <span class="string">&quot;shareAction&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> list = message.body <span class="keyword">as</span>! [<span class="built_in">String</span>: <span class="built_in">String</span>]</span><br><span class="line">        print(list[<span class="string">&quot;title&quot;</span>]!)</span><br><span class="line">        print(list[<span class="string">&quot;content&quot;</span>]!)</span><br><span class="line">        print(list[<span class="string">&quot;url&quot;</span>]!)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>userContent.add(self, name: &quot;shareAction&quot;)</code>本地添加 shareAction 的接口声明，当 JS 调用 shareAction 回调代理方法，实现参数捕获(WKScriptMessage)。 这样我们本地就得到了分享的传参了，然后可以调用本地 SDK 实现分享的逻辑了。</p>
<p>H5 实现代码如下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>js Bridge demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">btnClick</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">window</span>.webkit.messageHandlers.shareAction.postMessage(&#123;</span></span><br><span class="line"><span class="javascript">            title: <span class="string">&#x27;分享&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            content: <span class="string">&#x27;内容&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            url: <span class="string">&#x27;链接&#x27;</span></span></span><br><span class="line">          &#125;);</span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">catch</span> (err) &#123;</span></span><br><span class="line">          alert(err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>js demo test<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;btnClick()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 100px;&quot;</span>&gt;</span></span><br><span class="line">        test JS</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Native-告诉-H5-分享结果"><a href="#Native-告诉-H5-分享结果" class="headerlink" title="Native 告诉 H5 分享结果"></a>Native 告诉 H5 分享结果</h4><p>上面实现了 JS 传参数给 Native，但是 Native 怎么告诉 H5 分享结果呢，下面是实现逻辑。</p>
<p>Native 实现如下</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> userContent = <span class="type">WKUserContentController</span>.<span class="keyword">init</span>()</span><br><span class="line">userContent.add(<span class="keyword">self</span>, name: <span class="string">&quot;shareAction&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> config = <span class="type">WKWebViewConfiguration</span>.<span class="keyword">init</span>()</span><br><span class="line">config.userContentController = userContent</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> wkWebView: <span class="type">WKWebView</span> = <span class="type">WKWebView</span>.<span class="keyword">init</span>(frame: <span class="type">UIScreen</span>.main.bounds, configuration: config)</span><br><span class="line">wkWebView.navigationDelegate = <span class="keyword">self</span></span><br><span class="line">wkWebView.uiDelegate = <span class="keyword">self</span></span><br><span class="line">view.addSubview(wkWebView)</span><br><span class="line">view.insertSubview(wkWebView, at: <span class="number">0</span>)</span><br><span class="line">wkWebView.load(<span class="type">URLRequest</span>.<span class="keyword">init</span>(url: <span class="type">URL</span>.<span class="keyword">init</span>(string: <span class="string">&quot;http://192.168.2.1/js.html&quot;</span>)!))</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//代理方法，window.webkit.messageHandlers.xxx.postMessage(xxx)实现发送到这里</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">userContentController</span><span class="params">(<span class="keyword">_</span> userContentController: WKUserContentController, didReceive message: WKScriptMessage)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(message.body)</span><br><span class="line">    <span class="built_in">print</span>(message.name)</span><br><span class="line">    <span class="built_in">print</span>(message.frameInfo.request)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> message.name == <span class="string">&quot;shareAction&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> list = message.body <span class="keyword">as</span>! [<span class="type">Any</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> dict = list[<span class="number">0</span>] <span class="keyword">as</span>! [<span class="type">String</span>: <span class="type">String</span>]</span><br><span class="line">        <span class="built_in">print</span>(dict[<span class="string">&quot;title&quot;</span>]!)</span><br><span class="line">        <span class="built_in">print</span>(dict[<span class="string">&quot;content&quot;</span>]!)</span><br><span class="line">        <span class="built_in">print</span>(dict[<span class="string">&quot;url&quot;</span>]!)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> shareSucc = list[<span class="number">1</span>] <span class="keyword">as</span>! <span class="type">String</span><span class="comment">//获取回调JS，通知H5分享成功了</span></span><br><span class="line">        <span class="keyword">let</span> script = <span class="string">&quot;\(shareSucc)(true)&quot;</span></span><br><span class="line">        wkWebView?.evaluateJavaScript(script, completionHandler: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取 shareSucc 的函数回调名称，在合适的时候我们可以通过这个 JS 函数回调，告诉 H5 我们的分享结果。</p>
<p>JS 实现如下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>js Bridge demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">shareSucc</span>(<span class="params">isShare</span>) </span>&#123;</span></span><br><span class="line">        alert(isShare);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">btnClick</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">window</span>.webkit.messageHandlers.shareAction.postMessage([</span></span><br><span class="line"><span class="javascript">            &#123; <span class="attr">title</span>: <span class="string">&#x27;分享&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;内容&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;链接&#x27;</span> &#125;,</span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;shareSucc&#x27;</span></span></span><br><span class="line">          ]);</span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">catch</span> (err) &#123;</span></span><br><span class="line">          alert(err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>js demo test<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;btnClick()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 100px;&quot;</span>&gt;</span></span><br><span class="line">        test JS</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>之前 postMessage 是发送的字典，由于我们的需求增多了，所以还是改成数组。 最后发送 shareSucc 的字符串，告诉 Native 我们有一个 shareSucc 的函数可以接收分享的结果。</p>
<h3 id="JS-和-Native-统一封装"><a href="#JS-和-Native-统一封装" class="headerlink" title="JS 和 Native 统一封装"></a>JS 和 Native 统一封装</h3><p>上面讲了 JS 回调 Native，Native 回调 JS，实现了我们常用的一些业务逻辑。 里面有很多重复的代码，实现起来也不友好，下面我们把这些重用的全部封装一下，改成好用的接口给上层，使 Native 和 JS 的开发人员都不用操心太多的实现细节。</p>
<h4 id="H5-界面的代码"><a href="#H5-界面的代码" class="headerlink" title="H5 界面的代码"></a>H5 界面的代码</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>js Bridge demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">shareSucc</span>(<span class="params">isShare</span>) </span>&#123;</span></span><br><span class="line">        alert(isShare);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">reqUserInfoClick</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">try</span> &#123;</span></span><br><span class="line">          alert(iOSApp.getUserInfo());</span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">catch</span> (err) &#123;</span></span><br><span class="line">          alert(err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">reqShareClick</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">try</span> &#123;</span></span><br><span class="line">          iOSApp.shareAction(</span><br><span class="line"><span class="javascript">            <span class="string">&#x27;分享title&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;分享content&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;分享url&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;shareSucc&#x27;</span></span></span><br><span class="line">          );</span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">catch</span> (err) &#123;</span></span><br><span class="line">          alert(err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>js demo test<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span></span><br><span class="line">      &lt;button</span><br><span class="line">        type=&quot;button&quot;</span><br><span class="line">        onclick=&quot;reqUserInfoClick()&quot;</span><br><span class="line">        style=&quot;font-size: 100px;&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        获取用户信息</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;reqShareClick()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 100px;&quot;</span>&gt;</span></span><br><span class="line">        执行分享</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="构造基础类-JWebViewController"><a href="#构造基础类-JWebViewController" class="headerlink" title="构造基础类 JWebViewController"></a>构造基础类 JWebViewController</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  JWebViewController.swift</span></span><br><span class="line"><span class="comment">//  JSBridgeTest</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by jackyshan on 2018/9/26.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 GCI. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> WebKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JWebViewController</span>: <span class="title">UIViewController</span>, <span class="title">WKUIDelegate</span>, <span class="title">WKScriptMessageHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mAsyncScriptArray:[<span class="type">JKWkWebViewHandler</span>] = []</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mSyncScriptArray:[<span class="type">JKWkWebViewHandler</span>] = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> wkWebView: <span class="type">WKWebView?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">startUrl</span><span class="params">(<span class="keyword">_</span> url: URL)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> configuretion = <span class="type">WKWebViewConfiguration</span>()</span><br><span class="line">        configuretion.preferences = <span class="type">WKPreferences</span>()</span><br><span class="line">        configuretion.preferences.javaScriptEnabled = <span class="literal">true</span></span><br><span class="line">        configuretion.userContentController = <span class="type">WKUserContentController</span>()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.mAsyncScriptArray.<span class="built_in">count</span> != <span class="number">0</span> || <span class="keyword">self</span>.mSyncScriptArray.<span class="built_in">count</span> != <span class="number">0</span> &#123;</span><br><span class="line">            <span class="comment">// 在载入时就添加JS // 只添加到mainFrame中</span></span><br><span class="line">            <span class="keyword">let</span> script = <span class="type">WKUserScript</span>(source: createScript(), injectionTime: .atDocumentStart, forMainFrameOnly: <span class="literal">true</span>)</span><br><span class="line">            configuretion.userContentController.addUserScript(script)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//异步需要回调，所以需要添加handler</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> <span class="keyword">self</span>.mAsyncScriptArray &#123;</span><br><span class="line">            configuretion.userContentController.add(<span class="keyword">self</span>, name: item.name)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> wkWebView = <span class="type">WKWebView</span>(frame: <span class="keyword">self</span>.view.bounds, configuration: configuretion)</span><br><span class="line">        wkWebView.uiDelegate = <span class="keyword">self</span></span><br><span class="line">        <span class="keyword">self</span>.view.insertSubview(wkWebView, at: <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">let</span> request = <span class="type">URLRequest</span>(url: url)</span><br><span class="line">        wkWebView.load(request)</span><br><span class="line">        <span class="keyword">self</span>.wkWebView = wkWebView</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidDisappear</span><span class="params">(<span class="keyword">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidDisappear(animated)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//释放handler</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> <span class="keyword">self</span>.mAsyncScriptArray &#123;</span><br><span class="line">            wkWebView?.configuration.userContentController.removeScriptMessageHandler(forName: item.name)</span><br><span class="line">            wkWebView?.configuration.userContentController.removeAllUserScripts()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - 添加JS</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">addAsyncJSFunc</span><span class="params">(functionName: String, parmers: [String], action: @escaping <span class="params">([String:AnyObject])</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> obj = <span class="keyword">self</span>.mAsyncScriptArray.<span class="built_in">filter</span> &#123; (obj) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> obj.name == functionName</span><br><span class="line">        &#125;.first</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> obj == <span class="literal">nil</span> &#123;</span><br><span class="line">            obj = <span class="type">JKWkWebViewHandler</span>()</span><br><span class="line">            obj!.name = functionName</span><br><span class="line">            obj!.parmers = parmers</span><br><span class="line">            obj!.action = action</span><br><span class="line">            <span class="keyword">self</span>.mAsyncScriptArray.append(obj!)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">addSyncJSFunc</span><span class="params">(functionName: String, parmers: [String])</span></span> &#123;</span><br><span class="line">        <span class="keyword">var</span> obj = <span class="keyword">self</span>.mSyncScriptArray.<span class="built_in">filter</span> &#123; (obj) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> obj.name == functionName</span><br><span class="line">            &#125;.first</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> obj == <span class="literal">nil</span> &#123;</span><br><span class="line">            obj = <span class="type">JKWkWebViewHandler</span>()</span><br><span class="line">            obj!.name = functionName</span><br><span class="line">            obj!.parmers = parmers</span><br><span class="line">            <span class="keyword">self</span>.mSyncScriptArray.append(obj!)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - 插入JS</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">createScript</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="string">&quot;iOSApp = &#123;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> <span class="keyword">self</span>.mAsyncScriptArray &#123;</span><br><span class="line">            <span class="keyword">let</span> pars = createParmes(dict: item.parmers)</span><br><span class="line">            <span class="keyword">let</span> str = <span class="string">&quot;\&quot;\(item.name!)\&quot;:function(\(pars))&#123;window.webkit.messageHandlers.\(item.name!).postMessage([\(pars)]);&#125;,&quot;</span></span><br><span class="line">            result += str</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> <span class="keyword">self</span>.mSyncScriptArray &#123;</span><br><span class="line">            <span class="keyword">let</span> pars = createParmes(dict: item.parmers)</span><br><span class="line">            <span class="keyword">let</span> str = <span class="string">&quot;\&quot;\(item.name!)\&quot;:function()&#123;return JSON.stringify(\(pars));&#125;,&quot;</span></span><br><span class="line">            result += str</span><br><span class="line">        &#125;</span><br><span class="line">        result = (result <span class="keyword">as</span> <span class="type">NSString</span>).substring(to: result.<span class="built_in">count</span> - <span class="number">1</span>)</span><br><span class="line">        result += <span class="string">&quot;&#125;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;++++++++\(result)&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">createParmes</span><span class="params">(dict: [String])</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> dict &#123;</span><br><span class="line">            result += key + <span class="string">&quot;,&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> result.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">            result = (result <span class="keyword">as</span> <span class="type">NSString</span>).substring(to: result.<span class="built_in">count</span> - <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - 执行JS</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">actionJsFunc</span><span class="params">(functionName: String, pars: [AnyObject], completionHandler: <span class="params">(<span class="params">(<span class="keyword">Any</span>?, Error?)</span></span></span></span> -&gt; <span class="type">Void</span>)?) &#123;</span><br><span class="line">        <span class="keyword">var</span> parString = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> par <span class="keyword">in</span> pars &#123;</span><br><span class="line">            parString += <span class="string">&quot;\(par),&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> parString.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">            parString = (parString <span class="keyword">as</span> <span class="type">NSString</span>).substring(to: parString.<span class="built_in">count</span> - <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> function = <span class="string">&quot;\(functionName)(\(parString));&quot;</span></span><br><span class="line">        wkWebView?.evaluateJavaScript(function, completionHandler: completionHandler)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - WKUIDelegate</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="keyword">_</span> webView: WKWebView, runJavaScriptAlertPanelWithMessage message: String, initiatedByFrame frame: WKFrameInfo, completionHandler: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> alert = <span class="type">UIAlertController</span>(title: <span class="string">&quot;提示&quot;</span>, message: message, preferredStyle: .alert)</span><br><span class="line">        alert.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;确定&quot;</span>, style: .<span class="keyword">default</span>, handler: &#123; (<span class="keyword">_</span>) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">            <span class="comment">// We must call back js</span></span><br><span class="line">            completionHandler()</span><br><span class="line">        &#125;))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.present(alert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - WKScriptMessageHandler</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">userContentController</span><span class="params">(<span class="keyword">_</span> userContentController: WKUserContentController, didReceive message: WKScriptMessage)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> funcObjs = <span class="keyword">self</span>.mAsyncScriptArray.<span class="built_in">filter</span> &#123; (obj) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> obj.name == message.name</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> funcObj = funcObjs.first &#123;</span><br><span class="line">            <span class="keyword">let</span> pars = message.body <span class="keyword">as</span>! [<span class="type">AnyObject</span>]</span><br><span class="line">            <span class="keyword">var</span> dict: [<span class="type">String</span>: <span class="type">AnyObject</span>] = [:]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;funcObj.parmers.<span class="built_in">count</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> key = funcObj.parmers[i]</span><br><span class="line">                <span class="keyword">if</span> pars.<span class="built_in">count</span> &gt; i &#123;</span><br><span class="line">                    dict[key] = pars[i]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            funcObj.action?(dict)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JKWkWebViewHandler</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> name:<span class="type">String!</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> parmers:[<span class="type">String</span>]!</span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> action:(([<span class="type">String</span>:<span class="type">AnyObject</span>]) -&gt; <span class="type">Void</span>)?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="继承-JWebViewController，实现业务"><a href="#继承-JWebViewController，实现业务" class="headerlink" title="继承 JWebViewController，实现业务"></a>继承 JWebViewController，实现业务</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ViewController.swift</span></span><br><span class="line"><span class="comment">//  JSBridgeTest</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by jackyshan on 2018/9/26.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 GCI. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">JWebViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> userInfo = [<span class="string">&quot;name&quot;</span>: <span class="string">&quot;wb&quot;</span>, <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;male&quot;</span>, <span class="string">&quot;phone&quot;</span>: <span class="string">&quot;12333434&quot;</span>]</span><br><span class="line">        <span class="keyword">let</span> jsonData = <span class="keyword">try</span>? <span class="type">JSONSerialization</span>.data(withJSONObject: userInfo, options: .prettyPrinted)</span><br><span class="line">        <span class="keyword">let</span> jsonText = <span class="type">String</span>.<span class="keyword">init</span>(data: jsonData!, encoding: <span class="type">String</span>.<span class="type">Encoding</span>.utf8)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加getUserInfo脚本，返回用户信息</span></span><br><span class="line">        addSyncJSFunc(functionName: <span class="string">&quot;getUserInfo&quot;</span>, parmers: [jsonText!])</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加shareAction脚本，获得分享参数</span></span><br><span class="line">        addAsyncJSFunc(functionName: <span class="string">&quot;shareAction&quot;</span>, parmers: [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;sex&quot;</span>, <span class="string">&quot;phone&quot;</span>, <span class="string">&quot;shareBack&quot;</span>]) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (dict) <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(dict[<span class="string">&quot;name&quot;</span>]!)</span><br><span class="line">            <span class="built_in">print</span>(dict[<span class="string">&quot;sex&quot;</span>]!)</span><br><span class="line">            <span class="built_in">print</span>(dict[<span class="string">&quot;phone&quot;</span>]!)</span><br><span class="line"></span><br><span class="line">            <span class="comment">//执行shareBack脚本，告诉H5分享结果</span></span><br><span class="line">            <span class="keyword">self</span>?.actionJsFunc(functionName: dict[<span class="string">&quot;shareBack&quot;</span>] <span class="keyword">as</span>! <span class="type">String</span>, pars: [<span class="literal">true</span> <span class="keyword">as</span> <span class="type">AnyObject</span>], completionHandler: <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//开始加载H5</span></span><br><span class="line">        startUrl(<span class="type">URL</span>.<span class="keyword">init</span>(string: <span class="string">&quot;http://192.168.2.1/js.html&quot;</span>)!)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="讲解-JWebViewController"><a href="#讲解-JWebViewController" class="headerlink" title="讲解 JWebViewController"></a>讲解 JWebViewController</h4><p>构造 JKWkWebViewHandler 类，存储信息</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JKWkWebViewHandler</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> name:<span class="type">String!</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> parmers:[<span class="type">String</span>]!</span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> action:(([<span class="type">String</span>:<span class="type">AnyObject</span>]) -&gt; <span class="type">Void</span>)?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加 JS，使用 JKWkWebViewHandler 存储</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">addAsyncJSFunc</span><span class="params">(functionName: String, parmers: [String], action: @escaping <span class="params">([String:AnyObject])</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> obj = <span class="keyword">self</span>.mAsyncScriptArray.<span class="built_in">filter</span> &#123; (obj) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> obj.name == functionName</span><br><span class="line">    &#125;.first</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> obj == <span class="literal">nil</span> &#123;</span><br><span class="line">        obj = <span class="type">JKWkWebViewHandler</span>()</span><br><span class="line">        obj!.name = functionName</span><br><span class="line">        obj!.parmers = parmers</span><br><span class="line">        obj!.action = action</span><br><span class="line">        <span class="keyword">self</span>.mAsyncScriptArray.append(obj!)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">addSyncJSFunc</span><span class="params">(functionName: String, parmers: [String])</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> obj = <span class="keyword">self</span>.mSyncScriptArray.<span class="built_in">filter</span> &#123; (obj) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> obj.name == functionName</span><br><span class="line">        &#125;.first</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> obj == <span class="literal">nil</span> &#123;</span><br><span class="line">        obj = <span class="type">JKWkWebViewHandler</span>()</span><br><span class="line">        obj!.name = functionName</span><br><span class="line">        obj!.parmers = parmers</span><br><span class="line">        <span class="keyword">self</span>.mSyncScriptArray.append(obj!)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建 JS 脚本，使用 iOSApp 对象封装，异步回调传回 Native 的函数 window.webkit.messageHandlers.xxx 直接封装在 JS 函数中。 这样有一个好处，H5 调用 JS，<a href="http://直接iosapp.xxx/">直接 iOSApp.xxx</a>(xxx)就行了，不需要写 window.webkit.messageHandlers.xxx 这些代码。 这对于 H5 来说，跟平时写的 JS 脚本没有什么区别，方便了调用。 对于 Native 来说，帮 H5 做了 JS 的回调的封装，并通过 handler 回调得到自己想要的参数，通过这个封装，两端的工作都只需要关注 业务层就行了，继承 JWebViewController，可以专心写业务逻辑。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">createScript</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="string">&quot;iOSApp = &#123;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> <span class="keyword">self</span>.mAsyncScriptArray &#123;</span><br><span class="line">            <span class="keyword">let</span> pars = createParmes(dict: item.parmers)</span><br><span class="line">            <span class="keyword">let</span> str = <span class="string">&quot;\&quot;\(item.name!)\&quot;:function(\(pars))&#123;window.webkit.messageHandlers.\(item.name!).postMessage([\(pars)]);&#125;,&quot;</span></span><br><span class="line">            result += str</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> <span class="keyword">self</span>.mSyncScriptArray &#123;</span><br><span class="line">            <span class="keyword">let</span> pars = createParmes(dict: item.parmers)</span><br><span class="line">            <span class="keyword">let</span> str = <span class="string">&quot;\&quot;\(item.name!)\&quot;:function()&#123;return JSON.stringify(\(pars));&#125;,&quot;</span></span><br><span class="line">            result += str</span><br><span class="line">        &#125;</span><br><span class="line">        result = (result <span class="keyword">as</span> <span class="type">NSString</span>).substring(to: result.<span class="built_in">count</span> - <span class="number">1</span>)</span><br><span class="line">        result += <span class="string">&quot;&#125;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;++++++++\(result)&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造 JS，实现传参给 H5 页面</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">actionJsFunc</span><span class="params">(functionName: String, pars: [AnyObject], completionHandler: <span class="params">(<span class="params">(<span class="keyword">Any</span>?, Error?)</span></span></span></span> -&gt; <span class="type">Void</span>)?) &#123;</span><br><span class="line">    <span class="keyword">var</span> parString = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> par <span class="keyword">in</span> pars &#123;</span><br><span class="line">        parString += <span class="string">&quot;\(par),&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> parString.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">        parString = (parString <span class="keyword">as</span> <span class="type">NSString</span>).substring(to: parString.<span class="built_in">count</span> - <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> function = <span class="string">&quot;\(functionName)(\(parString));&quot;</span></span><br><span class="line">    wkWebView?.evaluateJavaScript(function, completionHandler: completionHandler)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注入 JS 脚本到 WKWebViewConfiguration 中</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> configuretion = <span class="type">WKWebViewConfiguration</span>()</span><br><span class="line">configuretion.preferences = <span class="type">WKPreferences</span>()</span><br><span class="line">configuretion.preferences.javaScriptEnabled = <span class="literal">true</span></span><br><span class="line">configuretion.userContentController = <span class="type">WKUserContentController</span>()</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">self</span>.mAsyncScriptArray.<span class="built_in">count</span> != <span class="number">0</span> || <span class="keyword">self</span>.mSyncScriptArray.<span class="built_in">count</span> != <span class="number">0</span> &#123;</span><br><span class="line">    <span class="comment">// 在载入时就添加JS // 只添加到mainFrame中</span></span><br><span class="line">    <span class="keyword">let</span> script = <span class="type">WKUserScript</span>(source: createScript(), injectionTime: .atDocumentStart, forMainFrameOnly: <span class="literal">true</span>)</span><br><span class="line">    configuretion.userContentController.addUserScript(script)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//异步需要回调，所以需要添加handler</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="keyword">self</span>.mAsyncScriptArray &#123;</span><br><span class="line">    configuretion.userContentController.add(<span class="keyword">self</span>, name: item.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> wkWebView = <span class="type">WKWebView</span>(frame: <span class="keyword">self</span>.view.bounds, configuration: configuretion)</span><br></pre></td></tr></table></figure>

<p>合适的时候释放 JS 的 handler，注意不释放的话，Controller 不会调用 deinit，发生内存泄露。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">copyoverride func viewDidDisappear(_ animated: Bool) &#123;</span><br><span class="line">    super.viewDidDisappear(animated)</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;释放handler</span><br><span class="line">    for item in self.mAsyncScriptArray &#123;</span><br><span class="line">        wkWebView?.configuration.userContentController.removeScriptMessageHandler(forName: item.name)</span><br><span class="line">        wkWebView?.configuration.userContentController.removeAllUserScripts()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码示例放到<a href="https://github.com/jackyshan/JSBridgeTest">Github</a>了，有需要的可以下载查看。</p>
]]></content>
      <categories>
        <category>移动端</category>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-web性能优化-实践</title>
    <url>/posts/47143/</url>
    <content><![CDATA[<h2 id="概括"><a href="#概括" class="headerlink" title="概括"></a>概括</h2><h4 id="涉及到的分类"><a href="#涉及到的分类" class="headerlink" title="涉及到的分类"></a>涉及到的分类</h4><ul>
<li>网络层面</li>
<li>构建层面</li>
<li>浏览器渲染层面</li>
<li>服务端层面</li>
</ul>
<h4 id="涉及到的功能点"><a href="#涉及到的功能点" class="headerlink" title="涉及到的功能点"></a>涉及到的功能点</h4><ul>
<li>资源的合并与压缩</li>
<li>图片编解码原理和类型选择</li>
<li>浏览器渲染机制</li>
<li>懒加载预加载</li>
<li>浏览器存储</li>
<li>缓存机制</li>
<li><code>PWA</code></li>
<li><code>Vue-SSR</code></li>
</ul>
<a id="more"></a>

<h2 id="资源合并与压缩"><a href="#资源合并与压缩" class="headerlink" title="资源合并与压缩"></a>资源合并与压缩</h2><h3 id="http请求的过程及潜在的性能优化点"><a href="#http请求的过程及潜在的性能优化点" class="headerlink" title="http请求的过程及潜在的性能优化点"></a><code>http</code>请求的过程及潜在的性能优化点</h3><ul>
<li>理解<code>减少http请求数量</code>和<code>减少请求资源大小</code>两个优化要点</li>
<li>掌握<code>压缩</code>与<code>合并</code>的原理</li>
<li>掌握通过<code>在线网站</code>和<code>fis3</code>两种实现压缩与合并的方法</li>
</ul>
<h4 id="浏览器的一个请求从发送到返回都经历了什么"><a href="#浏览器的一个请求从发送到返回都经历了什么" class="headerlink" title="浏览器的一个请求从发送到返回都经历了什么"></a>浏览器的一个请求从发送到返回都经历了什么</h4><p>动态的加载静态的资源</p>
<img src="/posts/47143/jingtaitupian.png" class="" title="浏览器请求过程">

<ul>
<li><code>dns</code>是否可以通过缓存减少<code>dns</code>查询时间</li>
<li>网络请求的过程走最近的网络环境</li>
<li>相同的静态资源是否可以缓存</li>
<li>能否减少<code>http</code>请求大小</li>
<li>能否减少<code>http</code>请求数量</li>
<li>服务端渲染</li>
</ul>
<h4 id="资源的合并与压缩设计到的性能点"><a href="#资源的合并与压缩设计到的性能点" class="headerlink" title="资源的合并与压缩设计到的性能点"></a>资源的合并与压缩设计到的性能点</h4><ul>
<li>减少<code>http</code>请求的数量</li>
<li>减少请求的大小</li>
</ul>
<h3 id="html压缩"><a href="#html压缩" class="headerlink" title="html压缩"></a><code>html</code>压缩</h3><blockquote>
<p><code>HTML</code>代码压缩就是压缩这些在文本文件中有意义，但是在<code>HTML</code>中不显示的字符，包括<code>空格</code>,<code>制表符</code>,<code>换行符</code>等，还有一些其他意义的字符，如<code>HTML</code>注释也可以被压缩</p>
</blockquote>
<img src="/posts/47143/html-yasuo.png" class="" title="html-压缩">

<blockquote>
<p>意义</p>
</blockquote>
<img src="/posts/47143/html-yasuoduibi.png" class="" title="html-压缩对比">

<ul>
<li>大型网站意义比较大</li>
</ul>
<h4 id="如何进行html的压缩"><a href="#如何进行html的压缩" class="headerlink" title="如何进行html的压缩"></a>如何进行<code>html</code>的压缩</h4><ul>
<li>使用在线网站进行压缩(走构建工具多，公司级在线网站手动压缩小)</li>
<li><code>node.js</code>提供了<code>html-minifier</code>工具</li>
<li>后端<code>模板引擎渲染压缩</code></li>
</ul>
<h3 id="css及js压缩"><a href="#css及js压缩" class="headerlink" title="css及js压缩"></a><code>css</code>及<code>js</code>压缩</h3><h4 id="css的压缩"><a href="#css的压缩" class="headerlink" title="css的压缩"></a><code>css</code>的压缩</h4><ul>
<li>无效代码删除<ul>
<li>注释、无效字符</li>
</ul>
</li>
<li><code>css</code>语义合并</li>
</ul>
<h4 id="css压缩的方式"><a href="#css压缩的方式" class="headerlink" title="css压缩的方式"></a><code>css</code>压缩的方式</h4><ul>
<li>使用在线网站进行压缩</li>
<li>使用<code>html-minifier</code>对<code>html</code>中的<code>css</code>进行压缩</li>
<li>使用<code>clean-css</code>对<code>css</code>进行压缩</li>
</ul>
<h4 id="js的压缩与混乱"><a href="#js的压缩与混乱" class="headerlink" title="js的压缩与混乱"></a><code>js</code>的压缩与混乱</h4><ul>
<li>无效字符的删除<ul>
<li>空格、注释、回车等</li>
</ul>
</li>
<li>剔除注释</li>
<li>代码语意的缩减和优化<ul>
<li>变量名缩短(<code>a</code>,<code>b</code>)等</li>
</ul>
</li>
<li>代码保护<ul>
<li>前端代码是透明的，客户端代码用户是可以直接看到的，可以轻易被窥探到逻辑和漏洞</li>
</ul>
</li>
</ul>
<h4 id="js压缩的方式"><a href="#js压缩的方式" class="headerlink" title="js压缩的方式"></a><code>js</code>压缩的方式</h4><ul>
<li>使用在线网站进行压缩</li>
<li>使用<code>html-minifier</code>对<code>html</code>中的<code>js</code>进行压缩</li>
<li>使用<code>uglifyjs2</code>对<code>js</code>进行压缩</li>
</ul>
<h3 id="不合并文件可能存在的问题"><a href="#不合并文件可能存在的问题" class="headerlink" title="不合并文件可能存在的问题"></a>不合并文件可能存在的问题</h3><ul>
<li>文件与文件有插入之间的上行请求，又增加了<code>N-1</code>个网络延迟</li>
<li>受丢包问题影响更严重</li>
<li>经过代理服务器时可能会被断开</li>
</ul>
<img src="/posts/47143/wenjianhebing.png" class="" title="文件合并">

<h4 id="文件合并缺点"><a href="#文件合并缺点" class="headerlink" title="文件合并缺点"></a>文件合并缺点</h4><ul>
<li>首屏渲染问题<ul>
<li>文件合并之后的<code>js</code>变大，如果首页的渲染依赖这个<code>js</code>的话，整个页面的渲染要等<code>js</code>请求完才能执行</li>
<li>如果首屏只依赖<code>a.js</code>，只要等<code>a.js</code>完成后就可执行</li>
<li>没有通过服务器端渲染，现在框架都需要等合并完的文件请求完才能执行，基本都需要等文件合并后的<code>js</code></li>
</ul>
</li>
<li>缓存失效问题<ul>
<li>标记 <code>js</code> <code>md5</code>戳</li>
<li>合并之后的<code>js</code>,任何一个改动都会导致大面积的缓存失效</li>
</ul>
</li>
</ul>
<h4 id="文件合并对应缺点的处理"><a href="#文件合并对应缺点的处理" class="headerlink" title="文件合并对应缺点的处理"></a>文件合并对应缺点的处理</h4><ul>
<li>公共库合并</li>
<li>不同页面<code>js</code>单独打包</li>
<li>见机行事，随机应变</li>
</ul>
<h4 id="文件合并对应方法"><a href="#文件合并对应方法" class="headerlink" title="文件合并对应方法"></a>文件合并对应方法</h4><ul>
<li>使用在线网站进行合并</li>
<li>构建阶段，使用<code>nodejs</code>进行文件合并</li>
</ul>
<h2 id="图片相关优化"><a href="#图片相关优化" class="headerlink" title="图片相关优化"></a>图片相关优化</h2><h3 id="一张JPG的解析过程"><a href="#一张JPG的解析过程" class="headerlink" title="一张JPG的解析过程"></a>一张<code>JPG</code>的解析过程</h3><img src="/posts/47143/img-jiexiguocheng.jpg" class="" title="img-解析过程">

<p><code>jpg</code>有损压缩：虽然损失一些信息，但是肉眼可见影响并不大</p>
<h3 id="png8-png24-png32之间的区别"><a href="#png8-png24-png32之间的区别" class="headerlink" title="png8/png24/png32之间的区别"></a><code>png8</code>/<code>png24</code>/<code>png32</code>之间的区别</h3><ul>
<li><code>png8</code> —-<code>256色</code> + 支持透明</li>
<li><code>png24</code> —-<code>2^24</code> + 不支持透明</li>
<li><code>png32</code> —<code>2^24</code> +支持透明</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">文件大小&#96; + &#96;色彩丰富程度</span><br></pre></td></tr></table></figure>

<p><code>png32</code>是在<code>png24</code>上支持了透明，针对不同的业务场景选择不同的图片格式很重要</p>
<h3 id="不同的格式图片常用的业务场景"><a href="#不同的格式图片常用的业务场景" class="headerlink" title="不同的格式图片常用的业务场景"></a>不同的格式图片常用的业务场景</h3><h4 id="不同格式图片的特点"><a href="#不同格式图片的特点" class="headerlink" title="不同格式图片的特点"></a>不同格式图片的特点</h4><ul>
<li><code>jpg</code>有损压缩，压缩率高，不支持透明</li>
<li><code>png</code>支持透明，浏览器兼容性好</li>
<li><code>webp</code>压缩程度更好，在<code>ios webview</code>中有兼容性问题</li>
<li><code>svg</code>矢量图，代码内嵌，相对较小，图片样式相对简单的场景(尽量使用，绘制能力有限，图片简单用的比较多)</li>
</ul>
<h4 id="不同格式图片的使用场景"><a href="#不同格式图片的使用场景" class="headerlink" title="不同格式图片的使用场景"></a>不同格式图片的使用场景</h4><ul>
<li><code>jpg</code>：大部分不需要透明图片的业务场景</li>
<li><code>png</code>：大部分需要透明图片的业务场景</li>
<li><code>webp</code>：<code>android</code>全部(解码速度和压缩率高于<code>jpg</code>和<code>png</code>，但是<code>ios</code> <code>safari</code>还没支持)</li>
<li><code>svg</code>：图片样式相对简单的业务场景</li>
</ul>
<h3 id="图片压缩的几种情况"><a href="#图片压缩的几种情况" class="headerlink" title="图片压缩的几种情况"></a>图片压缩的几种情况</h3><ul>
<li><p>针对真实图片情况，舍弃一些相对无关紧要的色彩信息</p>
</li>
<li><pre><code>CSS雪碧图
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  ：把你的网站用到的一些图片整合到一张单独的图片中</span><br><span class="line"></span><br><span class="line">  - 优点：减少&#96;HTTP&#96;请求的数量(通过&#96;backgroundPosition&#96;定位所需图片)</span><br><span class="line">  - 缺点：整合图片比较大时，加载比较慢(如果这张图片没有加载成功，整个页面会失去图片信息)&#96;facebook&#96;官网任然在用，主要&#96;pc&#96;用的比较多，相对性能比较强</span><br><span class="line"></span><br><span class="line">- &#96;&#96;&#96;</span><br><span class="line">  Image-inline</span><br></pre></td></tr></table></figure>

：将图片的内容嵌到

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">html</span><br></pre></td></tr></table></figure>

中(减少网站的

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP</span><br></pre></td></tr></table></figure>

请求)

- `base64信息`，减少网站的 HTTP 请求,如果图片比较小比较多，时间损耗主要在请求的骨干网络</code></pre>
</li>
<li><pre><code>使用矢量图
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  - 使用&#96;SVG&#96;进行矢量图的绘制</span><br><span class="line">  - 使用&#96;icon-font&#96;解决&#96;icon&#96;问题</span><br><span class="line"></span><br><span class="line">- &#96;&#96;&#96;</span><br><span class="line">  在android下使用webp</span><br></pre></td></tr></table></figure>

- `webp`的优势主要体现在它具有更优的图像数据压缩算法，能带来更小的图片体积，而且拥有肉眼识别无差异的图像质量；
- 同时具备了无损和有损的压缩模式、`Alpha`透明以及动画的特性，在`JPEG`和`PNG`上的转化效果都非常优秀、稳定和统一
</code></pre>
</li>
</ul>
<h2 id="css和js的装载与执行"><a href="#css和js的装载与执行" class="headerlink" title="css和js的装载与执行"></a><code>css</code>和<code>js</code>的装载与执行</h2><h3 id="HTML-页面加载渲染的过程"><a href="#HTML-页面加载渲染的过程" class="headerlink" title="HTML 页面加载渲染的过程"></a>HTML 页面加载渲染的过程</h3><h4 id="一个网站在浏览器端是如何进行渲染的"><a href="#一个网站在浏览器端是如何进行渲染的" class="headerlink" title="一个网站在浏览器端是如何进行渲染的"></a>一个网站在浏览器端是如何进行渲染的</h4><img src="/posts/47143/rendering.jpg" class="" title="页面渲染过程">

<h3 id="HTML-渲染过程中的一些特点"><a href="#HTML-渲染过程中的一些特点" class="headerlink" title="HTML 渲染过程中的一些特点"></a>HTML 渲染过程中的一些特点</h3><ul>
<li><p>顺序执行，并发加载</p>
<ul>
<li>词法分析：从上到下依次解析<ul>
<li>通过<code>HTML</code>生成<code>Token对象</code>（当前节点的所有子节点生成后，才会通过<code>next token</code>获取到当前节点的兄弟节点），最终生成<code>Dom Tree</code></li>
</ul>
</li>
<li>并发加载：资源请求是并发请求的</li>
<li>并发上限<ul>
<li>浏览器中可以支持并发请求，不同浏览器所支持的并发数量不同（以域名划分），以<code>Chrome</code>为例，并发上限为 6 个</li>
<li>优化点： 把 CDN 资源分布在多个域名下</li>
</ul>
</li>
</ul>
</li>
<li><p>是否阻塞</p>
<ul>
<li><pre><code>css
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">阻塞</span><br><span class="line"></span><br><span class="line">- &#96;&#96;&#96;</span><br><span class="line">  css</span><br></pre></td></tr></table></figure>

  在

  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">head</span><br></pre></td></tr></table></figure>

  中通过

  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">link</span><br></pre></td></tr></table></figure>

  引入会阻塞页面的渲染

  - 如果我们把`css`代码放在`head`中去引入的话，那么我们整个页面的渲染实际上就会等待`head`中`css`加载并生成`css树`，最终和`DOM`整合生成`RanderTree`之后才会进行渲染
  - 为了浏览器的渲染，能让页面显示的时候视觉上更好。 避免某些情况，如：假设你放在页面最底部，用户打开页面时，有可能出现，页面先是显示一大堆文字或图片，自上而下，丝毫没有排版和样式可言。最后，页面又恢复所要的效果

- `css`不阻塞`js`的加载，但阻塞`js`的执行

- `css`不阻塞外部脚步的加载(`webkit preloader 预资源加载器`)</code></pre>
</li>
<li><pre><code>js
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">阻塞</span><br><span class="line"></span><br><span class="line">- 直接通过</span><br><span class="line"></span><br></pre></td></tr></table></figure>
  &lt;script src&gt;
  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">引入会阻塞后面节点的渲染</span><br><span class="line"></span><br><span class="line">- &#96;html parse&#96;认为&#96;js&#96;会动态修改文档结构(&#96;document.write&#96;等方式)，没有进行后面文档的变化</span><br><span class="line"></span><br><span class="line">- &#96;&#96;&#96;</span><br><span class="line">  async</span><br></pre></td></tr></table></figure>

    、

    <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">defer</span><br></pre></td></tr></table></figure>

    (

    <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">async</span><br></pre></td></tr></table></figure>

    放弃了依赖关系)

    - `defer`属性（`&lt;script defer&gt;&lt;/script&gt;`） (这是延迟执行引入的`js`脚本（即脚本加载是不会导致解析停止，等到`document`全部解析完毕后，`defer-script`也加载完毕后，在执行所有的`defer-script`加载的`js`代码，再触发`Domcontentloaded`）

    - ```
      async
      <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">属性（</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      &lt;script async&gt;&lt;/script&gt;
      <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">          ）</span><br><span class="line"></span><br><span class="line">          - 这是异步执行引入的&#96;js&#96;脚本文件</span><br><span class="line">          - 与&#96;defer&#96;的区别是&#96;async&#96;会在加载完成后就执行，但是不会影响阻塞到解析和渲染。但是还是会阻塞&#96;load&#96;事件，所以&#96;async-script&#96;会可能在&#96;DOMcontentloaded&#96;触发前或后执行，但是一定会在&#96;load&#96;事件前触发。</span><br><span class="line"></span><br><span class="line">## 懒加载与预加载</span><br><span class="line"></span><br><span class="line">### 懒加载</span><br><span class="line"></span><br><span class="line">- 图片进入可视区域之后请求图片资源</span><br><span class="line">- 对于电商等图片很多，页面很长的业务场景适用</span><br><span class="line">- 减少无效资源的加载</span><br><span class="line">- 并发加载的资源过多会会阻塞 js 的加载，影响网站的正常使用</span><br><span class="line"></span><br><span class="line">&#96;img src&#96;被设置之后，&#96;webkit&#96;解析到之后才去请求这个资源。所以我们希望图片到达可视区域之后，&#96;img src&#96;才会被设置进来，没有到达可视区域前并不现实真正的&#96;src&#96;，而是类似一个&#96;1px&#96;的占位符。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
场景：电商图片
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">### 预加载</span><br><span class="line"></span><br><span class="line">- 图片等静态资源在使用之前的提前请求</span><br><span class="line">- 资源使用到时能从缓存中加载，提升用户体验</span><br><span class="line">- 页面展示的依赖关系维护</span><br><span class="line"></span><br></pre></td></tr></table></figure>
场景：抽奖
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">### 懒加载原生&#96;js&#96;和&#96;zepto.lazyload&#96;</span><br><span class="line"></span><br><span class="line">&gt; 原理</span><br><span class="line"></span><br><span class="line">先将&#96;img&#96;标签中的&#96;src&#96;链接设为同一张图片（空白图片），将其真正的图片地址存储再&#96;img&#96;标签的自定义属性中（比如&#96;data-src&#96;）。当&#96;js&#96;监听到该图片元素进入可视窗口时，即将自定义属性中的地址存储到&#96;src&#96;属性中，达到懒加载的效果。</span><br><span class="line"></span><br><span class="line">&gt; 注意问题：</span><br><span class="line"></span><br><span class="line">- 关注首屏处理,因为还没滑动，需要手动调用一次方法</span><br><span class="line">- 占位，图片大小首先需要预设高度，如果没有设置的话，会全部显示出来</span><br><span class="line"></span><br><span class="line">&#123;% asset_img lanjiazai.jpg 懒加载页面结构 %&#125;</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;js</span><br><span class="line">var viewheight &#x3D; document.documentElement.clientHeight; &#x2F;&#x2F;可视区域高度</span><br><span class="line"></span><br><span class="line">function lazyload() &#123;</span><br><span class="line">  var eles &#x3D; document.querySelectorAll(&#39;img[data-original][lazyload]&#39;);</span><br><span class="line"></span><br><span class="line">  Array.prototype.forEach.call(eles, function (item, index) &#123;</span><br><span class="line">    var rect;</span><br><span class="line">    if (item.dataset.original &#x3D;&#x3D;&#x3D; &#39;&#39;) return;</span><br><span class="line">    rect &#x3D; item.getBoundingClientRect(); &#x2F;&#x2F;返回元素的大小及其相对于视口的</span><br><span class="line"></span><br><span class="line">    if (rect.bottom &gt;&#x3D; 0 &amp;&amp; rect.top &lt; viewheight) &#123;</span><br><span class="line">      !(function () &#123;</span><br><span class="line">        var img &#x3D; new Image();</span><br><span class="line">        img.src &#x3D; item.dataset.url;</span><br><span class="line">        img.onload &#x3D; function () &#123;</span><br><span class="line">          item.src &#x3D; img.src;</span><br><span class="line">        &#125;;</span><br><span class="line">        item.removeAttribute(&#39;data-original&#39;);</span><br><span class="line">        item.removeAttribute(&#39;lazyload&#39;);</span><br><span class="line">      &#125;)();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lazyload();</span><br><span class="line">document.addEventListener(&#39;scroll&#39;, lazyload);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="预加载原生js和preloadJS实现"><a href="#预加载原生js和preloadJS实现" class="headerlink" title="预加载原生js和preloadJS实现"></a>预加载原生<code>js</code>和<code>preloadJS</code>实现</h3><h4 id="预加载实现的几种方式"><a href="#预加载实现的几种方式" class="headerlink" title="预加载实现的几种方式"></a>预加载实现的几种方式</h4><ul>
<li>第一种方式：直接请求下来</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;img</span><br><span class="line">  src=&quot;https://user-gold-cdn.xitu.io/2019/2/21/1690d1b216cbfa18&quot;</span><br><span class="line">  style=&quot;display: none&quot;</span><br><span class="line">/&gt;</span><br><span class="line">&lt;img</span><br><span class="line">  src=&quot;https://user-gold-cdn.xitu.io/2019/2/21/1690d1b21b70c8d2&quot;</span><br><span class="line">  style=&quot;display: none&quot;</span><br><span class="line">/&gt;</span><br><span class="line">&lt;img</span><br><span class="line">  src=&quot;https://user-gold-cdn.xitu.io/2019/2/21/1690d1b216e17e26&quot;</span><br><span class="line">  style=&quot;display: none&quot;</span><br><span class="line">/&gt;</span><br><span class="line">&lt;img</span><br><span class="line">  src=&quot;https://user-gold-cdn.xitu.io/2019/2/21/1690d1b217b3ae59&quot;</span><br><span class="line">  style=&quot;display: none&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>第二种方式：<code>image</code>对象</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> image = <span class="keyword">new</span> Image();</span><br><span class="line">image.src = <span class="string">&quot;www.pic26.com/dafdafd/safdas.jpg&quot;</span>；</span><br></pre></td></tr></table></figure>

<ul>
<li><p>第三种方式：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">XMLHttpRequest</span><br></pre></td></tr></table></figure>

<ul>
<li>缺点：存在跨域问题</li>
<li>优点：好控制</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xmlhttprequest = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">xmlhttprequest.onreadystatechange = callback;</span><br><span class="line"></span><br><span class="line">xmlhttprequest.onprogress = progressCallback;</span><br><span class="line"></span><br><span class="line">xmlhttprequest.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http:www.xxx.com&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">xmlhttprequest.send();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (xmlhttprequest.readyState == <span class="number">4</span> &amp;&amp; xmlhttprequest.status == <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> responseText = xmlhttprequest.responseText;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Request was unsuccessful:&#x27;</span> + xmlhttprequest.status);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">progressCallback</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  e = e || event;</span><br><span class="line">  <span class="keyword">if</span> (e.lengthComputable) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Received&#x27;</span> + e.loaded + <span class="string">&#x27;of&#x27;</span> + e.total + <span class="string">&#x27;bytes&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">PreloadJS模块;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>本质</strong>：<strong>权衡浏览器加载能力，让它尽可能饱和利用起来</strong></li>
</ul>
<h2 id="重绘与回流"><a href="#重绘与回流" class="headerlink" title="重绘与回流"></a>重绘与回流</h2><h3 id="css性能让javascript变慢"><a href="#css性能让javascript变慢" class="headerlink" title="css性能让javascript变慢"></a><code>css</code>性能让<code>javascript</code>变慢</h3><p>要把<code>css</code>相关的外部文件引入放进<code>head</code>中，加载<code>css</code>时，整个页面的渲染是阻塞的，同样的执行<code>javascript</code>代码的时候也是阻塞的，例如<code>javascript</code>死循环。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">一个线程   &#x3D;&gt;  javascript解析</span><br><span class="line">一个线程   &#x3D;&gt;  UI渲染</span><br></pre></td></tr></table></figure>

<p>这两个线程是互斥的，当<code>UI</code>渲染的时候，<code>javascript</code>的代码被终止。当<code>javascript</code>代码执行，<code>UI</code>线程被冻结。所以<code>css</code>的性能让<code>javascript</code>变慢。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">频繁触发重绘与回流，会导致UI频繁渲染，最终导致js变慢</span><br></pre></td></tr></table></figure>

<h3 id="什么是重绘和回流"><a href="#什么是重绘和回流" class="headerlink" title="什么是重绘和回流"></a>什么是重绘和回流</h3><h4 id="回流"><a href="#回流" class="headerlink" title="回流"></a>回流</h4><ul>
<li>当<code>render tree</code>中的一部分(或全部)因为元素的<code>规模尺寸</code>，<code>布局</code>，<code>隐藏</code>等改变而需要<code>重新构建</code>。这就成为回流(<code>reflow</code>)</li>
<li>当<code>页面布局</code>和<code>几何属性</code>改变时，就需要<code>回流</code></li>
</ul>
<h4 id="重绘"><a href="#重绘" class="headerlink" title="重绘"></a>重绘</h4><ul>
<li>当<code>render tree</code>中的一些元素需要更新属性，而这些属性只是影响元素的<code>外观</code>，<code>风格</code>，而不影响布局，比如<code>background-color</code>。就称重绘</li>
</ul>
<h4 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h4><p>用到<code>chrome</code> 分析 <code>performance</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">回流必将引起重绘，但是重绘不一定会引起回流</span><br></pre></td></tr></table></figure>

<h3 id="避免重绘、回流的两种方法"><a href="#避免重绘、回流的两种方法" class="headerlink" title="避免重绘、回流的两种方法"></a>避免重绘、回流的两种方法</h3><h4 id="触发页面重布局的一些-css-属性"><a href="#触发页面重布局的一些-css-属性" class="headerlink" title="触发页面重布局的一些 css 属性"></a>触发页面重布局的一些 css 属性</h4><ul>
<li>盒子模型相关属性会触发重布局<ul>
<li><code>width</code> / <code>height</code> / <code>min-height</code></li>
<li><code>padding</code> / <code>margin</code></li>
<li><code>display</code></li>
<li><code>border-width</code> / <code>border</code></li>
</ul>
</li>
<li>定位属性及浮动也会触发重布局<ul>
<li><code>top</code> / <code>bottom</code> / <code>left</code> / <code>right</code></li>
<li><code>position</code></li>
<li><code>float</code></li>
<li><code>clear</code></li>
</ul>
</li>
<li>改变节点内部文字结构也会触发重布局<ul>
<li><code>text-align</code> / <code>vertical-align</code></li>
<li><code>overflow</code> / <code>overflow-y</code></li>
<li><code>font-size</code> / <code>font-family</code> / <code>font-weight</code></li>
<li><code>line-height</code></li>
<li><code>white-space</code></li>
</ul>
</li>
</ul>
<p>优化点：使用不触发回流的方案替代触发回流的方案</p>
<h4 id="只触发重绘不触发回流"><a href="#只触发重绘不触发回流" class="headerlink" title="只触发重绘不触发回流"></a>只触发重绘不触发回流</h4><ul>
<li><code>color</code></li>
<li><code>border-style</code>、<code>border-radius</code></li>
<li><code>visibility</code></li>
<li><code>text-decoration</code></li>
<li><code>background</code>、<code>background-image</code>、<code>background-position</code>、<code>background-repeat</code>、<code>background-size</code></li>
<li><code>outline</code>、<code>outline-color</code>、<code>outline-style</code>、<code>outline-width</code></li>
<li><code>box-shadow</code></li>
</ul>
<h4 id="新建-DOM-的过程"><a href="#新建-DOM-的过程" class="headerlink" title="新建 DOM 的过程"></a>新建 DOM 的过程</h4><ul>
<li>获取<code>DOM</code>后分割为多个图层</li>
<li>对每个图层的节点计算样式结果(<code>Recalculate style</code> 样式重计算)</li>
<li>为每个节点生成图形和位置(<code>Layout</code> 回流和重布局)</li>
<li>将每个节点绘制填充到图层位图中(<code>Paint Setup</code>和<code>Paint</code> <code>重绘</code>)</li>
<li>图层作为纹理上传至<code>gpu</code></li>
<li>符合多个图层到页面上生成最终屏幕图像(<code>Composite Layers</code> 图层重组)</li>
</ul>
<h3 id="浏览器绘制DOM的过程是这样子的："><a href="#浏览器绘制DOM的过程是这样子的：" class="headerlink" title="浏览器绘制DOM的过程是这样子的："></a>浏览器绘制<code>DOM</code>的过程是这样子的：</h3><ul>
<li>获取 DOM 并将其分割为多个层（<code>layer</code>），将每个层独立地绘制进位图（<code>bitmap</code>）中</li>
<li>将层作为纹理（<code>texture</code>）上传至 <code>GPU</code>，复合（<code>composite</code>）多个层来生成最终的屏幕图像</li>
<li><code>left/top/margin</code>之类的属性会影响到元素在文档中的布局，当对布局（<code>layout</code>）进行动画时，该元素的布局改变可能会影响到其他元素在文档中的位置，就导致了所有被影响到的元素都要进行重新布局，浏览器需要为整个层进行重绘并重新上传到 <code>GPU</code>，造成了极大的性能开销。</li>
<li><code>transform</code> 属于合成属性（<code>composite property</code>），对合成属性进行 <code>transition/animation</code> 动画将会创建一个合成层（<code>composite layer</code>），这使得被动画元素在一个独立的层中进行动画。</li>
<li>通常情况下，浏览器会将一个层的内容先绘制进一个位图中，然后再作为纹理（<code>texture</code>）上传到 <code>GPU</code>，只要该层的内容不发生改变，就没必要进行重绘（<code>repaint</code>），浏览器会通过重新复合（<code>recomposite</code>）来形成一个新的帧。</li>
</ul>
<h4 id="chrome创建图层的条件"><a href="#chrome创建图层的条件" class="headerlink" title="chrome创建图层的条件"></a><code>chrome</code>创建图层的条件</h4><blockquote>
<p>将频繁重绘回流的 DOM 元素单独作为一个独立图层，那么这个 DOM 元素的重绘和回流的影响只会在这个图层中</p>
</blockquote>
<ul>
<li><code>3D</code>或透视变换</li>
<li><code>CSS</code>属性使用加速视频解码的 <code>&lt;video&gt;</code> 元素</li>
<li>拥有 <code>3D</code> (<code>WebGL</code>) 上下文或加速的 <code>2D</code> 上下文的 <code>&lt;canvas&gt;</code> 元素</li>
<li>复合插件(如 <code>Flash</code>)</li>
<li>进行 <code>opacity/transform</code> 动画的元素拥有加速</li>
<li><code>CSS filters</code> 的元素有一个包含复合层的后代节点(换句话说，就是一个元素拥有一个子元素，该子元素在自己的层里)</li>
<li>元素有一个 <code>z-index</code> 较低且包含一个复合层的兄弟元素(换句话说就是该元素在复合层上面渲染)</li>
</ul>
<blockquote>
<p>总结：对布局属性进行动画，浏览器需要为每一帧进行重绘并上传到 <code>GPU</code> 中对合成属性进行动画，浏览器会为元素创建一个独立的复合层，当元素内容没有发生改变，该层就不会被重绘，浏览器会通过重新复合来创建动画帧</p>
</blockquote>
<p>gif 图</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>尽量避免使用触发<code>回流</code>、<code>重绘</code>的<code>CSS</code>属性</li>
<li>将<code>重绘</code>、<code>回流</code>的影响范围限制在单独的图层(<code>layers</code>)之内</li>
<li>图层合成过程中消耗很大页面性能，这时候需要平衡考虑重绘回流的性能消耗</li>
</ul>
<h3 id="实战优化点总结"><a href="#实战优化点总结" class="headerlink" title="实战优化点总结"></a>实战优化点总结</h3><ul>
<li><p>用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">translate</span><br></pre></td></tr></table></figure>

<p>替代</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">top</span><br></pre></td></tr></table></figure>

<p>属性</p>
<ul>
<li><code>top</code>会触发<code>layout</code>，但<code>translate</code>不会</li>
</ul>
</li>
<li><p>用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">opacity</span><br></pre></td></tr></table></figure>

<p>代替</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">visibility</span><br></pre></td></tr></table></figure>

<ul>
<li><code>opacity</code>不会触发重绘也不会触发回流，只是改变图层<code>alpha</code>值，但是必须要将这个图片独立出一个图层</li>
<li><code>visibility</code>会触发重绘</li>
</ul>
</li>
<li><p>不要一条一条的修改<code>DOM</code>的样式，预先定义好<code>class</code>，然后修改<code>DOM</code>的<code>className</code></p>
</li>
<li><p><code>把DOM</code>离线后修改，比如：先把<code>DOM</code>给<code>display:none</code>（有一次<code>reflow</code>），然后你修改 100 次，然后再把它显示出来</p>
</li>
<li><p>不要把</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DOM</span><br></pre></td></tr></table></figure>

<p>节点的属性值放在一个循环里当成循环的变量</p>
<ul>
<li><code>offsetHeight</code>、<code>offsetWidth</code>每次都要刷新缓冲区，缓冲机制被破坏</li>
<li>先用变量存储下来</li>
</ul>
</li>
<li><p>不要使用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">table</span><br></pre></td></tr></table></figure>

<p>布局，可能很小的一个小改动会造成整个</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">table</span><br></pre></td></tr></table></figure>

<p>的重新布局</p>
<ul>
<li><code>div</code>只会影响后续样式的布局</li>
</ul>
</li>
<li><p>动画实现的速度的选择</p>
<ul>
<li>选择合适的动画速度</li>
<li>根据<code>performance</code>量化性能优化</li>
</ul>
</li>
<li><p>对于动画新建图层</p>
<ul>
<li><p>启用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gpu</span><br></pre></td></tr></table></figure>

<p>硬件加速(并行运算)，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gpu加速</span><br></pre></td></tr></table></figure>

<p>意味着数据需要从</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cpu</span><br></pre></td></tr></table></figure>

<p>走总线到</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gpu</span><br></pre></td></tr></table></figure>

<p>传输，需要考虑传输损耗.</p>
<ul>
<li><code>transform:translateZ(0)</code></li>
<li><code>transform:translate3D(0)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/posts/47143/gpu-speed.png" class="" title="gpu加速">

<h2 id="浏览器存储"><a href="#浏览器存储" class="headerlink" title="浏览器存储"></a>浏览器存储</h2><h3 id="cookies"><a href="#cookies" class="headerlink" title="cookies"></a><code>cookies</code></h3><h4 id="多种浏览器存储方式并存，如何选择？"><a href="#多种浏览器存储方式并存，如何选择？" class="headerlink" title="多种浏览器存储方式并存，如何选择？"></a>多种浏览器存储方式并存，如何选择？</h4><img src="/posts/47143/cookie.jpg" class="" title="cookie">

<ul>
<li><p>因为<code>http</code>请求无状态，所以需要<code>cookie</code>去维持客户端状态</p>
</li>
<li><pre><code>cookie
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">的生成方式：</span><br><span class="line"></span><br><span class="line">- &#96;http&#96;–&gt;&#96;response header&#96;–&gt;&#96;set-cookie&#96;</span><br><span class="line"></span><br><span class="line">- &#96;js&#96;中可以通过&#96;document.cookie&#96;可以读写&#96;cookie&#96;</span><br><span class="line"></span><br><span class="line">- &#96;&#96;&#96;</span><br><span class="line">  cookie</span><br></pre></td></tr></table></figure>

  的使用用处：

  - 用于浏览器端和服务器端的交互(用户状态)
  - 客户端自身数据的存储</code></pre>
</li>
<li><p><code>expire</code>：过期时间</p>
</li>
<li><pre><code>cookie
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  的限制：</span><br><span class="line"></span><br><span class="line">  - 作为浏览器存储，大小&#96;4kb&#96;左右</span><br><span class="line">  - 需要设置过期时间 &#96;expire&#96;</span><br><span class="line"></span><br><span class="line">- 重要属性：&#96;httponly&#96; 不支持&#96;js&#96;读写(防止收到模拟请求攻击)</span><br><span class="line"></span><br><span class="line">- 不太作为存储方案而是用于维护客户关系</span><br><span class="line"></span><br><span class="line">- 优化点：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
cookie
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  中在相关域名下面</span><br><span class="line"></span><br><span class="line">  - &#96;cdn&#96;的流量损耗</span><br><span class="line">  - 解决方案：&#96;cdn&#96;的域名和主站域名要分开</span><br><span class="line"></span><br><span class="line">### WebStorage</span><br><span class="line"></span><br><span class="line">#### localstorage</span><br><span class="line"></span><br><span class="line">- &#96;HTML5&#96;设计出来专门用于浏览器存储的</span><br><span class="line">- 大小为&#96;5M&#96;左右</span><br><span class="line">- 仅在客户端使用，不和服务端进行通信</span><br><span class="line">- 接口封装较好</span><br><span class="line">- 浏览器本地缓存方案</span><br><span class="line"></span><br><span class="line">#### sessionstorage</span><br><span class="line"></span><br><span class="line">- 会话级别的浏览器存储</span><br><span class="line">- 大小为&#96;5M&#96;左右</span><br><span class="line">- 仅在客户端使用，不和服务器端进行通信</span><br><span class="line">- 接口封装较好</span><br><span class="line">- 对于表单信息的维护</span><br><span class="line"></span><br><span class="line">### indexedDB</span><br><span class="line"></span><br><span class="line">- &#96;IndexedDB&#96;是一种低级&#96;API&#96;，用于客户端存储大量结构化数据。该&#96;API&#96;使用索引来实现对该数据的高性能搜索。虽然&#96;Web&#96;</span><br><span class="line">- &#96;Storage&#96;对于存储叫少量的数据很管用，但对于存储更大量的结构化数据来说，这种方法不太有用。&#96;IndexedDB&#96;提供了一个解决方案。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
为应用创建离线版本
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- &#96;cdn&#96;域名不要带&#96;cookie&#96;</span><br><span class="line">- &#96;localstorage&#96;存库、图片</span><br><span class="line"></span><br><span class="line">&#96;cookie&#96;种在主站下，二级域名也会携带这个域名，造成流量的浪费</span><br><span class="line"></span><br><span class="line">### Service Worker 产生的意义</span><br><span class="line"></span><br><span class="line">### PWA 与 Service Worker</span><br><span class="line"></span><br><span class="line">- &#96;PWA&#96;(&#96;Progressive Web Apps&#96;)是一种&#96;Web App&#96;新模型，并不是具体指某一种前言的技术或者某一个单一的知识点，我们从英文缩写来看就能看出来，这是一个渐进式的&#96;Web App&#96;，是通过一系列新的&#96;Web特性&#96;，配合优秀的&#96;UI&#96;交互设计，逐步增强&#96;Web App&#96;的用户体验</span><br><span class="line"></span><br><span class="line">#### chrome 插件 lighthouse</span><br><span class="line"></span><br><span class="line">&gt; 检测是不是一个渐进式&#96;web app&#96;</span><br><span class="line"></span><br><span class="line">- 当前手机在弱网环境下能不能加载出来</span><br><span class="line">- 离线环境下能不能加载出来</span><br><span class="line"></span><br><span class="line">&gt; 特点</span><br><span class="line"></span><br><span class="line">- 可靠：没有网络的环境中也能提供基本的页面访问，而不会出现“未连接到互联网”的页面</span><br><span class="line">- 快速：针对网页渲染及网络数据访问有较好的优化</span><br><span class="line">- 融入(&#96;Engaging&#96;)：应用可以被增加到手机桌面，并且和普通应用一样有全屏、推送等特性</span><br><span class="line"></span><br><span class="line">#### service worker</span><br><span class="line"></span><br><span class="line">&gt; &#96;service worker&#96;是一个脚本，浏览器独立于当前页面，将其在后台运行，为实现一些不依赖页面的或者用户交互的特性打开了一扇大门。在未来这些特性将包括消息推送，背景后台同步，&#96;geofencing&#96;(地理围栏定位)，但他将推出的第一个首要的特性，就是拦截和处理网络请求的能力，包括以编程方式来管理被缓存的响应。</span><br><span class="line"></span><br><span class="line">&#123;% asset_img service-worker.png service-worker %&#125;</span><br><span class="line"></span><br><span class="line">#### 案例分析</span><br><span class="line"></span><br><span class="line">[Service Worker 学习与实践](https:&#x2F;&#x2F;juejin.im&#x2F;post&#x2F;5ba0fe356fb9a05d2c43a25c)</span><br><span class="line"></span><br><span class="line">[了解 servie worker](https:&#x2F;&#x2F;link.juejin.im&#x2F;?target&#x3D;http%3A%2F%2Fkailian.github.io%2F2017%2F03%2F01%2Fservice-worker%23🐉)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
copychrome://serviceworker-internals/
chrome://inspect/#service-worker/
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&#96;service worker&#96;网络拦截能力，存储&#96;Cache Storage&#96;，实现离线应用</span><br><span class="line"></span><br><span class="line">#### indexedDB</span><br><span class="line"></span><br><span class="line">&#123;% asset_img indexdb.png indexdb %&#125;</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;js</span><br><span class="line">callback &amp;&amp; callback()写法</span><br><span class="line">相当于</span><br><span class="line">if(callback)&#123;</span><br><span class="line">   callback();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h3 id="cookie、session、localStorage、sessionStorage基本操作"><a href="#cookie、session、localStorage、sessionStorage基本操作" class="headerlink" title="cookie、session、localStorage、sessionStorage基本操作"></a><code>cookie</code>、<code>session</code>、<code>localStorage</code>、<code>sessionStorage</code>基本操作</h3><h3 id="indexedDB基本操作"><a href="#indexedDB基本操作" class="headerlink" title="indexedDB基本操作"></a><code>indexedDB</code>基本操作</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">object store:对象存储本身就是结构化存储</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">openDB</span>(<span class="params">name, callback</span>) </span>&#123;</span><br><span class="line">           <span class="comment">//建立打开indexdb  indexedDB.open</span></span><br><span class="line">           <span class="keyword">var</span> request = <span class="built_in">window</span>.indexedDB.open(name)</span><br><span class="line">           request.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">               <span class="built_in">console</span>.log(<span class="string">&#x27;on indexedDB error&#x27;</span>)</span><br><span class="line">           &#125;</span><br><span class="line">           request.onsuccess = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">                   myDB.db = e.target.result</span><br><span class="line">                   callback &amp;&amp; callback()</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">//from no database to first version,first version to second version...</span></span><br><span class="line">           request.onupgradeneeded = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">               <span class="built_in">console</span>.log(<span class="string">&#x27;created&#x27;</span>)</span><br><span class="line">               <span class="keyword">var</span> store = request.result.createObjectStore(<span class="string">&#x27;books&#x27;</span>, &#123;</span><br><span class="line">                   keyPath: <span class="string">&#x27;isbn&#x27;</span></span><br><span class="line">               &#125;)</span><br><span class="line">               <span class="built_in">console</span>.log(store)</span><br><span class="line">               <span class="keyword">var</span> titleIndex = store.createIndex(<span class="string">&#x27;by_title&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, &#123;</span><br><span class="line">                   unique: <span class="literal">true</span></span><br><span class="line">               &#125;)</span><br><span class="line">               <span class="keyword">var</span> authorIndex = store.createIndex(<span class="string">&#x27;by_author&#x27;</span>, <span class="string">&#x27;author&#x27;</span>)</span><br><span class="line"></span><br><span class="line">               store.put(&#123;</span><br><span class="line">                   title: <span class="string">&#x27;quarry memories&#x27;</span>,</span><br><span class="line">                   author: <span class="string">&#x27;fred&#x27;</span>,</span><br><span class="line">                   isbn: <span class="number">123456</span></span><br><span class="line">               &#125;)</span><br><span class="line">               store.put(&#123;</span><br><span class="line">                   title: <span class="string">&#x27;dafd memories&#x27;</span>,</span><br><span class="line">                   author: <span class="string">&#x27;frdfaded&#x27;</span>,</span><br><span class="line">                   isbn: <span class="number">12345</span></span><br><span class="line">               &#125;)</span><br><span class="line">               store.put(&#123;</span><br><span class="line">                   title: <span class="string">&#x27;dafd medafdadmories&#x27;</span>,</span><br><span class="line">                   author: <span class="string">&#x27;frdfdsafdafded&#x27;</span>,</span><br><span class="line">                   isbn: <span class="number">12345434</span></span><br><span class="line">               &#125;)</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">var</span> myDB = &#123;</span><br><span class="line">           name: <span class="string">&#x27;tesDB&#x27;</span>,</span><br><span class="line">           version: <span class="string">&#x27;2.0.1&#x27;</span>,</span><br><span class="line">           db: <span class="literal">null</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">function</span> <span class="title">addData</span>(<span class="params">db, storeName</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       openDB(myDB.name, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           <span class="comment">// myDB.db = e.target.result</span></span><br><span class="line">           <span class="comment">// window.indexedDB.deleteDatabase(myDB.name)</span></span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//删除indexedDB</span></span><br></pre></td></tr></table></figure>

<h3 id="indexDB事务"><a href="#indexDB事务" class="headerlink" title="indexDB事务"></a><code>indexDB</code>事务</h3><p><code>transcation</code> 与 <code>object store</code>建立关联关系来操作<code>object store</code> 建立之初可以配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> transcation = db.transcation(<span class="string">&#x27;books&#x27;</span>, <span class="string">&#x27;readwrite&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> store = transcation.objectStore(<span class="string">&#x27;books&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = store.get(<span class="number">34314</span>);</span><br><span class="line">store.delete(<span class="number">2334</span>);</span><br><span class="line">store.add(&#123;</span><br><span class="line">  title: <span class="string">&#x27;dafd medafdadmories&#x27;</span>,</span><br><span class="line">  author: <span class="string">&#x27;frdfdsafdafded&#x27;</span>,</span><br><span class="line">  isbn: <span class="number">12345434</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Service-Worker离线应用"><a href="#Service-Worker离线应用" class="headerlink" title="Service Worker离线应用"></a><code>Service Worker</code>离线应用</h3><p><code>serviceworker</code>需要<code>https</code>协议</p>
<h3 id="如何实现ServiceWorker与主页面之间的通信"><a href="#如何实现ServiceWorker与主页面之间的通信" class="headerlink" title="如何实现ServiceWorker与主页面之间的通信"></a>如何实现<code>ServiceWorker</code>与主页面之间的通信</h3><p><a href="https://link.juejin.im/?target=https://lavas.baidu.com/guide/v1/foundation/lavas-start">lavas</a></p>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><blockquote>
<p>期望大规模数据能自动化缓存，而不是手动进行缓存，需要浏览器端和服务器端协商一种缓存机制</p>
</blockquote>
<blockquote>
<ul>
<li>Cache-Control 所控制的缓存策略</li>
<li>last-modified 和 etag 以及整个服务端浏览器端的缓存流程</li>
<li>基于 node 实践以上缓存方式</li>
</ul>
</blockquote>
<h3 id="httpheader"><a href="#httpheader" class="headerlink" title="httpheader"></a><code>httpheader</code></h3><h4 id="可缓存性"><a href="#可缓存性" class="headerlink" title="可缓存性"></a>可缓存性</h4><ul>
<li><code>public</code>:表明响应可以被任何对象（包括：发送请求的客户端，代理服务器，等等）缓存。</li>
<li><code>private</code>:表明响应只能被单个用户缓存，不能作为共享缓存（即代理服务器不能缓存它）。</li>
<li><code>no-cache</code>:强制所有缓存了该响应的缓存用户，在使用已存储的缓存数据前，发送带验证器的请求到原始服务器</li>
<li><code>only-if-cached</code>:表明如果缓存存在，只使用缓存，无论原始服务器数据是否有更新</li>
</ul>
<h4 id="到期"><a href="#到期" class="headerlink" title="到期"></a>到期</h4><ul>
<li><code>max-age=&lt;seconds&gt;</code>:设置缓存存储的最大周期，超过这个时间缓存被认为过期(单位秒)。与<code>Expires</code>相反，时间是相对于请求的时间。</li>
<li><code>s-maxage=&lt;seconds&gt;</code>:覆盖<code>max-age</code> 或者 <code>Expires</code> 头，但是仅适用于共享缓存(比如各个代理)，并且私有缓存中它被忽略。<code>cdn</code>缓存</li>
<li><code>max-stale[=&lt;seconds&gt;]</code> 表明客户端愿意接收一个已经过期的资源。 可选的设置一个时间(单位秒)，表示响应不能超过的过时时间。</li>
<li><code>min-fresh=&lt;seconds&gt;</code> 表示客户端希望在指定的时间内获取最新的响应。</li>
</ul>
<h4 id="重新验证-和-重新加载"><a href="#重新验证-和-重新加载" class="headerlink" title="重新验证 和 重新加载"></a>重新验证 和 重新加载</h4><blockquote>
<p>重新验证</p>
</blockquote>
<ul>
<li><code>must-revalidate</code>：缓存必须在使用之前验证旧资源的状态，并且不可使用过期资源。</li>
<li><code>proxy-revalidate</code>：与<code>must-revalidate</code>作用相同，但它仅适用于共享缓存（例如代理），并被私有缓存忽略。</li>
<li><code>immutable</code> ：表示响应正文不会随时间而改变。资源（如果未过期）在服务器上不发生改变，因此客户端不应发送重新验证请求头（例如<code>If-None-Match</code>或<code>If-Modified-Since</code>）来检查更新，即使用户显式地刷新页面。在<code>Firefox</code>中，<code>immutable</code>只能被用在 <code>https:// transactions</code>.</li>
</ul>
<blockquote>
<p>重新加载</p>
</blockquote>
<ul>
<li><code>no-store</code>:缓存不应存储有关客户端请求或服务器响应的任何内容。</li>
<li><code>no-transform</code>:不得对资源进行转换或转变。<code>Content-Encoding</code>,<code>Content-Range</code>, <code>Content-Type</code>等<code>HTTP</code>头不能由代理修改。例如，非透明代理可以对图像格式进行转换，以便节省缓存空间或者减少缓慢链路上的流量。 <code>no-transform</code>指令不允许这样做。</li>
</ul>
<h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><ul>
<li>缓存过期时间，用来指定资源到期的时间，是服务器端的时间点</li>
<li>告诉浏览器在过期时间前浏览器可以直接从浏览器缓存中存取数据，而无需再次请求</li>
<li><code>expires</code>是<code>http1.0</code>的时候的</li>
<li><code>http1.1</code>时候，我们希<code>望cache</code>的管理统一进行，<code>max-age</code>优先级高于<code>expires</code>，当有<code>max-age</code>在的时候<code>expires</code>可能就会被忽略。</li>
<li>如果没有设置<code>cache-control</code>时候会使用<code>expires</code></li>
</ul>
<h3 id="Last-modified-和-If-Modified-since"><a href="#Last-modified-和-If-Modified-since" class="headerlink" title="Last-modified 和 If-Modified-since"></a>Last-modified 和 If-Modified-since</h3><ul>
<li>基于客户端和服务器端协商的缓存机制</li>
<li><code>last-modified</code> –&gt; <code>response header</code><br><code>if-modified-since</code> –&gt; <code>request header</code></li>
<li>需要与<code>cache-control</code>共同使用</li>
</ul>
<blockquote>
<p><code>last-modified</code>有什么缺点？</p>
</blockquote>
<ul>
<li>某些服务端不能获取精确的修改时间</li>
<li>文件修改时间改了，但文件的内容却没有变</li>
</ul>
<h3 id="Etag-和-If-none-match"><a href="#Etag-和-If-none-match" class="headerlink" title="Etag 和 If-none-match"></a>Etag 和 If-none-match</h3><ul>
<li>文件内容的 hash 值</li>
<li><code>etag</code> –&gt;<code>reponse header</code><br><code>if-none-match</code> –&gt;<code>request header</code></li>
<li>需要与<code>cache-control</code>共同使用</li>
</ul>
<p>好处：</p>
<ul>
<li>比<code>if-modified-since</code>更加准确</li>
<li>优先级比<code>etage</code>更高</li>
</ul>
<img src="/posts/47143/fenjihuancun.jpg" class="" title="分级缓存策略">

<h3 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h3><img src="/posts/47143/fenjihuancun-liuchengtu.png" class="" title="流程图">

<img src="/posts/47143/liuchengtu2.png" class="" title="流程图2">

<h2 id="服务端性能优化"><a href="#服务端性能优化" class="headerlink" title="服务端性能优化"></a>服务端性能优化</h2><p>服务端用的 node.js 因为和前端用的同一种语言，可以利用服务端运算能力来进行相关的运算而减少前端的运算</p>
<ul>
<li><code>vue</code>渲染遇到的问题</li>
<li><code>vue-ssr</code>和原理和引用</li>
</ul>
<h3 id="vue-渲染面临的问题"><a href="#vue-渲染面临的问题" class="headerlink" title="vue 渲染面临的问题"></a>vue 渲染面临的问题</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">先加载vue.js</span><br><span class="line">&#x3D;&gt;  执行vue.js代码</span><br><span class="line">&#x3D;&gt;  生成html</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以前没有前端框架时，</p>
</blockquote>
<ul>
<li><p>用<code>jsp/php</code>在服务端进行数据的填充，发送给客户端就是已经<code>填充好数据</code>的 html</p>
</li>
<li><p>使用<code>jQuery</code>异步加载数据</p>
</li>
<li><p>使用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">React</span><br></pre></td></tr></table></figure>

<p>和</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Vue</span><br></pre></td></tr></table></figure>

<p>前端框架</p>
<ul>
<li>代价：需要框架全部加载完，才能把页面渲染出来，页面的首屏性能不好</li>
</ul>
</li>
</ul>
<h3 id="多层次的优化方案"><a href="#多层次的优化方案" class="headerlink" title="多层次的优化方案"></a>多层次的优化方案</h3><ul>
<li>构建层的模板编译。<code>runtime</code>,<code>compile</code>拆开,构建层做模板编译工作。<code>webpack</code>构建时候，统一，直接编译成<code>runtime</code>可以执行的代码</li>
<li>数据无关的<code>prerender</code>的方式</li>
<li>服务端渲染</li>
</ul>
<img src="/posts/47143/service-side-rendering.png" class="" title="服务端渲染">

<h2 id="文章来源"><a href="#文章来源" class="headerlink" title="文章来源"></a>文章来源</h2><ul>
<li><a href="https://juejin.im/post/5c011e0c5188252ea66afdfa">前端面试之路四(web 性能优化篇)</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>性能优化</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>性能优化</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-如何高性能的渲染十万条数据(虚拟列表)</title>
    <url>/posts/17134/</url>
    <content><![CDATA[<p>转载自：<a href="https://github.com/chenqf/frontEndBlog/issues/16">https://github.com/chenqf/frontEndBlog/issues/16</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在工作中，有时会遇到需要一些不能使用分页方式来加载列表数据的业务情况，对于此，我们称这种列表叫做<code>长列表</code>。比如，在一些外汇交易系统中，前端会实时的展示用户的持仓情况(收益、亏损、手数等)，此时对于用户的持仓列表一般是不能分页的。</p>
<p>在<a href="https://juejin.im/post/5d76f469f265da039a28aff7">高性能渲染十万条数据(时间分片)</a>一文中，提到了可以使用<code>时间分片</code>的方式来对长列表进行渲染，但这种方式更适用于列表项的 DOM 结构十分简单的情况。本文会介绍使用<code>虚拟列表</code>的方式，来同时加载大量数据。</p>
<a id="more"></a>

<h2 id="为什么需要使用虚拟列表"><a href="#为什么需要使用虚拟列表" class="headerlink" title="为什么需要使用虚拟列表"></a>为什么需要使用虚拟列表</h2><p>假设我们的长列表需要展示 10000 条记录，我们同时将 10000 条记录渲染到页面中，先来看看需要花费多长时间：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;button id=<span class="string">&quot;button&quot;</span>&gt;button&lt;/button&gt;&lt;br&gt;</span><br><span class="line">&lt;ul id=<span class="string">&quot;container&quot;</span>&gt;&lt;/ul&gt;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;button&#x27;</span>).addEventListener(<span class="string">&#x27;click&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 记录任务开始时间</span></span><br><span class="line">    <span class="keyword">let</span> now = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="comment">// 插入一万条数据</span></span><br><span class="line">    <span class="keyword">const</span> total = <span class="number">10000</span>;</span><br><span class="line">    <span class="comment">// 获取容器</span></span><br><span class="line">    <span class="keyword">let</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;container&#x27;</span>);</span><br><span class="line">    <span class="comment">// 将数据插入容器中</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; total; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> li = <span class="built_in">document</span>.createElement(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">        li.innerText = ~~(<span class="built_in">Math</span>.random() * total)</span><br><span class="line">        ul.appendChild(li);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;JS运行时间：&#x27;</span>,<span class="built_in">Date</span>.now() - now);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;总运行时间：&#x27;</span>,<span class="built_in">Date</span>.now() - now);</span><br><span class="line">    &#125;,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// print JS运行时间： 38</span></span><br><span class="line">    <span class="comment">// print 总运行时间： 957</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>当我们点击按钮，会同时向页面中加入一万条记录，通过控制台的输出，我们可以粗略的统计到，JS 的运行时间为<code>38ms</code>,但渲染完成后的总时间为<code>957ms</code>。</p>
<p>简单说明一下，为何两次<code>console.log</code>的结果时间差异巨大，并且是如何简单来统计<code>JS运行时间</code>和<code>总渲染时间</code>：</p>
<ul>
<li>在 JS 的<code>Event Loop</code>中，当 JS 引擎所管理的执行栈中的事件以及所有微任务事件全部执行完后，才会触发渲染线程对页面进行渲染</li>
<li>第一个<code>console.log</code>的触发时间是在页面进行渲染之前，此时得到的间隔时间为 JS 运行所需要的时间</li>
<li>第二个<code>console.log</code>是放到 setTimeout 中的，它的触发时间是在渲染完成，在下一次<code>Event Loop</code>中执行的</li>
</ul>
<p><a href="https://juejin.im/post/5d5b4c2df265da03dd3d73e5">关于 Event Loop 的详细内容请参见这篇文章–&gt;</a></p>
<p>然后，我们通过<code>Chrome</code>的<code>Performance</code>工具来详细的分析这段代码的性能瓶颈在哪里：</p>
<img src="/posts/17134/Performance.gif" class="" title="Performance">

<p>从<code>Performance</code>可以看出，代码从执行到渲染结束，共消耗了<code>960.8ms</code>,其中的主要时间消耗如下：</p>
<ul>
<li>Event(click) : <code>40.84ms</code></li>
<li>Recalculate Style : <code>105.08ms</code></li>
<li>Layout : <code>731.56ms</code></li>
<li>Update Layer Tree : <code>58.87ms</code></li>
<li>Paint : <code>15.32ms</code></li>
</ul>
<p>从这里我们可以看出，我们的代码的执行过程中，消耗时间最多的两个阶段是<code>Recalculate Style</code>和<code>Layout</code>。</p>
<ul>
<li><code>Recalculate Style</code>：样式计算，浏览器根据 css 选择器计算哪些元素应该应用哪些规则，确定每个元素具体的样式。</li>
<li><code>Layout</code>：布局，知道元素应用哪些规则之后，浏览器开始计算它要占据的空间大小及其在屏幕的位置。</li>
</ul>
<p>在实际的工作中，列表项必然不会像例子中仅仅只由一个 li 标签组成，必然是由复杂 DOM 节点组成的。</p>
<p>那么可以想象的是，当列表项数过多并且列表项结构复杂的时候，同时渲染时，会在<code>Recalculate Style</code>和<code>Layout</code>阶段消耗大量的时间。</p>
<p>而<code>虚拟列表</code>就是解决这一问题的一种实现。</p>
<h2 id="什么是虚拟列表"><a href="#什么是虚拟列表" class="headerlink" title="什么是虚拟列表"></a>什么是虚拟列表</h2><p><code>虚拟列表</code>其实是按需显示的一种实现，即只对<code>可见区域</code>进行渲染，对<code>非可见区域</code>中的数据不渲染或部分渲染的技术，从而达到极高的渲染性能。</p>
<p>假设有 1 万条记录需要同时渲染，我们屏幕的<code>可见区域</code>的高度为<code>500px</code>,而列表项的高度为<code>50px</code>，则此时我们在屏幕中最多只能看到 10 个列表项，那么在首次渲染的时候，我们只需加载 10 条即可。</p>
<img src="/posts/17134/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f31302f32392f313665313531393563663136613535383f773d35303626683d36343226663d706e6726733d3338343436.png" class="" title="img">

<p>说完首次加载，再分析一下当滚动发生时，我们可以通过计算当前滚动值得知此时在屏幕<code>可见区域</code>应该显示的列表项。</p>
<p>假设滚动发生，滚动条距顶部的位置为<code>150px</code>,则我们可得知在<code>可见区域</code>内的列表项为<code>第4项</code>至`第 13 项。</p>
<img src="/posts/17134/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f31302f32392f313665313531393763323733636264393f773d35303626683d36373726663d706e6726733d3430343030.png" class="" title="img">

<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>虚拟列表的实现，实际上就是在首屏加载的时候，只加载<code>可视区域</code>内需要的列表项，当滚动发生时，动态通过计算获得<code>可视区域</code>内的列表项，并将<code>非可视区域</code>内存在的列表项删除。</p>
<ul>
<li>计算当前<code>可视区域</code>起始数据索引(<code>startIndex</code>)</li>
<li>计算当前<code>可视区域</code>结束数据索引(<code>endIndex</code>)</li>
<li>计算当前<code>可视区域的</code>数据，并渲染到页面中</li>
<li>计算<code>startIndex</code>对应的数据在整个列表中的偏移位置<code>startOffset</code>并设置到列表上</li>
</ul>
<img src="/posts/17134/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f31302f32392f313665313531396133393364656532633f773d37313926683d36373726663d706e6726733d3536393032.png" class="" title="img">

<p>由于只是对<code>可视区域</code>内的列表项进行渲染，所以为了保持列表容器的高度并可正常的触发滚动，将 Html 结构设计成如下结构：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;infinite-list-container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;infinite-list-phantom&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;infinite-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- item-1 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- item-2 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ...... --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- item-n --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>infinite-list-container</code> 为<code>可视区域</code>的容器</li>
<li><code>infinite-list-phantom</code> 为容器内的占位，高度为总列表高度，用于形成滚动条</li>
<li><code>infinite-list</code> 为列表项的<code>渲染区域</code></li>
</ul>
<p>接着，监听<code>infinite-list-container</code>的<code>scroll</code>事件，获取滚动位置<code>scrollTop</code></p>
<ul>
<li>假定<code>可视区域</code>高度固定，称之为<code>screenHeight</code></li>
<li>假定<code>列表每项</code>高度固定，称之为<code>itemSize</code></li>
<li>假定<code>列表数据</code>称之为<code>listData</code></li>
<li>假定<code>当前滚动位置</code>称之为<code>scrollTop</code></li>
</ul>
<p>则可推算出：</p>
<ul>
<li>列表总高度<code>listHeight</code> = listData.length * itemSize</li>
<li>可显示的列表项数<code>visibleCount</code> = Math.ceil(screenHeight / itemSize)</li>
<li>数据的起始索引<code>startIndex</code> = Math.floor(scrollTop / itemSize)</li>
<li>数据的结束索引<code>endIndex</code> = startIndex + visibleCount</li>
<li>列表显示数据为<code>visibleData</code> = listData.slice(startIndex,endIndex)</li>
</ul>
<p>当滚动后，由于<code>渲染区域</code>相对于<code>可视区域</code>已经发生了偏移，此时我需要获取一个偏移量<code>startOffset</code>，通过样式控制将<code>渲染区域</code>偏移至<code>可视区域</code>中。</p>
<ul>
<li>偏移量<code>startOffset</code> = scrollTop - (scrollTop % itemSize);</li>
</ul>
<p>最终的<code>简易代码</code>如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div ref=<span class="string">&quot;list&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;infinite-list-container&quot;</span> @scroll=<span class="string">&quot;scrollEvent($event)&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;infinite-list-phantom&quot;</span> :style=<span class="string">&quot;&#123; height: listHeight + &#x27;px&#x27; &#125;&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;infinite-list&quot;</span> :style=<span class="string">&quot;&#123; transform: getTransform &#125;&quot;</span>&gt;</span><br><span class="line">      &lt;div ref=<span class="string">&quot;items&quot;</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;infinite-list-item&quot;</span></span><br><span class="line">        v-<span class="keyword">for</span>=<span class="string">&quot;item in visibleData&quot;</span></span><br><span class="line">        :key=<span class="string">&quot;item.id&quot;</span></span><br><span class="line">        :style=<span class="string">&quot;&#123; height: itemSize + &#x27;px&#x27;,lineHeight: itemSize + &#x27;px&#x27; &#125;&quot;</span></span><br><span class="line">      &gt;&#123;&#123; item.value &#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name:<span class="string">&#x27;VirtualList&#x27;</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    <span class="comment">//所有列表数据</span></span><br><span class="line">    listData:&#123;</span><br><span class="line">      type:<span class="built_in">Array</span>,</span><br><span class="line">      <span class="keyword">default</span>:<span class="function">()=&gt;</span>[]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//每项高度</span></span><br><span class="line">    itemSize: &#123;</span><br><span class="line">      type: <span class="built_in">Number</span>,</span><br><span class="line">      <span class="keyword">default</span>:<span class="number">200</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed:&#123;</span><br><span class="line">    <span class="comment">//列表总高度</span></span><br><span class="line">    <span class="function"><span class="title">listHeight</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.listData.length * <span class="built_in">this</span>.itemSize;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//可显示的列表项数</span></span><br><span class="line">    <span class="function"><span class="title">visibleCount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Math</span>.ceil(<span class="built_in">this</span>.screenHeight / <span class="built_in">this</span>.itemSize)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//偏移量对应的style</span></span><br><span class="line">    <span class="function"><span class="title">getTransform</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`translate3d(0,<span class="subst">$&#123;<span class="built_in">this</span>.startOffset&#125;</span>px,0)`</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//获取真实显示列表数据</span></span><br><span class="line">    <span class="function"><span class="title">visibleData</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.listData.slice(<span class="built_in">this</span>.start, <span class="built_in">Math</span>.min(<span class="built_in">this</span>.end,<span class="built_in">this</span>.listData.length));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.screenHeight = <span class="built_in">this</span>.$el.clientHeight;</span><br><span class="line">    <span class="built_in">this</span>.start = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.end = <span class="built_in">this</span>.start + <span class="built_in">this</span>.visibleCount;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">//可视区域高度</span></span><br><span class="line">      screenHeight:<span class="number">0</span>,</span><br><span class="line">      <span class="comment">//偏移量</span></span><br><span class="line">      startOffset:<span class="number">0</span>,</span><br><span class="line">      <span class="comment">//起始索引</span></span><br><span class="line">      start:<span class="number">0</span>,</span><br><span class="line">      <span class="comment">//结束索引</span></span><br><span class="line">      end:<span class="literal">null</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">scrollEvent</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">//当前滚动位置</span></span><br><span class="line">      <span class="keyword">let</span> scrollTop = <span class="built_in">this</span>.$refs.list.scrollTop;</span><br><span class="line">      <span class="comment">//此时的开始索引</span></span><br><span class="line">      <span class="built_in">this</span>.start = <span class="built_in">Math</span>.floor(scrollTop / <span class="built_in">this</span>.itemSize);</span><br><span class="line">      <span class="comment">//此时的结束索引</span></span><br><span class="line">      <span class="built_in">this</span>.end = <span class="built_in">this</span>.start + <span class="built_in">this</span>.visibleCount;</span><br><span class="line">      <span class="comment">//此时的偏移量</span></span><br><span class="line">      <span class="built_in">this</span>.startOffset = scrollTop - (scrollTop % <span class="built_in">this</span>.itemSize);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><a href="https://codesandbox.io/s/virtuallist-1-rp8pi">点击查看在线 DEMO 及完整代码</a></p>
<p>最终效果如下：</p>
<img src="/posts/17134/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f31302f32392f313665313531653031376437626261333f773d3132373026683d34323726663d67696626733d393132393536.gif" class="" title="img">

<h2 id="列表项动态高度"><a href="#列表项动态高度" class="headerlink" title="列表项动态高度"></a>列表项动态高度</h2><p>在之前的实现中，列表项的高度是固定的，因为高度固定，所以可以很轻易的获取列表项的整体高度以及滚动时的显示数据与对应的偏移量。而实际应用的时候，当列表中包含文本之类的可变内容，会导致列表项的高度并不相同。</p>
<p>比如这种情况：</p>
<img src="/posts/17134/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f31302f32392f313665313531396631653132316265393f773d34313726683d37303226663d706e6726733d3431333331.png" class="" title="img">

<p>在虚拟列表中应用动态高度的解决方案一般有如下三种：</p>
<blockquote>
<p>1.对组件属性<code>itemSize</code>进行扩展，支持传递类型为<code>数字</code>、<code>数组</code>、<code>函 数</code></p>
</blockquote>
<ul>
<li>可以是一个固定值，如 100，此时列表项是固高的</li>
<li>可以是一个包含所有列表项高度的数据，如 [50, 20, 100, 80, …]</li>
<li>可以是一个根据列表项索引返回其高度的函数：(index: number): number</li>
</ul>
<p>这种方式虽然有比较好的灵活度，但仅适用于可以预先知道或可以通过计算得知列表项高度的情况，依然无法解决列表项高度由内容撑开的情况。</p>
<blockquote>
<p>2.将列表项<code>渲染到屏幕外</code>，对其高度进行测量并缓存，然后再将其渲染至可视区域内。</p>
</blockquote>
<p>由于预先渲染至屏幕外，再渲染至屏幕内，这导致渲染成本增加一倍，这对于数百万用户在低端移动设备上使用的产品来说是不切实际的。</p>
<blockquote>
<p>3.以<code>预估高度</code>先行渲染，然后获取真实高度并缓存。</p>
</blockquote>
<p>这是我选择的实现方式，可以避免前两种方案的不足。</p>
<p>接下来，来看如何简易的实现：</p>
<p>定义组件属性<code>estimatedItemSize</code>,用于接收<code>预估高度</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">  <span class="comment">//预估高度</span></span><br><span class="line">  estimatedItemSize: &#123;</span><br><span class="line">    type: <span class="built_in">Number</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义<code>positions</code>，用于列表项渲染后存储<code>每一项的高度以及位置</code>信息，</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.positions = [</span><br><span class="line">  <span class="comment">// &#123;</span></span><br><span class="line">  <span class="comment">//   top:0,</span></span><br><span class="line">  <span class="comment">//   bottom:100,</span></span><br><span class="line">  <span class="comment">//   height:100</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>并在初始时根据<code>estimatedItemSize</code>对<code>positions</code>进行初始化。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">initPositions</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.positions = <span class="built_in">this</span>.listData.map(<span class="function">(<span class="params">item,index</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      index,</span><br><span class="line">      height:<span class="built_in">this</span>.estimatedItemSize,</span><br><span class="line">      top:index * <span class="built_in">this</span>.estimatedItemSize,</span><br><span class="line">      bottom:(index + <span class="number">1</span>) * <span class="built_in">this</span>.estimatedItemSize</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于列表项高度不定，并且我们维护了<code>positions</code>，用于记录每一项的位置，而<code>列表高度</code>实际就等于列表中最后一项的底部距离列表顶部的位置。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//列表总高度</span></span><br><span class="line"><span class="function"><span class="title">listHeight</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.positions[<span class="built_in">this</span>.positions.length - <span class="number">1</span>].bottom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于需要在<code>渲染完成</code>后，获取列表每项的位置信息并缓存，所以使用钩子函数<code>updated</code>来实现：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">updated</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> nodes = <span class="built_in">this</span>.$refs.items;</span><br><span class="line">  nodes.forEach(<span class="function">(<span class="params">node</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> rect = node.getBoundingClientRect();</span><br><span class="line">    <span class="keyword">let</span> height = rect.height;</span><br><span class="line">    <span class="keyword">let</span> index = +node.id.slice(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">let</span> oldHeight = <span class="built_in">this</span>.positions[index].height;</span><br><span class="line">    <span class="keyword">let</span> dValue = oldHeight - height;</span><br><span class="line">    <span class="comment">//存在差值</span></span><br><span class="line">    <span class="keyword">if</span>(dValue)&#123;</span><br><span class="line">      <span class="built_in">this</span>.positions[index].bottom = <span class="built_in">this</span>.positions[index].bottom - dValue;</span><br><span class="line">      <span class="built_in">this</span>.positions[index].height = height;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> k = index + <span class="number">1</span>;k&lt;<span class="built_in">this</span>.positions.length; k++)&#123;</span><br><span class="line">        <span class="built_in">this</span>.positions[k].top = <span class="built_in">this</span>.positions[k-<span class="number">1</span>].bottom;</span><br><span class="line">        <span class="built_in">this</span>.positions[k].bottom = <span class="built_in">this</span>.positions[k].bottom - dValue;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>滚动后获取列表<code>开始索引</code>的方法修改为通过<code>缓存</code>获取：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取列表起始索引</span></span><br><span class="line"><span class="function"><span class="title">getStartIndex</span>(<span class="params">scrollTop = <span class="number">0</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> item = <span class="built_in">this</span>.positions.find(<span class="function"><span class="params">i</span> =&gt;</span> i &amp;&amp; i.bottom &gt; scrollTop);</span><br><span class="line">  <span class="keyword">return</span> item.index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于我们的缓存数据，本身就是有顺序的，所以获取<code>开始索引</code>的方法可以考虑通过<code>二分查找</code>的方式来降低检索次数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取列表起始索引</span></span><br><span class="line"><span class="function"><span class="title">getStartIndex</span>(<span class="params">scrollTop = <span class="number">0</span></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//二分法查找</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.binarySearch(<span class="built_in">this</span>.positions,scrollTop)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//二分法查找</span></span><br><span class="line"><span class="function"><span class="title">binarySearch</span>(<span class="params">list,value</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> start = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> end = list.length - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> tempIndex = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">while</span>(start &lt;= end)&#123;</span><br><span class="line">    <span class="keyword">let</span> midIndex = <span class="built_in">parseInt</span>((start + end)/<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">let</span> midValue = list[midIndex].bottom;</span><br><span class="line">    <span class="keyword">if</span>(midValue === value)&#123;</span><br><span class="line">      <span class="keyword">return</span> midIndex + <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(midValue &lt; value)&#123;</span><br><span class="line">      start = midIndex + <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(midValue &gt; value)&#123;</span><br><span class="line">      <span class="keyword">if</span>(tempIndex === <span class="literal">null</span> || tempIndex &gt; midIndex)&#123;</span><br><span class="line">        tempIndex = midIndex;</span><br><span class="line">      &#125;</span><br><span class="line">      end = end - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> tempIndex;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>滚动后将<code>偏移量</code>的获取方式变更：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">scrollEvent</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">//...省略</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">this</span>.start &gt;= <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="built_in">this</span>.startOffset = <span class="built_in">this</span>.positions[<span class="built_in">this</span>.start - <span class="number">1</span>].bottom</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.startOffset = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过<a href="https://github.com/marak/Faker.js/">faker.js</a> 来创建一些<code>随机数据</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> data = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> id = <span class="number">0</span>; id &lt; <span class="number">10000</span>; id++) &#123;</span><br><span class="line">  data.push(&#123;</span><br><span class="line">    id,</span><br><span class="line">    value: faker.lorem.sentences() <span class="comment">// 长文本</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://codesandbox.io/s/virtuallist2-1bqk6">点击查看在线 DEMO 及完整代码</a></p>
<p>最终效果如下：</p>
<img src="/posts/17134/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f31302f32392f313665313531653936353834623639303f773d33363026683d36353526663d67696626733d31313433373239.gif" class="" title="img">

<p>从演示效果上看，我们实现了基于<code>文字内容动态撑高列表项</code>情况下的<code>虚拟列表</code>，但是我们可能会发现，当滚动过快时，会出现短暂的<code>白屏现象</code>。</p>
<p>为了使页面平滑滚动，我们还需要在<code>可见区域</code>的上方和下方渲染额外的项目，在滚动时给予一些<code>缓冲</code>，所以将屏幕分为三个区域：</p>
<ul>
<li>可视区域上方：<code>above</code></li>
<li>可视区域：<code>screen</code></li>
<li>可视区域下方：<code>below</code></li>
</ul>
<img src="/posts/17134/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f31302f32392f313665313531613539333137636165373f773d34363126683d34393326663d706e6726733d3236343633.png" class="" title="img">

<p>定义组件属性<code>bufferScale</code>,用于接收<code>缓冲区数据</code>与<code>可视区数据</code>的<code>比例</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">  <span class="comment">//缓冲区比例</span></span><br><span class="line">  bufferScale:&#123;</span><br><span class="line">    type:<span class="built_in">Number</span>,</span><br><span class="line">    <span class="keyword">default</span>:<span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可视区上方渲染条数<code>aboveCount</code>获取方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">aboveCount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.min(<span class="built_in">this</span>.start,<span class="built_in">this</span>.bufferScale * <span class="built_in">this</span>.visibleCount)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可视区下方渲染条数<code>belowCount</code>获取方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">belowCount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.min(<span class="built_in">this</span>.listData.length - <span class="built_in">this</span>.end,<span class="built_in">this</span>.bufferScale * <span class="built_in">this</span>.visibleCount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>真实渲染数据<code>visibleData</code>获取方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">visibleData</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> start = <span class="built_in">this</span>.start - <span class="built_in">this</span>.aboveCount;</span><br><span class="line">  <span class="keyword">let</span> end = <span class="built_in">this</span>.end + <span class="built_in">this</span>.belowCount;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>._listData.slice(start, end);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://codesandbox.io/s/virtuallist-3-i3h9v">点击查看在线 DEMO 及完整代码</a></p>
<p>最终效果如下：</p>
<img src="/posts/17134/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f31302f32392f313665313531656530656230666338393f773d33363026683d36333626663d67696626733d31313537353835.gif" class="" title="img">

<blockquote>
<p>基于这个方案，开发了一个基于 Vue2.x 的虚拟列表组件：<a href="https://github.com/chenqf/vue-virtual-listview">vue-virtual-listview</a>,可<a href="https://github.com/chenqf/vue-virtual-listview">点击查看完整代码</a>。</p>
</blockquote>
<h2 id="面向未来"><a href="#面向未来" class="headerlink" title="面向未来"></a>面向未来</h2><p>在前文中我们使用<code>监听scroll事件</code>的方式来触发可视区域中数据的更新，当滚动发生后，scroll 事件会频繁触发，很多时候会造成<code>重复计算</code>的问题，从性能上来说无疑存在浪费的情况。</p>
<p>可以使用<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver">IntersectionObserver</a>替换监听 scroll 事件，<code>IntersectionObserver</code>可以监听目标元素是否出现在可视区域内，在监听的回调事件中执行可视区域数据的更新，并且<code>IntersectionObserver</code>的监听回调是异步触发，不随着目标元素的滚动而触发，性能消耗极低。</p>
<h2 id="遗留问题"><a href="#遗留问题" class="headerlink" title="遗留问题"></a>遗留问题</h2><p>我们虽然实现了根据列表项动态高度下的虚拟列表，但如果列表项中包含图片，并且列表高度由图片撑开，由于图片会发送网络请求，此时无法保证我们在获取列表项真实高度时图片是否已经加载完成，从而造成计算不准确的情况。</p>
<p>这种情况下，如果我们能监听列表项的大小变化就能获取其真正的高度了。我们可以使用<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver">ResizeObserver</a>来监听列表项内容区域的高度改变，从而实时获取每一列表项的高度。</p>
<p>不过遗憾的是，在撰写本文的时候，仅有少数<a href="https://www.caniuse.com/#search=ResizeObserver">浏览器支持</a><code>ResizeObserver</code>。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://github.com/dwqs/blog/issues/70">浅说虚拟列表的实现原理</a></li>
<li><a href="https://github.com/dwqs/blog/issues/72">react-virtualized 组件的虚拟列表实现</a></li>
<li><a href="https://itsze.ro/blog/2017/04/09/infinite-list-and-react.html">React 和无限列表</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/34585166">再谈前端虚拟列表的实现</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>技巧</tag>
        <tag>转载</tag>
        <tag>解决方案</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-前端常见跨域解决方案（全）</title>
    <url>/posts/12335/</url>
    <content><![CDATA[<h3 id="什么是跨域？"><a href="#什么是跨域？" class="headerlink" title="什么是跨域？"></a><strong>什么是跨域？</strong></h3><p>跨域是指一个域下的文档或脚本试图去请求另一个域下的资源，这里跨域是广义的。</p>
<p>广义的跨域：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.) 资源跳转： A链接、重定向、表单提交</span><br><span class="line">2.) 资源嵌入： &lt;link&gt;、&lt;script&gt;、&lt;img&gt;、&lt;frame&gt;等dom标签，还有样式中background:url()、@font-face()等文件外链</span><br><span class="line">3.) 脚本请求： js发起的ajax请求、dom和js对象的跨域操作等</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>其实我们通常所说的跨域是狭义的，是由浏览器同源策略限制的一类请求场景。</p>
<p><strong>什么是同源策略？</strong><br>同源策略/SOP（Same origin policy）是一种约定，由 Netscape 公司 1995 年引入浏览器，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到 XSS、CSFR 等攻击。所谓同源是指”协议+域名+端口”三者相同，即便两个不同的域名指向同一个 ip 地址，也非同源。</p>
<p>同源策略限制以下几种行为：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.) Cookie、LocalStorage 和 IndexDB 无法读取</span><br><span class="line">2.) DOM 和 Js对象无法获得</span><br><span class="line">3.) AJAX 请求不能发送</span><br></pre></td></tr></table></figure>

<h3 id="常见跨域场景"><a href="#常见跨域场景" class="headerlink" title="常见跨域场景"></a><strong>常见跨域场景</strong></h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">URL                                      说明                    是否允许通信</span><br><span class="line">http://www.domain.com/a.js</span><br><span class="line">http://www.domain.com/b.js         同一域名，不同文件或路径           允许</span><br><span class="line">http://www.domain.com/lab/c.js</span><br><span class="line"></span><br><span class="line">http://www.domain.com:8000/a.js</span><br><span class="line">http://www.domain.com/b.js         同一域名，不同端口                不允许</span><br><span class="line"></span><br><span class="line">http://www.domain.com/a.js</span><br><span class="line">https://www.domain.com/b.js        同一域名，不同协议                不允许</span><br><span class="line"></span><br><span class="line">http://www.domain.com/a.js</span><br><span class="line">http://192.168.4.12/b.js           域名和域名对应相同ip              不允许</span><br><span class="line"></span><br><span class="line">http://www.domain.com/a.js</span><br><span class="line">http://x.domain.com/b.js           主域相同，子域不同                不允许</span><br><span class="line">http://domain.com/c.js</span><br><span class="line"></span><br><span class="line">http://www.domain1.com/a.js</span><br><span class="line">http://www.domain2.com/b.js        不同域名                         不允许</span><br></pre></td></tr></table></figure>

<h3 id="跨域解决方案"><a href="#跨域解决方案" class="headerlink" title="跨域解决方案"></a><strong>跨域解决方案</strong></h3><p>1、 通过 jsonp 跨域<br>2、 document.domain + iframe 跨域<br>3、 location.hash + iframe<br>4、 window.name + iframe 跨域<br>5、 postMessage 跨域<br>6、 跨域资源共享（CORS）<br>7、 nginx 代理跨域<br>8、 nodejs 中间件代理跨域<br>9、 WebSocket 协议跨域</p>
<h4 id="一、-通过-jsonp-跨域"><a href="#一、-通过-jsonp-跨域" class="headerlink" title="一、 通过 jsonp 跨域"></a><strong>一、 通过 jsonp 跨域</strong></h4><p>通常为了减轻 web 服务器的负载，我们把 js、css，img 等静态资源分离到另一台独立域名的服务器上，在 html 页面中再通过相应的标签从不同域名下加载静态资源，而被浏览器允许，基于此原理，我们可以通过动态创建 script，再请求一个带参网址实现跨域通信。</p>
<p>1.）原生实现：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">&#x27;script&#x27;</span>);</span></span><br><span class="line"><span class="javascript">  script.type = <span class="string">&#x27;text/javascript&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 传参一个回调函数名给后端，方便后端返回时执行这个在前端定义的回调函数</span></span></span><br><span class="line">  script.src =</span><br><span class="line"><span class="javascript">    <span class="string">&#x27;http://www.domain2.com:8080/login?user=admin&amp;callback=handleCallback&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.head.appendChild(script);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 回调执行函数</span></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">handleCallback</span>(<span class="params">res</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    alert(<span class="built_in">JSON</span>.stringify(res));</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>服务端返回如下（返回时即执行全局函数）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">handleCallback(&#123; <span class="attr">status</span>: <span class="literal">true</span>, <span class="attr">user</span>: <span class="string">&#x27;admin&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>2.）jquery ajax：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">  url: <span class="string">&#x27;http://www.domain2.com:8080/login&#x27;</span>,</span><br><span class="line">  type: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">  dataType: <span class="string">&#x27;jsonp&#x27;</span>, <span class="comment">// 请求方式为jsonp</span></span><br><span class="line">  jsonpCallback: <span class="string">&#x27;handleCallback&#x27;</span>, <span class="comment">// 自定义回调函数名</span></span><br><span class="line">  data: &#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>3.）vue.js：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.$http</span><br><span class="line">  .jsonp(<span class="string">&#x27;http://www.domain2.com:8080/login&#x27;</span>, &#123;</span><br><span class="line">    params: &#123;&#125;,</span><br><span class="line">    jsonp: <span class="string">&#x27;handleCallback&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>后端 node.js 代码示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> params = qs.parse(req.url.split(<span class="string">&#x27;?&#x27;</span>)[<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">var</span> fn = params.callback;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// jsonp返回设置</span></span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/javascript&#x27;</span> &#125;);</span><br><span class="line">  res.write(fn + <span class="string">&#x27;(&#x27;</span> + <span class="built_in">JSON</span>.stringify(params) + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  res.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="string">&#x27;8080&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Server is running at port 8080...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>jsonp 缺点：只能实现 get 一种请求。</p>
<h4 id="二、-document-domain-iframe-跨域"><a href="#二、-document-domain-iframe-跨域" class="headerlink" title="二、 document.domain + iframe 跨域"></a><strong>二、 document.domain + iframe 跨域</strong></h4><p>此方案仅限主域相同，子域不同的跨域应用场景。</p>
<p>实现原理：两个页面都通过 js 强制设置 document.domain 为基础主域，就实现了同域。</p>
<p>1.）父窗口：(<a href="http://www.domain.com/a.html">http://www.domain.com/a.html</a>)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">&quot;iframe&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://child.domain.com/b.html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.domain = <span class="string">&#x27;domain.com&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> user = <span class="string">&#x27;admin&#x27;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.）子窗口：(<a href="http://child.domain.com/b.html">http://child.domain.com/b.html</a>)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.domain = <span class="string">&#x27;domain.com&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 获取父窗口中变量</span></span></span><br><span class="line"><span class="javascript">  alert(<span class="string">&#x27;get js data from parent ---&gt; &#x27;</span> + <span class="built_in">window</span>.parent.user);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="三、-location-hash-iframe-跨域"><a href="#三、-location-hash-iframe-跨域" class="headerlink" title="三、 location.hash + iframe 跨域"></a><strong>三、 location.hash + iframe 跨域</strong></h4><p>实现原理： a 欲与 b 跨域相互通信，通过中间页 c 来实现。 三个页面，不同域之间利用 iframe 的 location.hash 传值，相同域之间直接 js 访问来通信。</p>
<p>具体实现：A 域：a.html -&gt; B 域：b.html -&gt; A 域：c.html，a 与 b 不同域只能通过 hash 值单向通信，b 与 c 也不同域也只能单向通信，但 c 与 a 同域，所以 c 可通过 parent.parent 访问 a 页面所有对象。</p>
<p>1.）a.html：(<a href="http://www.domain1.com/a.html">http://www.domain1.com/a.html</a>)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;iframe</span><br><span class="line">  id=&quot;iframe&quot;</span><br><span class="line">  src=&quot;http://www.domain2.com/b.html&quot;</span><br><span class="line">  style=&quot;display:none;&quot;</span><br><span class="line">&gt;<span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> iframe = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;iframe&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 向b.html传hash值</span></span></span><br><span class="line"><span class="javascript">  <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    iframe.src = iframe.src + <span class="string">&#x27;#user=admin&#x27;</span>;</span></span><br><span class="line">  &#125;, 1000);</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 开放给同域c.html的回调方法</span></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">onCallback</span>(<span class="params">res</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    alert(<span class="string">&#x27;data from c.html ---&gt; &#x27;</span> + res);</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.）b.html：(<a href="http://www.domain2.com/b.html">http://www.domain2.com/b.html</a>)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;iframe</span><br><span class="line">  id=&quot;iframe&quot;</span><br><span class="line">  src=&quot;http://www.domain1.com/c.html&quot;</span><br><span class="line">  style=&quot;display:none;&quot;</span><br><span class="line">&gt;<span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> iframe = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;iframe&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 监听a.html传来的hash值，再传给c.html</span></span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.onhashchange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line">    iframe.src = iframe.src + location.hash;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.）c.html：(<a href="http://www.domain1.com/c.html">http://www.domain1.com/c.html</a>)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 监听b.html传来的hash值</span></span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.onhashchange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 再通过操作同域a.html的js回调，将结果传回</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.parent.parent.onCallback(</span></span><br><span class="line"><span class="javascript">      <span class="string">&#x27;hello: &#x27;</span> + location.hash.replace(<span class="string">&#x27;#user=&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="四、-window-name-iframe-跨域"><a href="#四、-window-name-iframe-跨域" class="headerlink" title="四、 window.name + iframe 跨域"></a><strong>四、 window.name + iframe 跨域</strong></h4><p>window.name 属性的独特之处：name 值在不同的页面（甚至不同域名）加载后依旧存在，并且可以支持非常长的 name 值（2MB）。</p>
<p>1.）a.html：(<a href="http://www.domain1.com/a.html">http://www.domain1.com/a.html</a>)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> proxy = <span class="function"><span class="keyword">function</span> (<span class="params">url, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> state = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">&#x27;iframe&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载跨域页面</span></span><br><span class="line">  iframe.src = url;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// onload事件会触发2次，第1次加载跨域页，并留存数据于window.name</span></span><br><span class="line">  iframe.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (state === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// 第2次onload(同域proxy页)成功后，读取同域window.name中数据</span></span><br><span class="line">      callback(iframe.contentWindow.name);</span><br><span class="line">      destoryFrame();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 第1次onload(跨域页)成功后，切换到同域代理页面</span></span><br><span class="line">      iframe.contentWindow.location = <span class="string">&#x27;http://www.domain1.com/proxy.html&#x27;</span>;</span><br><span class="line">      state = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(iframe);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取数据以后销毁这个iframe，释放内存；这也保证了安全（不被其他域frame js访问）</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">destoryFrame</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    iframe.contentWindow.document.write(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    iframe.contentWindow.close();</span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(iframe);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求跨域b页面数据</span></span><br><span class="line">proxy(<span class="string">&#x27;http://www.domain2.com/b.html&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  alert(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>2.）proxy.html：(<a href="http://www.domain1.com/proxy.html">http://www.domain1.com/proxy….</a>)<br>中间代理页，与 a.html 同域，内容为空即可。</p>
<p>3.）b.html：(<a href="http://www.domain2.com/b.html">http://www.domain2.com/b.html</a>)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.name = <span class="string">&#x27;This is domain2 data!&#x27;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结：通过 iframe 的 src 属性由外域转向本地域，跨域数据即由 iframe 的 window.name 从外域传递到本地域。这个就巧妙地绕过了浏览器的跨域访问限制，但同时它又是安全操作。</p>
<h4 id="五、-postMessage-跨域"><a href="#五、-postMessage-跨域" class="headerlink" title="五、 postMessage 跨域"></a><strong>五、 postMessage 跨域</strong></h4><p>postMessage 是 HTML5 XMLHttpRequest Level 2 中的 API，且是为数不多可以跨域操作的 window 属性之一，它可用于解决以下方面的问题：<br>a.） 页面和其打开的新窗口的数据传递<br>b.） 多窗口之间消息传递<br>c.） 页面与嵌套的 iframe 消息传递<br>d.） 上面三个场景的跨域数据传递</p>
<p>用法：postMessage(data,origin)方法接受两个参数<br>data： html5 规范支持任意基本类型或可复制的对象，但部分浏览器只支持字符串，所以传参时最好用 JSON.stringify()序列化。<br>origin： 协议+主机+端口号，也可以设置为”*“，表示可以传递给任意窗口，如果要指定和当前窗口同源的话设置为”/“。</p>
<p>1.）a.html：(<a href="http://www.domain1.com/a.html">http://www.domain1.com/a.html</a>)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;iframe</span><br><span class="line">  id=&quot;iframe&quot;</span><br><span class="line">  src=&quot;http://www.domain2.com/b.html&quot;</span><br><span class="line">  style=&quot;display:none;&quot;</span><br><span class="line">&gt;<span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> iframe = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;iframe&#x27;</span>);</span></span><br><span class="line"><span class="javascript">  iframe.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> data = &#123;</span></span><br><span class="line"><span class="javascript">      name: <span class="string">&#x27;aym&#x27;</span></span></span><br><span class="line">    &#125;;</span><br><span class="line"><span class="javascript">    <span class="comment">// 向domain2传送跨域数据</span></span></span><br><span class="line">    iframe.contentWindow.postMessage(</span><br><span class="line"><span class="javascript">      <span class="built_in">JSON</span>.stringify(data),</span></span><br><span class="line"><span class="javascript">      <span class="string">&#x27;http://www.domain2.com&#x27;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 接受domain2返回数据</span></span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.addEventListener(</span></span><br><span class="line"><span class="javascript">    <span class="string">&#x27;message&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">&#x27;data from domain2 ---&gt; &#x27;</span> + e.data);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="literal">false</span></span></span><br><span class="line">  );</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.）b.html：(<a href="http://www.domain2.com/b.html">http://www.domain2.com/b.html</a>)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 接收domain1的数据</span></span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.addEventListener(</span></span><br><span class="line"><span class="javascript">    <span class="string">&#x27;message&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">&#x27;data from domain1 ---&gt; &#x27;</span> + e.data);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(e.data);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (data) &#123;</span></span><br><span class="line">        data.number = 16;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 处理后再发回domain1</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.parent.postMessage(</span></span><br><span class="line"><span class="javascript">          <span class="built_in">JSON</span>.stringify(data),</span></span><br><span class="line"><span class="javascript">          <span class="string">&#x27;http://www.domain1.com&#x27;</span></span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="literal">false</span></span></span><br><span class="line">  );</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="六、-跨域资源共享（CORS）"><a href="#六、-跨域资源共享（CORS）" class="headerlink" title="六、 跨域资源共享（CORS）"></a><strong>六、 跨域资源共享（CORS）</strong></h4><p>普通跨域请求：只服务端设置 Access-Control-Allow-Origin 即可，前端无须设置，若要带 cookie 请求：前后端都需要设置。</p>
<p>需注意的是：由于同源策略的限制，所读取的 cookie 为跨域请求接口所在域的 cookie，而非当前页。如果想实现当前页 cookie 的写入，可参考下文：七、nginx 反向代理中设置 proxy_cookie_domain 和 八、NodeJs 中间件代理中 cookieDomainRewrite 参数的设置。</p>
<p>目前，所有浏览器都支持该功能(IE8+：IE8/9 需要使用 XDomainRequest 对象来支持 CORS）)，CORS 也已经成为主流的跨域解决方案。</p>
<h5 id="1、-前端设置："><a href="#1、-前端设置：" class="headerlink" title="1、 前端设置："></a><strong>1、 前端设置：</strong></h5><p>1.）原生 ajax</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 前端设置是否带cookie</span></span><br><span class="line">xhr.withCredentials = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<p>示例代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest(); <span class="comment">// IE8/9需用window.XDomainRequest兼容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 前端设置是否带cookie</span></span><br><span class="line">xhr.withCredentials = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">xhr.open(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;http://www.domain2.com:8080/login&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.setRequestHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>);</span><br><span class="line">xhr.send(<span class="string">&#x27;user=admin&#x27;</span>);</span><br><span class="line"></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span> &amp;&amp; xhr.status == <span class="number">200</span>) &#123;</span><br><span class="line">    alert(xhr.responseText);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>2.）jQuery ajax</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    ...</span><br><span class="line">   xhrFields: &#123;</span><br><span class="line">       withCredentials: <span class="literal">true</span>    <span class="comment">// 前端设置是否带cookie</span></span><br><span class="line">   &#125;,</span><br><span class="line">   crossDomain: <span class="literal">true</span>,   <span class="comment">// 会让请求头中包含跨域的额外信息，但不会含cookie</span></span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>3.）vue 框架</p>
<p>a.) axios 设置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">axios.defaults.withCredentials = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<p>b.) vue-resource 设置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.http.options.credentials = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h5 id="2、-服务端设置："><a href="#2、-服务端设置：" class="headerlink" title="2、 服务端设置："></a><strong>2、 服务端设置：</strong></h5><p>若后端设置成功，前端浏览器控制台则不会出现跨域报错信息，反之，说明没设成功。</p>
<p>1.）Java 后台：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 导入包：import javax.servlet.http.HttpServletResponse;</span></span><br><span class="line"><span class="comment"> * 接口参数中定义：HttpServletResponse response</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许跨域访问的域名：若有端口需写全（协议+域名+端口），若没有端口末尾不用加&#x27;/&#x27;</span></span><br><span class="line">response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;http://www.domain1.com&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许前端带认证cookie：启用此项后，上面的域名不能为&#x27;*&#x27;，必须指定具体的域名，否则浏览器会提示</span></span><br><span class="line">response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提示OPTIONS预检时，后端需要设置的两个常用自定义头</span></span><br><span class="line">response.setHeader(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;Content-Type,X-Requested-With&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>2.）Nodejs 后台示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer();</span><br><span class="line"><span class="keyword">var</span> qs = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> postData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据块接收中</span></span><br><span class="line">  req.addListener(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    postData += chunk;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据接收完毕</span></span><br><span class="line">  req.addListener(<span class="string">&#x27;end&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    postData = qs.parse(postData);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 跨域后台设置</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>: <span class="string">&#x27;true&#x27;</span>, <span class="comment">// 后端允许发送Cookie</span></span><br><span class="line">      <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="string">&#x27;http://www.domain1.com&#x27;</span>, <span class="comment">// 允许访问的域（协议+域名+端口）</span></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">       * 此处设置的cookie还是domain2的而非domain1，因为后端也不能跨域写cookie(nginx反向代理可以实现)，</span></span><br><span class="line"><span class="comment">       * 但只要domain2中写入一次cookie认证，后面的跨域接口都能从domain2中获取cookie，从而实现所有的接口都能跨域访问</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="string">&#x27;Set-Cookie&#x27;</span>: <span class="string">&#x27;l=a123456;Path=/;Domain=www.domain2.com;HttpOnly&#x27;</span> <span class="comment">// HttpOnly的作用是让js无法读取cookie</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    res.write(<span class="built_in">JSON</span>.stringify(postData));</span><br><span class="line">    res.end();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="string">&#x27;8080&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Server is running at port 8080...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="七、-nginx-代理跨域"><a href="#七、-nginx-代理跨域" class="headerlink" title="七、 nginx 代理跨域"></a><strong>七、 nginx 代理跨域</strong></h4><h5 id="1、-nginx-配置解决-iconfont-跨域"><a href="#1、-nginx-配置解决-iconfont-跨域" class="headerlink" title="1、 nginx 配置解决 iconfont 跨域"></a><strong>1、 nginx 配置解决 iconfont 跨域</strong></h5><p>浏览器跨域访问 js、css、img 等常规静态资源被同源策略许可，但 iconfont 字体文件(eot|otf|ttf|woff|svg)例外，此时可在 nginx 的静态资源服务器中加入以下配置。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">  add_header Access-Control-Allow-Origin *;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2、-nginx-反向代理接口跨域"><a href="#2、-nginx-反向代理接口跨域" class="headerlink" title="2、 nginx 反向代理接口跨域"></a><strong>2、 nginx 反向代理接口跨域</strong></h5><p>跨域原理： 同源策略是浏览器的安全策略，不是 HTTP 协议的一部分。服务器端调用 HTTP 接口只是使用 HTTP 协议，不会执行 JS 脚本，不需要同源策略，也就不存在跨越问题。</p>
<p>实现思路：通过 nginx 配置一个代理服务器（域名与 domain1 相同，端口不同）做跳板机，反向代理访问 domain2 接口，并且可以顺便修改 cookie 中 domain 信息，方便当前域 cookie 写入，实现跨域登录。</p>
<p>nginx 具体配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">#proxy服务器</span><br><span class="line">server &#123;</span><br><span class="line">    listen       <span class="number">81</span>;</span><br><span class="line">    server_name  www.domain1.com;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass   http:<span class="comment">//www.domain2.com:8080;  #反向代理</span></span><br><span class="line">        proxy_cookie_domain www.domain2.com www.domain1.com; #修改cookie里域名</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line"></span><br><span class="line">        # 当用webpack-dev-server等中间件代理接口访问nignx时，此时无浏览器参与，故没有同源限制，下面的跨域配置可不启用</span><br><span class="line">        add_header Access-Control-Allow-Origin http:<span class="comment">//www.domain1.com;  #当前端只跨域不带cookie时，可为*</span></span><br><span class="line">        add_header Access-Control-Allow-Credentials <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.) 前端代码示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前端开关：浏览器是否读写cookie</span></span><br><span class="line">xhr.withCredentials = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问nginx中的代理服务器</span></span><br><span class="line">xhr.open(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;http://www.domain1.com:81/?user=admin&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>

<p>2.) Nodejs 后台示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer();</span><br><span class="line"><span class="keyword">var</span> qs = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> params = qs.parse(req.url.substring(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 向前台写cookie</span></span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">&#x27;Set-Cookie&#x27;</span>: <span class="string">&#x27;l=a123456;Path=/;Domain=www.domain2.com;HttpOnly&#x27;</span> <span class="comment">// HttpOnly:脚本无法读取</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  res.write(<span class="built_in">JSON</span>.stringify(params));</span><br><span class="line">  res.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="string">&#x27;8080&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Server is running at port 8080...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="八、-Nodejs-中间件代理跨域"><a href="#八、-Nodejs-中间件代理跨域" class="headerlink" title="八、 Nodejs 中间件代理跨域"></a><strong>八、 Nodejs 中间件代理跨域</strong></h4><p>node 中间件实现跨域代理，原理大致与 nginx 相同，都是通过启一个代理服务器，实现数据的转发，也可以通过设置 cookieDomainRewrite 参数修改响应头中 cookie 中域名，实现当前域的 cookie 写入，方便接口登录认证。</p>
<h5 id="1、-非-vue-框架的跨域（2-次跨域）"><a href="#1、-非-vue-框架的跨域（2-次跨域）" class="headerlink" title="1、 非 vue 框架的跨域（2 次跨域）"></a><strong>1、 非 vue 框架的跨域（2 次跨域）</strong></h5><p>利用 node + express + http-proxy-middleware 搭建一个 proxy 服务器。</p>
<p>1.）前端代码示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前端开关：浏览器是否读写cookie</span></span><br><span class="line">xhr.withCredentials = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问http-proxy-middleware代理服务器</span></span><br><span class="line">xhr.open(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;http://www.domain1.com:3000/login?user=admin&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>

<p>2.）中间件服务器：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> proxy = <span class="built_in">require</span>(<span class="string">&#x27;http-proxy-middleware&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(</span><br><span class="line">  <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  proxy(&#123;</span><br><span class="line">    <span class="comment">// 代理跨域目标接口</span></span><br><span class="line">    target: <span class="string">&#x27;http://www.domain2.com:8080&#x27;</span>,</span><br><span class="line">    changeOrigin: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改响应头信息，实现跨域并允许带cookie</span></span><br><span class="line">    onProxyRes: <span class="function"><span class="keyword">function</span> (<span class="params">proxyRes, req, res</span>) </span>&#123;</span><br><span class="line">      res.header(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;http://www.domain1.com&#x27;</span>);</span><br><span class="line">      res.header(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="string">&#x27;true&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改响应信息中的cookie域名</span></span><br><span class="line">    cookieDomainRewrite: <span class="string">&#x27;www.domain1.com&#x27;</span> <span class="comment">// 可以为false，表示不修改</span></span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Proxy server is listen at port 3000...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>3.）Nodejs 后台同（六：nginx）</p>
<h5 id="2、-vue-框架的跨域（1-次跨域）"><a href="#2、-vue-框架的跨域（1-次跨域）" class="headerlink" title="2、 vue 框架的跨域（1 次跨域）"></a><strong>2、 vue 框架的跨域（1 次跨域）</strong></h5><p>利用 node + webpack + webpack-dev-server 代理接口跨域。在开发环境下，由于 vue 渲染服务和接口代理服务都是 webpack-dev-server 同一个，所以页面与代理接口之间不再跨域，无须设置 headers 跨域信息了。</p>
<p>webpack.config.js 部分配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;&#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;&#125;,</span><br><span class="line">    ...</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">        proxy: [&#123;</span><br><span class="line">            context: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">            target: <span class="string">&#x27;http://www.domain2.com:8080&#x27;</span>,  <span class="comment">// 代理跨域目标接口</span></span><br><span class="line">            changeOrigin: <span class="literal">true</span>,</span><br><span class="line">            secure: <span class="literal">false</span>,  <span class="comment">// 当代理某些https服务报错时用</span></span><br><span class="line">            cookieDomainRewrite: <span class="string">&#x27;www.domain1.com&#x27;</span>  <span class="comment">// 可以为false，表示不修改</span></span><br><span class="line">        &#125;],</span><br><span class="line">        noInfo: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="九、-WebSocket-协议跨域"><a href="#九、-WebSocket-协议跨域" class="headerlink" title="九、 WebSocket 协议跨域"></a>九、 WebSocket 协议跨域</h4><p>WebSocket protocol 是 HTML5 一种新的协议。它实现了浏览器与服务器全双工通信，同时允许跨域通讯，是 server push 技术的一种很好的实现。<br>原生 WebSocket API 使用起来不太方便，我们使用 Socket.io，它很好地封装了 webSocket 接口，提供了更简单、灵活的接口，也对不支持 webSocket 的浏览器提供了向下兼容。</p>
<p>1.）前端代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  user input：</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/socket.io/2.2.0/socket.io.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> socket = io(<span class="string">&#x27;http://www.domain2.com:8080&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 连接成功处理</span></span></span><br><span class="line"><span class="javascript">  socket.on(<span class="string">&#x27;connect&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 监听服务端消息</span></span></span><br><span class="line"><span class="javascript">    socket.on(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;data from server: ---&gt; &#x27;</span> + msg);</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 监听服务端关闭</span></span></span><br><span class="line"><span class="javascript">    socket.on(<span class="string">&#x27;disconnect&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;Server socket has closed.&#x27;</span>);</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;input&#x27;</span>)[<span class="number">0</span>].onblur = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    socket.send(<span class="built_in">this</span>.value);</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.）Nodejs socket 后台：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> socket = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启http服务</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">&#x27;Content-type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">  res.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="string">&#x27;8080&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Server is running at port 8080...&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听socket连接</span></span><br><span class="line">socket.listen(server).on(<span class="string">&#x27;connection&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">client</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 接收信息</span></span><br><span class="line">  client.on(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    client.send(<span class="string">&#x27;hello：&#x27;</span> + msg);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;data from client: ---&gt; &#x27;</span> + msg);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 断开处理</span></span><br><span class="line">  client.on(<span class="string">&#x27;disconnect&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Client socket has closed.&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>JS</category>
      </categories>
      <tags>
        <tag>跨域</tag>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-常用正则表达式大全</title>
    <url>/posts/46804/</url>
    <content><![CDATA[<ul>
<li>转载自：<a href="https://www.yuque.com/gaoxizhi/linux/regex">https://www.yuque.com/gaoxizhi/linux/regex</a></li>
</ul>
<h3 id="一、校验数字的表达式"><a href="#一、校验数字的表达式" class="headerlink" title="一、校验数字的表达式"></a>一、校验数字的表达式</h3><ul>
<li>正整数：^[0-9]*$</li>
<li>n 位的正整数：^d{n}$</li>
<li>至少 n 位的数字：^d{n,}$</li>
<li>m-n 位的数字：^d{m,n}$</li>
<li>零和非零开头的数字：^(0|[1-9][0-9]*)$</li>
<li>非零开头的最多带两位小数的数字：^([1-9][0-9]*)+(.[0-9]{1,2})?$</li>
<li>带 1-2 位小数的正数或负数：^(-)?d+(.d{1,2})?$</li>
<li>正数、负数、和小数：^(-|+)?d+(.d+)?$</li>
<li>有两位小数的正实数：^[0-9]+(.[0-9]{2})?$</li>
<li>有 1~3 位小数的正实数：^[0-9]+(.[0-9]{1,3})?$</li>
<li>非零的正整数：^[1-9]d*$ 或 ^([1-9][0-9]<em>){1,3}$ 或 ^+?[1-9][0-9]\</em>$</li>
<li>非零的负整数：^-[1-9][]0-9″<em>$ 或 ^-[1-9]d</em>$</li>
<li>非负整数：^d+$ 或 ^[1-9]d*|0$</li>
<li>非正整数：^-[1-9]d*|0$ 或 ^((-d+)|(0+))$</li>
<li>非负浮点数：^d+(.d+)?$ 或 ^[1-9]d*.d*|0.d*[1-9]d*|0?.0+|0$</li>
<li>非正浮点数：^((-d+(.d+)?)|(0+(.0+)?))$ 或 ^(-([1-9]d*.d*|0.d*[1-9]d*))|0?.0+|0$</li>
<li>正浮点数：^[1-9]d*.d*|0.d*[1-9]d*$ 或 ^(([0-9]+.[0-9]<em>[1-9][0-9]</em>)|([0-9]<em>[1-9][0-9]</em>.[0-9]+)|([0-9]<em>[1-9][0-9]</em>))$</li>
<li>负浮点数：^-([1-9]d*.d*|0.d*[1-9]d*)$ 或 ^(-(([0-9]+.[0-9]<em>[1-9][0-9]</em>)|([0-9]<em>[1-9][0-9]</em>.[0-9]+)|([0-9]<em>[1-9][0-9]</em>)))$</li>
<li>浮点数：^(-?d+)(.d+)?$ 或 ^-?([1-9]d*.d*|0.d*[1-9]d*|0?.0+|0)$</li>
</ul>
<a id="more"></a>

<h3 id="二、校验字符的表达式"><a href="#二、校验字符的表达式" class="headerlink" title="二、校验字符的表达式"></a>二、校验字符的表达式</h3><ul>
<li>汉字：^[一-龥]{0,}$</li>
<li>英文和数字：^[A-Za-z0-9]+$ 或 ^[A-Za-z0-9]{4,40}$</li>
<li>长度为 3-20 的所有字符：^.{3,20}$</li>
<li>由 26 个英文字母组成的字符串：^[A-Za-z]+$</li>
<li>由 26 个大写英文字母组成的字符串：^[A-Z]+$</li>
<li>由 26 个小写英文字母组成的字符串：^[a-z]+$</li>
<li>由数字和 26 个英文字母组成的字符串：^[A-Za-z0-9]+$</li>
<li>由数字、26 个英文字母或者下划线组成的字符串：^w+$ 或 ^w{3,20}$</li>
<li>中文、英文、数字包括下划线：^[一-龥 A-Za-z0-9_]+$</li>
<li>中文、英文、数字但不包括下划线等符号：^[一-龥 A-Za-z0-9]+$ 或 ^[一-龥 A-Za-z0-9]{2,20}$</li>
<li>可以输入含有^%&amp;’,;=?$”等字符：[^%&amp;’,;=?$”]+</li>
<li>禁止输入含有<del>的字符：[^</del>“]+</li>
</ul>
<h3 id="三、特殊需求表达式"><a href="#三、特殊需求表达式" class="headerlink" title="三、特殊需求表达式"></a>三、特殊需求表达式</h3><ul>
<li><p>Email 地址：^w+([-+.]w+)<em>@w+([-.]w+)</em>.w+([-.]w+)*$</p>
</li>
<li><p>域名：[a-zA-Z0-9][-a-za-z0-9]{0,62}(/.[a-zA-Z0-9][-a-za-z0-9]{0,62})+/.?</p>
</li>
<li><p>InternetURL：[a-zA-z]+://[^s]_ 或 ^http://([w-]+.)+[w-]+(/[w-./?%&amp;=]_)?$</p>
</li>
<li><p>手机号码：^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])d{8}$</p>
</li>
<li><p>电话号码(“XXX-XXXXXXX”、”XXXX-XXXXXXXX”、”XXX-XXXXXXX”、”XXX-XXXXXXXX”、”XXXXXXX”和”XXXXXXXX)：^($$d{3,4}-)|d{3.4}-)?d{7,8}$</p>
</li>
<li><p>国内电话号码(0511-4405222、021-87888822)：d{3}-d{8}|d{4}-d{7}</p>
</li>
<li><p>身份证号(15 位、18 位数字)：^d{15}|d{18}$</p>
</li>
<li><p>短身份证号码(数字、字母 x 结尾)：^([0-9]){7,18}(x|X)?$ 或 ^d{8,18}|[0-9x]{8,18}|[0-9X]{8,18}?$</p>
</li>
<li><p>帐号是否合法(字母开头，允许 5-16 字节，允许字母数字下划线)：^[a-zA-Z][a-za-z0-9_]{4,15}$</p>
</li>
<li><p>密码(以字母开头，长度在 6~18 之间，只能包含字母、数字和下划线)：^[a-zA-Z]w{5,17}$</p>
</li>
<li><p>强密码(必须包含大小写字母和数字的组合，不能使用特殊字符，长度在 8-10 之间)：^(?=.<em>d)(?=.</em>[a-z])(?=.*[A-Z]).{8,10}$</p>
</li>
<li><p>日期格式：^d{4}-d{1,2}-d{1,2}</p>
</li>
<li><p>一年的 12 个月(01 ～ 09 和 1 ～ 12)：^(0?[1-9]|1[0-2])$</p>
</li>
<li><p>一个月的 31 天(01 ～ 09 和 1 ～ 31)：^((0?[1-9])|((1|2)[0-9])|30|31)$</p>
</li>
<li><p>钱的输入格式：</p>
</li>
<li><ul>
<li>有四种钱的表示形式我们可以接受:”10000.00″ 和 “10,000.00″, 和没有 “分” 的 “10000″ 和 “10,000″：^[1-9][0-9]*$</li>
<li>这表示任意一个不以 0 开头的数字，但是，这也意味着一个字符”0″不通过，所以我们采用下面的形式：^(0|[1-9][0-9]*)$</li>
<li>一个 0 或者一个不以 0 开头的数字.我们还可以允许开头有一个负号：^(0|-?[1-9][0-9]*)$</li>
<li>这表示一个 0 或者一个可能为负的开头不为 0 的数字.让用户以 0 开头好了.把负号的也去掉，因为钱总不能是负的吧.下面我们要加的是说明可能的小数部分：^[0-9]+(.[0-9]+)?$</li>
<li>必须说明的是，小数点后面至少应该有 1 位数，所以”10.”是不通过的，但是 “10″ 和 “10.2″ 是通过的：^[0-9]+(.[0-9]{2})?$</li>
<li>这样我们规定小数点后面必须有两位，如果你认为太苛刻了，可以这样：^[0-9]+(.[0-9]{1,2})?$</li>
<li>这样就允许用户只写一位小数。下面我们该考虑数字中的逗号了，我们可以这样：^[0-9]{1,3}(,[0-9]{3})*(.[0-9]{1,2})?$</li>
<li>1 到 3 个数字，后面跟着任意个 逗号+3 个数字，逗号成为可选，而不是必须：^([0-9]+|[0-9]{1,3}(,[0-9]{3})*)(.[0-9]{1,2})?$</li>
<li>备注：这就是最终结果了，别忘了”+”可以用”*”替代。如果你觉得空字符串也可以接受的话(奇怪，为什么?)最后，别忘了在用函数时去掉去掉那个反斜杠，一般的错误都在这里</li>
</ul>
</li>
<li><p>xml 文件：^([a-zA-Z]+-?)+[a-zA-Z0-9]+.[x|X][m|m][l|L]$</p>
</li>
<li><p>中文字符的正则表达式：[一-龥]</p>
</li>
<li><p>双字节字符：[^-ÿ] (包括汉字在内，可以用来计算字符串的长度(一个双字节字符长度计 2，ASCII 字符计 1))</p>
</li>
<li><p>空白行的正则表达式：s* (可以用来删除空白行)</p>
</li>
<li><p>HTML 标记的正则表达式：&lt;(S*?)[^&gt;]*&gt;._?&lt;/&gt;|&lt;._? /&gt; (网上流传的版本太糟糕，上面这个也仅仅能部分，对于复杂的嵌套标记依旧无能为力)</p>
</li>
<li><p>首尾空白字符的正则表达式：^s*|s*$或(^s*)|(s*$) (可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式)</p>
</li>
<li><p>腾讯 QQ 号：[1-9][0-9]{4,} (腾讯 QQ 号从 10000 开始)</p>
</li>
<li><p>中国邮政编码：[1-9]d{5}(?!d) (中国邮政编码为 6 位数字)</p>
</li>
<li><p>IP 地址：d+.d+.d+.d+ (提取 IP 地址时有用)</p>
</li>
<li><p>IP 地址：(?=(\b|\d))(((\d{1,2})|(1\d{1,2})|(2[0-4]\d)|(25[0-5])).){3}((\d{1,2})|(1\d{1,2})|(2[0-4]\d)|(25[0-5]))(?=(\b|\d)) （校验时使用）</p>
</li>
<li><p>IPv6：</p>
</li>
</ul>
<h3 id="四、其他"><a href="#四、其他" class="headerlink" title="四、其他"></a>四、其他</h3><p>| 验证手机号码                                   | <strong>1[3|5|7|8|]\d{9}</strong>                           |<br>| ———————————————- | ————————————————– | ————————– |<br>| 实现手机号前带 86 或是+86 的情况               | <strong>^((+86)|(86))?(13)\d{9}$</strong>                     |<br>| 电话号码与手机号码同时验证                     | <strong>(^(\d{3,4}-)?\d{7,8})$|(1[3|5|7|8]\d{9})</strong>   |<br>| 提取信息中的网络链接                           | **(h|H)(r|R)(e|E)(f|F)*=*(‘|“)?(\w|\    | /|.)+(‘|“|*|&gt;)?** |<br>| 提取信息中的邮件地址                           | <strong>\w+([-+.]\w+)*@\w+([-.]\w+)*.\w+([-.]\w+)*</strong> |<br>| 提取信息中的图片链接                           | **(s|S)(r|R)(c|C)*=*(‘|“)?(\w|\          | /|.)+(‘|“|*|&gt;)?** |<br>| 提取信息中的 IP 地址                           | <strong>(\d+).(\d+).(\d+).(\d+)</strong>                     |<br>| 提取信息中的中国手机号码                       | <strong>(86)*0*13\d{9}</strong>                               |<br>| 提取信息中的中国固定电话号码                   | <strong>((\d{3,4})|\d{3,4}-|\s)?\d{8}</strong>              |<br>| 提取信息中的中国电话号码（包括移动和固定电话） | <strong>((\d{3,4})|\d{3,4}-|\s)?\d{7,14}</strong>           |<br>| 提取信息中的中国邮政编码                       | <strong>[1-9]{1}(\d+){5}</strong>                               |<br>| 提取信息中的中国身份证号码                     | <strong>\d{18}|\d{15}</strong>                                 |<br>| 提取信息中的整数                               | <strong>\d+</strong>                                            |<br>| 提取信息中的浮点数（即小数）                   | <strong>(-?\d*).?\d+</strong>                                 |<br>| 提取信息中的任何数字                           | <strong>(-?\d*)(.\d+)?</strong>                               |<br>| 提取信息中的中文字符串                         | <strong>[\u4e00-\u9fa5]*</strong>                              |<br>| 提取信息中的双字节字符串(汉字)                 | <strong>[^\x00-\xff]*</strong>                                 |</p>
<p>正则表达式（regex 或 regexp）在通过搜索特定搜索模式的一个或多个匹配（即 ASCII 或 unicode 字符的特定序列）<strong>从任何文本中提取信息时</strong>非常有用。</p>
<p>应用领域从验证到解析/替换字符串，将数据转换为其他格式以及网络爬虫。</p>
<p>最有趣的功能之一是，一旦你学会了语法，你就可以在（几乎）所有编程语言中使用这个工具（JavaScript，Java，VB，C#，C / C ++，Python，Perl，Ruby，Delphi，R，Tcl 等等），对引擎支持的最高级功能和语法版本的支持有一点区别）。</p>
<h2 id="基本知识点"><a href="#基本知识点" class="headerlink" title="基本知识点"></a>基本知识点</h2><h3 id="先安利个表"><a href="#先安利个表" class="headerlink" title="先安利个表"></a>先安利个表</h3><p>| <strong>符号</strong>   | <strong>详解</strong>                            | <strong>例子</strong>                                                                                                     |<br>| ———- | ———————————– | ———————————————————————————————————— | —————————————- |<br>| 点号 .     | 匹配除换行符以外的任意单字符        | 匹配除换行符以外的任意单字符                                                                                 |<br>| 星号 *    | 任意个字符（包括 0 个）             | 例如，<code>zo*</code> 能匹配 “<code>z</code>“ 以及 “<code>zoo</code>“，* 等价于{0,}                                                         |<br>| 加号 +     | 至少一个字符                        | 例如，’<code>zo+</code>‘ 能匹配 “<code>zo</code>“ 以及 “<code>zoo</code>“，但不能匹配 “<code>z</code>“。+ 等价于 {1,}                                    |<br>| 问号？     | 表示 0 个或 1 个字符                | 例如，”<code>do(es)?</code>“ 可以匹配 “<code>do</code>“ 、 “<code>does</code>“ 中的 “<code>does</code>“ 、 “<code>doxy</code>“ 中的 “<code>do</code>“ 。? 等价于 {0,1}         |<br>| ^          | 表示行的开头                        | <code>^\d</code>表示必须以数字开头                                                                                      |<br>| $          | 表示行的结束                        | <code>\d$</code>表示必须以数字结束                                                                                      |<br>| {n}        | 表示 n 个字符                       | <code>\d&#123;3&#125;</code>表示匹配 3 个数字，例如’<code>010</code>‘                                                                        |<br>| {n,m}      | 表示 n-m 个字符                     | <code>\d&#123;3,8&#125;</code>表示 3-8 个数字，例如’<code>1234567</code>‘。                                                                  |<br>| \d         | 匹配一个数字                        | ‘<code>00\d</code>‘可以匹配’007’，但无法匹配’<code>00A</code>‘； ‘<code>\d\d\d</code>‘可以匹配’<code>010</code>‘ <code>\d&#123;3&#125;</code>表示匹配 3 个数字，例如’<code>010</code>‘； |<br>| \w         | 匹配一个字母或数字                  | ‘<code>\w\w\d</code>‘或’<code>\w\w\w</code>‘可以匹配’<code>py3</code>‘                                                                        |<br>| \s         | 匹配一个空格（也包括 Tab 等空白符） | <code>\s+</code>表示至少有一个空格，例如匹配’ ‘，’ ‘等                                                                  |<br>| A|B       | 可以匹配 A 或 B                     | (<code>P                                                                                                          | p)ython</code>可以匹配’<code>Python</code>‘或者’<code>python</code>‘ |<br>| 小括号()   | 表示匹配括号中全部字符              |                                                                                                              |<br>| [ ] 中括号 | 表示匹配括号中一个字符 范围描述     | 如[<code>0-9 a-z A-Z</code>]                                                                                            |<br>| \ 转义字符 | 基本符号匹配都需要转义字符          | 如 * 表示匹配*号                                                                                           |</p>
<h3 id="锚-—-以及"><a href="#锚-—-以及" class="headerlink" title="锚 — ^ 以及 $"></a>锚 — ^ 以及 $</h3><table>
<thead>
<tr>
<th><strong>符号</strong></th>
<th><strong>详解</strong></th>
<th><strong>**例子**</strong></th>
<th><strong>分析</strong></th>
</tr>
</thead>
<tbody><tr>
<td>^</td>
<td>表示行的开头</td>
<td>^The</td>
<td>匹配任意字符串以 The 为开头</td>
</tr>
<tr>
<td>$</td>
<td>表示行的结束</td>
<td>end$</td>
<td>匹配任意字符串以 end 为结尾</td>
</tr>
<tr>
<td></td>
<td></td>
<td>^The end$</td>
<td>匹配字符串的(开头和结尾分别是 The end)</td>
</tr>
<tr>
<td></td>
<td></td>
<td>^\d</td>
<td>表示必须以数字开头</td>
</tr>
</tbody></table>
<h3 id="量词-—-以及"><a href="#量词-—-以及" class="headerlink" title="量词 — * + ? 以及 {}"></a>量词 — * + ? 以及 {}</h3><table>
<thead>
<tr>
<th><strong>星号 *</strong></th>
<th>任意个字符（包括 0 个）</th>
<th>例如，<code>zo*</code> 能匹配 “<code>z</code>“ 以及 “<code>zoo</code>“，* 等价于{0,}</th>
</tr>
</thead>
<tbody><tr>
<td><strong>加号 +</strong></td>
<td>至少一个字符</td>
<td>例如，’<code>zo+</code>‘ 能匹配 “<code>zo</code>“ 以及 “<code>zoo</code>“，但不能匹配 “<code>z</code>“。+ 等价于 {1,}</td>
</tr>
<tr>
<td><strong>问号？</strong></td>
<td>表示 0 个或 1 个字符</td>
<td>例如，”<code>do(es)?</code>“ 可以匹配 “<code>do</code>“ 、 “<code>does</code>“ 中的 “<code>does</code>“ 、 “<code>doxy</code>“ 中的 “<code>do</code>“ 。? 等价于 {0,1}</td>
</tr>
<tr>
<td><strong>{n}</strong></td>
<td>表示 n 个字符</td>
<td><code>\d&#123;3&#125;</code>表示匹配 3 个数字，例如’<code>010</code>‘</td>
</tr>
<tr>
<td><strong>{n,m}</strong></td>
<td>表示 n-m 个字符</td>
<td><code>\d&#123;3,8&#125;</code>表示 3-8 个数字，例如’<code>1234567</code>‘。</td>
</tr>
</tbody></table>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><table>
<thead>
<tr>
<th>abc*</th>
<th>ab 其后有 0 个或者多个 c</th>
</tr>
</thead>
<tbody><tr>
<td>abc+</td>
<td>ab 其后有 1 个或者多个 c</td>
</tr>
<tr>
<td>abc?</td>
<td>ab 其后有 0 个或者 1 个 c</td>
</tr>
<tr>
<td>abc{2}</td>
<td>ab 其后有 2 个 c</td>
</tr>
<tr>
<td>abc{2,}</td>
<td>ab 其后有 2 个或者多个 c</td>
</tr>
<tr>
<td>abc{2,5}</td>
<td>ab 其后有 2 到 5 个 c</td>
</tr>
<tr>
<td>a(bc)*</td>
<td>a 其后有 0 到多个 bc 的副本</td>
</tr>
<tr>
<td>a(bc){2,5}</td>
<td>a 其后有 0 到 5 个 bc 的副本</td>
</tr>
</tbody></table>
<h3 id="OR-操作符-—-或"><a href="#OR-操作符-—-或" class="headerlink" title="OR 操作符 — | 或 []"></a>OR 操作符 — | 或 []</h3><table>
<thead>
<tr>
<th>符号</th>
<th>详解</th>
<th>示例</th>
<th>分析</th>
</tr>
</thead>
<tbody><tr>
<td>|</td>
<td>或者</td>
<td>A|B</td>
<td>A 或者 B</td>
</tr>
<tr>
<td>[]</td>
<td>范围区间</td>
<td>[A-F]</td>
<td>A 到 F 都可以匹配，适用复杂逻辑大范围区间</td>
</tr>
</tbody></table>
<p>(P|p)ython 可以匹配’Python’或者’python’</p>
<p>[0-9a-zA-Z]可以匹配所有字母和数字</p>
<h3 id="字符类-d、-w、-s-以及转义字符"><a href="#字符类-d、-w、-s-以及转义字符" class="headerlink" title="字符类\d、\w、\s 以及转义字符"></a>字符类\d、\w、\s 以及转义字符</h3><table>
<thead>
<tr>
<th>符号</th>
<th>详解</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>\d</td>
<td>匹配一个数字</td>
<td>‘<code>00\d</code>‘可以匹配’007’，但无法匹配’<code>00A</code>‘； ‘<code>\d\d\d</code>‘可以匹配’<code>010</code>‘ <code>\d&#123;3&#125;</code>表示匹配 3 个数字，例如’<code>010</code>‘；</td>
</tr>
<tr>
<td>\w</td>
<td>匹配一个字母或数字</td>
<td>‘<code>\w\w\d</code>‘或’<code>\w\w\w</code>‘可以匹配’<code>py3</code>‘</td>
</tr>
<tr>
<td>\s</td>
<td>匹配一个空格（也包括 Tab 等空白符）</td>
<td><code>\s+</code>表示至少有一个空格，例如匹配’ ‘，’ ‘等</td>
</tr>
<tr>
<td>.（点号）</td>
<td>匹配除换行符以外的任意单字符</td>
<td>匹配除换行符以外的任意单字符</td>
</tr>
</tbody></table>
<p><code>\d</code>, <code>\w</code> 以及 <code>\s</code> 分别对应其否定类 <code>\D</code>, <code>\W</code> 以及 <code>\S</code> 。例如： <code>\D</code> 将执行与 <code>\d</code> 获得的相反的匹配，即不是数字的字符。</p>
<p>为了获取字面上疑似的字符，你必须使用反斜杠 <code>\</code> 来转义字符 <code>^.[$()|*+?&#123;\</code>，因为它们具有特殊含义。</p>
<p>注意你也可以匹配<strong>非打印字符</strong>比如 tabs <code>\t</code>，换行 <code>\n</code>，回车 <code>\r</code>。</p>
<h3 id="标志"><a href="#标志" class="headerlink" title="标志"></a>标志</h3><p>我们正在学习如何构建一个正则表达式但是却忘记了一个基础的概念：<strong>标志</strong>。</p>
<p>一个正则表达式的格式通常是这个样子的 <code>/abc/</code>，搜索模式通过两个斜杠符 <code>/</code> 进行区分。在末尾我们可以规定一个标志使用以下的值（我们也可以将它们相互结合）：</p>
<ul>
<li><strong>g</strong>(全局的) 在第一匹配之后不会立即返回，从前面匹配之后继续搜索</li>
<li><strong>m</strong> (多行的) 当使用 <code>^</code> 以及 <code>$</code> 的时候将会匹配行首和行尾而不是整个字符串</li>
<li><strong>i</strong> (大小写不敏感的) 让整个表达式大小写不敏感（比如 <code>/aBc/i</code> 将匹配 <code>Abc</code>）</li>
</ul>
<h2 id="中级知识点"><a href="#中级知识点" class="headerlink" title="中级知识点"></a>中级知识点</h2><h3 id="分组以及捕获-—"><a href="#分组以及捕获-—" class="headerlink" title="分组以及捕获 — ()"></a>分组以及捕获 — ()</h3><p>a(bc) 括号产生一个值为 bc 的捕获分组</p>
<p>a(?:bc)* 我么可以使用 ?: 让捕获分组不起作用</p>
<p>a(?bc) 我们可以使用 ? 将名字放在分组中</p>
<p>当我们需要使用你首选的编程语言从字符串或数据中提取信息时，此运算符非常有用。 由几个组捕获的任何多次出现都将以经典数组的形式公开：我们将使用匹配结果的索引来访问它们的值。</p>
<p>如果我们选择为组添加名称（使用（<code>?&lt;foo&gt;</code> …）），我们将能够使用匹配结果检索组值，如字典，其中字典的名称就是刚才添加的名称。</p>
<h3 id="方括号表达式"><a href="#方括号表达式" class="headerlink" title="方括号表达式   []"></a>方括号表达式   []</h3><p>[abc] 匹配一个具有 要么一个 a 或者一个 b 或者一个 c 的字符串等同于 <code>a|b|c</code></p>
<p>[a-c] 与前一条相同</p>
<p>[a-fA-F0-9] 十六进制数字符串，大小写不敏感</p>
<p>[0-9]% 一个具有从 0 到 9 其后后一个 % 符号</p>
<p>[^a-za-z] 一个不是大小写字母的字符串。在这种情况下，^ 被用为 表达式的否定。</p>
<p><strong>注意：</strong>在括号内表达式中，所有特殊字符（包括反斜杠\）都会失去它们的特殊功能：因此我们不会应用“转义规则”。</p>
<h3 id="贪婪和惰性匹配"><a href="#贪婪和惰性匹配" class="headerlink" title="贪婪和惰性匹配"></a>贪婪和惰性匹配</h3><p>量词 ( <code>* + &#123;&#125;</code>) 是贪婪操作符, 所以他们尽可能地通过提供的文本扩展匹配.</p>
<p>比如， <code>&lt;.+&gt;</code> 会从 <code>This is a **&lt;div&gt; simple div&lt;/div&gt;** test</code> 中匹配 <code>&lt;div&gt;simple div&lt;/div&gt;</code>。 为了仅仅匹配 div 标签， 我们可以使用一个 <code>?</code> 让它变为惰性:</p>
<p>&lt;.+?&gt; 匹配 任意字符被包含在 &lt; 以及 &gt;之中，出现一到多次, 需要的时候才会扩展</p>
<p>注意更好的解决方案是避免使用 <code>.</code>来构建一个更严格的正则表达式：</p>
<p>&lt;[^&lt;&gt;]+&gt; 匹配任意的字符除了 <code>&lt;</code> 或者 <code>&gt;</code> 一次或者多次被包含在 &lt; 以及 &gt; 之中</p>
<h2 id="高级知识点"><a href="#高级知识点" class="headerlink" title="高级知识点"></a>高级知识点</h2><h3 id="边界-—-b-以及-B"><a href="#边界-—-b-以及-B" class="headerlink" title="边界 — \b 以及 \B"></a><strong>边界 — \b 以及 \B</strong></h3><p>\babc\b 执行“仅限整个单词”搜索<strong>abc</strong></p>
<p><code>\b</code> 代表一个锚类似于符号 (等同于 <code>$</code> 以及 <code>^</code>) 的匹配位置， 其中一侧是单词字符（如 <code>\w</code>），另外一侧不是单词字符（例如它可能是字符串的开头或空格字符）。</p>
<p>随之而来是它的否定, <code>\B</code>. 这将会匹配所有 <code>\b</code> 不会匹配的位置如果我们希望搜索模式可以被单词字符所匹配。</p>
<p>\Babc\B 仅在搜索模式被单词字符包围的时候才会匹配</p>
<h3 id="返回引用—-1"><a href="#返回引用—-1" class="headerlink" title="返回引用— \1"></a>返回引用— \1</h3><p>([abc])\1 使用 <code>\1</code> 将会匹配与第一个捕获分组相同的文本</p>
<p>([abc])([de])\2\1 我们可以使用 \2 (\3, \4, 等等)来获取被第二个(第三个, 第四个, 等等.)捕获分组相同的文本</p>
<p>(?[abc])\k 我们将分组名称命名为<code>foo</code> 并随后使用 <code>(\k&lt;foo&gt;)</code> 来进行引用。结果与第一个正则表达式相同</p>
<h3 id="前瞻和后瞻-—-以及-lt"><a href="#前瞻和后瞻-—-以及-lt" class="headerlink" title="前瞻和后瞻 — (?=) 以及 (?&lt;=)"></a>前瞻和后瞻 — <strong>(?=)</strong> 以及 <strong>(?&lt;=)</strong></h3><p>d(?=r) 匹配一个 <code>d</code> 并且其后有一个 <code>r</code>, 但是 <code>r</code> 将不会是整个正则表达式匹配的一部分</p>
<p>(?&lt;=r)d 匹配一个 <code>d</code> 并且前面有一个 <code>r</code>, 但是 <code>r</code> 将不会是整个正则表达式匹配的一部分</p>
<p>我们也可以使用否定符号 !</p>
<p>d(?!r) 匹配一个 <code>d</code> 并且其后不是一个 <code>r</code>, 但是 <code>r</code> 将不会是整个正则表达式匹配的一部分</p>
<p>(?&lt;!r)d 匹配一个 <code>d</code> 并且前面不是一个 <code>r</code>, 但是 <code>r</code> 将不会是整个正则表达式匹配的一部分</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>正如你所见，正则表达式的应用程序字段可以是多个，我确信你已经认识到在开发人员职业生涯中看到的这些任务中的至少一个，这里有一个快速列表：</p>
<ul>
<li>数据验证 (比如检查一个时间字符串 i 的格式是正确的)</li>
<li>数据抓取（特别是网页抓取，最终按特定顺序查找包含特定单词集的所有页面）</li>
<li>数据转换（将数据从“原始”转换为另一种格式）</li>
<li>字符串解析（例如捕获所有 URL GET 参数，捕获一组括号内的文本）</li>
<li>字符串替换（即使在使用通用 IDE 的代码会话期间，例如在相应的 JSON 对象中转换 Java 或 C# 类 - 将“;”替换为“,”将其设为小写，避免类型声明等）</li>
<li>语法高亮，文件重命名，数据包嗅探和涉及字符串的许多其他应用程序（其中数据不必是文本）</li>
</ul>
<h3 id="参考其他"><a href="#参考其他" class="headerlink" title="参考其他"></a>参考其他</h3><p><a href="https://github.com/ziishaned/learn-regex/blob/master/translations/README-cn.md">GitHub regex101</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>正则</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>正则</tag>
      </tags>
  </entry>
  <entry>
    <title>阿里云云服务器ECS购买与使用（笔记）</title>
    <url>/posts/40394/</url>
    <content><![CDATA[<h2 id="购买"><a href="#购买" class="headerlink" title="购买"></a>购买</h2><p>进入阿里云下拉菜单选择 ecs ：</p>
<img src="/posts/40394/ecs_config.png" class="" title="ecs_config">

<p>我购买的配置如下：</p>
<img src="/posts/40394/ecs_config.png" class="" title="ecs_config">

<p>购买后实例就运行了，远程连接后安装一系列包和软件：</p>
<h2 id="如何安装"><a href="#如何安装" class="headerlink" title="如何安装"></a>如何安装</h2><p><a href="https://www.cnblogs.com/87hbteo/p/7802104.html">阿里云服务器 ECS LAMP 环境安装（Ubuntu）</a><br><a href="https://blog.csdn.net/KascLiyuan/article/details/73438093">阿里云 ECS 云服务器外网 IP 无法访问</a></p>
<h2 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h2><p><a href="https://jingyan.baidu.com/article/48b558e3f25e6d7f38c09aec.html">阿里云如何解析域名</a></p>
<a id="more"></a>

<h2 id="Github-Page-自定义域名"><a href="#Github-Page-自定义域名" class="headerlink" title="Github Page 自定义域名"></a>Github Page 自定义域名</h2><ul>
<li><a href="https://www.jianshu.com/p/8ac6c7c037c5">创建 Github Page 并设置自定义域名</a></li>
<li><a href="http://wiki.jikexueyuan.com/project/github-pages-basics/cname-file.html">添加 CNAME 文件到你的存储库中</a></li>
</ul>
<h2 id="Ubuntu-安装-nodejs"><a href="#Ubuntu-安装-nodejs" class="headerlink" title="Ubuntu 安装 nodejs"></a>Ubuntu 安装 nodejs</h2><ul>
<li><a href="https://evestorm.github.io/posts/58410/%E9%98%BF%E9%87%8C%E4%BA%91Ubuntu%E6%90%AD%E5%BB%BANodeJs%E7%8E%AF%E5%A2%83">https://blog.5udou.cn/blog/A-Li-Yun-UbuntuDa-Jian-NodeJsHuan-Jing-75</a></li>
</ul>
<h2 id="ubuntu-图形界面下无法用-root-登录解决办法"><a href="#ubuntu-图形界面下无法用-root-登录解决办法" class="headerlink" title="ubuntu 图形界面下无法用 root 登录解决办法"></a>ubuntu 图形界面下无法用 root 登录解决办法</h2><p>先按照 <a href="https://www.linuxidc.com/Linux/2017-01/139094.htm">这个教程</a> 走，但最后不重启。然后转到 <a href="https://blog.csdn.net/qq_39591507/article/details/81288644">这个教程</a>，执行第三步，也就是下面这段：</p>
<blockquote>
<p>进入/etc/pam.d 文件夹下，修改 gdm-autologin 和 gdm-passwd 文件内容(首先修改文件权限，参考步骤 2 的操作)</p>
<p>gdm-autologin 文件注释掉 auth required pam_success_if.so user!=root quiet_success 这一行</p>
<p>gdm-passwd 文件注释掉 auth required pam_success_if.so user!=root quiet_success 这一行</p>
</blockquote>
<p>做完后重启然后点击登录其他用户，输入 root 和密码 root（这个密码在上面第一个教程中已经自己设置了）就好。</p>
<h2 id="安装-LAMP-环境"><a href="#安装-LAMP-环境" class="headerlink" title="安装 LAMP 环境"></a>安装 LAMP 环境</h2><p><a href="https://blog.csdn.net/qq_27366789/article/details/81990291">在 ubuntu16.04 中一键创建 LAMP 环境</a></p>
<h3 id="编辑文件"><a href="#编辑文件" class="headerlink" title="编辑文件"></a>编辑文件</h3><ul>
<li>退出 mysql 命令行：<code>exit</code></li>
<li>vi 编辑文件 按下 i 表示编辑 按下 esc 退出编辑模式 按下 <code>:wq</code> 保存退出</li>
</ul>
<h3 id="mysql-操作"><a href="#mysql-操作" class="headerlink" title="mysql 操作"></a>mysql 操作</h3><p>登录 mysql -u root -p</p>
<p>-u 表示选择登陆的用户名， -p 表示登陆的用户密码，现在是 mysql 数据库是没有密码的，Enter password:处直接回车，就能够进入 mysql 数据库。</p>
<h4 id="导入导出"><a href="#导入导出" class="headerlink" title="导入导出"></a>导入导出</h4><p><a href="https://blog.csdn.net/hewenjing8168/article/details/80821447">ubuntu 下 mysql 数据库的导入导出</a></p>
<h2 id="安装-图形化-mysql-workbench"><a href="#安装-图形化-mysql-workbench" class="headerlink" title="安装 图形化 mysql-workbench"></a>安装 图形化 mysql-workbench</h2><p><a href="https://blog.csdn.net/qq_37638061/article/details/80246799">安装 mysql 服务，及安装图形化管理界面</a></p>
<h2 id="打开-mysql-图形化后无法连接数据库"><a href="#打开-mysql-图形化后无法连接数据库" class="headerlink" title="打开 mysql 图形化后无法连接数据库"></a>打开 mysql 图形化后无法连接数据库</h2><p><a href="https://blog.csdn.net/chexiansheng/article/details/89193955">Unbuntu 下 Mysql 连接 MysqlWorkBench 出现错误</a></p>
<h2 id="在-ubuntu-下搭建-ftp-服务器"><a href="#在-ubuntu-下搭建-ftp-服务器" class="headerlink" title="在 ubuntu 下搭建 ftp 服务器"></a>在 ubuntu 下搭建 ftp 服务器</h2><ul>
<li><a href="https://www.howtoing.com/how-to-set-up-vsftpd-for-a-user-s-directory-on-ubuntu-18-04">如何在 Ubuntu 18.04 上为用户目录设置 vsftpd</a><br>执行完上面操作后，会发现下面两个问题，按方法调整就好：</li>
<li><a href="https://blog.51cto.com/zhkao/1758125">使用 FileZilla FTP 下载时提示“不安全的服务器，不支持 FTPover TLS”,和“服务器不支持非 ASCII 字符”</a></li>
<li><a href="https://blog.csdn.net/wbryfl/article/details/82729189">ftp 连接错误——服务器发回了不可路由的地址。使用服务器地址代替。</a></li>
</ul>
<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>FTP 是文件传输协议的缩写，是一种曾经广泛用于在客户端和服务器之间移动文件的网络协议。 它已被更快，更安全，更方便的文件传输方式所取代。 许多休闲互联网用户希望通过<code>https</code>直接从他们的网络浏览器下载，命令行用户更有可能使用安全协议，如<code>scp</code>或<a href="https://www.howtoing.com/how-to-use-sftp-to-securely-transfer-files-with-a-remote-server/">SFTP</a> 。</p>
<p>FTP 仍然用于支持具有特定需求的遗留应用程序和工作流。 如果您可以选择使用哪种协议，请考虑探索更现代的选项。 但是，当您确实需要 FTP 时，vsftpd 是一个很好的选择。 vsftpd 针对安全性，性能和稳定性进行了优化，可以很好地防范其他 FTP 服务器中存在的许多安全问题，并且是许多 Linux 发行版的默认设置。</p>
<p>在本教程中，您将配置 vsftpd 以允许用户使用具有 SSL / TLS 保护的登录凭据的 FTP 将文件上载到其主目录。</p>
<h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><p>要学习本教程，您需要：</p>
<ul>
<li><strong>Ubuntu 18.04 服务器和具有 sudo 权限的非 root 用户</strong> ：您可以在<a href="https://www.howtoing.com/initial-server-setup-with-ubuntu-18-04/">使用 Ubuntu 18.04</a>指南的<a href="https://www.howtoing.com/initial-server-setup-with-ubuntu-18-04/">初始服务器设置中</a>了解有关如何使用这些权限设置用户的更多信息。</li>
</ul>
<h3 id="第-1-步-安装-vsftpd"><a href="#第-1-步-安装-vsftpd" class="headerlink" title="第 1 步 - 安装 vsftpd"></a>第 1 步 - 安装 vsftpd</h3><p>让我们首先更新我们的包列表并安装<code>vsftpd</code>守护进程：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install vsftpd</span><br></pre></td></tr></table></figure>

<p>安装完成后，让我们复制配置文件，这样我们就可以从空白配置开始，将原件保存为备份：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo cp /etc/vsftpd.conf /etc/vsftpd.conf.orig</span><br></pre></td></tr></table></figure>

<p>通过备份配置，我们已准备好配置防火墙。</p>
<h3 id="第-2-步-打开防火墙"><a href="#第-2-步-打开防火墙" class="headerlink" title="第 2 步 - 打开防火墙"></a>第 2 步 - 打开防火墙</h3><p><strong>注意：</strong> 最后我们还得打开 80 和 8080 端口！！！</p>
<p>让我们检查防火墙状态以查看它是否已启用。 如果是，我们将确保允许 FTP 流量，因此防火墙规则不会阻止我们的测试。</p>
<p>检查防火墙状态：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw status</span><br></pre></td></tr></table></figure>

<p>在这种情况下，只允许 SSH 通过：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">OutputStatus: active</span><br><span class="line"></span><br><span class="line">To                         Action      From</span><br><span class="line">--                         ------      ----</span><br><span class="line">OpenSSH                    ALLOW       Anywhere</span><br><span class="line">OpenSSH (v6)               ALLOW       Anywhere (v6)</span><br></pre></td></tr></table></figure>

<p>您可能有其他规则或根本没有防火墙规则。 由于在这种情况下只允许 SSH 流量，因此我们需要为 FTP 流量添加规则。</p>
<p>让我们打开端口<code>20</code>和<code>21</code>用于 FTP，端口<code>990</code>用于启用 TLS，端口<code>40000-50000</code>用于我们计划在配置文件中设置的被动端口范围：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw allow 20/tcp</span><br><span class="line">sudo ufw allow 21/tcp</span><br><span class="line">sudo ufw allow 990/tcp</span><br><span class="line">sudo ufw allow 40000:50000/tcp</span><br><span class="line">sudo ufw status</span><br></pre></td></tr></table></figure>

<p>我们的防火墙规则现在应如下所示：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">OutputStatus: active</span><br><span class="line"></span><br><span class="line">To                         Action      From</span><br><span class="line">--                         ------      ----</span><br><span class="line">OpenSSH                    ALLOW       Anywhere</span><br><span class="line">990/tcp                    ALLOW       Anywhere</span><br><span class="line">20/tcp                     ALLOW       Anywhere</span><br><span class="line">21/tcp                     ALLOW       Anywhere</span><br><span class="line">40000:50000/tcp            ALLOW       Anywhere</span><br><span class="line">OpenSSH (v6)               ALLOW       Anywhere (v6)</span><br><span class="line">20/tcp (v6)                ALLOW       Anywhere (v6)</span><br><span class="line">21/tcp (v6)                ALLOW       Anywhere (v6)</span><br><span class="line">990/tcp (v6)               ALLOW       Anywhere (v6)</span><br><span class="line">40000:50000/tcp (v6)       ALLOW       Anywhere (v6)</span><br></pre></td></tr></table></figure>

<p>p.s. 如何删除一个 rule：<code>sudo ufw delete allow 80/tcp</code></p>
<p>安装了<code>vsftpd</code>并打开了必要的端口后，我们继续创建一个专用的 FTP 用户。</p>
<h3 id="第-3-步-准备用户目录"><a href="#第-3-步-准备用户目录" class="headerlink" title="第 3 步 - 准备用户目录"></a>第 3 步 - 准备用户目录</h3><p>我们将创建一个专用的 FTP 用户，但您可能已经有一个需要 FTP 访问的用户。 我们将注意保留现有用户对以下说明中的数据的访问权限。 即便如此，我们建议您在配置和测试设置之前先与新用户联系。</p>
<p>首先，添加一个测试用户：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo adduser sammy</span><br></pre></td></tr></table></figure>

<p>出现提示时分配密码。 随意通过其他提示按<code>ENTER</code> 。</p>
<p>当用户被限制在特定目录时，FTP 通常更安全。 <code>vsftpd</code>用<a href="https://www.howtoing.com/how-to-configure-chroot-environments-for-testing-on-an-ubuntu-12-04-vps/#what-is-a-chroot-environment"><code>chroot</code></a> jails 完成了这个。 为本地用户启用<code>chroot</code> ，默认情况下它们仅限于其主目录。 但是，由于<code>vsftpd</code>保护目录的方式，用户不能写入。 这对于只应通过 FTP 连接的新用户来说很好，但如果现有用户也具有 shell 访问权限，则可能需要写入其主文件夹。</p>
<p>在这个例子中，不是从主目录中删除写权限，而是创建一个<code>ftp</code>目录作为<code>chroot</code>和一个可写<code>files</code>目录来保存实际文件。</p>
<p>创建<code>ftp</code>文件夹：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir /home/sammy/ftp</span><br></pre></td></tr></table></figure>

<p>设置所有权：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo chown nobody:nogroup /home/sammy/ftp</span><br></pre></td></tr></table></figure>

<p>删除写权限：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo chmod a-w /home/sammy/ftp</span><br></pre></td></tr></table></figure>

<p>验证权限：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ls -la /home/sammy/ftp</span><br><span class="line">Outputtotal 8</span><br><span class="line">4 dr-xr-xr-x  2 nobody nogroup 4096 Aug 24 21:29 .</span><br><span class="line">4 drwxr-xr-x  3 sammy  sammy   4096 Aug 24 21:29 ..</span><br></pre></td></tr></table></figure>

<p>接下来，让我们创建文件上传目录并为用户分配所有权：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir /home/sammy/ftp/files</span><br><span class="line">sudo chown sammy:sammy /home/sammy/ftp/files</span><br></pre></td></tr></table></figure>

<p>对<code>ftp</code>目录的权限检查应返回以下内容：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ls -la /home/sammy/ftp</span><br><span class="line">Outputtotal 12</span><br><span class="line">dr-xr-xr-x 3 nobody nogroup 4096 Aug 26 14:01 .</span><br><span class="line">drwxr-xr-x 3 sammy  sammy   4096 Aug 26 13:59 ..</span><br><span class="line">drwxr-xr-x 2 sammy  sammy   4096 Aug 26 14:01 files</span><br></pre></td></tr></table></figure>

<p>最后，让我们添加一个<code>test.txt</code>文件，以便在测试时使用：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;vsftpd test file&quot; | sudo tee /home/sammy/ftp/files/test.txt</span><br></pre></td></tr></table></figure>

<p>现在我们已经保护了<code>ftp</code>目录并允许用户访问<code>files</code>目录，让我们修改我们的配置。</p>
<h3 id="第-4-步-配置-FTP-访问"><a href="#第-4-步-配置-FTP-访问" class="headerlink" title="第 4 步 - 配置 FTP 访问"></a>第 4 步 - 配置 FTP 访问</h3><p>我们计划允许具有本地 shell 帐户的单个用户与 FTP 连接。 这两个关键设置已在<code>vsftpd.conf</code>设置。 首先打开配置文件，验证配置中的设置是否与以下设置相匹配：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/vsftpd.conf</span><br></pre></td></tr></table></figure>

<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line"><span class="meta">#</span><span class="bash"> Allow anonymous FTP? (Disabled by default).</span></span><br><span class="line">anonymous_enable=NO</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Uncomment this to allow local users to log in.</span></span></span><br><span class="line">local_enable=YES</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>

<p>接下来，让我们通过取消注释<code>write_enable</code>设置来允许用户上传文件：</p>
<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line">write_enable=YES</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>

<p>我们还将取消注释<code>chroot</code>以防止 FTP 连接的用户访问目录树之外的任何文件或命令：</p>
<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>

<p>我们还添加一个<code>user_sub_token</code>以在<code>local_root directory</code>路径中插入用户名，这样我们的配置将适用于此用户和任何其他未来用户。 在文件中的任何位置添加这些设置：</p>
<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line">user_sub_token=$USER</span><br><span class="line">local_root=/home/$USER/ftp</span><br></pre></td></tr></table></figure>

<p>我们还限制了可用于被动 FTP 的端口范围，以确保有足够的连接可用：</p>
<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line">pasv_min_port=40000</span><br><span class="line">pasv_max_port=50000</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>在第 2 步中，我们打开了我们在此处为被动端口范围设置的端口。 如果更改值，请务必更新防火墙设置。</p>
<p>要根据具体情况允许 FTP 访问，让我们设置配置，以便用户只有在明确添加到列表时才能访问，而不是默认情况下：</p>
<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line">userlist_enable=YES</span><br><span class="line">userlist_file=/etc/vsftpd.userlist</span><br><span class="line">userlist_deny=NO</span><br></pre></td></tr></table></figure>

<p><code>userlist_deny</code>切换逻辑：当它设置为<code>YES</code> ，列表中的用户被拒绝 FTP 访问。 当它设置为<code>NO</code> ，只允许列表中的用户访问。</p>
<p>完成更改后，保存文件并退出编辑器。</p>
<p>最后，让我们将用户添加到<code>/etc/vsftpd.userlist</code> 。 使用<code>-a</code>标志追加到文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;sammy&quot; | sudo tee -a /etc/vsftpd.userlist</span><br></pre></td></tr></table></figure>

<p>检查它是否按预期添加：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /etc/vsftpd.userlist</span><br><span class="line">Outputsammy</span><br></pre></td></tr></table></figure>

<p>重新启动守护程序以加载配置更改：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl restart vsftpd</span><br></pre></td></tr></table></figure>

<p>配置到位后，我们继续测试 FTP 访问。</p>
<h3 id="第-5-步-测试-FTP-访问"><a href="#第-5-步-测试-FTP-访问" class="headerlink" title="第 5 步 - 测试 FTP 访问"></a>第 5 步 - 测试 FTP 访问</h3><p>我们已将服务器配置为仅允许用户<code>sammy</code>通过 FTP 连接。 让我们确保它按预期工作。</p>
<p><strong>匿名用户应该无法连接</strong> ：我们已禁用匿名访问。 让我们通过尝试匿名连接来测试它。 如果我们的配置设置正确，则应拒绝匿名用户的权限。 请务必将<code>203.0.113.0</code>替换为服务器的公共 IP 地址：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ftp -p 203.0.113.0</span><br><span class="line">OutputConnected to 203.0.113.0.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (203.0.113.0:default): anonymous</span><br><span class="line">530 Permission denied.</span><br><span class="line">ftp: Login failed.</span><br><span class="line"><span class="meta">ftp&gt;</span></span><br></pre></td></tr></table></figure>

<p>关闭连接：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bye</span><br></pre></td></tr></table></figure>

<p><strong>除了 sammy 之外的用户应该无法连接</strong> ：接下来，让我们尝试连接我们的 sudo 用户。 他们也应该被拒绝访问，并且应该在他们被允许输入密码之前发生：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ftp -p 203.0.113.0</span><br><span class="line">OutputConnected to 203.0.113.0.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (203.0.113.0:default): sudo_user</span><br><span class="line">530 Permission denied.</span><br><span class="line">ftp: Login failed.</span><br><span class="line"><span class="meta">ftp&gt;</span></span><br></pre></td></tr></table></figure>

<p>关闭连接：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bye</span><br></pre></td></tr></table></figure>

<p><strong>用户 sammy 应该能够连接，读取和写入文件</strong> ：让我们确保我们的指定用户可以连接：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ftp -p 203.0.113.0</span><br><span class="line">OutputConnected to 203.0.113.0.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (203.0.113.0:default): sammy</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password: your_user&#x27;s_password</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line"><span class="meta">ftp&gt;</span></span><br></pre></td></tr></table></figure>

<p>让我们切换到<code>files</code>目录并使用<code>get</code>命令将我们之前创建的测试文件传输到本地机器：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd files</span><br><span class="line">get test.txt</span><br><span class="line">Output227 Entering Passive Mode (203,0,113,0,169,12).</span><br><span class="line">150 Opening BINARY mode data connection for test.txt (16 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">16 bytes received in 0.0101 seconds (1588 bytes/s)</span><br><span class="line"><span class="meta">ftp&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来，让我们使用新名称上传文件以测试写入权限：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">put test.txt upload.txt</span><br><span class="line">Output227 Entering Passive Mode (203,0,113,0,164,71).</span><br><span class="line">150 Ok to send data.</span><br><span class="line">226 Transfer complete.</span><br><span class="line">16 bytes sent in 0.000894 seconds (17897 bytes/s)</span><br></pre></td></tr></table></figure>

<p>关闭连接：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bye</span><br></pre></td></tr></table></figure>

<p>现在我们已经测试了我们的配置，让我们采取措施进一步保护我们的服务器。</p>
<h3 id="第-6-步-保护交易"><a href="#第-6-步-保护交易" class="headerlink" title="第 6 步 - 保护交易"></a>第 6 步 - 保护交易</h3><p>由于 FTP 不会加密传输中的任何数据，包括用户凭据，因此我们将启用 TLS / SSL 来提供加密。 第一步是创建用于<code>vsftpd</code>的 SSL 证书。</p>
<p>让我们使用<code>openssl</code>创建一个新证书，并使用<code>-days</code>标志使其有效一年。 在同一个命令中，我们将添加一个私有的 2048 位 RSA 密钥。 通过将<code>-keyout</code>和<code>-out</code>标志都设置为相同的值，私钥和证书将位于同一文件中：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/vsftpd.pem -out /etc/ssl/private/vsftpd.pem</span><br></pre></td></tr></table></figure>

<p>系统将提示您提供证书的地址信息。 将您自己的信息替换为以下突出显示的值：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">OutputGenerating a 2048 bit RSA private key</span><br><span class="line">............................................................................+++</span><br><span class="line">...........+++</span><br><span class="line">writing new private key to &#x27;/etc/ssl/private/vsftpd.pem&#x27;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:US</span><br><span class="line">State or Province Name (full name) [Some-State]:NY</span><br><span class="line">Locality Name (eg, city) []:New York City</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:DigitalOcean</span><br><span class="line">Organizational Unit Name (eg, section) []:</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []: your_server_ip</span><br><span class="line">Email Address []:</span><br></pre></td></tr></table></figure>

<p>有关证书标志的更多详细信息，请参阅<a href="https://www.howtoing.com/openssl-essentials-working-with-ssl-certificates-private-keys-and-csrs/">OpenSSL Essentials：使用 SSL 证书，私钥和 CSR</a></p>
<p>创建证书后，再次打开<code>vsftpd</code>配置文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/vsftpd.conf</span><br></pre></td></tr></table></figure>

<p>在文件的底部，您将看到以<code>rsa_</code>开头的两行。 评论它们，看起来像这样：</p>
<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line"><span class="meta">#</span><span class="bash"> rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</span></span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>

<p>在它们下面，添加以下指向我们刚刚创建的证书和私钥的行：</p>
<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line">rsa_cert_file=/etc/ssl/private/vsftpd.pem</span><br><span class="line">rsa_private_key_file=/etc/ssl/private/vsftpd.pem</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>

<p>之后，我们将强制使用 SSL，这将阻止无法处理 TLS 的客户端连接。 这对于确保所有流量都已加密是必要的，但它可能会强制您的 FTP 用户更改客户端。 将<code>ssl_enable</code>更改为<code>YES</code> ：</p>
<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line">ssl_enable=YES</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>

<p>之后，添加以下行以显式拒绝 SSL 上的匿名连接，并要求 SSL 进行数据传输和登录：</p>
<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line">allow_anon_ssl=NO</span><br><span class="line">force_local_data_ssl=YES</span><br><span class="line">force_local_logins_ssl=YES</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>

<p>在此之后，通过添加以下行将服务器配置为使用 TLS（SSL 的首选后继者）：</p>
<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line">ssl_tlsv1=YES</span><br><span class="line">ssl_sslv2=NO</span><br><span class="line">ssl_sslv3=NO</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>

<p>最后，我们将添加两个选项。 首先，我们不会要求重用 SSL，因为它可能会破坏许多 FTP 客户端。 我们将需要“高”加密密码套件，目前这意味着密钥长度等于或大于 128 位：</p>
<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line">require_ssl_reuse=NO</span><br><span class="line">ssl_ciphers=HIGH</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>

<p>完成的文件部分应如下所示：</p>
<p>/etc/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> This option specifies the location of the RSA certificate to use <span class="keyword">for</span> SSL</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> encrypted connections.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</span></span><br><span class="line">rsa_cert_file=/etc/ssl/private/vsftpd.pem</span><br><span class="line">rsa_private_key_file=/etc/ssl/private/vsftpd.pem</span><br><span class="line">ssl_enable=YES</span><br><span class="line">allow_anon_ssl=NO</span><br><span class="line">force_local_data_ssl=YES</span><br><span class="line">force_local_logins_ssl=YES</span><br><span class="line">ssl_tlsv1=YES</span><br><span class="line">ssl_sslv2=NO</span><br><span class="line">ssl_sslv3=NO</span><br></pre></td></tr></table></figure>

<p>完成后，保存并关闭文件。</p>
<p>重新启动服务器以使更改生效：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl restart vsftpd</span><br></pre></td></tr></table></figure>

<p>此时，我们将无法再使用不安全的命令行客户端进行连接。 如果我们尝试过，我们会看到类似的东西：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ftp -p 203.0.113.0</span><br><span class="line">Connected to 203.0.113.0.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (203.0.113.0:default): sammy</span><br><span class="line">530 Non-anonymous sessions must use encryption.</span><br><span class="line">ftp: Login failed.</span><br><span class="line">421 Service not available, remote server has closed connection</span><br><span class="line"><span class="meta">ftp&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来，让我们验证我们是否可以使用支持 TLS 的客户端进行连接。</p>
<h3 id="第-7-步-使用-FileZilla-测试-TLS"><a href="#第-7-步-使用-FileZilla-测试-TLS" class="headerlink" title="第 7 步 - 使用 FileZilla 测试 TLS"></a>第 7 步 - 使用 FileZilla 测试 TLS</h3><p>大多数现代 FTP 客户端都可以配置为使用 TLS 加密。 我们将演示如何与<a href="https://filezilla-project.org/">FileZilla</a>连接，因为它支持跨平台。 请参阅其他客户的文档。</p>
<p>首次打开 FileZilla 时，在主页上方找到站点管理器图标，这是最上一行最左侧的图标。 点击它：</p>
<img src="/posts/40394/filezilla_site_manager_vsftpd_18_04.png" class="" title="filezilla_site_manager_vsftpd_18_04">

<p>将打开一个新窗口。 单击右下角的“ <strong>新建站点”</strong>按钮：</p>
<img src="/posts/40394/new-site.png" class="" title="new-site">

<p>在“ <strong>我的网站”</strong>下，将出现一个带有“ <strong>新网站</strong> ”字样的新图标。 您可以立即命名或稍后返回并使用“ <strong>重命名”</strong>按钮。</p>
<p>使用名称或 IP 地址填写<strong>主机</strong>字段。 在“ <strong>加密”</strong>下拉菜单下，选择“ <strong>要求显式 FTP over TLS”</strong> 。</p>
<p>对于<strong>登录类型</strong> ，选择<strong>询问密码</strong> 。 在“ <strong>用户”</strong>字段中填写您的 FTP 用户：</p>


<p>单击界面底部的“连接”。 系统将要求您输入用户密码：</p>
<img src="/posts/40394/user-pass.png" class="" title="密码对话">

<p>单击<strong>确定</strong>以进行连接。 您现在应该使用 TLS / SSL 加密与您的服务器连接。</p>
<p>成功后，您将看到一个如下所示的服务器证书：</p>
<img src="/posts/40394/filezilla_certificate_vsftpd_three.png" class="" title="filezilla_certificate_vsftpd_three">

<p>当您接受证书后，双击<code>files</code>夹并将<code>upload.txt</code>拖到左侧以确认您能够下载文件：</p>
<p><a href="https://www.howtoing.com/wp-content/uploads/articles/vsftpd_18_04/vsftpd_images/filezilla_file_test_vsftpd_18_04.png"><img src="%E9%98%BF%E9%87%8C%E4%BA%91%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8ECS%E8%B4%AD%E4%B9%B0%E4%B8%8E%E4%BD%BF%E7%94%A8%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/filezilla_file_test_vsftpd_18_04.png" alt="下载test.txt"></a></p>
<img src="/posts/40394/filezilla_file_test_vsftpd_18_04.png" class="" title="下载test.txt">

<p>完成后，右键单击本地副本，将其重命名为<code>upload-tls.txt</code>并将其拖回服务器以确认您可以上传文件：</p>
<img src="/posts/40394/filezilla_file_upload_vsftpd_18_04.png" class="" title="重命名和上传">

<p>您现在已确认可以安全地成功传输启用了 SSL / TLS 的文件。</p>
<h3 id="第-8-步-禁用-Shell-访问（可选）"><a href="#第-8-步-禁用-Shell-访问（可选）" class="headerlink" title="第 8 步 - 禁用 Shell 访问（可选）"></a>第 8 步 - 禁用 Shell 访问（可选）</h3><p>如果由于客户端要求而无法使用 TLS，则可以通过禁用 FTP 用户以任何其他方式登录的方式来获得一些安全性。 防止它的一种相对简单的方法是创建一个自定义 shell。 这不会提供任何加密，但会限制受感染帐户对 FTP 可访问的文件的访问。</p>
<p>首先，在<code>bin</code>目录中打开一个名为<code>ftponly</code>的文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo nano /bin/ftponly</span><br></pre></td></tr></table></figure>

<p>添加一条消息，告诉用户他们无法登录的原因：</p>
<p>/斌/ ftponly</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">echo &quot;This account is limited to FTP access only.&quot;</span><br></pre></td></tr></table></figure>

<p>保存文件并退出编辑器。</p>
<p>更改权限以使文件可执行：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo chmod a+x /bin/ftponly</span><br></pre></td></tr></table></figure>

<p>打开有效 shell 列表：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/shells</span><br></pre></td></tr></table></figure>

<p>在底部添加：</p>
<p>/ etc / shells 中</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line">/bin/ftponly</span><br></pre></td></tr></table></figure>

<p>使用以下命令更新用户的 shell：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo usermod sammy -s /bin/ftponly</span><br></pre></td></tr></table></figure>

<p>现在尝试以<code>sammy</code>身份登录您的服务器：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh sammy@your_server_ip</span><br></pre></td></tr></table></figure>

<p>你应该看到类似的东西：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">OutputThis account is limited to FTP access only.</span><br><span class="line">Connection to 203.0.113.0 closed.</span><br></pre></td></tr></table></figure>

<p>这确认用户不能再<code>ssh</code>到服务器并且仅限于 FTP 访问。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>在本教程中，我们介绍了为具有本地帐户的用户设置 FTP。 如果您需要使用外部身份验证源，您可能需要了解<code>vsftpd</code>对虚拟用户的支持。 这通过使用 PAM（可插入身份验证模块）提供了丰富的选项，如果您管理其他系统（如 LDAP 或 Kerberos）中的用户，这是一个不错的选择。</p>
<h3 id="执行完上面操作后的问题解决"><a href="#执行完上面操作后的问题解决" class="headerlink" title="执行完上面操作后的问题解决"></a>执行完上面操作后的问题解决</h3><h4 id="使用-FileZilla-FTP-下载时提示“不安全的服务器，不支持-FTPover-TLS”-和“服务器不支持非-ASCII-字符”"><a href="#使用-FileZilla-FTP-下载时提示“不安全的服务器，不支持-FTPover-TLS”-和“服务器不支持非-ASCII-字符”" class="headerlink" title="使用 FileZilla FTP 下载时提示“不安全的服务器，不支持 FTPover TLS”,和“服务器不支持非 ASCII 字符”"></a>使用 FileZilla FTP 下载时提示“不安全的服务器，不支持 FTPover TLS”,和“服务器不支持非 ASCII 字符”</h4><p>1、提示“不安全的服务器，不支持 FTPover TLS</p>
<p>解决方法：在站点管理器中，加密方式选择：</p>


<p>2、提示“服务器不支持非 ASCII 字符”</p>
<p>解决方法：在站点管理器中字符集选择：自定义字符集：GBK</p>
<img src="/posts/40394/wKiom1b6SWvwBjm7AAA9pZvVBTE386.png" class="" title="wKiom1b6SWvwBjm7AAA9pZvVBTE386">

<p>OK,正常了</p>
<h4 id="ftp-连接错误——服务器发回了不可路由的地址。使用服务器地址代替。"><a href="#ftp-连接错误——服务器发回了不可路由的地址。使用服务器地址代替。" class="headerlink" title="ftp 连接错误——服务器发回了不可路由的地址。使用服务器地址代替。"></a>ftp 连接错误——服务器发回了不可路由的地址。使用服务器地址代替。</h4><p>设置 filezilla 客户端的连接参数</p>
<ol>
<li>选中某一连接项</li>
<li>高级——加密——只使用普通 ftp</li>
<li>传输设置——传输模式——主动</li>
<li>重新连接</li>
</ol>
<h2 id="ubuntu-下-Apache-虚拟站点配置"><a href="#ubuntu-下-Apache-虚拟站点配置" class="headerlink" title="ubuntu 下 Apache 虚拟站点配置"></a>ubuntu 下 Apache 虚拟站点配置</h2><p><a href="https://www.linuxidc.com/Linux/2017-05/143590.htm">https://www.linuxidc.com/Linux/2017-05/143590.htm</a></p>
<h2 id="apache-配置二级域名"><a href="#apache-配置二级域名" class="headerlink" title="apache 配置二级域名"></a>apache 配置二级域名</h2><p>[apache2 服务器 mod_rewrite 模块 开启方法<a href="https://www.cnblogs.com/wwufengg/articles/apache2-mod_rewrite.html">linux, ubuntu]</a></p>
<p>开启重写，p.s. 上面教程中说要把 <code>/etc/apache2/sites-enabled/000-default</code> 中的 <code>AllowOverride None 修改为： AllowOverride All</code> ，然而我的 Apache2 是新版（2.4），所以得转到 <code>/etc/apache2/</code> 。将名为 <code>apache2.conf</code> 的文件中的 <a href="http://www.kbase101.com/question/9571.html">下面代码从 NONE 改为 ALL</a> ：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Directory</span> /<span class="attr">var</span>/<span class="attr">www</span>/&gt;</span></span><br><span class="line">    Options Indexes FollowSymLinks</span><br><span class="line">    AllowOverride All</span><br><span class="line">    Require all granted</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>目标二级域名：mall.evelance.cn</p>
<p>阿里云控制台配置：在阿里云的控制台中找到域名管理，然后选择顶级域名 evelance.cn 后面的“解析”字样。在新打开的页面中我们可以看到一个提供域名解析的界面，选择解析类型为 A 类解析，然后输入 mall（我们想要的二级域名的头），然后在地址里面输入我们刚才查看到的 ECS 的公网 ip，然后点击确认，之后我们的解析就会生效了。</p>
<p>ubuntu 服务器配置：</p>
<p>进入 /etc/apache2/site-available/ ，复制默认的虚拟主机配置文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo cp 000-default.conf mall.evelance.cn.conf</span><br></pre></td></tr></table></figure>

<p>修改配置：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">VirtualHost</span> *<span class="attr">:80</span>&gt;</span></span><br><span class="line">    ServerAdmin xxx@qq.com</span><br><span class="line">    ServerName mall.evelance.com</span><br><span class="line">    DocumentRoot /home/www/mall</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Directory</span> &quot;/<span class="attr">home</span>/<span class="attr">www</span>/<span class="attr">mall</span>&quot;&gt;</span></span><br><span class="line">        Options FollowSymLinks</span><br><span class="line">        AllowOverride All</span><br><span class="line">        #Require all denied</span><br><span class="line">        Require all granted</span><br><span class="line">    <span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span><br><span class="line">    CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">VirtualHost</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 sites-enabled 目录下建立符号链接：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /etc/apache2/sites-enabled</span><br><span class="line"><span class="meta">#</span><span class="bash">建立对应的软链接</span></span><br><span class="line">sudo ln -s /etc/apache2/sites-available/mall.evelance.cn.conf /etc/apache2/sites-enabled/mall.evelance.cn.conf</span><br></pre></td></tr></table></figure>

<p>在对应目录放入项目代码：</p>
<p>把项目文件放进 /home/www/mall 中，并赋予文件夹权限：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo chmod -R 777 /home/www/mall</span><br></pre></td></tr></table></figure>

<p>激活配置，重启 apache：</p>
<p>返回上级目录 <code>cd ../site-enable/</code>，输入 <code>cd sites-available/</code></p>
<p>输入 <code>a2ensite mall.evelance.cn.conf</code> ，如果提示已经激活过了，输入下面代码：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a2dissite mall.evelance.cn.conf</span><br><span class="line">service apache2 reload</span><br><span class="line">a2ensite mall.evelance.cn.conf</span><br><span class="line">service apache2 reload</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<ul>
<li><a href="https://blog.csdn.net/carolcoral/article/details/77857264">ECS 简单配置多个二级域名</a></li>
</ul>
<h3 id="域名解析-1"><a href="#域名解析-1" class="headerlink" title="域名解析"></a>域名解析</h3><p>登录阿里云，进入控制台，选择云解析 DNS。选择右侧的解析管理，进行二级域名的添加：</p>
<ul>
<li>记录类型：A</li>
<li>主机记录：[mall].evelance.cn</li>
<li>解析线路：默认</li>
<li>记录值：你的公共 IP</li>
<li>TTL：10 分钟</li>
</ul>
<p>参考：<a href="https://blog.csdn.net/wangjia55/article/details/81127647">阿里云添加二级域名的操作</a></p>
<h3 id="支持-https"><a href="#支持-https" class="headerlink" title="支持 https"></a>支持 https</h3><ol>
<li><a href="https://www.cnblogs.com/lxf1117/p/6650647.html">在阿里云里申请免费 Https 证书 SSL</a></li>
<li><a href="https://yq.aliyun.com/articles/697838">ubuntu apache2 配置安装 ssl 证书</a></li>
<li><a href="https://www.cnblogs.com/wpl-php/p/10287125.html">阿里云 Ubuntu16.04 apache2 ssl 证书下载与安装（必须有域名）</a></li>
<li>完成上述配置后，别忘了让防火墙允许 443 端口。<code>sudo ufw allow 443/tcp</code></li>
</ol>
]]></content>
      <categories>
        <category>后端</category>
        <category>服务器</category>
      </categories>
      <tags>
        <tag>笔记</tag>
        <tag>阿里云</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue面试题（面试系列）</title>
    <url>/posts/53756/</url>
    <content><![CDATA[<h2 id="watch-和-computed-区别"><a href="#watch-和-computed-区别" class="headerlink" title="watch 和 computed 区别"></a>watch 和 computed 区别</h2><ul>
<li>watch 是监听动作，computed 是计算属性</li>
<li>computed 有缓存，只在属性变化的时候才去计算。watch 没缓存，只要数据变化就执行</li>
</ul>
<a id="more"></a>

<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><h3 id="讲一下-Vue-的生命周期？"><a href="#讲一下-Vue-的生命周期？" class="headerlink" title="讲一下 Vue 的生命周期？"></a>讲一下 Vue 的生命周期？</h3><p>创建期间的生命周期函数：</p>
<ul>
<li>beforeCreate：实例刚在内存中被创建出来，此时，还没有初始化好 data 和 methods 属性</li>
<li>created：实例已经在内存中创建 OK，此时 data 和 methods 已经创建 OK，此时还没有开始 编译模板</li>
<li>beforeMount：此时已经完成了模板的编译，但是还没有挂载到页面中。<ul>
<li>换句话说，此时页面中的类似 这样的语法还没有被替换成真正的数据。</li>
</ul>
</li>
<li>mounted：此时，已经将编译好的模板，挂载到了页面指定的容器中显示【可以获取 DOM 节点 | 发起异步请求】<ul>
<li>用户已经可以看到渲染好的页面了</li>
</ul>
</li>
</ul>
<p>运行期间的生命周期函数：</p>
<ul>
<li>beforeUpdate：状态更新之前执行此函数， 此时 data 中的状态值是最新的，但是界面上显示的 数据还是旧的，因为此时还没有开始重新渲染 DOM 节点</li>
<li>updated：实例更新完毕之后调用此函数，此时 data 中的状态值 和 界面上显示的数据，都已经完成了更新，界面已经被重新渲染好了！</li>
</ul>
<p>销毁期间的生命周期函数：</p>
<ul>
<li>beforeDestroy：实例销毁之前调用。在这一步，实例仍然完全可用。</li>
<li>destroyed：Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。</li>
</ul>
<h3 id="Vue-的父组件和子组件生命周期钩子执行顺序是什么"><a href="#Vue-的父组件和子组件生命周期钩子执行顺序是什么" class="headerlink" title="Vue 的父组件和子组件生命周期钩子执行顺序是什么"></a>Vue 的父组件和子组件生命周期钩子执行顺序是什么</h3><ol>
<li>加载渲染过程<br><code>父beforeCreate-&gt;父created-&gt;父beforeMount-&gt;子beforeCreate-&gt;子created-&gt;子beforeMount-&gt;子mounted-&gt;父mounted</code></li>
<li>子组件更新过程<br><code>父beforeUpdate-&gt;子beforeUpdate-&gt;子updated-&gt;父updated</code></li>
<li>父组件更新过程<br><code>父beforeUpdate-&gt;父updated</code></li>
<li>销毁过程<br><code>父beforeDestroy-&gt;子beforeDestroy-&gt;子destroyed-&gt;父destroyed</code></li>
</ol>
<p>总结：从外到内，再从内到外</p>
<h3 id="Vue-中父组件如何监听子组件的生命周期？"><a href="#Vue-中父组件如何监听子组件的生命周期？" class="headerlink" title="Vue 中父组件如何监听子组件的生命周期？"></a>Vue 中父组件如何监听子组件的生命周期？</h3><h4 id="v-on-emit"><a href="#v-on-emit" class="headerlink" title="v-on / $emit"></a>v-on / $emit</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child-comp</span> @<span class="attr">child-event</span>=<span class="string">&quot;handleChildEvent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child-comp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.component(<span class="string">&#x27;child-comp&#x27;</span>, &#123;</span><br><span class="line">  template: <span class="string">&#x27;&lt;div&gt;&lt;/div&gt;&#x27;</span>,</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      childMsg: <span class="string">&#x27;Hello, I am Child&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;&#125;,</span><br><span class="line">  <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$emit(<span class="string">&#x27;child-event&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      parentData: <span class="string">&#x27;parent Message&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeCreate: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;before created&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">handleChildEvent</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;child mounted&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在子组件中的 <code>mounted</code> 钩子函数中调用 <code>this.$emit(&quot;child-event&quot;);</code> 向父组件发送 <code>child-event</code> 消息。 父组件 <code>@child-event=&quot;handleChildEvent&quot;</code> 监听了此消息。</p>
<h4 id="hook"><a href="#hook" class="headerlink" title="@hook"></a>@hook</h4><p>假如我们这里的子组件是外部的，是不可更改的。那我们父组件监听这个外部子组件中的生命周期钩子函数怎么办呢?</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child-comp</span> @<span class="attr">hook:mounted</span>=<span class="string">&quot;handleChildEvent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child-comp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.component(<span class="string">&#x27;child-comp&#x27;</span>, &#123;</span><br><span class="line">  template: <span class="string">&#x27;&lt;div&gt;&lt;/div&gt;&#x27;</span>,</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      childMsg: <span class="string">&#x27;Hello, I am Child&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;&#125;,</span><br><span class="line">  <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//this.$emit(&quot;child-event&quot;);</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      parentData: <span class="string">&#x27;parent Message&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeCreate: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;before created&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">handleChildEvent</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;child mounted&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>把子组件中的 <code>mounted</code> 钩子函数中的 <code>$emit</code> 方法去掉， 在父组件中使用 <code>@hook:mounted</code></p>
<h3 id="更多阅读"><a href="#更多阅读" class="headerlink" title="更多阅读"></a>更多阅读</h3><ul>
<li><a href="https://segmentfault.com/a/1190000014640577">包你理解—vue 的生命周期</a></li>
</ul>
<h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><h3 id="现在有个父子组件，我希望在父级中给子组件绑定一个原生-click-事件，这个事件会被触发吗？"><a href="#现在有个父子组件，我希望在父级中给子组件绑定一个原生-click-事件，这个事件会被触发吗？" class="headerlink" title="现在有个父子组件，我希望在父级中给子组件绑定一个原生 click 事件，这个事件会被触发吗？"></a>现在有个父子组件，我希望在父级中给子组件绑定一个原生 click 事件，这个事件会被触发吗？</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-button</span> @<span class="attr">click</span>=<span class="string">&quot;change&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">change</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line">        alert(1);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>答：不能，绑定的该 click 事件会被当做组件上的一个普通属性看待，如果想要使 click 事件生效，可以使用 [<code>@click.native](mailto:</code>@click.native)=’change’` 的方式来实现。</p>
<h3 id="组件间如何通讯？"><a href="#组件间如何通讯？" class="headerlink" title="组件间如何通讯？"></a>组件间如何通讯？</h3><ul>
<li><code>props/$emit+v-on</code>: 通过 props 将数据自上而下传递，而通过$emit 和 v-on 来向上传递信息。</li>
<li>EventBus: 通过 EventBus 进行信息的发布与订阅</li>
<li>Vuex: 是全局数据管理库，可以通过 Vuex 管理全局的数据流</li>
<li><code>$attrs/$listeners</code>: Vue2.4 中加入的<code>$attrs/$listeners</code>可以进行跨级的组件通信</li>
<li><code>provide/inject</code>：以允许一个祖先组件向其所有子孙后代注入一个依赖，不论组件层次有多深，并在起上下游关系成立的时间里始终生效，这成为了跨组件通信的基础</li>
</ul>
<p><a href="https://mp.weixin.qq.com/s/XZ3BmZLY4OwwGm2Hbbepbg">Vue 组件间通信六种方式</a></p>
<h3 id="this-emit-的返回值是什么？如果需要返回值该怎么办？"><a href="#this-emit-的返回值是什么？如果需要返回值该怎么办？" class="headerlink" title="this.$emit 的返回值是什么？如果需要返回值该怎么办？"></a>this.$emit 的返回值是什么？如果需要返回值该怎么办？</h3><p>this.$emit 的返回值就是 this ，即当前子组件 VueComponent 。</p>
<p>如果想要有返回值可以如下操作：</p>
<blockquote>
<p>子组件</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">:value</span>=<span class="string">&quot;name&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;handleChange&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    props: [<span class="string">&#x27;name&#x27;</span>],</span></span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">handleChange</span>(<span class="params">e</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> res = <span class="built_in">this</span>.$emit(<span class="string">&#x27;Echange&#x27;</span>, e.target.value, <span class="function"><span class="params">val</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(val);</span></span><br><span class="line">        &#125;);</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(res, res === <span class="built_in">this</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>父组件</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Child</span> <span class="attr">:name</span>=<span class="string">&quot;name&quot;</span> @<span class="attr">Echange</span>=<span class="string">&quot;handleEventChange&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">handleEventChange</span>(<span class="params">val, callback</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.name = val</span></span><br><span class="line"><span class="javascript">        callback(<span class="string">&quot;hello&quot;</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="filter-过滤器"><a href="#filter-过滤器" class="headerlink" title="filter 过滤器"></a>filter 过滤器</h2><h3 id="filter-中的-this-是什么？"><a href="#filter-中的-this-是什么？" class="headerlink" title="filter 中的 this 是什么？"></a>filter 中的 this 是什么？</h3><p>this 是 undefined，在 filter 中拿不到 vue 实例。filter 应该是个纯函数，不应该依赖外界或者对外界有所影响。如果需要用到 this，可以用 computed 或者 method 代替。</p>
<h2 id="vue-指令"><a href="#vue-指令" class="headerlink" title="vue 指令"></a>vue 指令</h2><h3 id="能讲下-v-if-和-v-show-的区别吗？"><a href="#能讲下-v-if-和-v-show-的区别吗？" class="headerlink" title="能讲下 v-if 和 v-show 的区别吗？"></a>能讲下 v-if 和 v-show 的区别吗？</h3><ul>
<li>v-if: 是否加载这个元素（一次性的）</li>
<li>v-show：控制显示方式 block or none（需要切换的，侧边栏）</li>
</ul>
<p>因此：如果需要频繁切换 v-show 较好，如果在运行时条件不大可能改变 v-if 较好</p>
<h3 id="v-for-你使用过程中，有遇到什么问题或者关注点吗？"><a href="#v-for-你使用过程中，有遇到什么问题或者关注点吗？" class="headerlink" title="v-for 你使用过程中，有遇到什么问题或者关注点吗？"></a><code>v-for</code> 你使用过程中，有遇到什么问题或者关注点吗？</h3><ol>
<li>避免将 <code>v-if</code> 和 <code>v-for</code> 放在同一个元素上，因为 <code>v-for</code> 优先级比 <code>v-if</code> 更高。例如要渲染 todo 列表中未完成的任务，给 li 标签同时写上 v-for 和 v-if 后会导致每次重新渲染都得遍历整个列表。优化方案是把需要遍历的 todoList 更换为在计算属性上遍历过滤。（Vue 文档有详细说明，具体见下方「阅读更多」）</li>
<li>给 <code>v-for</code> 设置键绑定键值 <code>key</code>。理由见下。</li>
</ol>
<h3 id="在列表组件中添加-key-属性的作用？"><a href="#在列表组件中添加-key-属性的作用？" class="headerlink" title="在列表组件中添加 key 属性的作用？"></a>在列表组件中添加 key 属性的作用？</h3><p>key 的主要作用就是在更新组件时判断两个节点是否相同。相同就复用，不相同就删除旧的创建新的。这样可以更高效的更新虚拟 DOM。</p>
<p>另外如果给列表组件设置了过渡效果，不添加 key 属性会导致过渡效果无法触发。因为不添加 key 会导致 vue 无法区分它们，导致只会替换节点内部属性而不会触发过渡效果。</p>
<h3 id="为什么不建议用-index-作为-key-呢？"><a href="#为什么不建议用-index-作为-key-呢？" class="headerlink" title="为什么不建议用 index 作为 key 呢？"></a>为什么不建议用 index 作为 key 呢？</h3><p><strong>更新 DOM 时会出现性能问题</strong></p>
<p>例如我们在使用 index 作为 key 值时想要下面列表进行倒序排列：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;0&quot;</span>&gt;</span>React<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span>&gt;</span>Vue<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span>&gt;</span>Angular<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 倒序后↓↓↓↓↓↓↓↓↓↓ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;0&quot;</span>&gt;</span>Angular<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span>&gt;</span>Vue<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span>&gt;</span>React<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>vue 这个时候仅会调换第一和第三项的文本，li 元素则不会调换顺序，因为 vue 发现 key 值也就是 index 没变化。而这会导致 li 里面的文本重新渲染，影响性能。</p>
<p>而如果采用 id 作为 key，则仅仅需要移动下 DOM 就 OK 了，并不需要重新渲染 DOM：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;react&quot;</span>&gt;</span>React<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;vue&quot;</span>&gt;</span>Vue<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;angular&quot;</span>&gt;</span>Angular<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 倒序后↓↓↓↓↓↓↓↓↓↓ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;angular&quot;</span>&gt;</span>Angular<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;vue&quot;</span>&gt;</span>Vue<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;react&quot;</span>&gt;</span>React<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>会发生一些状态 bug</strong></p>
<p>还是以上面例子为例，给每个 li 元素中加一个 checkbox：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;react&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> /&gt;</span></span><br><span class="line">  React</span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;vue&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> /&gt;</span></span><br><span class="line">  Vue</span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;angular&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> /&gt;</span></span><br><span class="line">  Angular</span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果采用 index 作为 key，选中状态会出现 bug（左边列表采用 index，右边采用 id 形式）：</p>
<img src="/posts/53756/checkbox.gif" class="" title="index-vs-id">

<p>原因也是 index 没有变化被复用了，导致选中状态永远都是 index=0 的第一项。</p>
<p>阅读更多：</p>
<ul>
<li><a href="https://cn.vuejs.org/v2/style-guide/#%E9%81%BF%E5%85%8D-v-if-%E5%92%8C-v-for-%E7%94%A8%E5%9C%A8%E4%B8%80%E8%B5%B7-%E5%BF%85%E8%A6%81">避免 v-if 和 v-for 用在一起</a></li>
<li><a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/1">写 React / Vue 项目时为什么要在列表组件中写 key，其作用是什么？</a></li>
<li><a href="https://www.zhihu.com/question/61064119/answer/183717717">Vue2.0 v-for 中 :key 到底有什么用？</a></li>
<li><a href="https://juejin.im/post/5d3c7f25e51d45599e019ea6">Vue：为什么使用 v-for 时必须添加唯一的 key？为什么不宜用 index 作为 key？</a></li>
</ul>
<h2 id="数据响应式（双向绑定）怎么做到的？"><a href="#数据响应式（双向绑定）怎么做到的？" class="headerlink" title="数据响应式（双向绑定）怎么做到的？"></a>数据响应式（双向绑定）怎么做到的？</h2><p>原理：Vue 采用 <strong>数据劫持</strong> 结合 <strong>发布者-订阅者</strong> 模式的方式，通过 <code>Object.defineProperty()</code> 来劫持各个属性的 setter 以及 getter，在数据变动时发布消息给订阅者，触发相应的监听回调。</p>
<ol>
<li>第一步：需要 Observe 的数据对象进行递归遍历，包括子属性对象的属性，都加上 setter 和 getter。这样的话，给这个对象的某个值赋值，就会触发 setter，那么就能监听到了数据变化。</li>
<li>第二步：Compile 解析模板指令，将模板中的变量替换成数据，然后初始化渲染页面视图，并将每个指令对应的节点绑定更新函数，添加监听数据的订阅者，一旦数据有变动，收到通知，更新数据。</li>
<li>第三步：Watcher 订阅者是 Observer 和 Compile 之间通信的桥梁，主要做的事情有：<ol>
<li>在自身实例化时往属性订阅器（dep）里面添加自己。</li>
<li>自身必须有一个 update() 方法</li>
<li>待属性变动 <code>dep.notice()</code> 通知时，能调用自身的 <code>update()</code> 方法，并触发 Compile 中绑定的回调，则功成身退。</li>
</ol>
</li>
<li>第四步：MVVM 作为数据绑定的入口，整合 Observer、Compile 和 Watcher 三者，通过 Observer 来监听自己的 model 数据变化，通过 Compile 来解析编译模板指令，最终利用 Watcher 搭起 Observer 和 Compile 之间的桥梁，达到数据变化 -&gt; 视图更新；视图交互变化（input） -&gt; 数据 model 变更的双向绑定效果。</li>
</ol>
<p>参考：</p>
<p><a href="https://www.cnblogs.com/kidney/p/6052935.html">Vue.js 双向绑定的实现原理</a></p>
<p><a href="https://www.bilibili.com/video/av16175295">vue 双向数据绑定简单实现(一)</a></p>
<h3 id="追问-1：那如果我要监听一个对象属性的删除或添加呢？"><a href="#追问-1：那如果我要监听一个对象属性的删除或添加呢？" class="headerlink" title="追问 1：那如果我要监听一个对象属性的删除或添加呢？"></a>追问 1：那如果我要监听一个对象属性的删除或添加呢？</h3><p>受 defineProperty 限制，Vue 无法检测对象属性的删除和添加。所以我们可以利用 Vue 提供的 <code>Vue.set</code> 来解决此问题。</p>
<p>例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">有一个obj:&#123;<span class="attr">a</span>:<span class="number">1</span>&#125;，想要<span class="built_in">this</span>.obj.b=<span class="number">233</span>，不会触发视图更新</span><br><span class="line"></span><br><span class="line">Vue.set(<span class="built_in">this</span>.obj, <span class="string">&#x27;b&#x27;</span>, <span class="number">233</span>) or <span class="built_in">this</span>.$set(<span class="built_in">this</span>.obj, <span class="string">&#x27;b&#x27;</span>, <span class="number">233</span>)</span><br></pre></td></tr></table></figure>

<h3 id="追问-2：为什么对象属性的删除或添加无法触发页面更新"><a href="#追问-2：为什么对象属性的删除或添加无法触发页面更新" class="headerlink" title="追问 2：为什么对象属性的删除或添加无法触发页面更新"></a>追问 2：为什么对象属性的删除或添加无法触发页面更新</h3><p>因为 vue 在实例化过程中，深度遍历了 data 下所有属性, 把属性全转为 getter/setter 。这样才能监听属性变化。所以属性必须在 data 对象上存在才能让 Vue 转换它，这样才能让它是响应的。</p>
<p>当你在对象上新加了一个属性 newProperty ，当前新加的这个属性并没有加入 vue 检测数据更新的机制（因为是在初始化之后添加的）, vue.$set 是能让 vue 知道你添加了属性, 它会给你做处理。</p>
<h3 id="js-实现简单的双向绑定"><a href="#js-实现简单的双向绑定" class="headerlink" title="js 实现简单的双向绑定"></a>js 实现简单的双向绑定</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;txt&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;show&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> obj = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.obj = obj;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">Object</span>.defineProperty(obj, <span class="string">&#x27;txt&#x27;</span>, &#123;</span></span><br><span class="line"><span class="javascript">        get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> obj;</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        set: <span class="function"><span class="keyword">function</span> (<span class="params">newValue</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">document</span>.getElementById(<span class="string">&#x27;txt&#x27;</span>).value = newValue;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">document</span>.getElementById(<span class="string">&#x27;show&#x27;</span>).innerHTML = newValue;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.addEventListener(<span class="string">&#x27;keyup&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line">        obj.txt = e.target.value;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Vue-的响应式原理中-Object-defineProperty-有什么缺陷？为什么在-Vue3-0-采用了-Proxy，抛弃了-Object-defineProperty？"><a href="#Vue-的响应式原理中-Object-defineProperty-有什么缺陷？为什么在-Vue3-0-采用了-Proxy，抛弃了-Object-defineProperty？" class="headerlink" title="Vue 的响应式原理中 Object.defineProperty 有什么缺陷？为什么在 Vue3.0 采用了 Proxy，抛弃了 Object.defineProperty？"></a>Vue 的响应式原理中 Object.defineProperty 有什么缺陷？为什么在 Vue3.0 采用了 Proxy，抛弃了 Object.defineProperty？</h3><ol>
<li>Vue 中使用 Object.defineProperty 进行双向数据绑定时，告知使用者是可以监听数组的，但是只是监听了数组的 push()、pop()、shift()、unshift()、splice()、sort()、reverse() 这八种方法，其他数组的属性检测不到。</li>
<li>Object.defineProperty 无法监控到数组<strong>下标</strong>的变化，导致通过数组下标添加元素，不能实时响应；</li>
<li>Object.defineProperty 只能劫持对象的属性，因此对每个对象的属性进行遍历时，如果属性值也是对象需要深度遍历，那么就比较麻烦了，所以在比较 Proxy 能完整劫持对象的对比下，选择 Proxy。</li>
<li>Proxy 不仅可以代理对象，还可以代理数组。还可以代理动态增加的属性。</li>
</ol>
<p>答案参考：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/90">Daily-Interview-Question - 第 51 题</a><br>更多阅读：<a href="https://www.jianshu.com/p/2df6dcddb0d7">实现双向绑定 Proxy 比 defineproperty 优劣如何</a></p>
<h2 id="Vue-模板渲染的原理是什么？"><a href="#Vue-模板渲染的原理是什么？" class="headerlink" title="Vue 模板渲染的原理是什么？"></a>Vue 模板渲染的原理是什么？</h2><p>vue 中的模板 template 无法被浏览器解析并渲染，因为这不属于浏览器的标准，不是正确的 HTML 语法，所有需要将 template 转化成一个 JavaScript 函数，这样浏览器就可以执行这一个函数并渲染出对应的 HTML 元素，就可以让视图跑起来了，这一个转化的过程，就成为模板编译。</p>
<p>模板编译又分三个阶段，解析 parse，优化 optimize，生成 generate，最终生成可执行函数 render。</p>
<ul>
<li>parse 阶段：使用大量的正则表达式对 template 字符串进行解析，将标签、指令、属性等转化为抽象语法树 AST。</li>
<li>optimize 阶段：遍历 AST，找到其中的一些静态节点并进行标记，方便在页面重渲染的时候进行 diff 比较时，直接跳过这一些静态节点，优化 runtime 的性能。</li>
<li>generate 阶段：将最终的 AST 转化为 render 函数字符串。</li>
</ul>
<p>来源：<a href="https://juejin.im/post/6870374238760894472">https://juejin.im/post/6870374238760894472</a></p>
<h2 id="Vuex-用过吗？"><a href="#Vuex-用过吗？" class="headerlink" title="Vuex 用过吗？"></a>Vuex 用过吗？</h2><p>Vuex 是专为 Vue 应用程序开发的状态管理工具，相当于共享仓库，方便任何组件直接获取和修改。</p>
<ul>
<li>state - 数据【存项目共享状态，是响应式的，store 的数据改变，所有依赖此状态的组件会更新】<ul>
<li>$store.state.count</li>
</ul>
</li>
<li>mutations - 方法【同步函数】<ul>
<li>inc(state, 参数唯一) {}</li>
<li>$store.commit(‘inc’, 2)</li>
</ul>
</li>
<li>getters - 包装数据 【store 的计算属性，可缓存】<ul>
<li>show: function(state) {}</li>
<li>this.$store.getters.show</li>
<li>传参，返回函数：show(state) {return function(参数) {return …}}【不会缓存数据】</li>
</ul>
</li>
<li>actions -【异步操作】【提交的是 mutations，不直接修改状态】<ul>
<li>increment(context, num) {context.commit()}</li>
<li>this.$store.dispatch(‘’,arg)</li>
</ul>
</li>
</ul>
<h3 id="使用-Vuex-管理数据，与直接在全局-window-下定义变量相比，有什么区别或者说优势？"><a href="#使用-Vuex-管理数据，与直接在全局-window-下定义变量相比，有什么区别或者说优势？" class="headerlink" title="使用 Vuex 管理数据，与直接在全局 window 下定义变量相比，有什么区别或者说优势？"></a>使用 Vuex 管理数据，与直接在全局 window 下定义变量相比，有什么区别或者说优势？</h3><p>全局作用域下定义的数据是静态的，只能通过手动修改，修改后数据变了，但使用这些数据的组件并不会重新渲染，也必须得手动渲染。而且全局作用域下定义太多变量还容易造成变量污染。</p>
<p>Vuex 只要 store 中的数据更新，就会立即渲染所有使用 store 数据的组件。Vuex 使用单向数据流，要想修改 store 数据需要经过 action 层，mutation 层，层次划分明确，便于管理。</p>
<h3 id="Vuex-是通过什么方式提供响应式数据的？"><a href="#Vuex-是通过什么方式提供响应式数据的？" class="headerlink" title="Vuex 是通过什么方式提供响应式数据的？"></a>Vuex 是通过什么方式提供响应式数据的？</h3><p>在 Store 构造函数中通过 new Vue({}}) 实现的。利用 Vue 来监听 state 下的数据变化，给状态添加 getter、setter。</p>
<h3 id="Vuex-如何区分-state-是外部直接修改，还是通过-mutation-方法修改的？"><a href="#Vuex-如何区分-state-是外部直接修改，还是通过-mutation-方法修改的？" class="headerlink" title="Vuex 如何区分 state 是外部直接修改，还是通过 mutation 方法修改的？"></a>Vuex 如何区分 state 是外部直接修改，还是通过 mutation 方法修改的？</h3><p>Vuex 中修改 state 的唯一渠道就是执行 commit(‘xx’, payload) 方法，其底层通过执行 this._withCommit(fn) 设置_committing 标志变量为 true，然后才能修改 state，修改完毕还需要还原_committing 变量。外部修改虽然能够直接修改 state，但是并没有修改_committing 标志位，所以只要 watch 一下 state，state change 时判断是否_committing 值为 true，即可判断修改的合法性。</p>
<h3 id="Vuex-原理"><a href="#Vuex-原理" class="headerlink" title="Vuex 原理"></a>Vuex 原理</h3><p>vuex 仅仅是作为 vue 的一个插件而存在，不像 Redux,MobX 等库可以应用于所有框架，vuex 只能使用在 vue 上，很大的程度是因为其高度依赖于 vue 的 computed 依赖检测系统以及其插件系统，</p>
<p>vuex 整体思想诞生于 flux,可其的实现方式完完全全的使用了 vue 自身的响应式设计，依赖监听、依赖收集都属于 vue 对对象 Property set get 方法的代理劫持。最后一句话结束 vuex 工作原理，vuex 中的 store 本质就是没有 template 的隐藏着的 vue 组件。</p>
<h2 id="VueRouter-是什么？你平常是怎么用的？"><a href="#VueRouter-是什么？你平常是怎么用的？" class="headerlink" title="VueRouter 是什么？你平常是怎么用的？"></a>VueRouter 是什么？你平常是怎么用的？</h2><ul>
<li><p>是什么：Vue-Router 是 Vue 官方的路由管理器</p>
</li>
<li><p>作用：为了页面跳转</p>
</li>
<li><p>原理：监听锚点值改变，渲染指定页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;h&quot;</span>&gt;</span>我是头部<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span> <span class="attr">class</span>=<span class="string">&quot;b&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;f&quot;</span>&gt;</span>我是底部<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">//监视锚点值的改变</span></span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;hashchange&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> text = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">switch</span> (location.hash) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">case</span> <span class="string">&#x27;#/music&#x27;</span>:</span></span><br><span class="line"><span class="javascript">        text = <span class="string">&#x27;各种音乐的数据&#x27;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">case</span> <span class="string">&#x27;#/movie&#x27;</span>:</span></span><br><span class="line"><span class="javascript">        text = <span class="string">&#x27;各种电影的数据&#x27;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">break</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">&#x27;content&#x27;</span>).innerHTML = text;</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><p>查询字符串：</p>
<ol>
<li>去哪（列表页传参） xxx</li>
<li>导航（router 中） { name:’detail’ , path:’/detail’, component: Detail }</li>
<li>去了干嘛（详情页接收参数）this.$route.query.id</li>
</ol>
<p>path 方式：</p>
<ol>
<li>去哪里 xxx</li>
<li>导航 { name:’detail’ , path:’/detail/:name’, component: Detail}</li>
<li>去了干嘛（获取路由参数）this.$route.params.name</li>
</ol>
<h3 id="编程式导航"><a href="#编程式导航" class="headerlink" title="编程式导航"></a>编程式导航</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// name配params：</span></span><br><span class="line"><span class="built_in">this</span>.$router.push(&#123; <span class="attr">name</span>: <span class="string">&#x27;Goods&#x27;</span>, <span class="attr">params</span>: &#123; <span class="attr">goodsId</span>: id &#125; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// path配query：</span></span><br><span class="line"><span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/goods&#x27;</span>, <span class="attr">query</span>: &#123; <span class="attr">goodsId</span>: id &#125; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数接收匹配：</span></span><br><span class="line"><span class="built_in">this</span>.goodsId = <span class="built_in">this</span>.$route.query.goodsId;</span><br><span class="line"><span class="built_in">this</span>.goodsId = <span class="built_in">this</span>.$route.params.goodsId;</span><br></pre></td></tr></table></figure>

<h3 id="路由守卫"><a href="#路由守卫" class="headerlink" title="路由守卫"></a>路由守卫</h3><ul>
<li>全局守卫：beforeEach, beforeResolve, afterEach【没有 next】</li>
<li>路由独享守卫：beforeEnter</li>
<li>组件内守卫：beforeRouteEnter【唯一 next 有回调】, Update, Leave</li>
</ul>
<h4 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h4><ul>
<li><p>全局守卫：beforeEach（用户登录以及权限判定）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isLogin = localStroage.token;</span><br><span class="line">  <span class="comment">// 个人中心需要登录</span></span><br><span class="line">  <span class="keyword">if</span> (to.name === <span class="string">&#x27;Member&#x27;</span>) &#123;</span><br><span class="line">    isLogin ? next() : next(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>组件内守卫：beforeRouteEnter（根据用户从何而来，修改当前组件标题）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 详情页组件</span></span><br><span class="line"><span class="function"><span class="title">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> title = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    title = <span class="keyword">from</span>.name === <span class="string">&#x27;news.list&#x27;</span> ? <span class="string">&#x27;新闻详情&#x27;</span> : <span class="string">&#x27;商品详情&#x27;</span></span><br><span class="line">    <span class="comment">// 一定要调用 next ，否则无法从列表页跳转到详情页</span></span><br><span class="line">    next(<span class="function"><span class="params">vm</span> =&gt;</span> vm.title = title) <span class="comment">// 通过 vm 访问组件实例</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="讲一下完整的-Vue-路由生命周期"><a href="#讲一下完整的-Vue-路由生命周期" class="headerlink" title="讲一下完整的 Vue 路由生命周期"></a>讲一下完整的 Vue 路由生命周期</h4><ol>
<li>导航被触发。</li>
<li>在失活的组件里调用离开守卫。</li>
<li>调用全局的 <code>beforeEach</code> 守卫。</li>
<li>在重用的组件里调用 <code>beforeRouteUpdate</code> 守卫 (2.2+)。</li>
<li>在路由配置里调用 <code>beforeEnter</code>。</li>
<li>解析异步路由组件。</li>
<li>在被激活的组件里调用 <code>beforeRouteEnter</code>。</li>
<li>调用全局的 <code>beforeResolve</code> 守卫 (2.5+)。</li>
<li>导航被确认。</li>
<li>调用全局的 <code>afterEach</code> 钩子。</li>
<li>触发 DOM 更新。</li>
<li>用创建好的实例调用 <code>beforeRouteEnter</code> 守卫中传给 <code>next</code> 的回调函数。</li>
</ol>
<h3 id="实现一个简单路由"><a href="#实现一个简单路由" class="headerlink" title="实现一个简单路由"></a>实现一个简单路由</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// hash路由</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Route</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 路由存储对象</span></span><br><span class="line">    <span class="built_in">this</span>.routes = &#123;&#125;;</span><br><span class="line">    <span class="comment">// 当前hash</span></span><br><span class="line">    <span class="built_in">this</span>.currentHash = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 绑定this，避免监听时this指向改变</span></span><br><span class="line">    <span class="built_in">this</span>.freshRoute = <span class="built_in">this</span>.freshRoute.bind(<span class="built_in">this</span>);</span><br><span class="line">    <span class="comment">// 监听</span></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;load&#x27;</span>, <span class="built_in">this</span>.freshRoute, <span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;hashchange&#x27;</span>, <span class="built_in">this</span>.freshRoute, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 存储</span></span><br><span class="line">  <span class="function"><span class="title">storeRoute</span>(<span class="params">path, cb</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.routes[path] = cb || <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 更新</span></span><br><span class="line">  <span class="function"><span class="title">freshRoute</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.currentHash = location.hash.slice(<span class="number">1</span>) || <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.routes[<span class="built_in">this</span>.currentHash]();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="vue-脚手架生成的-router-js-中，有一段-base-process-env-BASE-URL-配置，你知道它引用了谁的路径么？"><a href="#vue-脚手架生成的-router-js-中，有一段-base-process-env-BASE-URL-配置，你知道它引用了谁的路径么？" class="headerlink" title="vue 脚手架生成的 router.js 中，有一段 base: process.env.BASE_URL 配置，你知道它引用了谁的路径么？"></a>vue 脚手架生成的 router.js 中，有一段 <code>base: process.env.BASE_URL</code> 配置，你知道它引用了谁的路径么？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  mode: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">  base: process.env.BASE_URL, <span class="comment">// &lt;-</span></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>它会和 vue.config.js 中的 publicPath 选项相符，即你的应用会部署到的线上/开发环境的基础路径：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 旧版叫做baseURL</span></span><br><span class="line">  <span class="comment">// 线上/开发环境的路径配置</span></span><br><span class="line">  publicPath: process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;http://你的线上环境&#x27;</span> : <span class="string">&#x27;/&#x27;</span>,</span><br></pre></td></tr></table></figure>

<h2 id="你是如何使用插槽的？"><a href="#你是如何使用插槽的？" class="headerlink" title="你是如何使用插槽的？"></a>你是如何使用插槽的？</h2><ul>
<li>默认插槽：父 html 模板 | 子</li>
<li>具名插槽：父 | 子</li>
<li>作用域插槽：父 | 子提供数据</li>
</ul>
<p>阅读更多：<a href="https://segmentfault.com/a/1190000012996217">深入理解 vue 中的 slot 与 slot-scope</a></p>
<h3 id="相同名称的插槽是合并还是替换？"><a href="#相同名称的插槽是合并还是替换？" class="headerlink" title="相同名称的插槽是合并还是替换？"></a>相同名称的插槽是合并还是替换？</h3><ul>
<li>Vue 2.5 版本，匿名和具名插槽都是合并，作用域插槽是替换</li>
<li>Vue 2.6 版本，都是替换（因为新版底层原理一样）</li>
</ul>
<h2 id="nextTick-的更新原理"><a href="#nextTick-的更新原理" class="headerlink" title="nextTick 的更新原理"></a>nextTick 的更新原理</h2><p>Vue 在修改数据后，视图不会立刻更新，而是等同一事件循环中的所有数据变化完成之后，再统一进行视图更新。</p>
<p>nextTick 的回调函数会等到同步任务执行完毕，DOM 更新后才触发。</p>
<p>阅读更多：<a href="https://segmentfault.com/a/1190000012861862">Vue.nextTick 的原理和用途</a></p>
<h3 id="让你自己实现一个-nextTick-说说你的思路？（TODO）"><a href="#让你自己实现一个-nextTick-说说你的思路？（TODO）" class="headerlink" title="让你自己实现一个 nextTick,说说你的思路？（TODO）"></a>让你自己实现一个 nextTick,说说你的思路？（TODO）</h3><p>待续…</p>
<h2 id="在-Vue-中，子组件为何不可以修改父组件传递的-Prop"><a href="#在-Vue-中，子组件为何不可以修改父组件传递的-Prop" class="headerlink" title="在 Vue 中，子组件为何不可以修改父组件传递的 Prop"></a>在 Vue 中，子组件为何不可以修改父组件传递的 Prop</h2><p>为了保证数据的单向流动，便于对数据进行追踪，避免数据混乱。官网有详细的信息 <a href="https://cn.vuejs.org/v2/guide/components-props.html#%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81">prop</a></p>
<blockquote>
<p>所有的 prop 都使得其父子 prop 之间形成了一个<strong>单向下行绑定</strong>：父级 prop 的更新会向下流动到子组件中，但是反过来则不行。这样会<strong>防止从子组件意外改变父级组件的状态</strong>，从而导致你的应用的数据流向难以理解。</p>
</blockquote>
<p>设想一个场景，某个父组件下不只使用了一个子组件。而且都使用到了这份 prop 数据，那么一旦某个子组件更改了这个 prop 数据，会连带着其他子组件的 prop 数据也被更改。这会导致数据混乱，而且由于修改数据的源头不止一处，在出错后 debug 时难以定位错误原因。</p>
<p><strong>所以我们需要将修改数据的源头统一为父组件，子组件想要改 prop 只能委托父组件帮它。从而保证数据修改源唯一</strong></p>
<p>另外 props 传入的值如果对象的话，是可以直接在子组件里更改的，因为是同一个引用。</p>
<h3 id="如果修改了，Vue-是如何监控到属性的修改并给出警告的？"><a href="#如果修改了，Vue-是如何监控到属性的修改并给出警告的？" class="headerlink" title="如果修改了，Vue 是如何监控到属性的修改并给出警告的？"></a>如果修改了，Vue 是如何监控到属性的修改并给出警告的？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> hyphenatedKey = hyphenate(key);</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    isReservedAttribute(hyphenatedKey) ||</span><br><span class="line">    config.isReservedAttr(hyphenatedKey)</span><br><span class="line">  ) &#123;</span><br><span class="line">    warn(</span><br><span class="line">      <span class="string">&#x27;&quot;&#x27;</span> +</span><br><span class="line">        hyphenatedKey +</span><br><span class="line">        <span class="string">&#x27;&quot; is a reserved attribute and cannot be used as component prop.&#x27;</span>,</span><br><span class="line">      vm</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  defineReactive$$1(props, key, value, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isRoot &amp;&amp; !isUpdatingChildComponent) &#123;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">&#x27;Avoid mutating a prop directly since the value will be &#x27;</span> +</span><br><span class="line">          <span class="string">&#x27;overwritten whenever the parent component re-renders. &#x27;</span> +</span><br><span class="line">          <span class="string">&quot;Instead, use a data or computed property based on the prop&#x27;s &quot;</span> +</span><br><span class="line">          <span class="string">&#x27;value. Prop being mutated: &quot;&#x27;</span> +</span><br><span class="line">          key +</span><br><span class="line">          <span class="string">&#x27;&quot;&#x27;</span>,</span><br><span class="line">        vm</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 initProps 的时候，在 defineReactive 时通过判断是否在开发环境，如果是开发环境，会在触发 set 的时候判断是否此 key 是否处于 updatingChildren 中被修改，如果不是，说明此修改来自子组件，触发 warning 提示。</p>
<p>需要特别注意的是，当你从子组件修改的 prop 属于基础类型时会触发提示。 这种情况下，你是无法修改父组件的数据源的， 因为基础类型赋值时是值拷贝。你直接将另一个非基础类型（Object, array）赋值到此 key 时也会触发提示(但实际上不会影响父组件的数据源)， 当你修改 object 的属性时不会触发提示，并且会修改父组件数据源的数据。</p>
<h2 id="虚拟-DOM"><a href="#虚拟-DOM" class="headerlink" title="虚拟 DOM"></a>虚拟 DOM</h2><h3 id="虚拟-DOM-实现原理"><a href="#虚拟-DOM-实现原理" class="headerlink" title="虚拟 DOM 实现原理?"></a>虚拟 DOM 实现原理?</h3><ul>
<li>虚拟 DOM 本质上是 JavaScript 对象,是对真实 DOM 的抽象</li>
<li>状态变更时，记录新树和旧树的差异</li>
<li>最后把差异更新到真正的 dom 中</li>
</ul>
<p>详细实现见<a href="https://user-gold-cdn.xitu.io/2019/8/1/16c49afec13e0416">虚拟 DOM 原理?</a></p>
<h3 id="虚拟-DOM-的优劣如何"><a href="#虚拟-DOM-的优劣如何" class="headerlink" title="虚拟 DOM 的优劣如何?"></a>虚拟 DOM 的优劣如何?</h3><p>优点:</p>
<ul>
<li>保证性能下限: 虚拟 DOM 可以经过 diff 找出最小差异,然后批量进行 patch,这种操作虽然比不上手动优化,但是比起粗暴的 DOM 操作性能要好很多,因此虚拟 DOM 可以保证性能下限</li>
<li>无需手动操作 DOM: 虚拟 DOM 的 diff 和 patch 都是在一次更新中自动进行的,我们无需手动操作 DOM,极大提高开发效率</li>
<li>跨平台: 虚拟 DOM 本质上是 JavaScript 对象,而 DOM 与平台强相关,相比之下虚拟 DOM 可以进行更方便地跨平台操作,例如服务器渲染、移动端开发等等</li>
</ul>
<p>缺点:</p>
<ul>
<li>无法进行极致优化: 在一些性能要求极高的应用中虚拟 DOM 无法进行针对性的极致优化,比如 VScode 采用直接手动操作 DOM 的方式进行极端的性能优化</li>
</ul>
<h2 id="Vue-项目能进行哪些性能优化"><a href="#Vue-项目能进行哪些性能优化" class="headerlink" title="Vue 项目能进行哪些性能优化"></a>Vue 项目能进行哪些性能优化</h2><p>链接：<a href="https://juejin.im/post/6857856269488193549">https://juejin.im/post/6857856269488193549</a></p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="vue-的优点是什么？"><a href="#vue-的优点是什么？" class="headerlink" title="vue 的优点是什么？"></a>vue 的优点是什么？</h3><ul>
<li>低耦合。视图（View）可以独立于 Model 变化和修改，一个 ViewModel 可以绑定到不同的”View”上，当 View 变化的时候 Model 可以不变，当 Model 变化的时候 View 也可以不变。</li>
<li>可重用性。你可以把一些视图逻辑放在一个 ViewModel 里面，让很多 view 重用这段视图逻辑。</li>
<li>独立开发。开发人员可以专注于业务逻辑和数据的开发（ViewModel），设计人员可以专注于页面设计，使用 Expression Blend 可以很容易设计界面并生成 xml 代码。</li>
<li>可测试。界面素来是比较难于测试的，而现在测试可以针对 ViewModel 来写。</li>
</ul>
<h3 id="当执行-import-vue-from-‘vue’-时发生了什么？"><a href="#当执行-import-vue-from-‘vue’-时发生了什么？" class="headerlink" title="当执行 import vue from ‘vue’ 时发生了什么？"></a>当执行 import vue from ‘vue’ 时发生了什么？</h3><p>平时开发中，经常会用到这样一个语句：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>由于浏览器兼容性问题，通常这个语法是在 webpack 的构建流搭建的项目中执行的，那么这个语句到底做了什么呢？</p>
<p>其实在 nodejs 中，执行 <code>import</code> 就相当于执行了 <code>require</code>，而 <code>require</code> 被调用，其实会用到 <code>require.resolve</code> 这个函数来查找包的路径，而这个函数在 nodejs 中会有一个关于优先级的算法。先看一下 <code>import Vue from &#39;vue&#39;</code> 这一句做了什么：</p>
<ol>
<li><code>import Vue from &#39;vue&#39;</code> 解析为 <code>const Vue = require(&#39;vue&#39;)</code>。</li>
<li><code>require</code> 判断 vue 是否未 nodejs 核心包，如我们常用的：path，fs 等，是则直接导入，否则继续往下走。</li>
<li>vue 非 nodejs 核心包，判断 vue 是否未 ‘/‘ 根目录开头，显然不是，继续往下走。</li>
<li>vue 是否为 ‘./‘、’/‘ 或者 ‘../‘ 开头，显然不是，继续往下走。</li>
<li>以上条件都不符合，读取项目目录下 node_modules 包里的包。</li>
</ol>
<p>到了第五步，<code>import Vue from &#39;vue&#39;</code> 就找到了 vue 所在的实际位置了，那么问题来了，node_modules 下的 vue 是一个文件夹，而引入的 Vue 是一个 javascript 对象，那它是怎么取到这个对象呢？</p>
<p>其实对于一个 npm 包，内部还有一个文件输出的规则，先看下 node_modules/vue 下的文件结构是怎么样的：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">├── LICENSE</span><br><span class="line">├── README.md</span><br><span class="line">├── dist</span><br><span class="line">├── package.json</span><br><span class="line">├── src</span><br><span class="line">└── types</span><br></pre></td></tr></table></figure>

<p>是不是看起来很笼统，其实对于 npm 包，<code>require</code> 的规则是这样的：</p>
<ol>
<li>查找 package.json 下是否定义了 main 字段，是则读取 main 字段下定义的入口。</li>
<li>如果没有 package.json 文件，则读取文件夹下的 index.js 或者 index.node。</li>
<li>如果都 package.json、index.js、index.node 都找不到，抛出错误 <code>Error: Cannot find module &#39;some-library&#39;</code>。</li>
</ol>
<p>那么看一下 vue 的 package.json 文件有这么一句：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&quot;main&quot;</span>: <span class="string">&quot;dist/vue.runtime.common.js&quot;</span>,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到这里就很清晰了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最后转换为</span></span><br><span class="line"><span class="keyword">const</span> vue = <span class="built_in">require</span>(<span class="string">&#x27;./node_modules/vue/dist/vue.runtime.common.js&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>而 vue.runtime.common.js 文件的最后一行是：<code>module.exports = Vue;</code>，就正好跟我们平时使用时的 <code>new Vue(&#123;&#125;)</code> 是一致的，这就是 <code>import vue from &#39;vue&#39;</code> 的过程了。</p>
<p>当然，这个是我们平时使用得最多的导入方式，还有其他一些导入规则，都可以在 <a href="https://nodejs.org/api/modules.html#modules_all_together">nodejs 的文档</a> 中找到。</p>
<p><strong>文章来源</strong>：<a href="https://www.jianshu.com/p/fad3688cbd81">https://www.jianshu.com/p/fad3688cbd81</a></p>
<h3 id="Vue-和-jQuery-有什么区别？"><a href="#Vue-和-jQuery-有什么区别？" class="headerlink" title="Vue 和 jQuery 有什么区别？"></a>Vue 和 jQuery 有什么区别？</h3><p>jQuery 是使用选择器（$）选取DOM对象，对其进行赋值、取值、事件绑定等操作，其实和原生的HTML的区别只在于可以更方便的选取和操作DOM对象，而数据和界面是在一起的。比如需要获取label标签的内容：$(“label”).val();,它还是依赖 DOM 元素的值。</p>
<p>Vue 则是通过 Vue 对象将数据和 View 完全分离开来了。对数据进行操作不再需要引用相应的 DOM 对象，可以说数据和 View 是分离的，他们通过 Vue 对象这个 vm 实现相互的绑定，也就是 MVVM。</p>
<h3 id="谈谈你对-MVVM-开发模式的理解"><a href="#谈谈你对-MVVM-开发模式的理解" class="headerlink" title="谈谈你对 MVVM 开发模式的理解"></a>谈谈你对 MVVM 开发模式的理解</h3><ul>
<li>Model 数据模型层，保存页面中的数据</li>
<li>View 视图层，页面数据的展示；</li>
<li>ViewModel M，V 调度者。双向数据绑定。通过监听 Model 数据的改变来控制 V 的更新，处理用户交互操作；</li>
</ul>
<p>M 数据改变 =&gt;VM =&gt; 触发 View 更新</p>
<p>V 用户操作 =&gt; VM =&gt; M 数据同步更新</p>
<p>开发者只需要专注对数据的维护操作即可，而不需要自己操作 dom 。</p>
<h3 id="请你讲一下-Vue-项目中使用-token-登录的具体流程"><a href="#请你讲一下-Vue-项目中使用-token-登录的具体流程" class="headerlink" title="请你讲一下 Vue 项目中使用 token 登录的具体流程"></a>请你讲一下 Vue 项目中使用 token 登录的具体流程</h3><p>对 token 完全不了解的同学可以查看我博客中转载的 <a href="https://evestorm.github.io/posts/29493/">这篇文章</a> 。</p>
<p>不想看长篇大论的我这里简单描述下基于 token 身份验证的整个流程：</p>
<ol>
<li>用户通过账户名和密码发送登录请求</li>
<li>服务端对账户的有效性进行验证</li>
<li>验证成功后再利用「密钥」和「加密算法」（如：HMAC-SHA256）对「用户数据」（如账号信息）做一个签名的 token 返回给客户端</li>
<li>客户端本地存储 token ，并在每次请求的 header 中带上 token</li>
<li>服务端验证 token 并返回数据</li>
</ol>
<p>对于 Vue 项目来说，具体流程如下：</p>
<ol>
<li>客户端：登录页带上用户名和密码请求登录接口</li>
<li>服务端：接收请求并在数据库中查询账户的有效性</li>
<li>服务端：查询通过后利用「密钥」和「加密算法」对「用户数据」做签名 token 并返回给客户端此 token （此 token 有时效性）</li>
<li>客户端：本地存储 token（如 localStorage + Vuex）</li>
<li>客户端：每次路由跳转前都要判断 localStorage 是否存在 token ，有则正常跳转，无则跳转回登录页</li>
<li>客户端：每次发送请求时，在 Axios 请求头里携带上 token</li>
<li>服务端：接收请求并判断请求头有无 token ，有且 token 没有过期，正常返回数据；无或 token 失效返回 401 状态码</li>
<li>客户端：一旦发现 401 则重定向到登录页</li>
</ol>
<p>一般回答完毕后面试官还会追问一些细节，这里列举两个常问的：</p>
<ol>
<li><p>你是如何利用 Axios 实现携带 token 以及 401 状态码判定的？</p>
<p>利用 Axios 的请求/响应拦截。使用 <code>axios.interceptors.request.use</code> 进行请求拦截，判断 localStorage 是否有 token ，有则在请求头里携带 token 。使用 <code>axios.interceptors.response.use</code> 进行响应拦截，判断 response.status 是否为 401 ，是则代表 token 失效，清空本地 token ，跳转登录页</p>
</li>
<li><p>你是如何监控路由跳转，并在没有 token 时跳转回登录页的？</p>
<p>使用 Vue Router 的全局路由守卫 router.beforeEach ，该方法接收三个参数：to、from 和 next ，如果用户访问的是不需要登录就能访问的页面（如 to.path === ‘/login’），则直接跳转。否则判断本地是否有 token ，有则调用 next() ，无则 next(‘/login’) 跳转回登录页</p>
</li>
</ol>
<h3 id="SPA-的缺点有哪些，如何解决？"><a href="#SPA-的缺点有哪些，如何解决？" class="headerlink" title="SPA 的缺点有哪些，如何解决？"></a>SPA 的缺点有哪些，如何解决？</h3><ul>
<li>不利于 SEO</li>
<li>首屏渲染时间过长</li>
</ul>
<h3 id="vue-如何优化首页的加载速度？vue-首页白屏是什么问题引起的？如何解决呢？"><a href="#vue-如何优化首页的加载速度？vue-首页白屏是什么问题引起的？如何解决呢？" class="headerlink" title="vue 如何优化首页的加载速度？vue 首页白屏是什么问题引起的？如何解决呢？"></a>vue 如何优化首页的加载速度？vue 首页白屏是什么问题引起的？如何解决呢？</h3><p>首页白屏的原因：<br>单页面应用的 html 是靠 js 生成，因为首屏需要加载很大的 js 文件(<code>app.js</code> <code>vendor.js</code>)，所以当网速差的时候会产生一定程度的白屏</p>
<p>解决办法：</p>
<ul>
<li>1.将公用的 JS 库通过 script 标签外部引入，减小 app.bundle 的大小，让浏览器并行下载资源文件，提高下载速度；</li>
<li>2.在配置路由时，页面和组件使用懒加载的方式引入，进一步缩小 app.bundle 的体积，在调用某个组件时再加载对应的 js 文件；</li>
<li>3.上<strong>骨架屏</strong>或 loading 动画，提升用户体验；</li>
<li>4.合理使用 web worker 优化一些计算</li>
<li>5.缓存一定要使用，但是请注意合理使用</li>
<li>6.最后可以借助一些工具进行性能评测，重点调优，例如 chrome 开发者工具的 performance 或 Google PageSpeed Insights 插件协助测试。</li>
</ul>
<h3 id="说说-Vue2-0-和-Vue3-0-有什么区别"><a href="#说说-Vue2-0-和-Vue3-0-有什么区别" class="headerlink" title="说说 Vue2.0 和 Vue3.0 有什么区别"></a>说说 Vue2.0 和 Vue3.0 有什么区别</h3><ol>
<li>重构响应式系统，使用 Proxy 替换 Object.defineProperty，使用 Proxy 优势：</li>
</ol>
<ul>
<li>可直接监听数组类型的数据变化</li>
<li>监听的目标为对象本身，不需要像 Object.defineProperty 一样遍历每个属性，有一定的性能提升</li>
<li>可拦截 apply、ownKeys、has 等 13 种方法，而 Object.defineProperty 不行</li>
<li>直接实现对象属性的新增/删除</li>
</ul>
<ol>
<li>新增 Composition API，更好的逻辑复用和代码组织</li>
<li>重构 Virtual DOM</li>
</ol>
<ul>
<li>模板编译时的优化，将一些静态节点编译成常量</li>
<li>slot 优化，将 slot 编译为 lazy 函数，将 slot 的渲染的决定权交给子组件</li>
<li>模板中内联事件的提取并重用（原本每次渲染都重新生成内联函数）</li>
</ul>
<ol>
<li>代码结构调整，更便于 Tree shaking，使得体积更小</li>
<li>使用 Typescript 替换 Flow</li>
</ol>
<h3 id="为什么要新增-Composition-API，它能解决什么问题"><a href="#为什么要新增-Composition-API，它能解决什么问题" class="headerlink" title="为什么要新增 Composition API，它能解决什么问题"></a>为什么要新增 Composition API，它能解决什么问题</h3><p>Vue2.0 中，随着功能的增加，组件变得越来越复杂，越来越难维护，而难以维护的根本原因是 Vue 的 API 设计迫使开发者使用 watch，computed，methods 选项组织代码，而不是实际的业务逻辑。</p>
<p>另外 Vue2.0 缺少一种较为简洁的低成本的机制来完成逻辑复用，虽然可以 minxis 完成逻辑复用，但是当 mixin 变多的时候，会使得难以找到对应的 data、computed 或者 method 来源于哪个 mixin，使得类型推断难以进行。</p>
<p>所以 Composition API 的出现，主要是也是为了解决 Option API 带来的问题，第一个是代码组织问题，Compostion API 可以让开发者根据业务逻辑组织自己的代码，让代码具备更好的可读性和可扩展性，也就是说当下一个开发者接触这一段不是他自己写的代码时，他可以更好的利用代码的组织反推出实际的业务逻辑，或者根据业务逻辑更好的理解代码。</p>
<p>第二个是实现代码的逻辑提取与复用，当然 mixin 也可以实现逻辑提取与复用，但是像前面所说的，多个 mixin 作用在同一个组件时，很难看出 property 是来源于哪个 mixin，来源不清楚，另外，多个 mixin 的 property 存在变量命名冲突的风险。而 Composition API 刚好解决了这两个问题。</p>
<h2 id="SSR-有了解吗？原理是什么？"><a href="#SSR-有了解吗？原理是什么？" class="headerlink" title="SSR 有了解吗？原理是什么？"></a>SSR 有了解吗？原理是什么？</h2><p>在客户端请求服务器的时候，服务器到数据库中获取到相关的数据，并且在服务器内部将 Vue 组件渲染成 HTML，并且将数据、HTML 一并返回给客户端，这个在服务器将数据和组件转化为 HTML 的过程，叫做服务端渲染 SSR。</p>
<p>而当客户端拿到服务器渲染的 HTML 和数据之后，由于数据已经有了，客户端不需要再一次请求数据，而只需要将数据同步到组件或者 Vuex 内部即可。除了数据以外，HTML 也结构已经有了，客户端在渲染组件的时候，也只需要将 HTML 的 DOM 节点映射到 Virtual DOM 即可，不需要重新创建 DOM 节点，这个将数据和 HTML 同步的过程，又叫做客户端激活。</p>
<p>使用 SSR 的好处：</p>
<ul>
<li>有利于 SEO：其实就是有利于爬虫来爬你的页面，因为部分页面爬虫是不支持执行 JavaScript 的，这种不支持执行 JavaScript 的爬虫抓取到的非 SSR 的页面会是一个空的 HTML 页面，而有了 SSR 以后，这些爬虫就可以获取到完整的 HTML 结构的数据，进而收录到搜索引擎中。</li>
<li>白屏时间更短：相对于客户端渲染，服务端渲染在浏览器请求 URL 之后已经得到了一个带有数据的 HTML 文本，浏览器只需要解析 HTML，直接构建 DOM 树就可以。而客户端渲染，需要先得到一个空的 HTML 页面，这个时候页面已经进入白屏，之后还需要经过加载并执行 JavaScript、请求后端服务器获取数据、JavaScript 渲染页面几个过程才可以看到最后的页面。特别是在复杂应用中，由于需要加载 JavaScript 脚本，越是复杂的应用，需要加载的 JavaScript 脚本就越多、越大，这会导致应用的首屏加载时间非常长，进而降低了体验感。</li>
</ul>
<p>更多详情查看<a href="https://github.com/yacan8/blog/issues/30">彻底理解服务端渲染 - SSR 原理</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-关于移动端适配,你必须要知道的</title>
    <url>/posts/32377/</url>
    <content><![CDATA[<h1 id="关于移动端适配，你必须要知道的"><a href="#关于移动端适配，你必须要知道的" class="headerlink" title="关于移动端适配，你必须要知道的"></a>关于移动端适配，你必须要知道的</h1><p>转载自 ConardLi 的 <a href="https://mp.weixin.qq.com/s/V3UpVZH8AWfSScIRAsr2dw">关于移动端适配，你必须要知道的</a><br>备用地址：<a href="https://zhuanlan.zhihu.com/p/66784964">知乎 - 关于移动端适配，你必须要知道的</a></p>
<h1 id="导读"><a href="#导读" class="headerlink" title="导读"></a>导读</h1><p>移动端适配，是我们在开发中经常会遇到的，这里面可能会遇到非常多的问题：</p>
<ul>
<li><code>1px</code>问题</li>
<li><code>UI</code>图完美适配方案</li>
<li><code>iPhoneX</code>适配方案</li>
<li>横屏适配</li>
<li>高清屏图片模糊问题</li>
<li>…</li>
</ul>
<p>上面这些问题可能我们在开发中已经知道如何解决，但是问题产生的原理，以及解决方案的原理可能会模糊不清。在解决这些问题的过程中，我们往往会遇到非常多的概念：像素、分辨率、<code>PPI</code>、<code>DPI</code>、<code>DP</code>、<code>DIP</code>、<code>DPR</code>、视口等等，你真的能分清这些概念的意义吗？<br>本文将从移动端适配的基础概念出发，探究移动端适配各种问题的解决方案和实现原理。</p>
<a id="more"></a>

<h2 id="一、英寸"><a href="#一、英寸" class="headerlink" title="一、英寸"></a>一、英寸</h2><p>一般用英寸描述屏幕的物理大小，如电脑显示器的<code>17</code>、<code>22</code>，手机显示器的<code>4.8</code>、<code>5.7</code>等使用的单位都是英寸。<br>需要注意，上面的尺寸都是屏幕对角线的长度：</p>
<img src="/posts/32377/1562663932328-b974998a-b6c2-44d9-9396-37f3275f5606.webp" class="" title="1562663932328-b974998a-b6c2-44d9-9396-37f3275f5606">

<p>英寸(<code>inch</code>,缩写为<code>in</code>)在荷兰语中的本意是大拇指，一英寸就是指甲底部普通人拇指的宽度。<br>英寸和厘米的换算：<code>1英寸 = 2.54 厘米</code></p>
<h2 id="二、分辨率"><a href="#二、分辨率" class="headerlink" title="二、分辨率"></a>二、分辨率</h2><h3 id="2-1-像素"><a href="#2-1-像素" class="headerlink" title="2.1 像素"></a>2.1 像素</h3><p>像素即一个小方块，它具有特定的位置和颜色。<br>图片、电子屏幕（手机、电脑）就是由无数个具有特定颜色和特定位置的小方块拼接而成。<br>像素可以作为图片或电子屏幕的最小组成单位。<br>下面我们使用<code>sketch</code>打开一张图片：</p>
<img src="/posts/32377/1562663932387-74d0aad2-a959-4cfa-922a-536e1a48be9c.webp" class="" title="1562663932387-74d0aad2-a959-4cfa-922a-536e1a48be9c">
<p>将这些图片放大即可看到这些像素点：</p>
<img src="/posts/32377/1562663932490-79bcd909-6d73-443f-aac0-74aeb4c9e4d4.webp" class="" title="1562663932490-79bcd909-6d73-443f-aac0-74aeb4c9e4d4">

<p>通常我们所说的分辨率有两种，屏幕分辨率和图像分辨率。</p>
<h3 id="2-2-屏幕分辨率"><a href="#2-2-屏幕分辨率" class="headerlink" title="2.2 屏幕分辨率"></a>2.2 屏幕分辨率</h3><p>屏幕分辨率指一个屏幕具体由多少个像素点组成。<br>下面是<code>apple</code>的官网上对手机分辨率的描述：</p>
<img src="/posts/32377/1562663932508-1826ddba-ab3b-41b8-bbaf-75b22c7ff987.webp" class="" title="1562663932508-1826ddba-ab3b-41b8-bbaf-75b22c7ff987">

<p><code>iPhone XS Max</code> 和 <code>iPhone SE</code>的分辨率分别为<code>2688 x 1242</code>和<code>1136 x 640</code>。这表示手机分别在垂直和水平上所具有的像素点数。<br>当然分辨率高不代表屏幕就清晰，屏幕的清晰程度还与尺寸有关。</p>
<h3 id="2-3-图像分辨率"><a href="#2-3-图像分辨率" class="headerlink" title="2.3 图像分辨率"></a>2.3 图像分辨率</h3><p>我们通常说的<code>图片分辨率</code>其实是指图片含有的<code>像素数</code>，比如一张图片的分辨率为<code>800 x 400</code>。这表示图片分别在垂直和水平上所具有的像素点数为<code>800</code>和<code>400</code>。<br>同一尺寸的图片，分辨率越高，图片越清晰。</p>
<img src="/posts/32377/1562663932625-bb7e747e-5fd0-4ac9-83b0-e87e380fc127.webp" class="" title="1562663932625-bb7e747e-5fd0-4ac9-83b0-e87e380fc127">

<h3 id="2-4-PPI"><a href="#2-4-PPI" class="headerlink" title="2.4 PPI"></a>2.4 PPI</h3><p><code>PPI(Pixel Per Inch)</code>：每英寸包括的像素数。<br><code>PPI</code>可以用于描述屏幕的清晰度以及一张图片的质量。<br>使用<code>PPI</code>描述图片时，<code>PPI</code>越高，图片质量越高，使用<code>PPI</code>描述屏幕时，<code>PPI</code>越高，屏幕越清晰。<br>在上面描述手机分辨率的图片中，我们可以看到：<code>iPhone XS Max</code> 和 <code>iPhone SE</code>的<code>PPI</code>分别为<code>458</code>和<code>326</code>，这足以证明前者的屏幕更清晰。<br>由于手机尺寸为手机对角线的长度，我们通常使用如下的方法计算<code>PPI</code>:</p>
<img src="/posts/32377/1562663932571-3d4ce08a-a140-4f91-b0e2-d5cae0b9005a.svg" class="" title="1562663932571-3d4ce08a-a140-4f91-b0e2-d5cae0b9005a">

<p><code>iPhone 6</code>的<code>PPI</code>为</p>
<img src="/posts/32377/1562663932862-ebc481bc-a0f8-4245-a077-2ea0e3fcecc6.svg" class="" title="1562663932862-ebc481bc-a0f8-4245-a077-2ea0e3fcecc6">

<p>，那它每英寸约含有<code>326</code>个物理像素点。</p>
<h3 id="2-5-DPI"><a href="#2-5-DPI" class="headerlink" title="2.5 DPI"></a>2.5 DPI</h3><p><code>DPI(Dot Per Inch)</code>：即每英寸包括的点数。<br>这里的点是一个抽象的单位，它可以是屏幕像素点、图片像素点也可以是打印机的墨点。<br>平时你可能会看到使用<code>DPI</code>来描述图片和屏幕，这时的<code>DPI</code>应该和<code>PPI</code>是等价的，<code>DPI</code>最常用的是用于描述打印机，表示打印机每英寸可以打印的点数。<br>一张图片在屏幕上显示时，它的像素点数是规则排列的，每个像素点都有特定的位置和颜色。<br>当使用打印机进行打印时，打印机可能不会规则的将这些点打印出来，而是使用一个个打印点来呈现这张图像，这些打印点之间会有一定的空隙，这就是<code>DPI</code>所描述的：打印点的密度。</p>
<img src="/posts/32377/1562663932949-2f7ff864-cfb7-47db-bd5e-abaedeadb29f.webp" class="" title="1562663932949-2f7ff864-cfb7-47db-bd5e-abaedeadb29f">

<p>在上面的图像中我们可以清晰的看到，打印机是如何使用墨点来打印一张图像。<br>所以，打印机的<code>DPI</code>越高，打印图像的精细程度就越高，同时这也会消耗更多的墨点和时间。</p>
<h2 id="三、设备独立像素"><a href="#三、设备独立像素" class="headerlink" title="三、设备独立像素"></a>三、设备独立像素</h2><p>实际上，上面我们描述的像素都是<code>物理像素</code>，即设备上真实的物理单元。<br>下面我们来看看<code>设备独立像素</code>究竟是如何产生的：<br>智能手机发展非常之快，在几年之前，我们还用着分辨率非常低的手机，比如下面左侧的白色手机，它的分辨率是<code>320x480</code>，我们可以在上面浏览正常的文字、图片等等。<br>但是，随着科技的发展，低分辨率的手机已经不能满足我们的需求了。很快，更高分辨率的屏幕诞生了，比如下面的黑色手机，它的分辨率是<code>640x940</code>，正好是白色手机的两倍。<br>理论上来讲，在白色手机上相同大小的图片和文字，在黑色手机上会被缩放一倍，因为它的分辨率提高了一倍。这样，岂不是后面出现更高分辨率的手机，页面元素会变得越来越小吗？</p>
<img src="/posts/32377/1562663933090-02a5b9e8-a240-40d3-ab05-d476bf143cdc.webp" class="" title="1562663933090-02a5b9e8-a240-40d3-ab05-d476bf143cdc">

<p>然而，事实并不是这样的，我们现在使用的智能手机，不管分辨率多高，他们所展示的界面比例都是基本类似的。乔布斯在<code>iPhone4</code>的发布会上首次提出了<code>Retina Display</code>(视网膜屏幕)的概念，它正是解决了上面的问题，这也使它成为一款跨时代的手机。</p>
<img src="/posts/32377/1562663932958-d70eea30-2c6e-4bc7-b5af-22cd423defa8.webp" class="" title="1562663932958-d70eea30-2c6e-4bc7-b5af-22cd423defa8">

<p>在<code>iPhone4</code>使用的视网膜屏幕中，把<code>2x2</code>个像素当<code>1</code>个像素使用，这样让屏幕看起来更精致，但是元素的大小却不会改变。</p>
<img src="/posts/32377/1562663933124-91df009b-d59a-4585-8ad3-39c7945cebc2.webp" class="" title="1562663933124-91df009b-d59a-4585-8ad3-39c7945cebc2">

<p>如果黑色手机使用了视网膜屏幕的技术，那么显示结果应该是下面的情况，比如列表的宽度为<code>300</code>个像素，那么在一条水平线上，白色手机会用<code>300</code>个物理像素去渲染它，而黑色手机实际上会用<code>600</code>个物理像素去渲染它。<br>我们必须用一种单位来同时告诉不同分辨率的手机，它们在界面上显示元素的大小是多少，这个单位就是设备独立像素(<code>Device Independent Pixels</code>)简称<code>DIP</code>或<code>DP</code>。上面我们说，列表的宽度为<code>300</code>个像素，实际上我们可以说：列表的宽度为<code>300</code>个设备独立像素。</p>
<img src="/posts/32377/1562663933163-a23157d6-5e87-4d11-ab09-45daffdef5a9.webp" class="" title="1562663933163-a23157d6-5e87-4d11-ab09-45daffdef5a9">

<p>打开<code>chrome</code>的开发者工具，我们可以模拟各个手机型号的显示情况，每种型号上面会显示一个尺寸，比如<code>iPhone X</code>显示的尺寸是<code>375x812</code>，实际<code>iPhone X</code>的分辨率会比这高很多，这里显示的就是设备独立像素。</p>
<img src="/posts/32377/1562663933557-1f18199d-0950-4c09-bc0d-80c3fa6de079.webp" class="" title="1562663933557-1f18199d-0950-4c09-bc0d-80c3fa6de079">

<h3 id="3-1-设备像素比"><a href="#3-1-设备像素比" class="headerlink" title="3.1 设备像素比"></a>3.1 设备像素比</h3><p>设备像素比<code>device pixel ratio</code>简称<code>dpr</code>，即物理像素和设备独立像素的比值。<br>在<code>web</code>中，浏览器为我们提供了<code>window.devicePixelRatio</code>来帮助我们获取<code>dpr</code>。<br>在<code>css</code>中，可以使用媒体查询<code>min-device-pixel-ratio</code>，区分<code>dpr</code>：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@media</span> (<span class="attribute">-webkit-min-device-pixel-ratio:</span> <span class="number">2</span>), (<span class="attribute">min-device-pixel-ratio:</span> <span class="number">2</span>) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>React Native</code>中，我们也可以使用<code>PixelRatio.get()</code>来获取<code>DPR</code>。<br>当然，上面的规则也有例外，<code>iPhone 6、7、8 Plus</code>的实际物理像素是<code>1080 x 1920</code>，在开发者工具中我们可以看到：它的设备独立像素是<code>414 x 736</code>，设备像素比为<code>3</code>，设备独立像素和设备像素比的乘积并不等于<code>1080 x 1920</code>，而是等于<code>1242 x 2208</code>。<br>实际上，手机会自动把<code>1242 x 2208</code>个像素点塞进<code>1080 * 1920</code>个物理像素点来渲染，我们不用关心这个过程，而<code>1242 x 2208</code>被称为屏幕的<code>设计像素</code>。我们开发过程中也是以这个<code>设计像素</code>为准。<br>实际上，从苹果提出视网膜屏幕开始，才出现设备像素比这个概念，因为在这之前，移动设备都是直接使用物理像素来进行展示。<br>紧接着，<code>Android</code>同样使用了其他的技术方案来实现<code>DPR</code>大于<code>1</code>的屏幕，不过原理是类似的。由于<code>Android</code>屏幕尺寸非常多、分辨率高低跨度非常大，不像苹果只有它自己的几款固定设备、尺寸。所以，为了保证各种设备的显示效果，<code>Android</code>按照设备的像素密度将设备分成了几个区间：</p>
<img src="/posts/32377/1562663933436-4deef766-5f69-4531-9d32-31d6e9fe81b1.webp" class="" title="1562663933436-4deef766-5f69-4531-9d32-31d6e9fe81b1">

<p>当然，所有的<code>Android</code>设备不一定严格按照上面的分辨率，每个类型可能对应几种不同分辨率，所以，每个<code>Android</code>手机都能根据给定的区间范围，确定自己的<code>DPR</code>，从而拥有类似的显示。当然，仅仅是类似，由于各个设备的尺寸、分辨率上的差异，设备独立像素也不会完全相等，所以各种<code>Android</code>设备仍然不能做到在展示上完全相等。</p>
<h3 id="3-2-移动端开发"><a href="#3-2-移动端开发" class="headerlink" title="3.2 移动端开发"></a>3.2 移动端开发</h3><p>在<code>iOS</code>、<code>Android</code>和<code>React Native</code>开发中样式单位其实都使用的是设备独立像素。<br><code>iOS</code>的尺寸单位为<code>pt</code>，<code>Android</code>的尺寸单位为<code>dp</code>，<code>React Native</code>中没有指定明确的单位，它们其实都是设备独立像素<code>dp</code>。<br>在使用<code>React Native</code>开发<code>App</code>时，<code>UI</code>给我们的原型图一般是基于<code>iphone6</code>的像素给定的。<br>为了适配所有机型，我们在写样式时需要把物理像素转换为设备独立像素：例如：如果给定一个元素的高度为<code>200px</code>(这里的<code>px</code>指物理像素，非<code>CSS</code>像素)，<code>iphone6</code>的设备像素比为<code>2</code>，我们给定的<code>height</code>应为<code>200px/2=100dp</code>。<br>当然，最好的是，你可以和设计沟通好，所有的<code>UI</code>图都按照设备独立像素来出。<br>我们还可以在代码(<code>React Native</code>)中进行<code>px</code>和<code>dp</code>的转换：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PixelRatio &#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> dpr = PixelRatio.get();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * px转换为dp</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">pxConvertTodp</span>(<span class="params">px</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> px / dpr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * dp转换为px</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">dpConvertTopx</span>(<span class="params">dp</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> PixelRatio.getPixelSizeForLayoutSize(dp);</span><br><span class="line">&#125;</span><br><span class="line">复制代码;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-WEB-端开发"><a href="#3-3-WEB-端开发" class="headerlink" title="3.3 WEB 端开发"></a>3.3 WEB 端开发</h3><p>在写<code>CSS</code>时，我们用到最多的单位是<code>px</code>，即<code>CSS像素</code>，当页面缩放比例为<code>100%</code>时，一个<code>CSS像素</code>等于一个设备独立像素。<br>但是<code>CSS像素</code>是很容易被改变的，当用户对浏览器进行了放大，<code>CSS像素</code>会被放大，这时一个<code>CSS像素</code>会跨越更多的物理像素。<br><code>页面的缩放系数 = CSS像素 / 设备独立像素</code>。</p>
<h3 id="3-4-关于屏幕"><a href="#3-4-关于屏幕" class="headerlink" title="3.4 关于屏幕"></a>3.4 关于屏幕</h3><p>这里多说两句<code>Retina</code>屏幕，因为我在很多文章中看到对<code>Retina</code>屏幕的误解。<br><code>Retina</code>屏幕只是苹果提出的一个营销术语：</p>
<blockquote>
<p>在普通的使用距离下，人的肉眼无法分辨单个的像素点。</p>
</blockquote>
<p>为什么强调<code>普通的使用距离下</code>呢？我们来看一下它的计算公式：</p>
<img src="/posts/32377/1562663933488-1a7cc3d4-bcba-44c2-8304-b783e6e84aaf.svg" class="" title="1562663933488-1a7cc3d4-bcba-44c2-8304-b783e6e84aaf">

<p><code>a</code>代表人眼视角，<code>h</code>代表像素间距，<code>d</code>代表肉眼与屏幕的距离，符合以上条件的屏幕可以使肉眼看不见单个物理像素点。<br>它不能单纯的表达分辨率和<code>PPI</code>，只能一种表达视觉效果。<br>让多个物理像素渲染一个独立像素只是<code>Retina</code>屏幕为了达到效果而使用的一种技术。而不是所有<code>DPR &gt; 1</code>的屏幕就是<code>Retina</code>屏幕。<br>比如：给你一块超大尺寸的屏幕，即使它的<code>PPI</code>很高，<code>DPR</code>也很高，在近距离你也能看清它的像素点，这就不算<code>Retina</code>屏幕。</p>
<img src="/posts/32377/1562663933755-47739586-4157-4880-8285-860a96d22ae1.webp" class="" title="1562663933755-47739586-4157-4880-8285-860a96d22ae1">

<p>我们经常见到用<code>K</code>和<code>P</code>这个单位来形容屏幕：<br><code>P</code>代表的就是屏幕纵向的像素个数，<code>1080P</code>即纵向有<code>1080</code>个像素，分辨率为<code>1920X1080</code>的屏幕就属于<code>1080P</code>屏幕。<br>我们平时所说的高清屏其实就是屏幕的物理分辨率达到或超过<code>1920X1080</code>的屏幕。<br><code>K</code>代表屏幕横向有几个<code>1024</code>个像素，一般来讲横向像素超过<code>2048</code>就属于<code>2K</code>屏，横向像素超过<code>4096</code>就属于<code>4K</code>屏。</p>
<h2 id="四、视口"><a href="#四、视口" class="headerlink" title="四、视口"></a>四、视口</h2><p>视口(<code>viewport</code>)代表当前可见的计算机图形区域。在<code>Web</code>浏览器术语中，通常与浏览器窗口相同，但不包括浏览器的<code>UI</code>， 菜单栏等——即指你正在浏览的文档的那一部分。<br>一般我们所说的视口共包括三种：布局视口、视觉视口和理想视口，它们在屏幕适配中起着非常重要的作用。</p>
<h3 id="4-1-布局视口"><a href="#4-1-布局视口" class="headerlink" title="4.1 布局视口"></a>4.1 布局视口</h3><img src="/posts/32377/1562663934267-374c4d0e-4a78-4c9c-acf6-8c637541b6d1.webp" class="" title="1562663934267-374c4d0e-4a78-4c9c-acf6-8c637541b6d1">

<p>布局视口(<code>layout viewport</code>)：当我们以百分比来指定一个元素的大小时，它的计算值是由这个元素的包含块计算而来的。当这个元素是最顶级的元素时，它就是基于布局视口来计算的。<br>所以，布局视口是网页布局的基准窗口，在<code>PC</code>浏览器上，布局视口就等于当前浏览器的窗口大小（不包括<code>borders</code> 、<code>margins</code>、滚动条）。<br>在移动端，布局视口被赋予一个默认值，大部分为<code>980px</code>，这保证<code>PC</code>的网页可以在手机浏览器上呈现，但是非常小，用户可以手动对网页进行放大。<br>我们可以通过调用<code>document.documentElement.clientWidth / clientHeight</code>来获取布局视口大小。</p>
<h3 id="4-2-视觉视口"><a href="#4-2-视觉视口" class="headerlink" title="4.2 视觉视口"></a>4.2 视觉视口</h3><img src="/posts/32377/1562663933611-cad2fbbe-c66c-410f-a681-2e52ac7b5b9d.webp" class="" title="1562663933611-cad2fbbe-c66c-410f-a681-2e52ac7b5b9d">

<p>视觉视口(<code>visual viewport</code>)：用户通过屏幕真实看到的区域。<br>视觉视口默认等于当前浏览器的窗口大小（包括滚动条宽度）。<br>当用户对浏览器进行缩放时，不会改变布局视口的大小，所以页面布局是不变的，但是缩放会改变视觉视口的大小。<br>例如：用户将浏览器窗口放大了<code>200%</code>，这时浏览器窗口中的<code>CSS像素</code>会随着视觉视口的放大而放大，这时一个<code>CSS</code>像素会跨越更多的物理像素。<br>所以，布局视口会限制你的<code>CSS</code>布局而视觉视口决定用户具体能看到什么。<br>我们可以通过调用<code>window.innerWidth / innerHeight</code>来获取视觉视口大小。</p>
<h3 id="4-3-理想视口"><a href="#4-3-理想视口" class="headerlink" title="4.3 理想视口"></a>4.3 理想视口</h3><img src="/posts/32377/1562663933848-26c898f8-4342-4463-8747-bb883e8768fd.webp" class="" title="1562663933848-26c898f8-4342-4463-8747-bb883e8768fd">

<p>布局视口在移动端展示的效果并不是一个理想的效果，所以理想视口(<code>ideal viewport</code>)就诞生了：网站页面在移动端展示的理想大小。<br>如上图，我们在描述设备独立像素时曾使用过这张图，在浏览器调试移动端时页面上给定的像素大小就是理想视口大小，它的单位正是设备独立像素。<br>上面在介绍<code>CSS像素时</code>曾经提到<code>页面的缩放系数 = CSS像素 / 设备独立像素</code>，实际上说<code>页面的缩放系数 = 理想视口宽度 / 视觉视口宽度</code>更为准确。<br>所以，当页面缩放比例为<code>100%</code>时，<code>CSS像素 = 设备独立像素</code>，<code>理想视口 = 视觉视口</code>。<br>我们可以通过调用<code>screen.width / height</code>来获取理想视口大小。</p>
<h3 id="4-4-Meta-viewport"><a href="#4-4-Meta-viewport" class="headerlink" title="4.4 Meta viewport"></a>4.4 Meta viewport</h3><meta> 元素表示那些不能由其它HTML元相关元素之一表示的任何元数据信息，它可以告诉浏览器如何解析页面。 我们可以借助<meta>元素的viewport来帮助我们设置视口、缩放等，从而让移动端得到更好的展示效果。

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;meta</span><br><span class="line">  name=&quot;viewport&quot;</span><br><span class="line">  content=&quot;width=device-width; initial-scale=1; maximum-scale=1; minimum-scale=1; user-scalable=no;&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>上面是<code>viewport</code>的一个配置，我们来看看它们的具体含义：</p>
<table>
<thead>
<tr>
<th align="left"><code>Value</code></th>
<th align="left">可能值</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>width</code></td>
<td align="left">正整数或<code>device-width</code></td>
<td align="left">以<code>pixels</code>（像素）为单位， 定义布局视口的宽度。</td>
</tr>
<tr>
<td align="left"><code>height</code></td>
<td align="left">正整数或<code>device-height</code></td>
<td align="left">以<code>pixels</code>（像素）为单位， 定义布局视口的高度。</td>
</tr>
<tr>
<td align="left"><code>initial-scale</code></td>
<td align="left"><code>0.0 - 10.0</code></td>
<td align="left">定义页面初始缩放比率。</td>
</tr>
<tr>
<td align="left"><code>minimum-scale</code></td>
<td align="left"><code>0.0 - 10.0</code></td>
<td align="left">定义缩放的最小值；必须小于或等于<code>maximum-scale</code>的值。</td>
</tr>
<tr>
<td align="left"><code>maximum-scale</code></td>
<td align="left"><code>0.0 - 10.0</code></td>
<td align="left">定义缩放的最大值；必须大于或等于<code>minimum-scale</code>的值。</td>
</tr>
<tr>
<td align="left"><code>user-scalable</code></td>
<td align="left">一个布尔值（<code>yes</code>或者<code>no</code>）</td>
<td align="left">如果设置为 <code>no</code>，用户将不能放大或缩小网页。默认值为 yes。</td>
</tr>
</tbody></table>
<h3 id="4-5-移动端适配"><a href="#4-5-移动端适配" class="headerlink" title="4.5 移动端适配"></a>4.5 移动端适配</h3><p>为了在移动端让页面获得更好的显示效果，我们必须让布局视口、视觉视口都尽可能等于理想视口。<br><code>device-width</code>就等于理想视口的宽度，所以设置<code>width=device-width</code>就相当于让布局视口等于理想视口。<br>由于<code>initial-scale = 理想视口宽度 / 视觉视口宽度</code>，所以我们设置<code>initial-scale=1;</code>就相当于让视觉视口等于理想视口。<br>这时，1 个<code>CSS</code>像素就等于 1 个设备独立像素，而且我们也是基于理想视口来进行布局的，所以呈现出来的页面布局在各种设备上都能大致相似。</p>
<h3 id="4-6-缩放"><a href="#4-6-缩放" class="headerlink" title="4.6 缩放"></a>4.6 缩放</h3><p>上面提到<code>width</code>可以决定布局视口的宽度，实际上它并不是布局视口的唯一决定性因素，设置<code>initial-scale</code>也有肯能影响到布局视口，因为布局视口宽度取的是<code>width</code>和视觉视口宽度的最大值。<br>例如：若手机的理想视口宽度为<code>400px</code>，设置<code>width=device-width</code>，<code>initial-scale=2</code>，此时<code>视觉视口宽度 = 理想视口宽度 / initial-scale</code>即<code>200px</code>，布局视口取两者最大值即<code>device-width</code> <code>400px</code>。<br>若设置<code>width=device-width</code>，<code>initial-scale=0.5</code>，此时<code>视觉视口宽度 = 理想视口宽度 / initial-scale</code>即<code>800px</code>，布局视口取两者最大值即<code>800px</code>。</p>
<h3 id="4-7-获取浏览器大小"><a href="#4-7-获取浏览器大小" class="headerlink" title="4.7 获取浏览器大小"></a>4.7 获取浏览器大小</h3><p>浏览器为我们提供的获取窗口大小的<code>API</code>有很多，下面我们再来对比一下：</p>
<img src="/posts/32377/1562663933933-c4ccd860-fd21-481c-8747-7c30d11058fa.webp" class="" title="1562663933933-c4ccd860-fd21-481c-8747-7c30d11058fa">

<ul>
<li><p><code>window.innerHeight</code>：获取浏览器视觉视口高度（包括垂直滚动条）。</p>
</li>
<li><p><code>window.outerHeight</code>：获取浏览器窗口外部的高度。表示整个浏览器窗口的高度，包括侧边栏、窗口镶边和调正窗口大小的边框。</p>
</li>
<li><p><code>window.screen.Height</code>：获取获屏幕取理想视口高度，这个数值是固定的，<code>设备的分辨率/设备像素比</code></p>
</li>
<li><p><code>window.screen.availHeight</code>：浏览器窗口可用的高度。</p>
</li>
<li><p><code>document.documentElement.clientHeight</code>：获取浏览器布局视口高度，包括内边距，但不包括垂直滚动条、边框和外边距。</p>
</li>
<li><p><code>document.documentElement.offsetHeight</code>：包括内边距、滚动条、边框和外边距。</p>
</li>
<li><pre><code class="js">document.documentElement.scrollHeight;
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">：在不使用滚动条的情况下适合视口中的所有内容所需的最小宽度。测量方式与</span><br><span class="line"></span><br></pre></td></tr></table></figure>
clientHeight
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">相同：它包含元素的内边距，但不包括边框，外边距或垂直滚动条。</span><br><span class="line"></span><br><span class="line">## 五、1px 问题</span><br><span class="line"></span><br><span class="line">为了适配各种屏幕，我们写代码时一般使用设备独立像素来对页面进行布局。</span><br><span class="line"></span><br><span class="line">而在设备像素比大于</span><br><span class="line"></span><br></pre></td></tr></table></figure>
1
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">的屏幕上，我们写的</span><br><span class="line"></span><br></pre></td></tr></table></figure>
1px
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">实际上是被多个物理像素渲染，这就会出现</span><br><span class="line"></span><br></pre></td></tr></table></figure>
1px
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">在有些屏幕上看起来很粗的现象。</span><br><span class="line"></span><br><span class="line">### 5.1 border-image</span><br><span class="line"></span><br><span class="line">基于</span><br><span class="line"></span><br></pre></td></tr></table></figure>
media
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">查询判断不同的设备像素比给定不同的</span><br><span class="line"></span><br></pre></td></tr></table></figure>
border-image
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">：</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;css</span><br><span class="line">.border_1px &#123;</span><br><span class="line">  border-bottom: 1px solid #000;</span><br><span class="line">&#125;</span><br><span class="line">@media only screen and (-webkit-min-device-pixel-ratio: 2) &#123;</span><br><span class="line">  .border_1px &#123;</span><br><span class="line">    border-bottom: none;</span><br><span class="line">    border-width: 0 0 1px 0;</span><br><span class="line">    border-image: url(..&#x2F;img&#x2F;1pxline.png) 0 0 2 0 stretch;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h3 id="5-2-background-image"><a href="#5-2-background-image" class="headerlink" title="5.2 background-image"></a>5.2 background-image</h3><p>和<code>border-image</code>类似，准备一张符合条件的边框背景图，模拟在背景上。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.border_1px</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">-webkit-min-device-pixel-ratio:</span> <span class="number">2</span>) &#123;</span><br><span class="line">  <span class="selector-class">.border_1px</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(../img/<span class="number">1px</span>line.png) repeat-x left bottom;</span><br><span class="line">    <span class="attribute">background-size</span>: <span class="number">100%</span> <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面两种都需要单独准备图片，而且圆角不是很好处理，但是可以应对大部分场景。</p>
<h3 id="5-3-伪类-transform"><a href="#5-3-伪类-transform" class="headerlink" title="5.3 伪类 + transform"></a>5.3 伪类 + transform</h3><p>基于<code>media</code>查询判断不同的设备像素比对线条进行缩放：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.border_1px</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#000</span>;</span><br><span class="line">  <span class="attribute">transform-origin</span>: <span class="number">50%</span> <span class="number">0%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">-webkit-min-device-pixel-ratio:</span> <span class="number">2</span>) &#123;</span><br><span class="line">  <span class="selector-class">.border_1px</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(<span class="number">0.5</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">-webkit-min-device-pixel-ratio:</span> <span class="number">3</span>) &#123;</span><br><span class="line">  <span class="selector-class">.border_1px</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(<span class="number">0.33</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方式可以满足各种场景，如果需要满足圆角，只需要给伪类也加上<code>border-radius</code>即可。</p>
<h3 id="5-4-svg"><a href="#5-4-svg" class="headerlink" title="5.4 svg"></a>5.4 svg</h3><p>上面我们<code>border-image</code>和<code>background-image</code>都可以模拟<code>1px</code>边框，但是使用的都是位图，还需要外部引入。<br>借助<code>PostCSS</code>的<code>postcss-write-svg</code>我们能直接使用<code>border-image</code>和<code>background-image</code>创建<code>svg</code>的<code>1px</code>边框：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@svg</span> border_1px &#123;</span><br><span class="line">  <span class="selector-tag">height</span>: 2<span class="selector-tag">px</span>;</span><br><span class="line">  <span class="keyword">@rect</span> &#123;</span><br><span class="line">    <span class="selector-tag">fill</span>: <span class="selector-tag">var</span>(<span class="selector-tag">--color</span>, <span class="selector-tag">black</span>);</span><br><span class="line">    <span class="selector-tag">width</span>: 100%;</span><br><span class="line">    <span class="selector-tag">height</span>: 50%;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.example</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid transparent;</span><br><span class="line">  <span class="attribute">border-image</span>: <span class="built_in">svg</span>(border_1px param(--color #<span class="number">00</span>b1ff)) <span class="number">2</span> <span class="number">2</span> stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译后：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.example</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid transparent;</span><br><span class="line">  <span class="attribute">border-image</span>: <span class="built_in">url</span>(<span class="string">&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; height=&#x27;2px&#x27;%3E%3Crect fill=&#x27;%2300b1ff&#x27; width=&#x27;100%25&#x27; height=&#x27;50%25&#x27;/%3E%3C/svg%3E&quot;</span>)</span><br><span class="line">    <span class="number">2</span> <span class="number">2</span> stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的方案是大漠在他的文章中推荐使用的，基本可以满足所有场景，而且不需要外部引入，这是我个人比较喜欢的一种方案。</p>
<h3 id="5-5-设置-viewport"><a href="#5-5-设置-viewport" class="headerlink" title="5.5 设置 viewport"></a>5.5 设置 viewport</h3><p>通过设置缩放，让<code>CSS</code>像素等于真正的物理像素。<br>例如：当设备像素比为<code>3</code>时，我们将页面缩放<code>1/3</code>倍，这时<code>1px</code>等于一个真正的屏幕像素。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> scale = <span class="number">1</span> / <span class="built_in">window</span>.devicePixelRatio;</span><br><span class="line"><span class="keyword">const</span> viewport = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;meta[name=&quot;viewport&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!viewport) &#123;</span><br><span class="line">  viewport = <span class="built_in">document</span>.createElement(<span class="string">&#x27;meta&#x27;</span>);</span><br><span class="line">  viewport.setAttribute(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;viewport&#x27;</span>);</span><br><span class="line">  <span class="built_in">window</span>.document.head.appendChild(viewport);</span><br><span class="line">&#125;</span><br><span class="line">viewport.setAttribute(</span><br><span class="line">  <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;width=device-width,user-scalable=no,initial-scale=&#x27;</span> +</span><br><span class="line">    scale +</span><br><span class="line">    <span class="string">&#x27;,maximum-scale=&#x27;</span> +</span><br><span class="line">    scale +</span><br><span class="line">    <span class="string">&#x27;,minimum-scale=&#x27;</span> +</span><br><span class="line">    scale</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>实际上，上面这种方案是早先<code>flexible</code>采用的方案。<br>当然，这样做是要付出代价的，这意味着你页面上所有的布局都要按照物理像素来写。这显然是不现实的，这时，我们可以借助<code>flexible</code>或<code>vw、vh</code>来帮助我们进行适配。</p>
<h2 id="六、移动端适配方案"><a href="#六、移动端适配方案" class="headerlink" title="六、移动端适配方案"></a>六、移动端适配方案</h2><p>尽管我们可以使用设备独立像素来保证各个设备在不同手机上显示的效果类似，但这并不能保证它们显示完全一致，我们需要一种方案来让设计稿得到更完美的适配。</p>
<h3 id="6-1-flexible-方案"><a href="#6-1-flexible-方案" class="headerlink" title="6.1 flexible 方案"></a>6.1 flexible 方案</h3><p><code>flexible</code>方案是阿里早期开源的一个移动端适配解决方案，引用<code>flexible</code>后，我们在页面上统一使用<code>rem</code>来布局。<br>它的核心代码非常简单：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// set 1rem = viewWidth / 10</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setRemUnit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> rem = docEl.clientWidth / <span class="number">10</span>;</span><br><span class="line">  docEl.style.fontSize = rem + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">setRemUnit();</span><br></pre></td></tr></table></figure>

<p><code>rem</code> 是相对于<code>html</code>节点的<code>font-size</code>来做计算的。<br>我们通过设置<code>document.documentElement.style.fontSize</code>就可以统一整个页面的布局标准。<br>上面的代码中，将<code>html</code>节点的<code>font-size</code>设置为页面<code>clientWidth</code>(布局视口)的<code>1/10</code>，即<code>1rem</code>就等于页面布局视口的<code>1/10</code>，这就意味着我们后面使用的<code>rem</code>都是按照页面比例来计算的。<br>这时，我们只需要将<code>UI</code>出的图转换为<code>rem</code>即可。<br>以<code>iPhone6</code>为例：布局视口为<code>375px</code>，则<code>1rem = 37.5px</code>，这时<code>UI</code>给定一个元素的宽为<code>75px</code>（设备独立像素），我们只需要将它设置为<code>75 / 37.5 = 2rem</code>。<br>当然，每个布局都要计算非常繁琐，我们可以借助<code>PostCSS</code>的<code>px2rem</code>插件来帮助我们完成这个过程。<br>下面的代码可以保证在页面大小变化时，布局可以自适应，当触发了<code>window</code>的<code>resize</code>和<code>pageShow</code>事件之后自动调整<code>html</code>的<code>fontSize</code>大小。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// reset rem unit on page resize</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&#x27;resize&#x27;</span>, setRemUnit)<span class="built_in">window</span>.addEventListener(<span class="string">&#x27;pageshow&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e.persisted) &#123;</span><br><span class="line">      setRemUnit()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>由于<code>viewport</code>单位得到众多浏览器的兼容，上面这种方案现在已经被官方弃用：</p>
<blockquote>
<p>lib-flexible 这个过渡方案已经可以放弃使用，不管是现在的版本还是以前的版本，都存有一定的问题。建议大家开始使用 viewport 来替代此方案。</p>
</blockquote>
<p>下面我们来看看现在最流行的<code>vh、vw</code>方案。</p>
<h3 id="6-2-vh、vw-方案"><a href="#6-2-vh、vw-方案" class="headerlink" title="6.2 vh、vw 方案"></a>6.2 vh、vw 方案</h3><p><code>vh、vw</code>方案即将视觉视口宽度 <code>window.innerWidth</code>和视觉视口高度 <code>window.innerHeight</code> 等分为 100 份。<br>上面的<code>flexible</code>方案就是模仿这种方案，因为早些时候<code>vw</code>还没有得到很好的兼容。</p>
<ul>
<li><code>vw(Viewport&#39;s width)</code>：<code>1vw</code>等于视觉视口的<code>1%</code></li>
<li><code>vh(Viewport&#39;s height)</code> :<code>1vh</code> 为视觉视口高度的<code>1%</code></li>
<li><code>vmin</code> : <code>vw</code> 和 <code>vh</code> 中的较小值</li>
<li><code>vmax</code> : 选取 <code>vw</code> 和 <code>vh</code> 中的较大值</li>
</ul>
<img src="/posts/32377/1562663933974-2774e9b9-f199-4b7b-9a22-24c3c8d4e2f8.webp" class="" title="1562663933974-2774e9b9-f199-4b7b-9a22-24c3c8d4e2f8">

<p>如果视觉视口为<code>375px</code>，那么<code>1vw = 3.75px</code>，这时<code>UI</code>给定一个元素的宽为<code>75px</code>（设备独立像素），我们只需要将它设置为<code>75 / 3.75 = 20vw</code>。<br>这里的比例关系我们也不用自己换算，我们可以使用<code>PostCSS</code>的 <code>postcss-px-to-viewport</code> 插件帮我们完成这个过程。写代码时，我们只需要根据<code>UI</code>给的设计图写<code>px</code>单位即可。<br>当然，没有一种方案是十全十美的，<code>vw</code>同样有一定的缺陷：</p>
<ul>
<li><p><code>px</code>转换成<code>vw</code>不一定能完全整除，因此有一定的像素差。</p>
</li>
<li><p>比如当容器使用<code>vw</code>，<code>margin</code>采用<code>px</code>时，很容易造成整体宽度超过<code>100vw</code>，从而影响布局效果。当然我们也是可以避免的，例如使用<code>padding</code>代替<code>margin</code>，结合<code>calc()</code>函数使用等等…</p>
<h2 id="七、适配-iPhoneX"><a href="#七、适配-iPhoneX" class="headerlink" title="七、适配 iPhoneX"></a>七、适配 iPhoneX</h2><p><code>iPhoneX</code>的出现将手机的颜值带上了一个新的高度，它取消了物理按键，改成了底部的小黑条，但是这样的改动给开发者适配移动端又增加了难度。</p>
<h3 id="7-1-安全区域"><a href="#7-1-安全区域" class="headerlink" title="7.1 安全区域"></a>7.1 安全区域</h3><p>在<code>iPhoneX</code>发布后，许多厂商相继推出了具有边缘屏幕的手机。</p>
<img src="/posts/32377/1562663934235-2e6e1f15-e88a-4475-bb3a-386397612345.webp" class="" title="1562663934235-2e6e1f15-e88a-4475-bb3a-386397612345">

<p>这些手机和普通手机在外观上无外乎做了三个改动：圆角（<code>corners</code>）、刘海（<code>sensor housing</code>）和小黑条（<code>Home Indicator</code>）。为了适配这些手机，安全区域这个概念变诞生了：安全区域就是一个不受上面三个效果的可视窗口范围。<br>为了保证页面的显示效果，我们必须把页面限制在安全范围内，但是不影响整体效果。</p>
<h3 id="7-2-viewport-fit"><a href="#7-2-viewport-fit" class="headerlink" title="7.2 viewport-fit"></a>7.2 viewport-fit</h3><p><code>viewport-fit</code>是专门为了适配<code>iPhoneX</code>而诞生的一个属性，它用于限制网页如何在安全区域内进行展示。</p>
<img src="/posts/32377/1562663934245-e0e7132e-cc64-4f7d-8def-800fc0d80f96.webp" class="" title="1562663934245-e0e7132e-cc64-4f7d-8def-800fc0d80f96">

<p><code>contain</code>: 可视窗口完全包含网页内容<br><code>cover</code>：网页内容完全覆盖可视窗口<br>默认情况下或者设置为<code>auto</code>和<code>contain</code>效果相同。</p>
<h3 id="7-3-env、constant"><a href="#7-3-env、constant" class="headerlink" title="7.3 env、constant"></a>7.3 env、constant</h3><img src="/posts/32377/1562663934329-142096f6-e341-4584-aac9-a1a4216e0758.webp" class="" title="1562663934329-142096f6-e341-4584-aac9-a1a4216e0758">

<p>我们需要将顶部和底部合理的摆放在安全区域内，<code>iOS11</code>新增了两个<code>CSS</code>函数<code>env、constant</code>，用于设定安全区域与边界的距离。<br>函数内部可以是四个常量：</p>
</li>
<li><p><code>safe-area-inset-left</code>：安全区域距离左边边界距离</p>
</li>
<li><p><code>safe-area-inset-right</code>：安全区域距离右边边界距离</p>
</li>
<li><p><code>safe-area-inset-top</code>：安全区域距离顶部边界距离</p>
</li>
<li><p><code>safe-area-inset-bottom</code>：安全区域距离底部边界距离</p>
</li>
</ul>
<p>注意：我们必须指定<code>viweport-fit</code>后才能使用这两个函数：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;viewport-fit=cover&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>constant</code>在<code>iOS &lt; 11.2</code>的版本中生效，<code>env</code>在<code>iOS &gt;= 11.2</code>的版本中生效，这意味着我们往往要同时设置他们，将页面限制在安全区域内：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="built_in">constant</span>(safe-area-inset-bottom);</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="built_in">env</span>(safe-area-inset-bottom);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当使用底部固定导航栏时，我们要为他们设置<code>padding</code>值：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="built_in">constant</span>(safe-area-inset-bottom);</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="built_in">env</span>(safe-area-inset-bottom);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、横屏适配"><a href="#八、横屏适配" class="headerlink" title="八、横屏适配"></a>八、横屏适配</h2><img src="/posts/32377/1562663934704-2a778c7d-532d-46ec-a0c6-c6358bcf89ab.webp" class="" title="1562663934704-2a778c7d-532d-46ec-a0c6-c6358bcf89ab">

<p>很多视口我们要对横屏和竖屏显示不同的布局，所以我们需要检测在不同的场景下给定不同的样式：</p>
<h3 id="8-1-JavaScript-检测横屏"><a href="#8-1-JavaScript-检测横屏" class="headerlink" title="8.1 JavaScript 检测横屏"></a>8.1 JavaScript 检测横屏</h3><p><code>window.orientation</code>:获取屏幕旋转方向</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&#x27;resize&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.orientation === <span class="number">180</span> || <span class="built_in">window</span>.orientation === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 正常方向或屏幕旋转180度</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;竖屏&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.orientation === <span class="number">90</span> || <span class="built_in">window</span>.orientation === -<span class="number">90</span>) &#123;</span><br><span class="line">    <span class="comment">// 屏幕顺时钟旋转90度或屏幕逆时针旋转90度</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;横屏&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="8-2-CSS-检测横屏"><a href="#8-2-CSS-检测横屏" class="headerlink" title="8.2 CSS 检测横屏"></a>8.2 CSS 检测横屏</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">orientation:</span> portrait) &#123;</span><br><span class="line">  <span class="comment">/*竖屏...*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">orientation:</span> landscape) &#123;</span><br><span class="line">  <span class="comment">/*横屏...*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="九、图片模糊问题"><a href="#九、图片模糊问题" class="headerlink" title="九、图片模糊问题"></a>九、图片模糊问题</h2><h3 id="9-1-产生原因"><a href="#9-1-产生原因" class="headerlink" title="9.1 产生原因"></a>9.1 产生原因</h3><p>我们平时使用的图片大多数都属于位图（<code>png、jpg...</code>），位图由一个个像素点构成的，每个像素都具有特定的位置和颜色值：</p>
<img src="/posts/32377/1562663934532-00e5a9f2-e8cd-431a-9489-c9260fbc3f62.webp" class="" title="1562663934532-00e5a9f2-e8cd-431a-9489-c9260fbc3f62">

<p>理论上，位图的每个像素对应在屏幕上使用一个物理像素来渲染，才能达到最佳的显示效果。<br>而在<code>dpr &gt; 1</code>的屏幕上，位图的一个像素可能由多个物理像素来渲染，然而这些物理像素点并不能被准确的分配上对应位图像素的颜色，只能取近似值，所以相同的图片在<code>dpr &gt; 1</code>的屏幕上就会模糊:</p>
<img src="/posts/32377/1562663934651-d204682e-6a9a-46c8-a106-9b50dc24068a.webp" class="" title="1562663934651-d204682e-6a9a-46c8-a106-9b50dc24068a">

<h3 id="9-2-解决方案"><a href="#9-2-解决方案" class="headerlink" title="9.2 解决方案"></a>9.2 解决方案</h3><p>为了保证图片质量，我们应该尽可能让一个屏幕像素来渲染一个图片像素，所以，针对不同<code>DPR</code>的屏幕，我们需要展示不同分辨率的图片。<br>如：在<code>dpr=2</code>的屏幕上展示两倍图<code>(@2x)</code>，在<code>dpr=3</code>的屏幕上展示三倍图<code>(@3x)</code>。</p>
<img src="/posts/32377/1562663934624-253cd638-f1d0-4849-b6d3-390583c89e6a.webp" class="" title="1562663934624-253cd638-f1d0-4849-b6d3-390583c89e6a">

<h3 id="9-3-media-查询"><a href="#9-3-media-查询" class="headerlink" title="9.3 media 查询"></a>9.3 media 查询</h3><p>使用<code>media</code>查询判断不同的设备像素比来显示不同精度的图片：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.avatar</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(conardLi_1x.png);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">-webkit-min-device-pixel-ratio:</span> <span class="number">2</span>) &#123;</span><br><span class="line">  <span class="selector-class">.avatar</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(conardLi_2x.png);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">-webkit-min-device-pixel-ratio:</span> <span class="number">3</span>) &#123;</span><br><span class="line">  <span class="selector-class">.avatar</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(conardLi_3x.png);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>只适用于背景图</p>
</blockquote>
<h3 id="9-4-image-set"><a href="#9-4-image-set" class="headerlink" title="9.4 image-set"></a>9.4 image-set</h3><p>使用<code>image-set</code>：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.avatar</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">-webkit-image-set</span>(</span><br><span class="line">    <span class="string">&#x27;conardLi_1x.png&#x27;</span> <span class="number">1</span>x,</span><br><span class="line">    <span class="string">&#x27;conardLi_2x.png&#x27;</span> <span class="number">2</span>x</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>只适用于背景图</p>
</blockquote>
<h3 id="9-5-srcset"><a href="#9-5-srcset" class="headerlink" title="9.5 srcset"></a>9.5 srcset</h3><p>使用<code>img</code>标签的<code>srcset</code>属性，浏览器会自动根据像素密度匹配最佳显示图片：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;conardLi_1x.png&quot;</span> <span class="attr">srcset</span>=<span class="string">&quot;conardLi_2x.png 2x, conardLi_3x.png 3x&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="9-6-JavaScript-拼接图片-url"><a href="#9-6-JavaScript-拼接图片-url" class="headerlink" title="9.6 JavaScript 拼接图片 url"></a>9.6 JavaScript 拼接图片 url</h3><p>使用<code>window.devicePixelRatio</code>获取设备像素比，遍历所有图片，替换图片地址：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> dpr = <span class="built_in">window</span>.devicePixelRatio;</span><br><span class="line"><span class="keyword">const</span> images = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">images.forEach(<span class="function"><span class="params">img</span> =&gt;</span> &#123;</span><br><span class="line">  img.src.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">`@<span class="subst">$&#123;dpr&#125;</span>x.`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="9-7-使用-svg"><a href="#9-7-使用-svg" class="headerlink" title="9.7 使用 svg"></a>9.7 使用 svg</h3><p><code>SVG</code>的全称是可缩放矢量图（<code>Scalable Vector Graphics</code>）。不同于位图的基于像素，<code>SVG</code> 则是属于对图像的形状描述，所以它本质上是文本文件，体积较小，且不管放大多少倍都不会失真。</p>
<img src="/posts/32377/1562663934758-01ec8c7b-d728-4aa2-9e7e-08e6b1c02ce0.webp" class="" title="1562663934758-01ec8c7b-d728-4aa2-9e7e-08e6b1c02ce0">

<p>除了我们手动在代码中绘制<code>svg</code>，我们还可以像使用位图一样使用<code>svg</code>图片：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;conardLi.svg&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;data:image/svg+xml;base64,[data]&quot;</span> /&gt;</span></span><br><span class="line">.avatar &#123; background: url(conardLi.svg); &#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><p><a href="https://link.juejin.im/?target=https://99designs.com/blog/tips/ppi-vs-dpi-whats-the-difference/">99designs.com/blog/tips/p…</a></p>
</li>
<li><p><a href="https://link.juejin.im/?target=https://www.w3cplus.com/css/vw-for-layout.html">www.w3cplus.com/css/vw-for-…</a></p>
</li>
<li><p><a href="https://link.juejin.im/?target=https://aotu.io/notes/2017/11/27/iphonex/index.html">aotu.io/notes/2017/…</a></p>
</li>
<li><p><a href="https://ac.qq.com/ComicView/index/id/536332/cid/254">分辨率小科普</a></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>希望你阅读本篇文章后可以达到以下几点：</p>
</li>
<li><p>理清移动端适配常用概念</p>
</li>
<li><p>理解移动端适配问题产生的原理，至少掌握一种解决方案</p>
</li>
</ul>
<h3 id="视口小结"><a href="#视口小结" class="headerlink" title="视口小结"></a>视口小结</h3><ul>
<li>书：布局视口，宽度不变（默认很大，980px）</li>
<li>放大镜：可视视口，近远相当于缩放页面，移动放大镜相当于滑动页面（默认宽度为手机屏幕宽度）</li>
<li>理想视口：布局视口在一个设备上的最佳尺寸，让用户不需要缩放就能很好的查看页面。宽度和可视视口相同，也就是手机屏幕宽度。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果不指定该属性，布局视口的宽度就是厂商的默认值，比如 980 或者其他，设置以后布局视口就成为理想视口，布局视口的宽度此时和可视视口宽度一致。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>布局</tag>
        <tag>技巧</tag>
        <tag>转载</tag>
        <tag>移动端</tag>
        <tag>适配</tag>
      </tags>
  </entry>
  <entry>
    <title>JS笔试题（面试系列）</title>
    <url>/posts/4115/</url>
    <content><![CDATA[<h2 id="JS-类型相关"><a href="#JS-类型相关" class="headerlink" title="JS 类型相关"></a>JS 类型相关</h2><h3 id="typeof-没定义的变量会报错吗？typeof-let-定义了的呢？"><a href="#typeof-没定义的变量会报错吗？typeof-let-定义了的呢？" class="headerlink" title="typeof 没定义的变量会报错吗？typeof let 定义了的呢？"></a>typeof 没定义的变量会报错吗？typeof let 定义了的呢？</h3><ul>
<li>未声明的变量使用 typeof 返回字符串 “undefined”</li>
<li>typeof 一个 let 定义的变量会因为暂时性死区报错 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ReferenceError">ReferenceError</a>（前提：let/const 未声明之前赋值或使用）</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> tmp = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  tmp = <span class="string">&#x27;abc&#x27;</span>; <span class="comment">// ReferenceError: tmp is not defined</span></span><br><span class="line">  <span class="keyword">let</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> tmp); <span class="comment">// ReferenceError: tmp is not defined</span></span><br><span class="line"><span class="keyword">let</span> tmp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> tmp;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> tmp); <span class="comment">// undefined 不会报错</span></span><br></pre></td></tr></table></figure>

<h3 id="typeof-的值有哪些"><a href="#typeof-的值有哪些" class="headerlink" title="typeof 的值有哪些"></a>typeof 的值有哪些</h3><p>7 种数据类型（返回的都是字符串形式）：</p>
<p>string, number, function, object, undefined, boolean, symbol（表独一无二的值）</p>
<p>注意：</p>
<ul>
<li>null 和 数组 返回的都是 object</li>
<li>NaN 返回的是 number</li>
</ul>
<h3 id="valueOf-和-toString"><a href="#valueOf-和-toString" class="headerlink" title="valueOf 和 toString"></a>valueOf 和 toString</h3><ul>
<li>toString(): 返回一个反映这个对象的字符串。</li>
<li>valueOf(): 返回它相应的原始值。</li>
</ul>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><h3 id="判断一个单词是否是回文"><a href="#判断一个单词是否是回文" class="headerlink" title="判断一个单词是否是回文"></a>判断一个单词是否是回文</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;mamam&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkPalindrom</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str === str.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证回文字符串"><a href="#验证回文字符串" class="headerlink" title="验证回文字符串"></a>验证回文字符串</h3><p>给定一个字符串，验证它是否是回文串，只考虑字母和数字字符，可以忽略字母的大小写。</p>
<ul>
<li><strong>输入:</strong> “A man, a plan, a canal: Panama” <strong>输出:</strong> true</li>
<li><strong>输入:</strong> “race a car” <strong>输出:</strong> false</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;A man, a plan, a canal: Panama&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> isPalindrome = <span class="function"><span class="keyword">function</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> reg = <span class="regexp">/[^A-Za-z0-9]/g</span>;</span><br><span class="line">  <span class="keyword">var</span> tempStr = s.replace(reg, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> reverseStr = tempStr.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> reverseStr.toLowerCase() === tempStr.toLowerCase();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(isPalindrome(str));</span><br></pre></td></tr></table></figure>

<h3 id="统计字符串出现最多的字母"><a href="#统计字符串出现最多的字母" class="headerlink" title="统计字符串出现最多的字母"></a>统计字符串出现最多的字母</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;afjghdfraaaasdenas&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findMaxDuplicateChar</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (str.length == <span class="number">1</span>) <span class="keyword">return</span> str;</span><br><span class="line">  <span class="keyword">let</span> charObj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!charObj[str.charAt(i)]) &#123;</span><br><span class="line">      charObj[str.charAt(i)] = <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      charObj[str.charAt(i)] += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> maxChar = <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    maxValue = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> charObj) &#123;</span><br><span class="line">    <span class="keyword">if</span> (charObj[key] &gt;= maxValue) &#123;</span><br><span class="line">      maxChar = key;</span><br><span class="line">      maxValue = charObj[key];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> maxChar;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="字符串中的第一个唯一字符"><a href="#字符串中的第一个唯一字符" class="headerlink" title="字符串中的第一个唯一字符"></a>字符串中的第一个唯一字符</h3><p>给定一个字符串，找到它的第一个不重复的字符，并返回它的索引。如果不存在，则返回 -1。</p>
<ul>
<li>s = “leetcode” 返回 0.</li>
<li>s = “loveleetcode” 返回 2.</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;leetcode&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">firstUniqChar</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> curChar = str[i];</span><br><span class="line">    <span class="keyword">if</span> (str.lastIndexOf(curChar) === str.indexOf(curChar)) &#123;</span><br><span class="line">      <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(firstUniqChar(str));</span><br></pre></td></tr></table></figure>

<h3 id="有效的字母异位词"><a href="#有效的字母异位词" class="headerlink" title="有效的字母异位词"></a>有效的字母异位词</h3><p>即判断字符串中是否只有字符的位置不同，也就是判断两个字符串中包含的字符以及这些字符出现的次数是否相同</p>
<ul>
<li><strong>输入:</strong> <em>s</em> = “anagram”, <em>t</em> = “nagaram” <strong>输出:</strong> true</li>
<li><strong>输入:</strong> <em>s</em> = “rat”, <em>t</em> = “car” <strong>输出:</strong> false</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">&#x27;anagram&#x27;</span>,</span><br><span class="line">  t = <span class="string">&#x27;nagaram&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAnagram</span>(<span class="params">s, t</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (s.length !== t.length) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">var</span> ss = s.split(<span class="string">&#x27;&#x27;</span>).sort().join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> tt = t.split(<span class="string">&#x27;&#x27;</span>).sort().join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> ss === tt ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(isAnagram(s, t));</span><br></pre></td></tr></table></figure>

<h3 id="判断一个给定的字符串是否是同构的"><a href="#判断一个给定的字符串是否是同构的" class="headerlink" title="判断一个给定的字符串是否是同构的"></a>判断一个给定的字符串是否是同构的</h3><blockquote>
<p>输入: s = “egg”, t = “add”<br>输出: true<br>输入: s = “foo”, t = “bar”<br>输出: false</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> isIsomorphic = <span class="function"><span class="keyword">function</span> (<span class="params">s, t</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (i &lt; s.length) &#123;</span><br><span class="line">    <span class="keyword">if</span> (s.indexOf(s[i]) != t.indexOf(t[i])) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="报数"><a href="#报数" class="headerlink" title="报数"></a>报数</h3><p>报数序列是一个整数序列，按照其中的整数的顺序进行报数，得到下一个数。其前五项如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.     1</span><br><span class="line">2.     11</span><br><span class="line">3.     21</span><br><span class="line">4.     1211</span><br><span class="line">5.     111221</span><br></pre></td></tr></table></figure>

<p><code>1</code> 被读作 <code>&quot;one 1&quot;</code> (<code>&quot;一个一&quot;</code>) , 即 <code>11</code>。</p>
<p><code>11</code> 被读作 <code>&quot;two 1s&quot;</code> (<code>&quot;两个一&quot;</code>）, 即 <code>21</code>。</p>
<p><code>21</code> 被读作 <code>&quot;one 2&quot;</code>, “<code>one 1&quot;</code> （<code>&quot;一个二&quot;</code> , <code>&quot;一个一&quot;</code>) , 即 <code>1211</code>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> countAndSay = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 从1开始报数</span></span><br><span class="line">  <span class="keyword">var</span> result = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">  <span class="comment">// 循环第 N 次</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">    <span class="comment">// 默认当前连续的数字的次数为1</span></span><br><span class="line">    <span class="keyword">var</span> repeatCount = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 循环当前数字</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; result.length; j++) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(result[j], result[j + <span class="number">1</span>]);</span><br><span class="line">      <span class="comment">// 当前数字和后面一个是否相同，相同则重复数计数+1</span></span><br><span class="line">      <span class="keyword">if</span> (result[j] === result[j + <span class="number">1</span>]) &#123;</span><br><span class="line">        repeatCount++;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 否则就把到目前为止的报数“读出来”</span></span><br><span class="line">        str += repeatCount + result[j];</span><br><span class="line">        repeatCount = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 当前第N次报数的结果，下次报数以此为准</span></span><br><span class="line">    result = str;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="最长公共前缀"><a href="#最长公共前缀" class="headerlink" title="最长公共前缀"></a>最长公共前缀</h3><p>编写一个函数来查找字符串数组中的最长公共前缀。如果不存在公共前缀，返回空字符串 <code>&quot;&quot;</code>。</p>
<ul>
<li><strong>输入:</strong> [“flower”,”flow”,”flight”] <strong>输出:</strong> “fl”</li>
<li><strong>输入:</strong> [“dog”,”racecar”,”car”] <strong>输出:</strong> “”</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">&#x27;flower&#x27;</span>, <span class="string">&#x27;flow&#x27;</span>, <span class="string">&#x27;flight&#x27;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">longestCommonPrefix</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!arr.length) <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> firstStr = arr[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">var</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; firstStr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">1</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (firstStr[i] !== arr[j][i]) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    result += firstStr[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(longestCommonPrefix(arr));</span><br></pre></td></tr></table></figure>

<h3 id="生成指定长度的随机字母数字字符串"><a href="#生成指定长度的随机字母数字字符串" class="headerlink" title="生成指定长度的随机字母数字字符串"></a>生成指定长度的随机字母数字字符串</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomStr</span>(<span class="params">len</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> str = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    str += <span class="built_in">Math</span>.random().toString(<span class="number">36</span>).substring(<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str.substring(<span class="number">0</span>, len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何把一个字符串的大小写取反（大写变小写小写变大写），例如-’AbC’-变成-‘aBc’"><a href="#如何把一个字符串的大小写取反（大写变小写小写变大写），例如-’AbC’-变成-‘aBc’" class="headerlink" title="如何把一个字符串的大小写取反（大写变小写小写变大写），例如 ’AbC’ 变成 ‘aBc’"></a>如何把一个字符串的大小写取反（大写变小写小写变大写），例如 ’AbC’ 变成 ‘aBc’</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方法一：常规</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transformStr</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> tempArr = str.split(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">let</span> result = tempArr.map(<span class="function"><span class="params">char</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> char === char.toUpperCase()</span><br><span class="line">      ? char.toLowerCase()</span><br><span class="line">      : char.toUpperCase();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result.join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(transformStr(<span class="string">&#x27;aBc&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二：正则</span></span><br><span class="line"><span class="string">&#x27;aBc&#x27;</span>.replace(<span class="regexp">/[A-Za-z]/g</span>, <span class="function"><span class="params">char</span> =&gt;</span></span><br><span class="line">  char === char.toUpperCase() ? char.toLowerCase() : char.toUpperCase()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>题目来源：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/116">Daily-Interview-Question 第 69 题</a></p>
<h3 id="实现一个字符串匹配算法，从长度为-n-的字符串-S-中，查找是否存在字符串-T，T-的长度是-m，若存在返回所在位置。"><a href="#实现一个字符串匹配算法，从长度为-n-的字符串-S-中，查找是否存在字符串-T，T-的长度是-m，若存在返回所在位置。" class="headerlink" title="实现一个字符串匹配算法，从长度为 n 的字符串 S 中，查找是否存在字符串 T，T 的长度是 m，若存在返回所在位置。"></a>实现一个字符串匹配算法，从长度为 n 的字符串 S 中，查找是否存在字符串 T，T 的长度是 m，若存在返回所在位置。</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> find = <span class="function">(<span class="params">S, T</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (S.length &lt; T.length) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; S.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (S.slice(i, i + T.length) === T) <span class="keyword">return</span> i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="用-JavaScript-写一个函数，输入-int-型，返回整数逆序后的字符串。如：输入整型-1234，返回字符串“4321”。要求必须使用递归函数调用，不能用全局变量，输入函数必须只有一个参数传入，必须返回字符串。"><a href="#用-JavaScript-写一个函数，输入-int-型，返回整数逆序后的字符串。如：输入整型-1234，返回字符串“4321”。要求必须使用递归函数调用，不能用全局变量，输入函数必须只有一个参数传入，必须返回字符串。" class="headerlink" title="用 JavaScript 写一个函数，输入 int 型，返回整数逆序后的字符串。如：输入整型 1234，返回字符串“4321”。要求必须使用递归函数调用，不能用全局变量，输入函数必须只有一个参数传入，必须返回字符串。"></a>用 JavaScript 写一个函数，输入 int 型，返回整数逆序后的字符串。如：输入整型 1234，返回字符串“4321”。要求必须使用递归函数调用，不能用全局变量，输入函数必须只有一个参数传入，必须返回字符串。</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> str = num + <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (str.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> newStr = str.substring(str.length - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> oldStr = str.substring(<span class="number">0</span>, str.length - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> newStr + test(oldStr);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(test(<span class="number">123</span>));</span><br></pre></td></tr></table></figure>

<h3 id="找出字符串中连续出现最多的字符和个数"><a href="#找出字符串中连续出现最多的字符和个数" class="headerlink" title="找出字符串中连续出现最多的字符和个数"></a>找出字符串中连续出现最多的字符和个数</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;abcaakjbb&#x27;</span> =&gt; &#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;b&#x27;</span>:<span class="number">2</span>&#125;</span><br><span class="line"><span class="string">&#x27;abbkejsbcccwqaa&#x27;</span> =&gt; &#123;<span class="string">&#x27;c&#x27;</span>:<span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>

<p>解答：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;abcaakjbb&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findLongest</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!str || <span class="keyword">typeof</span> str !== <span class="string">&#x27;string&#x27;</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;&#125;,</span><br><span class="line">    maxCount = <span class="number">0</span>, <span class="comment">// 最大连续次数</span></span><br><span class="line">    curCount = <span class="number">1</span>; <span class="comment">// 当前连续次数（默认最小连续次数为1）</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> curChar = str[i]; <span class="comment">// 当前字符</span></span><br><span class="line">    <span class="keyword">if</span> (curChar === str[i + <span class="number">1</span>]) &#123;</span><br><span class="line">      <span class="comment">// 如果连续</span></span><br><span class="line">      ++curCount; <span class="comment">// 当前连续次数+1</span></span><br><span class="line">      <span class="keyword">if</span> (maxCount &lt; curCount) &#123;</span><br><span class="line">        maxCount = curCount;</span><br><span class="line">        obj = &#123; [curChar]: maxCount &#125;; <span class="comment">// 只要当前连续次数比之前的大，就直接覆盖obj</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (maxCount === curCount) &#123;</span><br><span class="line">        <span class="comment">// 有可能若干字符连续次数相同，那么追加到obj</span></span><br><span class="line">        obj[curChar] = maxCount;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 如果不连续</span></span><br><span class="line">      curCount = <span class="number">1</span>; <span class="comment">// 重置连续次数</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(findLongest(str));</span><br></pre></td></tr></table></figure>

<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><h3 id="判断数组的方法"><a href="#判断数组的方法" class="headerlink" title="判断数组的方法"></a>判断数组的方法</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">arr <span class="keyword">instanceof</span> <span class="built_in">Array</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(arr) === <span class="string">&#x27;[object Array]&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.isArray(arr);</span><br><span class="line"></span><br><span class="line">arr.constructor === <span class="built_in">Array</span>; <span class="comment">// 前提是保证 constructor 不会被更改</span></span><br><span class="line"><span class="comment">// 不能使用 typeof 因为 它返回的是个 &#x27;object&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="JS-数组去重"><a href="#JS-数组去重" class="headerlink" title="JS 数组去重"></a>JS 数组去重</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="literal">NaN</span>, <span class="literal">NaN</span>, &#123;&#125;, <span class="literal">NaN</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法1：indexOf去重（无法对 对象，NaN 识别去重）</span></span><br><span class="line"><span class="comment">// → indexOf 不认 NaN，遇到NaN就返回 -1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myDistinct</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (result.indexOf(arr[i]) === -<span class="number">1</span>) &#123;</span><br><span class="line">      result.push(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 返回数组：[ 1, &#x27;1&#x27;, NaN, NaN, &#123;&#125;, &#123;&#125;, NaN ]</span></span><br><span class="line"><span class="comment">// 原数组：[ 1, 1, &#x27;1&#x27;, &#x27;1&#x27;, NaN, NaN, &#123;&#125;, &#123;&#125;, NaN ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：filter + indexOf（对 对象 和 NaN 无效）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myDistinct</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = arr.filter(<span class="function">(<span class="params">item, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 重复的值的索引肯定大于第一次出现这个值的索引，不会被返回</span></span><br><span class="line">    <span class="keyword">return</span> arr.indexOf(item) === index;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 返回数组：[ 1, &#x27;1&#x27;, &#123;&#125;, &#123;&#125; ]</span></span><br><span class="line"><span class="comment">// 原数组：[ 1, 1, &#x27;1&#x27;, &#x27;1&#x27;, NaN, NaN, &#123;&#125;, &#123;&#125;, NaN ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法3：filter 升级版（解决了 对象 和 NaN 的问题）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myDistinct</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> arr.filter(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 由于对象的键值只能是字符串，导致 1 和 &#x27;1&#x27; 被认为是相同的值，所以下方使用 typeof item + item 拼成字符串作为 key 值来避免这个问题</span></span><br><span class="line">    <span class="keyword">return</span> obj.hasOwnProperty(<span class="keyword">typeof</span> item + <span class="built_in">JSON</span>.stringify(item))</span><br><span class="line">      ? <span class="literal">false</span></span><br><span class="line">      : (obj[<span class="keyword">typeof</span> item + <span class="built_in">JSON</span>.stringify(item)] = <span class="literal">true</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 返回数组：[ 1, &#x27;1&#x27;, NaN, &#123;&#125; ]</span></span><br><span class="line"><span class="comment">// 原数组：[ 1, 1, &#x27;1&#x27;, &#x27;1&#x27;, NaN, NaN, &#123;&#125;, &#123;&#125;, NaN ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法4：for循环（解决了 对象 和 NaN 的问题）</span></span><br><span class="line">~(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="literal">NaN</span>, <span class="literal">NaN</span>, &#123;&#125;, <span class="literal">NaN</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> prop = <span class="built_in">Array</span>.prototype;</span><br><span class="line">  prop.myDistinct = <span class="function"><span class="keyword">function</span> <span class="title">myDistinct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> hash = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> temp = <span class="keyword">typeof</span> <span class="built_in">this</span>[i] + <span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>[i]);</span><br><span class="line">      <span class="keyword">if</span> (hash[temp]) &#123;</span><br><span class="line">        <span class="built_in">this</span>[i] = <span class="built_in">this</span>[<span class="built_in">this</span>.length - <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">this</span>.length--;</span><br><span class="line">        i--;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      hash[temp] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">console</span>.log(arr.myDistinct());</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法5：ES6 Set去重（能应对NaN重复，对对象无效）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myDistinct</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [...new <span class="built_in">Set</span>(arr)];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="两个数组比较，判断是否有相同元素（交集）"><a href="#两个数组比较，判断是否有相同元素（交集）" class="headerlink" title="两个数组比较，判断是否有相同元素（交集）"></a>两个数组比较，判断是否有相同元素（交集）</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> nums1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="literal">NaN</span>, &#123;&#125;];</span><br><span class="line"><span class="keyword">var</span> nums2 = [<span class="number">2</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="literal">NaN</span>, &#123;&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法1：filter + indexOf（不支持 NaN 和 &#123;&#125;）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">intersect</span>(<span class="params">nums1, nums2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> nums1.filter(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> index = nums2.indexOf(v);</span><br><span class="line">    <span class="keyword">if</span> (index &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">      nums2.splice(index, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(intersect(nums1, nums2));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：filter + indexOf（支持 NaN，不支持 &#123;&#125;）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">intersect</span>(<span class="params">nums1, nums2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> aHasNaN = nums1.some(<span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">isNaN</span>(v));</span><br><span class="line">  <span class="keyword">const</span> bHasNaN = nums2.some(<span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">isNaN</span>(v));</span><br><span class="line">  <span class="keyword">return</span> nums1</span><br><span class="line">    .filter(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> index = nums2.indexOf(v);</span><br><span class="line">      <span class="keyword">if</span> (index &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        nums2.splice(index, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .concat(aHasNaN &amp;&amp; bHasNaN ? [<span class="literal">NaN</span>] : []);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(intersect(nums1, nums2));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法3：哈希表（支持 NaN，&#123;&#125;）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">intersect</span>(<span class="params">nums1, nums2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> map = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> res = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> n <span class="keyword">of</span> nums1) &#123;</span><br><span class="line">    <span class="keyword">if</span> (map[n]) &#123;</span><br><span class="line">      map[n]++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      map[n] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> n <span class="keyword">of</span> nums2) &#123;</span><br><span class="line">    <span class="keyword">if</span> (map[n] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      res.push(n);</span><br><span class="line">      map[n]--;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(intersect(nums1, nums2));</span><br></pre></td></tr></table></figure>

<h3 id="如何实现数组的随机排序？"><a href="#如何实现数组的随机排序？" class="headerlink" title="如何实现数组的随机排序？"></a>如何实现数组的随机排序？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法1：随机交换数组内的元素</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">result</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="comment">// 随机索引【Math.random()返回一个浮点,  伪随机数在范围[0，1)】</span></span><br><span class="line">    <span class="keyword">let</span> randomIndex = <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * arr.length);</span><br><span class="line">    <span class="comment">// 存下当前正常索引值对应的数字</span></span><br><span class="line">    <span class="keyword">let</span> curNum = arr[i];</span><br><span class="line">    <span class="comment">// 将其重新赋值为随机索引对应的数字</span></span><br><span class="line">    arr[i] = arr[randomIndex];</span><br><span class="line">    <span class="comment">// 将随机索引对应的数字替换为当前正常索引值对应的数字</span></span><br><span class="line">    arr[randomIndex] = curNum;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：sort() 可以调用一个函数做为参数，如果这个函数返回的值为负数表示数组中的 a 项排在 b 项前</span></span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.random() - <span class="number">0.5</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br></pre></td></tr></table></figure>

<h3 id="找出正数组中的最大差值"><a href="#找出正数组中的最大差值" class="headerlink" title="找出正数组中的最大差值"></a>找出正数组中的最大差值</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">10</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]; <span class="comment">// 11-5=6</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMaxProfit</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> min = (max = arr[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    min = min &lt;= arr[i] ? min : arr[i];</span><br><span class="line">    max = max &gt;= arr[i] ? max : arr[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.abs(max - min);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从排序数组中删除重复项"><a href="#从排序数组中删除重复项" class="headerlink" title="从排序数组中删除重复项"></a>从排序数组中删除重复项</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 若 nums = [1,1,2], 则函数应返回长度 2, 并且原数组 nums 的前两个元素被修改为 1, 2。</span></span><br><span class="line"><span class="comment">// 若 nums = [0,0,1,1,1,2,2,3,3,4], 则返回 5, 并且原数组被修改为 0, 1, 2, 3, 4。</span></span><br><span class="line"><span class="keyword">var</span> nums = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeDuplicates</span>(<span class="params">nums</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums[i - <span class="number">1</span>] === nums[i]) &#123;</span><br><span class="line">      nums.splice(i - <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">      i--;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> nums.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="找出数组中出现次数最多的元素，并给出其出现过的位置"><a href="#找出数组中出现次数最多的元素，并给出其出现过的位置" class="headerlink" title="找出数组中出现次数最多的元素，并给出其出现过的位置"></a>找出数组中出现次数最多的元素，并给出其出现过的位置</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> bestItem,</span><br><span class="line">    indexs = [],</span><br><span class="line">    obj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = arr.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> item = arr[i].toString();</span><br><span class="line">    obj[item] ? obj[item].push(i) : (obj[item] = [].concat([i]));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> tempArr = <span class="built_in">Object</span>.entries(obj);</span><br><span class="line">  bestItem = <span class="built_in">parseInt</span>(tempArr[<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">  indexs = tempArr[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> tempArr) &#123;</span><br><span class="line">    <span class="keyword">if</span> (indexs.length &lt; value.length) &#123;</span><br><span class="line">      bestItem = <span class="built_in">parseInt</span>(key);</span><br><span class="line">      indexs = value;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; bestItem, indexs &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fn(arr));</span><br></pre></td></tr></table></figure>

<h3 id="数组扁平化"><a href="#数组扁平化" class="headerlink" title="数组扁平化"></a>数组扁平化</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(arr[i])) &#123;</span><br><span class="line">      result = result.concat(flatten(arr[i]));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result = result.concat(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.flat = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [].concat(</span><br><span class="line">    ...this.map(<span class="function"><span class="params">item</span> =&gt;</span> (<span class="built_in">Array</span>.isArray(item) ? item.flat() : [item]))</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = [<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]]];</span><br><span class="line"><span class="built_in">console</span>.log(flatten(a));</span><br><span class="line"><span class="built_in">console</span>.log(a.flat());</span><br></pre></td></tr></table></figure>

<h3 id="将数组扁平化并去除其中重复数据，最终得到一个升序且不重复的数组"><a href="#将数组扁平化并去除其中重复数据，最终得到一个升序且不重复的数组" class="headerlink" title="将数组扁平化并去除其中重复数据，最终得到一个升序且不重复的数组"></a>将数组扁平化并去除其中重复数据，最终得到一个升序且不重复的数组</h3><blockquote>
<p>已知如下数组：</p>
<p>var arr = [ [1, 2, 2], [3, 4, 5, 5], [6, 7, 8, 9, [11, 12, [12, 13, [14] ] ] ], 10];</p>
<p>编写一个程序将数组扁平化去并除其中重复部分数据，最终得到一个升序且不重复的数组</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="comment">// 扁平化数组</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.flat = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [].concat(</span><br><span class="line">    ...this.map(<span class="function"><span class="params">item</span> =&gt;</span> (<span class="built_in">Array</span>.isArray(item) ? item.flat() : [item]))</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 数组去重</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [...new <span class="built_in">Set</span>(<span class="built_in">this</span>)];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 数组排序</span></span><br><span class="line"><span class="keyword">const</span> sort = <span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b;</span><br><span class="line"><span class="built_in">console</span>.log(arr.flat().unique().sort(sort));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ===========================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.flat = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.toString()</span><br><span class="line">    .split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    .map(<span class="function"><span class="params">v</span> =&gt;</span> +v);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.filter(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> tempItem = <span class="keyword">typeof</span> item + <span class="built_in">JSON</span>.stringify(item);</span><br><span class="line">    <span class="keyword">return</span> obj.hasOwnProperty(tempItem) ? <span class="literal">false</span> : (obj[tempItem] = <span class="literal">true</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> sort = <span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b;</span><br><span class="line"><span class="built_in">console</span>.log(arr.flat().unique().sort(sort));</span><br></pre></td></tr></table></figure>

<h3 id="使用迭代的方式实现-flatten-函数"><a href="#使用迭代的方式实现-flatten-函数" class="headerlink" title="使用迭代的方式实现 flatten 函数"></a>使用迭代的方式实现 flatten 函数</h3><blockquote>
<p>迭代实现</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, [<span class="number">6</span>, <span class="number">7</span>], <span class="number">8</span>], <span class="number">9</span>, <span class="number">10</span>, [<span class="number">11</span>, [<span class="number">12</span>, <span class="number">13</span>]]];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> flatten = <span class="function"><span class="keyword">function</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (arr.some(<span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">Array</span>.isArray(v))) &#123;</span><br><span class="line">    arr = [].concat(...arr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>递归实现</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> flatten = <span class="function"><span class="keyword">function</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [].concat(...arr.map(<span class="function"><span class="params">v</span> =&gt;</span> (<span class="built_in">Array</span>.isArray(v) ? flatten(v) : [v])));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>字符串转换</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr</span><br><span class="line">    .join(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    .split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    .map(<span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">Number</span>(v));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="买卖股票的最佳时机"><a href="#买卖股票的最佳时机" class="headerlink" title="买卖股票的最佳时机"></a>买卖股票的最佳时机</h3><p>给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。</p>
<p>设计一个算法来计算你所能获取的最大利润。你可以尽可能地完成更多的交易（多次买卖一支股票）。</p>
<p><strong>注意</strong>：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。</p>
<p>输入: [7,1,5,3,6,4] 输出: 7</p>
<p>解释: 在第 2 天（股票价格 = 1）的时候买入，在第 3 天（股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。随后，在第 4 天（股票价格 = 3）的时候买入，在第 5 天（股票价格 = 6）的时候卖出, 这笔交易所能获得利润 = 6-3 = 3 。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">7</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">maxProfit</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> income = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>, len = arr.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> gap = arr[i] - arr[i - <span class="number">1</span>]; <span class="comment">// 后一个与前一个比较，大于零则赚</span></span><br><span class="line">    <span class="keyword">if</span> (gap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      income += gap;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> income;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(maxProfit(arr));</span><br></pre></td></tr></table></figure>

<h3 id="旋转数组"><a href="#旋转数组" class="headerlink" title="旋转数组"></a>旋转数组</h3><p>给定一个数组，将数组中的元素向右移动 k 个位置，其中 k 是非负数。</p>
<p>输入: [1,2,3,4,5,6,7] 和 k = 3 输出: [5,6,7,1,2,3,4]</p>
<p>解释:</p>
<p>向右旋转 1 步: [7,1,2,3,4,5,6]</p>
<p>向右旋转 2 步: [6,7,1,2,3,4,5]</p>
<p>向右旋转 3 步: [5,6,7,1,2,3,4]</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rotate</span>(<span class="params">arr, k</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> temp = arr.pop();</span><br><span class="line">    arr.unshift(temp);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(rotate(arr, <span class="number">3</span>));</span><br></pre></td></tr></table></figure>

<h3 id="判断数组是否存在重复"><a href="#判断数组是否存在重复" class="headerlink" title="判断数组是否存在重复"></a>判断数组是否存在重复</h3><p>给定一个整数数组，判断是否存在重复元素。</p>
<p>如果任何值在数组中出现至少两次，函数返回 true。如果数组中每个元素都不相同，则返回 false。</p>
<p>输入: [1,2,3,1] 输出: true</p>
<p>输入: [1,2,3,4] 输出: false</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">containsDuplicate</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = arr.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj[arr[i]]) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      obj[arr[i]] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">containsDuplicate</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [...new <span class="built_in">Set</span>(arr)].length !== arr.length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(containsDuplicate(arr));</span><br></pre></td></tr></table></figure>

<h3 id="找出只出现一次的数字"><a href="#找出只出现一次的数字" class="headerlink" title="找出只出现一次的数字"></a>找出只出现一次的数字</h3><p>给定一个非空整数数组，除了某个元素只出现一次以外，其余每个元素均出现两次。找出那个只出现了一次的元素。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">singleNumber</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> tempArr = arr;</span><br><span class="line">  tempArr.sort();</span><br><span class="line">  <span class="keyword">var</span> onceNumber = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = tempArr.length - <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (tempArr[i] !== tempArr[i + <span class="number">1</span>]) &#123;</span><br><span class="line">      onceNumber = tempArr[i];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ++i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 有可能排序后最后一个才是单着的数字，所以直接赋值为数组最后一个值</span></span><br><span class="line">  <span class="keyword">return</span> onceNumber !== <span class="literal">null</span> ? onceNumber : tempArr[tempArr.length - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">singleNumber</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> a = [...new <span class="built_in">Set</span>(arr)].reduce(<span class="function">(<span class="params">total, cur</span>) =&gt;</span> total + cur, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> b = arr.reduce(<span class="function">(<span class="params">total, cur</span>) =&gt;</span> total + cur, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span> * a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(singleNumber(arr));</span><br></pre></td></tr></table></figure>

<h3 id="加一"><a href="#加一" class="headerlink" title="加一"></a>加一</h3><p>给定一个由<strong>整数</strong>组成的<strong>非空</strong>数组所表示的非负整数，在该数的基础上加一。</p>
<p>最高位数字存放在数组的首位， 数组中每个元素只存储一个数字。</p>
<p>你可以假设除了整数 0 之外，这个整数不会以零开头。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">输入: [1,2,3]</span><br><span class="line">输出: [1,2,4]</span><br><span class="line">解释: 输入数组表示数字 123。</span><br></pre></td></tr></table></figure>

<p><strong>示例 2:</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">输入: [4,3,2,1]</span><br><span class="line">输出: [4,3,2,2]</span><br><span class="line">解释: 输入数组表示数字 4321。</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>]; <span class="comment">// 预期：[1, 0, 0, 0]</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">plusOne</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> count = arr.length - <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// 从末尾往前倒</span></span><br><span class="line">  <span class="keyword">while</span> (count &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// 只要当前位+1大于9，就把当前位置为0，count--</span></span><br><span class="line">    <span class="keyword">if</span> (arr[count] + <span class="number">1</span> &gt; <span class="number">9</span>) &#123;</span><br><span class="line">      arr[count] = <span class="number">0</span>;</span><br><span class="line">      count--;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 一旦当前位+1不大于9，就放心+1，且直接退出，不用再算更高位的了</span></span><br><span class="line">      arr[count]++;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果while后，第一位还是0，证明这个数组所有数字都为9.这个时候往数组最前面加个1就好</span></span><br><span class="line">  <span class="keyword">if</span> (arr[<span class="number">0</span>] === <span class="number">0</span>) &#123;</span><br><span class="line">    arr.unshift(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(plusOne(arr));</span><br></pre></td></tr></table></figure>

<h3 id="移动零"><a href="#移动零" class="headerlink" title="移动零"></a>移动零</h3><p>给定一个数组 <code>nums</code>，编写一个函数将所有 <code>0</code> 移动到数组的末尾，同时保持非零元素的相对顺序。</p>
<p><strong>示例:</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">输入: [0,1,0,3,12]</span><br><span class="line">输出: [1,3,12,0,0]</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">12</span>]; <span class="comment">// 预期：[ 1, 3, 12, 0, 0 ]</span></span><br><span class="line"><span class="keyword">var</span> moveZeroes = <span class="function"><span class="keyword">function</span> (<span class="params">nums</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 长度提取出来</span></span><br><span class="line">  <span class="keyword">var</span> len = nums.length;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="comment">// 从头往后遍历，遇到0则删掉追放到尾部，</span></span><br><span class="line">    <span class="comment">// 同时让i--，因为头部删了个0；同时len--，因为不再判断追加后的</span></span><br><span class="line">    <span class="keyword">if</span> (nums[i] === <span class="number">0</span>) &#123;</span><br><span class="line">      nums.splice(i, <span class="number">1</span>);</span><br><span class="line">      nums.push(<span class="number">0</span>);</span><br><span class="line">      i--;</span><br><span class="line">      len--;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> nums;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(moveZeroes(arr));</span><br></pre></td></tr></table></figure>

<h3 id="某公司-1-到-12-月份的销售额存在一个对象里面"><a href="#某公司-1-到-12-月份的销售额存在一个对象里面" class="headerlink" title="某公司 1 到 12 月份的销售额存在一个对象里面"></a>某公司 1 到 12 月份的销售额存在一个对象里面</h3><p>如下：{1:222, 2:123, 5:888}，请把数据处理为如下结构：[222, 123, null, null, 888, null, null, null, null, null, null, null]。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// for循环</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="number">1</span>: <span class="number">222</span>, <span class="number">2</span>: <span class="number">123</span>, <span class="number">5</span>: <span class="number">888</span> &#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arr = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">12</span>; i++) &#123;</span><br><span class="line">    obj[i] ? arr.push(obj[i]) : arr.push(<span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fn(obj));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Array.from</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="number">1</span>: <span class="number">222</span>, <span class="number">2</span>: <span class="number">123</span>, <span class="number">5</span>: <span class="number">888</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> result = <span class="built_in">Array</span>.from(&#123; <span class="attr">length</span>: <span class="number">12</span> &#125;).map(</span><br><span class="line">  (_, index) =&gt; obj[index + <span class="number">1</span>] || <span class="literal">null</span></span><br><span class="line">);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>

<h3 id="两数之和"><a href="#两数之和" class="headerlink" title="两数之和"></a>两数之和</h3><p>给定一个整数数组 <code>nums</code> 和一个目标值 <code>target</code>，请你在该数组中找出和为目标值的那 <strong>两个</strong> 整数，并返回他们的数组下标。</p>
<p>你可以假设每种输入只会对应一个答案。但是，你不能重复利用这个数组中同样的元素。</p>
<p><strong>示例:</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">给定 nums = [2, 7, 11, 15], target = 9</span><br><span class="line"></span><br><span class="line">因为 nums[0] + nums[1] = 2 + 7 = 9</span><br><span class="line">所以返回 [0, 1]</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> nums = [<span class="number">2</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>],</span><br><span class="line">  target = <span class="number">9</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">twoSum</span>(<span class="params">nums, target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> num = nums[i];</span><br><span class="line">    <span class="comment">// 第二个数索引</span></span><br><span class="line">    <span class="keyword">const</span> targetIndex = nums.indexOf(target - num);</span><br><span class="line">    <span class="comment">// 确保存在第二个数，且不为当前遍历的数</span></span><br><span class="line">    <span class="keyword">if</span> (targetIndex &gt; -<span class="number">1</span> &amp;&amp; targetIndex !== i) &#123;</span><br><span class="line">      <span class="keyword">return</span> [i, targetIndex];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(twoSum(nums, target));</span><br></pre></td></tr></table></figure>

<h3 id="旋转图像"><a href="#旋转图像" class="headerlink" title="旋转图像"></a>旋转图像</h3><p>给定一个 <em>n</em> × <em>n</em> 的二维矩阵表示一个图像。</p>
<p>将图像顺时针旋转 90 度。</p>
<p><strong>说明：</strong></p>
<p>你必须在<strong>原地</strong>旋转图像，这意味着你需要直接修改输入的二维矩阵。<strong>请不要</strong>使用另一个矩阵来旋转图像。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">给定 matrix =</span><br><span class="line">[</span><br><span class="line">  [1,2,3],</span><br><span class="line">  [4,5,6],</span><br><span class="line">  [7,8,9]</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">原地旋转输入矩阵，使其变为:</span><br><span class="line">[</span><br><span class="line">  [7,4,1],</span><br><span class="line">  [8,5,2],</span><br><span class="line">  [9,6,3]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>示例 2:</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">给定 matrix =</span><br><span class="line">[</span><br><span class="line">  [ 5, 1, 9,11],</span><br><span class="line">  [ 2, 4, 8,10],</span><br><span class="line">  [13, 3, 6, 7],</span><br><span class="line">  [15,14,12,16]</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">原地旋转输入矩阵，使其变为:</span><br><span class="line">[</span><br><span class="line">  [15,13, 2, 5],</span><br><span class="line">  [14, 3, 4, 1],</span><br><span class="line">  [12, 6, 8, 9],</span><br><span class="line">  [16, 7,10,11]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> matrix = [</span><br><span class="line">  [<span class="number">5</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">11</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">10</span>],</span><br><span class="line">  [<span class="number">13</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">7</span>],</span><br><span class="line">  [<span class="number">15</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">16</span>]</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rotate</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = i + <span class="number">1</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line">      <span class="keyword">var</span> tempArr = arr[j][i];</span><br><span class="line">      arr[j][i] = arr[i][j];</span><br><span class="line">      arr[i][j] = tempArr;</span><br><span class="line">    &#125;</span><br><span class="line">    arr[i].reverse();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(rotate(matrix));</span><br></pre></td></tr></table></figure>

<h3 id="如何将浮点数点左边的数每三位添加一个逗号，如-12000000-11-转化为『12-000-000-11』？"><a href="#如何将浮点数点左边的数每三位添加一个逗号，如-12000000-11-转化为『12-000-000-11』？" class="headerlink" title="如何将浮点数点左边的数每三位添加一个逗号，如 12000000.11 转化为『12,000,000.11』？"></a>如何将浮点数点左边的数每三位添加一个逗号，如 12000000.11 转化为『12,000,000.11』？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">12000000.11</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法1：利用 toLocaleString() 返回某语言系统下数字的表示字符串 IE6+</span></span><br><span class="line">num.toLocaleString();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toThousands</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> num !== <span class="string">&#x27;number&#x27;</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 判断 num 是否小于 0 ，小于则设 flag 为 &quot;-&quot; 并且把 num 转为绝对值</span></span><br><span class="line">  <span class="keyword">if</span> (num &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    flag = <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">    num = <span class="built_in">Math</span>.abs(num);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 转为数组 e.g. [ &#x27;12000000&#x27;, &#x27;11&#x27; ]</span></span><br><span class="line">  <span class="keyword">var</span> arr = num.toString().split(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">  <span class="comment">// 分别把「.」左边和右边存起来</span></span><br><span class="line">  <span class="keyword">var</span> left = [...arr[<span class="number">0</span>]];</span><br><span class="line">  <span class="keyword">var</span> right = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 如果 num 不是个整数的情况</span></span><br><span class="line">  <span class="keyword">if</span> (arr.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    right = <span class="string">&#x27;.&#x27;</span> + arr[<span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> count = left.length - <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// 操作左边整数部分，逆向遍历并且逢3前面加个「,」 ，最后 i-1</span></span><br><span class="line">  <span class="keyword">while</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// [1,2,0,0,0,0]</span></span><br><span class="line">    <span class="comment">// 例如如果数组长度为6，则一开始 count=5 ，不加</span></span><br><span class="line">    <span class="comment">// count=3 时，就需要在前面加个「,」</span></span><br><span class="line">    <span class="keyword">if</span> (count % <span class="number">3</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      left.splice(-count, <span class="number">0</span>, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    count--;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 正负符号 + 左边 + 小数点和右边</span></span><br><span class="line">  <span class="keyword">return</span> flag + left.join(<span class="string">&#x27;&#x27;</span>) + right;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法3：正则</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toThousands</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    num &amp;&amp;</span><br><span class="line">    num.toString().replace(<span class="regexp">/(\d)(?=(\d&#123;3&#125;)+\.)/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$<span class="number">1</span>, $<span class="number">2</span></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $<span class="number">2</span> + <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="两个数组合并成一个数组"><a href="#两个数组合并成一个数组" class="headerlink" title="两个数组合并成一个数组"></a>两个数组合并成一个数组</h3><p>请把两个数组 <code>[&#39;A1&#39;, &#39;A2&#39;, &#39;B1&#39;, &#39;B2&#39;, &#39;C1&#39;, &#39;C2&#39;, &#39;D1&#39;, &#39;D2&#39;]</code> 和 <code>[&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;]</code>，合并为 <code>[&#39;A1&#39;, &#39;A2&#39;, &#39;A&#39;, &#39;B1&#39;, &#39;B2&#39;, &#39;B&#39;, &#39;C1&#39;, &#39;C2&#39;, &#39;C&#39;, &#39;D1&#39;, &#39;D2&#39;, &#39;D&#39;]</code>。</p>
<blockquote>
<p>考察点：假设有一种情况，让你在一个列表中插入一个广告，不光是数组，对象依然有这种需求，这道题其实就是平常经常需要用到的一个小功能。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr1 = [<span class="string">&#x27;A1&#x27;</span>, <span class="string">&#x27;A2&#x27;</span>, <span class="string">&#x27;B1&#x27;</span>, <span class="string">&#x27;B2&#x27;</span>, <span class="string">&#x27;C1&#x27;</span>, <span class="string">&#x27;C2&#x27;</span>, <span class="string">&#x27;D1&#x27;</span>, <span class="string">&#x27;D2&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  [...arr1, ...arr2].sort(</span><br><span class="line">    (v2, v1) =&gt;</span><br><span class="line">      v2.codePointAt(<span class="number">0</span>) - v1.codePointAt(<span class="number">0</span>) ||</span><br><span class="line">      v1.length - v2.length ||</span><br><span class="line">      v2.codePointAt(<span class="number">1</span>) - v1.codePointAt(<span class="number">1</span>)</span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>第一个条件 v2.codePointAt(0) - v1.codePointAt(0) 保证了所有已 A 开头的字符串会放在最前边，然后依次是 B 和 C。</li>
<li>第二个条件 v1.length - v2.length 保证 A 会被放在 A1 和 A2 之后。</li>
<li>第三个条件 v2.codePointAt(1) - v1.codePointAt(1)保证了 A1 会被放在 A2 前边。</li>
</ul>
<p>这是我挑的一个比较好的答案，更多解法可<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/39">在此</a>查看</p>
<h3 id="随机生成一个长度为-10-的整数类型的数组，例如-2-10-3-4-5-11-10-11-20-，将其排列成一个新数组，要求新数组形式如下，例如-2-3-4-5-10-11-20-。"><a href="#随机生成一个长度为-10-的整数类型的数组，例如-2-10-3-4-5-11-10-11-20-，将其排列成一个新数组，要求新数组形式如下，例如-2-3-4-5-10-11-20-。" class="headerlink" title="随机生成一个长度为 10 的整数类型的数组，例如 [2, 10, 3, 4, 5, 11, 10, 11, 20]，将其排列成一个新数组，要求新数组形式如下，例如 [[2, 3, 4, 5], [10, 11], [20]]。"></a>随机生成一个长度为 10 的整数类型的数组，例如 [2, 10, 3, 4, 5, 11, 10, 11, 20]，将其排列成一个新数组，要求新数组形式如下，例如 [[2, 3, 4, 5], [10, 11], [20]]。</h3><p>解析：由于题意没有说清楚，到底是按「数字区间」排还是按照「连续数字」排，所以两种都写出来供参考</p>
<p>答案：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 随机整数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">randomArr</span>(<span class="params">min, max</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random() * (max - min) + min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化数组</span></span><br><span class="line"><span class="keyword">let</span> initArr = <span class="built_in">Array</span>.from(&#123; <span class="attr">length</span>: <span class="number">10</span> &#125;, <span class="function">() =&gt;</span> randomArr(<span class="number">20</span>, <span class="number">100</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组去重</span></span><br><span class="line">initArr = [...new <span class="built_in">Set</span>(initArr)];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组排序</span></span><br><span class="line">initArr.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 区间分类解法：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTargetArr</span>(<span class="params">initArr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">  initArr.map(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> initNum = <span class="built_in">Math</span>.floor(num / <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> (!obj[initNum]) obj[initNum] = [];</span><br><span class="line">    obj[initNum].push(num);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> result = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    result.push(obj[key]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(createTargetArr(initArr));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 连续数字分类解法：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTargetArr</span>(<span class="params">initArr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> continueArr = [],</span><br><span class="line">    tempArr = [];</span><br><span class="line">  <span class="built_in">console</span>.log(initArr);</span><br><span class="line">  initArr.map(<span class="function">(<span class="params">e, index</span>) =&gt;</span> &#123;</span><br><span class="line">    tempArr.push(e);</span><br><span class="line">    <span class="keyword">if</span> (initArr[index + <span class="number">1</span>] !== ++e) &#123;</span><br><span class="line">      continueArr.push(tempArr);</span><br><span class="line">      tempArr = [];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> continueArr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(createTargetArr(initArr));</span><br></pre></td></tr></table></figure>

<p>题目来源：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/113">Daily-Interview-Question 第 67 题</a></p>
<h3 id="打印出-1-10000-之间的所有对称数-例如：121、1331-等"><a href="#打印出-1-10000-之间的所有对称数-例如：121、1331-等" class="headerlink" title="打印出 1 - 10000 之间的所有对称数 例如：121、1331 等"></a>打印出 1 - 10000 之间的所有对称数 例如：121、1331 等</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 遍历 10000 次</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">symmetry</span>(<span class="params">begin, end</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = begin &gt; <span class="number">10</span> ? begin : <span class="number">11</span>; i &lt; end; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> str = i + <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (str === str.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">      result.push(str);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(symmetry(<span class="number">11</span>, <span class="number">100</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用对称数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">symmetry</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    arr.push(i * <span class="number">11</span>); <span class="comment">// 两位数的对称数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">      arr.push(i * <span class="number">101</span> + j * <span class="number">10</span>); <span class="comment">//  三位数的对称数</span></span><br><span class="line">      arr.push(i * <span class="number">1001</span> + j * <span class="number">110</span>); <span class="comment">// 四位数的对称数，当i和j均为9是值为9999</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(symmetry());</span><br></pre></td></tr></table></figure>

<p>题目来源：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/131">Daily-Interview-Question 第 81 题</a></p>
<h3 id="实现-convert-方法，把原始-list-转换成树形结构，要求尽可能降低时间复杂度"><a href="#实现-convert-方法，把原始-list-转换成树形结构，要求尽可能降低时间复杂度" class="headerlink" title="实现 convert 方法，把原始 list 转换成树形结构，要求尽可能降低时间复杂度"></a>实现 convert 方法，把原始 list 转换成树形结构，要求尽可能降低时间复杂度</h3><p>以下数据结构中，id 代表部门编号，name 是部门名称，parentId 是父部门编号，为 0 代表一级部门，现在要求实现一个 convert 方法，把原始 list 转换成树形结构，parentId 为多少就挂载在该 id 的属性 children 数组下，结构如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 原始 list 如下</span></span><br><span class="line"><span class="keyword">let</span> list = [</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">name</span>:<span class="string">&#x27;部门A&#x27;</span>,<span class="attr">parentId</span>:<span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">name</span>:<span class="string">&#x27;部门B&#x27;</span>,<span class="attr">parentId</span>:<span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">3</span>,<span class="attr">name</span>:<span class="string">&#x27;部门C&#x27;</span>,<span class="attr">parentId</span>:<span class="number">1</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">4</span>,<span class="attr">name</span>:<span class="string">&#x27;部门D&#x27;</span>,<span class="attr">parentId</span>:<span class="number">1</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">5</span>,<span class="attr">name</span>:<span class="string">&#x27;部门E&#x27;</span>,<span class="attr">parentId</span>:<span class="number">2</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">6</span>,<span class="attr">name</span>:<span class="string">&#x27;部门F&#x27;</span>,<span class="attr">parentId</span>:<span class="number">3</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">7</span>,<span class="attr">name</span>:<span class="string">&#x27;部门G&#x27;</span>,<span class="attr">parentId</span>:<span class="number">2</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">8</span>,<span class="attr">name</span>:<span class="string">&#x27;部门H&#x27;</span>,<span class="attr">parentId</span>:<span class="number">4</span>&#125;</span><br><span class="line">];</span><br><span class="line"><span class="keyword">const</span> result = convert(list, ...);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换后的结果如下</span></span><br><span class="line"><span class="keyword">let</span> result = [</span><br><span class="line">    &#123;</span><br><span class="line">      id: <span class="number">1</span>,</span><br><span class="line">      name: <span class="string">&#x27;部门A&#x27;</span>,</span><br><span class="line">      parentId: <span class="number">0</span>,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="number">3</span>,</span><br><span class="line">          name: <span class="string">&#x27;部门C&#x27;</span>,</span><br><span class="line">          parentId: <span class="number">1</span>,</span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              id: <span class="number">6</span>,</span><br><span class="line">              name: <span class="string">&#x27;部门F&#x27;</span>,</span><br><span class="line">              parentId: <span class="number">3</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">              id: <span class="number">16</span>,</span><br><span class="line">              name: <span class="string">&#x27;部门L&#x27;</span>,</span><br><span class="line">              parentId: <span class="number">3</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="number">4</span>,</span><br><span class="line">          name: <span class="string">&#x27;部门D&#x27;</span>,</span><br><span class="line">          parentId: <span class="number">1</span>,</span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              id: <span class="number">8</span>,</span><br><span class="line">              name: <span class="string">&#x27;部门H&#x27;</span>,</span><br><span class="line">              parentId: <span class="number">4</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">  ···</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>解答：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 常规</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convert</span>(<span class="params">list</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">pid</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> list.filter(<span class="function"><span class="params">dep</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (dep.parentId === pid) &#123;</span><br><span class="line">        <span class="comment">// 以自己为根节点，找儿子</span></span><br><span class="line">        <span class="keyword">let</span> children = fn(dep.id);</span><br><span class="line">        dep.children = children.length ? children : <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 找最外层根节点0</span></span><br><span class="line">  <span class="keyword">return</span> fn(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// map</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convert</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 数组转对象</span></span><br><span class="line">  <span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">    obj[item.id] = item;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> result = [];</span><br><span class="line">  <span class="comment">// 循环数组，如果是父部门则装进结果数组然后跳过本次循环，再根据剩下的子部门找相应父部门，把自己挂载到父部们下</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.parentId === <span class="number">0</span>) &#123;</span><br><span class="line">      result.push(item);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (item.parentId <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">let</span> parent = obj[item.parentId];</span><br><span class="line">      parent.children = parent.children || [];</span><br><span class="line">      parent.children.push(item);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>题目来源：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/139">Daily-Interview-Question 第 88 题</a></p>
<h3 id="编程题，请写一个函数，完成以下功能"><a href="#编程题，请写一个函数，完成以下功能" class="headerlink" title="编程题，请写一个函数，完成以下功能"></a>编程题，请写一个函数，完成以下功能</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">输入：<span class="string">&#x27;1,2,3,5,7,8,10&#x27;</span></span><br><span class="line">输出：<span class="string">&#x27;1~3,5,7~8,10&#x27;</span></span><br></pre></td></tr></table></figure>

<p>解答：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;1,2,3,5,7,8,10,11&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arr = str.split(<span class="string">&#x27;,&#x27;</span>).map(<span class="function"><span class="params">v</span> =&gt;</span> +v);</span><br><span class="line">  <span class="keyword">let</span> continueNum = arr[<span class="number">0</span>]; <span class="comment">// tempNum负责存储连续数字的起始</span></span><br><span class="line">  <span class="keyword">let</span> result = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> curNum = arr[i],</span><br><span class="line">      nextNum = arr[i + <span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 当前+1等于下一个数则跳过</span></span><br><span class="line">    <span class="comment">// 不相等则处理</span></span><br><span class="line">    <span class="keyword">if</span> (curNum + <span class="number">1</span> !== nextNum) &#123;</span><br><span class="line">      <span class="comment">// 分两种情况，</span></span><br><span class="line">      <span class="comment">// 一开始就连续数字：[1,2,5,7] 当i为2时满足上方if条件，tempNum = 1，curNum = 2</span></span><br><span class="line">      <span class="comment">// 一开始非连续数字：[3,5,7] 当i为1时就满足上方if条件，tempNum = 3，curNum = 3</span></span><br><span class="line">      <span class="keyword">if</span> (curNum !== continueNum) &#123;</span><br><span class="line">        <span class="comment">// 连续数字打头的tempNum + ~ + 目前数字为止</span></span><br><span class="line">        result.push(continueNum + <span class="string">&#x27;~&#x27;</span> + curNum);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 否则直接把当前数字推入数组</span></span><br><span class="line">        result.push(curNum);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 无论连续还是不连续，都把下一项当做连续的起始</span></span><br><span class="line">      continueNum = nextNum;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result.join(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(fn(str));</span><br></pre></td></tr></table></figure>

<h3 id="补全代码，实现数组按姓名、年纪、任意字段排序。"><a href="#补全代码，实现数组按姓名、年纪、任意字段排序。" class="headerlink" title="补全代码，实现数组按姓名、年纪、任意字段排序。"></a>补全代码，实现数组按姓名、年纪、任意字段排序。</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> users = [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span>, <span class="attr">company</span>: <span class="string">&#x27;Baidu&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;Pete&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span>, <span class="attr">company</span>: <span class="string">&#x27;Alibaba&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;Ann&#x27;</span>, <span class="attr">age</span>: <span class="number">19</span>, <span class="attr">company</span>: <span class="string">&#x27;Tecent&#x27;</span> &#125;</span><br><span class="line">];</span><br><span class="line">users.sort(byField(<span class="string">&#x27;age&#x27;</span>));</span><br><span class="line">users.sort(byField(<span class="string">&#x27;company&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>解答：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> users = [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span>, <span class="attr">company</span>: <span class="string">&#x27;Baidu&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;Pete&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span>, <span class="attr">company</span>: <span class="string">&#x27;Alibaba&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;Ann&#x27;</span>, <span class="attr">age</span>: <span class="number">19</span>, <span class="attr">company</span>: <span class="string">&#x27;Tecent&#x27;</span> &#125;</span><br><span class="line">];</span><br><span class="line"><span class="keyword">var</span> byField = <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">a, b</span>) =&gt;</span> a[key] &gt; b[key];</span><br><span class="line">&#125;;</span><br><span class="line">users.sort(byField(<span class="string">&#x27;age&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(users);</span><br><span class="line">users.sort(byField(<span class="string">&#x27;company&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(users);</span><br></pre></td></tr></table></figure>

<p><strong>题目来源：</strong><a href="https://juejin.im/post/5ce4171ff265da1bd04eb4f3#heading-6">2019 前端面试 | “HTML + CSS + JS”专题</a> 「JavaScript 基础」部分编号 js_12</p>
<h3 id="取数组的最大值"><a href="#取数组的最大值" class="headerlink" title="取数组的最大值"></a>取数组的最大值</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">max</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (arr.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, arr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ES6写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">max</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (arr.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.max(...arr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">max</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (arr.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">return</span> arr.reduce(<span class="function">(<span class="params">previous, current</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> previous &gt; current ? previous : current;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(max([<span class="number">1</span>, <span class="number">22</span>, <span class="number">3435</span>, <span class="number">321</span>, <span class="number">9990</span>, <span class="number">100001</span>, <span class="number">2133</span>]));</span><br></pre></td></tr></table></figure>

<h3 id="实现一个-reduce-函数"><a href="#实现一个-reduce-函数" class="headerlink" title="实现一个 reduce 函数"></a>实现一个 reduce 函数</h3><p>解析：reduce 是归并方法，它并不对每一项执行目标函数，简单来说概括为如下步骤：</p>
<ul>
<li>不断地对数组的前两项“取出”，对其执行目标函数，计算得到的返回值</li>
<li>把上述返回值“填回”数组首部，作为新的 array[0]</li>
<li>持续循环执行这个过程，直到数组中每一项都访问了一次</li>
<li>返回最终结果</li>
</ul>
<p>举个例子 🌰</p>
<p>对数组 [1，2，3] 归并执行 <code>(prev, cur) =&gt; prev + cur</code>，流程如图：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>][(<span class="number">3</span>, <span class="number">3</span>)][<span class="number">6</span>]; <span class="comment">// 取出 1 + 2 ，填回 3 // 取出 3 + 3 ，填回 6 // 最终结果为 6</span></span><br></pre></td></tr></table></figure>

<p>答案：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reduce</span>(<span class="params">arr, fn, initValue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> tempArr = (initValue === <span class="literal">undefined</span> ? [] : [initValue]).concat(arr);</span><br><span class="line">  <span class="keyword">while</span> (tempArr.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    tempArr.splice(<span class="number">0</span>, <span class="number">2</span>, fn(tempArr[<span class="number">0</span>], tempArr[<span class="number">1</span>]));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> tempArr[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sum = reduce(</span><br><span class="line">  [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">previous, current</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> previous + current;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">0</span></span><br><span class="line">);</span><br><span class="line"><span class="built_in">console</span>.log(sum);</span><br></pre></td></tr></table></figure>

<p>写法 2：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reduce</span>(<span class="params">arr, reduceCallback, initialValue</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 首先，检查传递的参数是否正确。</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(arr) || !arr.length || <span class="keyword">typeof</span> reduceCallback !== <span class="string">&#x27;function&#x27;</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 如果没有将initialValue传递给该函数，我们将使用第一个数组项作为initialValue</span></span><br><span class="line">    <span class="keyword">let</span> hasInitialValue = initialValue !== <span class="literal">undefined</span>;</span><br><span class="line">    <span class="keyword">let</span> value = hasInitialValue ? initialValue : arr[<span class="number">0</span>];</span><br><span class="line">   、</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果有传递 initialValue，则索引从 1 开始，否则从 0 开始</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = hasInitialValue ? <span class="number">0</span> : <span class="number">1</span>, len = arr.length; i &lt; len; i++) &#123;</span><br><span class="line">      value = reduceCallback(value, arr[i], i, arr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="手动实现-Array-prototype-map-方法"><a href="#手动实现-Array-prototype-map-方法" class="headerlink" title="手动实现 Array.prototype.map 方法"></a>手动实现 Array.prototype.map 方法</h3><p>map() 方法创建一个新数组，其结果是该数组中的每个元素都调用一个提供的函数后返回的结果。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">map</span>(<span class="params">arr, mapCallback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 首先，检查传递的参数是否正确。</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(arr) || !arr.length || <span class="keyword">typeof</span> mapCallback !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> result = [];</span><br><span class="line">    <span class="comment">// 每次调用此函数时，我们都会创建一个 result 数组</span></span><br><span class="line">    <span class="comment">// 因为我们不想改变原始数组。</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.length; i &lt; len; i++) &#123;</span><br><span class="line">      result.push(mapCallback(arr[i], i, arr));</span><br><span class="line">      <span class="comment">// 将 mapCallback 返回的结果 push 到 result 数组中</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="手动实现-Array-prototype-filter-方法"><a href="#手动实现-Array-prototype-filter-方法" class="headerlink" title="手动实现 Array.prototype.filter 方法"></a>手动实现 Array.prototype.filter 方法</h3><p>filter()方法创建一个新数组, 其包含通过所提供函数实现的测试的所有元素。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">arr, filterCallback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 首先，检查传递的参数是否正确。</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    !<span class="built_in">Array</span>.isArray(arr) ||</span><br><span class="line">    !arr.length ||</span><br><span class="line">    <span class="keyword">typeof</span> filterCallback !== <span class="string">&#x27;function&#x27;</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> result = [];</span><br><span class="line">    <span class="comment">// 每次调用此函数时，我们都会创建一个 result 数组</span></span><br><span class="line">    <span class="comment">// 因为我们不想改变原始数组。</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.length; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="comment">// 检查 filterCallback 的返回值是否是真值</span></span><br><span class="line">      <span class="keyword">if</span> (filterCallback(arr[i], i, arr)) &#123;</span><br><span class="line">        <span class="comment">// 如果条件为真，则将数组元素 push 到 result 中</span></span><br><span class="line">        result.push(arr[i]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result; <span class="comment">// return the result array</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="随机数-数字"><a href="#随机数-数字" class="headerlink" title="随机数 / 数字"></a>随机数 / 数字</h2><h3 id="如何获取-0-9-的随机数"><a href="#如何获取-0-9-的随机数" class="headerlink" title="如何获取 0-9 的随机数"></a>如何获取 0-9 的随机数</h3><ul>
<li><strong>Math.round(num)**：将 **num</strong> 四舍五入取整</li>
<li><strong>Math.floor(num)**：将 **num</strong> 向下取整，即返回 <strong>num</strong> 的整数部分。当然我们也可以使用 <strong>parseInt()</strong> 方法代替。</li>
<li>**Math.ceil(num)**：向上取整</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// (min, max)：</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random() * (max - min - <span class="number">2</span>) + min + <span class="number">1</span>);</span><br><span class="line"><span class="comment">// [min, max]：</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random() * (max - min) + min);</span><br><span class="line"><span class="comment">// (n, m]：</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * (max - min) + min);</span><br><span class="line"><span class="comment">// [n, m)：</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (max - min) + min);</span><br></pre></td></tr></table></figure>

<h3 id="随机获取数组中的元素"><a href="#随机获取数组中的元素" class="headerlink" title="随机获取数组中的元素"></a>随机获取数组中的元素</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">&#x27;前端&#x27;</span>, <span class="string">&#x27;后端&#x27;</span>, <span class="string">&#x27;全栈&#x27;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr[<span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * arr.length)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(fn(arr));</span><br><span class="line">  i++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打乱数组顺序"><a href="#打乱数组顺序" class="headerlink" title="打乱数组顺序"></a>打乱数组顺序</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;dsfs&#x27;</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&#x27;v&#x27;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> randomIndex = <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * arr.length);</span><br><span class="line">    <span class="keyword">var</span> temp = arr[i];</span><br><span class="line">    arr[i] = arr[randomIndex];</span><br><span class="line">    arr[randomIndex] = temp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="保留指定小数位"><a href="#保留指定小数位" class="headerlink" title="保留指定小数位"></a>保留指定小数位</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">4.345678</span>;</span><br><span class="line">num = num.toFixed(<span class="number">4</span>); <span class="comment">// 4.3457 第四位小数位以四舍五入计算</span></span><br></pre></td></tr></table></figure>

<h3 id="前端价格展示，保留-2-位小数。位数不够补零"><a href="#前端价格展示，保留-2-位小数。位数不够补零" class="headerlink" title="前端价格展示，保留 2 位小数。位数不够补零"></a>前端价格展示，保留 2 位小数。位数不够补零</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">priceFormat</span>(<span class="params">price</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseFloat</span>(<span class="built_in">Math</span>.round(price * <span class="number">100</span>) / <span class="number">100</span>).toFixed(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何将字符串转化为数字，例如’12-3b’？"><a href="#如何将字符串转化为数字，例如’12-3b’？" class="headerlink" title="如何将字符串转化为数字，例如’12.3b’？"></a>如何将字符串转化为数字，例如’12.3b’？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">parseFloat</span>(<span class="string">&#x27;12.3b&#x27;</span>);</span><br><span class="line"><span class="comment">// 12.3</span></span><br></pre></td></tr></table></figure>

<h3 id="如何检查一个数字是否为整数？"><a href="#如何检查一个数字是否为整数？" class="headerlink" title="如何检查一个数字是否为整数？"></a>如何检查一个数字是否为整数？</h3><blockquote>
<p>将它对 1 进行取模，看看是否有余数。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isInt</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num % <span class="number">1</span> === <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(isInt(<span class="number">4</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isInt(<span class="number">12.2</span>)); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(isInt(<span class="number">0.3</span>)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h3 id="为什么-0-1-0-2-不等于-0-3？在什么场景下遇到这个问题，如何解决？"><a href="#为什么-0-1-0-2-不等于-0-3？在什么场景下遇到这个问题，如何解决？" class="headerlink" title="为什么 0.1+0.2 不等于 0.3？在什么场景下遇到这个问题，如何解决？"></a>为什么 0.1+0.2 不等于 0.3？在什么场景下遇到这个问题，如何解决？</h3><blockquote>
<p>二进制模拟十进制进行计算时 的精度问题</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方法1：ES6的 Number.EPSILON ，这个值无限接近于0。0.1 + 0.2的精度误差在这个值的范围内</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">numbersEqual</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.abs(a - b) &lt; <span class="built_in">Number</span>.EPSILON;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">0.1</span> + <span class="number">0.2</span>,</span><br><span class="line">  b = <span class="number">0.3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(numbersEqual(a, b)); <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：parseFloat + 内置函数 toFixed</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatNum</span>(<span class="params">num, fixed = <span class="number">10</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// a.toFixed(fixed) 先转为小数点10位的字符串 &quot;0.3000000000&quot;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseFloat</span>(a.toFixed(fixed)); <span class="comment">// 然后通过parseFloat转为浮点数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">0.1</span> + <span class="number">0.2</span>;</span><br><span class="line"><span class="built_in">console</span></span><br><span class="line">  .log(formatNum(a))(</span><br><span class="line">    <span class="comment">//0.3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方法3：内置函数toPrecision(中文：精确，精度)</span></span><br><span class="line">    <span class="comment">// 参数是精度.比如 5.1234 ，传 2 返回 5.1 ，传 1 返回 5 ；0.2 + 0.1 传 2 返回 0.30</span></span><br><span class="line">    <span class="number">0.1</span> + <span class="number">0.2</span></span><br><span class="line">  )</span><br><span class="line">  .toPrecision(<span class="number">10</span>) == <span class="number">0.3</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>参考：</p>
<ul>
<li><a href="https://juejin.im/post/5b90e00e6fb9a05cf9080dff">0.1 + 0.2 不等于 0.3？为什么 JavaScript 有这种“骚”操作？</a></li>
<li><a href="https://blog.csdn.net/nineteen73/article/details/51184387">JavaScript 的设计缺陷?浮点运算：0.1 + 0.2 != 0.3</a></li>
</ul>
<h3 id="写一个函数，生成一个随机颜色字符串，合法的颜色为-000000-ffffff"><a href="#写一个函数，生成一个随机颜色字符串，合法的颜色为-000000-ffffff" class="headerlink" title="写一个函数，生成一个随机颜色字符串，合法的颜色为 #000000 ~ #ffffff"></a>写一个函数，生成一个随机颜色字符串，合法的颜色为 #000000 ~ #ffffff</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandColor</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//补全</span></span><br><span class="line">  <span class="keyword">const</span> dict = <span class="string">&#x27;0123456789abcdef&#x27;</span>;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">    result += dict[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * dict.length)];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> color = getRandColor();</span><br><span class="line"><span class="built_in">console</span>.log(color);</span><br></pre></td></tr></table></figure>

<h3 id="写一个函数，生成一个随机-IP-地址，一个合法的-IP-地址为-0-0-0-0-255-255-255-255。"><a href="#写一个函数，生成一个随机-IP-地址，一个合法的-IP-地址为-0-0-0-0-255-255-255-255。" class="headerlink" title="写一个函数，生成一个随机 IP 地址，一个合法的 IP 地址为 0.0.0.0 ~ 255.255.255.255。"></a>写一个函数，生成一个随机 IP 地址，一个合法的 IP 地址为 0.0.0.0 ~ 255.255.255.255。</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandIP</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.from(&#123; <span class="attr">length</span>: <span class="number">4</span> &#125;).reduce(<span class="function">(<span class="params">ip, cur, idx</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> randomIdx = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>);</span><br><span class="line">    <span class="keyword">return</span> idx === <span class="number">3</span> ? ip + randomIdx : ip + randomIdx + <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">  &#125;, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ip = getRandIP();</span><br><span class="line"><span class="built_in">console</span>.log(ip);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandIP</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ip = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    ip = ip + <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>) + <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ip + <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ip = getRandIP();</span><br><span class="line"><span class="built_in">console</span>.log(ip);</span><br></pre></td></tr></table></figure>

<p>题目来源：<a href="https://juejin.im/post/5ce4171ff265da1bd04eb4f3#heading-6">2019 前端面试 | “HTML + CSS + JS”专题</a>「《JS 提供的对象：④ Math》[编号：js_19]」</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="实现柯里化"><a href="#实现柯里化" class="headerlink" title="实现柯里化"></a>实现柯里化</h3><p>预先设置一些参数</p>
<p>柯里化是什么：是指这样一个函数，它接收函数 A，并且能返回一个新的函数，这个新的函数能够处理函数 A 的剩余参数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createCurry</span>(<span class="params">func, args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> argity = func.length;</span><br><span class="line">  <span class="keyword">var</span> args = args || [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _args = [].slice.apply(<span class="built_in">arguments</span>);</span><br><span class="line">    args.push(..._args);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (args.length &lt; argity) &#123;</span><br><span class="line">      <span class="keyword">return</span> createCurry.call(<span class="built_in">this</span>, func, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> func.apply(<span class="built_in">this</span>, args);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="this"><a href="#this" class="headerlink" title="this"></a>this</h2><h3 id="手写-bind、apply、call"><a href="#手写-bind、apply、call" class="headerlink" title="手写 bind、apply、call"></a>手写 bind、apply、call</h3><h4 id="call"><a href="#call" class="headerlink" title="call"></a>call</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.call = <span class="function"><span class="keyword">function</span> (<span class="params">context, ...args</span>) </span>&#123;</span><br><span class="line">  context = context || <span class="built_in">window</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fnSymbol = <span class="built_in">Symbol</span>(<span class="string">&#x27;fn&#x27;</span>);</span><br><span class="line">  context[fnSymbol] = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  context[fnSymbol](...args);</span><br><span class="line">  <span class="keyword">delete</span> context[fnSymbol];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">context, argsArr</span>) </span>&#123;</span><br><span class="line">  context = context || <span class="built_in">window</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fnSymbol = <span class="built_in">Symbol</span>(<span class="string">&#x27;fn&#x27;</span>);</span><br><span class="line">  context[fnSymbol] = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  context[fnSymbol](...argsArr);</span><br><span class="line">  <span class="keyword">delete</span> context[fnSymbol];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span> (<span class="params">context, ...args</span>) </span>&#123;</span><br><span class="line">  context = context || <span class="built_in">window</span>;</span><br><span class="line">  <span class="keyword">const</span> fnSymbol = <span class="built_in">Symbol</span>(<span class="string">&#x27;fn&#x27;</span>);</span><br><span class="line">  context[fnSymbol] = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">..._args</span>) </span>&#123;</span><br><span class="line">    _args = _args.concat(args);</span><br><span class="line"></span><br><span class="line">    context[fnSymbol](..._args);</span><br><span class="line">    <span class="keyword">delete</span> context[fnSymbol];</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><h3 id="如下代码输出多少？如果想输出-3，那如何改造代码？"><a href="#如下代码输出多少？如果想输出-3，那如何改造代码？" class="headerlink" title="如下代码输出多少？如果想输出 3，那如何改造代码？"></a>如下代码输出多少？如果想输出 3，那如何改造代码？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fnArr = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  fnArr[i] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fnArr[<span class="number">3</span>]());</span><br></pre></td></tr></table></figure>

<p>答案：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//方法一</span></span><br><span class="line"><span class="keyword">var</span> fnArr = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  fnArr[i] = (<span class="function"><span class="keyword">function</span> (<span class="params">j</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fnArr[<span class="number">3</span>]()); <span class="comment">//--&gt;3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//方法二</span></span><br><span class="line"><span class="keyword">var</span> fnArr = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">    fnArr[i] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> i;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fnArr[<span class="number">3</span>]()); <span class="comment">//--&gt;3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//方法三</span></span><br><span class="line"><span class="keyword">var</span> fnArr = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  fnArr[i] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fnArr[<span class="number">3</span>]()); <span class="comment">//--&gt;3</span></span><br></pre></td></tr></table></figure>

<p><strong>题目来源：</strong> <a href="https://juejin.im/post/5ce4171ff265da1bd04eb4f3#heading-5">2019 前端面试 | “HTML + CSS + JS”专题</a> 的 「JavaScript 基础」部分，编号[js_11]中第 5 题。</p>
<h2 id="对象-amp-原型-amp-原型链"><a href="#对象-amp-原型-amp-原型链" class="headerlink" title="对象 &amp; 原型 &amp; 原型链"></a>对象 &amp; 原型 &amp; 原型链</h2><h3 id="写一下浅-深拷贝"><a href="#写一下浅-深拷贝" class="headerlink" title="写一下浅/深拷贝"></a>写一下浅/深拷贝</h3><blockquote>
<p>深拷贝和浅拷贝针对的是引用类型，JS 中的变量类型分为值类型（基本类型）和引用类型；对值类型进行复制操作会对值进行一份拷贝，而对引用类型复制，则会进行地址的拷贝，最终两个变量指向同一份数据。对于引用类型，会导致 a b 指向同一份数据，此时如果对其中一个进行修改，就会影响到另外一个，有时候这可能不是我们想要的结果。</p>
</blockquote>
<h4 id="浅拷贝"><a href="#浅拷贝" class="headerlink" title="浅拷贝"></a>浅拷贝</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 实现一个浅拷贝，就是遍历源对象，然后在将对象的属性的属性值都放到一个新对象里就ok了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法1：遍历</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copy</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!obj || <span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> newObj = obj.constructor === <span class="built_in">Array</span> ? [] : &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    newObj[key] = obj[key];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newObj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">b</span>: <span class="string">&#x27;bb&#x27;</span>, <span class="attr">c</span>: <span class="string">&#x27;cc&#x27;</span>, <span class="attr">d</span>: &#123; <span class="attr">e</span>: <span class="string">&#x27;ee&#x27;</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">var</span> b = copy(a);</span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// &#123; b: &#x27;bb&#x27;, c: &#x27;cc&#x27;, d: &#123; e: &#x27;ee&#x27; &#125; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：原生方法 Object.assign</span></span><br><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">a</span>: <span class="string">&#x27;old&#x27;</span>, <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="string">&#x27;old&#x27;</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">Object</span>.assign(&#123;&#125;, a);</span><br><span class="line">b.a = <span class="string">&#x27;new&#x27;</span>;</span><br><span class="line">b.b.c = <span class="string">&#x27;new&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// &#123; a: &#x27;old&#x27;, b: &#123; c: &#x27;new&#x27; &#125; &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// &#123; a: &#x27;new&#x27;, b: &#123; c: &#x27;new&#x27; &#125; &#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方法1：转 JSON 再转回来</span></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123; <span class="attr">a</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;小红&#x27;</span> &#125;, <span class="attr">b</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj1));</span><br><span class="line">obj1.a.name = <span class="string">&#x27;被修改了&#x27;</span>;</span><br><span class="line">obj2; <span class="comment">//&#123;&quot;a&quot;:&#123;&quot;name&quot;:&quot;小红&quot;&#125;,&quot;b&quot;:2&#125;  《---没有被修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// JSON方法的缺点：</span></span><br><span class="line"><span class="comment">//  不能复制 function、正则、Symbol</span></span><br><span class="line"><span class="comment">//  循环引用报错</span></span><br><span class="line"><span class="comment">//  相同的引用会被重复复制</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：递归的方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copy</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 递归退出条件</span></span><br><span class="line">  <span class="comment">// 拷贝对象不存在或不是数组或不是对象</span></span><br><span class="line">  <span class="keyword">if</span> (!obj || <span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span>) <span class="keyword">return</span> obj;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> newObj = obj.constructor === <span class="built_in">Array</span> ? [] : &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">      <span class="comment">// 避免相互引用对象导致死循环，如 obj.a = obj（其实下面三行不写也没事儿，系统会自动把 obj.a 设为 undefined）</span></span><br><span class="line">      <span class="keyword">if</span> (obj[key] === obj) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 如果是数组或者对象: 递归；否则直接返回</span></span><br><span class="line">      newObj[key] = <span class="keyword">typeof</span> obj[key] === <span class="string">&#x27;object&#x27;</span> ? copy(obj[key]) : obj[key];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> old = &#123; <span class="attr">a</span>: <span class="string">&#x27;old&#x27;</span>, <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="string">&#x27;old&#x27;</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">var</span> newObj = copy(old);</span><br><span class="line">newObj.b.c = <span class="string">&#x27;new&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(old); <span class="comment">// &#123; a: &#x27;old&#x27;, b: &#123; c: &#x27;old&#x27; &#125; &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(newObj); <span class="comment">// &#123; a: &#x27;old&#x27;, b: &#123; c: &#x27;new&#x27; &#125; &#125;</span></span><br></pre></td></tr></table></figure>

<p>参考：</p>
<ul>
<li><a href="https://segmentfault.com/a/1190000016970483">浅探 js 深拷贝和浅拷贝</a></li>
<li><a href="http://www.cnblogs.com/zhangycun/p/9799787.html">深拷贝的终极探索</a></li>
</ul>
<h4 id="拓展：编程题，写个程序把-entry-转换成如下对象"><a href="#拓展：编程题，写个程序把-entry-转换成如下对象" class="headerlink" title="拓展：编程题，写个程序把 entry 转换成如下对象"></a>拓展：编程题，写个程序把 entry 转换成如下对象</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> entry = &#123;</span><br><span class="line">  a: &#123;</span><br><span class="line">    b: &#123;</span><br><span class="line">      c: &#123;</span><br><span class="line">        dd: <span class="string">&#x27;abcdd&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    d: &#123;</span><br><span class="line">      xx: <span class="string">&#x27;adxx&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    e: <span class="string">&#x27;ae&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 要求转换成如下对象</span></span><br><span class="line"><span class="keyword">var</span> output = &#123;</span><br><span class="line">  <span class="string">&#x27;a.b.c.dd&#x27;</span>: <span class="string">&#x27;abcdd&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;a.d.xx&#x27;</span>: <span class="string">&#x27;adxx&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;a.e&#x27;</span>: <span class="string">&#x27;ae&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>解答：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">obj, parentKey = <span class="string">&#x27;&#x27;</span>, result = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">      <span class="keyword">const</span> ele = obj[key];</span><br><span class="line">      <span class="keyword">const</span> keyName = <span class="string">`<span class="subst">$&#123;parentKey&#125;</span><span class="subst">$&#123;key&#125;</span>`</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> ele === <span class="string">&#x27;object&#x27;</span> &amp;&amp; !<span class="built_in">Array</span>.isArray(ele)) &#123;</span><br><span class="line">        fn(ele, keyName + <span class="string">&#x27;.&#x27;</span>, result);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        result[keyName] = ele;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(fn(entry));</span><br></pre></td></tr></table></figure>

<h3 id="JavaScript-中，有一个函数，执行时对象查找时，永远不会去查找原型，这个函数是？"><a href="#JavaScript-中，有一个函数，执行时对象查找时，永远不会去查找原型，这个函数是？" class="headerlink" title="JavaScript 中，有一个函数，执行时对象查找时，永远不会去查找原型，这个函数是？"></a>JavaScript 中，有一个函数，执行时对象查找时，永远不会去查找原型，这个函数是？</h3><p><strong>hasOwnProperty</strong></p>
<p>hasOwnProperty 返回一个布尔值，指出一个对象是否具有指定名称的属性。此方法不会检查该对象的原型链中是否具有该属性；该属性必须是对象本身的一个成员。</p>
<p>使用方法： object.hasOwnProperty(proName) 其中参数 object 是必选项，一个对象的实例；proName 是必选项。一个属性名称的字符串值。 如果 object 具有指定名称的属性，那么 JavaScript 中 hasOwnProperty 函数方法返回 true，反之则返回 false。</p>
<h3 id="instanceof-的实现原理"><a href="#instanceof-的实现原理" class="headerlink" title="instanceof 的实现原理"></a>instanceof 的实现原理</h3><blockquote>
<p>思路：只要右边变量的 prototype 在左边变量的原型链上即可。</p>
</blockquote>
<p><strong>思路</strong></p>
<p>步骤 1：先取得当前类的原型，当前实例对象的原型链</p>
<p>步骤 2：一直循环（执行原型链的查找机制）</p>
<ul>
<li>取得当前实例对象原型链的原型链（<code>proto = proto.____proto____</code>，沿着原型链一直向上查找）</li>
<li>如果 当前实例的原型链<code>____proto__</code>上找到了当前类的原型<code>prototype</code>，则返回 <code>true</code></li>
<li>如果 一直找到<code>Object.prototype.____proto____ == null</code>，Object 的基类(null)上面都没找到，则返回 false</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_instanceof</span>(<span class="params">instanceObject, classFunc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> classFunc = classFunc.prototype; <span class="comment">// 取得当前类的原型</span></span><br><span class="line">  <span class="keyword">let</span> proto = instanceObject.__proto__; <span class="comment">// 取得当前实例对象的原型链</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (proto === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// 找到了 Object的基类 Object.prototype.__proto__</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (proto === classFunc) &#123;</span><br><span class="line">      <span class="comment">// 在当前实例对象的原型链上，找到了当前类</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    proto = proto.__proto__; <span class="comment">// 沿着原型链__ptoto__一层一层向上查找</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>优化版 (处理兼容问题)</strong></p>
<blockquote>
<p><strong>Object.getPrototypeOf ( )：</strong>用来获取某个实例对象的原型（内部**[[prototype]]<strong>属性的值，包含</strong>proto**属性）</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_instanceof</span>(<span class="params">instanceObject, classFunc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> classFunc = classFunc.prototype; <span class="comment">// 取得当前类的原型</span></span><br><span class="line">  <span class="keyword">let</span> proto = <span class="built_in">Object</span>.getPrototypeOf(instanceObject); <span class="comment">// 取得当前实例对象的原型链上的属性</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (proto === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// 找到了 Object的基类 Object.prototype.__proto__</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (proto === classFunc) &#123;</span><br><span class="line">      <span class="comment">// 在当前实例对象的原型链上，找到了当前类</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    proto = <span class="built_in">Object</span>.getPrototypeOf(proto); <span class="comment">// 沿着原型链__ptoto__一层一层向上查找</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://juejin.im/post/5b0b9b9051882515773ae714">浅谈 instanceof 和 typeof 的实现原理</a></p>
<h3 id="要求设计-LazyMan-类，实现以下功能"><a href="#要求设计-LazyMan-类，实现以下功能" class="headerlink" title="要求设计 LazyMan 类，实现以下功能"></a>要求设计 LazyMan 类，实现以下功能</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">LazyMan(<span class="string">&#x27;Tony&#x27;</span>);</span><br><span class="line"><span class="comment">// Hi I am Tony</span></span><br><span class="line"></span><br><span class="line">LazyMan(<span class="string">&#x27;Tony&#x27;</span>).sleep(<span class="number">10</span>).eat(<span class="string">&#x27;lunch&#x27;</span>);</span><br><span class="line"><span class="comment">// Hi I am Tony</span></span><br><span class="line"><span class="comment">// 等待了10秒...</span></span><br><span class="line"><span class="comment">// I am eating lunch</span></span><br><span class="line"></span><br><span class="line">LazyMan(<span class="string">&#x27;Tony&#x27;</span>).eat(<span class="string">&#x27;lunch&#x27;</span>).sleep(<span class="number">10</span>).eat(<span class="string">&#x27;dinner&#x27;</span>);</span><br><span class="line"><span class="comment">// Hi I am Tony</span></span><br><span class="line"><span class="comment">// I am eating lunch</span></span><br><span class="line"><span class="comment">// 等待了10秒...</span></span><br><span class="line"><span class="comment">// I am eating diner</span></span><br><span class="line"></span><br><span class="line">LazyMan(<span class="string">&#x27;Tony&#x27;</span>)</span><br><span class="line">  .eat(<span class="string">&#x27;lunch&#x27;</span>)</span><br><span class="line">  .eat(<span class="string">&#x27;dinner&#x27;</span>)</span><br><span class="line">  .sleepFirst(<span class="number">5</span>)</span><br><span class="line">  .sleep(<span class="number">10</span>)</span><br><span class="line">  .eat(<span class="string">&#x27;junk food&#x27;</span>);</span><br><span class="line"><span class="comment">// Hi I am Tony</span></span><br><span class="line"><span class="comment">// 等待了5秒...</span></span><br><span class="line"><span class="comment">// I am eating lunch</span></span><br><span class="line"><span class="comment">// I am eating dinner</span></span><br><span class="line"><span class="comment">// 等待了10秒...</span></span><br><span class="line"><span class="comment">// I am eating junk food</span></span><br></pre></td></tr></table></figure>

<p>答案：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LazyManClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.task = [];</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Hi I am&#x27;</span>, name);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.next();</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">eat</span>(<span class="params">str</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.task.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;I am eating&#x27;</span>, str);</span><br><span class="line">      <span class="built_in">this</span>.next();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">sleep</span>(<span class="params">n</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.task.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;等待了&#x27;</span> + n + <span class="string">&#x27;s&#x27;</span>);</span><br><span class="line">        <span class="built_in">this</span>.next();</span><br><span class="line">      &#125;, n * <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">sleepFirst</span>(<span class="params">n</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.task.unshift(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;等待了&#x27;</span> + n + <span class="string">&#x27;s&#x27;</span>);</span><br><span class="line">        <span class="built_in">this</span>.next();</span><br><span class="line">      &#125;, n * <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> fn = <span class="built_in">this</span>.task.shift();</span><br><span class="line">    fn &amp;&amp; fn();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> LazyMan = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> LazyManClass(name);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>解析：</p>
<p>这道题的关键点有如下几个：</p>
<ul>
<li>链式调用，通过返回 this 实现</li>
<li>内部需要维护一个 taskList ，根据不同逻辑，向 taskList 中 push 、shift、unshift 执行函数</li>
<li>每执行一个 task，需要继续执行后续 task，这通过 next 函数实现。</li>
</ul>
<p>题目来源：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/98">Daily-Interview-Question 第 56 题</a></p>
<h3 id="实现一个-new"><a href="#实现一个-new" class="headerlink" title="实现一个 new"></a>实现一个 new</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_new</span>(<span class="params">fn, ...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> obj = <span class="built_in">Object</span>.create(fn.prototype);</span><br><span class="line">  <span class="keyword">const</span> ret = fn.apply(obj, args);</span><br><span class="line">  <span class="keyword">return</span> ret <span class="keyword">instanceof</span> <span class="built_in">Object</span> ? ret : obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">  <span class="built_in">this</span>.sayHi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.run = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(_new(Person, <span class="string">&#x27;Lance&#x27;</span>, <span class="number">19</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Person(<span class="string">&#x27;Jerry&#x27;</span>, <span class="number">20</span>));</span><br></pre></td></tr></table></figure>

<h3 id="实现一个单例"><a href="#实现一个单例" class="headerlink" title="实现一个单例"></a>实现一个单例</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> Singleton = <span class="function"><span class="keyword">function</span> (<span class="params">Fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _instance = <span class="literal">null</span>;</span><br><span class="line">  Singleton = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_instance) <span class="keyword">return</span> _instance;</span><br><span class="line">    <span class="keyword">return</span> (_instance = <span class="keyword">new</span> Fn(...args));</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> Singleton;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> peopleSingleton = Singleton(Person);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ming = <span class="keyword">new</span> peopleSingleton(<span class="string">&#x27;ming&#x27;</span>, <span class="number">18</span>);</span><br><span class="line"><span class="keyword">var</span> fang = <span class="keyword">new</span> peopleSingleton(<span class="string">&#x27;fang&#x27;</span>, <span class="number">28</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(ming, fang);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, age</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> People.instance === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> People.instance;</span><br><span class="line">    &#125;</span><br><span class="line">    People.instance = <span class="built_in">this</span>;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ming = <span class="keyword">new</span> People(<span class="string">&#x27;ming&#x27;</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">var</span> fang = <span class="keyword">new</span> People(<span class="string">&#x27;fang&#x27;</span>, <span class="number">19</span>);</span><br><span class="line"><span class="built_in">console</span>.log(ming, fang);</span><br></pre></td></tr></table></figure>

<h2 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h2><h3 id="实现一个-sleep-函数"><a href="#实现一个-sleep-函数" class="headerlink" title="实现一个 sleep 函数"></a>实现一个 sleep 函数</h3><p>比如 sleep(1000) 意味着等待 1000 毫秒，可从 Promise、Generator、Async/Await 等角度实现。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Promise</span></span><br><span class="line"><span class="keyword">const</span> sleep = <span class="function"><span class="params">delay</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, delay));</span><br><span class="line">sleep(<span class="number">1000</span>).then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;Done&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generator</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">sleepGenerator</span>(<span class="params">delay</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, delay));</span><br><span class="line">&#125;</span><br><span class="line">sleepGenerator(<span class="number">1000</span>)</span><br><span class="line">  .next()</span><br><span class="line">  .value.then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;Done&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// async / await</span></span><br><span class="line"><span class="keyword">const</span> sleep = <span class="function"><span class="params">delay</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, delay));</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> sleep(<span class="number">1000</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Done&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">output();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">cb, delay</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> cb === <span class="string">&#x27;function&#x27;</span>) <span class="built_in">setTimeout</span>(cb, delay);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Done&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">sleep(output, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Promise-和-setTimeout-的区别？"><a href="#Promise-和-setTimeout-的区别？" class="headerlink" title="Promise 和 setTimeout 的区别？"></a>Promise 和 setTimeout 的区别？</h3><p>Promise 是微任务，setTimeout 是宏任务，同一个事件循环中，promise.then 总是先于 setTimeout 执行。</p>
<h3 id="Promise-构造函数是同步还是异步执行？then-呢？Promise-如何实现-then-处理？"><a href="#Promise-构造函数是同步还是异步执行？then-呢？Promise-如何实现-then-处理？" class="headerlink" title="Promise 构造函数是同步还是异步执行？then 呢？Promise 如何实现 then 处理？"></a>Promise 构造函数是同步还是异步执行？then 呢？Promise 如何实现 then 处理？</h3><p>Promise 的构造函数是同步执行的；then 中的方法是异步执行的。</p>
<p>Promise 实现 then 处理：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> PENDING = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> self = <span class="built_in">this</span>;</span><br><span class="line">  self.status = PENDING;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//成功的回调</span></span><br><span class="line">  self.onFulfilled = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">//失败的回调</span></span><br><span class="line">  self.onRejected = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">//PromiseA+ 2.1</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (self.status === PENDING) &#123;</span><br><span class="line">      self.status = FULFILLED;</span><br><span class="line">      self.value = value;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//PromiseA+ 2.2.6.1</span></span><br><span class="line">      self.onFulfilled.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (self.status === PENDING) &#123;</span><br><span class="line">      self.status = REJECTED;</span><br><span class="line">      self.reason = reason;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//PromiseA+ 2.2.6.2</span></span><br><span class="line">      self.onRejected.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    executor(resolve, reject);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    reject(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//PromiseA+ 2.2.1 / PromiseA+ 2.2.5 / PromiseA+ 2.2.7.3 / PromiseA+ 2.2.7.4</span></span><br><span class="line">  onFulfilled =</span><br><span class="line">    <span class="keyword">typeof</span> onFulfilled === <span class="string">&#x27;function&#x27;</span> ? onFulfilled : <span class="function"><span class="params">value</span> =&gt;</span> value;</span><br><span class="line">  onRejected =</span><br><span class="line">    <span class="keyword">typeof</span> onRejected === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">      ? onRejected</span><br><span class="line">      : <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> reason;</span><br><span class="line">        &#125;;</span><br><span class="line">  <span class="keyword">let</span> self = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//PromiseA+ 2.2.7</span></span><br><span class="line">  <span class="keyword">let</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (self.status === FULFILLED) &#123;</span><br><span class="line">      <span class="comment">//PromiseA+ 2.2.2</span></span><br><span class="line">      <span class="comment">//PromiseA+ 2.2.4 --- setTimeout</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//PromiseA+ 2.2.7.1</span></span><br><span class="line">          <span class="keyword">let</span> x = onFulfilled(self.value);</span><br><span class="line">          resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="comment">//PromiseA+ 2.2.7.2</span></span><br><span class="line">          reject(e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (self.status === REJECTED) &#123;</span><br><span class="line">      <span class="comment">//PromiseA+ 2.2.3</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> x = onRejected(self.reason);</span><br><span class="line">          resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          reject(e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (self.status === PENDING) &#123;</span><br><span class="line">      self.onFulfilled.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> x = onFulfilled(self.value);</span><br><span class="line">            resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            reject(e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">      self.onRejected.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> x = onRejected(self.reason);</span><br><span class="line">            resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            reject(e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> promise2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="实现一个基本的-Promise"><a href="#实现一个基本的-Promise" class="headerlink" title="实现一个基本的 Promise"></a>实现一个基本的 Promise</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">fn</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.resolvedCallbacks = [];</span><br><span class="line">    <span class="built_in">this</span>.rejectedCallbacks = [];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.state = <span class="string">&#x27;PENDING&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.value = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    fn(<span class="built_in">this</span>.resolve.bind(<span class="built_in">this</span>), <span class="built_in">this</span>.reject.bind(<span class="built_in">this</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">resolve</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.state === <span class="string">&#x27;PENDING&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.state = <span class="string">&#x27;RESOLVED&#x27;</span>;</span><br><span class="line">      <span class="built_in">this</span>.value = value;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.resolvedCallbacks.map(<span class="function"><span class="params">cb</span> =&gt;</span> cb(value));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">reject</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.state === <span class="string">&#x27;PENDING&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.state = <span class="string">&#x27;REJECTED&#x27;</span>;</span><br><span class="line">      <span class="built_in">this</span>.value = value;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.rejectedCallbacks.map(<span class="function"><span class="params">cb</span> =&gt;</span> cb(value));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.state === <span class="string">&#x27;PENDING&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.resolvedCallbacks.push(onFulfilled);</span><br><span class="line">      <span class="built_in">this</span>.rejectedCallbacks.push(onRejected);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.state === <span class="string">&#x27;RESOLVED&#x27;</span>) &#123;</span><br><span class="line">      onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.state === <span class="string">&#x27;REJECTED&#x27;</span>) &#123;</span><br><span class="line">      onRejected(<span class="built_in">this</span>.value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何实现-Promise-all"><a href="#如何实现-Promise-all" class="headerlink" title="如何实现 Promise.all()"></a>如何实现 Promise.all()</h3><p>首先，需要知道 Promise.all() 的功能：</p>
<ul>
<li>如果传入的参数是一个空的可迭代对象，那么此 promise 对象回调完成（resolve），只有此情况，是同步执行的，其它都是异步返回的。</li>
<li>如果传入的参数不包含任何 promise，则返回一个异步完成。promises 中所有的 promise 都“完成”时或参数中不包含 promise 时回调完成。</li>
<li>如果参数中有一个 promise 失败，那么 Promise.all 返回的 promise 对象失败。</li>
<li>在任何情况下，Promise.all 返回的 promise 的完成状态的结果都是一个数组。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.all = <span class="function"><span class="keyword">function</span> (<span class="params">promises</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> result = [];</span><br><span class="line">    <span class="keyword">if</span> (promises.length === <span class="number">0</span>) &#123;</span><br><span class="line">      resolve(result);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">processValue</span>(<span class="params">i, data</span>) </span>&#123;</span><br><span class="line">        result[i] = data;</span><br><span class="line">        <span class="keyword">if</span> (++index === promises.length) &#123;</span><br><span class="line">          esolve(result);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promises.length; i++) &#123;</span><br><span class="line">        <span class="comment">//promises[i] 可能是普通值</span></span><br><span class="line">        <span class="built_in">Promise</span>.resolve(promises[i]).then(</span><br><span class="line">          data =&gt; &#123;</span><br><span class="line">            processValue(i, data);</span><br><span class="line">          &#125;,</span><br><span class="line">          err =&gt; &#123;</span><br><span class="line">            reject(err);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="如何实现-Promise-prototype-finally-？"><a href="#如何实现-Promise-prototype-finally-？" class="headerlink" title="如何实现 Promise.prototype.finally() ？"></a>如何实现 Promise.prototype.finally() ？</h3><p>不管成功还是失败，都会走到 finally 中,并且 finally 之后，还可以继续 then。并且会将值原封不动的传递给后面的 then。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.prototype.finally = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.then(</span><br><span class="line">    value =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(callback()).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(callback()).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>题目来源：<a href="https://mp.weixin.qq.com/s/9T6ebHhof4DIQw3pXHytdQ">2019 前端面试 | “HTML + CSS + JS”专题</a>「《ES6 速学：⑤ Promise 对象》[编号：es6_05]」</p>
<h2 id="Event-Loop-amp-setTimeout"><a href="#Event-Loop-amp-setTimeout" class="headerlink" title="Event Loop &amp; setTimeout"></a>Event Loop &amp; setTimeout</h2><h3 id="setTimeout-的机制"><a href="#setTimeout-的机制" class="headerlink" title="setTimeout 的机制"></a>setTimeout 的机制</h3><p>等到当前脚本的同步任务和 “任务队列” 中已有的事件，全部处理完以后，才会执行 setTimeout 指定的任务。</p>
<p>参考：<a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html">JavaScript 运行机制详解：再谈 Event Loop</a></p>
<h3 id="使用-setTimeout-模拟-setInterval"><a href="#使用-setTimeout-模拟-setInterval" class="headerlink" title="使用 setTimeout 模拟 setInterval"></a>使用 setTimeout 模拟 setInterval</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 可避免setInterval因执行时间导致的间隔执行时间不一致</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="built_in">arguments</span>.callee, <span class="number">500</span>);</span><br><span class="line">&#125;, <span class="number">500</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Event-Loop"><a href="#Event-Loop" class="headerlink" title="Event Loop"></a>Event Loop</h3><p>有关 Event Loop 相关的概念和面试题可参考我的博客：<a href="https://evestorm.github.io/posts/10505/">Event Loop 学习笔记</a></p>
<h3 id="自我测验"><a href="#自我测验" class="headerlink" title="自我测验"></a>自我测验</h3><p>上面两篇文章阅读完毕后可以自我测验下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//请写出输出内容</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;async1 start&#x27;</span>);</span><br><span class="line">  <span class="keyword">await</span> async2();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;async1 end&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;async2&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;script start&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">async1();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise1&#x27;</span>);</span><br><span class="line">  resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise2&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;script end&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>题目出处和答案参考：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/7">从一道题浅说 JavaScript 的事件循环</a></p>
<h2 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h2><h3 id="getElementsByClassName-和-querySelectorAll-的区别"><a href="#getElementsByClassName-和-querySelectorAll-的区别" class="headerlink" title="getElementsByClassName 和 querySelectorAll 的区别"></a>getElementsByClassName 和 querySelectorAll 的区别</h3><ul>
<li><p>参数上：querySelectorAll 方法接收的参数是一个 CSS 选择符。而 getElementsBy 系列接收的参数只能是单一的 className、tagName 和 name</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> c1 = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;.b1 .c&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> c2 = <span class="built_in">document</span>.getElementsByClassName(<span class="string">&#x27;c&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> c3 = <span class="built_in">document</span>.getElementsByClassName(<span class="string">&#x27;b2&#x27;</span>)[<span class="number">0</span>].getElementsByClassName(<span class="string">&#x27;c&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回值上：querySelectorAll 返回的是一个 Static Node List，而 getElementsBy 系列的返回的是一个 Live Node List</p>
</li>
</ul>
<p>参考：</p>
<ul>
<li><a href="https://www.zhihu.com/question/24702250">querySelectorAll 方法相比 getElementsBy 系列方法有什么区别？</a></li>
<li><a href="https://segmentfault.com/a/1190000008829267">静态 NodeList 和 动态 NodeList 的区别</a></li>
</ul>
<h3 id="原生-JS-添加类"><a href="#原生-JS-添加类" class="headerlink" title="原生 JS 添加类"></a>原生 JS 添加类</h3><ul>
<li>element.setAttribute(“class”, ‘Lance’)</li>
<li>element.className = “lance awesome”</li>
<li>追加类：element.setAttribute(“class”, element.getAttribute(“class”) + “ “ + “lance”)</li>
</ul>
<h3 id="编写一个可拖拽的-div"><a href="#编写一个可拖拽的-div" class="headerlink" title="编写一个可拖拽的 div"></a>编写一个可拖拽的 div</h3><blockquote>
<p>HTML</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;sw&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#sw</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>JS</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> flag = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">var</span> position = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> sw = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#sw&#x27;</span>);</span><br><span class="line">sw.addEventListener(<span class="string">&#x27;mousedown&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  flag = <span class="literal">true</span>;</span><br><span class="line">  position = [e.clientX, e.clientY];</span><br><span class="line">  <span class="built_in">console</span>.log(e.clientX, e.clientY);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 这里监听 document ，如果监听 sw 则会有快速拖动导致鼠标「脱离」 div 的 bug</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&#x27;mousemove&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!flag) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">var</span> x = e.clientX;</span><br><span class="line">  <span class="keyword">var</span> y = e.clientY;</span><br><span class="line">  <span class="keyword">var</span> moveX = x - position[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">var</span> moveY = y - position[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">var</span> left = <span class="built_in">parseInt</span>(sw.style.left || <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">var</span> top = <span class="built_in">parseInt</span>(sw.style.top || <span class="number">0</span>);</span><br><span class="line">  <span class="comment">// 注意 style.left 带 px 单位</span></span><br><span class="line">  sw.style.left = left + moveX + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">  sw.style.top = top + moveY + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">  position = [x, y];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&#x27;mouseup&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  flag = <span class="literal">false</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="预测执行结果"><a href="#预测执行结果" class="headerlink" title="预测执行结果"></a>预测执行结果</h2><h3 id="下面代码打印结果是什么？为什么"><a href="#下面代码打印结果是什么？为什么" class="headerlink" title="下面代码打印结果是什么？为什么?"></a>下面代码打印结果是什么？为什么?</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="number">10</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  b = <span class="number">20</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(b);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>答案：</p>
<ul>
<li>非严格模式：[Function b]</li>
<li>严格模式：<code>Uncaught TypeError: Assignment to constant variable</code></li>
</ul>
<p>解析：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="number">10</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 内部作用域，会先去查找是有已有变量b的声明，有就直接赋值20，确实有了呀。发现了具名函数 function b()&#123;&#125;，拿此b做赋值；</span></span><br><span class="line">  <span class="comment">// IIFE的函数无法进行赋值（内部机制，类似const定义的常量），所以无效。</span></span><br><span class="line">  <span class="comment">// （这里说的“内部机制”，想搞清楚，需要去查阅一些资料，弄明白IIFE在JS引擎的工作方式，堆栈存储IIFE的方式等）</span></span><br><span class="line">  b = <span class="number">20</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(b); <span class="comment">// [Function b]</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">window</span>.b); <span class="comment">// 10，不是20</span></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">// 严格模式下能看到错误：Uncaught TypeError: Assignment to constant variable</span></span><br></pre></td></tr></table></figure>

<p>其他情况例子：</p>
<p>有<code>window</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="number">10</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">window</span>.b = <span class="number">20</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(b); <span class="comment">// [Function b]</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">window</span>.b); <span class="comment">// 20是必然的</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>有<code>var</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="number">10</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="number">20</span>; <span class="comment">// IIFE内部变量</span></span><br><span class="line">  <span class="built_in">console</span>.log(b); <span class="comment">// 20</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">window</span>.b); <span class="comment">// 10</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/48#issuecomment-472695263">解析来源 ←</a></p>
<h3 id="输出以下代码执行的结果并解释为什么"><a href="#输出以下代码执行的结果并解释为什么" class="headerlink" title="输出以下代码执行的结果并解释为什么"></a>输出以下代码执行的结果并解释为什么</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="number">2</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="number">3</span>: <span class="number">4</span>,</span><br><span class="line">  length: <span class="number">2</span>,</span><br><span class="line">  splice: <span class="built_in">Array</span>.prototype.splice,</span><br><span class="line">  push: <span class="built_in">Array</span>.prototype.push</span><br><span class="line">&#125;;</span><br><span class="line">obj.push(<span class="number">1</span>);</span><br><span class="line">obj.push(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://user-images.githubusercontent.com/26674103/55368589-3605a000-5525-11e9-8c20-c5aeea6b1880.png" alt="screenshots"></p>
<p>解析参考：</p>
<blockquote>
<p>结果最后变为一个稀疏数组[,,1,2]。<br>因为在对象中加入 splice 属性方法，和 length 属性后。这个对象变成一个类数组。属性名称可转换为数字时，会映射成为索引下标。所以对象实际可这样描述：[,,3,4],然后继续执行 length 属性复制，length 原来值为 4，length：2 语句将数组截断成为长度为 2 的数组。此时数组为[,,]。接着 push（1）、push (2)。数组追加两个值，[,,1,2]。小菜看法，有错望指正！！！</p>
</blockquote>
<p>参考来源：</p>
<ul>
<li><a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/76">Daily-Interview-Question 第 46 题</a></li>
<li><a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/75">小菜解析</a></li>
</ul>
<h3 id="输出以下代码的执行结果并解释为什么"><a href="#输出以下代码的执行结果并解释为什么" class="headerlink" title="输出以下代码的执行结果并解释为什么"></a>输出以下代码的执行结果并解释为什么</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">n</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> b = a;</span><br><span class="line">a.x = a = &#123; <span class="attr">n</span>: <span class="number">2</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a.x);</span><br><span class="line"><span class="built_in">console</span>.log(b.x);</span><br></pre></td></tr></table></figure>

<p>答案：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">a.x; <span class="comment">// --&gt; undefined</span></span><br><span class="line">b.x; <span class="comment">// --&gt; &#123;n: 2&#125;</span></span><br></pre></td></tr></table></figure>

<p>解析：</p>
<ul>
<li>1、优先级<code>.</code>的优先级高于<code>=</code>，所以先执行<code>a.x</code>，堆内存中的<code>&#123;n: 1&#125;</code>就会变成<code>&#123;n: 1, x: undefined&#125;</code>，改变之后相应的<code>b.x</code>也变化了，因为指向的是同一个对象。</li>
<li>2、赋值操作是<code>从右到左</code>，所以先执行<code>a = &#123;n: 2&#125;</code>，<code>a</code>的引用就被改变了，然后这个返回值又赋值给了<code>a.x</code>，<strong>需要注意</strong>的是这时候<code>a.x</code>是第一步中的<code>&#123;n: 1, x: undefined&#125;</code>那个对象，其实就是<code>b.x</code>，相当于<code>b.x = &#123;n: 2&#125;</code></li>
</ul>
<p>题目来源：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/93">Daily-Interview-Question 第 53 题</a></p>
<h3 id="输出以下代码运行结果"><a href="#输出以下代码运行结果" class="headerlink" title="输出以下代码运行结果"></a>输出以下代码运行结果</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// example 1</span></span><br><span class="line"><span class="keyword">var</span> a=&#123;&#125;, b=<span class="string">&#x27;123&#x27;</span>, c=<span class="number">123</span>;</span><br><span class="line">a[b]=<span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">a[c]=<span class="string">&#x27;c&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a[b]);</span><br><span class="line"></span><br><span class="line">---------------------</span><br><span class="line"><span class="comment">// example 2</span></span><br><span class="line"><span class="keyword">var</span> a=&#123;&#125;, b=<span class="built_in">Symbol</span>(<span class="string">&#x27;123&#x27;</span>), c=<span class="built_in">Symbol</span>(<span class="string">&#x27;123&#x27;</span>);</span><br><span class="line">a[b]=<span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">a[c]=<span class="string">&#x27;c&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a[b]);</span><br><span class="line"></span><br><span class="line">---------------------</span><br><span class="line"><span class="comment">// example 3</span></span><br><span class="line"><span class="keyword">var</span> a=&#123;&#125;, b=&#123;<span class="attr">key</span>:<span class="string">&#x27;123&#x27;</span>&#125;, c=&#123;<span class="attr">key</span>:<span class="string">&#x27;456&#x27;</span>&#125;;</span><br><span class="line">a[b]=<span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">a[c]=<span class="string">&#x27;c&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a[b]);</span><br></pre></td></tr></table></figure>

<p>分析：这题考察的是对象的键名的转换。</p>
<ul>
<li>对象的键名只能是字符串和 Symbol 类型。</li>
<li>其他类型的键名会被转换成字符串类型。</li>
<li>对象转字符串默认会调用 toString 方法。</li>
</ul>
<p>解答：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// example 1</span></span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;,</span><br><span class="line">  b = <span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">  c = <span class="number">123</span>;</span><br><span class="line">a[b] = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// c 的键名会被转换成字符串&#x27;123&#x27;，这里会把 b 覆盖掉。</span></span><br><span class="line">a[c] = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出 c</span></span><br><span class="line"><span class="built_in">console</span>.log(a[b]);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// example 2</span></span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;,</span><br><span class="line">  b = <span class="built_in">Symbol</span>(<span class="string">&#x27;123&#x27;</span>),</span><br><span class="line">  c = <span class="built_in">Symbol</span>(<span class="string">&#x27;123&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// b 是 Symbol 类型，不需要转换。</span></span><br><span class="line">a[b] = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// c 是 Symbol 类型，不需要转换。任何一个 Symbol 类型的值都是不相等的，所以不会覆盖掉 b。</span></span><br><span class="line">a[c] = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出 b</span></span><br><span class="line"><span class="built_in">console</span>.log(a[b]);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// example 3</span></span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;,</span><br><span class="line">  b = &#123; <span class="attr">key</span>: <span class="string">&#x27;123&#x27;</span> &#125;,</span><br><span class="line">  c = &#123; <span class="attr">key</span>: <span class="string">&#x27;456&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b 不是字符串也不是 Symbol 类型，需要转换成字符串。</span></span><br><span class="line"><span class="comment">// 对象类型会调用 toString 方法转换成字符串 [object Object]。</span></span><br><span class="line">a[b] = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// c 不是字符串也不是 Symbol 类型，需要转换成字符串。</span></span><br><span class="line"><span class="comment">// 对象类型会调用 toString 方法转换成字符串 [object Object]。这里会把 b 覆盖掉。</span></span><br><span class="line">a[c] = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出 c</span></span><br><span class="line"><span class="built_in">console</span>.log(a[b]);</span><br></pre></td></tr></table></figure>

<p>题目来源：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/125">Daily-Interview-Question 第 76 题</a></p>
<h3 id="请写出如下代码的打印结果"><a href="#请写出如下代码的打印结果" class="headerlink" title="请写出如下代码的打印结果"></a>请写出如下代码的打印结果</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  Foo.a = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">this</span>.a = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">Foo.prototype.a = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;;</span><br><span class="line">Foo.a = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line">&#125;;</span><br><span class="line">Foo.a();</span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> Foo();</span><br><span class="line">obj.a();</span><br><span class="line">Foo.a();</span><br></pre></td></tr></table></figure>

<p>解答：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  Foo.a = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">this</span>.a = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 以上只是 Foo 的构建方法，没有产生实例，此刻也没有执行</span></span><br><span class="line"></span><br><span class="line">Foo.prototype.a = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 现在在 Foo 上挂载了原型方法 a ，方法输出值为 3</span></span><br><span class="line"></span><br><span class="line">Foo.a = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 现在在 Foo 上挂载了直接方法 a ，输出值为 4</span></span><br><span class="line"></span><br><span class="line">Foo.a();</span><br><span class="line"><span class="comment">// 立刻执行了 Foo 上的 a 方法，也就是刚刚定义的，所以</span></span><br><span class="line"><span class="comment">// # 输出 4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="comment">/* 这里调用了 Foo 的构建方法。Foo 的构建方法主要做了两件事：</span></span><br><span class="line"><span class="comment">1. 将全局的 Foo 上的直接方法 a 替换为一个输出 1 的方法。</span></span><br><span class="line"><span class="comment">2. 在新对象上挂载直接方法 a ，输出值为 2。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">obj.a();</span><br><span class="line"><span class="comment">// 因为有直接方法 a ，不需要去访问原型链，所以使用的是构建方法里所定义的 this.a，</span></span><br><span class="line"><span class="comment">// # 输出 2</span></span><br><span class="line"></span><br><span class="line">Foo.a();</span><br><span class="line"><span class="comment">// 构建方法里已经替换了全局 Foo 上的 a 方法，所以</span></span><br><span class="line"><span class="comment">// # 输出 1</span></span><br></pre></td></tr></table></figure>

<p>题目来源：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/155">Daily-Interview-Question 第 100 题</a></p>
<h3 id="分别写出如下代码的返回值"><a href="#分别写出如下代码的返回值" class="headerlink" title="分别写出如下代码的返回值"></a>分别写出如下代码的返回值</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">String</span>(<span class="string">&#x27;11&#x27;</span>) == <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">&#x27;11&#x27;</span>);</span><br><span class="line"><span class="built_in">String</span>(<span class="string">&#x27;11&#x27;</span>) === <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">&#x27;11&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>解析：</p>
<p>返回 true 和 false<br><code>new String()</code> 返回的是对象<br><code>==</code> 的时候，实际运行的是：<br><code>String(&#39;11&#39;) == new String(&#39;11&#39;).toString();</code></p>
<h3 id="输出以下代码运行结果-1"><a href="#输出以下代码运行结果-1" class="headerlink" title="输出以下代码运行结果"></a>输出以下代码运行结果</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> * <span class="string">&#x27;2&#x27;</span>[(<span class="number">1</span>, <span class="number">2</span>)] + [<span class="number">2</span>, <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;a&#x27;</span> + +<span class="string">&#x27;b&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>解析：</p>
<ul>
<li>1 + “1”</li>
</ul>
<p>加性操作符：如果只有一个操作数是字符串，则将另一个操作数转换为字符串，然后再将两个字符串拼接起来</p>
<p>所以值为：“11”</p>
<ul>
<li>2 * “2”</li>
</ul>
<p>乘性操作符：如果有一个操作数不是数值，则在后台调用 Number()将其转换为数值</p>
<ul>
<li>[1, 2] + [2, 1]</li>
</ul>
<p>Javascript 中所有对象基本都是先调用<code>valueOf</code>方法，如果不是数值，再调用<code>toString</code>方法。</p>
<p>所以两个数组对象的 toString 方法相加，值为：”1,22,1”</p>
<ul>
<li>“a” + + “b”</li>
</ul>
<p>后边的“+”将作为一元操作符，如果操作数是字符串，将调用 Number 方法将该操作数转为数值，如果操作数无法转为数值，则为 NaN。</p>
<p>所以值为：”aNaN”</p>
<p>以上均参考：《Javascript 高级程序设计》</p>
<p>题目来源：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/229">Daily-Interview-Question 第 116 题</a></p>
<h3 id="下方-js-执行后的打印值为？"><a href="#下方-js-执行后的打印值为？" class="headerlink" title="下方 js 执行后的打印值为？"></a>下方 js 执行后的打印值为？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.length = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.length); <span class="comment">// 输出多少？</span></span><br><span class="line">  &#125;;</span><br><span class="line">  arr = [fn, <span class="string">&#x27;hello layui&#x27;</span>];</span><br><span class="line">  fn.length = <span class="number">100</span>;</span><br><span class="line">  arr[<span class="number">0</span>]();</span><br><span class="line">&#125;</span><br><span class="line">demo();</span><br></pre></td></tr></table></figure>

<p>答案：2</p>
<p>解析：this 指向问题一般看谁在调用就 OK 了，在上述函数中，fn 的拥有者是 arr 并且也是它调用的，所以 this 指向 arr，arr 中有两个成员，length 为 2。</p>
<h4 id="延伸"><a href="#延伸" class="headerlink" title="延伸"></a>延伸</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">fn.length = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(fn.length); <span class="comment">// length 为多少？</span></span><br></pre></td></tr></table></figure>

<p>答案：0</p>
<p>解析：length 是 js 函数对象的一个属性值，该值是指 “该函数有多少个必须要传入的参数”，即形参的个数。形参的数量不包括剩余参数个数，仅包括 “第一个具有默认值之前的参数个数”，然而 fn 不需要传递参数，length 为 0。</p>
<p>拓展阅读：<a href="https://www.cnblogs.com/go4it/p/9678028.html">JS 中函数的 length 属性</a></p>
<h3 id="和-的-valueOf-和-toString-的结果是什么？"><a href="#和-的-valueOf-和-toString-的结果是什么？" class="headerlink" title="{} 和 [] 的 valueOf 和 toString 的结果是什么？"></a>{} 和 [] 的 valueOf 和 toString 的结果是什么？</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;&#125; 的 valueOf 结果为 &#123;&#125; ，toString 的结果为 &quot;[object Object]&quot; [] 的 valueOf</span><br><span class="line">结果为 [] ，toString 的结果为 &quot;&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>toString 是把对象转换为字符串；</li>
<li>valueOf 是把对象转换 du 成一个基 zhi 本数据的值</li>
<li>valueOf 偏向 dao 于运算，toString 偏向于显示。</li>
</ul>
<ol>
<li>在进行对象转换时（例如:alert(a)）,将优先调用 toString 方法，如若没有重写 toString 将调用 valueOf 方法，如果两方法都没有重写，按 Object 的 toString 输出。</li>
<li>在进行强转字符串类型时将优先调用 toString 方法，强转为数字时优先调用 valueOf。</li>
<li>在有运算操作符的情况下，valueOf 的优先级高于 toString。</li>
</ol>
<h3 id="预测下面的输出是什么"><a href="#预测下面的输出是什么" class="headerlink" title="预测下面的输出是什么"></a>预测下面的输出是什么</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">firstName, lastName</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">  <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> member = <span class="keyword">new</span> Person(<span class="string">&#x27;Lydia&#x27;</span>, <span class="string">&#x27;Hallie&#x27;</span>);</span><br><span class="line">Person.getFullName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.firstName&#125;</span> <span class="subst">$&#123;<span class="built_in">this</span>.lastName&#125;</span>`</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(member.getFullName());</span><br></pre></td></tr></table></figure>

<ul>
<li>A: <code>TypeError</code></li>
<li>B: <code>SyntaxError</code></li>
<li>C: <code>Lydia Hallie</code></li>
<li>D: <code>undefined</code> <code>undefined</code></li>
</ul>
<p>解析：</p>
<p>答案是 A</p>
<ol>
<li>getFullName 函数是赋值给 Person 的，没有赋值给 Person 的原型，所以 member 并没有 getFullName 这个函数，这样运行会报错</li>
<li>如果这里运行的是 Person.getFullName() 那么会得到两个 undefined</li>
<li>如果写了 Person.prototype.getFullName = …. 此时调用 member.getFullName 函数 会得到答案 C</li>
</ol>
<h3 id="下面的输出是什么？"><a href="#下面的输出是什么？" class="headerlink" title="下面的输出是什么？"></a>下面的输出是什么？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chameleon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">colorChange</span>(<span class="params">newColor</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.newColor = newColor;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.newColor;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">&#123; newColor = <span class="string">&#x27;green&#x27;</span> &#125; = &#123;&#125;</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.newColor = newColor;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> freddie = <span class="keyword">new</span> Chameleon(&#123; <span class="attr">newColor</span>: <span class="string">&#x27;purple&#x27;</span> &#125;);</span><br><span class="line">freddie.colorChange(<span class="string">&#x27;orange&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>A: <code>orange</code></li>
<li>B: <code>purple</code></li>
<li>C: <code>green</code></li>
<li>D: <code>TypeError</code></li>
</ul>
<p>解析：</p>
<p>colorChange 是静态方法不是实例方法，需要 Chameleon.colorChange 才能调用</p>
<h3 id="输出是什么？"><a href="#输出是什么？" class="headerlink" title="输出是什么？"></a>输出是什么？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> shape = &#123;</span><br><span class="line">  radius: <span class="number">10</span>,</span><br><span class="line">  <span class="function"><span class="title">diameter</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.radius * <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  perimeter: <span class="function">() =&gt;</span> <span class="number">2</span> * <span class="built_in">Math</span>.PI * <span class="built_in">this</span>.radius</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">shape.diameter();</span><br><span class="line">shape.perimeter();</span><br></pre></td></tr></table></figure>

<ul>
<li>A: <code>20</code> and <code>62.83185307179586</code></li>
<li>B: <code>20</code> and <code>NaN</code></li>
<li>C: <code>20</code> and <code>63</code></li>
<li>D: <code>NaN</code> and <code>63</code></li>
</ul>
<p>解析：</p>
<ol>
<li>shape 定义所在环境，是 window 对象。</li>
<li>diameter 方法中的 this 指向方法调用者，即 shape。</li>
<li>perimeter 方法中的 this 指向方法调用者<strong>所在的环境</strong>，即 window 对象。</li>
</ol>
<h3 id="NaN-是什么，用-typeof-会输出什么？"><a href="#NaN-是什么，用-typeof-会输出什么？" class="headerlink" title="NaN 是什么，用 typeof 会输出什么？"></a>NaN 是什么，用 typeof 会输出什么？</h3><p>Not a Number，表示非数字，typeof NaN === ‘number’</p>
<h2 id="算法题"><a href="#算法题" class="headerlink" title="算法题"></a>算法题</h2><p>我面的都不是什么大公司，所以很少被问到算法，不过对于前端来说，了解一些基本的算法还是很有必要的，起码最常见的排序算法得掌握，例如冒泡和快排。这部分内容可参考我的博客：</p>
<ul>
<li><a href="https://evestorm.github.io/posts/59937/">常见排序算法</a></li>
</ul>
<h3 id="使用递归完成-1-到-100-的累加？"><a href="#使用递归完成-1-到-100-的累加？" class="headerlink" title="使用递归完成 1 到 100 的累加？"></a>使用递归完成 1 到 100 的累加？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (num === <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> num + fn(num - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(fn(<span class="number">100</span>));</span><br></pre></td></tr></table></figure>

<h2 id="正则"><a href="#正则" class="headerlink" title="正则"></a>正则</h2><p>对正则不太熟练的同学，在这儿我分享掘金的一篇教程。这篇教程对我来说真的是受益匪浅，希望也能帮助到你：</p>
<ul>
<li><a href="https://juejin.im/post/5965943ff265da6c30653879">JS 正则表达式完整教程（略长）</a></li>
</ul>
<h3 id="写一个函数-isValidUsername-str-，判断用户输入的是不是合法的用户名（长度-6-20-个字符，只能包括字母、数字、下划线）？"><a href="#写一个函数-isValidUsername-str-，判断用户输入的是不是合法的用户名（长度-6-20-个字符，只能包括字母、数字、下划线）？" class="headerlink" title="写一个函数 isValidUsername(str)，判断用户输入的是不是合法的用户名（长度 6-20 个字符，只能包括字母、数字、下划线）？"></a>写一个函数 isValidUsername(str)，判断用户输入的是不是合法的用户名（长度 6-20 个字符，只能包括字母、数字、下划线）？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isValidUsername</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^\w&#123;6,20&#125;$/</span>.test(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(isValidUsername(<span class="string">&#x27;swlance&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="写一个函数-isPhoneNum-str-，判断用户输入的是不是手机号？"><a href="#写一个函数-isPhoneNum-str-，判断用户输入的是不是手机号？" class="headerlink" title="写一个函数 isPhoneNum(str)，判断用户输入的是不是手机号？"></a>写一个函数 isPhoneNum(str)，判断用户输入的是不是手机号？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPhoneNum</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^1[3578]\d&#123;9&#125;$/g</span>.test(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(isPhoneNum(<span class="string">&#x27;13871455497&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="写一个函数-isEmail-str-，-判断用户输入的是不是邮箱？（e-g-x78-x78-x78-x40-x67-109-97-105-108-46-99-111-109-或者-120-120-x78-x40-x73-x77-108-97-x6e-99-101-x2e-99-111-109-x2e-x63-x6e-）"><a href="#写一个函数-isEmail-str-，-判断用户输入的是不是邮箱？（e-g-x78-x78-x78-x40-x67-109-97-105-108-46-99-111-109-或者-120-120-x78-x40-x73-x77-108-97-x6e-99-101-x2e-99-111-109-x2e-x63-x6e-）" class="headerlink" title="写一个函数 isEmail(str)， 判断用户输入的是不是邮箱？（e.g. &#x78;&#x78;&#x78;&#x40;&#x67;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109; 或者 &#120;&#120;&#x78;&#x40;&#x73;&#x77;&#108;&#97;&#x6e;&#99;&#101;&#x2e;&#99;&#111;&#109;&#x2e;&#x63;&#x6e;）"></a>写一个函数 isEmail(str)， 判断用户输入的是不是邮箱？（e.g. <a href="mailto:&#x78;&#x78;&#x78;&#x40;&#x67;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;">&#x78;&#x78;&#x78;&#x40;&#x67;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;</a> 或者 <a href="mailto:&#120;&#120;&#x78;&#x40;&#x73;&#x77;&#108;&#97;&#x6e;&#99;&#101;&#x2e;&#99;&#111;&#109;&#x2e;&#x63;&#x6e;">&#120;&#120;&#x78;&#x40;&#x73;&#x77;&#108;&#97;&#x6e;&#99;&#101;&#x2e;&#99;&#111;&#109;&#x2e;&#x63;&#x6e;</a>）</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEmail</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^\w+@\w+(\.\w+)&#123;1,2&#125;$/</span>.test(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(isEmail(<span class="string">&#x27;xxx@swlance.com.cn&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="写一个函数-trim-str-，去除字符串两边的空白字符？"><a href="#写一个函数-trim-str-，去除字符串两边的空白字符？" class="headerlink" title="写一个函数 trim(str)，去除字符串两边的空白字符？"></a>写一个函数 trim(str)，去除字符串两边的空白字符？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trim</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/^\s+|\s+$/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(trim(<span class="string">&#x27;     xxxswlance.cn        &#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>上述正则题目来源：<a href="https://juejin.im/post/5ce4171ff265da1bd04eb4f3#heading-6">2019 前端面试 | “HTML + CSS + JS”专题</a> 「《JS 提供的对象：② 正则表达式》[编号：js_17]」</p>
<h3 id="转化为驼峰命名"><a href="#转化为驼峰命名" class="headerlink" title="转化为驼峰命名"></a>转化为驼峰命名</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="string">&#x27;get-element-by-id&#x27;</span>;</span><br><span class="line"><span class="comment">// 转化为 getElementById</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/-\w/g</span>, <span class="function"><span class="params">x</span> =&gt;</span> x.slice(<span class="number">1</span>).toUpperCase());</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fn(s1));</span><br></pre></td></tr></table></figure>

<h2 id="场景题"><a href="#场景题" class="headerlink" title="场景题"></a>场景题</h2><h3 id="数学逻辑"><a href="#数学逻辑" class="headerlink" title="数学逻辑"></a>数学逻辑</h3><p>某果蔬平台商品设置与订单应付款的计算规则说明如下：</p>
<p>A.商品可被设置为不参与其他优惠活动，即不参与会员折扣、满减活动<br>B.会员价商品不参与其他优惠活动，即不参与会员折扣、满减活动<br>C.用户积分可抵扣，积分抵扣规则为 100 积分可抵扣 0.5 元<br>D.订单计算规则为：<br>Step 1：购物车中的商品分别计算参与优惠部分的商品总价与不参与优惠的商品总价；<br>Step 2：参与优惠的商品总价可参与满减活动<br>Step 3：上一步处理之后，参与优惠的商品总价可参与会员折扣<br>Step 4：所有商品总价，扣减掉积分可抵扣的部分得到订单应支付金额</p>
<p>该果蔬平台有一个商户 A，在后台创建了一个商品 fruit_a，定价为 10 元/KG。用户购买 3KG 商品，问下列各独立场景下，应付款几何？[需要写出结果与计算式，如下所示]</p>
<p>Eg. 商品设置了阶梯价，&gt;=3KG，价格为 8 元/KG；应付款 24=8*3 元</p>
<p>2.1 用户有 500 积分，店铺积分可抵扣，抵扣规则为 100 积分可抵扣 0.5 元；店铺设置有满减活动，满 20 元减 3 元；商品设置阶梯价，》=3KG，价格为 8 元/KG，则用户应付款为____元。（5.0 分）</p>
<p>2.2 用户有 500 积分，店铺积分可抵扣，抵扣规则为 100 积分可抵 0.5 元；商品设置会员价 8 元/KG，使用会员价必须使用余额支付；店铺设置有满减活动，满 20 元减 3 元；用户若实用余额支付应付款为_<strong>_元。若使用在线支付，则应付款为__</strong>元；（8.0 元）</p>
<p>2.3 用户有 500 积分，店铺积分不可抵扣，抵扣规则为 100 积分可抵 0.5 元；店铺有开启会员折扣，会员折扣为 8.5 折，使用会员折扣必须使用余额支付；店铺设置有满减活动，满 20 元减 3 元；用户若使用余额支付应付款为_<strong>_元，若使用在线支付，则应付款为__</strong>元;(8.0 分)</p>
<p>参考答案：</p>
<p>2.1<br>8×3-3-500/100×0.5=18.5 元</p>
<p>2.2<br>8×3-500/100×0.5=21.5 元<br>10×3-3-500/100×0.5=24.5 元</p>
<p>2.3<br>（10×3-3）×0.85=22.95 元<br>10×3-3=27 元</p>
<h2 id="非常规题"><a href="#非常规题" class="headerlink" title="非常规题"></a>非常规题</h2><h3 id="‘1’-‘2’-‘3’-map-parseInt-的结果"><a href="#‘1’-‘2’-‘3’-map-parseInt-的结果" class="headerlink" title="[‘1’, ‘2’, ‘3’].map(parseInt)的结果"></a>[‘1’, ‘2’, ‘3’].map(parseInt)的结果</h3><p>正确答案：[1, NaN, NaN]</p>
<p>答案解析：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/4">[‘1’, ‘2’, ‘3’].map(parseInt) what &amp; why ?</a></p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="修改以下-print-函数，使之输出-0-到-99，或者-99-到-0"><a href="#修改以下-print-函数，使之输出-0-到-99，或者-99-到-0" class="headerlink" title="修改以下 print 函数，使之输出 0 到 99，或者 99 到 0"></a>修改以下 print 函数，使之输出 0 到 99，或者 99 到 0</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(n);</span><br><span class="line">  &#125;, <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">1000</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">  print(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解答：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print0</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(n);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">1000</span>)</span><br><span class="line">  ); <span class="comment">//关闭延迟</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print1</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(</span><br><span class="line">    (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(n);</span><br><span class="line">    &#125;)(),</span><br><span class="line">    <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">1000</span>) <span class="comment">//自执行</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print2</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(--i);</span><br><span class="line">  &#125;, <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">1000</span>)); <span class="comment">//全局i</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print3</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// setTimeout(() =&gt; &#123;</span></span><br><span class="line">  <span class="built_in">console</span>.log(n);</span><br><span class="line">  <span class="comment">//&#125;, Math.floor(Math.random() * 1000)); //注释</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>题目来源：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/158">Daily-Interview-Question 第 101 题</a></p>
<h3 id="写一个通用的事件侦听器函数"><a href="#写一个通用的事件侦听器函数" class="headerlink" title="写一个通用的事件侦听器函数"></a>写一个通用的事件侦听器函数</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> EventUtils = &#123;</span><br><span class="line">  <span class="comment">// 视能力分别使用dom0||dom2||IE方式 来绑定事件</span></span><br><span class="line">  <span class="comment">// 添加事件</span></span><br><span class="line">  addEvent: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (element.addEventListener) &#123;</span><br><span class="line">      element.addEventListener(type, handler, <span class="literal">false</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.attachEvent) &#123;</span><br><span class="line">      element.attachEvent(<span class="string">&#x27;on&#x27;</span> + type, handler);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      element[<span class="string">&#x27;on&#x27;</span> + type] = handler;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 移除事件</span></span><br><span class="line">  removeEvent: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (element.removeEventListener) &#123;</span><br><span class="line">      element.removeEventListener(type, handler, <span class="literal">false</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.detachEvent) &#123;</span><br><span class="line">      element.detachEvent(<span class="string">&#x27;on&#x27;</span> + type, handler);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      element[<span class="string">&#x27;on&#x27;</span> + type] = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取事件目标</span></span><br><span class="line">  getTarget: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> event.target || event.srcElement;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取 event 对象的引用，取到事件的所有信息，确保随时能使用 event</span></span><br><span class="line">  getEvent: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> event || <span class="built_in">window</span>.event;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 阻止事件（主要是事件冒泡，因为 IE 不支持事件捕获）</span></span><br><span class="line">  stopPropagation: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event.stopPropagation) &#123;</span><br><span class="line">      event.stopPropagation();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      event.cancelBubble = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 取消事件的默认行为</span></span><br><span class="line">  preventDefault: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event.preventDefault) &#123;</span><br><span class="line">      event.preventDefault();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      event.returnValue = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>JS知识点（面试系列）</title>
    <url>/posts/31920/</url>
    <content><![CDATA[<h2 id="JS-类型"><a href="#JS-类型" class="headerlink" title="JS 类型"></a>JS 类型</h2><p>string，number，boolean，undefined，null，symbol（es6），BigInt（es10），object</p>
<h3 id="值类型和引用类型的区别"><a href="#值类型和引用类型的区别" class="headerlink" title="值类型和引用类型的区别"></a>值类型和引用类型的区别</h3><p>两种类型的区别是：存储位置不同；</p>
<ul>
<li>值类型存储在栈（stack）中，占空间小、大小固定，属于被频繁使用数据，所以放入栈中存储；</li>
<li>引用类型存储在堆（heap）中,占据空间大、大小不固定。如果存在栈中，影响程序运行性能；引用类型在栈中存储了指针，该指针指向堆中该实体的起始地址。当解释器寻找引用值时，会首先检索其在栈中的地址，取得地址后从堆中获得实体。</li>
</ul>
<img src="/posts/31920/1549856966458-39b2f008-64fc-4753-936b-e513a5de46d2.png" class="" title="js类型堆栈图">

<a id="more"></a>

<h3 id="JS-的类型检测"><a href="#JS-的类型检测" class="headerlink" title="JS 的类型检测"></a>JS 的类型检测</h3><ul>
<li><p>typeof （判断一个变量是什么类型）undefined object function boolean string number symbol</p>
</li>
<li><p>instanceof （判断当前对象是不是某个类型）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!-- 要检测的对象 <span class="keyword">instanceof</span> 某个构造函数 --&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params">make, model, year</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.make = make;</span><br><span class="line">    <span class="built_in">this</span>.model = model;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> auto = <span class="keyword">new</span> Car(<span class="string">&#x27;Honda&#x27;</span>, <span class="string">&#x27;Accord&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(auto <span class="keyword">instanceof</span> Car);</span><br><span class="line"><span class="comment">// expected output: true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(auto <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br><span class="line"><span class="comment">// expected output: true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Object.prototype.toString.call()（检测一个对象的类型）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="string">&#x27;Lance&#x27;</span>)); <span class="comment">//[object String]</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="和-的区别"><a href="#和-的区别" class="headerlink" title="=== 和 == 的区别"></a>=== 和 == 的区别</h3><p><code>==</code> 在允许强制转换的条件下检查值的等价性，而 <code>===</code> 是在不允许强制转换的条件下检查值的等价性；</p>
<p>因此 <code>===</code> 常被称为「严格等价」。（”55” == 55 true, “55” === 55 false。p.s. 把字符串转为数值）</p>
<h3 id="哪些非-boolean-值被强制转换为一个-boolean-时，它是-false-？"><a href="#哪些非-boolean-值被强制转换为一个-boolean-时，它是-false-？" class="headerlink" title="哪些非 boolean 值被强制转换为一个 boolean 时，它是 false ？"></a>哪些非 boolean 值被强制转换为一个 boolean 时，它是 false ？</h3><ul>
<li><code>&quot;&quot;</code>（空字符串）</li>
<li><code>0</code>, <code>-0</code>, <code>NaN</code> （非法的 <code>number</code> ）</li>
<li><code>null</code>, <code>undefined</code></li>
</ul>
<h3 id="null，undefined-的区别？"><a href="#null，undefined-的区别？" class="headerlink" title="null，undefined 的区别？"></a>null，undefined 的区别？</h3><ul>
<li>null 表示一个对象是「没有值」的值，也就是值为 “空”；</li>
<li>undefined 表示一个变量声明了没有初始化(赋值)；</li>
<li>undefined 的类型（typeof）是 undefined ；</li>
<li>null 的类型（typeof）是 object ；</li>
<li>JavaScript 将未赋值的变量默认值设为 undefined；</li>
<li>JavaScript 从来不会将变量设为 null 。它是用来让程序员表明某个用 var 声明的变量时没有值的。</li>
</ul>
<p>在验证 null 时，一定要使用　=== ，因为 == 无法分别 null 和 undefined</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="literal">null</span> == <span class="literal">undefined</span>; <span class="comment">// true</span></span><br><span class="line"><span class="literal">null</span> === <span class="literal">undefined</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h2 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h2><h3 id="DOM-操作——怎样添加、移除、移动、复制、创建和查找节点？"><a href="#DOM-操作——怎样添加、移除、移动、复制、创建和查找节点？" class="headerlink" title="DOM 操作——怎样添加、移除、移动、复制、创建和查找节点？"></a>DOM 操作——怎样添加、移除、移动、复制、创建和查找节点？</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">copy（1）创建新节点</span><br><span class="line">    createDocumentFragment()    &#x2F;&#x2F;创建一个DOM片段</span><br><span class="line">    createElement()   &#x2F;&#x2F;创建一个具体的元素</span><br><span class="line">    createTextNode()   &#x2F;&#x2F;创建一个文本节点</span><br><span class="line">（2）添加、移除、替换、插入</span><br><span class="line">    appendChild()</span><br><span class="line">    removeChild()</span><br><span class="line">    replaceChild()</span><br><span class="line">    insertBefore() &#x2F;&#x2F;在已有的子节点前插入一个新的子节点</span><br><span class="line">（3）查找</span><br><span class="line">    querySelector(&quot;ul&quot;) &#x2F; querySelectorAll(&quot;ul li&quot;) &#x2F;&#x2F; 查找单个元素 &#x2F; 多个元素</span><br><span class="line">    getElementsByTagName(&quot;div&quot;)</span><br><span class="line">    getElementsByClassName()</span><br><span class="line">    getElementById()</span><br></pre></td></tr></table></figure>

<h3 id="DOM-数操作"><a href="#DOM-数操作" class="headerlink" title="DOM 数操作"></a>DOM 数操作</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 添加新节点</span></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="built_in">document</span>.createElement(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">p1.innerHTML = <span class="string">&#x27;this is p1&#x27;</span>;</span><br><span class="line">div1.appendChild(p1); <span class="comment">// 添加新创建的元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 移动已有节点。注意，这里是“移动”，并不是拷贝</span></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;p2&#x27;</span>);</span><br><span class="line">div1.appendChild(p2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取父元素</span></span><br><span class="line"><span class="keyword">var</span> div1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;div1&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> parent = div1.parentElement;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取子元素</span></span><br><span class="line"><span class="keyword">var</span> div1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;div1&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> child = div1.childNodes;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除节点</span></span><br><span class="line"><span class="keyword">var</span> div1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;div1&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> child = div1.childNodes;</span><br><span class="line">div1.removeChild(child[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="offsetWidth-offsetHeight，clientWidth-clientHeight-与-scrollWidth-scrollHeight-的区别"><a href="#offsetWidth-offsetHeight，clientWidth-clientHeight-与-scrollWidth-scrollHeight-的区别" class="headerlink" title="offsetWidth/offsetHeight，clientWidth/clientHeight 与 scrollWidth/scrollHeight 的区别"></a>offsetWidth/offsetHeight，clientWidth/clientHeight 与 scrollWidth/scrollHeight 的区别</h3><ul>
<li><strong>offsetWidth/offsetHeight</strong> 返回值包含 content + padding + border，效果与 e.getBoundingClientRect() 相同；</li>
<li><strong>clientWidth/clientHeight</strong> 返回值只包含 content + padding，如果有滚动条，也不包含滚动条；</li>
<li><strong>scrollWidth/scrollHeight</strong> 返回值包含 content + padding + 溢出内容的尺寸。</li>
</ul>
<h3 id="什么是-Virtual-DOM，为何要用-Virtual-DOM？"><a href="#什么是-Virtual-DOM，为何要用-Virtual-DOM？" class="headerlink" title="什么是 Virtual DOM，为何要用 Virtual DOM？"></a>什么是 Virtual DOM，为何要用 Virtual DOM？</h3><p>Virtual DOM 的概念有很多解释，分别是：一个对象，两个前提，三个步骤。</p>
<p><strong>一个对象</strong>指的是 Virtual DOM 是一个基本的 JavaScript 对象，也是整个 Virtual DOM 树的基本。</p>
<p><strong>两个前提</strong>分别是 JavaScript 很快和直接操作 DOM 很慢，这是 Virtual DOM 得以实现的两个基本前提。</p>
<p>得益于 V8 引擎的出现，让 JavaScript 可以高效地运行，在性能上有了极大的提高。</p>
<p>直接操作 DOM 的低效和 JavaScript 的高效相对比，为 Virtual DOM 的产生提供了大前提。</p>
<p><strong>三个步骤</strong>指的是 Virtual DOM 的三个重要步骤，分别是：生成 Virtual DOM 树、对比两棵树的差异、更新视图。</p>
<p>1.生成 Virtual DOM 树：</p>
<p>DOM 是前端工程师最常接触的内容之一，一个 DOM 节点包含了很多的内容，但是抽象出一个 DOM 节点却只需要三部分：<strong>节点类型，节点属性、子节点</strong>。所以围绕这三个部分，我们可以使用 JavaScript 简单地实现一棵 DOM 树，然后给节点实现渲染方法，就可以实现虚拟节点到真实 DOM 的转化。</p>
<img src="/posts/31920/%E8%99%9A%E6%8B%9Fdom1.webp" class="" title="虚拟dom1">

<p>2.对比两棵树的差异：</p>
<p>比较两棵 DOM 树的差异是 Virtual DOM 算法最核心的部分，这也是我们常说的的 Virtual DOM 的 diff 算法。在比较的过程中，我们只比较同级的节点，非同级的节点不在我们的比较范围内，这样既可以满足我们的需求，又可以简化算法实现。</p>
<img src="/posts/31920/%E8%99%9A%E6%8B%9Fdom2.webp" class="" title="虚拟dom2">

<p>比较“树”的差异，首先是要对树进行遍历，常用的有两种遍历算法，分别是深度优先遍历和广度优先遍历，一般的 diff 算法中都采用的是深度优先遍历。对新旧两棵树进行一次深度优先的遍历，这样每个节点都会有一个唯一的标记。在遍历的时候，每遍历到一个节点就把该节点和新的树的同一个位置的节点进行对比，如果有差异的话就记录到一个对象里面。</p>
<p>例如，上面的 div 和新的 div 有差异，当前的标记是 0，那么：patches[0] = [{difference}, {difference}, …]。同理 p 是 patches[1]，ul 是 patches[3]，以此类推。这样当遍历完整棵树的时候，就可以获得一个完整的差异对象。</p>
<img src="/posts/31920/%E8%99%9A%E6%8B%9Fdom3.webp" class="" title="虚拟dom3">

<p>在这个差异对象中记录了有改变的节点，每一个发生改变的内容也不尽相同，但也是有迹可循，常见的差异包括四种，分别是：</p>
<ul>
<li>替换节点</li>
<li>增加/删除子节点</li>
<li>修改节点属性</li>
<li>改变文本内容</li>
</ul>
<h2 id="对象的原生方法"><a href="#对象的原生方法" class="headerlink" title="对象的原生方法"></a>对象的原生方法</h2><h3 id="Object-assign"><a href="#Object-assign" class="headerlink" title="Object.assign()"></a>Object.assign()</h3><p>copy 对象的可枚举属性</p>
<blockquote>
<p>语法：Object.assign(target, …sources)</p>
<p>参数：目标对象, …源对象</p>
<p>返回值：目标对象</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> copy = <span class="built_in">Object</span>.assign(&#123;&#125;, obj);</span><br><span class="line"><span class="built_in">console</span>.log(copy); <span class="comment">// &#123; a: 1 &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Object-create"><a href="#Object-create" class="headerlink" title="Object.create()"></a>Object.create()</h3><p>创建新对象</p>
<blockquote>
<p>语法：Object.create(proto, [ propertiesObject ])</p>
<p>参数：新创建对象的原型对象, 用于指定创建对象的一些属性，（eg：是否可读、是否可写，是否可以枚举 etc）</p>
</blockquote>
<h3 id="Object-is"><a href="#Object-is" class="headerlink" title="Object.is()"></a>Object.is()</h3><p>用来判断两个值是否是同一个值</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.is(<span class="string">&#x27;haorooms&#x27;</span>, <span class="string">&#x27;haorooms&#x27;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="built_in">window</span>, <span class="built_in">window</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Object</span>.is([], []); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> test = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.is(test, test); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="literal">null</span>, <span class="literal">null</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 特例</span></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="number">0</span>, -<span class="number">0</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Object</span>.is(-<span class="number">0</span>, -<span class="number">0</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="literal">NaN</span>, <span class="number">0</span> / <span class="number">0</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="Object-keys-Object-values"><a href="#Object-keys-Object-values" class="headerlink" title="Object.keys / Object.values"></a>Object.keys / Object.values</h3><p>返回给定对象的自身可枚举属性 / 值 的数组，数组中属性名的排列顺序和使用 for…in 循环遍历该对象时返回的顺序一致</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// simple array</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(arr)); <span class="comment">// console: [&#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// array like object</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="number">0</span>: <span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>: <span class="string">&#x27;b&#x27;</span>, <span class="number">2</span>: <span class="string">&#x27;c&#x27;</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(obj)); <span class="comment">// console: [&#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span>, <span class="attr">baz</span>: <span class="number">42</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.values(obj)); <span class="comment">// [&#x27;bar&#x27;, 42]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// array like object</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="number">0</span>: <span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>: <span class="string">&#x27;b&#x27;</span>, <span class="number">2</span>: <span class="string">&#x27;c&#x27;</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.values(obj)); <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = [<span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;8&#x27;</span>]; <span class="comment">// 等同于 &#123; 0: &#x27;e&#x27;, 1: &#x27;s&#x27;, 2: &#x27;8&#x27; &#125;;</span></span><br><span class="line"><span class="built_in">Object</span>.values(obj); <span class="comment">// [&#x27;e&#x27;, &#x27;s&#x27;, &#x27;8&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当把数字当做对象的键的时候，返回的数组以键的值升序排序</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="number">10</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="number">1</span>: <span class="string">&#x27;yyy&#x27;</span>, <span class="number">3</span>: <span class="string">&#x27;zzz&#x27;</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.values(obj); <span class="comment">// [&#x27;yyy&#x27;, &#x27;zzz&#x27;, &#x27;xxx&#x27;]</span></span><br><span class="line"><span class="built_in">Object</span>.values(<span class="string">&#x27;es8&#x27;</span>); <span class="comment">// [&#x27;e&#x27;, &#x27;s&#x27;, &#x27;8&#x27;]</span></span><br></pre></td></tr></table></figure>

<h3 id="Object-entries"><a href="#Object-entries" class="headerlink" title="Object.entries()"></a>Object.entries()</h3><p><code>**Object.entries()**</code> 方法返回对象自身可枚举属性的键值对数组，其排列与使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for...in"><code>for...in</code></a> 循环遍历该对象时返回的顺序一致（区别在于 for-in 循环也枚举原型链中的属性）。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span>, <span class="attr">baz</span>: <span class="number">42</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.entries(obj)); <span class="comment">// [ [&#x27;foo&#x27;, &#x27;bar&#x27;], [&#x27;baz&#x27;, 42] ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// iterate through key-value gracefully</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">5</span>, <span class="attr">b</span>: <span class="number">7</span>, <span class="attr">c</span>: <span class="number">9</span> &#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(obj)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;key&#125;</span> <span class="subst">$&#123;value&#125;</span>`</span>); <span class="comment">// &quot;a 5&quot;, &quot;b 7&quot;, &quot;c 9&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2 = &#123; <span class="number">10</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="number">1</span>: <span class="string">&#x27;yyy&#x27;</span>, <span class="number">3</span>: <span class="string">&#x27;zzz&#x27;</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.entries(obj2); <span class="comment">// [[&#x27;1&#x27;, &#x27;yyy&#x27;], [&#x27;3&#x27;, &#x27;zzz&#x27;], [&#x27;10&#x27;, &#x27;xxx&#x27;]]</span></span><br><span class="line"><span class="built_in">Object</span>.entries(<span class="string">&#x27;es8&#x27;</span>); <span class="comment">// [[&#x27;0&#x27;, &#x27;e&#x27;], [&#x27;1&#x27;, &#x27;s&#x27;], [&#x27;2&#x27;, &#x27;8&#x27;]]</span></span><br></pre></td></tr></table></figure>

<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><h3 id="数组的遍历方法"><a href="#数组的遍历方法" class="headerlink" title="数组的遍历方法"></a>数组的遍历方法</h3><ul>
<li>标准 for 循环</li>
<li>forEach((当前值, 当前索引,当前数组)=&gt;{})<ul>
<li>无法中途退出循环，只能用 <code>return</code> 退出本次回调，进行下一次回调。</li>
<li>它总是返回 undefined 值,即使你 return 了一个值。</li>
</ul>
</li>
<li>for-in（不推荐）会把继承链的对象属性都会遍历一遍，而且数组遍历不一定按次序<ul>
<li>for-in 循环返回的是所有能通过对象访问的、可枚举的属性。</li>
</ul>
</li>
<li>for (variable of iterable)（ES6）可迭代 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Array">Array</a> ，<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Map">Map</a>，<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a>，<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/String">String</a> 等（迭代的是值 value ）<ul>
<li>在 <code>for-of</code> 中如果遍历中途要退出，可以使用 <code>break</code> 退出循环。</li>
</ul>
</li>
</ul>
<h4 id="ES5"><a href="#ES5" class="headerlink" title="ES5"></a>ES5</h4><ul>
<li><p>map (不改变原数组) 会给原数组中的每个元素都按顺序调用一次 callback 函数</p>
</li>
<li><p>reduce (不改变原数组) 数组中的前项和后项做某种计算,并累计最终值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// arr.reduce(function(total, currentValue, currentIndex, arr), initialValue)</span></span><br><span class="line"><span class="comment">// callback 参数</span></span><br><span class="line"><span class="comment">// (累积器, 当前元素, 当前元素索引, 当前数组)</span></span><br><span class="line"><span class="comment">// initialValue:指定第一次回调 的第一个参数</span></span><br><span class="line"><span class="keyword">var</span> wallets = [<span class="number">4</span>, <span class="number">7.8</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> totalMoney = wallets.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">countedMoney, curMoney</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> countedMoney + curMoney;</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>filter（不改变原数组）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="keyword">var</span> morearr = arr.filter(<span class="function"><span class="keyword">function</span> (<span class="params">number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> number &gt; <span class="number">3</span>;</span><br><span class="line">&#125;); <span class="comment">// [4,5,6]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>every（不改变原数组）测试数组的所有元素是否都通过了指定函数的测试</p>
<ul>
<li><p>如果数组中检测到有一个元素不满足，则整个表达式返回 false ，且剩余的元素不会再进行检测。</p>
</li>
<li><p>如果所有元素都满足条件，则返回 true 。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">var</span> result = arr.every(<span class="function"><span class="keyword">function</span> (<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> item &gt; <span class="number">2</span>;</span><br><span class="line">&#125;); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>some（不改变原数组）测试是否至少有一个元素通过 callback 中的条件.对于放在空数组上的任何条件，此方法返回 false 。</p>
<ul>
<li><p>如果有一个元素满足条件，则表达式返回 true , 剩余的元素不会再执行检测。</p>
</li>
<li><p>如果没有满足条件的元素，则返回 false 。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// some(callback, thisArg)</span></span><br><span class="line"><span class="comment">// callback:</span></span><br><span class="line"><span class="comment">//    (当前元素, 当前索引, 调用some的数组)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">var</span> result = arr.some(<span class="function"><span class="keyword">function</span> (<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> item &gt; <span class="number">3</span>;</span><br><span class="line">&#125;); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h4><ul>
<li><p>find() &amp; findIndex() 根据条件找到数组成员</p>
<ul>
<li><p>find() 定义：用于找出第一个符合条件的数组成员，并返回该成员，如果没有符合条件的成员，则返回 undefined 。</p>
</li>
<li><p>findIndex() 定义：返回第一个符合条件的数组成员的位置，如果所有成员都不符合条件，则返回 -1 。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!-- 语法 --&gt;</span><br><span class="line"><span class="keyword">let</span> new_array = arr.find(<span class="function"><span class="keyword">function</span>(<span class="params">currentValue, index, arr</span>), <span class="title">thisArg</span>)</span></span><br><span class="line"><span class="function"><span class="title">let</span> <span class="title">new_array</span> = <span class="title">arr</span>.<span class="title">findIndex</span>(<span class="params"><span class="keyword">function</span>(currentValue, index, arr), thisArg</span>)</span></span><br><span class="line"><span class="function">&lt;!-- 这两个方法都可以识别<span class="title">NaN</span>,弥补了<span class="title">indexOf</span>的不足 --&gt;</span></span><br><span class="line"><span class="function">&lt;!-- <span class="title">find</span> --&gt;</span></span><br><span class="line"><span class="function"><span class="title">let</span> <span class="title">a</span> = [1, 4, -5, 10].<span class="title">find</span>(<span class="params">(n) =&gt; n &lt; <span class="number">0</span></span>)</span>;</span><br><span class="line">&lt;!-- 返回元素-<span class="number">5</span> --&gt;</span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">1</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">10</span>,<span class="literal">NaN</span>].find(<span class="function">(<span class="params">n</span>) =&gt;</span> <span class="built_in">Object</span>.is(<span class="literal">NaN</span>, n));</span><br><span class="line">&lt;!-- 返回元素<span class="literal">NaN</span> --&gt;</span><br><span class="line">&lt;!-- findIndex --&gt;</span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">10</span>].findIndex(<span class="function">(<span class="params">n</span>) =&gt;</span> n &lt; <span class="number">0</span>);</span><br><span class="line">&lt;!-- 返回索引<span class="number">2</span> --&gt;</span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">1</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">10</span>,<span class="literal">NaN</span>].findIndex(<span class="function">(<span class="params">n</span>) =&gt;</span> <span class="built_in">Object</span>.is(<span class="literal">NaN</span>, n));</span><br><span class="line">&lt;!-- 返回索引<span class="number">4</span> --&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>keys() &amp; values() &amp; entries() 遍历键名、遍历键值、遍历键名+键值</p>
<ul>
<li><p>三个方法都返回一个新的 Array Iterator 对象，对象根据方法不同包含不同的值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 语法</span></span><br><span class="line">array.keys()   array.values()   array.entries()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">of</span> [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>].keys()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(index);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> elem <span class="keyword">of</span> [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>].values()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(elem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &#x27;a&#x27;</span></span><br><span class="line"><span class="comment">// &#x27;b&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [index, elem] <span class="keyword">of</span> [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>].entries()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(index, elem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0 &quot;a&quot;</span></span><br><span class="line"><span class="comment">// 1 &quot;b&quot;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="for-in-和-for-of-区别"><a href="#for-in-和-for-of-区别" class="headerlink" title="for in 和 for of 区别"></a>for in 和 for of 区别</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.objCustom = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">Array</span>.prototype.arrCustom = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> iterable = [<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>];</span><br><span class="line">iterable.foo = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> iterable) &#123;  <span class="xml">&lt;-- 循环的是索引</span></span><br><span class="line"><span class="xml">  console.log(i); // 打印 0, 1, 2, &quot;foo&quot;, &quot;arrCustom&quot;, &quot;objCustom&quot;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">for (let i in iterable) &#123;</span></span><br><span class="line"><span class="xml">  if (iterable.hasOwnProperty(i)) &#123;</span></span><br><span class="line"><span class="xml">    console.log(i); // 打印 0, 1, 2, &quot;foo&quot;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line">for (let i of iterable) &#123;  &lt;-- 迭代的是值</span><br><span class="line">  console.log(i); // 打印 3, 5, 7</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://juejin.im/post/5a3a59e7518825698e72376b">JavaScript 数组遍历方法的对比</a></p>
<h3 id="JS-数组有哪些方法"><a href="#JS-数组有哪些方法" class="headerlink" title="JS 数组有哪些方法"></a>JS 数组有哪些方法</h3><h4 id="改变原数组的方法（9-个）"><a href="#改变原数组的方法（9-个）" class="headerlink" title="改变原数组的方法（9 个）"></a>改变原数组的方法（9 个）</h4><h5 id="splice-添加-删除数组元素"><a href="#splice-添加-删除数组元素" class="headerlink" title="splice() 添加 / 删除数组元素"></a>splice() 添加 / 删除数组元素</h5><blockquote>
<p>splice() 方法<strong>向/从数组中添加/删除</strong>项目，然后返回被删除的项目</p>
<p>array.splice(index,howmany,item1,…..,itemX)</p>
<ol>
<li>index：必需。整数，规定添加/删除项目的位置，使用负数可从数组结尾处规定位置。</li>
<li>howmany：可选。要删除的项目数量。如果设置为 0，则不会删除项目。</li>
<li>item1, …, itemX： 可选。向数组添加的新项目。</li>
</ol>
<p>返回值: 如果有元素被删除,返回包含被删除项目的新数组。</p>
</blockquote>
<p><strong>删除元素</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 从数组下标0开始，删除3个元素</span></span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.splice(<span class="number">0</span>, <span class="number">3</span>); <span class="comment">// [1,2,3]</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [4,5,6,7]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从最后一个元素开始删除3个元素，因为最后一个元素，所以只删除了7</span></span><br><span class="line"><span class="keyword">let</span> item = a.splice(-<span class="number">1</span>, <span class="number">3</span>); <span class="comment">// [7]</span></span><br></pre></td></tr></table></figure>

<p><strong>删除并添加</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 从数组下标0开始，删除3个元素，并添加元素&#x27;添加&#x27;</span></span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.splice(<span class="number">0</span>, <span class="number">3</span>, <span class="string">&#x27;添加&#x27;</span>); <span class="comment">// [1,2,3]</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [&#x27;添加&#x27;,4,5,6,7]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从数组最后第二个元素开始，删除3个元素，并添加两个元素&#x27;添加1&#x27;、&#x27;添加2&#x27;</span></span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> item = b.splice(-<span class="number">2</span>, <span class="number">3</span>, <span class="string">&#x27;添加1&#x27;</span>, <span class="string">&#x27;添加2&#x27;</span>); <span class="comment">// [6,7]</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// [1,2,3,4,5,&#x27;添加1&#x27;,&#x27;添加2&#x27;]</span></span><br></pre></td></tr></table></figure>

<p><strong>不删除只添加</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.splice(<span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;添加1&#x27;</span>, <span class="string">&#x27;添加2&#x27;</span>); <span class="comment">// [] 没有删除元素，返回空数组</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [&#x27;添加1&#x27;,&#x27;添加2&#x27;,1,2,3,4,5,6,7]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> item = b.splice(-<span class="number">1</span>, <span class="number">0</span>, <span class="string">&#x27;添加1&#x27;</span>, <span class="string">&#x27;添加2&#x27;</span>); <span class="comment">// [] 没有删除元素，返回空数组</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// [1,2,3,4,5,6,&#x27;添加1&#x27;,&#x27;添加2&#x27;,7] 在最后一个元素的前面添加两个元素</span></span><br></pre></td></tr></table></figure>

<h5 id="sort-数组排序"><a href="#sort-数组排序" class="headerlink" title="sort() 数组排序"></a>sort() 数组排序</h5><blockquote>
<p>定义: sort() 方法对数组元素进行排序，并返回这个数组。</p>
<p>参数可选: 规定排序顺序的比较函数。</p>
<p>默认情况下 sort() 方法没有传比较函数的话，默认按字母升序，如果不是元素不是字符串的话，会调用 <code>toString()</code> 方法将元素转化为字符串的 Unicode (万国码)位点，然后再比较字符。</p>
</blockquote>
<p><strong>不传参</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 字符串排列 看起来很正常</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="string">&#x27;Banana&#x27;</span>, <span class="string">&#x27;Orange&#x27;</span>, <span class="string">&#x27;Apple&#x27;</span>, <span class="string">&#x27;Mango&#x27;</span>];</span><br><span class="line">a.sort(); <span class="comment">// [&quot;Apple&quot;,&quot;Banana&quot;,&quot;Mango&quot;,&quot;Orange&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数字排序的时候 因为转换成Unicode字符串之后，有些数字会比较大会排在后面 这显然不是我们想要的</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">20</span>, <span class="number">25</span>, <span class="number">8</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a.sort()); <span class="comment">// [1,10,20,25,3,8];</span></span><br></pre></td></tr></table></figure>

<p><em>比较函数的两个参数：</em></p>
<p>sort 的比较函数有两个默认参数，要在函数中接收这两个参数，这两个参数是数组中两个要比较的元素，通常我们用 a 和 b 接收两个将要比较的元素：</p>
<ul>
<li>若比较函数返回值 &lt;0 ，那么 a 将排到 b 的前面;</li>
<li>若比较函数返回值 =0 ，那么 a 和 b 相对位置不变；</li>
<li>若比较函数返回值 &gt;0 ，那么 b 排在 a 将的前面；</li>
</ul>
<p><strong>数字升降序</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">20</span>, <span class="number">4</span>, <span class="number">25</span>, <span class="number">8</span>];</span><br><span class="line">array.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(array); <span class="comment">// [1,3,4,4,8,10,20,25];</span></span><br><span class="line"></span><br><span class="line">array.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> b - a;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(array); <span class="comment">// [25,20,10,8,4,4,3,1];</span></span><br></pre></td></tr></table></figure>

<h5 id="pop-删除一个数组中的最后的一个元素"><a href="#pop-删除一个数组中的最后的一个元素" class="headerlink" title="pop() 删除一个数组中的最后的一个元素"></a>pop() 删除一个数组中的最后的一个元素</h5><blockquote>
<p>定义: pop() 方法删除一个数组中的最后的一个元素，并且返回这个元素。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.pop(); <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [1,2]</span></span><br></pre></td></tr></table></figure>

<h5 id="shift-删除数组的第一个元素"><a href="#shift-删除数组的第一个元素" class="headerlink" title="shift() 删除数组的第一个元素"></a>shift() 删除数组的第一个元素</h5><blockquote>
<p>定义: shift()方法删除数组的第一个元素，并返回这个元素。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.shift(); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [2,3]</span></span><br></pre></td></tr></table></figure>

<h5 id="push-向数组的末尾添加元素"><a href="#push-向数组的末尾添加元素" class="headerlink" title="push() 向数组的末尾添加元素"></a>push() 向数组的末尾添加元素</h5><blockquote>
<p>定义：push() 方法可向数组的末尾添加一个或多个元素，并返回新的长度。</p>
<p>参数: item1, item2, …, itemX ,要添加到数组末尾的元素</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.push(<span class="string">&#x27;末尾&#x27;</span>, <span class="string">&#x27;233&#x27;</span>); <span class="comment">// 5</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [1,2,3,&#x27;末尾&#x27;, &#x27;233&#x27;]</span></span><br></pre></td></tr></table></figure>

<h5 id="unshift"><a href="#unshift" class="headerlink" title="unshift()"></a>unshift()</h5><blockquote>
<p>定义：unshift() 方法可向数组的开头添加一个或更多元素，并返回新的长度。</p>
<p>参数: item1, item2, …, itemX ,要添加到数组开头的元素</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> item = a.unshift(<span class="string">&#x27;开头&#x27;</span>, <span class="string">&#x27;开头2&#x27;</span>); <span class="comment">// 5</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [ &#x27;开头&#x27;, &#x27;开头2&#x27;, 1, 2, 3 ]</span></span><br></pre></td></tr></table></figure>

<h5 id="reverse-颠倒数组中元素的顺序"><a href="#reverse-颠倒数组中元素的顺序" class="headerlink" title="reverse() 颠倒数组中元素的顺序"></a>reverse() 颠倒数组中元素的顺序</h5><blockquote>
<p>定义: reverse() 方法用于颠倒数组中元素的顺序。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">a.reverse();</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// [3,2,1]</span></span><br></pre></td></tr></table></figure>

<h4 id="不改变原数组的方法（8-个）"><a href="#不改变原数组的方法（8-个）" class="headerlink" title="不改变原数组的方法（8 个）"></a>不改变原数组的方法（8 个）</h4><h5 id="slice-浅拷贝数组的元素"><a href="#slice-浅拷贝数组的元素" class="headerlink" title="slice() 浅拷贝数组的元素"></a>slice() 浅拷贝数组的元素</h5><blockquote>
<p>定义： 方法返回一个从开始到结束（<strong>不包括结束</strong>）选择的数组的一部分浅拷贝到一个新数组对象，且原数组不会被修改。</p>
<p>语法：array.slice(begin, end);</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> b = a.slice(<span class="number">0</span>, <span class="number">1</span>); <span class="comment">// [&#x27;hello&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新数组是浅拷贝的，元素是简单数据类型，改变之后不会互相干扰。</span></span><br><span class="line"><span class="comment">// 如果是复杂数据类型(对象,数组)的话，改变其中一个，另外一个也会改变。</span></span><br><span class="line">a[<span class="number">0</span>] = <span class="string">&#x27;改变原数组&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a, b); <span class="comment">// [&#x27;改变原数组&#x27;,&#x27;world&#x27;] [&#x27;hello&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = [&#123; <span class="attr">name</span>: <span class="string">&#x27;OBKoro1&#x27;</span> &#125;];</span><br><span class="line"><span class="keyword">let</span> b = a.slice();</span><br><span class="line"><span class="built_in">console</span>.log(b, a); <span class="comment">// [&#123;&quot;name&quot;:&quot;OBKoro1&quot;&#125;]  [&#123;&quot;name&quot;:&quot;OBKoro1&quot;&#125;]</span></span><br><span class="line"><span class="comment">// a[0].name=&#x27;改变原数组&#x27;</span></span><br><span class="line"><span class="comment">// console.log(b,a) // [&#123;&quot;name&quot;:&quot;改变原数组&quot;&#125;] [&#123;&quot;name&quot;:&quot;改变原数组&quot;&#125;]</span></span><br></pre></td></tr></table></figure>

<h5 id="join-数组转字符串"><a href="#join-数组转字符串" class="headerlink" title="join() 数组转字符串"></a>join() 数组转字符串</h5><blockquote>
<p>定义: join() 方法用于把数组中的所有元素通过指定的分隔符进行分隔放入一个字符串，返回生成的字符串。</p>
<p>语法: array.join(str)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> str = a.join(); <span class="comment">// &#x27;hello,world&#x27;</span></span><br><span class="line"><span class="keyword">let</span> str2 = a.join(<span class="string">&#x27;+&#x27;</span>); <span class="comment">// &#x27;hello+world&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = [[<span class="string">&#x27;OBKoro1&#x27;</span>, <span class="string">&#x27;23&#x27;</span>], <span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> str1 = a.join(); <span class="comment">// OBKoro1,23,test</span></span><br><span class="line"><span class="keyword">let</span> b = [&#123; <span class="attr">name</span>: <span class="string">&#x27;OBKoro1&#x27;</span>, <span class="attr">age</span>: <span class="string">&#x27;23&#x27;</span> &#125;, <span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> str2 = b.join(); <span class="comment">// [object Object],test</span></span><br><span class="line"><span class="comment">// 对象转字符串推荐JSON.stringify(obj)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结论：</span></span><br><span class="line"><span class="comment">// join()/toString() 方法在数组元素是数组的时候，会将里面的数组也调用 join()/toString() ,</span></span><br><span class="line"><span class="comment">// 如果是对象的话，对象会被转为 [object Object] 字符串。</span></span><br></pre></td></tr></table></figure>

<h5 id="toLocaleString-数组转字符串"><a href="#toLocaleString-数组转字符串" class="headerlink" title="toLocaleString() 数组转字符串"></a>toLocaleString() 数组转字符串</h5><blockquote>
<p>定义: 返回一个表示数组元素的字符串。该字符串由数组中的每个元素的 toLocaleString() 返回值经调用 join() 方法连接（由逗号隔开）组成。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [&#123;</span><br><span class="line">    name: <span class="string">&#x27;OBKoro1&#x27;</span></span><br><span class="line">&#125;, <span class="number">23</span>, <span class="string">&#x27;abcd&#x27;</span>, <span class="keyword">new</span> <span class="built_in">Date</span>()]</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a.join(<span class="string">&quot;,&quot;</span>))</span><br><span class="line"><span class="built_in">console</span>.log(a.toString())</span><br><span class="line"><span class="built_in">console</span>.log(a.toLocaleString(<span class="string">&#x27;en-us&#x27;</span>))</span><br><span class="line"><span class="built_in">console</span>.log(a.toLocaleString(<span class="string">&#x27;zh-cn&#x27;</span>))</span><br><span class="line"></span><br><span class="line">[object <span class="built_in">Object</span>],<span class="number">23</span>,abcd,Tue Feb <span class="number">26</span> <span class="number">2019</span> <span class="number">11</span>:<span class="number">47</span>:<span class="number">03</span> GMT+<span class="number">0800</span> (中国标准时间)</span><br><span class="line">[object <span class="built_in">Object</span>],<span class="number">23</span>,abcd,Tue Feb <span class="number">26</span> <span class="number">2019</span> <span class="number">11</span>:<span class="number">47</span>:<span class="number">03</span> GMT+<span class="number">0800</span> (中国标准时间)</span><br><span class="line">[object <span class="built_in">Object</span>],<span class="number">23</span>,abcd,<span class="number">2</span>/<span class="number">26</span>/<span class="number">2019</span>, <span class="number">11</span>:<span class="number">47</span>:<span class="number">03</span> AM</span><br><span class="line">[object <span class="built_in">Object</span>],<span class="number">23</span>,abcd,<span class="number">2019</span>/<span class="number">2</span>/<span class="number">26</span> 上午<span class="number">11</span>:<span class="number">47</span>:<span class="number">03</span></span><br></pre></td></tr></table></figure>

<h5 id="concat-合并数组"><a href="#concat-合并数组" class="headerlink" title="concat 合并数组"></a>concat 合并数组</h5><blockquote>
<p>定义： 方法用于合并两个或多个数组，返回一个新数组。</p>
<p>语法：var newArr =oldArray.concat(arrayX,arrayX,……,arrayX)</p>
<p>参数：arrayX（必须）：该参数可以是具体的值，也可以是数组对象。可以是任意多个。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="comment">//连接两个数组</span></span><br><span class="line"><span class="keyword">let</span> newVal = a.concat(b); <span class="comment">// [1,2,3,4,5,6]</span></span><br><span class="line"><span class="comment">// 连接三个数组</span></span><br><span class="line"><span class="keyword">let</span> c = [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line"><span class="keyword">let</span> newVal2 = a.concat(b, c); <span class="comment">// [1,2,3,4,5,6,7,8,9]</span></span><br><span class="line"><span class="comment">// 添加元素</span></span><br><span class="line"><span class="keyword">let</span> newVal3 = a.concat(<span class="string">&#x27;添加元素&#x27;</span>, b, c, <span class="string">&#x27;再加一个&#x27;</span>);</span><br><span class="line"><span class="comment">// [1,2,3,&quot;添加元素&quot;,4,5,6,7,8,9,&quot;再加一个&quot;]</span></span><br><span class="line"><span class="comment">// 合并嵌套数组  会浅拷贝嵌套数组</span></span><br><span class="line"><span class="keyword">let</span> d = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">let</span> f = [<span class="number">3</span>, [<span class="number">4</span>]];</span><br><span class="line"><span class="keyword">let</span> newVal4 = d.concat(f); <span class="comment">// [1,2,3,[4]]</span></span><br></pre></td></tr></table></figure>

<h5 id="ES6-扩展运算符-合并数组"><a href="#ES6-扩展运算符-合并数组" class="headerlink" title="ES6 扩展运算符 ... 合并数组"></a>ES6 扩展运算符 <code>...</code> 合并数组</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">4</span>, ...a, <span class="number">4</span>, <span class="number">4</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a, b); <span class="comment">//  [2, 3, 4, 5] [4,2,3,4,5,4,4]</span></span><br></pre></td></tr></table></figure>

<h5 id="indexOf-查找数组是否存在某个元素，返回下标"><a href="#indexOf-查找数组是否存在某个元素，返回下标" class="headerlink" title="indexOf() 查找数组是否存在某个元素，返回下标"></a>indexOf() 查找数组是否存在某个元素，返回下标</h5><blockquote>
<p>定义: 返回在数组中可以找到一个给定元素的第一个索引，如果不存在，则返回-1。</p>
<p>p.s. 字符串也有此方法，要注意当 ‘lance’.indexOf(‘’) 一个空字符串时，返回 0 而不是-1</p>
<p>语法：array.indexOf(searchElement,fromIndex)</p>
<p>参数：</p>
<p>searchElement (必须):被查找的元素</p>
<p>fromIndex (可选):开始查找的位置(不能大于等于数组的长度，返回-1)，接受负值，默认值为 0。</p>
<p>严格相等的搜索:</p>
<p>数组的 indexOf 搜索跟字符串的 indexOf 不一样,数组的 indexOf 使用严格相等<code>===</code>搜索元素，即<strong>数组元素要完全匹配</strong>才能搜索成功。</p>
<p><strong>注意</strong>：indexOf() 不能识别<code>NaN</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;啦啦&#x27;</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">24</span>, <span class="literal">NaN</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a.indexOf(<span class="string">&#x27;啦&#x27;</span>)); <span class="comment">// -1</span></span><br><span class="line"><span class="built_in">console</span>.log(a.indexOf(<span class="string">&#x27;NaN&#x27;</span>)); <span class="comment">// -1</span></span><br><span class="line"><span class="built_in">console</span>.log(a.indexOf(<span class="string">&#x27;啦啦&#x27;</span>)); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<h5 id="lastIndexOf-查找指定元素在数组中的最后一个位置"><a href="#lastIndexOf-查找指定元素在数组中的最后一个位置" class="headerlink" title="lastIndexOf() 查找指定元素在数组中的最后一个位置"></a>lastIndexOf() 查找指定元素在数组中的最后一个位置</h5><blockquote>
<p>定义: 方法返回指定元素,在数组中的最后一个的索引，如果不存在则返回 -1。（从数组后面往前查找）</p>
<p>语法：arr.lastIndexOf(searchElement,fromIndex)</p>
<p>参数:</p>
<p>searchElement(必须): 被查找的元素</p>
<p>fromIndex(可选): 逆向查找开始位置，默认值数组的 <code>长度-1</code>，即查找整个数组。</p>
<p>关于 fromIndex 有三个规则:</p>
<ol>
<li>正值。如果该值大于或等于数组的长度，则整个数组会被查找。</li>
<li>负值。将其视为从数组末尾向前的偏移。(比如-2，从数组最后第二个元素开始往前查找)</li>
<li>负值。其绝对值大于数组长度，则方法返回 -1，即数组不会被查找。</li>
</ol>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;OB&#x27;</span>, <span class="number">4</span>, <span class="string">&#x27;Koro1&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;Koro1&#x27;</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="string">&#x27;Koro1&#x27;</span>]; <span class="comment">// 数组长度为10</span></span><br><span class="line"><span class="comment">// let b=a.lastIndexOf(&#x27;Koro1&#x27;,4) // 从下标4开始往前找 返回下标2</span></span><br><span class="line"><span class="comment">// let b=a.lastIndexOf(&#x27;Koro1&#x27;,100) //  大于或数组的长度 查找整个数组 返回9</span></span><br><span class="line"><span class="comment">// let b=a.lastIndexOf(&#x27;Koro1&#x27;,-11) // -1 数组不会被查找</span></span><br><span class="line"><span class="keyword">let</span> b = a.lastIndexOf(<span class="string">&#x27;Koro1&#x27;</span>, -<span class="number">9</span>); <span class="comment">// 从第二个元素4往前查找，没有找到 返回-1</span></span><br></pre></td></tr></table></figure>

<h5 id="ES7-includes-查找数组是否包含某个元素-返回布尔"><a href="#ES7-includes-查找数组是否包含某个元素-返回布尔" class="headerlink" title="ES7 includes() 查找数组是否包含某个元素 返回布尔"></a>ES7 includes() 查找数组是否包含某个元素 返回布尔</h5><blockquote>
<p>定义： 返回一个布尔值，表示某个数组是否包含给定的值</p>
<p>语法：array.includes(searchElement,fromIndex=0)</p>
<p>参数：</p>
<p>searchElement (必须):被查找的元素</p>
<p>fromIndex (可选):默认值为 0 ，参数表示搜索的起始位置，接受负值。正值超过数组长度，数组不会被搜索，返回 false 。负值绝对值超过长数组度，重置从 0 开始搜索。</p>
<p><strong>includes 方法是为了弥补 indexOf 方法的缺陷而出现的:</strong></p>
<ol>
<li>indexOf 方法不能识别 <code>NaN</code></li>
<li>indexOf 方法检查是否包含某个值不够语义化，需要判断是否不等于 <code>-1</code> ，表达不够直观</li>
</ol>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;OB&#x27;</span>, <span class="string">&#x27;Koro1&#x27;</span>, <span class="number">1</span>, <span class="literal">NaN</span>];</span><br><span class="line"><span class="comment">// let b=a.includes(NaN) // true 识别NaN</span></span><br><span class="line"><span class="comment">// let b=a.includes(&#x27;Koro1&#x27;,100) // false 超过数组长度 不搜索</span></span><br><span class="line"><span class="comment">// let b=a.includes(&#x27;Koro1&#x27;,-3)  // true 从倒数第三个元素开始搜索</span></span><br><span class="line"><span class="comment">// let b=a.includes(&#x27;Koro1&#x27;,-100)  // true 负值绝对值超过数组长度，搜索整个数组</span></span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://juejin.im/post/5b0903b26fb9a07a9d70c7e0">js 数组详细操作方法及解析合集</a></p>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><h3 id="字符串的方法"><a href="#字符串的方法" class="headerlink" title="字符串的方法"></a>字符串的方法</h3><h4 id="charAt-返回字符串字符"><a href="#charAt-返回字符串字符" class="headerlink" title="charAt 返回字符串字符"></a>charAt 返回字符串字符</h4><blockquote>
<p>从一个字符串中返回指定字符<br>如果指定的 index 值超出了该范围，则返回一个空字符串</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> anyString = <span class="string">&#x27;Brave new world&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(anyString.charAt(<span class="number">0</span>)); <span class="comment">// B</span></span><br></pre></td></tr></table></figure>

<h4 id="substring-返回字符串子集"><a href="#substring-返回字符串子集" class="headerlink" title="substring 返回字符串子集"></a>substring 返回字符串子集</h4><blockquote>
<p>返回一个字符串在开始索引到结束索引之间的一个子集, 或从开始索引直到字符串的末尾的一个子集。</p>
<ul>
<li>如果 <code>indexStart</code> 等于 <code>indexEnd</code>，<code>substring</code> 返回一个空字符串。</li>
<li>如果省略 <code>indexEnd</code>，<code>substring</code> 提取字符一直到字符串末尾。</li>
<li>如果任一参数小于 0 或为 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/NaN"><code>NaN</code></a>，则被当作 0。</li>
<li>如果任一参数大于 <code>stringName.length</code>，则被当作 <code>stringName.length</code>。</li>
<li>如果 <code>indexStart</code> 大于 <code>indexEnd</code>，则 <code>substring</code> 的执行效果就像两个参数调换了一样。见下面的例子。</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> anyString = <span class="string">&#x27;Mozilla&#x27;</span>;</span><br><span class="line"><span class="comment">// 输出 &quot;Moz&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(anyString.substring(<span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line"><span class="built_in">console</span>.log(anyString.substring(<span class="number">3</span>, <span class="number">0</span>));</span><br><span class="line"><span class="built_in">console</span>.log(anyString.substring(<span class="number">3</span>, -<span class="number">3</span>));</span><br><span class="line"><span class="built_in">console</span>.log(anyString.substring(<span class="number">3</span>, <span class="literal">NaN</span>));</span><br><span class="line"><span class="built_in">console</span>.log(anyString.substring(-<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line"><span class="built_in">console</span>.log(anyString.substring(<span class="literal">NaN</span>, <span class="number">3</span>));</span><br></pre></td></tr></table></figure>

<h4 id="replace-替换字符串"><a href="#replace-替换字符串" class="headerlink" title="replace 替换字符串"></a>replace 替换字符串</h4><blockquote>
<p>返回一个由替换值（replacement）替换一些或所有匹配的模式（pattern）后的新字符串。模式可以是一个字符串或者一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/RegExp">正则表达式</a> ，替换值可以是一个字符串或者一个每次匹配都要调用的回调函数。</p>
</blockquote>
<h4 id="toLowerCase-toUpperCase-转换字母大小写"><a href="#toLowerCase-toUpperCase-转换字母大小写" class="headerlink" title="toLowerCase / toUpperCase 转换字母大小写"></a>toLowerCase / toUpperCase 转换字母大小写</h4><p>字母转为全小写或全大写</p>
<h4 id="includes"><a href="#includes" class="headerlink" title="includes"></a>includes</h4><blockquote>
<p>includes() 返回布尔值：表示是否找到了参数字符。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;qdywxs&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str.includes(<span class="string">&#x27;y&#x27;</span>)); <span class="comment">//--&gt;true</span></span><br></pre></td></tr></table></figure>

<h4 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h4><blockquote>
<p>获取字符串重复 n 次。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;qdywxs&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(s.repeat(<span class="number">3</span>)); <span class="comment">//--&gt;qdywxsqdywxsqdywxs</span></span><br></pre></td></tr></table></figure>

<h4 id="startsWith"><a href="#startsWith" class="headerlink" title="startsWith"></a>startsWith</h4><blockquote>
<p>返回布尔值：表示参数字符串是否在源字符串的头部。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;swlance&#x27;</span>.startsWith(<span class="string">&#x27;s&#x27;</span>)); <span class="comment">//--&gt;true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;swlance&#x27;</span>.startsWith(<span class="string">&#x27;l&#x27;</span>)); <span class="comment">//--&gt;false</span></span><br></pre></td></tr></table></figure>

<h4 id="endsWith"><a href="#endsWith" class="headerlink" title="endsWith"></a>endsWith</h4><blockquote>
<p>返回布尔值，表示参数字符串是否在源字符串的尾部。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;swlance&#x27;</span>.endsWith(<span class="string">&#x27;e&#x27;</span>)); <span class="comment">//--&gt;true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;swlance&#x27;</span>.endsWith(<span class="string">&#x27;o&#x27;</span>)); <span class="comment">//--&gt;false</span></span><br></pre></td></tr></table></figure>

<h4 id="padStart-padEnd"><a href="#padStart-padEnd" class="headerlink" title="padStart/padEnd"></a>padStart/padEnd</h4><p>在 ES 8 中 String 新增了两个实例函数<code>String.prototype.padStart</code>和<code>String.prototype.padEnd</code>，允许将空字符串或其他字符串添加到原始字符串的开头或结尾。</p>
<ul>
<li><p><code>String.padStart(targetLength,[padString])</code><br><em>targetLength：</em>当前字符串需要填充到的目标长度。如果这个数值小于当前字符串的长度，则返回当前字符串本身。</p>
<p><em>padString：</em>(可选)填充字符串。如果字符串太长，使填充后的字符串长度超过了目标长度，则只保留最左侧的部分，其他部分会被截断，此参数的缺省值为空格。</p>
</li>
<li><p><code>String.padEnd(targetLength,padString])</code> 参数释义同上。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;es8&#x27;</span>.padStart(<span class="number">2</span>); <span class="comment">// &#x27;es8&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.padStart(<span class="number">5</span>); <span class="comment">// &#x27;  es8&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.padStart(<span class="number">6</span>, <span class="string">&#x27;1891&#x27;</span>); <span class="comment">// &#x27;189es8&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.padStart(<span class="number">14</span>, <span class="string">&#x27;coffe&#x27;</span>); <span class="comment">// &#x27;coffecoffeces8&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.padStart(<span class="number">7</span>, <span class="string">&#x27;0&#x27;</span>); <span class="comment">// &#x27;0000es8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.padEnd(<span class="number">2</span>); <span class="comment">// &#x27;es8&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.padEnd(<span class="number">5</span>); <span class="comment">// &#x27;es8  &#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.padEnd(<span class="number">6</span>, <span class="string">&#x27;1891&#x27;</span>); <span class="comment">// &#x27;es8189&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.padEnd(<span class="number">14</span>, <span class="string">&#x27;coffe&#x27;</span>); <span class="comment">// &#x27;es8coffecoffec&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.padEnd(<span class="number">7</span>, <span class="string">&#x27;9&#x27;</span>); <span class="comment">// &#x27;es89999&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="什么是-JavaScript-作用链域？"><a href="#什么是-JavaScript-作用链域？" class="headerlink" title="什么是 JavaScript 作用链域？"></a>什么是 JavaScript 作用链域？</h2><p>全局函数无法查看局部函数的内部细节，但局部函数可以查看其上层的函数细节，直至全局细节。</p>
<p>当需要从局部函数查找某一属性或方法时，如果当前作用域没有找到，就会上溯到上层作用域查找， 直至全局函数，这种组织形式就是作用域链。</p>
<h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><h3 id="什么是闭包-对闭包的理解"><a href="#什么是闭包-对闭包的理解" class="headerlink" title="什么是闭包/对闭包的理解"></a>什么是闭包/对闭包的理解</h3><p>函数中有另一个函数或有另一个对象，里面的函数或者是对象都可以使用外面函数中定义的变量或者参数，此时形成闭包。</p>
<blockquote>
<p>YouDontKnowJS 对闭包的解释 —— 闭包就是函数能够记住并访问它的词法作用域，即使当这个函数在它的词法作用域之外执行时。由于这个性质，<strong>闭包让我们能够从一个函数内部访问其外部函数的作用域</strong></p>
<p>闭包就是能够读取其他函数内部变量的函数。可以简单理解成“定义在一个函数内部的函数”</p>
</blockquote>
<h3 id="闭包的用途"><a href="#闭包的用途" class="headerlink" title="闭包的用途"></a>闭包的用途</h3><ul>
<li><strong>保存</strong>：缓存数据，延长作用域链</li>
<li><strong>保护</strong>：形成私有作用域，保护里面私有变量不受外界干扰，避免全局污染</li>
</ul>
<blockquote>
<p>缺点：<strong>耗内存，耗性能</strong>，函数中的变量不能及时释放</p>
</blockquote>
<h3 id="如何使用闭包"><a href="#如何使用闭包" class="headerlink" title="如何使用闭包"></a>如何使用闭包</h3><p>要使用闭包，只需要简单地将一个函数定义在另一个函数内部，并将它暴露出来。要暴露一个函数，可以将它返回或者传给其他函数。</p>
<p><strong>内部函数将能够访问到外部函数作用域中的变量</strong>，即使外部函数已经执行完毕。</p>
<p>想要缓存数据的时候就用闭包，把想要缓存的数据放在外层函数和内层函数的中间位置。</p>
<h3 id="闭包应用场景"><a href="#闭包应用场景" class="headerlink" title="闭包应用场景"></a>闭包应用场景</h3><h4 id="li-节点的-onclick-事件都能正确的弹出当前被点击的-li-索引"><a href="#li-节点的-onclick-事件都能正确的弹出当前被点击的-li-索引" class="headerlink" title="li 节点的 onclick 事件都能正确的弹出当前被点击的 li 索引"></a>li 节点的 onclick 事件都能正确的弹出当前被点击的 li 索引</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;testUL&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>index = 0<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>index = 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>index = 2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>index = 3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> nodes = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;li&#x27;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; nodes.length; i += <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="javascript">    nodes[i].onclick = (<span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// &lt;----重点是此处返回了个一个匿名函数，这个函数能访问</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 立即执行函数作用域内的i这个变量，形成闭包</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(i);</span></span><br><span class="line"><span class="javascript">      &#125;; <span class="comment">//不用闭包的话，值每次都是4</span></span></span><br><span class="line">    &#125;)(i);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="用闭包模拟私有方法"><a href="#用闭包模拟私有方法" class="headerlink" title="用闭包模拟私有方法"></a>用闭包模拟私有方法</h4><p>使用闭包定义能访问私有函数和私有变量的公有函数（也叫做模块模式）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> counter = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> privateCounter = <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">changeBy</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    privateCounter += val;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    increment: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      changeBy(<span class="number">1</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    decrement: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      changeBy(-<span class="number">1</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    value: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> privateCounter;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)(); <span class="comment">// 立即执行函数</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(counter.value()); <span class="comment">// logs 0</span></span><br><span class="line">counter.increment();</span><br><span class="line">counter.increment();</span><br><span class="line"><span class="built_in">console</span>.log(counter.value()); <span class="comment">// logs 2</span></span><br><span class="line">counter.decrement();</span><br><span class="line"><span class="built_in">console</span>.log(counter.value()); <span class="comment">// logs 1</span></span><br></pre></td></tr></table></figure>

<p>环境中包含两个私有项：名为 privateCounter 的变量和名为 changeBy 的函数。 它俩都无法在匿名函数外部直接访问。必须通过匿名包装器返回的对象的三个公共函数访问。</p>
<h3 id="解决-循环-闭包-问题"><a href="#解决-循环-闭包-问题" class="headerlink" title="解决 循环+闭包 问题"></a>解决 循环+闭包 问题</h3><p>直接 <a href="https://juejin.im/post/58f1fa6a44d904006cf25d22">点击此处</a> 查看</p>
<h2 id="this"><a href="#this" class="headerlink" title="this"></a>this</h2><h3 id="对-this-的理解"><a href="#对-this-的理解" class="headerlink" title="对 this 的理解"></a>对 this 的理解</h3><ul>
<li>this 总是指向函数的直接调用者（而非间接调用者）</li>
<li>如果有 new 关键字，this 指向 new 出来的那个对象</li>
<li>在事件中，this 指向触发这个事件的对象，特殊的是，IE 中的 attachEvent 中的 this 总是指向全局对象 window</li>
</ul>
<p><strong>重要</strong>：</p>
<ul>
<li>普通函数的 this 指向是在函数的<strong>执行期间</strong>绑定的</li>
<li>箭头函数的 this 指向是在函数<strong>创建期间</strong>就绑定好了的，指向的是创建该箭头函数所在的作用域对象</li>
<li>一般不在事件（比如 onclick ）上传递箭头函数，使用 function 就好</li>
</ul>
<h3 id="判定-this"><a href="#判定-this" class="headerlink" title="判定 this"></a>判定 <code>this</code></h3><blockquote>
<p>摘自 YouDontKnowJS</p>
</blockquote>
<p>现在，我们可以按照优先顺序来总结一下从函数调用的调用点来判定 <code>this</code> 的规则了。按照这个顺序来问问题，然后在第一个规则适用的地方停下。</p>
<ol>
<li>函数是通过 <code>new</code> 被调用的吗（<strong>new 绑定</strong>）？如果是，<code>this</code> 就是新构建的对象。<br><code>var bar = new foo()</code></li>
<li>函数是通过 <code>call</code> 或 <code>apply</code> 被调用（<strong>明确绑定</strong>），甚至是隐藏在 <code>bind</code> <em>硬绑定</em> 之中吗？如果是，<code>this</code> 就是那个被明确指定的对象。<br><code>var bar = foo.call( obj2 )</code></li>
<li>函数是通过环境对象（也称为拥有者或容器对象）被调用的吗（<strong>隐含绑定</strong>）？如果是，<code>this</code> 就是那个环境对象。<br><code>var bar = obj1.foo()</code></li>
<li>否则，使用默认的 <code>this</code>（<strong>默认绑定</strong>）。如果在 <code>strict mode</code> 下，就是 <code>undefined</code>，否则是 <code>global</code> 对象。<br><code>var bar = foo()</code></li>
</ol>
<p>以上，就是理解对于普通的函数调用来说的 <code>this</code> 绑定规则 _所需的全部_。是的……几乎是全部。</p>
<h2 id="apply-call-bind-的区别"><a href="#apply-call-bind-的区别" class="headerlink" title="apply, call, bind 的区别"></a>apply, call, bind 的区别</h2><blockquote>
<p>apply, call, bind 本身存在于大 Function 构造函数的 prototype 中</p>
<p>所有的函数都是大 Function 的实例对象</p>
</blockquote>
<img src="/posts/31920/1549791418436-78a38fa1-d824-45c0-8caa-7a6314637140.png" class="" title="apply">

<p>apply, call, bind 方法都可以改变 this 的指向</p>
<ul>
<li>apply(对象, [参数 1, 参数 2, 餐数 3, …])</li>
<li>call(对象, 参数 1, 参数 2, 餐数 3,…)</li>
<li>bind(对象,参数 1, 参数 2, 餐数 3,…)<ul>
<li>函数名称.bind()—-&gt;返回值是复制之后的这个函数</li>
</ul>
</li>
</ul>
<h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><ul>
<li>apply，call 是调用的时候改变 this 指向，然后返回函数执行的结果。<ul>
<li>参数较多时用 apply ，参数较少时用 call</li>
</ul>
</li>
<li>bind 是复制一份函数并返回，并且这个函数的 this 指向变成了传入的第一个参数。</li>
</ul>
<h3 id="手写-bind、apply、call"><a href="#手写-bind、apply、call" class="headerlink" title="手写 bind、apply、call"></a>手写 bind、apply、call</h3><h4 id="call"><a href="#call" class="headerlink" title="call"></a>call</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.call = <span class="function"><span class="keyword">function</span> (<span class="params">context, ...args</span>) </span>&#123;</span><br><span class="line">  context = context || <span class="built_in">window</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fnSymbol = <span class="built_in">Symbol</span>(<span class="string">&#x27;fn&#x27;</span>);</span><br><span class="line">  context[fnSymbol] = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  context[fnSymbol](...args);</span><br><span class="line">  <span class="keyword">delete</span> context[fnSymbol];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">context, argsArr</span>) </span>&#123;</span><br><span class="line">  context = context || <span class="built_in">window</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fnSymbol = <span class="built_in">Symbol</span>(<span class="string">&#x27;fn&#x27;</span>);</span><br><span class="line">  context[fnSymbol] = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  context[fnSymbol](...argsArr);</span><br><span class="line">  <span class="keyword">delete</span> context[fnSymbol];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span> (<span class="params">context, ...args</span>) </span>&#123;</span><br><span class="line">  context = context || <span class="built_in">window</span>;</span><br><span class="line">  <span class="keyword">const</span> fnSymbol = <span class="built_in">Symbol</span>(<span class="string">&#x27;fn&#x27;</span>);</span><br><span class="line">  context[fnSymbol] = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">..._args</span>) </span>&#123;</span><br><span class="line">    _args = _args.concat(args);</span><br><span class="line"></span><br><span class="line">    context[fnSymbol](..._args);</span><br><span class="line">    <span class="keyword">delete</span> context[fnSymbol];</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="JavaScript-原型"><a href="#JavaScript-原型" class="headerlink" title="JavaScript 原型"></a>JavaScript 原型</h2><h3 id="什么是原型"><a href="#什么是原型" class="headerlink" title="什么是原型"></a>什么是原型</h3><blockquote>
<p><strong>实例对象</strong>中有个属性 <strong>proto</strong> ，是个对象，叫原型，不是标准的属性，浏览器使用的—–&gt;可以叫<strong>原型对象</strong></p>
<p><strong>构造函数</strong>中有一个属性 <strong>prototype</strong> ，也是个对象，叫原型，是标准属性，程序员使用—&gt;可以叫<strong>原型对象</strong></p>
<p><em>实例对象的 <strong>proto</strong> 和构造函数中的 prototype 相等—&gt; true</em></p>
<p><em>又因为实例对象是通过构造函数来创建的，构造函数中有原型对象 prototype</em></p>
<p><em>实例对象的 <strong>proto</strong> 指向了构造函数的原型对象 prototype</em></p>
</blockquote>
<p>每个对象都会在其内部初始化一个属性，就是 prototype（原型）。原型就是 <strong>proto</strong>（IE8 不支持，非标准属性） 或者是 prototype ，都是原型对象。</p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><ul>
<li>共享数据，目的是：节省内存空间</li>
<li>实现继承，目的是：节省内存空间</li>
</ul>
<h2 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h2><h3 id="什么是原型链"><a href="#什么是原型链" class="headerlink" title="什么是原型链"></a>什么是原型链</h3><p>当对象查找一个属性的时候，如果没有在自身找到，那么就会查找自身的原型，如果原型还没有找到，那么会继续查找原型的原型，直到找到 Object.prototype 的原型时，此时原型为 null，查找停止。这种通过 通过原型链接的逐级向上的查找链被称为原型链。</p>
<p><strong>原型和原型链</strong></p>
<img src="/posts/31920/1549711479179-356c282c-60db-41ea-82df-5ebfb9550785.png" class="" title="prototype">

<p><strong>原型链最终指向</strong></p>
<img src="/posts/31920/1549711526339-9b043225-9ad9-4f88-b1b5-95da79cc4bf8.png" class="" title="原型链最终指向">

<h3 id="分别使用原型链和-class-的方式实现继承"><a href="#分别使用原型链和-class-的方式实现继承" class="headerlink" title="分别使用原型链和 class 的方式实现继承"></a>分别使用原型链和 class 的方式实现继承</h3><h4 id="1-组合继承（原型链-借用构造函数）【不推荐】"><a href="#1-组合继承（原型链-借用构造函数）【不推荐】" class="headerlink" title="1. 组合继承（原型链 + 借用构造函数）【不推荐】"></a>1. 组合继承（原型链 + 借用构造函数）【不推荐】</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayHi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name, age, weight</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 借用构造函数</span></span><br><span class="line">  Person.call(<span class="built_in">this</span>, name, age);</span><br><span class="line">  <span class="built_in">this</span>.weight = weight;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 改变原型指向----继承</span></span><br><span class="line"><span class="comment">// 我们让 Student.prototype 指向一个 Person 的实例对象</span></span><br><span class="line"><span class="comment">// 这个对象的 __proto__ 指向的是 Person.prototype</span></span><br><span class="line"><span class="comment">// 所以我们就可以借助这个实例对象拿到 sayHi 方法，实现继承</span></span><br><span class="line">Student.prototype = <span class="keyword">new</span> Person();</span><br><span class="line">Student.prototype.eat = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> stu = <span class="keyword">new</span> Student(<span class="string">&#x27;Lance&#x27;</span>, <span class="number">20</span>, <span class="number">120</span>);</span><br><span class="line"><span class="keyword">var</span> stu2 = <span class="keyword">new</span> Student(<span class="string">&#x27;Will&#x27;</span>, <span class="number">200</span>, <span class="number">110</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性和方法都被继承了</span></span><br></pre></td></tr></table></figure>

<p>由上面方案引出的问题：</p>
<h5 id="为什么不能-Student-prototype-Person-prototype"><a href="#为什么不能-Student-prototype-Person-prototype" class="headerlink" title="为什么不能 Student.prototype = Person.prototype"></a>为什么不能 Student.prototype = Person.prototype</h5><p>对象的赋值只是引用的赋值, 上面两者都指向同一个内存地址，只要随便通过 1 个途径就能修改该内存地址的对象，这样子类就无法单独扩展方法，因为会影响父类。</p>
<h5 id="单纯的原型链继承有什么缺陷"><a href="#单纯的原型链继承有什么缺陷" class="headerlink" title="单纯的原型链继承有什么缺陷"></a>单纯的原型链继承有什么缺陷</h5><p>虽然改变了原型的指向，但属性在初始化的时候就已经固定了【Student.prototype = new Person(“小明”, 29, 90)】，如果是多个对象实例化，那么每个实例对象的属性的初始值就都是一样的。换句话说，无法向父类传递参数。</p>
<h5 id="单纯的借用构造函数继承有什么缺陷"><a href="#单纯的借用构造函数继承有什么缺陷" class="headerlink" title="单纯的借用构造函数继承有什么缺陷"></a>单纯的借用构造函数继承有什么缺陷</h5><p>只能继承父类构造函数里面的属性和方法【Person.call(this, name, age)】，但父类的 prototype（原型）上的属性和方法不能继承。</p>
<h5 id="组合继承的缺点"><a href="#组合继承的缺点" class="headerlink" title="组合继承的缺点"></a>组合继承的缺点</h5><p>调用了两次父类的构造函数。第一次给子类的原型添加了父类构造函数中的属性方法，第二次又给子类的构造函数添加了父类的构造函数的属性方法，从而覆盖了子类原型中的同名参数。这种被覆盖的情况造成了性能上的浪费：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = <span class="string">&#x27;parent&#x27;</span>;</span><br><span class="line">  <span class="built_in">this</span>.arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SuperType.prototype.say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  SuperType.call(<span class="built_in">this</span>); <span class="comment">// 第二次调用SuperType</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType(); <span class="comment">// 第一次调用SuperType</span></span><br></pre></td></tr></table></figure>

<h4 id="2-寄生组合继承【推荐】"><a href="#2-寄生组合继承【推荐】" class="headerlink" title="2. 寄生组合继承【推荐】"></a>2. 寄生组合继承【推荐】</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">  <span class="built_in">this</span>.sayHi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.eat = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name, age, weight</span>) </span>&#123;</span><br><span class="line">  Person.call(<span class="built_in">this</span>, name, age);</span><br><span class="line">  <span class="built_in">this</span>.weight = weight;</span><br><span class="line">  <span class="built_in">this</span>.study = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="comment">// 核心：因为是对父类原型的复制，所以不包含父类的构造函数，也就不会调用两次父类的构造函数造成浪费</span></span><br><span class="line">F.prototype = Person.prototype; <span class="comment">// 创建了父类原型的浅复制</span></span><br><span class="line">Student.prototype = <span class="keyword">new</span> F();</span><br><span class="line"><span class="comment">// 上面三段js代码也可以用 Student.prototype = Object.create(Person.prototype) 代替</span></span><br><span class="line">Student.prototype.constructor = Student; <span class="comment">// 修正原型的构造函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stu1 = <span class="keyword">new</span> Student(<span class="string">&#x27;Lance&#x27;</span>, <span class="number">19</span>, <span class="number">120</span>);</span><br><span class="line"><span class="built_in">console</span>.dir(stu1);</span><br></pre></td></tr></table></figure>

<h4 id="3-class-实现继承"><a href="#3-class-实现继承" class="headerlink" title="3. class 实现继承"></a>3. class 实现继承</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, age</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">    <span class="comment">// 类本身的方法</span></span><br><span class="line">    <span class="built_in">this</span>.sayHi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 这里的 eat 相当于 prototype 中的 eat</span></span><br><span class="line">  <span class="function"><span class="title">eat</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关键点：extends super</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, age, weight</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(name, age);</span><br><span class="line">    <span class="built_in">this</span>.weight = weight;</span><br><span class="line">    <span class="built_in">this</span>.study = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">run</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stu = <span class="keyword">new</span> Student(<span class="string">&#x27;Jerry&#x27;</span>, <span class="number">20</span>, <span class="number">100</span>);</span><br><span class="line"><span class="built_in">console</span>.dir(stu);</span><br></pre></td></tr></table></figure>

<h3 id="原型链，proto-和-prototype-的区别"><a href="#原型链，proto-和-prototype-的区别" class="headerlink" title="原型链，proto 和 prototype 的区别"></a>原型链，proto 和 prototype 的区别</h3><p>对象拥有 <strong>proto</strong> 属性，函数拥有 prototype 属性。某个实例对象的 <strong>proto</strong> 指向构造它的构造函数的 prototype 属性。所以：实例对象的 <strong>proto</strong> 指向了构造函数的原型对象 prototype<br>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.b = b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实例对象</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> B(<span class="string">&#x27;lc&#x27;</span>);</span><br><span class="line">b.__proto__ === B.prototype; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://blog.csdn.net/lc237423551/article/details/80010100"><strong>彻底理解什么是原型链，prototype 和**proto**的区别。</strong></a></p>
<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><blockquote>
<p>函数（包括构造函数）是对象</p>
<p>对象不一定是函数</p>
<p>对象有 <strong>proto</strong></p>
<p>函数有 prototype</p>
</blockquote>
<h3 id="创建对象的三种方式"><a href="#创建对象的三种方式" class="headerlink" title="创建对象的三种方式"></a>创建对象的三种方式</h3><h4 id="字面量的方式"><a href="#字面量的方式" class="headerlink" title="字面量的方式"></a>字面量的方式</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">&#x27;Lance&#x27;</span>,</span><br><span class="line">  age: <span class="number">20</span>,</span><br><span class="line">  sayHi: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="调用系统的构造函数"><a href="#调用系统的构造函数" class="headerlink" title="调用系统的构造函数"></a>调用系统的构造函数</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">obj.name = <span class="string">&#x27;Lance&#x27;</span>;</span><br><span class="line">obj.age = <span class="number">20</span>;</span><br><span class="line">obj.sayHi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="自定义构造函数"><a href="#自定义构造函数" class="headerlink" title="自定义构造函数"></a>自定义构造函数</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">  <span class="built_in">this</span>.sayHi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="new-操作符具体干了什么呢？"><a href="#new-操作符具体干了什么呢？" class="headerlink" title="new 操作符具体干了什么呢？"></a>new 操作符具体干了什么呢？</h4><ol>
<li>创建一个新对象，如：var obj = {};</li>
<li>新对象的 <code>__proto__</code> 属性指向构造函数的原型对象。</li>
<li>将构造函数的作用域赋值给新对象。（也所以 this 对象指向新对象）</li>
<li>执行构造函数内部的代码，将属性添加给 obj 中的 this 对象。</li>
<li>返回新对象 obj。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_new</span>(<span class="params">fn, ...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> obj = <span class="built_in">Object</span>.create(fn.prototype);</span><br><span class="line">  <span class="keyword">const</span> ret = fn.apply(obj, args);</span><br><span class="line">  <span class="keyword">return</span> ret <span class="keyword">instanceof</span> <span class="built_in">Object</span> ? ret : obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="通过-new-的方式创建对象和通过字面量创建有什么区别？"><a href="#通过-new-的方式创建对象和通过字面量创建有什么区别？" class="headerlink" title="通过 new 的方式创建对象和通过字面量创建有什么区别？"></a>通过 new 的方式创建对象和通过字面量创建有什么区别？</h4><ol>
<li>字面量创建对象，不会调用 Object 构造函数, 简洁且性能更好;</li>
<li>new Object() 方式创建对象本质上是方法调用，涉及到在 proto 链中遍历该方法，当找到该方法后，又会生产方法调用必须的 堆栈信息，方法调用结束后，还要释放该堆栈，性能不如字面量的方式</li>
</ol>
<h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><h3 id="什么是事件，IE-与火狐的事件机制有什么区别？-如何阻止冒泡？"><a href="#什么是事件，IE-与火狐的事件机制有什么区别？-如何阻止冒泡？" class="headerlink" title="什么是事件，IE 与火狐的事件机制有什么区别？ 如何阻止冒泡？"></a>什么是事件，IE 与火狐的事件机制有什么区别？ 如何阻止冒泡？</h3><ol>
<li>我们在网页中的某个操作（有的操作对应多个事件）。例如：当我们点击一个按钮就会产生一个事件。是可以被 JavaScript 侦测到的行为。</li>
<li>事件处理机制：IE9 以下只支持事件冒泡、Firefox、Chrome 等则同时支持两种事件模型，也就是：捕获型事件和冒泡型事件。</li>
<li>ev.stopPropagation();（旧 ie 的方法 ev.cancelBubble = true）</li>
</ol>
<h3 id="事件流"><a href="#事件流" class="headerlink" title="事件流"></a>事件流</h3><img src="/posts/31920/1550160415749-0297296f-0559-485f-bfe4-05859bdc757a.jpeg" class="" title="事件阶段">

<p>事件流是网页元素接收事件的顺序，”DOM2 级事件”规定的事件流包括三个阶段：</p>
<ul>
<li>事件捕获阶段</li>
<li>处于目标阶段</li>
<li>事件冒泡阶段</li>
</ul>
<p>首先发生的事件捕获，为截获事件提供机会。</p>
<p>然后是实际的目标接受事件。</p>
<p>最后一个阶段是时间冒泡阶段，可以在这个阶段对事件做出响应。</p>
<p>虽然捕获阶段在规范中规定不允许响应事件，但是实际上还是会执行，所以有两次机会获取到目标对象。</p>
<h3 id="什么是-DOM-事件模型"><a href="#什么是-DOM-事件模型" class="headerlink" title="什么是 DOM 事件模型"></a>什么是 DOM 事件模型</h3><p>主要有三种 DOM 事件模型：</p>
<ol>
<li><strong>事件冒泡</strong>：元素先监听到这个事件，往外传播；</li>
<li><strong>事件捕获</strong>：Document 最先监听到这个事件；</li>
<li><strong>DOM 事件流</strong>：先捕获，再冒泡。允许在某些地方监听事件，假设在某个元素两阶段都绑定一个事件监听器，看你是决定在左边捕获阶段监听，还是右边冒泡阶段监听，哪一边有响应，哪一边事件就被触发。即可以在任一阶段、任意时机监听事件。</li>
</ol>
<h3 id="事件绑定的三种方式"><a href="#事件绑定的三种方式" class="headerlink" title="事件绑定的三种方式"></a>事件绑定的三种方式</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 【 DOM0 级事件 】</span></span><br><span class="line"><span class="comment">// 第一种：作为属性，写在标签上</span></span><br><span class="line"><span class="comment">// &lt;div onclick=&quot;fun();&quot;&gt;click&lt;/div&gt; ← 绑定在事件冒泡阶段</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种，使用 onclick</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;xxx&#x27;</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;; <span class="comment">// ← 绑定在事件冒泡阶段</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 【 DOM2 级事件 】</span></span><br><span class="line"><span class="comment">// 第三种：使用推荐的标准模式</span></span><br><span class="line"><span class="built_in">document</span></span><br><span class="line">  .getElementById(<span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line">  .addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;&#125;, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// 第三种可以改变事件绑定的阶段</span></span><br><span class="line"><span class="comment">// ---&gt; 为 false 时，绑定在事件冒泡阶段（默认下是绑定在冒泡阶段）</span></span><br><span class="line"><span class="comment">// ---&gt; 为 true 时，绑定在捕获阶段</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果绑定在捕获阶段，监听函数就只在捕获阶段触发</span></span><br><span class="line"><span class="comment">// 如果绑定在冒泡阶段，监听函数只在冒泡阶段触发。</span></span><br></pre></td></tr></table></figure>

<h3 id="DOM2-事件传播机制"><a href="#DOM2-事件传播机制" class="headerlink" title="DOM2 事件传播机制"></a>DOM2 事件传播机制</h3><p>DOM 作为事件处理的一个基本标准，DOM2 级事件为 DOM 事件的升级；</p>
<p>DOM2 级事件定义用于处理指定和删除事件处理程序的操作：</p>
<ul>
<li>addEventListener</li>
<li>removeEventListener</li>
</ul>
<p>所有的 DOM 节点都包含这两个方法，并且它们都接受三个参数：</p>
<ol>
<li>事件类型；</li>
<li>事件处理方法；</li>
<li>布尔参数。如果是 true 表示在捕获阶段调用事件处理程序；如果是 false，则是在事件冒泡阶段处理。</li>
</ol>
<h3 id="事件的执行顺序"><a href="#事件的执行顺序" class="headerlink" title="事件的执行顺序"></a>事件的执行顺序</h3><ul>
<li>无论是哪种绑定方式，对于同一个绑定元素，都是遵循先绑定的先执行原则。</li>
<li>如果是以 onclick 的方式绑定的，如果对同一个元素重复绑定的话，后面的会覆盖前面的。但是如果是以 addEventListener 方式绑定的话，同一个元素绑定多少次，就会执行多少次。</li>
<li>如果在 DOM 中直接使用 onclick ，则 onclick 的绑定是早于 addEventListener 的。</li>
</ul>
<h4 id="我们给一个-dom-同时绑定两个点击事件，一个用捕获，一个用冒泡。会执行几次事件，会先执行冒泡还是捕获？"><a href="#我们给一个-dom-同时绑定两个点击事件，一个用捕获，一个用冒泡。会执行几次事件，会先执行冒泡还是捕获？" class="headerlink" title="我们给一个 dom 同时绑定两个点击事件，一个用捕获，一个用冒泡。会执行几次事件，会先执行冒泡还是捕获？"></a>我们给一个 dom 同时绑定两个点击事件，一个用捕获，一个用冒泡。会执行几次事件，会先执行冒泡还是捕获？</h4><p>会执行两次事件，按代码执行顺序来</p>
<p><strong>规律</strong>：绑定在被点击元素的事件是按照代码顺序发生，其他元素通过冒泡或者捕获“感知”的事件，按照<a href="https://www.baidu.com/s?wd=W3C&tn=24004469_oem_dg&rsv_dl=gh_pl_sl_csd">W3C</a>的标准，先发生捕获事件，后发生冒泡事件。所有事件的顺序是：其他元素捕获阶段事件 -&gt; <strong>本元素代码顺序事件</strong> -&gt; 其他元素冒泡阶段事件</p>
<h4 id="小练习"><a href="#小练习" class="headerlink" title="小练习"></a>小练习</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件冒泡<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;parEle&quot;</span>&gt;</span></span><br><span class="line">        我是父元素</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;sonEle&quot;</span>&gt;</span>我是子元素<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> sonEle = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;sonEle&#x27;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> parEle = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;parEle&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line">  parEle.addEventListener(</span><br><span class="line"><span class="javascript">    <span class="string">&#x27;click&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">&#x27;父级 冒泡&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="literal">false</span></span></span><br><span class="line">  );</span><br><span class="line">  parEle.addEventListener(</span><br><span class="line"><span class="javascript">    <span class="string">&#x27;click&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">&#x27;父级 捕获&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="literal">true</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  sonEle.addEventListener(</span><br><span class="line"><span class="javascript">    <span class="string">&#x27;click&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">&#x27;子级冒泡&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="literal">false</span></span></span><br><span class="line">  );</span><br><span class="line">  sonEle.addEventListener(</span><br><span class="line"><span class="javascript">    <span class="string">&#x27;click&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">&#x27;子级捕获&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="literal">true</span></span></span><br><span class="line">  );</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上述代码父子事件的执行顺序是什么？</p>
<p>解析：</p>
<p>当容器元素及嵌套元素，即在<code>捕获阶段</code>又在<code>冒泡阶段</code>调用事件处理程序时：<strong>事件按 DOM 事件流的顺序</strong>执行事件处理程序：</p>
<ul>
<li>父级捕获</li>
<li>子级冒泡</li>
<li>子级捕获</li>
<li>父级冒泡</li>
</ul>
<p>且当事件处于目标阶段时，事件调用顺序决定于绑定事件的<strong>书写顺序</strong>，按上面的例子为，先调用冒泡阶段的事件处理程序，再调用捕获阶段的事件处理程序。依次 alert 出“子集冒泡”，“子集捕获”。</p>
<h3 id="事件委托"><a href="#事件委托" class="headerlink" title="事件委托"></a>事件委托</h3><p>绑定在父级元素，利用事件冒泡去触发父级事件处理函数的一种技巧。</p>
<h4 id="实现一个事件委托"><a href="#实现一个事件委托" class="headerlink" title="实现一个事件委托"></a>实现一个事件委托</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ul = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;ul&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listen</span>(<span class="params">element, eventType, targetElement, fn</span>) </span>&#123;</span><br><span class="line">  element.addEventListener(eventType, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 先拿到当前事件的直接触发对象</span></span><br><span class="line">    <span class="keyword">var</span> curTarget = e.target;</span><br><span class="line">    <span class="comment">// 看它是不是使用者监听的目标对象类型</span></span><br><span class="line">    <span class="comment">// 一旦发现不是，就执行循环</span></span><br><span class="line">    <span class="keyword">while</span> (!curTarget.matches(targetElement)) &#123;</span><br><span class="line">      <span class="comment">// 先看看当前对象是不是和父元素相同</span></span><br><span class="line">      <span class="comment">// 相同则把当前对象置为空，且不执行回调</span></span><br><span class="line">      <span class="keyword">if</span> (curTarget === element) &#123;</span><br><span class="line">        curTarget = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 不相同则把当前对象设置成自己的父对象</span></span><br><span class="line">      curTarget = curTarget.parentNode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 是，则先看当前对象有没有值，有值则执行回调函数</span></span><br><span class="line">    curTarget &amp;&amp; fn(e, curTarget, e);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">listen(ul, <span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;li&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, el</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event, el);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// jquery 使用方式</span></span><br><span class="line">$(<span class="string">&#x27;ul&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;li&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log($(e.target).html());</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 这个 on 事件是绑定在 ul 上面的，li 是目标元素，</span></span><br><span class="line"><span class="comment">// on 事件内部是通过 e.target 来判断点击元素是不是 li 的</span></span><br></pre></td></tr></table></figure>

<h3 id="解释以下概念：事件传播机制、阻止传播、取消默认事件、事件代理？"><a href="#解释以下概念：事件传播机制、阻止传播、取消默认事件、事件代理？" class="headerlink" title="解释以下概念：事件传播机制、阻止传播、取消默认事件、事件代理？"></a>解释以下概念：事件传播机制、阻止传播、取消默认事件、事件代理？</h3><p><strong>1. 事件传播机制主要有三种：</strong></p>
<ul>
<li>事件冒泡：事件开始时由最具体的元素接收，然后逐级向上传播到较为不具体的元素（从小到大）；</li>
<li>事件捕获：不太具体的节点更早接收事件，而最具体的元素最后接收事件，和事件冒泡相反（从大到小）；</li>
<li>DOM 事件流：DOM2 级事件规定事件流包括三个阶段，事件捕获阶段，处于目标阶段，事件冒泡阶段，首先发生的是事件捕获，为截取事件提供机会，然后是实际目标接收事件，最后是冒泡阶段（标准浏览器现在都使用 DOM 事件流，IE 不支持事件流，只支持事件冒泡）。</li>
</ul>
<p><strong>2. 阻止传播</strong></p>
<p>stopPropagation() 取消事件进一步捕获或冒泡。</p>
<p><strong>3. 取消默认事件</strong></p>
<p>preventDefault() 取消事件默认行为。</p>
<p><strong>4. 事件代理</strong></p>
<p>通过事件冒泡（或者事件捕获）给父元素添加事件监听，e.target 指向引发触发事件的元素。</p>
<h3 id="什么是节流和防抖"><a href="#什么是节流和防抖" class="headerlink" title="什么是节流和防抖"></a>什么是节流和防抖</h3><h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><ul>
<li>debounce（防抖）的作用是在让在用户动作停止后延迟 x ms 再执行回调</li>
<li>throttle（节流）的作用是在用户动作时每隔一定时间（如 200ms）执行一次回调</li>
</ul>
<h4 id="节流防抖作用"><a href="#节流防抖作用" class="headerlink" title="节流防抖作用"></a>节流防抖作用</h4><ul>
<li>debounce 应用在搜索框的即时搜索（input 事件），避免用户狂按键盘导致的频繁请求</li>
<li>throttle 应用在监听 resize 改变布局或 onscroll 滚动</li>
</ul>
<p><strong>防抖</strong>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &lt;input type=&quot;text&quot; oninput=&quot;change()&quot;&gt;</span></span><br><span class="line"><span class="comment">// 防抖（一段时间会等，然后带着一起做了）</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn, delay</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="built_in">this</span>,</span><br><span class="line">      args = <span class="built_in">arguments</span>;</span><br><span class="line">    <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">      <span class="built_in">window</span>.clearTimeout(timer);</span><br><span class="line">    &#125;</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      fn.apply(context, args);</span><br><span class="line">      timer = <span class="literal">null</span>;</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> change = debounce(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> input = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(input.value);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p><strong>节流</strong>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &lt;div class=&quot;sw&quot;&gt;23333&lt;/div&gt;</span></span><br><span class="line"><span class="comment">// 节流（一段时间执行一次之后，就不执行第二次）</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn, delay</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> canUse = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> context = <span class="built_in">this</span>,</span><br><span class="line">      args = <span class="built_in">arguments</span>;</span><br><span class="line">    <span class="keyword">if</span> (canUse) &#123;</span><br><span class="line">      fn.apply(context, args);</span><br><span class="line">      canUse = <span class="literal">false</span>;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> (canUse = <span class="literal">true</span>), delay);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sw = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;.sw&#x27;</span>);</span><br><span class="line"></span><br><span class="line">sw.addEventListener(</span><br><span class="line">  <span class="string">&#x27;click&#x27;</span>,</span><br><span class="line">  throttle(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e);</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<ul>
<li><a href="https://blog.csdn.net/qq_37860930/article/details/83545473%E2%80%98">在 React、Vue 和小程序中使用函数节流和函数防抖</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/38313717">函数防抖与函数节流</a></li>
<li><a href="http://www.webfront-js.com/articaldetail/99.html">JS 事件中防抖 debounce 和节流 throttle 概念原理的学习</a></li>
</ul>
<h3 id="mouseover-和-mouseenter-的区别"><a href="#mouseover-和-mouseenter-的区别" class="headerlink" title="mouseover 和 mouseenter 的区别"></a>mouseover 和 mouseenter 的区别</h3><ul>
<li>mouseover：<br>不论鼠标指针穿过被选元素或其子元素，都会触发 <code>mouseover</code> 事件。<br>支持事件冒泡。<br>相对应 <code>mouseout</code> 事件。</li>
<li>mouseenter：<br>只有在鼠标指针穿过被选元素时，才会触发 <code>mouseenter</code> 事件。<br>不支持事件冒泡。<br>相对应 <code>mouseleave</code> 事件。</li>
</ul>
<p>参考：<a href="https://blog.csdn.net/u010297791/article/details/57412796">JavaScript 中的 mouseover 与 mouseenter ，mouseout 和 mouseleave 的区别</a></p>
<h3 id="window-onload-和-document-onDOMContentLoaded-有什么区别？"><a href="#window-onload-和-document-onDOMContentLoaded-有什么区别？" class="headerlink" title="window.onload 和 document.onDOMContentLoaded 有什么区别？"></a>window.onload 和 document.onDOMContentLoaded 有什么区别？</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//当页面所有资源加载完成，则触发（涉及到所有资源，所以触发时机较晚）。</span></span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;window loaded&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//DOM 结构解析完成（并不是页面上资源加载完成，而是 dom 结构渲染完成）。</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;DOMContentLoaded&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="lt-script-src-’xxx’-’xxx’-gt-外部-js-文件先加载还是-onload-先执行"><a href="#lt-script-src-’xxx’-’xxx’-gt-外部-js-文件先加载还是-onload-先执行" class="headerlink" title="&lt;script src=’xxx’ ’xxx’/&gt;外部 js 文件先加载还是 onload 先执行"></a>&lt;script src=’xxx’ ’xxx’/&gt;外部 js 文件先加载还是 onload 先执行</h3><p>onload 是所有加载完成之后执行的</p>
<h2 id="ES6-相关"><a href="#ES6-相关" class="headerlink" title="ES6 相关"></a>ES6 相关</h2><h3 id="ES6-用到过吗，新增了哪些东西，你用到过什么？"><a href="#ES6-用到过吗，新增了哪些东西，你用到过什么？" class="headerlink" title="ES6 用到过吗，新增了哪些东西，你用到过什么？"></a>ES6 用到过吗，新增了哪些东西，你用到过什么？</h3><ul>
<li><code>let</code> 和 <code>const</code></li>
<li>模板字符串</li>
<li>箭头函数（自己没有 this ，从自己的作用域链的<code>上一层继承 this</code> ）</li>
<li><code>for-of</code>（用来遍历数据—例如数组中的值）e.g. Array，String，Set，Map</li>
<li><code>arguments</code> 对象可被不定参数和默认参数完美代替</li>
<li>Promise</li>
<li>数组的拓展<ul>
<li>数组.find((item,index,arr) =&gt; {条件}) 返回满足条件的第一个元素的值。否则返回 undefined</li>
<li>数组.findIndex((item,index,arr)=&gt;{…}) 返回满足条件的第一个元素的索引值。否则返回 -1</li>
<li>数组.includes(数据,[searchIndex]) 判断数据是否在数组中,第二个参数(可选参数)为从指定索引处(包含索引处的值)开始搜索 返回布尔值(es7 时加入)</li>
<li>扩展运算符 …</li>
</ul>
</li>
<li>引入 <code>module</code> 模块的概念</li>
</ul>
<h3 id="const-和-let-区别"><a href="#const-和-let-区别" class="headerlink" title="const 和 let 区别"></a>const 和 let 区别</h3><ul>
<li>let 定义变量可以只声明不赋值</li>
<li>const 定义常量声明时必须赋值，一旦定义不可轻易改变值</li>
</ul>
<h4 id="共同点"><a href="#共同点" class="headerlink" title="共同点"></a>共同点</h4><p>解决 var 没有块作用域、变量提升、可以重复声明的问题。let 和 const 有自己的块作用域，不存在变量提升问题，同一块作用域中不可重复声明（会报错）</p>
<h4 id="let-var-区别"><a href="#let-var-区别" class="headerlink" title="let var 区别"></a>let var 区别</h4><ul>
<li><p>var 有变量提升，let 没有</p>
</li>
<li><p>let 的作用域是块，而 var 的作用域是函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a === <span class="number">5</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">4</span>; <span class="comment">// The scope is inside the if-block</span></span><br><span class="line">  <span class="keyword">var</span> b = <span class="number">1</span>; <span class="comment">// The scope is inside the function</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(a); <span class="comment">// 4</span></span><br><span class="line">  <span class="built_in">console</span>.log(b); <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 5</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>let 有暂时性死区，只要 let/const 声明的变量，在未声明之前使用或者赋值都会报错（ReferenceError）</p>
</li>
<li><p>let 不能重复定义</p>
</li>
</ul>
<h4 id="可以改变-const-定义的某个对象的属性吗"><a href="#可以改变-const-定义的某个对象的属性吗" class="headerlink" title="可以改变 const 定义的某个对象的属性吗"></a>可以改变 const 定义的某个对象的属性吗</h4><p>可以，因为对象是复杂类型，const 存储的是引用，所以改变对象的成员不会报错，但不建议这样做。</p>
<h3 id="箭头函数（-this-指向）"><a href="#箭头函数（-this-指向）" class="headerlink" title="箭头函数（ this 指向）"></a>箭头函数（ this 指向）</h3><ul>
<li>箭头函数，本质上，就是一个匿名函数</li>
<li>箭头函数无法通过 call、apply、bind 来手动改变内部 this 指向</li>
<li>箭头函数：自动 .bind(this) 也就是说箭头函数中的 this 指向与其所在作用域的 this 指向相同</li>
</ul>
<p><strong>总结</strong>：</p>
<p>箭头函数不会创建自己的 <code>this</code> ，它只会从自己的作用域链的 <code>上一层继承 this</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Person() 构造函数定义 `this` 作为它自己的实例.</span></span><br><span class="line">  <span class="built_in">this</span>.age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> <span class="title">growUp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 在非严格模式, growUp() 函数定义 `this`作为全局对象,</span></span><br><span class="line">    <span class="comment">// 与在 Person() 构造函数中定义的 `this`并不相同.</span></span><br><span class="line">    <span class="built_in">this</span>.age++;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用箭头函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.age++; <span class="comment">// |this| 正确地指向 p 实例</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure>

<h4 id="箭头函数与普通函数的区别"><a href="#箭头函数与普通函数的区别" class="headerlink" title="箭头函数与普通函数的区别"></a>箭头函数与普通函数的区别</h4><ol>
<li>箭头函数是匿名函数，不能作为构造函数，不能使用 new。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> B = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  value: <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> B(); <span class="comment">//--&gt;TypeError: B is not a constructor</span></span><br></pre></td></tr></table></figure>

<ol>
<li>箭头函数不绑定 arguments，取而代之用 rest 参数 … 解决。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> B = <span class="function"><span class="params">b</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...c 即为 rest 参数</span></span><br><span class="line"><span class="keyword">var</span> C = <span class="function">(<span class="params">...c</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(c);</span><br><span class="line">&#125;;</span><br><span class="line">A(<span class="number">1</span>); <span class="comment">//--&gt;[object Arguments] &#123;0: 1&#125;</span></span><br><span class="line">B(<span class="number">2</span>); <span class="comment">//--&gt;ReferenceError: arguments is not defined</span></span><br><span class="line">C(<span class="number">3</span>); <span class="comment">//--&gt;[3]</span></span><br></pre></td></tr></table></figure>

<ol>
<li>箭头函数不绑定 this，会捕获其所在的上下文的 this 值，作为自己的 this 值。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  a: <span class="number">10</span>,</span><br><span class="line">  b: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.a);</span><br><span class="line">  &#125;,</span><br><span class="line">  c: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.a);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.b(); <span class="comment">//--&gt;10</span></span><br><span class="line">obj.c()(); <span class="comment">//--&gt;10</span></span><br></pre></td></tr></table></figure>

<ol>
<li>箭头函数通过 call() 或 apply() 方法调用一个函数时，只传入了一个参数，对 this 并没有影响。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  a: <span class="number">10</span>,</span><br><span class="line">  b: <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> f = <span class="function"><span class="params">v</span> =&gt;</span> v + <span class="built_in">this</span>.a;</span><br><span class="line">    <span class="keyword">return</span> f(n);</span><br><span class="line">  &#125;,</span><br><span class="line">  c: <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> f = <span class="function"><span class="params">v</span> =&gt;</span> v + <span class="built_in">this</span>.a;</span><br><span class="line">    <span class="keyword">var</span> m = &#123; <span class="attr">a</span>: <span class="number">20</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> f.call(m, n);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.b(<span class="number">1</span>)); <span class="comment">//--&gt;11</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.c(<span class="number">1</span>)); <span class="comment">//--&gt;11</span></span><br></pre></td></tr></table></figure>

<ol>
<li>箭头函数没有原型属性。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a.prototype); <span class="comment">//--&gt;undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(b.prototype); <span class="comment">//--&gt;object&#123;...&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>箭头函数不能当做 Generator 函数,不能使用 yield 关键字。箭头函数不能换行。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = ()</span><br><span class="line">          =&gt; <span class="number">1</span>;  <span class="comment">//--&gt;SyntaxError: Unexpected token =&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Set-和-Map"><a href="#Set-和-Map" class="headerlink" title="Set 和 Map"></a>Set 和 Map</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><ul>
<li>Set 是有序列表，类似于数组，但是没有重复值</li>
<li>Map 是存储许多键值对的有序列表，key 和 value 支持所有数据类型</li>
</ul>
<h4 id="相同点"><a href="#相同点" class="headerlink" title="相同点"></a>相同点</h4><ul>
<li>都是有序列表</li>
<li>Set 值不重复；Map 键不重复</li>
</ul>
<h4 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h4><blockquote>
<p>SET</p>
</blockquote>
<ul>
<li>属性：<ul>
<li><code>Set.prototype.constructor</code>：构造函数，默认就是 Set 函数</li>
<li><code>Set.prototype.size</code>：返回实例的成员总数</li>
</ul>
</li>
<li>操作方法：<ul>
<li><code>add(value)</code>：添加一个值，返回 Set 结构本身</li>
<li><code>delete(value)</code>：删除某个值，返回布尔值</li>
<li><code>has(value)</code>：返回布尔值，表示是否是成员</li>
<li><code>clear()</code>：清除所有成员，无返回值</li>
</ul>
</li>
<li>遍历方法（ key() 和 values() 行为是一致的。）<ul>
<li><code>keys()</code>：返回键名的遍历器（什么是遍历器？Iterator）</li>
<li><code>values()</code>：返回键值的遍历器</li>
<li><code>entries()</code>：返回键值对的遍历器</li>
<li><code>forEach()</code>：使用回调函数遍历每个成员</li>
</ul>
</li>
</ul>
<blockquote>
<p>MAP</p>
</blockquote>
<ul>
<li><p>属性</p>
<ul>
<li><code>size</code> ：返回 Map 结构的成员总数。</li>
</ul>
</li>
<li><p>操作方法</p>
<ul>
<li><code>set(key, value)</code>: <code>set</code> 方法设置键名 <code>key</code> 对应的键值为 <code>value</code> ，然后返回整个 Map 结构。</li>
<li><code>get(key)</code> ：<code>get</code> 方法读取 <code>key</code> 对应的键值，如果找不到 <code>key</code> ，返回 <code>undefined</code> 。</li>
<li><code>has(key)</code>：<code>has</code> 方法返回一个布尔值，表示某个键是否在当前 Map 对象之中。</li>
<li><code>delete(key)</code>：<code>delete</code> 方法删除某个键，返回 <code>true</code> 。如果删除失败，返回 <code>false</code> 。</li>
<li><code>clear()</code>：<code>clear</code>方法清除所有成员，没有返回值。</li>
</ul>
</li>
<li><p>遍历方法</p>
<ul>
<li><code>keys()</code>：返回键名的遍历器。</li>
<li><code>values()</code>：返回键值的遍历器。</li>
<li><code>entries()</code>：返回所有成员的遍历器。</li>
<li><code>forEach()</code>：遍历 Map 的所有成员。</li>
</ul>
</li>
</ul>
<h4 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h4><p>Set 集合可以用来过滤数组中重复的元素，只能通过 has 方法检测指定的值是否存在，或者是通过 forEach 处理每个值。</p>
<p>Map 集合通过 set() 添加键值对，通过 get() 获取键值，各种方法的使用查看文章教程，你可以把它看成是比 Object 更加强大的对象。</p>
<h4 id="Set-与-数组-的区别"><a href="#Set-与-数组-的区别" class="headerlink" title="Set 与 数组 的区别"></a>Set 与 数组 的区别</h4><p>set 不可重复，array 可重复</p>
<h4 id="Map-与-对象-的区别"><a href="#Map-与-对象-的区别" class="headerlink" title="Map 与 对象 的区别"></a>Map 与 对象 的区别</h4><ul>
<li>Object 的键只能是字符串或者 symbol ，Map 的键可以是任意类型的值（包括对象）</li>
<li>Map 可以通过 size 获取元素个数，对象得遍历。</li>
<li>Map 是有序的（根据用户插入的顺序进行排序），对象排序有自己规则（比如先排数字开头的 key ，再到字符串）</li>
<li><code>Map</code> 可直接进行迭代，而 <code>Object</code> 的迭代需要先获取它的键数组，然后再进行迭代。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">map.set(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Lance&#x27;</span>);</span><br><span class="line">map.set(<span class="string">&#x27;age&#x27;</span>, <span class="number">18</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> per = &#123;</span><br><span class="line">  name: <span class="string">&#x27;Jerry&#x27;</span>,</span><br><span class="line">  age: <span class="number">19</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> attr <span class="keyword">of</span> map.values()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(attr);</span><br><span class="line">&#125; <span class="comment">// Lance 18</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> attr <span class="keyword">of</span> <span class="built_in">Object</span>.keys(per)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(per[attr]);</span><br><span class="line">&#125; <span class="comment">// Jerry 19</span></span><br></pre></td></tr></table></figure>

<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><h4 id="promise-是什么"><a href="#promise-是什么" class="headerlink" title="promise 是什么"></a>promise 是什么</h4><p>Promise 是异步编程的一种解决方案，比传统的异步解决方案【回调函数】和【事件】更合理、更强大。</p>
<h4 id="诞生的原因"><a href="#诞生的原因" class="headerlink" title="诞生的原因"></a>诞生的原因</h4><p>异步网络请求的回调地狱，而且我们还得对每次请求的结果进行一些处理，代码会更加臃肿。</p>
<h4 id="promise-使用场景有哪些"><a href="#promise-使用场景有哪些" class="headerlink" title="promise 使用场景有哪些"></a>promise 使用场景有哪些</h4><ul>
<li>ajax 请求得到返回值的时间不同,有了 callback 的回调结果之后才能知道接下来应该做什么</li>
<li>node 中读取文件</li>
</ul>
<h4 id="三种状态"><a href="#三种状态" class="headerlink" title="三种状态"></a>三种状态</h4><ul>
<li>pending: 初始状态，既不是成功，也不是失败状态。</li>
<li>fulfilled: 意味着操作成功完成。</li>
<li>rejected: 意味着操作失败。</li>
</ul>
<h4 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h4><p><strong>Promise 的优点:</strong></p>
<ul>
<li>一旦状态改变，就不会再变，任何时候都可以得到这个结果；</li>
<li>可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数。</li>
</ul>
<p><strong>Promise 的缺点:</strong></p>
<ul>
<li>无法取消 Promise，错误需要通过回调函数来捕获；</li>
<li>当处于 pending 状态时，无法得知目前进展到哪一个阶段。</li>
</ul>
<h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//defined Promise async function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncFun</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(resolve) &#123;</span><br><span class="line">            resolve(<span class="comment">/*resolve parameter*/</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="comment">/*Error*/</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//use Promise&amp;then</span></span><br><span class="line">asyncFun().then(<span class="comment">/*function*/</span>).then(<span class="comment">/*function*/</span>)...</span><br></pre></td></tr></table></figure>

<h4 id="promise-特性"><a href="#promise-特性" class="headerlink" title="promise 特性"></a>promise 特性</h4><p>参考：<a href="https://juejin.im/post/597724c26fb9a06bb75260e8">八段代码彻底掌握 Promise</a></p>
<h4 id="promise-里面-return-一个-string，和在-resolve-一个-string-的区别"><a href="#promise-里面-return-一个-string，和在-resolve-一个-string-的区别" class="headerlink" title="promise 里面 return 一个 string，和在 resolve 一个 string 的区别"></a>promise 里面 return 一个 string，和在 resolve 一个 string 的区别</h4><p>return 一个 string 后续的 then 不会执行; resolve 一个 string 会返回一个 promise 对象，对象的值是这个 string</p>
<h4 id="在-then-里面-throw-一个-error，怎么捕捉"><a href="#在-then-里面-throw-一个-error，怎么捕捉" class="headerlink" title="在 then 里面 throw 一个 error，怎么捕捉"></a>在 then 里面 throw 一个 error，怎么捕捉</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// throw 这个 error 后，在紧挨的下一个 then 中添加两个回调方法（ resolve 的，和 reject ）。</span></span><br><span class="line"><span class="comment">// 然后在第二个 reject 方法中可以捕获</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> resolve(<span class="string">&#x27;返回Promise&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;第一个then&#x27;</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;我是错误&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(</span><br><span class="line">    resolve =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;成功&#x27;</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(resolve);</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;紧挨的失败&#x27;</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;catch错误&#x27;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// 123</span></span><br><span class="line"><span class="comment">// 第一个then</span></span><br><span class="line"><span class="comment">// 紧挨的失败</span></span><br><span class="line"><span class="comment">// Error: 我是错误</span></span><br><span class="line"><span class="comment">// at Promise.then.data (&lt;anonymous&gt;:6:15)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 then 的链式调用后添加一个 catch 来捕获</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> resolve(<span class="string">&#x27;返回Promise&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;第一个then&#x27;</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;我是错误&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;then错误&#x27;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;catch错误&#x27;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;123&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 123</span></span><br><span class="line"><span class="comment">// 第一个 then</span></span><br><span class="line"><span class="comment">// catch 错误</span></span><br><span class="line"><span class="comment">// Error: 我是错误</span></span><br><span class="line"><span class="comment">// at Promise.then.data</span></span><br></pre></td></tr></table></figure>

<h4 id="使用-Promise-封装一个-url"><a href="#使用-Promise-封装一个-url" class="headerlink" title="使用 Promise 封装一个 url"></a>使用 Promise 封装一个 url</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> getJSON = <span class="function"><span class="params">url</span> =&gt;</span></span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.open(<span class="string">&#x27;GET&#x27;</span>, url);</span><br><span class="line">    xhr.send(<span class="literal">null</span>);</span><br><span class="line">    xhr.onreadystatechange = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="comment">// &lt;= 请求已完成，且响应已就绪</span></span><br><span class="line">        <span class="keyword">if</span> (xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="comment">// &lt;= 状态OK</span></span><br><span class="line">          resolve(<span class="built_in">JSON</span>.parse(xhr.responseText));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;请求失败&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">getJSON(url).then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(res));</span><br></pre></td></tr></table></figure>

<h4 id="在-Promise-链式调用中，怎样才能保证上一个-promise-出现报错不会影响到后续-then-的正常执行"><a href="#在-Promise-链式调用中，怎样才能保证上一个-promise-出现报错不会影响到后续-then-的正常执行" class="headerlink" title="在 Promise 链式调用中，怎样才能保证上一个 promise 出现报错不会影响到后续 .then 的正常执行"></a>在 Promise 链式调用中，怎样才能保证上一个 promise 出现报错不会影响到后续 .then 的正常执行</h4><p>为了不影响后续 .then 的执行，需要在每一个 then 中指定失败的回调</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> asyncFunc = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">&#x27;123&#x27;</span>); <span class="comment">// 123, 二楼</span></span><br><span class="line">    <span class="comment">// throw new Error(&quot;出错了&quot;)    // Error: 出错了, 二楼</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">asyncFunc()</span><br><span class="line">  .then(</span><br><span class="line">    res =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="string">&#x27;二楼&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">      <span class="comment">// &lt;====== 指定失败的回调</span></span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="string">&#x27;二楼&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="Promise-构造函数是同步执行还是异步执行，那么-then-方法呢？"><a href="#Promise-构造函数是同步执行还是异步执行，那么-then-方法呢？" class="headerlink" title="Promise 构造函数是同步执行还是异步执行，那么 then 方法呢？"></a>Promise 构造函数是同步执行还是异步执行，那么 then 方法呢？</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span> <span class="keyword">new</span>的时候会立即执行里面的代码 then是微任务 会在本次任务执行完的时候执行 <span class="built_in">setTimeout</span>是宏任务 会在下次任务执行的时候执行</span><br></pre></td></tr></table></figure>

<h3 id="Async-Await"><a href="#Async-Await" class="headerlink" title="Async / Await"></a>Async / Await</h3><h4 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h4><ul>
<li>async 用于声明一个异步的 function</li>
<li>await 用于等待一个异步方法执行完成</li>
</ul>
<p>Async/Await 是一种用于处理 JS 异步操作的语法糖，可以帮助我们摆脱回调地狱（callback hell），编写更加优雅的代码。</p>
<p>通俗的理解，async 关键字的作用是告诉编译器对于标定的函数要区别对待。当编译器遇到标定的函数中的 await 关键字时，要暂时停止运行，等到 await 标定的函数处理完毕后，再进行相应操作。如果该函数 fulfiled 了，则返回值是 fulfillment value，否则得到的就是 reject value。</p>
<h4 id="Async"><a href="#Async" class="headerlink" title="Async"></a>Async</h4><p>async 函数会返回一个 Promise 对象，如果在函数中 <code>return</code> 一个直接量，async 会把这个直接量通过 <code>Promise.resolve()</code> 封装成 Promise 对象。</p>
<h4 id="Await"><a href="#Await" class="headerlink" title="Await"></a>Await</h4><p>await 是在等待一个 async 函数完成。不过按 <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/await">语法说明</a> ，await 等待的是一个表达式，这个表达式的计算结果是 Promise 对象或者其它值</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;something&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testAsync</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="string">&#x27;hello async&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> v1 = <span class="keyword">await</span> getSomething();</span><br><span class="line">  <span class="keyword">const</span> v2 = <span class="keyword">await</span> testAsync();</span><br><span class="line">  <span class="built_in">console</span>.log(v1, v2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br></pre></td></tr></table></figure>

<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><p>让代码更易读</p>
<p>假设一个业务，分多个步骤完成，每个步骤都是异步的，而且依赖于上一个步骤的结果。</p>
<p>传统 promise ，链式调用 then 一个接一个</p>
<p>改用 async/await 后就像同步代码一样</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doIt</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.time(<span class="string">&#x27;doIt&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> time1 = <span class="number">300</span>;</span><br><span class="line">  step1(time1)</span><br><span class="line">    .then(<span class="function"><span class="params">time2</span> =&gt;</span> step2(time2))</span><br><span class="line">    .then(<span class="function"><span class="params">time3</span> =&gt;</span> step3(time3))</span><br><span class="line">    .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">      <span class="built_in">console</span>.timeEnd(<span class="string">&#x27;doIt&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doIt();</span><br><span class="line"></span><br><span class="line"><span class="comment">// =======</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">doIt</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.time(<span class="string">&#x27;doIt&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> time1 = <span class="number">300</span>;</span><br><span class="line">  <span class="keyword">const</span> time2 = <span class="keyword">await</span> step1(time1);</span><br><span class="line">  <span class="keyword">const</span> time3 = <span class="keyword">await</span> step2(time2);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> step3(time3);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">&#x27;doIt&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doIt();</span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://segmentfault.com/a/1190000007535316">理解 JavaScript 的 async/await</a></p>
<p>最后拿普通的 promise 写法来和 async/await 对比，便于理解：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> otherAsyncFunc(); <span class="comment">// otherAsyncFunc()返回一个Promise对象</span></span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于:</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> otherAsyncFunc() <span class="comment">// otherAsyncFunc()返回一个Promise对象</span></span><br><span class="line">    .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(result);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按顺序处理多个异步函数的时候优势更为明显：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result1 = <span class="keyword">await</span> otherAsyncFunc1(); <span class="comment">// otherAsyncFunc1()返回一个Promise对象</span></span><br><span class="line">  <span class="built_in">console</span>.log(result1);</span><br><span class="line">  <span class="keyword">const</span> result2 = <span class="keyword">await</span> otherAsyncFunc2(); <span class="comment">// otherAsyncFunc2()返回一个Promise对象</span></span><br><span class="line">  <span class="built_in">console</span>.log(result2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于:</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> otherAsyncFunc1() <span class="comment">// otherAsyncFunc1()返回一个Promise对象</span></span><br><span class="line">    .then(<span class="function"><span class="params">result1</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(result1);</span><br><span class="line">      <span class="keyword">return</span> otherAsyncFunc2(); <span class="comment">// otherAsyncFunc2()返回一个Promise对象</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">result2</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(result2);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>并行处理多个异步函数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [result1, result2] = <span class="keyword">await</span> <span class="built_in">Promise</span>.all([</span><br><span class="line">        otherAsyncFunc1(),<span class="comment">// otherAsyncFunc1()返回一个Promise对象</span></span><br><span class="line">        otherAsyncFunc2() <span class="comment">// otherAsyncFunc2()返回一个Promise对象</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="built_in">console</span>.log(result1, result2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于:</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.all([</span><br><span class="line">        otherAsyncFunc1(),<span class="comment">// otherAsyncFunc1()返回一个Promise对象</span></span><br><span class="line">        otherAsyncFunc2() <span class="comment">// otherAsyncFunc2()返回一个Promise对象</span></span><br><span class="line">    ])</span><br><span class="line">    .then([result1, result2] =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(result1, result2);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>处理错误：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> otherAsyncFunc(); <span class="comment">// otherAsyncFunc()返回一个Promise对象</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于:</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> otherAsyncFunc() <span class="comment">// otherAsyncFunc()返回一个Promise对象</span></span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h3><h4 id="数组用法"><a href="#数组用法" class="headerlink" title="数组用法"></a>数组用法</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 前后的形式必须完全一致 才可以完成结构赋值</span></span><br><span class="line"><span class="keyword">let</span> [foo, [[bar], baz]] = [<span class="number">1</span>, [[<span class="number">2</span>], <span class="number">3</span>]];</span><br><span class="line">foo; <span class="comment">// 1</span></span><br><span class="line">bar; <span class="comment">// 2</span></span><br><span class="line">baz; <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [, , third] = [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>];</span><br><span class="line">third; <span class="comment">// &quot;baz&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [x, , y] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">x; <span class="comment">// 1</span></span><br><span class="line">y; <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [head, ...tail] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">head; <span class="comment">// 1</span></span><br><span class="line">tail; <span class="comment">// [2, 3, 4]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [x, y, ...z] = [<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">x; <span class="comment">// &quot;a&quot;</span></span><br><span class="line">y; <span class="comment">// undefined</span></span><br><span class="line">z; <span class="comment">// []</span></span><br><span class="line"><span class="comment">// 如果解构不成功，变量的值就等于undefined。</span></span><br></pre></td></tr></table></figure>

<h4 id="对象用法"><a href="#对象用法" class="headerlink" title="对象用法"></a>对象用法</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 对象的属性没有次序，变量必须与属性同名，才能取到正确的值。</span></span><br><span class="line">&#123;name, age&#125; = &#123;<span class="attr">name</span>:<span class="string">&#x27;wang&#x27;</span>,<span class="attr">age</span>: <span class="number">18</span>&#125;</span><br><span class="line">name <span class="comment">// wang</span></span><br><span class="line">age <span class="comment">// 18</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 支持别名</span></span><br><span class="line">&#123;<span class="attr">name</span>:nname, age&#125; = &#123;<span class="attr">name</span>:<span class="string">&#x27;wang&#x27;</span>,<span class="attr">age</span>: <span class="number">18</span>&#125;</span><br><span class="line">name <span class="comment">// &#x27;&#x27; 取别名时原名就会为空字符串</span></span><br><span class="line">nname <span class="comment">// wang</span></span><br><span class="line">age <span class="comment">// 18</span></span><br></pre></td></tr></table></figure>

<h4 id="…运算符"><a href="#…运算符" class="headerlink" title="…运算符"></a>…运算符</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[a, ...b] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">a; <span class="comment">// 1</span></span><br><span class="line">b; <span class="comment">// [2,3,4,5]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = <span class="function">(<span class="params">...sum</span>) =&gt;</span> &#123;</span><br><span class="line">  sum.forEach(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">console</span>.log(item));</span><br><span class="line">&#125;;</span><br><span class="line">app(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 1,2,3,4</span></span><br><span class="line"><span class="comment">// 此运算符或得值为数组形式 主要用于替代函数中的 arguments(伪数组) 属性</span></span><br><span class="line"><span class="comment">// 这样可以非常方便的遍历获取到的未知个数的实参</span></span><br></pre></td></tr></table></figure>

<h3 id="函数中的-rest（剩余）参数"><a href="#函数中的-rest（剩余）参数" class="headerlink" title="函数中的 rest（剩余）参数"></a>函数中的 rest（剩余）参数</h3><blockquote>
<p><strong>剩余参数</strong>语法允许我们将一个不定数量的参数表示为一个数组。</p>
<p>——&gt; MDN - <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Rest_parameters">剩余参数</a></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...theArgs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> theArgs.reduce(<span class="function">(<span class="params">previous, current</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> previous + current;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line"><span class="comment">// expected output: 6</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</span><br><span class="line"><span class="comment">// expected output: 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 下例中，剩余参数包含了从第二个到最后的所有实参，然后用第一个实参依次乘以它们</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">multiplier, ...theArgs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> theArgs.map(<span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> multiplier * element;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = multiply(<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// [2, 4, 6]</span></span><br></pre></td></tr></table></figure>

<h4 id="剩余参数和-arguments-对象的区别"><a href="#剩余参数和-arguments-对象的区别" class="headerlink" title="剩余参数和 arguments 对象的区别"></a>剩余参数和 arguments 对象的区别</h4><p>剩余参数和 <code>arguments</code> 对象之间的区别主要有三个：</p>
<ul>
<li>剩余参数只包含那些没有对应形参的实参，而 <code>arguments</code> 对象包含了传给函数的所有实参。</li>
<li><code>arguments</code> 对象不是一个真正的数组，而剩余参数是真正的 <code>Array</code> 实例，也就是说你能够在它上面直接使用所有的数组方法，比如 <code>sort</code>，<code>map</code>，<code>forEach</code> 或 <code>pop</code> 。</li>
<li><code>arguments</code> 对象还有一些附加的属性 （如 <code>callee</code> 属性）。<ul>
<li>arguments.callee 属性包含当前正在执行的函数。</li>
</ul>
</li>
</ul>
<h3 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h3><h4 id="模块化发展"><a href="#模块化发展" class="headerlink" title="模块化发展"></a>模块化发展</h4><p>无模块化 –&gt; CommonJS 规范 –&gt; AMD 规范 –&gt; CMD 规范 –&gt; ES6 模块化</p>
<h4 id="无模块劣势"><a href="#无模块劣势" class="headerlink" title="无模块劣势"></a>无模块劣势</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;jquery.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;jquery_scroller.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;main.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">缺点：</span><br><span class="line">被依赖的放在前面，否则使用就会报错</span><br><span class="line">污染全局作用域</span><br><span class="line">维护成本高</span><br><span class="line">依赖关系不明显</span><br></pre></td></tr></table></figure>

<h4 id="CommonJS-规范（NodeJS）"><a href="#CommonJS-规范（NodeJS）" class="headerlink" title="CommonJS 规范（NodeJS）"></a>CommonJS 规范（NodeJS）</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义模块math.js</span></span><br><span class="line"><span class="keyword">var</span> basicNum = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="comment">//在这里写上需要向外暴露的函数、变量</span></span><br><span class="line">  add,</span><br><span class="line">  basicNum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引用自定义的模块时，参数包含路径，可省略.js</span></span><br><span class="line"><span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">&#x27;./math&#x27;</span>)</span><br><span class="line">math.add(<span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引用核心模块时，不需要带路径</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line">http.createService(...).listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>exports 是对 module.exports 的引用</strong>。比如我们可以认为在一个模块的顶部有这句代码： <code>exports = module.exports</code> 所以，我们不能直接给 <code>exports</code> 赋值:</p>
<ul>
<li>✅ exports.foo = ‘bar’</li>
<li>❌ exports = {foo: ‘bar’} //error 这种方式是错误的，相当于重新定义了 exports</li>
</ul>
<p><strong>优点</strong></p>
<p>解决了依赖、全局变量污染的问题</p>
<p><strong>缺点</strong></p>
<p>CommonJS 用同步的方式加载模块，这对服务器端不是一个问题，因为所有的模块都存放在本地硬盘，可以同步加载完成，等待时间就是硬盘的读取时间。但是，对于浏览器却是一个大问题，因为模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于”假死”状态。所以<strong>不适合浏览器端模块加载</strong>，更合理的方案是使用异步加载。</p>
<h4 id="AMD-规范（RequireJS）"><a href="#AMD-规范（RequireJS）" class="headerlink" title="AMD 规范（RequireJS）"></a>AMD 规范（RequireJS）</h4><p>AMD 规范采用<strong>异步方式加载模块</strong>，模块的加载不影响它后面语句的运行。所有<strong>依赖这个模块的语句，都定义在一个回调函数中</strong>，等到加载完成之后，这个回调函数才会运行。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 网页中引入 require.js 及 main.js **/</span></span><br><span class="line">&lt;script src=<span class="string">&quot;js/require.js&quot;</span> data-main=<span class="string">&quot;js/main&quot;</span>&gt;&lt;/script&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** main.js 入口文件/主模块 **/</span></span><br><span class="line"><span class="comment">// 首先用 config() 指定各模块路径和引用名</span></span><br><span class="line"><span class="built_in">require</span>.config(&#123;</span><br><span class="line">  baseUrl: <span class="string">&#x27;js/lib&#x27;</span>,</span><br><span class="line">  paths: &#123;</span><br><span class="line">    jquery: <span class="string">&#x27;jquery.min&#x27;</span>, <span class="comment">//实际路径为js/lib/jquery.min.js</span></span><br><span class="line">    underscore: <span class="string">&#x27;underscore.min&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 执行基本操作</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;jquery&#x27;</span>, <span class="string">&#x27;underscore&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params">$, _</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// some code here</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>优点</strong></p>
<p>适合在浏览器环境中异步加载模块、并行加载多个模块</p>
<p><strong>缺点</strong></p>
<p>必须要<strong>提前加载所有的依赖</strong>，然后才可以使用，而不是需要使用时再加载。（<strong>不能按需加载</strong>）</p>
<h4 id="CMD（SeaJS）"><a href="#CMD（SeaJS）" class="headerlink" title="CMD（SeaJS）"></a>CMD（SeaJS）</h4><p>与 AMD 类似，不同点在于：</p>
<ul>
<li>AMD 推崇依赖前置、提前执行</li>
<li>CMD 推崇依赖就近、延迟执行。</li>
</ul>
<p><strong>CMD 与 AMD 区别</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** AMD写法 **/</span></span><br><span class="line">define([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params">a, b, c, d, e, f</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 等于在最前面声明并初始化了要用到的所有模块</span></span><br><span class="line">  a.doSomething();</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="comment">// 即便没用到某个模块 b，但 b 还是提前执行了</span></span><br><span class="line">    b.doSomething();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** CMD写法 **/</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="built_in">module</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a&#x27;</span>); <span class="comment">//在需要时申明</span></span><br><span class="line">  a.doSomething();</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;./b&#x27;</span>);</span><br><span class="line">    b.doSomething();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="ES6-模块化"><a href="#ES6-模块化" class="headerlink" title="ES6 模块化"></a>ES6 模块化</h4><p>ES6 在语言标准的层面上，实现了模块功能，而且实现得相当简单，旨在成为<strong>浏览器和服务器通用</strong>的模块解决方案。其模块功能主要由两个命令构成： <code>export</code> 和 <code>import</code> 。 <code>export</code> 命令用于规定模块的对外接口，<code>import</code> 命令用于输入其他模块提供的功能。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 定义模块 math.js **/</span></span><br><span class="line"><span class="keyword">var</span> basicNum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> &#123; basicNum, add &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 引用模块 **/</span></span><br><span class="line"><span class="keyword">import</span> &#123; basicNum, add &#125; <span class="keyword">from</span> <span class="string">&#x27;./math&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">ele</span>) </span>&#123;</span><br><span class="line">  ele.textContent = add(<span class="number">99</span> + basicNum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>es6 在导出的时候有一个默认导出， <code>export default</code> ，使用它导出后，在 import 的时候，不需要加上 {} ，模块名字可以随意起。该名字实际上就是个对象，包含导出模块里面的函数或者变量。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** export default **/</span></span><br><span class="line"><span class="comment">//定义输出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; basicNum, add &#125;;</span><br><span class="line"><span class="comment">//引入</span></span><br><span class="line"><span class="keyword">import</span> math <span class="keyword">from</span> <span class="string">&#x27;./math&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">ele</span>) </span>&#123;</span><br><span class="line">  ele.textContent = math.add(<span class="number">99</span> + math.basicNum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<ul>
<li><a href="https://juejin.im/post/5aaa37c8f265da23945f365c">前端模块化：CommonJS,AMD,CMD,ES6</a></li>
<li><a href="https://juejin.im/post/5b4420e7f265da0f4b7a7b27">这一次，我要弄懂 javascript 的模块化</a></li>
</ul>
<h4 id="模块化开发怎么做？"><a href="#模块化开发怎么做？" class="headerlink" title="模块化开发怎么做？"></a>模块化开发怎么做？</h4><p><a href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/">立即执行函数</a>,不暴露私有成员</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> module1 = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> m1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> m2 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    m1,</span><br><span class="line">    m2</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h2 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h2><h3 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h3><h4 id="Ajax-是什么-如何创建一个-Ajax？"><a href="#Ajax-是什么-如何创建一个-Ajax？" class="headerlink" title="Ajax 是什么? 如何创建一个 Ajax？"></a>Ajax 是什么? 如何创建一个 Ajax？</h4><p>使用 JavaScript 异步获取数据，而且页面不会发生整页刷新的，提高了用户体验。</p>
<ol>
<li>创建 XMLHttpRequest 对象,也就是创建一个异步调用对象</li>
<li>创建一个新的 HTTP 请求,并指定该 HTTP 请求的方法、URL 及验证信息</li>
<li>设置响应 HTTP 请求状态变化的函数</li>
<li>发送 HTTP 请求</li>
<li>获取异步调用返回的数据</li>
<li>使用 JavaScript 和 DOM 实现局部刷新</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 创建一个 XMLHttpRequest 类型的对象 —— 相当于打开了一个浏览器</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 打开与一个网址之间的连接 —— 相当于在地址栏输入访问地址</span></span><br><span class="line">xhr.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;news/list?type=gn&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 通过连接发送一次请求 —— 相当于回车或者点击访问发送请求</span></span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// POST请求：</span></span><br><span class="line"><span class="comment">// xhr.open(&#x27;POST&#x27;, &#x27;login&#x27;, true)</span></span><br><span class="line"><span class="comment">// xhr.send(&#x27;username=admin&amp;password=admin&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 指定 xhr 状态变化事件处理函数 —— 相当于处理网页呈现后的操作</span></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 通过 xhr 的 readyState 判断此次请求的响应是否接收完成</span></span><br><span class="line">  <span class="comment">// 4代表done</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="comment">// 通过 xhr 的 responseText 获取到响应的响应体</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Ajax-原理"><a href="#Ajax-原理" class="headerlink" title="Ajax 原理"></a>Ajax 原理</h4><p>Ajax 的原理简单来说是在用户和服务器之间加了—个中间层（Ajax 引擎），通过 XMLHttpRequest 对象来向服务器发异步请求，从服务器获得数据，然后用 JavaScript 来操作 DOM 而更新页面。使用户操作与服务器响应异步化。这其中最关键的一步就是从服务器获得请求数据</p>
<p>Ajax 的过程只涉及 JavaScript、XMLHttpRequest 和 DOM。XMLHttpRequest 是 Ajax 的核心机制。</p>
<h4 id="Ajax-解决浏览器缓存问题？"><a href="#Ajax-解决浏览器缓存问题？" class="headerlink" title="Ajax 解决浏览器缓存问题？"></a>Ajax 解决浏览器缓存问题？</h4><ol>
<li>在 ajax 发送请求前加上 anyAjaxObj.setRequestHeader(“If-Modified-Since”,”0”)</li>
<li>在 ajax 发送请求前加上 anyAjaxObj.setRequestHeader(“Cache-Control”,”no-cache”)</li>
<li>在 URL 后面加上一个随机数： “fresh=” + Math.random()</li>
<li>在 URL 后面加上时间戳：”nowtime=” + new Date().getTime()</li>
</ol>
<h3 id="什么是同源策略？"><a href="#什么是同源策略？" class="headerlink" title="什么是同源策略？"></a>什么是同源策略？</h3><p>同源策略是浏览器的一种安全策略，所谓同源是指 <strong>域名，协议，端口</strong> 完全相同，只有同源的地址才可以相互通过 AJAX 的方式请求。</p>
<h3 id="如何解决跨域问题"><a href="#如何解决跨域问题" class="headerlink" title="如何解决跨域问题"></a>如何解决跨域问题</h3><h4 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a>jsonp</h4><p>借助于 <code>script</code> 标签发送跨域请求的技巧</p>
<p><strong>原理</strong></p>
<p>css，script 标签允许跨域。客户端借助 <code>script</code> 标签请求服务端的一个动态网页（php 文件），服务端的这个动态网页返回一段带有函数调用的 JavaScript 全局函数调用的脚本，将原本需要返回给客户端的数据传递进去。</p>
<p>客户端：</p>
<ul>
<li>foo(…arr) {console.log(arr.join(“,”))} 定义方法，名称随便</li>
<li><ul>
<li>服务端会获取参数名 callback 的值 foo ，然后把数据扔进 foo 中调用</li>
<li>一旦数据返回，就相当于在调用上面的 foo</li>
</ul>
</li>
</ul>
<p>服务端：</p>
<ul>
<li>foo([‘我’, ‘是’, ‘你’, ‘原’, ‘本’, ‘需’, ‘要’, ‘的’, ‘数’, ‘据’])</li>
</ul>
<p><strong>特色</strong></p>
<ol>
<li>JSONP 需要服务端配合，服务端按照客户端的要求返回一段 JavaScript 调用客户端的函数</li>
<li>只能发送 GET 请求</li>
</ol>
<h4 id="CORS-跨域资源共享"><a href="#CORS-跨域资源共享" class="headerlink" title="CORS 跨域资源共享"></a>CORS 跨域资源共享</h4><p>服务端设置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 服务端请求头设置：允许远端访问</span></span><br><span class="line">header(<span class="string">&#x27;Access‐Control‐Allow‐Origin: *&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这种方案无需客户端作出任何变化（客户端不用改代码），只是在被请求的服务端响应的时候添加一个</span></span><br><span class="line"><span class="comment">// Access-Control-Allow-Origin  的响应头，表示这个资源是否允许指定域请求。</span></span><br></pre></td></tr></table></figure>

<p>如果跨域 + 发送 cookie：</p>
<ul>
<li>前端：withCredentials = true</li>
<li>后端：Access-Control-Allow-Origin 不为 * ，(Access-Control-Allow-Credentials, true)</li>
<li>如果还需要发送 post 请求：<ul>
<li>前端：<ul>
<li>post:[‘Content-Type’] = ‘application/x-www-form-urlencoded’;</li>
<li>qs.stringify(): 对象序列化成 URL 的形式，以 &amp; 进行拼接</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h4><p>除此之外，还可以通过前端设置代理实现跨域，原理是利用后端不存在跨域问题。比如可以在 <code>@vue/cli</code> 项目中新建 <code>vue.config.js</code> 文件来配置代理。如果你想了解更多这方面的设置，可以阅读我的这篇博客 <a href="https://evestorm.github.io/posts/15391/">Axios 异步请求跨域解决方案</a></p>
<h3 id="JSON-和-JSONP-的区别"><a href="#JSON-和-JSONP-的区别" class="headerlink" title="JSON 和 JSONP 的区别"></a>JSON 和 JSONP 的区别</h3><p>JSON 返回的是一串 JSON 格式数据；而 JSONP 返回的是脚本代码（包含一个函数调用）。</p>
<p>JSONP 的全名叫做 JSON with padding，就是把 JSON 对象用符合 JS 语法的形式包裹起来以使其他的网站可以请求到，也就是将 JSON 封装成 JS 文件传过去。</p>
<h3 id="defer-和-async-的区别"><a href="#defer-和-async-的区别" class="headerlink" title="defer 和 async 的区别"></a>defer 和 async 的区别</h3><p><a href="https://segmentfault.com/img/bVWhRl?w=801&h=814"><img src="JS%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%88%E9%9D%A2%E8%AF%95%E7%B3%BB%E5%88%97%EF%BC%89/bVWhRl.png" alt="一图胜千言"></a></p>
<p>两者都是异步加载，但 defer 是按照加载顺序执行脚本的；async 则是无序加载脚本，例如 a.js 写在 b.js 前面，但如果 b.js 先加载完，则立即执行，不会等 a.js 的加载。</p>
<p>参考：<a href="https://segmentfault.com/q/1010000000640869">https://segmentfault.com/q/1010000000640869</a></p>
<h4 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h4><ul>
<li>如果依赖其他脚本和 DOM 结果，使用 defer</li>
<li>如果与 DOM 和其他脚本依赖不强时，使用 async</li>
</ul>
<h3 id="preload-和-prefetch-的区别是什么？"><a href="#preload-和-prefetch-的区别是什么？" class="headerlink" title="preload 和 prefetch 的区别是什么？"></a>preload 和 prefetch 的区别是什么？</h3><p>对当前页面需要的资源，使用 preload 进行预加载，对其它页面需要的资源进行 prefetch 空闲加载。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 对sty1e.cs5和 index.js进行pre1oad预加载 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span> <span class="attr">as</span>=<span class="string">&quot;style&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">href</span>=<span class="string">&quot;index.js&quot;</span> <span class="attr">as</span>=<span class="string">&quot;script&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--对资源进行 prefetch预加载--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;prefetch&quot;</span> <span class="attr">href</span>=<span class="string">&quot;next.css&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;prefetch&quot;</span> <span class="attr">href</span>=<span class="string">&quot;next.js&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="setTimeout、setInterval、requestAnimationFrame-各有什么特点？"><a href="#setTimeout、setInterval、requestAnimationFrame-各有什么特点？" class="headerlink" title="setTimeout、setInterval、requestAnimationFrame 各有什么特点？"></a>setTimeout、setInterval、requestAnimationFrame 各有什么特点？</h3><p><code>setTimeout</code> 和 <code>setInterval</code> 都不精确。它们的内在运行机制决定了时间间隔参数实际上只是指定了把动画代码添加到浏览器 UI 线程队列中以等待执行的时间。如果队列前面已经加入了其他任务，那动画代码就要等前面的任务完成后再执行。</p>
<p><code>requestAnimationFrame</code> 采用系统时间间隔，保持最佳绘制效率，不会因为间隔时间过短，造成过度绘制，增加开销；也不会因为间隔时间太长，使动画卡顿不流畅，让各种网页动画效果能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果。</p>
<h3 id="setTimeout-倒计时为什么会出现误差？"><a href="#setTimeout-倒计时为什么会出现误差？" class="headerlink" title="setTimeout 倒计时为什么会出现误差？"></a>setTimeout 倒计时为什么会出现误差？</h3><p><code>setTimeout()</code> 只是将事件插入了“任务队列”，必须等当前代码（执行栈）执行完，主线程才会去执行它指定的回调函数。要是当前代码消耗时间很长，也有可能要等很久，所以并没办法保证回调函数一定会在 setTimeout() 指定的时间执行。所以， <code>setTimeout()</code> 的第二个参数表示的是最少时间，并非是确切时间。</p>
<p>HTML5 标准规定了 <code>setTimeout()</code> 的第二个参数的最小值不得小于 4 毫秒，如果低于这个值，则默认是 4 毫秒。在此之前。老版本的浏览器都将最短时间设为 10 毫秒。另外，对于那些 DOM 的变动（尤其是涉及页面重新渲染的部分），通常是间隔 16 毫秒执行。这时使用 <code>requestAnimationFrame()</code> 的效果要好于 <code>setTimeout()</code>。</p>
<h3 id="简单解释单线程、任务队列的概念？"><a href="#简单解释单线程、任务队列的概念？" class="headerlink" title="简单解释单线程、任务队列的概念？"></a>简单解释单线程、任务队列的概念？</h3><p><strong>单线程：</strong></p>
<p>JavaScript 是浏览器用来与用户进行交互、进行 DOM 操作的，这也使得了它必须是单线程这一特性。</p>
<p>所谓单线程也就是只有一条线，一步一步走。</p>
<p><strong>任务队列：</strong></p>
<p>任务（消息）队列是一个先进先出的队列，它里面存放着各种任务（消息）。</p>
<p>在 JavaScript 中任务有两种，一种是同步任务，一种是异步任务。</p>
<ol>
<li>同步任务：各个任务按照文档定义的顺序一一推入“执行栈”中，当前一个任务执行完毕，才会开始执行下一个任务。</li>
<li>异步任务：各个任务推入“任务队列”中，只有在当前的所有同步任务执行完毕，才会将队列中的任务“出队”执行。</li>
</ol>
<p>当线程中没有执行任何同步代码的前提下才会执行异步代码。</p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="JSON-的了解"><a href="#JSON-的了解" class="headerlink" title="JSON 的了解"></a>JSON 的了解</h3><p>一种轻量级的数据交换格式。 它是基于 JavaScript 的一个子集。</p>
<p>数据格式简单、易于读写、占用带宽小。 e.g. {“age”:”12”, “name”:”back”}</p>
<p>JSON 读写的基本封装：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> storage = &#123;</span><br><span class="line">  set: <span class="function">(<span class="params">key, val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">localStorage</span>.setItem(key, <span class="built_in">JSON</span>.stringify(val));</span><br><span class="line">  &#125;,</span><br><span class="line">  get: <span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(</span><br><span class="line">      <span class="built_in">localStorage</span>.getItem(key) === <span class="literal">null</span> ? <span class="string">&#x27;[]&#x27;</span> : <span class="built_in">localStorage</span>.getItem(key)</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">  remove: <span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">localStorage</span>.removeItem(key);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> storage;</span><br></pre></td></tr></table></figure>

<h4 id="JSON-方法的缺点"><a href="#JSON-方法的缺点" class="headerlink" title="JSON 方法的缺点"></a>JSON 方法的缺点</h4><ul>
<li>不能复制 function、正则、Symbol</li>
<li>循环引用报错</li>
<li>相同的引用会被重复复制</li>
</ul>
<h2 id="概念性问题"><a href="#概念性问题" class="headerlink" title="概念性问题"></a>概念性问题</h2><h3 id="你理解的面向对象"><a href="#你理解的面向对象" class="headerlink" title="你理解的面向对象"></a>你理解的面向对象</h3><p>一种编程开发思想。是过程式代码的一种高度封装，目的在于提高代码的开发效率和可维护性。</p>
<h3 id="什么叫优雅降级和渐进增强？"><a href="#什么叫优雅降级和渐进增强？" class="headerlink" title="什么叫优雅降级和渐进增强？"></a>什么叫优雅降级和渐进增强？</h3><ul>
<li>优雅降级：Web 站点在所有新式浏览器中都能正常工作，如果用户使用的是老式浏览器，则代码会针对旧版本的 IE 进行降级处理了,使之在旧式浏览器上以某种形式降级体验却不至于完全不能用。 如：border-shadow</li>
<li>渐进增强：从被所有浏览器支持的基本功能开始，逐步地添加那些只有新版本浏览器才支持的功能,向页面增加不影响基础浏览器的额外样式和功能的。当浏览器支持时，它们会自动地呈现出来并发挥作用。 如：默认使用 flash 上传，但如果浏览器支持 HTML5 的文件上传功能，则使用 HTML5 实现更好的体验</li>
</ul>
<h3 id="compose-函数-❌"><a href="#compose-函数-❌" class="headerlink" title="compose 函数 ❌"></a>compose 函数 ❌</h3><h3 id="函数柯里化-❌"><a href="#函数柯里化-❌" class="headerlink" title="函数柯里化 ❌"></a>函数柯里化 ❌</h3>]]></content>
      <categories>
        <category>前端</category>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>转载-JS正则表达式完整教程（略长）</title>
    <url>/posts/52295/</url>
    <content><![CDATA[<p>转载自：<a href="https://juejin.cn/post/6844903487155732494">https://juejin.cn/post/6844903487155732494</a></p>
<h1 id="JS-正则表达式完整教程（略长）"><a href="#JS-正则表达式完整教程（略长）" class="headerlink" title="JS 正则表达式完整教程（略长）"></a>JS 正则表达式完整教程（略长）</h1><p>注：本文已经整理成电子书：<a href="https://juejin.im/post/6844903501034684430">《JavaScript 正则迷你书》</a></p>
<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>亲爱的读者朋友，如果你点开了这篇文章，说明你对正则很感兴趣。</p>
<p>想必你也了解正则的重要性，在我看来正则表达式是衡量程序员水平的一个侧面标准。</p>
<p>关于正则表达式的教程，网上也有很多，相信你也看了一些。</p>
<p>与之不同的是，本文的目的是希望所有认真读完的童鞋们，都有实质性的提高。</p>
<p>本文内容共有七章，用 JavaScript 语言完整地讨论了正则表达式的方方面面。</p>
<p>如果觉得文章某块儿没有说明白清楚，欢迎留言，能力范围之内，老姚必做详细解答。</p>
<a id="more"></a>

<p>具体章节如下：</p>
<ul>
<li>引言</li>
<li>第一章 正则表达式字符匹配攻略</li>
<li>第二章 正则表达式位置匹配攻略</li>
<li>第三章 正则表达式括号的作用</li>
<li>第四章 正则表达式回溯法原理</li>
<li>第五章 正则表达式的拆分</li>
<li>第六章 正则表达式的构建</li>
<li>第七章 正则表达式编程</li>
<li>后记</li>
</ul>
<p>下面简单地说说每一章都讨论了什么？</p>
<p><strong>正则是匹配模式，要么匹配字符，要么匹配位置。</strong></p>
<p>第 1 章和第 2 章以这个角度去讲解了正则的基础。</p>
<p><strong>在正则中可以使用括号捕获数据，要么在 API 中进行分组引用，要么在正则里进行反向引用。</strong></p>
<p>这是第 3 章的主题，讲解了正则中括号的作用。</p>
<p><strong>学习正则表达式，是需要了解其匹配原理的。</strong></p>
<p>第 4 章，讲解了正则了正则表达式的回溯法原理。另外在第 6 章里，也讲解了正则的表达式的整体工作原理。</p>
<p><strong>不仅能看懂别人的正则，还要自己会写正则。</strong></p>
<p>第 5 章，是从读的角度，去拆分一个正则表达式，而第 6 章是从写的角度，去构建一个正则表达式。</p>
<p><strong>学习正则，是为了在真实世界里应用的。</strong></p>
<p>第 7 章讲解了正则的用法，和相关 API 需要注意的地方。</p>
<p><strong>如何阅读本文？</strong></p>
<p>我的建议是阅读两遍。第一遍，不求甚解地快速阅读一遍。阅读过程中遇到的问题不妨记录下来，也许阅读完毕后就能解决很多。然后有时间的话，再带着问题去精读第二遍。</p>
<p>深呼吸，开始我们的正则表达式旅程吧。我在终点等你。</p>
<h2 id="第一章-正则表达式字符匹配攻略"><a href="#第一章-正则表达式字符匹配攻略" class="headerlink" title="第一章 正则表达式字符匹配攻略"></a>第一章 正则表达式字符匹配攻略</h2><p>正则表达式是匹配模式，要么匹配字符，要么匹配位置。请记住这句话。</p>
<p>然而关于正则如何匹配字符的学习，大部分人都觉得这块比较杂乱。</p>
<p>毕竟元字符太多了，看起来没有系统性，不好记。本章就解决这个问题。</p>
<p>内容包括：</p>
<ol>
<li>两种模糊匹配</li>
<li>字符组</li>
<li>量词</li>
<li>分支结构</li>
<li>案例分析</li>
</ol>
<h3 id="1-两种模糊匹配"><a href="#1-两种模糊匹配" class="headerlink" title="1 两种模糊匹配"></a>1 两种模糊匹配</h3><p>如果正则只有精确匹配是没多大意义的，比如<code>/hello/</code>，也只能匹配字符串中的”hello”这个子串。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/hello/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;hello&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p>正则表达式之所以强大，是因为其能实现模糊匹配。</p>
<p>而模糊匹配，有两个方向上的“模糊”：横向模糊和纵向模糊。</p>
<p><strong>1.1 横向模糊匹配</strong></p>
<p>横向模糊指的是，一个正则可匹配的字符串的长度不是固定的，可以是多种情况的。</p>
<p>其实现的方式是使用量词。譬如<code>&#123;m,n&#125;</code>，表示连续出现最少 m 次，最多 n 次。</p>
<p>比如<code>/ab&#123;2,5&#125;c/</code>表示匹配这样一个字符串：第一个字符是“a”，接下来是 2 到 5 个字符“b”，最后是字符“c”。测试如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/ab&#123;2,5&#125;c/g</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;abc abbc abbbc abbbbc abbbbbc abbbbbbc&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;abbc&quot;, &quot;abbbc&quot;, &quot;abbbbc&quot;, &quot;abbbbbc&quot;]</span></span><br></pre></td></tr></table></figure>

<p>注意：案例中用的正则是<code>/ab&#123;2,5&#125;c/g</code>，后面多了<code>g</code>，它是正则的一个修饰符。表示全局匹配，即在目标字符串中按顺序找到满足匹配模式的所有子串，强调的是“所有”，而不只是“第一个”。g 是单词 global 的首字母。</p>
<p><strong>1.2 纵向模糊匹配</strong></p>
<p>纵向模糊指的是，一个正则匹配的字符串，具体到某一位字符时，它可以不是某个确定的字符，可以有多种可能。</p>
<p>其实现的方式是使用字符组。譬如<code>[abc]</code>，表示该字符是可以字符“a”、“b”、“c”中的任何一个。</p>
<p>比如<code>/a[123]b/</code>可以匹配如下三种字符串：”a1b”、”a2b”、”a3b”。测试如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/a[123]b/g</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;a0b a1b a2b a3b a4b&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;a1b&quot;, &quot;a2b&quot;, &quot;a3b&quot;]</span></span><br></pre></td></tr></table></figure>

<p>以上就是本章讲的主体内容，只要掌握横向和纵向模糊匹配，就能解决很大部分正则匹配问题。</p>
<p>接下来的内容就是展开说了，如果对此都比较熟悉的话，可以跳过，直接看本章案例那节。</p>
<h3 id="2-字符组"><a href="#2-字符组" class="headerlink" title="2. 字符组"></a>2. 字符组</h3><p>需要强调的是，虽叫字符组（字符类），但只是其中一个字符。例如<code>[abc]</code>，表示匹配一个字符，它可以是“a”、“b”、“c”之一。</p>
<p><strong>2.1 范围表示法</strong></p>
<p>如果字符组里的字符特别多的话，怎么办？可以使用范围表示法。</p>
<p>比如<code>[123456abcdefGHIJKLM]</code>，可以写成<code>[1-6a-fG-M]</code>。用连字符<code>-</code>来省略和简写。</p>
<p>因为连字符有特殊用途，那么要匹配“a”、“-”、“z”这三者中任意一个字符，该怎么做呢？</p>
<p>不能写成<code>[a-z]</code>，因为其表示小写字符中的任何一个字符。</p>
<p>可以写成如下的方式：<code>[-az]</code>或<code>[az-]</code>或<code>[a\-z]</code>。即要么放在开头，要么放在结尾，要么转义。总之不会让引擎认为是范围表示法就行了。</p>
<p><strong>2.2 排除字符组</strong></p>
<p>纵向模糊匹配，还有一种情形就是，某位字符可以是任何东西，但就不能是”a”、”b”、”c”。</p>
<p>此时就是排除字符组（反义字符组）的概念。例如<code>[^abc]</code>，表示是一个除”a”、”b”、”c”之外的任意一个字符。字符组的第一位放<code>^</code>（脱字符），表示求反的概念。</p>
<p>当然，也有相应的范围表示法。</p>
<p><strong>2.3 常见的简写形式</strong></p>
<p>有了字符组的概念后，一些常见的符号我们也就理解了。因为它们都是系统自带的简写形式。</p>
<blockquote>
<p>**<code>\d</code>**就是<code>[0-9]</code>。表示是一位数字。记忆方式：其英文是 digit（数字）。</p>
<p>**<code>\D</code>**就是<code>[^0-9]</code>。表示除数字外的任意字符。</p>
<p>**<code>\w</code>**就是<code>[0-9a-zA-Z_]</code>。表示数字、大小写字母和下划线。记忆方式：w 是 word 的简写，也称单词字符。</p>
<p>**<code>\W</code>**是<code>[^0-9a-zA-Z_]</code>。非单词字符。</p>
<p>**<code>\s</code>**是<code>[ \t\v\n\r\f]</code>。表示空白符，包括空格、水平制表符、垂直制表符、换行符、回车符、换页符。记忆方式：s 是 space character 的首字母。</p>
<p>**<code>\S</code>**是<code>[^ \t\v\n\r\f]</code>。 非空白符。</p>
<p>**<code>.</code>**就是<code>[^\n\r\u2028\u2029]</code>。通配符，表示几乎任意字符。换行符、回车符、行分隔符和段分隔符除外。记忆方式：想想省略号…中的每个点，都可以理解成占位符，表示任何类似的东西。</p>
</blockquote>
<p>如果要匹配任意字符怎么办？可以使用<code>[\d\D]</code>、<code>[\w\W]</code>、<code>[\s\S]</code>和<code>[^]</code>中任何的一个。</p>
<h3 id="3-量词"><a href="#3-量词" class="headerlink" title="3. 量词"></a>3. 量词</h3><p>量词也称重复。掌握<code>&#123;m,n&#125;</code>的准确含义后，只需要记住一些简写形式。</p>
<p><strong>3.1 简写形式</strong></p>
<blockquote>
<p><code>**&#123;m,&#125;**</code> 表示至少出现 m 次。</p>
<p><code>**&#123;m&#125;**</code> 等价于<code>&#123;m,m&#125;</code>，表示出现 m 次。</p>
<p><code>**?**</code> 等价于<code>&#123;0,1&#125;</code>，表示出现或者不出现。记忆方式：问号的意思表示，有吗？</p>
<p><code>**+** </code>等价于<code>&#123;1,&#125;</code>，表示出现至少一次。记忆方式：加号是追加的意思，得先有一个，然后才考虑追加。</p>
<p><code>*****</code> 等价于<code>&#123;0,&#125;</code>，表示出现任意次，有可能不出现。记忆方式：看看天上的星星，可能一颗没有，可能零散有几颗，可能数也数不过来。</p>
</blockquote>
<p><strong>3.2 贪婪匹配和惰性匹配</strong></p>
<p>看如下的例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d&#123;2,5&#125;/g</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;123 1234 12345 123456&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;123&quot;, &quot;1234&quot;, &quot;12345&quot;, &quot;12345&quot;]</span></span><br></pre></td></tr></table></figure>

<p>其中正则<code>/\d&#123;2,5&#125;/</code>，表示数字连续出现 2 到 5 次。会匹配 2 位、3 位、4 位、5 位连续数字。</p>
<p>但是其是贪婪的，它会尽可能多的匹配。你能给我 6 个，我就要 5 个。你能给我 3 个，我就 3 要个。反正只要在能力范围内，越多越好。</p>
<p>我们知道有时贪婪不是一件好事（请看文章最后一个例子）。而惰性匹配，就是尽可能少的匹配：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d&#123;2,5&#125;?/g</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;123 1234 12345 123456&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;12&quot;, &quot;12&quot;, &quot;34&quot;, &quot;12&quot;, &quot;34&quot;, &quot;12&quot;, &quot;34&quot;, &quot;56&quot;]</span></span><br></pre></td></tr></table></figure>

<p>其中<code>/\d&#123;2,5&#125;?/</code>表示，虽然 2 到 5 次都行，当 2 个就够的时候，就不在往下尝试了。</p>
<p>通过在量词后面加个问号就能实现惰性匹配，因此所有惰性匹配情形如下：</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">**&#123;m,n&#125;?**&#96;</span><br><span class="line">&#96;**&#123;m,&#125;?**&#96;</span><br><span class="line">&#96;**??**&#96;</span><br><span class="line">&#96;**+?**&#96;</span><br><span class="line">&#96;***?**</span><br></pre></td></tr></table></figure>
</blockquote>
<p>对惰性匹配的记忆方式是：量词后面加个问号，问一问你知足了吗，你很贪婪吗？</p>
<h3 id="4-多选分支"><a href="#4-多选分支" class="headerlink" title="4. 多选分支"></a>4. 多选分支</h3><p>一个模式可以实现横向和纵向模糊匹配。而多选分支可以支持多个子模式任选其一。</p>
<p>具体形式如下：<code>(p1|p2|p3)</code>，其中<code>p1</code>、<code>p2</code>和<code>p3</code>是子模式，用<code>|</code>（管道符）分隔，表示其中任何之一。</p>
<p>例如要匹配”good”和”nice”可以使用<code>/good|nice/</code>。测试如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/good|nice/g</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;good idea, nice try.&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;good&quot;, &quot;nice&quot;]</span></span><br></pre></td></tr></table></figure>

<p>但有个事实我们应该注意，比如我用<code>/good|goodbye/</code>，去匹配”goodbye”字符串时，结果是”good”：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/good|goodbye/g</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;goodbye&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;good&quot;]</span></span><br></pre></td></tr></table></figure>

<p>而把正则改成<code>/goodbye|good/</code>，结果是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/goodbye|good/g</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;goodbye&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;goodbye&quot;]</span></span><br></pre></td></tr></table></figure>

<p>也就是说，分支结构也是惰性的，即当前面的匹配上了，后面的就不再尝试了。</p>
<h3 id="5-案例分析"><a href="#5-案例分析" class="headerlink" title="5. 案例分析"></a>5. 案例分析</h3><p>匹配字符，无非就是字符组、量词和分支结构的组合使用罢了。</p>
<p>下面找几个例子演练一下（其中，每个正则并不是只有唯一写法）：</p>
<p><strong>5.1 匹配 16 进制颜色值</strong></p>
<p>要求匹配：</p>
<blockquote>
<p>#ffbbad</p>
<p>#Fc01DF</p>
<p>#FFF</p>
<p>#ffE</p>
</blockquote>
<p>分析：</p>
<p>表示一个 16 进制字符，可以用字符组<code>[0-9a-fA-F]</code>。</p>
<p>其中字符可以出现 3 或 6 次，需要是用量词和分支结构。</p>
<p>使用分支结构时，需要注意顺序。</p>
<p>正则如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/#([0-9a-fA-F]&#123;6&#125;|[0-9a-fA-F]&#123;3&#125;)/g</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;#ffbbad #Fc01DF #FFF #ffE&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;#ffbbad&quot;, &quot;#Fc01DF&quot;, &quot;#FFF&quot;, &quot;#ffE&quot;]</span></span><br></pre></td></tr></table></figure>

<p><strong>5.2 匹配时间</strong></p>
<p>以 24 小时制为例。</p>
<p>要求匹配：</p>
<blockquote>
<p>23:59</p>
<p>02:07</p>
</blockquote>
<p>分析：</p>
<p>共 4 位数字，第一位数字可以为<code>[0-2]</code>。</p>
<p>当第 1 位为 2 时，第 2 位可以为<code>[0-3]</code>，其他情况时，第 2 位为<code>[0-9]</code>。</p>
<p>第 3 位数字为<code>[0-5]</code>，第 4 位为<code>[0-9]</code></p>
<p>正则如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^([01][0-9]|[2][0-3]):[0-5][0-9]$/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;23:59&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;02:07&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p>如果也要求匹配 7:9，也就是说时分前面的 0 可以省略。</p>
<p>此时正则变成：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^(0?[0-9]|1[0-9]|[2][0-3]):(0?[0-9]|[1-5][0-9])$/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;23:59&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;02:07&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;7:9&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p><strong>5.3 匹配日期</strong></p>
<p>比如 yyyy-mm-dd 格式为例。</p>
<p>要求匹配：</p>
<blockquote>
<p>2017-06-10</p>
</blockquote>
<p>分析：</p>
<p>年，四位数字即可，可用<code>[0-9]&#123;4&#125;</code>。</p>
<p>月，共 12 个月，分两种情况 01、02、……、09 和 10、11、12，可用<code>(0[1-9]|1[0-2])</code>。</p>
<p>日，最大 31 天，可用<code>(0[1-9]|[12][0-9]|3[01])</code>。</p>
<p>正则如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^[0-9]&#123;4&#125;-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;2017-06-10&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p><strong>5.4 window 操作系统文件路径</strong></p>
<p>要求匹配：</p>
<blockquote>
<p>F:\study\javascript\regex\regular expression.pdf</p>
<p>F:\study\javascript\regex\</p>
<p>F:\study\javascript</p>
<p>F:\</p>
</blockquote>
<p>分析：</p>
<p>整体模式是: 盘符:\文件夹\文件夹\文件夹\</p>
<p>其中匹配 F:\，需要使用<code>[a-zA-Z]:\\</code>，其中盘符不区分大小写，注意<code>\</code>字符需要转义。</p>
<p>文件名或者文件夹名，不能包含一些特殊字符，此时我们需要排除字符组<code>[^\\:*&lt;&gt;|&quot;?\r\n/]</code>来表示合法字符。另外不能为空名，至少有一个字符，也就是要使用量词<code>+</code>。因此匹配“文件夹\”，可用<code>[^\\:*&lt;&gt;|&quot;?\r\n/]+\\</code>。</p>
<p>另外“文件夹\”，可以出现任意次。也就是<code>([^\\:*&lt;&gt;|&quot;?\r\n/]+\\)*</code>。其中括号提供子表达式。</p>
<p>路径的最后一部分可以是“文件夹”，没有<code>\</code>，因此需要添加<code>([^\\:*&lt;&gt;|&quot;?\r\n/]+)?</code>。</p>
<p>最后拼接成了一个看起来比较复杂的正则：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^[a-zA-Z]:\\([^\\:*&lt;&gt;|&quot;?\r\n/]+\\)*([^\\:*&lt;&gt;|&quot;?\r\n/]+)?$/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;F:\\study\\javascript\\regex\\regular expression.pdf&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;F:\\study\\javascript\\regex\\&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;F:\\study\\javascript&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;F:\\&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p>其中，JS 中字符串表示<code>\</code>时，也要转义。</p>
<p><strong>5.5 匹配 id</strong></p>
<p>要求从</p>
<blockquote>
<div id="container" class="main"></div>
</blockquote>
<p>提取出 id=”container”。</p>
<p>可能最开始想到的正则是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/id=&quot;.*&quot;/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;&lt;div id=&quot;container&quot; class=&quot;main&quot;&gt;&lt;/div&gt;&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex)[<span class="number">0</span>]);</span><br><span class="line"><span class="comment">// =&gt; id=&quot;container&quot; class=&quot;main&quot;</span></span><br></pre></td></tr></table></figure>

<p>因为<code>.</code>是通配符，本身就匹配双引号的，而量词<code>*</code>又是贪婪的，当遇到 container 后面双引号时，不会停下来，会继续匹配，直到遇到最后一个双引号为止。</p>
<p>解决之道，可以使用惰性匹配：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/id=&quot;.*?&quot;/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;&lt;div id=&quot;container&quot; class=&quot;main&quot;&gt;&lt;/div&gt;&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex)[<span class="number">0</span>]);</span><br><span class="line"><span class="comment">// =&gt; id=&quot;container&quot;</span></span><br></pre></td></tr></table></figure>

<p>当然，这样也会有个问题。效率比较低，因为其匹配原理会涉及到“回溯”这个概念（这里也只是顺便提一下，第四章会详细说明）。可以优化如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/id=&quot;[^&quot;]*&quot;/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;&lt;div id=&quot;container&quot; class=&quot;main&quot;&gt;&lt;/div&gt;&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex)[<span class="number">0</span>]);</span><br><span class="line"><span class="comment">// =&gt; id=&quot;container&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="第-1-章-小结"><a href="#第-1-章-小结" class="headerlink" title="第 1 章 小结"></a>第 1 章 小结</h3><p>字符匹配相关的案例，挺多的，不一而足。</p>
<p>掌握字符组和量词就能解决大部分常见的情形，也就是说，当你会了这二者，JS 正则算是入门了。</p>
<h2 id="第二章-正则表达式位置匹配攻略"><a href="#第二章-正则表达式位置匹配攻略" class="headerlink" title="第二章 正则表达式位置匹配攻略"></a>第二章 正则表达式位置匹配攻略</h2><p>正则表达式是匹配模式，要么匹配字符，要么匹配位置。请记住这句话。</p>
<p>然而大部分人学习正则时，对于匹配位置的重视程度没有那么高。</p>
<p>本章讲讲正则匹配位置的总总。</p>
<p>内容包括：</p>
<ol>
<li>什么是位置？</li>
<li>如何匹配位置？</li>
<li>位置的特性</li>
<li>几个应用实例分析</li>
</ol>
<h3 id="1-什么是位置呢？"><a href="#1-什么是位置呢？" class="headerlink" title="1. 什么是位置呢？"></a>1. 什么是位置呢？</h3><p>位置是相邻字符之间的位置。比如，下图中箭头所指的地方：</p>
<p><img src="https://user-gold-cdn.xitu.io/2017/7/19/95d0faf6b21f9414d24c8281b3046746?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<h3 id="2-如何匹配位置呢？"><a href="#2-如何匹配位置呢？" class="headerlink" title="2. 如何匹配位置呢？"></a>2. 如何匹配位置呢？</h3><p>在 ES5 中，共有 6 个锚字符：</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">**^**&#96; &#96;**$**&#96; &#96;**\b**&#96; &#96;**\B**&#96; &#96;**(?&#x3D;p)**&#96; &#96;**(?!p)**</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>2.1 ^和$</strong></p>
<p><code>^</code>（脱字符）匹配开头，在多行匹配中匹配行开头。</p>
<p><code>$</code>（美元符号）匹配结尾，在多行匹配中匹配行结尾。</p>
<p>比如我们把字符串的开头和结尾用”#”替换（位置可以替换成字符的！）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;hello&#x27;</span>.replace(<span class="regexp">/^|$/g</span>, <span class="string">&#x27;#&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;#hello#&quot;</span></span><br></pre></td></tr></table></figure>

<p>多行匹配模式时，二者是行的概念，这个需要我们的注意：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;I\nlove\njavascript&#x27;</span>.replace(<span class="regexp">/^|$/gm</span>, <span class="string">&#x27;#&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">#I#</span></span><br><span class="line"><span class="comment">#love#</span></span><br><span class="line"><span class="comment">#javascript#</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>2.2 \b 和\B</strong></p>
<p><code>\b</code>是单词边界，具体就是<code>\w</code>和<code>\W</code>之间的位置，也包括<code>\w</code>和<code>^</code>之间的位置，也包括<code>\w</code>和<code>$</code>之间的位置。</p>
<p>比如一个文件名是”[JS] Lesson_01.mp4”中的<code>\b</code>，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;[JS] Lesson_01.mp4&#x27;</span>.replace(<span class="regexp">/\b/g</span>, <span class="string">&#x27;#&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;[#JS#] #Lesson_01#.#mp4#&quot;</span></span><br></pre></td></tr></table></figure>

<p>为什么是这样呢？这需要仔细看看。</p>
<p>首先，我们知道，<code>\w</code>是字符组<code>[0-9a-zA-Z_]</code>的简写形式，即<code>\w</code>是字母数字或者下划线的中任何一个字符。而<code>\W</code>是排除字符组<code>[^0-9a-zA-Z_]</code>的简写形式，即<code>\W</code>是<code>\w</code>以外的任何一个字符。</p>
<p>此时我们可以看看”[#JS#] #Lesson_01#.#mp4#”中的每一个”#”，是怎么来的。</p>
<ul>
<li>第一个”#”，两边是”[“与”J”，是<code>\W</code>和<code>\w</code>之间的位置。</li>
<li>第二个”#”，两边是”S”与”]”，也就是<code>\w</code>和<code>\W</code>之间的位置。</li>
<li>第三个”#”，两边是空格与”L”，也就是<code>\W</code>和<code>\w</code>之间的位置。</li>
<li>第四个”#”，两边是”1”与”.”，也就是<code>\w</code>和<code>\W</code>之间的位置。</li>
<li>第五个”#”，两边是”.”与”m”，也就是<code>\W</code>和<code>\w</code>之间的位置。</li>
<li>第六个”#”，其对应的位置是结尾，但其前面的字符”4”是<code>\w</code>，即<code>\w</code>和<code>$</code>之间的位置。</li>
</ul>
<p>知道了<code>\b</code>的概念后，那么<code>\B</code>也就相对好理解了。</p>
<p><code>\B</code>就是<code>\b</code>的反面的意思，非单词边界。例如在字符串中所有位置中，扣掉<code>\b</code>，剩下的都是<code>\B</code>的。</p>
<p>具体说来就是<code>\w</code>与<code>\w</code>、<code>\W</code>与<code>\W</code>、<code>^</code>与<code>\W</code>，<code>\W</code>与<code>$</code>之间的位置。</p>
<p>比如上面的例子，把所有<code>\B</code>替换成”#”：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;[JS] Lesson_01.mp4&#x27;</span>.replace(<span class="regexp">/\B/g</span>, <span class="string">&#x27;#&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;#[J#S]# L#e#s#s#o#n#_#0#1.m#p#4&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.3 (?=p)和(?!p)</strong></p>
<p><code>(?=p)</code>，其中<code>p</code>是一个子模式，即<code>p</code>前面的位置。</p>
<p>比如<code>(?=l)</code>，表示’l’字符前面的位置，例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;hello&#x27;</span>.replace(<span class="regexp">/(?=l)/g</span>, <span class="string">&#x27;#&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;he#l#lo&quot;</span></span><br></pre></td></tr></table></figure>

<p>而<code>(?!p)</code>就是<code>(?=p)</code>的反面意思，比如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;hello&#x27;</span>.replace(<span class="regexp">/(?!l)/g</span>, <span class="string">&#x27;#&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;#h#ell#o#&quot;</span></span><br></pre></td></tr></table></figure>

<p>二者的学名分别是 positive lookahead 和 negative lookahead。</p>
<p>中文翻译分别是正向先行断言和负向先行断言。</p>
<p>ES6 中，还支持 positive lookbehind 和 negative lookbehind。</p>
<p>具体是<code>(?&lt;=p)</code>和<code>(?&lt;!p)</code>。</p>
<p>也有书上把这四个东西，翻译成环视，即看看右边或看看左边。</p>
<p>但一般书上，没有很好强调这四者是个位置。</p>
<p>比如<code>(?=p)</code>，一般都理解成：要求接下来的字符与<code>p</code>匹配，但不能包括<code>p</code>的那些字符。</p>
<p>而在本人看来<code>(?=p)</code>就与<code>^</code>一样好理解，就是<code>p</code>前面的那个位置。</p>
<h3 id="3-位置的特性"><a href="#3-位置的特性" class="headerlink" title="3. 位置的特性"></a>3. 位置的特性</h3><p>对于位置的理解，我们可以理解成空字符””。</p>
<p>比如”hello”字符串等价于如下的形式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;hello&#x27;</span> == <span class="string">&#x27;&#x27;</span> + <span class="string">&#x27;h&#x27;</span> + <span class="string">&#x27;&#x27;</span> + <span class="string">&#x27;e&#x27;</span> + <span class="string">&#x27;&#x27;</span> + <span class="string">&#x27;l&#x27;</span> + <span class="string">&#x27;&#x27;</span> + <span class="string">&#x27;l&#x27;</span> + <span class="string">&#x27;o&#x27;</span> + <span class="string">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>也等价于：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;hello&#x27;</span> == <span class="string">&#x27;&#x27;</span> + <span class="string">&#x27;&#x27;</span> + <span class="string">&#x27;hello&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>因此，把<code>/^hello$/</code>写成<code>/^^hello?$/</code>，是没有任何问题的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="regexp">/^^hello?$/</span>.test(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p>甚至可以写成更复杂的:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="regexp">/(?=he)^^he(?=\w)llo$\b\b$/</span>.test(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p>也就是说字符之间的位置，可以写成多个。</p>
<p>把位置理解空字符，是对位置非常有效的理解方式。</p>
<h3 id="4-相关案例"><a href="#4-相关案例" class="headerlink" title="4. 相关案例"></a>4. 相关案例</h3><p><strong>4.1 不匹配任何东西的正则</strong></p>
<p>让你写个正则不匹配任何东西</p>
<p>easy，<code>/.^/</code></p>
<p>因为此正则要求只有一个字符，但该字符后面是开头。</p>
<p><strong>4.2 数字的千位分隔符表示法</strong></p>
<p>比如把”12345678”，变成”12,345,678”。</p>
<p>可见是需要把相应的位置替换成”,”。</p>
<p>思路是什么呢？</p>
<p><strong>4.2.1 弄出最后一个逗号</strong></p>
<p>使用<code>(?=\d&#123;3&#125;$)</code>就可以做到：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;12345678&#x27;</span>.replace(<span class="regexp">/(?=\d&#123;3&#125;$)/g</span>, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;12345,678&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>4.2.2 弄出所有的逗号</strong></p>
<p>因为逗号出现的位置，要求后面 3 个数字一组，也就是<code>\d&#123;3&#125;</code>至少出现一次。</p>
<p>此时可以使用量词<code>+</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;12345678&#x27;</span>.replace(<span class="regexp">/(?=(\d&#123;3&#125;)+$)/g</span>, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;12,345,678&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>4.2.3 匹配其余案例</strong></p>
<p>写完正则后，要多验证几个案例，此时我们会发现问题：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;123456789&#x27;</span>.replace(<span class="regexp">/(?=(\d&#123;3&#125;)+$)/g</span>, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;,123,456,789&quot;</span></span><br></pre></td></tr></table></figure>

<p>因为上面的正则，仅仅表示把从结尾向前数，一但是 3 的倍数，就把其前面的位置替换成逗号。因此才会出现这个问题。</p>
<p>怎么解决呢？我们要求匹配的到这个位置不能是开头。</p>
<p>我们知道匹配开头可以使用<code>^</code>，但要求这个位置不是开头怎么办？</p>
<p>easy，<code>(?!^)</code>，你想到了吗？测试如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string1 = <span class="string">&#x27;12345678&#x27;</span>,</span><br><span class="line">  string2 = <span class="string">&#x27;123456789&#x27;</span>;</span><br><span class="line">reg = <span class="regexp">/(?!^)(?=(\d&#123;3&#125;)+$)/g</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = string1.replace(reg, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;12,345,678&quot;</span></span><br><span class="line"></span><br><span class="line">result = string2.replace(reg, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;123,456,789&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>4.2.4 支持其他形式</strong></p>
<p>如果要把”12345678 123456789”替换成”12,345,678 123,456,789”。</p>
<p>此时我们需要修改正则，把里面的开头<code>^</code>和结尾<code>$</code>，替换成<code>\b</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;12345678 123456789&#x27;</span>,</span><br><span class="line">  reg = <span class="regexp">/(?!\b)(?=(\d&#123;3&#125;)+\b)/g</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = string.replace(reg, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;12,345,678 123,456,789&quot;</span></span><br></pre></td></tr></table></figure>

<p>其中<code>(?!\b)</code>怎么理解呢？</p>
<p>要求当前是一个位置，但不是<code>\b</code>前面的位置，其实<code>(?!\b)</code>说的就是<code>\B</code>。</p>
<p>因此最终正则变成了：<code>/\B(?=(\d&#123;3&#125;)+\b)/g</code>。</p>
<p><strong>4.3 验证密码问题</strong></p>
<p>密码长度 6-12 位，由数字、小写字符和大写字母组成，但必须至少包括 2 种字符。</p>
<p>此题，如果写成多个正则来判断，比较容易。但要写成一个正则就比较困难。</p>
<p>那么，我们就来挑战一下。看看我们对位置的理解是否深刻。</p>
<p><strong>4.3.1 简化</strong></p>
<p>不考虑“但必须至少包括 2 种字符”这一条件。我们可以容易写出：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^[0-9A-Za-z]&#123;6,12&#125;$/</span>;</span><br></pre></td></tr></table></figure>

<p><strong>4.3.2 判断是否包含有某一种字符</strong></p>
<p>假设，要求的必须包含数字，怎么办？此时我们可以使用<code>(?=.*[0-9])</code>来做。</p>
<p>因此正则变成：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/(?=.*[0-9])^[0-9A-Za-z]&#123;6,12&#125;$/</span>;</span><br></pre></td></tr></table></figure>

<p><strong>4.3.3 同时包含具体两种字符</strong></p>
<p>比如同时包含数字和小写字母，可以用<code>(?=.*[0-9])(?=.*[a-z])</code>来做。</p>
<p>因此正则变成：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/(?=.*[0-9])(?=.*[a-z])^[0-9A-Za-z]&#123;6,12&#125;$/</span>;</span><br></pre></td></tr></table></figure>

<p><strong>4.3.4 解答</strong></p>
<p>我们可以把原题变成下列几种情况之一：</p>
<ol>
<li>同时包含数字和小写字母</li>
<li>同时包含数字和大写字母</li>
<li>同时包含小写字母和大写字母</li>
<li>同时包含数字、小写字母和大写字母</li>
</ol>
<p>以上的 4 种情况是或的关系（实际上，可以不用第 4 条）。</p>
<p>最终答案是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/((?=.*[0-9])(?=.*[a-z])|(?=.*[0-9])(?=.*[A-Z])|(?=.*[a-z])(?=.*[A-Z]))^[0-9A-Za-z]&#123;6,12&#125;$/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">&#x27;1234567&#x27;</span>)); <span class="comment">// false 全是数字</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">&#x27;abcdef&#x27;</span>)); <span class="comment">// false 全是小写字母</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">&#x27;ABCDEFGH&#x27;</span>)); <span class="comment">// false 全是大写字母</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">&#x27;ab23C&#x27;</span>)); <span class="comment">// false 不足6位</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">&#x27;ABCDEF234&#x27;</span>)); <span class="comment">// true 大写字母和数字</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">&#x27;abcdEF234&#x27;</span>)); <span class="comment">// true 三者都有</span></span><br></pre></td></tr></table></figure>

<p><strong>4.3.5 解惑</strong></p>
<p>上面的正则看起来比较复杂，只要理解了第二步，其余就全部理解了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/(?=.*[<span class="number">0</span>-<span class="number">9</span>])^[<span class="number">0</span>-9A-Za-z]&#123;<span class="number">6</span>,<span class="number">12</span>&#125;$/;</span><br></pre></td></tr></table></figure>

<p>对于这个正则，我们只需要弄明白<code>(?=.*[0-9])^</code>即可。</p>
<p>分开来看就是<code>(?=.*[0-9])</code>和<code>^</code>。</p>
<p>表示开头前面还有个位置（当然也是开头，即同一个位置，想想之前的空字符类比）。</p>
<p><code>(?=.*[0-9])</code>表示该位置后面的字符匹配<code>.*[0-9]</code>，即，有任何多个任意字符，后面再跟个数字。</p>
<p>翻译成大白话，就是接下来的字符，必须包含个数字。</p>
<p><strong>4.3.6 另外一种解法</strong></p>
<p>“至少包含两种字符”的意思就是说，不能全部都是数字，也不能全部都是小写字母，也不能全部都是大写字母。</p>
<p>那么要求“不能全部都是数字”，怎么做呢？<code>(?!p)</code>出马！</p>
<p>对应的正则是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/(?!^[0-9]&#123;6,12&#125;$)^[0-9A-Za-z]&#123;6,12&#125;$/</span>;</span><br></pre></td></tr></table></figure>

<p>三种“都不能”呢？</p>
<p>最终答案是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/(?!^[0-9]&#123;6,12&#125;$)(?!^[a-z]&#123;6,12&#125;$)(?!^[A-Z]&#123;6,12&#125;$)^[0-9A-Za-z]&#123;6,12&#125;$/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">&#x27;1234567&#x27;</span>)); <span class="comment">// false 全是数字</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">&#x27;abcdef&#x27;</span>)); <span class="comment">// false 全是小写字母</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">&#x27;ABCDEFGH&#x27;</span>)); <span class="comment">// false 全是大写字母</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">&#x27;ab23C&#x27;</span>)); <span class="comment">// false 不足6位</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">&#x27;ABCDEF234&#x27;</span>)); <span class="comment">// true 大写字母和数字</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">&#x27;abcdEF234&#x27;</span>)); <span class="comment">// true 三者都有</span></span><br></pre></td></tr></table></figure>

<h3 id="第二章小结"><a href="#第二章小结" class="headerlink" title="第二章小结"></a>第二章小结</h3><p>位置匹配相关的案例，挺多的，不一而足。</p>
<p>掌握匹配位置的这 6 个锚字符，给我们解决正则问题一个新工具。</p>
<h2 id="第三章-正则表达式括号的作用"><a href="#第三章-正则表达式括号的作用" class="headerlink" title="第三章 正则表达式括号的作用"></a>第三章 正则表达式括号的作用</h2><p>不管哪门语言中都有括号。正则表达式也是一门语言，而括号的存在使这门语言更为强大。</p>
<p>对括号的使用是否得心应手，是衡量对正则的掌握水平的一个侧面标准。</p>
<p>括号的作用，其实三言两语就能说明白，括号提供了分组，便于我们引用它。</p>
<p>引用某个分组，会有两种情形：在 JavaScript 里引用它，在正则表达式里引用它。</p>
<p>本章内容虽相对简单，但我也要写长点。</p>
<p>内容包括：</p>
<ol>
<li>分组和分支结构</li>
<li>捕获分组</li>
<li>反向引用</li>
<li>非捕获分组</li>
<li>相关案例</li>
</ol>
<h3 id="1-分组和分支结构"><a href="#1-分组和分支结构" class="headerlink" title="1. 分组和分支结构"></a>1. 分组和分支结构</h3><p>这二者是括号最直觉的作用，也是最原始的功能。</p>
<p><strong>1.1 分组</strong></p>
<p>我们知道<code>/a+/</code>匹配连续出现的“a”，而要匹配连续出现的“ab”时，需要使用<code>/(ab)+/</code>。</p>
<p>其中括号是提供分组功能，使量词<code>+</code>作用于“ab”这个整体，测试如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/(ab)+/g</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;ababa abbb ababab&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;abab&quot;, &quot;ab&quot;, &quot;ababab&quot;]</span></span><br></pre></td></tr></table></figure>

<p><strong>1.2 分支结构</strong></p>
<p>而在多选分支结构<code>(p1|p2)</code>中，此处括号的作用也是不言而喻的，提供了子表达式的所有可能。</p>
<p>比如，要匹配如下的字符串：</p>
<blockquote>
<p>I love JavaScript</p>
<p>I love Regular Expression</p>
</blockquote>
<p>可以使用正则：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^I love (JavaScript|Regular Expression)$/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;I love JavaScript&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;I love Regular Expression&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p>如果去掉正则中的括号，即<code>/^I love JavaScript|Regular Expression$/</code>，匹配字符串是”I love JavaScript”和”Regular Expression”，当然这不是我们想要的。</p>
<h3 id="2-引用分组"><a href="#2-引用分组" class="headerlink" title="2. 引用分组"></a>2. 引用分组</h3><p>这是括号一个重要的作用，有了它，我们就可以进行数据提取，以及更强大的替换操作。</p>
<p>而要使用它带来的好处，必须配合使用实现环境的 API。</p>
<p>以日期为例。假设格式是 yyyy-mm-dd 的，我们可以先写一个简单的正则：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;/</span>;</span><br></pre></td></tr></table></figure>

<p>然后再修改成括号版的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/</span>;</span><br></pre></td></tr></table></figure>

<p>为什么要使用这个正则呢？</p>
<p><strong>2.1 提取数据</strong></p>
<p>比如提取出年、月、日，可以这么做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-12&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;2017-06-12&quot;, &quot;2017&quot;, &quot;06&quot;, &quot;12&quot;, index: 0, input: &quot;2017-06-12&quot;]</span></span><br></pre></td></tr></table></figure>

<p><code>match</code>返回的一个数组，第一个元素是整体匹配结果，然后是各个分组（括号里）匹配的内容，然后是匹配下标，最后是输入的文本。（注意：如果正则是否有修饰符<code>g</code>，<code>match</code>返回的数组格式是不一样的）。</p>
<p>另外也可以使用正则对象的<code>exec</code>方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-12&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.exec(string));</span><br><span class="line"><span class="comment">// =&gt; [&quot;2017-06-12&quot;, &quot;2017&quot;, &quot;06&quot;, &quot;12&quot;, index: 0, input: &quot;2017-06-12&quot;]</span></span><br></pre></td></tr></table></figure>

<p>同时，也可以使用构造函数的全局属性<code>$1</code>至<code>$9</code>来获取：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-12&#x27;</span>;</span><br><span class="line"></span><br><span class="line">regex.test(string); <span class="comment">// 正则操作即可，例如</span></span><br><span class="line"><span class="comment">//regex.exec(string);</span></span><br><span class="line"><span class="comment">//string.match(regex);</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$1); <span class="comment">// &quot;2017&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$2); <span class="comment">// &quot;06&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$3); <span class="comment">// &quot;12&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.2 替换</strong></p>
<p>比如，想把 yyyy-mm-dd 格式，替换成 mm/dd/yyyy 怎么做？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-12&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> result = string.replace(regex, <span class="string">&#x27;$2/$3/$1&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;06/12/2017&quot;</span></span><br></pre></td></tr></table></figure>

<p>其中<code>replace</code>中的，第二个参数里用<code>$1</code>、<code>$2</code>、<code>$3</code>指代相应的分组。等价于如下的形式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-12&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> result = string.replace(regex, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">RegExp</span>.$2 + <span class="string">&#x27;/&#x27;</span> + <span class="built_in">RegExp</span>.$3 + <span class="string">&#x27;/&#x27;</span> + <span class="built_in">RegExp</span>.$1;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;06/12/2017&quot;</span></span><br></pre></td></tr></table></figure>

<p>也等价于：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-12&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> result = string.replace(regex, <span class="function"><span class="keyword">function</span> (<span class="params">match, year, month, day</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> month + <span class="string">&#x27;/&#x27;</span> + day + <span class="string">&#x27;/&#x27;</span> + year;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;06/12/2017&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-反向引用"><a href="#3-反向引用" class="headerlink" title="3. 反向引用"></a>3. 反向引用</h3><p>除了使用相应 API 来引用分组，也可以在正则本身里引用分组。但只能引用之前出现的分组，即反向引用。</p>
<p>还是以日期为例。</p>
<p>比如要写一个正则支持匹配如下三种格式：</p>
<blockquote>
<p>2016-06-12</p>
<p>2016/06/12</p>
<p>2016.06.12</p>
</blockquote>
<p>最先可能想到的正则是:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d&#123;4&#125;(-|\/|\.)\d&#123;2&#125;(-|\/|\.)\d&#123;2&#125;/</span>;</span><br><span class="line"><span class="keyword">var</span> string1 = <span class="string">&#x27;2017-06-12&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> string2 = <span class="string">&#x27;2017/06/12&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> string3 = <span class="string">&#x27;2017.06.12&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> string4 = <span class="string">&#x27;2016-06/12&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string1)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string2)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string3)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string4)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>其中<code>/</code>和<code>.</code>需要转义。虽然匹配了要求的情况，但也匹配”2016-06/12”这样的数据。</p>
<p>假设我们想要求分割符前后一致怎么办？此时需要使用反向引用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d&#123;4&#125;(-|\/|\.)\d&#123;2&#125;\1\d&#123;2&#125;/</span>;</span><br><span class="line"><span class="keyword">var</span> string1 = <span class="string">&#x27;2017-06-12&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> string2 = <span class="string">&#x27;2017/06/12&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> string3 = <span class="string">&#x27;2017.06.12&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> string4 = <span class="string">&#x27;2016-06/12&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string1)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string2)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string3)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string4)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>注意里面的<code>\1</code>，表示的引用之前的那个分组<code>(-|\/|\.)</code>。不管它匹配到什么（比如-），<code>\1</code>都匹配那个同样的具体某个字符。</p>
<p>我们知道了<code>\1</code>的含义后，那么<code>\2</code>和<code>\3</code>的概念也就理解了，即分别指代第二个和第三个分组。</p>
<p>看到这里，此时，恐怕你会有三个问题。</p>
<p><strong>3.1 括号嵌套怎么办？</strong></p>
<p>以左括号（开括号）为准。比如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^((\d)(\d(\d)))\1\2\3\4$/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;1231231233&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$1); <span class="comment">// 123</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$2); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$3); <span class="comment">// 23</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$4); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<p>我们可以看看这个正则匹配模式：</p>
<ul>
<li>第一个字符是数字，比如说 1，</li>
<li>第二个字符是数字，比如说 2，</li>
<li>第三个字符是数字，比如说 3，</li>
<li>接下来的是<code>\1</code>，是第一个分组内容，那么看第一个开括号对应的分组是什么，是 123，</li>
<li>接下来的是<code>\2</code>，找到第 2 个开括号，对应的分组，匹配的内容是 1，</li>
<li>接下来的是<code>\3</code>，找到第 3 个开括号，对应的分组，匹配的内容是 23，</li>
<li>最后的是<code>\4</code>，找到第 3 个开括号，对应的分组，匹配的内容是 3。</li>
</ul>
<p>这个问题，估计仔细看一下，就该明白了。</p>
<p><strong>3.2 \10 表示什么呢？</strong></p>
<p>另外一个疑问可能是，即<code>\10</code>是表示第 10 个分组，还是<code>\1</code>和<code>0</code>呢？</p>
<p>答案是前者，虽然一个正则里出现<code>\10</code>比较罕见。测试如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/(1)(2)(3)(4)(5)(6)(7)(8)(9)(#) \10+/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;123456789# ######&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p><strong>3.3 引用不存在的分组会怎样？</strong></p>
<p>因为反向引用，是引用前面的分组，但我们在正则里引用了不存在的分组时，此时正则不会报错，只是匹配反向引用的字符本身。例如<code>\2</code>，就匹配”\2”。注意”\2”表示对”2”进行了转意。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\1\2\3\4\5\6\7\8\9/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;\1\2\3\4\5\6\789&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;\1\2\3\4\5\6\789&#x27;</span>.split(<span class="string">&#x27;&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>chrome 浏览器打印的结果：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<h3 id="4-非捕获分组"><a href="#4-非捕获分组" class="headerlink" title="4. 非捕获分组"></a>4. 非捕获分组</h3><p>之前文中出现的分组，都会捕获它们匹配到的数据，以便后续引用，因此也称他们是捕获型分组。</p>
<p>如果只想要括号最原始的功能，但不会引用它，即，既不在 API 里引用，也不在正则里反向引用。此时可以使用非捕获分组<code>(?:p)</code>，例如本文第一个例子可以修改为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/(?:ab)+/g</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;ababa abbb ababab&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;abab&quot;, &quot;ab&quot;, &quot;ababab&quot;]</span></span><br></pre></td></tr></table></figure>

<h3 id="5-相关案例"><a href="#5-相关案例" class="headerlink" title="5. 相关案例"></a>5. 相关案例</h3><p>至此括号的作用已经讲完了，总结一句话，就是提供了可供我们使用的分组，如何用就看我们的了。</p>
<p><strong>5.1 字符串 trim 方法模拟</strong></p>
<p><code>trim</code>方法是去掉字符串的开头和结尾的空白符。有两种思路去做。</p>
<p>第一种，匹配到开头和结尾的空白符，然后替换成空字符。如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trim</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/^\s+|\s+$/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(trim(<span class="string">&#x27;  foobar   &#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; &quot;foobar&quot;</span></span><br></pre></td></tr></table></figure>

<p>第二种，匹配整个字符串，然后用引用来提取出相应的数据：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trim</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/^\s*(.*?)\s*$/g</span>, <span class="string">&#x27;$1&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(trim(<span class="string">&#x27;  foobar   &#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; &quot;foobar&quot;</span></span><br></pre></td></tr></table></figure>

<p>这里使用了惰性匹配<code>*?</code>，不然也会匹配最后一个空格之前的所有空格的。</p>
<p>当然，前者效率高。</p>
<p><strong>5.2 将每个单词的首字母转换为大写</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">titleize</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.toLowerCase().replace(<span class="regexp">/(?:^|\s)\w/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c.toUpperCase();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(titleize(<span class="string">&#x27;my name is epeli&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; &quot;My Name Is Epeli&quot;</span></span><br></pre></td></tr></table></figure>

<p>思路是找到每个单词的首字母，当然这里不使用非捕获匹配也是可以的。</p>
<p><strong>5.3 驼峰化</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">camelize</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/[-_\s]+(.)?/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">match, c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c ? c.toUpperCase() : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(camelize(<span class="string">&#x27;-moz-transform&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; &quot;MozTransform&quot;</span></span><br></pre></td></tr></table></figure>

<p>其中分组<code>(.)</code>表示首字母。单词的界定是，前面的字符可以是多个连字符、下划线以及空白符。正则后面的?的目的，是为了应对<code>str</code>尾部的字符可能不是单词字符，比如<code>str</code>是’-moz-transform ‘。</p>
<p><strong>5.4 中划线化</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dasherize</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str</span><br><span class="line">    .replace(<span class="regexp">/([A-Z])/g</span>, <span class="string">&#x27;-$1&#x27;</span>)</span><br><span class="line">    .replace(<span class="regexp">/[-_\s]+/g</span>, <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">    .toLowerCase();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(dasherize(<span class="string">&#x27;MozTransform&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; &quot;-moz-transform&quot;</span></span><br></pre></td></tr></table></figure>

<p>驼峰化的逆过程。</p>
<p><strong>5.5 html 转义和反转义</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将HTML特殊字符转换成等值的实体</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escapeHTML</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> escapeChars = &#123;</span><br><span class="line">    <span class="string">&#x27;¢&#x27;</span>: <span class="string">&#x27;cent&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;£&#x27;</span>: <span class="string">&#x27;pound&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;¥&#x27;</span>: <span class="string">&#x27;yen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;€&#x27;</span>: <span class="string">&#x27;euro&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;©&#x27;</span>: <span class="string">&#x27;copy&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;®&#x27;</span>: <span class="string">&#x27;reg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&lt;&#x27;</span>: <span class="string">&#x27;lt&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;&#x27;</span>: <span class="string">&#x27;gt&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&quot;&#x27;</span>: <span class="string">&#x27;quot&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&amp;&#x27;</span>: <span class="string">&#x27;amp&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;&#x27;&quot;</span>: <span class="string">&#x27;#39&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> str.replace(</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;[&#x27;</span> + <span class="built_in">Object</span>.keys(escapeChars).join(<span class="string">&#x27;&#x27;</span>) + <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;g&#x27;</span>),</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">match</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;&amp;&#x27;</span> + escapeChars[match] + <span class="string">&#x27;;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(escapeHTML(<span class="string">&#x27;&lt;div&gt;Blah blah blah&lt;/div&gt;&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; &quot;&amp;lt;div&amp;gt;Blah blah blah&amp;lt;/div&amp;gt&quot;;</span></span><br></pre></td></tr></table></figure>

<p>其中使用了用构造函数生成的正则，然后替换相应的格式就行了，这个跟本章没多大关系。</p>
<p>倒是它的逆过程，使用了括号，以便提供引用，也很简单，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 实体字符转换为等值的HTML。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unescapeHTML</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> htmlEntities = &#123;</span><br><span class="line">    nbsp: <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">    cent: <span class="string">&#x27;¢&#x27;</span>,</span><br><span class="line">    pound: <span class="string">&#x27;£&#x27;</span>,</span><br><span class="line">    yen: <span class="string">&#x27;¥&#x27;</span>,</span><br><span class="line">    euro: <span class="string">&#x27;€&#x27;</span>,</span><br><span class="line">    copy: <span class="string">&#x27;©&#x27;</span>,</span><br><span class="line">    reg: <span class="string">&#x27;®&#x27;</span>,</span><br><span class="line">    lt: <span class="string">&#x27;&lt;&#x27;</span>,</span><br><span class="line">    gt: <span class="string">&#x27;&gt;&#x27;</span>,</span><br><span class="line">    quot: <span class="string">&#x27;&quot;&#x27;</span>,</span><br><span class="line">    amp: <span class="string">&#x27;&amp;&#x27;</span>,</span><br><span class="line">    apos: <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/\&amp;([^;]+);/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">match, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (key <span class="keyword">in</span> htmlEntities) &#123;</span><br><span class="line">      <span class="keyword">return</span> htmlEntities[key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> match;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(unescapeHTML(<span class="string">&#x27;&amp;lt;div&amp;gt;Blah blah blah&amp;lt;/div&amp;gt;&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; &quot;&lt;div&gt;Blah blah blah&lt;/div&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<p>通过<code>key</code>获取相应的分组引用，然后作为对象的键。</p>
<p><strong>5.6 匹配成对标签</strong></p>
<p>要求匹配：</p>
<blockquote>
<title>regular expression</title>

<p>laoyao bye bye</p>
</blockquote>
<p>不匹配：</p>
<blockquote>
<title>wrong!</p>
</blockquote>
<p>匹配一个开标签，可以使用正则<code>&lt;[^&gt;]+&gt;</code>，</p>
<p>匹配一个闭标签，可以使用<code>&lt;\/[^&gt;]+&gt;</code>，</p>
<p>但是要求匹配成对标签，那就需要使用反向引用，如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/&lt;([^&gt;]+)&gt;[\d\D]*&lt;\/\1&gt;/</span>;</span><br><span class="line"><span class="keyword">var</span> string1 = <span class="string">&#x27;&lt;title&gt;regular expression&lt;/title&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> string2 = <span class="string">&#x27;&lt;p&gt;laoyao bye bye&lt;/p&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> string3 = <span class="string">&#x27;&lt;title&gt;wrong!&lt;/p&gt;&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string1)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string2)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string3)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>其中开标签<code>&lt;[^&gt;]+&gt;</code>改成<code>&lt;([^&gt;]+)&gt;</code>，使用括号的目的是为了后面使用反向引用，而提供分组。闭标签使用了反向引用，<code>&lt;\/\1&gt;</code>。</p>
<p>另外<code>[\d\D]</code>的意思是，这个字符是数字或者不是数字，因此，也就是匹配任意字符的意思。</p>
<h3 id="第三章小结"><a href="#第三章小结" class="headerlink" title="第三章小结"></a>第三章小结</h3><p>正则中使用括号的例子那可是太多了，不一而足。</p>
<p>重点理解括号可以提供分组，我们可以提取数据，应该就可以了。</p>
<p>例子中的代码，基本没做多少分析，相信你都能看懂的。</p>
<h2 id="第-4-章-正则表达式回溯法原理"><a href="#第-4-章-正则表达式回溯法原理" class="headerlink" title="第 4 章 正则表达式回溯法原理"></a>第 4 章 正则表达式回溯法原理</h2><p>学习正则表达式，是需要懂点儿匹配原理的。</p>
<p>而研究匹配原理时，有两个字出现的频率比较高：“回溯”。</p>
<p>听起来挺高大上，确实还有很多人对此不明不白的。</p>
<p>因此，本章就简单扼要地说清楚回溯到底是什么东西。</p>
<p>内容包括：</p>
<ol>
<li>没有回溯的匹配</li>
<li>有回溯的匹配</li>
<li>常见的回溯形式</li>
</ol>
<h3 id="1-没有回溯的匹配"><a href="#1-没有回溯的匹配" class="headerlink" title="1. 没有回溯的匹配"></a>1. 没有回溯的匹配</h3><p>假设我们的正则是<code>/ab&#123;1,3&#125;c/</code>，其可视化形式是：</p>
<p><img src="https://user-gold-cdn.xitu.io/2017/7/19/d92077b25d4faf8073d38999294f746c?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>而当目标字符串是”abbbc”时，就没有所谓的“回溯”。其匹配过程是：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>其中子表达式<code>b&#123;1,3&#125;</code>表示“b”字符连续出现 1 到 3 次。</p>
<h3 id="2-有回溯的匹配"><a href="#2-有回溯的匹配" class="headerlink" title="2. 有回溯的匹配"></a>2. 有回溯的匹配</h3><p>如果目标字符串是”abbc”，中间就有回溯。</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>图中第 5 步有红颜色，表示匹配不成功。此时<code>b&#123;1,3&#125;</code>已经匹配到了 2 个字符“b”，准备尝试第三个时，结果发现接下来的字符是“c”。那么就认为<code>b&#123;1,3&#125;</code>就已经匹配完毕。然后状态又回到之前的状态（即第 6 步，与第 4 步一样），最后再用子表达式<code>c</code>，去匹配字符“c”。当然，此时整个表达式匹配成功了。</p>
<p>图中的第 6 步，就是“回溯”。</p>
<p>你可能对此没有感觉，这里我们再举一个例子。正则是：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>目标字符串是”abbbc”，匹配过程是：</p>
<p><img src="https://user-gold-cdn.xitu.io/2017/7/19/dddfffaf633dd14c4eefba488f64400f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>其中第 7 步和第 10 步是回溯。第 7 步与第 4 步一样，此时<code>b&#123;1,3&#125;</code>匹配了两个”b”，而第 10 步与第 3 步一样，此时<code>b&#123;1,3&#125;</code>只匹配了一个”b”，这也是<code>b&#123;1,3&#125;</code>的最终匹配结果。</p>
<p>这里再看一个清晰的回溯，正则是：</p>
<p><img src="https://user-gold-cdn.xitu.io/2017/7/19/a9e420776eb01c07979f1599e4060775?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>目标字符串是：”acd”ef，匹配过程是：</p>
<p><img src="https://user-gold-cdn.xitu.io/2017/7/19/33b738b42fc9e74edc84b17479ac7000?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>图中省略了尝试匹配双引号失败的过程。可以看出<code>.*</code>是非常影响效率的。</p>
<p>为了减少一些不必要的回溯，可以把正则修改为<code>/&quot;[^&quot;]*&quot;/</code>。</p>
<h3 id="3-常见的回溯形式"><a href="#3-常见的回溯形式" class="headerlink" title="3. 常见的回溯形式"></a>3. 常见的回溯形式</h3><p>正则表达式匹配字符串的这种方式，有个学名，叫回溯法。</p>
<p>回溯法也称试探法，它的基本思想是：从问题的某一种状态（初始状态）出发，搜索从这种状态出发所能达到的所有“状态”，当一条路走到“尽头”的时候（不能再前进），再后退一步或若干步，从另一种可能“状态”出发，继续搜索，直到所有的“路径”（状态）都试探过。这种不断“前进”、不断“回溯”寻找解的方法，就称作“回溯法”。（copy 于百度百科）。</p>
<p>本质上就是深度优先搜索算法。<strong>其中退到之前的某一步这一过程，我们称为“回溯”。</strong>从上面的描述过程中，可以看出，路走不通时，就会发生“回溯”。即，<strong>尝试匹配失败时，接下来的一步通常就是回溯。</strong></p>
<p>道理，我们是懂了。那么 JS 中正则表达式会产生回溯的地方都有哪些呢？</p>
<p><strong>3.1 贪婪量词</strong></p>
<p>之前的例子都是贪婪量词相关的。比如<code>b&#123;1,3&#125;</code>，因为其是贪婪的，尝试可能的顺序是从多往少的方向去尝试。首先会尝试”bbb”，然后再看整个正则是否能匹配。不能匹配时，吐出一个”b”，即在”bb”的基础上，再继续尝试。如果还不行，再吐出一个，再试。如果还不行呢？只能说明匹配失败了。</p>
<p>虽然局部匹配是贪婪的，但也要满足整体能正确匹配。否则，皮之不存，毛将焉附？</p>
<p>此时我们不禁会问，如果当多个贪婪量词挨着存在，并相互有冲突时，此时会是怎样？</p>
<p>答案是，先下手为强！因为深度优先搜索。测试如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;12345&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/(\d&#123;1,3&#125;)(\d&#123;1,3&#125;)/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;12345&quot;, &quot;123&quot;, &quot;45&quot;, index: 0, input: &quot;12345&quot;]</span></span><br></pre></td></tr></table></figure>

<p>其中，前面的<code>\d&#123;1,3&#125;</code>匹配的是”123”，后面的<code>\d&#123;1,3&#125;</code>匹配的是”45”。</p>
<p><strong>3.2 惰性量词</strong></p>
<p>惰性量词就是在贪婪量词后面加个问号。表示尽可能少的匹配，比如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;12345&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/(\d&#123;1,3&#125;?)(\d&#123;1,3&#125;)/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;1234&quot;, &quot;1&quot;, &quot;234&quot;, index: 0, input: &quot;12345&quot;]</span></span><br></pre></td></tr></table></figure>

<p>其中<code>\d&#123;1,3&#125;?</code>只匹配到一个字符”1”，而后面的<code>\d&#123;1,3&#125;</code>匹配了”234”。</p>
<p>虽然惰性量词不贪，但也会有回溯的现象。比如正则是：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>目标字符串是”12345”，匹配过程是：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>知道你不贪、很知足，但是为了整体匹配成，没办法，也只能给你多塞点了。因此最后<code>\d&#123;1,3&#125;?</code>匹配的字符是”12”，是两个数字，而不是一个。</p>
<p>3.3 <strong>分支结构</strong></p>
<p>我们知道分支也是惰性的，比如<code>/can|candy/</code>，去匹配字符串”candy”，得到的结果是”can”，因为分支会一个一个尝试，如果前面的满足了，后面就不会再试验了。</p>
<p>分支结构，可能前面的子模式会形成了局部匹配，如果接下来表达式整体不匹配时，仍会继续尝试剩下的分支。这种尝试也可以看成一种回溯。</p>
<p>比如正则：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>目标字符串是”candy”，匹配过程：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>上面第 5 步，虽然没有回到之前的状态，但仍然回到了分支结构，尝试下一种可能。所以，可以认为它是一种回溯的。</p>
<h3 id="第四章小结"><a href="#第四章小结" class="headerlink" title="第四章小结"></a>第四章小结</h3><p>其实回溯法，很容易掌握的。</p>
<p>简单总结就是，正因为有多种可能，所以要一个一个试。直到，要么到某一步时，整体匹配成功了；要么最后都试完后，发现整体匹配不成功。</p>
<ol>
<li>贪婪量词“试”的策略是：买衣服砍价。价钱太高了，便宜点，不行，再便宜点。</li>
<li>惰性量词“试”的策略是：卖东西加价。给少了，再多给点行不，还有点少啊，再给点。</li>
<li>分支结构“试”的策略是：货比三家。这家不行，换一家吧，还不行，再换。</li>
</ol>
<p>既然有回溯的过程，那么匹配效率肯定低一些。相对谁呢？相对那些 DFA 引擎。</p>
<p>而 JS 的正则引擎是 NFA，NFA 是“非确定型有限自动机”的简写。</p>
<p>大部分语言中的正则都是 NFA，为啥它这么流行呢？</p>
<p>答：你别看我匹配慢，但是我编译快啊，而且我还有趣哦。</p>
<h2 id="第-5-章-正则表达式的拆分"><a href="#第-5-章-正则表达式的拆分" class="headerlink" title="第 5 章 正则表达式的拆分"></a>第 5 章 正则表达式的拆分</h2><p>对于一门语言的掌握程度怎么样，可以有两个角度来衡量：读和写。</p>
<p>不仅要求自己能解决问题，还要看懂别人的解决方案。代码是这样，正则表达式也是这样。</p>
<p>正则这门语言跟其他语言有一点不同，它通常就是一大堆字符，而没有所谓“语句”的概念。</p>
<p>如何能正确地把一大串正则拆分成一块一块的，成为了破解“天书”的关键。</p>
<p>本章就解决这一问题，内容包括：</p>
<ol>
<li>结构和操作符</li>
<li>注意要点</li>
<li>案例分析</li>
</ol>
<h3 id="1-结构和操作符"><a href="#1-结构和操作符" class="headerlink" title="1. 结构和操作符"></a>1. 结构和操作符</h3><p>编程语言一般都有操作符。只要有操作符，就会出现一个问题。当一大堆操作在一起时，先操作谁，又后操作谁呢？为了不产生歧义，就需要语言本身定义好操作顺序，即所谓的优先级。</p>
<p>而在正则表达式中，操作符都体现在结构中，即由特殊字符和普通字符所代表的一个个特殊整体。</p>
<p>JS 正则表达式中，都有哪些结构呢？</p>
<blockquote>
<p>字符字面量、字符组、量词、锚字符、分组、选择分支、反向引用。</p>
</blockquote>
<p>具体含义简要回顾如下（如懂，可以略去不看）：</p>
<blockquote>
<p><strong>字面量</strong>，匹配一个具体字符，包括不用转义的和需要转义的。比如 a 匹配字符”a”，又比如<code>\n</code>匹配换行符，又比如<code>\.</code>匹配小数点。</p>
<p><strong>字符组</strong>，匹配一个字符，可以是多种可能之一，比如<code>[0-9]</code>，表示匹配一个数字。也有<code>\d</code>的简写形式。另外还有反义字符组，表示可以是除了特定字符之外任何一个字符，比如<code>[^0-9]</code>，表示一个非数字字符，也有<code>\D</code>的简写形式。</p>
<p><strong>量词</strong>，表示一个字符连续出现，比如<code>a&#123;1,3&#125;</code>表示“a”字符连续出现 3 次。另外还有常见的简写形式，比如<code>a+</code>表示“a”字符连续出现至少一次。</p>
<p><strong>锚点</strong>，匹配一个位置，而不是字符。比如^匹配字符串的开头，又比如<code>\b</code>匹配单词边界，又比如<code>(?=\d)</code>表示数字前面的位置。</p>
<p><strong>分组</strong>，用括号表示一个整体，比如<code>(ab)+</code>，表示”ab”两个字符连续出现多次，也可以使用非捕获分组<code>(?:ab)+</code>。</p>
<p><strong>分支</strong>，多个子表达式多选一，比如<code>abc|bcd</code>，表达式匹配”abc”或者”bcd”字符子串。</p>
<p><strong>反向引用</strong>，比如<code>\2</code>，表示引用第 2 个分组。</p>
</blockquote>
<p>其中涉及到的操作符有：</p>
<blockquote>
<p>1.转义符 <code>\</code> 2.括号和方括号 <code>(...)</code>、<code>(?:...)</code>、<code>(?=...)</code>、<code>(?!...)</code>、<code>[...]</code> 3.量词限定符 <code>&#123;m&#125;</code>、<code>&#123;m,n&#125;</code>、<code>&#123;m,&#125;</code>、<code>?</code>、<code>*</code>、<code>+</code> 4.位置和序列 <code>^</code> 、<code>$</code>、 <code>\元字符</code>、 <code>一般字符</code><br>\5. 管道符（竖杠）<code>|</code></p>
</blockquote>
<p>上面操作符的优先级从上至下，由高到低。</p>
<p>这里，我们来分析一个正则：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/ab?(c|de*)+|fg/;</span><br></pre></td></tr></table></figure>

<ol>
<li>由于括号的存在，所以，<code>(c|de*)</code>是一个整体结构。</li>
<li>在<code>(c|de*)</code>中，注意其中的量词<code>*</code>，因此<code>e*</code>是一个整体结构。</li>
<li>又因为分支结构“|”优先级最低，因此<code>c</code>是一个整体、而<code>de*</code>是另一个整体。</li>
<li>同理，整个正则分成了 <code>a</code>、<code>b?</code>、<code>(...)+</code>、<code>f</code>、<code>g</code>。而由于分支的原因，又可以分成<code>ab?(c|de*)+</code>和<code>fg</code>这两部分。</li>
</ol>
<p>希望你没被我绕晕，上面的分析可用其<a href="http://link.zhihu.com/?target=https://jex.im/regulex/%23!embed=false&flags=&re=ab?(c%7Cde*)+%7Cfg">可视化</a>形式描述如下：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<h3 id="2-注意要点"><a href="#2-注意要点" class="headerlink" title="2. 注意要点"></a>2. 注意要点</h3><p>关于结构和操作符，还是有几点需要强调：</p>
<p><strong>2.1 匹配字符串整体问题</strong></p>
<p>因为是要匹配整个字符串，我们经常会在正则前后中加上锚字符<code>^</code>和<code>$</code>。</p>
<p>比如要匹配目标字符串”abc”或者”bcd”时，如果一不小心，就会写成<code>/^abc|bcd$/</code>。</p>
<p>而位置字符和字符序列优先级要比竖杠高，故其匹配的结构是：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>应该修改成:</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p><strong>2.2 量词连缀问题</strong></p>
<p>假设，要匹配这样的字符串：</p>
<blockquote>
<p>\1. 每个字符为 a、b、c 任选其一</p>
<p>\2. 字符串的长度是 3 的倍数</p>
</blockquote>
<p>此时正则不能想当然地写成<code>/^[abc]&#123;3&#125;+$/</code>，这样会报错，说<code>+</code>前面没什么可重复的：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>此时要修改成：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p><strong>2.3 元字符转义问题</strong></p>
<p>所谓元字符，就是正则中有特殊含义的字符。</p>
<p>所有结构里，用到的元字符总结如下：</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">**^**&#96; &#96;**$**&#96; &#96;**.**&#96; &#96;*****&#96; &#96;**+**&#96; &#96;**?**&#96; &#96;**|**&#96; &#96;**\**&#96; &#96;**&#x2F;**&#96; &#96;**(**&#96; &#96;**)**&#96; &#96;**[**&#96; &#96;**]**&#96; &#96;**&#123;**&#96; &#96;**&#125;**&#96; &#96;**&#x3D;**&#96; &#96;**!**&#96; &#96;**:**&#96; &#96;**-**&#96; &#96;**,**</span><br></pre></td></tr></table></figure>
</blockquote>
<p>当匹配上面的字符本身时，可以一律转义：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;^$.*+?|\\/[]&#123;&#125;=!:-,&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\^\$\.\*\+\?\|\\\/\[\]\&#123;\&#125;\=\!\:\-\,/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p>其中<code>string</code>中的<code>\</code>字符也要转义的。</p>
<p>另外，在<code>string</code>中，也可以把每个字符转义，当然，转义后的结果仍是本身：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;^$.*+?|\\/[]&#123;&#125;=!:-,&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> string2 = <span class="string">&#x27;^$.*+?|\\/[]&#123;&#125;=!:-,&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string == string2);</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p>现在的问题是，是不是每个字符都需要转义呢？否，看情况。</p>
<p><strong>2.3.1 字符组中的元字符</strong></p>
<p>跟字符组相关的元字符有<code>[]</code>、<code>^</code>、<code>-</code>。因此在会引起歧义的地方进行转义。例如开头的<code>^</code>必须转义，不然会把整个字符组，看成反义字符组。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;^$.*+?|\\/[]&#123;&#125;=!:-,&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/[\^$.*+?|\\/\[\]&#123;&#125;=!:\-,]/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;^&quot;, &quot;$&quot;, &quot;.&quot;, &quot;*&quot;, &quot;+&quot;, &quot;?&quot;, &quot;|&quot;, &quot;\&quot;, &quot;/&quot;, &quot;[&quot;, &quot;]&quot;, &quot;&#123;&quot;, &quot;&#125;&quot;, &quot;=&quot;, &quot;!&quot;, &quot;:&quot;, &quot;-&quot;, &quot;,&quot;]</span></span><br></pre></td></tr></table></figure>

<p><strong>2.3.2 匹配“[abc]”和“{3,5}”</strong></p>
<p>我们知道<code>[abc]</code>，是个字符组。如果要匹配字符串”[abc]”时，该怎么办？</p>
<p>可以写成<code>/\[abc\]/</code>，也可以写成<code>/\[abc]/</code>，测试如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;[abc]&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\[abc]/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex)[<span class="number">0</span>]);</span><br><span class="line"><span class="comment">// =&gt; &quot;[abc]&quot;</span></span><br></pre></td></tr></table></figure>

<p>只需要在第一个方括号转义即可，因为后面的方括号构不成字符组，正则不会引发歧义，自然不需要转义。</p>
<p>同理，要匹配字符串”{3,5}”，只需要把正则写成<code>/\&#123;3,5&#125;/</code>即可。</p>
<p>另外，我们知道量词有简写形式<code>&#123;m,&#125;</code>，却没有<code>&#123;,n&#125;</code>的情况。虽然后者不构成量词的形式，但此时并不会报错。当然，匹配的字符串也是”{,n}”，测试如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;&#123;,3&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/&#123;,3&#125;/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex)[<span class="number">0</span>]);</span><br><span class="line"><span class="comment">// =&gt; &quot;&#123;,3&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.3.3 其余情况</strong></p>
<p>比如<code>=</code> <code>!</code> <code>:</code> <code>-</code> <code>,</code>等符号，只要不在特殊结构中，也不需要转义。</p>
<p>但是，括号需要前后都转义的，如<code>/\(123\)/</code>。</p>
<p>至于剩下的<code>^</code> <code>$</code> <code>.</code> <code>*</code> <code>+</code> <code>?</code> <code>|</code> <code>\</code> <code>/</code>等字符，只要不在字符组内，都需要转义的。</p>
<h3 id="3-案例分析"><a href="#3-案例分析" class="headerlink" title="3. 案例分析"></a>3. 案例分析</h3><p>接下来分析两个例子，一个简单的，一个复杂的。</p>
<p><strong>3.1 身份证</strong></p>
<p>正则表达式是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^(\d&#123;<span class="number">15</span>&#125;|\d&#123;<span class="number">17</span>&#125;[\dxX])$/;</span><br></pre></td></tr></table></figure>

<p>因为竖杠“|”,的优先级最低，所以正则分成了两部分<code>\d&#123;15&#125;</code>和<code>\d&#123;17&#125;[\dxX]</code>。</p>
<ul>
<li><code>\d&#123;15&#125;</code>表示 15 位连续数字。</li>
<li><code>\d&#123;17&#125;[\dxX]</code>表示 17 位连续数字，最后一位可以是数字可以大小写字母”x”。</li>
</ul>
<p>可视化如下：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p><strong>3.2 IPV4 地址</strong></p>
<p>正则表达式是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^((<span class="number">0</span>&#123;<span class="number">0</span>,<span class="number">2</span>&#125;\d|<span class="number">0</span>?\d&#123;<span class="number">2</span>&#125;|<span class="number">1</span>\d&#123;<span class="number">2</span>&#125;|<span class="number">2</span>[<span class="number">0</span>-<span class="number">4</span>]\d|<span class="number">25</span>[<span class="number">0</span>-<span class="number">5</span>])\.)&#123;<span class="number">3</span>&#125;(<span class="number">0</span>&#123;<span class="number">0</span>,<span class="number">2</span>&#125;\d|<span class="number">0</span>?\d&#123;<span class="number">2</span>&#125;|<span class="number">1</span>\d&#123;<span class="number">2</span>&#125;|<span class="number">2</span>[<span class="number">0</span>-<span class="number">4</span>]\d|<span class="number">25</span>[<span class="number">0</span>-<span class="number">5</span>])$/;</span><br></pre></td></tr></table></figure>

<p>这个正则，看起来非常吓人。但是熟悉优先级后，会立马得出如下的结构：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">((...)\.)&#123;<span class="number">3</span>&#125;(...)</span><br></pre></td></tr></table></figure>

<p>上面的两个<code>(...)</code>是一样的结构。表示匹配的是 3 位数字。因此整个结构是</p>
<blockquote>
<p>3 位数.3 位数.3 位数.3 位数</p>
</blockquote>
<p>然后再来分析<code>(...)</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="number">0</span>&#123;<span class="number">0</span>,<span class="number">2</span>&#125;\d|<span class="number">0</span>?\d&#123;<span class="number">2</span>&#125;|<span class="number">1</span>\d&#123;<span class="number">2</span>&#125;|<span class="number">2</span>[<span class="number">0</span>-<span class="number">4</span>]\d|<span class="number">25</span>[<span class="number">0</span>-<span class="number">5</span>])(<span class="number">0</span>&#123;<span class="number">0</span>,<span class="number">2</span>&#125;\d|<span class="number">0</span>?\d&#123;<span class="number">2</span>&#125;|<span class="number">1</span>\d&#123;<span class="number">2</span>&#125;|<span class="number">2</span>[<span class="number">0</span>-<span class="number">4</span>]\d|<span class="number">25</span>[<span class="number">0</span>-<span class="number">5</span>])</span><br></pre></td></tr></table></figure>

<p>它是一个多选结构，分成 5 个部分：</p>
<ul>
<li><code>0&#123;0,2&#125;\d</code>，匹配一位数，包括 0 补齐的。比如，9、09、009；</li>
<li><code>0?\d&#123;2&#125;</code>，匹配两位数，包括 0 补齐的，也包括一位数；</li>
<li><code>1\d&#123;2&#125;</code>，匹配 100 到 199;</li>
<li><code>2[0-4]\d</code>，匹配 200-249；</li>
<li><code>25[0-5]</code>，匹配 250-255。</li>
</ul>
<p>最后来看一下其可视化形式：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<h3 id="第五章小结"><a href="#第五章小结" class="headerlink" title="第五章小结"></a>第五章小结</h3><p>掌握正则表达式中的优先级后，再看任何正则应该都有信心分析下去了。</p>
<p>至于例子，不一而足，没有写太多。</p>
<p>这里稍微总结一下，竖杠的优先级最低，即最后运算。</p>
<p>只要知道这一点，就能读懂大部分正则。</p>
<p>另外关于元字符转义问题，当自己不确定与否时，尽管去转义，总之是不会错的。</p>
<h2 id="第-6-章-正则表达式的构建"><a href="#第-6-章-正则表达式的构建" class="headerlink" title="第 6 章 正则表达式的构建"></a>第 6 章 正则表达式的构建</h2><p>对于一门语言的掌握程度怎么样，可以有两个角度来衡量：读和写。</p>
<p>不仅要看懂别人的解决方案，也要能独立地解决问题。代码是这样，正则表达式也是这样。</p>
<p>与“读”相比，“写”往往更为重要，这个道理是不言而喻的。</p>
<p>对正则的运用，首重就是：如何针对问题，构建一个合适的正则表达式？</p>
<p>本章就解决该问题，内容包括：</p>
<ol>
<li>平衡法则</li>
<li>构建正则前提</li>
<li>准确性</li>
<li>效率</li>
</ol>
<h3 id="1-平衡法则"><a href="#1-平衡法则" class="headerlink" title="1. 平衡法则"></a>1. 平衡法则</h3><p>构建正则有一点非常重要，需要做到下面几点的平衡：</p>
<ol>
<li>匹配预期的字符串</li>
<li>不匹配非预期的字符串</li>
<li>可读性和可维护性</li>
<li>效率</li>
</ol>
<h3 id="2-构建正则前提"><a href="#2-构建正则前提" class="headerlink" title="2. 构建正则前提"></a>2. 构建正则前提</h3><p><strong>2.1 是否能使用正则</strong></p>
<p>正则太强大了，以至于我们随便遇到一个操作字符串问题时，都会下意识地去想，用正则该怎么做。但我们始终要提醒自己，正则虽然强大，但不是万能的，很多看似很简单的事情，还是做不到的。</p>
<p>比如匹配这样的字符串：1010010001….</p>
<p>虽然很有规律，但是只靠正则就是无能为力。</p>
<p><strong>2.2 是否有必要使用正则</strong></p>
<p>要认识到正则的局限，不要去研究根本无法完成的任务。同时，也不能走入另一个极端：无所不用正则。能用字符串 API 解决的简单问题，就不该正则出马。</p>
<ul>
<li>比如，从日期中提取出年月日，虽然可以使用正则：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-07-01&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;2017-07-01&quot;, &quot;2017&quot;, &quot;07&quot;, &quot;01&quot;, index: 0, input: &quot;2017-07-01&quot;]</span></span><br></pre></td></tr></table></figure>

<p>其实，可以使用字符串的<code>split</code>方法来做，即可：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-07-01&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> result = string.split(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; [&quot;2017&quot;, &quot;07&quot;, &quot;01&quot;]</span></span><br></pre></td></tr></table></figure>

<ul>
<li>比如，判断是否有问号，虽然可以使用：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;?id=xx&amp;act=search&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.search(<span class="regexp">/\?/</span>));</span><br><span class="line"><span class="comment">// =&gt; 0</span></span><br></pre></td></tr></table></figure>

<p>其实，可以使用字符串的<code>indexOf</code>方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;?id=xx&amp;act=search&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.indexOf(<span class="string">&#x27;?&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; 0</span></span><br></pre></td></tr></table></figure>

<ul>
<li>比如获取子串，虽然可以使用正则：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;JavaScript&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(<span class="regexp">/.&#123;4&#125;(.+)/</span>)[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">// =&gt; Script</span></span><br></pre></td></tr></table></figure>

<p>其实，可以直接使用字符串的<code>substring</code>或<code>substr</code>方法来做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;JavaScript&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.substring(<span class="number">4</span>));</span><br><span class="line"><span class="comment">// =&gt; Script</span></span><br></pre></td></tr></table></figure>

<p><strong>2.3 是否有必要构建一个复杂的正则</strong></p>
<p>比如密码匹配问题，要求密码长度 6-12 位，由数字、小写字符和大写字母组成，但必须至少包括 2 种字符。</p>
<p>在第 2 章里，我们写出了正则是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/(?!^[<span class="number">0</span>-<span class="number">9</span>]&#123;<span class="number">6</span>,<span class="number">12</span>&#125;$)(?!^[a-z]&#123;<span class="number">6</span>,<span class="number">12</span>&#125;$)(?!^[A-Z]&#123;<span class="number">6</span>,<span class="number">12</span>&#125;$)^[<span class="number">0</span>-9A-Za-z]&#123;<span class="number">6</span>,<span class="number">12</span>&#125;$/;</span><br></pre></td></tr></table></figure>

<p>其实可以使用多个小正则来做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex1 = <span class="regexp">/^[0-9A-Za-z]&#123;6,12&#125;$/</span>;</span><br><span class="line"><span class="keyword">var</span> regex2 = <span class="regexp">/^[0-9]&#123;6,12&#125;$/</span>;</span><br><span class="line"><span class="keyword">var</span> regex3 = <span class="regexp">/^[A-Z]&#123;6,12&#125;$/</span>;</span><br><span class="line"><span class="keyword">var</span> regex4 = <span class="regexp">/^[a-z]&#123;6,12&#125;$/</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkPassword</span>(<span class="params">string</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!regex1.test(string)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (regex2.test(string)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (regex3.test(string)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (regex4.test(string)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-准确性"><a href="#3-准确性" class="headerlink" title="3. 准确性"></a>3. 准确性</h3><p>所谓准确性，就是能匹配预期的目标，并且不匹配非预期的目标。</p>
<p>这里提到了“预期”二字，那么我们就需要知道目标的组成规则。</p>
<p>不然没法界定什么样的目标字符串是符合预期的，什么样的又不是符合预期的。</p>
<p>下面将举例说明，当目标字符串构成比较复杂时，该如何构建正则，并考虑到哪些平衡。</p>
<p><strong>3.1 匹配固定电话</strong></p>
<p>比如要匹配如下格式的固定电话号码：</p>
<blockquote>
<p>055188888888</p>
<p>0551-88888888</p>
<p>(0551)88888888</p>
</blockquote>
<p>第一步，了解各部分的模式规则。</p>
<p>上面的电话，总体上分为区号和号码两部分（不考虑分机号和+86 的情形）。</p>
<p>区号是 0 开头的 3 到 4 位数字，对应的正则是：<code>0\d&#123;2,3&#125;</code></p>
<p>号码是非 0 开头的 7 到 8 位数字，对应的正则是：<code>[1-9]\d&#123;6,7&#125;</code></p>
<p>因此，匹配 055188888888 的正则是：<code>/^0\d&#123;2,3&#125;[1-9]\d&#123;6,7&#125;$/</code></p>
<p>匹配 0551-88888888 的正则是：<code>/^0\d&#123;2,3&#125;-[1-9]\d&#123;6,7&#125;$/</code></p>
<p>匹配(0551)88888888 的正则是：<code>/^\(0\d&#123;2,3&#125;\)[1-9]\d&#123;6,7&#125;$/</code></p>
<p>第二步，明确形式关系。</p>
<p>这三者情形是或的关系，可以构建分支：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^<span class="number">0</span>\d&#123;<span class="number">2</span>,<span class="number">3</span>&#125;[<span class="number">1</span>-<span class="number">9</span>]\d&#123;<span class="number">6</span>,<span class="number">7</span>&#125;$|^<span class="number">0</span>\d&#123;<span class="number">2</span>,<span class="number">3</span>&#125;-[<span class="number">1</span>-<span class="number">9</span>]\d&#123;<span class="number">6</span>,<span class="number">7</span>&#125;$|^\(<span class="number">0</span>\d&#123;<span class="number">2</span>,<span class="number">3</span>&#125;\)[<span class="number">1</span>-<span class="number">9</span>]\d&#123;<span class="number">6</span>,<span class="number">7</span>&#125;$/;</span><br></pre></td></tr></table></figure>

<p>提取公共部分：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^(<span class="number">0</span>\d&#123;<span class="number">2</span>,<span class="number">3</span>&#125;|<span class="number">0</span>\d&#123;<span class="number">2</span>,<span class="number">3</span>&#125;-|\(<span class="number">0</span>\d&#123;<span class="number">2</span>,<span class="number">3</span>&#125;\))[<span class="number">1</span>-<span class="number">9</span>]\d&#123;<span class="number">6</span>,<span class="number">7</span>&#125;$/;</span><br></pre></td></tr></table></figure>

<p>进一步简写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^(<span class="number">0</span>\d&#123;<span class="number">2</span>,<span class="number">3</span>&#125;-?|\(<span class="number">0</span>\d&#123;<span class="number">2</span>,<span class="number">3</span>&#125;\))[<span class="number">1</span>-<span class="number">9</span>]\d&#123;<span class="number">6</span>,<span class="number">7</span>&#125;$/;</span><br></pre></td></tr></table></figure>

<p>其可视化形式：</p>
<p><img src="https://user-gold-cdn.xitu.io/2017/7/19/225f104c7293c5a174f7c9394d755f13?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>上面的正则构建过程略显罗嗦，但是这样做，能保证正则是准确的。</p>
<p>上述三种情形是或的关系，这一点很重要，不然很容易按字符是否出现的情形把正则写成：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^\(?<span class="number">0</span>\d&#123;<span class="number">2</span>,<span class="number">3</span>&#125;\)?-?[<span class="number">1</span>-<span class="number">9</span>]\d&#123;<span class="number">6</span>,<span class="number">7</span>&#125;$/;</span><br></pre></td></tr></table></figure>

<p>虽然也能匹配上述目标字符串，但也会匹配(0551-88888888 这样的字符串。当然，这不是我们想要的。</p>
<p>其实这个正则也不是完美的，因为现实中，并不是每个 3 位数和 4 位数都是一个真实的区号。</p>
<p>这就是一个平衡取舍问题，一般够用就行。</p>
<p><strong>3.2 匹配浮点数</strong></p>
<p>要求匹配如下的格式：</p>
<blockquote>
<p>1.23、+1.23、-1.23</p>
<p>10、+10、-10</p>
<p>.2、+.2、-.2</p>
</blockquote>
<p>可以看出正则分为三部分。</p>
<p>符号部分：<code>[+-]</code></p>
<p>整数部分：<code>\d+</code></p>
<p>小数部分：<code>\.\d+</code></p>
<p>上述三个部分，并不是全部都出现。如果此时很容易写出如下的正则：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^[+-]?(\d+)?(\.\d+)?$/;</span><br></pre></td></tr></table></figure>

<p>此正则看似没问题，但这个正则也会匹配空字符””。</p>
<p>因为目标字符串的形式关系不是要求每部分都是可选的。</p>
<p>要匹配 1.23、+1.23、-1.23，可以用<code>/^[+-]?\d+\.\d+$/</code></p>
<p>要匹配 10、+10、-10，可以用<code>/^[+-]?\d+$/</code></p>
<p>要匹配.2、+.2、-.2，可以用<code>/^[+-]?\.\d+$/</code></p>
<p>因此整个正则是这三者的或的关系，提取公众部分后是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^[+-]?(\d+\.\d+|\d+|\.\d+)$/;</span><br></pre></td></tr></table></figure>

<p>其可视化形式是：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>如果要求不匹配+.2 和-.2，此时正则变成：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>当然，<code>/^[+-]?(\d+\.\d+|\d+|\.\d+)$/</code>也不是完美的，我们也是做了些取舍，比如：</p>
<ul>
<li>它也会匹配 012 这样以 0 开头的整数。如果要求不匹配的话，需要修改整数部分的正则。</li>
<li>一般进行验证操作之前，都要经过 trim 和判空。那样的话，也许那个错误正则也就够用了。</li>
<li>也可以进一步改写成：<code>/^[+-]?(\d+)?(\.)?\d+$/</code>，这样我们就需要考虑可读性和可维护性了。</li>
</ul>
<h3 id="4-效率"><a href="#4-效率" class="headerlink" title="4. 效率"></a>4. 效率</h3><p>保证了准确性后，才需要是否要考虑要优化。大多数情形是不需要优化的，除非运行的非常慢。什么情形正则表达式运行才慢呢？我们需要考察正则表达式的运行过程（原理）。</p>
<p>正则表达式的运行分为如下的阶段：</p>
<ol>
<li>编译</li>
<li>设定起始位置</li>
<li>尝试匹配</li>
<li>匹配失败的话，从下一位开始继续第 3 步</li>
<li>最终结果：匹配成功或失败</li>
</ol>
<p>下面以代码为例，来看看这几个阶段都做了什么：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d+/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.lastIndex, regex.exec(<span class="string">&#x27;123abc34def&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(regex.lastIndex, regex.exec(<span class="string">&#x27;123abc34def&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(regex.lastIndex, regex.exec(<span class="string">&#x27;123abc34def&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(regex.lastIndex, regex.exec(<span class="string">&#x27;123abc34def&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; 0 [&quot;123&quot;, index: 0, input: &quot;123abc34def&quot;]</span></span><br><span class="line"><span class="comment">// =&gt; 3 [&quot;34&quot;, index: 6, input: &quot;123abc34def&quot;]</span></span><br><span class="line"><span class="comment">// =&gt; 8 null</span></span><br><span class="line"><span class="comment">// =&gt; 0 [&quot;123&quot;, index: 0, input: &quot;123abc34def&quot;]</span></span><br></pre></td></tr></table></figure>

<p>具体分析如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d+/g</span>;</span><br></pre></td></tr></table></figure>

<p>当生成一个正则时，引擎会对其进行编译。报错与否出现这这个阶段。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">regex.exec(<span class="string">&#x27;123abc34def&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>当尝试匹配时，需要确定从哪一位置开始匹配。一般情形都是字符串的开头，即第 0 位。</p>
<p>但当使用<code>test</code>和<code>exec</code>方法，且正则有<code>g</code>时，起始位置是从正则对象的<code>lastIndex</code>属性开始。</p>
<p>因此第一次<code>exec</code>是从第 0 位开始，而第二次是从 3 开始的。</p>
<p>设定好起始位置后，就开始尝试匹配了。</p>
<p>比如第一次<code>exec</code>，从 0 开始，去尝试匹配，并且成功地匹配到 3 个数字。此时结束时的下标是 2，因此下一次的起始位置是 3。</p>
<p>而第二次，起始下标是 3，但第 3 个字符是“a”，并不是数字。但此时并不会直接报匹配失败，而是移动到下一位置，即从第 4 位开始继续尝试匹配，但该字符是 b，也不是数字。再移动到下一位，是 c 仍不行，再移动一位是数字 3，此时匹配到了两位数字 34。此时，下一次匹配的位置是 d 的位置，即第 8 位。</p>
<p>第三次，是从第 8 位开始匹配，直到试到最后一位，也没发现匹配的，因此匹配失败，返回<code>null</code>。同时设置<code>lastIndex</code>为 0，即，如要再尝试匹配的话，需从头开始。</p>
<p>从上面可以看出，匹配会出现效率问题，主要出现在上面的第 3 阶段和第 4 阶段。</p>
<p>因此，主要优化手法也是针对这两阶段的。</p>
<p><strong>4.1 使用具体型字符组来代替通配符，来消除回溯</strong></p>
<p>而在第三阶段，最大的问题就是回溯。</p>
<p>例如，匹配双引用号之间的字符。如，匹配字符串 123”abc”456 中的”abc”。</p>
<p>如果正则用的是：<code>/&quot;.*&quot;/</code>，，会在第 3 阶段产生 4 次回溯（粉色表示<code>.*</code>匹配的内容）：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>如果正则用的是：<code>/&quot;.*?&quot;/</code>，会产生 2 次回溯（粉色表示<code>.*?</code>匹配的内容）：</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>因为回溯的存在，需要引擎保存多种可能中未尝试过的状态，以便后续回溯时使用。注定要占用一定的内存。</p>
<p>此时要使用具体化的字符组，来代替通配符<code>.</code>，以便消除不必要的字符，此时使用正则<code>/&quot;[^&quot;]*&quot;/</code>，即可。</p>
<p><strong>4.2 使用非捕获型分组</strong></p>
<p>因为括号的作用之一是，可以捕获分组和分支里的数据。那么就需要内存来保存它们。</p>
<p>当我们不需要使用分组引用和反向引用时，此时可以使用非捕获分组。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^[+-]?(\d+\.\d+|\d+|\.\d+)$/;</span><br></pre></td></tr></table></figure>

<p>可以修改成：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^[+-]?(?:\d+\.\d+|\d+|\.\d+)$/;</span><br></pre></td></tr></table></figure>

<p><strong>4.3 独立出确定字符</strong></p>
<p>例如<code>/a+/</code>，可以修改成<code>/aa*/</code>。</p>
<p>因为后者能比前者多确定了字符 a。这样会在第四步中，加快判断是否匹配失败，进而加快移位的速度。</p>
<p><strong>4.4 提取分支公共部分</strong></p>
<p>比如/<code>^abc|^def/</code>，修改成<code>/^(?:abc|def)/</code>。</p>
<p>又比如<code>/this|that/</code>，修改成<code>/th(?:is|at)/</code>。</p>
<p>这样做，可以减少匹配过程中可消除的重复。</p>
<p><strong>4.5 减少分支的数量，缩小它们的范围</strong></p>
<p><code>/red|read/</code>，可以修改成<code>/rea?d/</code>。此时分支和量词产生的回溯的成本是不一样的。但这样优化后，可读性会降低的。</p>
<h3 id="第六章小结"><a href="#第六章小结" class="headerlink" title="第六章小结"></a>第六章小结</h3><p>本章涉及的内容并不多。</p>
<p>一般情况下，针对某问题能写出一个满足需求的正则，基本上就可以了。</p>
<p>至于准确性和效率方面的追求，纯属看个人要求了。我觉得够用就行了。</p>
<p>关于准确性，本章关心的是最常用的解决思路：</p>
<p>针对每种情形，分别写出正则，然用分支把他们合并在一起，再提取分支公共部分，就能得到准确的正则。</p>
<p>至于优化，本章没有为了凑数，去写一大堆。了解了匹配原理，常见的优化手法也就这么几种。</p>
<h2 id="第七章-正则表达式编程"><a href="#第七章-正则表达式编程" class="headerlink" title="第七章 正则表达式编程"></a>第七章 正则表达式编程</h2><p>什么叫知识，能指导我们实践的东西才叫知识。</p>
<p>学习一样东西，如果不能使用，最多只能算作纸上谈兵。正则表达式的学习，也不例外。</p>
<p>掌握了正则表达式的语法后，下一步，也是关键的一步，就是在真实世界中使用它。</p>
<p>那么如何使用正则表达式呢？有哪些关键的点呢？本章就解决这个问题。</p>
<p>内容包括：</p>
<ol>
<li>正则表达式的四种操作</li>
<li>相关 API 注意要点</li>
<li>真实案例</li>
</ol>
<h3 id="1-正则表达式的四种操作"><a href="#1-正则表达式的四种操作" class="headerlink" title="1. 正则表达式的四种操作"></a>1. 正则表达式的四种操作</h3><p>正则表达式是匹配模式，不管如何使用正则表达式，万变不离其宗，都需要先“匹配”。</p>
<p>有了匹配这一基本操作后，才有其他的操作：验证、切分、提取、替换。</p>
<p>进行任何相关操作，也需要宿主引擎相关 API 的配合使用。当然，在 JS 中，相关 API 也不多。</p>
<p><strong>1.1 验证</strong></p>
<p>验证是正则表达式最直接的应用，比如表单验证。</p>
<p>在说验证之前，先要说清楚匹配是什么概念。</p>
<p>所谓匹配，就是看目标字符串里是否有满足匹配的子串。因此，“匹配”的本质就是“查找”。</p>
<p>有没有匹配，是不是匹配上，判断是否的操作，即称为“验证”。</p>
<p>这里举一个例子，来看看如何使用相关 API 进行验证操作的。</p>
<p>比如，判断一个字符串中是否有数字。</p>
<ul>
<li>使用<code>search</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;abc123&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(!!~string.search(regex));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>test</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;abc123&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(string));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>match</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;abc123&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(!!string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>exec</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;abc123&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(!!regex.exec(string));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p>其中，最常用的是<code>test</code>。</p>
<p><strong>1.2 切分</strong></p>
<p>匹配上了，我们就可以进行一些操作，比如切分。</p>
<p>所谓“切分”，就是把目标字符串，切成一段一段的。在 JS 中使用的是<code>split</code>。</p>
<p>比如，目标字符串是”html,css,javascript”，按逗号来切分：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/,/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;html,css,javascript&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.split(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;html&quot;, &quot;css&quot;, &quot;javascript&quot;]</span></span><br></pre></td></tr></table></figure>

<p>又比如，如下的日期格式：</p>
<blockquote>
<p>2017/06/26</p>
<p>2017.06.26</p>
<p>2017-06-26</p>
</blockquote>
<p>可以使用<code>split</code>“切出”年月日：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\D/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;2017/06/26&#x27;</span>.split(regex));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;2017.06.26&#x27;</span>.split(regex));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;2017-06-26&#x27;</span>.split(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;2017&quot;, &quot;06&quot;, &quot;26&quot;]</span></span><br><span class="line"><span class="comment">// =&gt; [&quot;2017&quot;, &quot;06&quot;, &quot;26&quot;]</span></span><br><span class="line"><span class="comment">// =&gt; [&quot;2017&quot;, &quot;06&quot;, &quot;26&quot;]</span></span><br></pre></td></tr></table></figure>

<p><strong>1.3 提取</strong></p>
<p>虽然整体匹配上了，但有时需要提取部分匹配的数据。</p>
<p>此时正则通常要使用分组引用（分组捕获）功能，还需要配合使用相关 API。</p>
<p>这里，还是以日期为例，提取出年月日。注意下面正则中的括号：</p>
<ul>
<li><code>match</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^(\d&#123;4&#125;)\D(\d&#123;2&#125;)\D(\d&#123;2&#125;)$/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-26&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt;[&quot;2017-06-26&quot;, &quot;2017&quot;, &quot;06&quot;, &quot;26&quot;, index: 0, input: &quot;2017-06-26&quot;]</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>exec</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^(\d&#123;4&#125;)\D(\d&#123;2&#125;)\D(\d&#123;2&#125;)$/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-26&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.exec(string));</span><br><span class="line"><span class="comment">// =&gt;[&quot;2017-06-26&quot;, &quot;2017&quot;, &quot;06&quot;, &quot;26&quot;, index: 0, input: &quot;2017-06-26&quot;]</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>test</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^(\d&#123;4&#125;)\D(\d&#123;2&#125;)\D(\d&#123;2&#125;)$/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-26&#x27;</span>;</span><br><span class="line">regex.test(string);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$1, <span class="built_in">RegExp</span>.$2, <span class="built_in">RegExp</span>.$3);</span><br><span class="line"><span class="comment">// =&gt; &quot;2017&quot; &quot;06&quot; &quot;26&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>search</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^(\d&#123;4&#125;)\D(\d&#123;2&#125;)\D(\d&#123;2&#125;)$/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-26&#x27;</span>;</span><br><span class="line">string.search(regex);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$1, <span class="built_in">RegExp</span>.$2, <span class="built_in">RegExp</span>.$3);</span><br><span class="line"><span class="comment">// =&gt; &quot;2017&quot; &quot;06&quot; &quot;26&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>replace</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^(\d&#123;4&#125;)\D(\d&#123;2&#125;)\D(\d&#123;2&#125;)$/</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-26&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> date = [];</span><br><span class="line">string.replace(regex, <span class="function"><span class="keyword">function</span> (<span class="params">match, year, month, day</span>) </span>&#123;</span><br><span class="line">  date.push(year, month, day);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(date);</span><br><span class="line"><span class="comment">// =&gt; [&quot;2017&quot;, &quot;06&quot;, &quot;26&quot;]</span></span><br></pre></td></tr></table></figure>

<p>其中，最常用的是<code>match</code>。</p>
<p><strong>1.4 替换</strong></p>
<p>找，往往不是目的，通常下一步是为了替换。在 JS 中，使用<code>replace</code>进行替换。</p>
<p>比如把日期格式，从 yyyy-mm-dd 替换成 yyyy/mm/dd：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-26&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> today = <span class="keyword">new</span> <span class="built_in">Date</span>(string.replace(<span class="regexp">/-/g</span>, <span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(today);</span><br><span class="line"><span class="comment">// =&gt; Mon Jun 26 2017 00:00:00 GMT+0800 (中国标准时间)</span></span><br></pre></td></tr></table></figure>

<p>这里只是简单地应用了一下<code>replace</code>。但，<code>replace</code>方法是强大的，是需要重点掌握的。</p>
<h3 id="2-相关-API-注意要点"><a href="#2-相关-API-注意要点" class="headerlink" title="2. 相关 API 注意要点"></a>2. 相关 API 注意要点</h3><p>从上面可以看出用于正则操作的方法，共有 6 个，字符串实例 4 个，正则实例 2 个：</p>
<blockquote>
<p>String#search</p>
<p>String#split</p>
<p>String#match</p>
<p>String#replace</p>
<p>RegExp#test</p>
<p>RegExp#exec</p>
</blockquote>
<p>本文不打算详细地讲解它们的方方面面细节，具体可以参考《JavaScript 权威指南》的第三部分。本文重点列出一些容易忽视的地方，以飨读者。</p>
<p><strong>2.1 search 和 match 的参数问题</strong></p>
<p>我们知道字符串实例的那 4 个方法参数都支持正则和字符串。</p>
<p>但<code>search</code>和<code>match</code>，会把字符串转换为正则的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017.06.27&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(string.search(<span class="string">&#x27;.&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; 0</span></span><br><span class="line"><span class="comment">//需要修改成下列形式之一</span></span><br><span class="line"><span class="built_in">console</span>.log(string.search(<span class="string">&#x27;\\.&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(string.search(<span class="regexp">/\./</span>));</span><br><span class="line"><span class="comment">// =&gt; 4</span></span><br><span class="line"><span class="comment">// =&gt; 4</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(string.match(<span class="string">&#x27;.&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; [&quot;2&quot;, index: 0, input: &quot;2017.06.27&quot;]</span></span><br><span class="line"><span class="comment">//需要修改成下列形式之一</span></span><br><span class="line"><span class="built_in">console</span>.log(string.match(<span class="string">&#x27;\\.&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(string.match(<span class="regexp">/\./</span>));</span><br><span class="line"><span class="comment">// =&gt; [&quot;.&quot;, index: 4, input: &quot;2017.06.27&quot;]</span></span><br><span class="line"><span class="comment">// =&gt; [&quot;.&quot;, index: 4, input: &quot;2017.06.27&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(string.split(<span class="string">&#x27;.&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; [&quot;2017&quot;, &quot;06&quot;, &quot;27&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(string.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; &quot;2017/06.27&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.2 match 返回结果的格式问题</strong></p>
<p><code>match</code>返回结果的格式，与正则对象是否有修饰符<code>g</code>有关。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017.06.27&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex1 = <span class="regexp">/\b(\d+)\b/</span>;</span><br><span class="line"><span class="keyword">var</span> regex2 = <span class="regexp">/\b(\d+)\b/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex1));</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex2));</span><br><span class="line"><span class="comment">// =&gt; [&quot;2017&quot;, &quot;2017&quot;, index: 0, input: &quot;2017.06.27&quot;]</span></span><br><span class="line"><span class="comment">// =&gt; [&quot;2017&quot;, &quot;06&quot;, &quot;27&quot;]</span></span><br></pre></td></tr></table></figure>

<p>没有<code>g</code>，返回的是标准匹配格式，即，数组的第一个元素是整体匹配的内容，接下来是分组捕获的内容，然后是整体匹配的第一个下标，最后是输入的目标字符串。</p>
<p>有<code>g</code>，返回的是所有匹配的内容。</p>
<p>当没有匹配时，不管有无<code>g</code>，都返回<code>null</code>。</p>
<p><strong>2.3 exec 比 match 更强大</strong></p>
<p>当正则没有<code>g</code>时，使用<code>match</code>返回的信息比较多。但是有<code>g</code>后，就没有关键的信息<code>index</code>了。</p>
<p>而<code>exec</code>方法就能解决这个问题，它能接着上一次匹配后继续匹配：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017.06.27&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex2 = <span class="regexp">/\b(\d+)\b/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex2.exec(string));</span><br><span class="line"><span class="built_in">console</span>.log(regex2.lastIndex);</span><br><span class="line"><span class="built_in">console</span>.log(regex2.exec(string));</span><br><span class="line"><span class="built_in">console</span>.log(regex2.lastIndex);</span><br><span class="line"><span class="built_in">console</span>.log(regex2.exec(string));</span><br><span class="line"><span class="built_in">console</span>.log(regex2.lastIndex);</span><br><span class="line"><span class="built_in">console</span>.log(regex2.exec(string));</span><br><span class="line"><span class="built_in">console</span>.log(regex2.lastIndex);</span><br><span class="line"><span class="comment">// =&gt; [&quot;2017&quot;, &quot;2017&quot;, index: 0, input: &quot;2017.06.27&quot;]</span></span><br><span class="line"><span class="comment">// =&gt; 4</span></span><br><span class="line"><span class="comment">// =&gt; [&quot;06&quot;, &quot;06&quot;, index: 5, input: &quot;2017.06.27&quot;]</span></span><br><span class="line"><span class="comment">// =&gt; 7</span></span><br><span class="line"><span class="comment">// =&gt; [&quot;27&quot;, &quot;27&quot;, index: 8, input: &quot;2017.06.27&quot;]</span></span><br><span class="line"><span class="comment">// =&gt; 10</span></span><br><span class="line"><span class="comment">// =&gt; null</span></span><br><span class="line"><span class="comment">// =&gt; 0</span></span><br></pre></td></tr></table></figure>

<p>其中正则实例<code>lastIndex</code>属性，表示下一次匹配开始的位置。</p>
<p>比如第一次匹配了“2017”，开始下标是 0，共 4 个字符，因此这次匹配结束的位置是 3，下一次开始匹配的位置是 4。</p>
<p>从上述代码看出，在使用<code>exec</code>时，经常需要配合使用<code>while</code>循环：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017.06.27&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex2 = <span class="regexp">/\b(\d+)\b/g</span>;</span><br><span class="line"><span class="keyword">var</span> result;</span><br><span class="line"><span class="keyword">while</span> ((result = regex2.exec(string))) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result, regex2.lastIndex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// =&gt; [&quot;2017&quot;, &quot;2017&quot;, index: 0, input: &quot;2017.06.27&quot;] 4</span></span><br><span class="line"><span class="comment">// =&gt; [&quot;06&quot;, &quot;06&quot;, index: 5, input: &quot;2017.06.27&quot;] 7</span></span><br><span class="line"><span class="comment">// =&gt; [&quot;27&quot;, &quot;27&quot;, index: 8, input: &quot;2017.06.27&quot;] 10</span></span><br></pre></td></tr></table></figure>

<p><strong>2.4 修饰符 g，对 exex 和 test 的影响</strong></p>
<p>上面提到了正则实例的<code>lastIndex</code>属性，表示尝试匹配时，从字符串的<code>lastIndex</code>位开始去匹配。</p>
<p>字符串的四个方法，每次匹配时，都是从 0 开始的，即<code>lastIndex</code>属性始终不变。</p>
<p>而正则实例的两个方法<code>exec</code>、<code>test</code>，当正则是全局匹配时，每一次匹配完成后，都会修改<code>lastIndex</code>。下面让我们以<code>test</code>为例，看看你是否会迷糊：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/a/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;a&#x27;</span>), regex.lastIndex);</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;aba&#x27;</span>), regex.lastIndex);</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;ababc&#x27;</span>), regex.lastIndex);</span><br><span class="line"><span class="comment">// =&gt; true 1</span></span><br><span class="line"><span class="comment">// =&gt; true 3</span></span><br><span class="line"><span class="comment">// =&gt; false 0</span></span><br></pre></td></tr></table></figure>

<p>注意上面代码中的第三次调用<code>test</code>，因为这一次尝试匹配，开始从下标<code>lastIndex</code>即 3 位置处开始查找，自然就找不到了。</p>
<p>如果没有<code>g</code>，自然都是从字符串第 0 个字符处开始尝试匹配：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/a/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;a&#x27;</span>), regex.lastIndex);</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;aba&#x27;</span>), regex.lastIndex);</span><br><span class="line"><span class="built_in">console</span>.log(regex.test(<span class="string">&#x27;ababc&#x27;</span>), regex.lastIndex);</span><br><span class="line"><span class="comment">// =&gt; true 0</span></span><br><span class="line"><span class="comment">// =&gt; true 0</span></span><br><span class="line"><span class="comment">// =&gt; true 0</span></span><br></pre></td></tr></table></figure>

<p><strong>2.5 test 整体匹配时需要使用^和$</strong></p>
<p>这个相对容易理解，因为<code>test</code>是看目标字符串中是否有子串匹配正则，即有部分匹配即可。</p>
<p>如果，要整体匹配，正则前后需要添加开头和结尾：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/123/</span>.test(<span class="string">&#x27;a123b&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/^123$/</span>.test(<span class="string">&#x27;a123b&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/^123$/</span>.test(<span class="string">&#x27;123&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p><strong>2.6 split 相关注意事项</strong></p>
<p><code>split</code>方法看起来不起眼，但要注意的地方有两个的。</p>
<p>第一，它可以有第二个参数，表示结果数组的最大长度：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;html,css,javascript&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.split(<span class="regexp">/,/</span>, <span class="number">2</span>));</span><br><span class="line"><span class="comment">// =&gt;[&quot;html&quot;, &quot;css&quot;]</span></span><br></pre></td></tr></table></figure>

<p>第二，正则使用分组时，结果数组中是包含分隔符的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;html,css,javascript&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.split(<span class="regexp">/(,)/</span>));</span><br><span class="line"><span class="comment">// =&gt;[&quot;html&quot;, &quot;,&quot;, &quot;css&quot;, &quot;,&quot;, &quot;javascript&quot;]</span></span><br></pre></td></tr></table></figure>

<p><strong>2.7 replace 是很强大的</strong></p>
<p>《JavaScript 权威指南》认为<code>exec</code>是这 6 个 API 中最强大的，而我始终认为<code>replace</code>才是最强大的。因为它也能拿到该拿到的信息，然后可以假借替换之名，做些其他事情。</p>
<p>总体来说<code>replace</code>有两种使用形式，这是因为它的第二个参数，可以是字符串，也可以是函数。</p>
<p>当第二个参数是字符串时，如下的字符有特殊的含义：</p>
<blockquote>
<p><code>$1</code>,<code>$2</code>,…,<code>$99 </code>匹配第 1~99 个分组里捕获的文本<br><code>$&amp;</code> 匹配到的子串文本<br><code>$`` 匹配到的子串的左边文本 </code>$’<code>匹配到的子串的右边文本</code>?` 美元符号</p>
</blockquote>
<p>例如，把”2,3,5”，变成”5=2+3”：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;2,3,5&#x27;</span>.replace(<span class="regexp">/(\d+),(\d+),(\d+)/</span>, <span class="string">&#x27;$3=$1+$2&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;5=2+3&quot;</span></span><br></pre></td></tr></table></figure>

<p>又例如，把”2,3,5”，变成”222,333,555”:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;2,3,5&#x27;</span>.replace(<span class="regexp">/(\d+)/g</span>, <span class="string">&#x27;$&amp;$&amp;$&amp;&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;222,333,555&quot;</span></span><br></pre></td></tr></table></figure>

<p>再例如，把”2+3=5”，变成”2+3=2+3=5=5”:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;2+3=5&#x27;</span>.replace(<span class="regexp">/=/</span>, <span class="string">&quot;$&amp;$`$&amp;$&#x27;$&amp;&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// =&gt; &quot;2+3=2+3=5=5&quot;</span></span><br></pre></td></tr></table></figure>

<p>当第二个参数是函数时，我们需要注意该回调函数的参数具体是什么：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;1234 2345 3456&#x27;</span>.replace(</span><br><span class="line">  /(\d)\d&#123;<span class="number">2</span>&#125;(\d)/g,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">match, $<span class="number">1</span>, $<span class="number">2</span>, index, input</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log([match, $<span class="number">1</span>, $<span class="number">2</span>, index, input]);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"><span class="comment">// =&gt; [&quot;1234&quot;, &quot;1&quot;, &quot;4&quot;, 0, &quot;1234 2345 3456&quot;]</span></span><br><span class="line"><span class="comment">// =&gt; [&quot;2345&quot;, &quot;2&quot;, &quot;5&quot;, 5, &quot;1234 2345 3456&quot;]</span></span><br><span class="line"><span class="comment">// =&gt; [&quot;3456&quot;, &quot;3&quot;, &quot;6&quot;, 10, &quot;1234 2345 3456&quot;]</span></span><br></pre></td></tr></table></figure>

<p>此时我们可以看到<code>replace</code>拿到的信息，并不比<code>exec</code>少。</p>
<p><strong>2.8 使用构造函数需要注意的问题</strong></p>
<p>一般不推荐使用构造函数生成正则，而应该优先使用字面量。因为用构造函数会多写很多<code>\</code>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;2017-06-27 2017.06.27 2017/06/27&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d&#123;4&#125;(-|\.|\/)\d&#123;2&#125;\1\d&#123;2&#125;/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;2017-06-27&quot;, &quot;2017.06.27&quot;, &quot;2017/06/27&quot;]</span></span><br><span class="line"></span><br><span class="line">regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;\\d&#123;4&#125;(-|\\.|\\/)\\d&#123;2&#125;\\1\\d&#123;2&#125;&#x27;</span>, <span class="string">&#x27;g&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(string.match(regex));</span><br><span class="line"><span class="comment">// =&gt; [&quot;2017-06-27&quot;, &quot;2017.06.27&quot;, &quot;2017/06/27&quot;]</span></span><br></pre></td></tr></table></figure>

<p><strong>2.9 修饰符</strong></p>
<p>ES5 中修饰符，共 3 个：</p>
<blockquote>
<p><code>g</code> 全局匹配，即找到所有匹配的，单词是 global</p>
<p><code>i</code> 忽略字母大小写，单词 ingoreCase</p>
<p><code>m</code> 多行匹配，只影响<code>^</code>和<code>$</code>，二者变成行的概念，即行开头和行结尾。单词是 multiline</p>
</blockquote>
<p>当然正则对象也有相应的只读属性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\w/gim</span>;</span><br><span class="line"><span class="built_in">console</span>.log(regex.global);</span><br><span class="line"><span class="built_in">console</span>.log(regex.ignoreCase);</span><br><span class="line"><span class="built_in">console</span>.log(regex.multiline);</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p><strong>2.10 source 属性</strong></p>
<p>正则实例对象属性，除了<code>global</code>、<code>ingnoreCase</code>、<code>multiline</code>、<code>lastIndex</code>属性之外，还有一个<code>source</code>属性。</p>
<p>它什么时候有用呢？</p>
<p>比如，在构建动态的正则表达式时，可以通过查看该属性，来确认构建出的正则到底是什么：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> className = <span class="string">&#x27;high&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;(^|\\s)&#x27;</span> + className + <span class="string">&#x27;(\\s|$)&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(regex.source);</span><br><span class="line"><span class="comment">// =&gt; (^|\s)high(\s|$) 即字符串&quot;(^|\\s)high(\\s|$)&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.11 构造函数属性</strong></p>
<p>构造函数的静态属性基于所执行的最近一次正则操作而变化。除了是<code>$1</code>,…,<code>$9</code>之外，还有几个不太常用的属性（有兼容性问题）：</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">RegExp.input&#96; 最近一次目标字符串，简写成&#96;RegExp[&quot;$_&quot;]&#96;</span><br><span class="line">&#96;RegExp.lastMatch&#96; 最近一次匹配的文本，简写成&#96;RegExp[&quot;$&amp;&quot;]&#96;</span><br><span class="line">&#96;RegExp.lastParen&#96; 最近一次捕获的文本，简写成&#96;RegExp[&quot;$+&quot;]&#96;</span><br><span class="line">&#96;RegExp.leftContext&#96; 目标字符串中&#96;lastMatch&#96;之前的文本，简写成&#96;RegExp[&quot;$&#96;&quot;]&#96;</span><br><span class="line">&#96;RegExp.rightContext &#96;目标字符串中&#96;lastMatch&#96;之后的文本，简写成&#96;RegExp[&quot;$&#39;&quot;]</span><br></pre></td></tr></table></figure>
</blockquote>
<p>测试代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/([abc])(\d)/g</span>;</span><br><span class="line"><span class="keyword">var</span> string = <span class="string">&#x27;a1b2c3d4e5&#x27;</span>;</span><br><span class="line">string.match(regex);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.input);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>[<span class="string">&#x27;$_&#x27;</span>]);</span><br><span class="line"><span class="comment">// =&gt; &quot;a1b2c3d4e5&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.lastMatch);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>[<span class="string">&#x27;$&amp;&#x27;</span>]);</span><br><span class="line"><span class="comment">// =&gt; &quot;c3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.lastParen);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>[<span class="string">&#x27;$+&#x27;</span>]);</span><br><span class="line"><span class="comment">// =&gt; &quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.leftContext);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>[<span class="string">&#x27;$`&#x27;</span>]);</span><br><span class="line"><span class="comment">// =&gt; &quot;a1b2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.rightContext);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>[<span class="string">&quot;$&#x27;&quot;</span>]);</span><br><span class="line"><span class="comment">// =&gt; &quot;d4e5&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-真实案例"><a href="#3-真实案例" class="headerlink" title="3. 真实案例"></a>3. 真实案例</h3><p><strong>3.1 使用构造函数生成正则表达式</strong></p>
<p>我们知道要优先使用字面量来创建正则，但有时正则表达式的主体是不确定的，此时可以使用构造函数来创建。模拟<code>getElementsByClassName</code>方法，就是很能说明该问题的一个例子。</p>
<p>这里<code>getElementsByClassName</code>函数的实现思路是：</p>
<ul>
<li>比如要获取 className 为”high”的 dom 元素；</li>
<li>首先生成一个正则：<code>/(^|\s)high(\s|$)/</code>；</li>
<li>然后再用其逐一验证页面上的所有 dom 元素的类名，拿到满足匹配的元素即可。</li>
</ul>
<p>代码如下(可以直接复制到本地查看运行效果)：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;high&quot;</span>&gt;</span>1111<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;high&quot;</span>&gt;</span>2222<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>3333<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">getElementsByClassName</span>(<span class="params">className</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> elements = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;*&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;(^|\\s)&#x27;</span> + className + <span class="string">&#x27;(\\s|$)&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> result = [];</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; elements.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> element = elements[i];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (regex.test(element.className)) &#123;</span></span><br><span class="line">        result.push(element);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> result;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> highs = getElementsByClassName(<span class="string">&#x27;high&#x27;</span>);</span></span><br><span class="line"><span class="javascript">  highs.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    item.style.color = <span class="string">&#x27;red&#x27;</span>;</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>3.2 使用字符串保存数据</strong></p>
<p>一般情况下，我们都愿意使用数组来保存数据。但我看到有的框架中，使用的却是字符串。</p>
<p>使用时，仍需要把字符串切分成数组。虽然不一定用到正则，但总感觉酷酷的，这里分享如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> utils = &#123;&#125;;</span><br><span class="line"><span class="string">&#x27;Boolean|Number|String|Function|Array|Date|RegExp|Object|Error&#x27;</span></span><br><span class="line">  .split(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">  .forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">    utils[<span class="string">&#x27;is&#x27;</span> + item] = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;&#125;.toString.call(obj) == <span class="string">&#x27;[object &#x27;</span> + item + <span class="string">&#x27;]&#x27;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(utils.isArray([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]));</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p><strong>3.3 if 语句中使用正则替代&amp;&amp;</strong></p>
<p>比如，模拟<code>ready</code>函数，即加载完毕后再执行回调（不兼容 ie 的）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> readyRE = <span class="regexp">/complete|loaded|interactive/</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ready</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (readyRE.test(<span class="built_in">document</span>.readyState) &amp;&amp; <span class="built_in">document</span>.body) &#123;</span><br><span class="line">    callback();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.addEventListener(</span><br><span class="line">      <span class="string">&#x27;DOMContentLoaded&#x27;</span>,</span><br><span class="line">      <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        callback();</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="literal">false</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">&#x27;加载完毕！&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>3.4 使用强大的 replace</strong></p>
<p>因为<code>replace</code>方法比较强大，有时用它根本不是为了替换，只是拿其匹配到的信息来做文章。</p>
<p>这里以查询字符串（querystring）压缩技术为例，注意下面<code>replace</code>方法中，回调函数根本没有返回任何东西。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compress</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> keys = &#123;&#125;;</span><br><span class="line">  source.replace(<span class="regexp">/([^=&amp;]+)=([^&amp;]*)/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">full, key, value</span>) </span>&#123;</span><br><span class="line">    keys[key] = (keys[key] ? keys[key] + <span class="string">&#x27;,&#x27;</span> : <span class="string">&#x27;&#x27;</span>) + value;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">var</span> result = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> keys) &#123;</span><br><span class="line">    result.push(key + <span class="string">&#x27;=&#x27;</span> + keys[key]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result.join(<span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(compress(<span class="string">&#x27;a=1&amp;b=2&amp;a=3&amp;b=4&#x27;</span>));</span><br><span class="line"><span class="comment">// =&gt; &quot;a=1,3&amp;b=2,4&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>3.5 综合运用</strong></p>
<p>最后这里再做个简单实用的正则测试器。</p>
<p>具体效果如下：![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>代码，直接贴了，相信你能看得懂：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;err&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;regex&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入正则表达式&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入测试文本&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;run&quot;</span>&gt;</span>测试一下<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;result&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">  section &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    justify-content: space-around;</span><br><span class="line">    height: 300px;</span><br><span class="line">    padding: 0 200px;</span><br><span class="line">  &#125;</span><br><span class="line">  section * &#123;</span><br><span class="line">    min-height: 30px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-id">#err</span> &#123;</span></span><br><span class="line">    color: red;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-id">#result</span> &#123;</span></span><br><span class="line">    line-height: 30px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.info</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#00c5ff</span>;</span></span><br><span class="line">    padding: 2px;</span><br><span class="line">    margin: 2px;</span><br><span class="line">    display: inline-block;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 获取相应dom元素</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> regexInput = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;regex&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> textInput = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;text&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> runBtn = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;run&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> errBox = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;err&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> resultBox = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;result&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 绑定点击事件</span></span></span><br><span class="line"><span class="javascript">    runBtn.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 清除错误和结果</span></span></span><br><span class="line"><span class="javascript">      errBox.innerHTML = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="javascript">      resultBox.innerHTML = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 获取正则和文本</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> text = textInput.value;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> regex = regexInput.value;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (regex == <span class="string">&#x27;&#x27;</span>) &#123;</span></span><br><span class="line"><span class="javascript">        errBox.innerHTML = <span class="string">&#x27;请输入正则表达式&#x27;</span>;</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (text == <span class="string">&#x27;&#x27;</span>) &#123;</span></span><br><span class="line"><span class="javascript">        errBox.innerHTML = <span class="string">&#x27;请输入测试文本&#x27;</span>;</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line">        regex = createRegex(regex);</span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (!regex) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> result,</span></span><br><span class="line">          results = [];</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 没有修饰符g的话，会死循环</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (regex.global) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">while</span> ((result = regex.exec(text))) &#123;</span></span><br><span class="line">            results.push(result);</span><br><span class="line">          &#125;</span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line">          results.push(regex.exec(text));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (results[<span class="number">0</span>] == <span class="literal">null</span>) &#123;</span></span><br><span class="line"><span class="javascript">          resultBox.innerHTML = <span class="string">&#x27;匹配到0个结果&#x27;</span>;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 倒序是有必要的</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">var</span> i = results.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> result = results[i];</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> match = result[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> prefix = text.substr(<span class="number">0</span>, result.index);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> suffix = text.substr(result.index + match.length);</span></span><br><span class="line"><span class="handlebars"><span class="xml">          text = prefix + &#x27;<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span>&#x27; + match + &#x27;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#x27; + suffix;</span></span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        resultBox.innerHTML = <span class="string">&#x27;匹配到&#x27;</span> + results.length + <span class="string">&#x27;个结果:&lt;br&gt;&#x27;</span> + text;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 生成正则表达式，核心函数</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">createRegex</span>(<span class="params">regex</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (regex[<span class="number">0</span>] == <span class="string">&#x27;/&#x27;</span>) &#123;</span></span><br><span class="line"><span class="javascript">          regex = regex.split(<span class="string">&#x27;/&#x27;</span>);</span></span><br><span class="line">          regex.shift();</span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> flags = regex.pop();</span></span><br><span class="line"><span class="javascript">          regex = regex.join(<span class="string">&#x27;/&#x27;</span>);</span></span><br><span class="line"><span class="javascript">          regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(regex, flags);</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">          regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(regex, <span class="string">&#x27;g&#x27;</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> regex;</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="javascript">        errBox.innerHTML = <span class="string">&#x27;无效的正则表达式&#x27;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)();</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="第七章小结"><a href="#第七章小结" class="headerlink" title="第七章小结"></a>第七章小结</h3><p>相关 API 的注意点，本章基本上算是一网打尽了。</p>
<p>至于文中的例子，都是点睛之笔，没有详细解析。如有理解不透的，建议自己敲一敲。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>其实本文首发于：<a href="https://zhuanlan.zhihu.com/p/27653434">正则表达式系列总结 - 知乎专栏</a></p>
<p>原文是一个系列。一直等到老姚成为掘金的专栏作者，经过仔细考虑，在掘金平台没有采用系列形式，而是合成为了一篇文章。这样既便于读者阅读，最起码能一气呵成地阅读。同时也便于作者统一回复留言。</p>
<p>文章要结束了，最后还要有几点说明。</p>
<h3 id="1-需要注意的地方"><a href="#1-需要注意的地方" class="headerlink" title="1. 需要注意的地方"></a>1. 需要注意的地方</h3><p>本文主要讨论的是 JavaScript 的正则表达式，更精确地说是 ES5 的正则表达式。</p>
<p>JavaScript 的正则表达式引擎是传统型 NFA 的，因此本系列的讨论是适合任何一门正则引擎是传统型 NFA 的编程语言。当然，市面上大部分语言的正则引擎都是这种的。而 JS 里正则涉及到的所有语法要点，是这种引擎支持的核心子集。也就是说，要学正则表达式，不妨以 JS 正则为出发点。</p>
<h3 id="2-参考资料"><a href="#2-参考资料" class="headerlink" title="2. 参考资料"></a>2. 参考资料</h3><p>当然本文不是无本之末。主要参考的是几本书籍。</p>
<p>以下书籍中核心章节都认真阅读过，甚至阅读多遍。</p>
<p><a href="http://link.zhihu.com/?target=https://book.douban.com/subject/10549733/">《JavaScript 权威指南》</a>，看完本系列，再去看书中的第 10 章，你就知道了什么叫字字珠玑。</p>
<p><a href="http://link.zhihu.com/?target=https://book.douban.com/subject/2154713/">《精通正则表达式》</a>，权威且比较杂乱，我阅读的第一本正则表达式书籍。</p>
<p><a href="http://link.zhihu.com/?target=https://book.douban.com/subject/26285406/">《正则表达式必知必会》</a>，这是我看的第二本正则，看完后，确定自己算是入门了。</p>
<p><a href="http://link.zhihu.com/?target=https://book.douban.com/subject/10591096/">《正则指引》</a>，《精通正则表达式》的译者写的，相对清晰。</p>
<p><a href="http://link.zhihu.com/?target=https://book.douban.com/subject/22182383/">《正则表达式入门》</a>，我看的是英文版的，对于已经入门的我，基本没多少收获了。</p>
<p><a href="http://link.zhihu.com/?target=https://book.douban.com/subject/25986599/">《正则表达式经典实例》</a>，除了第 3 章，比较杂外，也有收获，以实例为主导的一本书。</p>
<p><a href="http://link.zhihu.com/?target=https://book.douban.com/subject/26630579/">《JavaScript Regular Expressions》</a>，为数不多转讲 JS 正则的。页数不多，也有收获。</p>
<p><a href="https://book.douban.com/subject/5362856/">《高性能 JavaScript 》</a>第 5 章，我看的是英文版的。第 5 章，讲了回溯和优化。</p>
<p><a href="https://book.douban.com/subject/26638316/">《JavaScript 忍者秘籍》</a>第 7 章，大概讲了一下正则的用法，几个例子还不错。</p>
<p><a href="https://book.douban.com/subject/10546125/">《JavaScript 高级程序设计》</a>第 5.4 节，比较简短的介绍。</p>
<p>使用的工具：</p>
<p>**<a href="http://link.zhihu.com/?target=https://jex.im/regulex/%23!embed=false&flags=&re=%5E(a%7Cb)*?$">Regulex，一款可视化工具</a><br><a href="http://link.zhihu.com/?target=https://www.processon.com/">ProcessOn - 免费在线作图，实时协作</a><br><a href="http://link.zhihu.com/?target=http://www.appinn.com/licecap/">LICEcap – 灵活好用，GIF 屏幕录制工具</a></p>
<p>**</p>
<h3 id="3-个人感悟"><a href="#3-个人感悟" class="headerlink" title="3. 个人感悟"></a>3. 个人感悟</h3><p><strong>要多写文章的</strong></p>
<p>首先，我十分感谢读者。读者能在信息泛滥的网络里，点击我的文章进来瞧两眼，这都是对其注意力的消费。更何况，还有很多童鞋都认真读了，甚至给我挑毛病，这都是对我的帮助。不知有多少童鞋是从头读到这里的，不妨留言打卡，让我知道你是用心的读者，而并非简简单单地收藏一下，然后就再也不曾看过了。</p>
<p>说到要写文章，其目的是以教为学。看似为了教，其实是为了学<strong>。</strong>能教会别人才算自己真正学会了，最起码形成了文字，通过了自己的语言逻辑这一关。如果还能有人指出你的错误认知，那样收获就更大了，何乐而不为呢？</p>
<p>很多书中都提到类似的观点，例如《知道做到》《好好学习》《与时间做朋友》《暗时间》等。</p>
<p><strong>以教为学的其他手段</strong></p>
<p>当然，以教为学的手段还有很多，比如<strong>翻译一本书</strong>。我私下已经翻译了好几本（窃喜^_^）。</p>
<p>可以从薄点的书籍开始，比如 100 页左右的。基本上使用有道就可以了，也不用要求自己一词一句的翻译，能用自己的话说明白就行了。说到这里，不得不提起，我们的阮一峰大神，在我看来，他就是成功地应用这种模式的。看完外文的文章，理解明白了，用自己的话说一说，再形成自己的简练风格。</p>
<p>恐怕你可能说自己的英文水平不够，没信心尝试。相信我，熟悉了常用词汇（比如 literal 翻译成字面量）后，配合有道翻译，薄点的书，一天翻译一章是没问题的。当然前提是你懂相关领域，不然是没办法意译的。</p>
<p>最后一种以教为学的手段是，<strong>写一本书</strong>。写文章是基础，文章多了，自然而言就可以写成一本书。当然，写书强调的是整体架构，所以文章最好成体系。</p>
<p>你看看那些国内专业书籍的作者，一般都事先翻译过几本书的。最起码在前端领域，我就看到了好几位是这么干的。翻译明白了，学会了，用自己的角度去弄出一本书还是相对很容易的。</p>
<p>虽然，本人并未曾写过书，但上述方法，我始终相信是可行的。</p>
<p>最后，我们该想到，陆游诗人对前端界做出的最大贡献是：</p>
<p>纸上得来终觉浅，绝知此事要躬行。</p>
<p>本文完。</p>
<p>可以收藏 PDF 版本：<a href="https://github.com/qdlaoyao/js-regex-mini-book">《JavaScript 正则迷你书》</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>正则</category>
      </categories>
      <tags>
        <tag>转载</tag>
        <tag>正则</tag>
      </tags>
  </entry>
</search>
